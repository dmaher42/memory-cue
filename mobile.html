<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <base href="/memory-cue/" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memory Cue (Mobile) ‚Äî Inline + Edit + Sync All</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.webmanifest" id="manifestLink" />
  <link rel="icon" href="./icons/icon-192.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./styles/tokens.css" />
  <link rel="stylesheet" href="./styles/a11y.css" />
  <link rel="stylesheet" href="dist/styles.css" />
  <style>
    .sync-status {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(148, 163, 184, 0.1);
      color: rgb(15 23 42);
      transition: all 0.2s ease;
    }
    .dark .sync-status {
      border-color: rgba(148, 163, 184, 0.35);
      background: rgba(148, 163, 184, 0.15);
      color: rgb(226 232 240);
    }
    .sync-status.online {
      background: rgba(22, 163, 74, 0.12);
      color: rgb(22 163 74);
      border-color: rgba(22, 163, 74, 0.3);
    }
    .dark .sync-status.online {
      background: rgba(34, 197, 94, 0.16);
      color: rgb(187 247 208);
      border-color: rgba(34, 197, 94, 0.4);
    }
    .sync-status.error {
      background: rgba(248, 113, 113, 0.16);
      color: rgb(220 38 38);
      border-color: rgba(248, 113, 113, 0.32);
    }
    .dark .sync-status.error {
      background: rgba(248, 113, 113, 0.22);
      color: rgb(254 205 211);
      border-color: rgba(248, 113, 113, 0.45);
    }
    .notes-editor {
      min-height: 10rem;
      width: 100%;
      border-radius: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 0.75rem 1rem;
      background-color: rgba(255, 255, 255, 0.9);
      color: inherit;
      white-space: pre-wrap;
      overflow-wrap: break-word;
      line-height: 1.5;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .dark .notes-editor {
      border-color: rgba(148, 163, 184, 0.35);
      background-color: rgba(15, 23, 42, 0.65);
    }
    .notes-editor:focus-visible {
      border-color: rgb(37 99 235);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
    }
    .notes-editor:empty::before {
      content: attr(data-placeholder);
      color: rgba(100, 116, 139, 0.7);
    }
    .dark .notes-editor:empty::before {
      color: rgba(148, 163, 184, 0.7);
    }
    .notes-editor ul,
    .notes-editor ol {
      margin: 0.25rem 0 0.25rem 1.25rem;
      padding-left: 0.75rem;
    }
    .notes-editor ul li,
    .notes-editor ol li {
      margin-bottom: 0.25rem;
    }
    .notes-editor--columns {
      column-width: 16rem;
      column-gap: 1.5rem;
    }
    .view-panel {
      display: grid;
      gap: 1.5rem;
    }
    .section-jump {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      padding-bottom: 0.25rem;
      scrollbar-width: none;
      scroll-snap-type: x proximity;
    }
    .section-jump::-webkit-scrollbar {
      display: none;
    }
    .section-jump .btn {
      scroll-snap-align: start;
    }
    .glass-panel {
      background-color: rgba(248, 250, 252, 0.85);
      backdrop-filter: blur(12px);
    }
    .dark .glass-panel {
      background-color: rgba(15, 23, 42, 0.88);
    }
  </style>
  <!-- BEGIN GPT CHANGE: bottom sheet styles -->
  <style>
    .hidden {
      display: none !important;
    }
    .fab {
      position: fixed;
      right: 16px;
      bottom: 88px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--fallback-p, #2563eb);
      color: var(--fallback-pc, #fff);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.2);
      border: none;
      cursor: pointer;
      z-index: 60;
    }
    .fab:focus-visible {
      outline: 2px solid currentColor;
      outline-offset: 2px;
    }
    .sheet {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      z-index: 70;
    }
    .sheet-panel {
      position: relative;
      left: 0;
      right: 0;
      bottom: 0;
      max-height: 85vh;
      overflow: auto;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      background: var(--fallback-b1, #ffffff);
      color: inherit;
      box-shadow: 0 -16px 32px rgba(15, 23, 42, 0.25);
      padding: 16px;
    }
    .dark .sheet-panel {
      background: rgba(30, 41, 59, 0.97);
    }
    .sheet-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 12px;
    }
    .sheet-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
    }
    #settingsModal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 80;
    }
    .modal-panel {
      position: relative;
      max-width: 420px;
      width: calc(100% - 32px);
      background: var(--fallback-b1, #ffffff);
      color: inherit;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.3);
      overflow: hidden;
    }
    .dark .modal-panel {
      background: rgba(30, 41, 59, 0.97);
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    }
    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
    }
  </style>
  <!-- END GPT CHANGE: bottom sheet styles -->
  <!-- BEGIN GPT CHANGE: rhythm -->
  <style>
    .card-body.compact {
      gap: 0.5rem;
    }
    .inputs-compact input,
    .inputs-compact select,
    .inputs-compact textarea,
    .inputs-compact button {
      padding-top: 8px;
      padding-bottom: 8px;
    }
    main {
      padding-bottom: 96px;
    }
    .chip-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .chip-row label {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 6px 12px;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      cursor: pointer;
      font-size: 0.875rem;
    }
    .chip-row input[type='radio'] {
      accent-color: currentColor;
    }
  </style>
  <!-- END GPT CHANGE: rhythm -->
  <style>
    /* Focus Mode toggles */
    body.focus-mode .nonFocusUI {
      display: none !important;
    }

    /* Focus List */
    .focus-list {
      display: grid;
      gap: 8px;
      padding: 12px;
    }
    .focus-list__item {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      padding: 14px 16px;
      border-radius: 14px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
    }
    .focus-list__title {
      font-size: 16px;
      line-height: 1.2;
    }
    .focus-list__date {
      font-size: 13px;
      opacity: 0.7;
    }
    .focus-list__btn {
      width: 100%;
      text-align: left;
    }

    /* Focus Detail */
    .focus-detail {
      position: fixed;
      inset: 0;
      background: var(--fallback-b1, #fff);
      display: grid;
      grid-template-rows: auto 1fr;
    }
    .focus-detail__header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    .focus-detail__body {
      padding: 12px;
      display: grid;
      gap: 12px;
    }

    /* Safe-area padding */
    .focus-list,
    .focus-detail__body {
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
  </style>
  <style id="minimal-tasks-css">
    /* Hide chrome by default so the page opens with tasks only */
    .nonEssential { display: none !important; }

    /* Optional: simple, clean list styling */
    .task-list-min { display: grid; gap: 8px; padding: 12px; }
    .task-row-min {
      display: grid; grid-template-columns: 1fr auto; align-items: center;
      padding: 12px 14px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,.06);
    }
    .task-row-min .title { font-size: 16px; line-height: 1.2; }
    .task-row-min time { font-size: 13px; opacity: .7; }

    body.show-full .task-list-min { display: block; padding: 0; gap: 0; }
    body.show-full .task-row-min {
      display: block; padding: 0; border-radius: 0; box-shadow: none;
    }
    body.show-full .task-row-min .title { font-size: inherit; line-height: inherit; }
    body.show-full .task-row-min time { font-size: inherit; opacity: 1; }

    /* Optional toggle: when body.show-full is set, reveal everything */
    body.show-full .nonEssential { display: initial !important; }

    /* Minimal layout overrides */
    body:not(.show-full) #reminderListSection { background: transparent; border: none; box-shadow: none; }
    body:not(.show-full) #remindersWrapper { padding: 0; gap: 12px; }
    body:not(.show-full) .task-list-min .task-item { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 8px; padding: 12px 14px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,.06); background: var(--fallback-b1, #fff); }
    body:not(.show-full) .task-list-min .task-item .task-title { font-size: 16px; line-height: 1.2; }
    body:not(.show-full) .task-list-min .task-item .task-meta { justify-self: end; }
    body:not(.show-full) .task-list-min .task-item .task-meta-row { display: contents; }
    body:not(.show-full) .task-list-min .task-item .task-meta-row span:first-child { font-size: 13px; opacity: .7; }
    body:not(.show-full) .task-list-min .task-item .task-meta-row span:not(:first-child),
    body:not(.show-full) .task-list-min .task-item .task-actions,
    body:not(.show-full) .task-list-min .task-item input,
    body:not(.show-full) .task-list-min .task-item .task-notes { display: none !important; }
  </style>
  <style id="voice-add-css">
    .voice-add-wrap{
      position: fixed; right: 12px; bottom: 12px; z-index: 50;
      display: flex; align-items: center; gap: 8px;
      padding: 6px 8px; border-radius: 9999px; background: var(--fallback-b1,#fff);
      box-shadow: 0 2px 8px rgba(0,0,0,.15);
    }
    .voice-status{ font-size: 12px; opacity: .75; }
    /* Keep voice UI visible even if the rest of the chrome is hidden */
    .nonEssential .voice-add-wrap { display: flex; }
  </style>
</head>
<body class="min-h-screen bg-base-200 text-base-content">
  <a class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-50 focus:rounded-full focus:bg-primary focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-primary-content" href="#main">Skip to main content</a>

  <header class="navbar bg-base-100 sticky top-0 z-50 border-b nonFocusUI nonEssential">
    <div class="flex-1 items-center gap-2">
      <a class="btn btn-ghost text-lg font-semibold" href="#">Memory Cue</a>
      <span
        id="syncStatus"
        class="sync-status"
        role="status"
        aria-live="polite"
        aria-atomic="true"
      >Offline</span>
    </div>
    <div class="flex-none flex flex-col gap-1 text-right">
      <div class="flex justify-end items-center gap-2">
        <img
          id="googleAvatar"
          src=""
          alt=""
          class="hidden h-8 w-8 rounded-full border border-base-300"
        />
        <button id="themeToggle" class="btn btn-ghost" type="button">Theme</button>
        <button id="openSettings" class="btn btn-ghost" type="button">Settings</button>
        <button id="googleSignInBtn" class="btn btn-primary" type="button">Sign in</button>
        <button id="googleSignOutBtn" class="btn btn-ghost hidden" type="button">Sign out</button>
      </div>
      <p id="googleUserName" class="text-xs text-base-content/70"></p>
    </div>
  </header>

  <main id="main" class="max-w-md mx-auto px-4 pb-28 pt-4" tabindex="-1" data-active-view="reminders">
    <!-- Voice Add Task UI -->
    <div id="voiceAddWrap" class="voice-add-wrap" aria-live="polite" aria-atomic="true">
      <button id="voiceAddBtn" class="btn btn-circle btn-ghost" aria-pressed="false" aria-label="Add task by voice">üé§</button>
      <span id="voiceStatus" class="voice-status" hidden>Tap üé§ to speak</span>
    </div>
    <button id="toggleUiBtn" class="btn btn-ghost" style="position:fixed;top:12px;right:12px;z-index:40">Full UI</button>
    <!-- Focus List: minimal tasks-only home state -->
    <section id="focusList" class="focus-list nonEssential" aria-label="Tasks">
      <!-- populated by JS: renderList() -->
    </section>

    <!-- Per-task detail surface used when a task is selected -->
    <section
      id="focusDetail"
      class="focus-detail nonEssential"
      hidden
      aria-labelledby="focusDetailTitle"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
    >
      <header class="focus-detail__header">
        <button id="focusBackBtn" class="btn btn-ghost" aria-label="Back to task list">‚Üê Back</button>
        <h2 id="focusDetailTitle" class="text-lg font-semibold">Task</h2>
      </header>
      <div id="focusDetailBody" class="focus-detail__body"></div>
    </section>

    <!-- BEGIN GPT CHANGE: create form moved to bottom sheet -->
    <!-- END GPT CHANGE -->
    <!-- BEGIN GPT CHANGE: reminders view -->
    <section data-view="reminders" id="view-reminders" class="view-panel nonFocusUI">
      <!-- BEGIN GPT CHANGE: sticky filters -->
      <div id="stickyFilters" class="nonFocusUI nonEssential" style="position:sticky; top:56px; z-index: 10;">
        <section id="reminderFilters" class="card bg-base-100 border">
          <div class="card-body gap-4 compact">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <div class="flex flex-wrap items-center gap-2" role="group" aria-label="Reminder filters">
                <button class="btn btn-xs" type="button" data-filter="today" aria-pressed="true">Today ¬∑ <span id="todayCount">0</span></button>
                <button class="btn btn-xs" type="button" data-filter="overdue">Overdue ¬∑ <span id="overdueCount">0</span></button>
                <button class="btn btn-xs" type="button" data-filter="all">All ¬∑ <span id="totalCountBadge">0</span></button>
                <button class="btn btn-xs" type="button" data-filter="done">Done ¬∑ <span id="completedCount">0</span></button>
              </div>
              <label class="form-control w-full sm:w-auto">
                <div class="label hidden sm:flex"><span class="label-text">Category filter</span></div>
                <select id="categoryFilter" class="select select-bordered select-sm">
                  <option value="all" selected>All categories</option>
                  <option value="General">General</option>
                  <option value="General Appointments">General Appointments</option>
                  <option value="Home &amp; Personal">Home &amp; Personal</option>
                  <option value="School ‚Äì Appointments/Meetings">School ‚Äì Appointments/Meetings</option>
                  <option value="School ‚Äì Communication &amp; Families">School ‚Äì Communication &amp; Families</option>
                  <option value="School ‚Äì Excursions &amp; Events">School ‚Äì Excursions &amp; Events</option>
                  <option value="School ‚Äì Grading &amp; Assessment">School ‚Äì Grading &amp; Assessment</option>
                  <option value="School ‚Äì Prep &amp; Resources">School ‚Äì Prep &amp; Resources</option>
                  <option value="School ‚Äì To-Do">School ‚Äì To-Do</option>
                  <option value="Wellbeing &amp; Support">Wellbeing &amp; Support</option>
                </select>
              </label>
            </div>

            <label class="form-control">
              <input id="searchReminders" type="search" class="input input-bordered" placeholder="Search reminders" aria-label="Search" />
            </label>
          </div>
        </section>
      </div>
      <!-- END GPT CHANGE -->
      <section id="reminderListSection" class="card bg-base-100 border">
        <div class="card-body gap-4 compact" id="remindersWrapper">
          <div id="emptyState" class="hidden text-center text-base-content/60"></div>
          <ul id="reminderList" class="hidden space-y-3 task-list-min"></ul>
          <p class="text-xs text-base-content/60 nonEssential">Total reminders: <span id="totalCount">0</span></p>
        </div>
      </section>
    </section>
    <!-- END GPT CHANGE -->
    <!-- BEGIN GPT CHANGE: today view -->
    <section data-view="today" id="view-today" class="view-panel hidden nonFocusUI nonEssential"></section>
    <!-- END GPT CHANGE -->
    <!-- BEGIN GPT CHANGE: notebook view -->
    <section data-view="notebook" id="view-notebook" class="view-panel hidden nonFocusUI nonEssential">
      <section class="card bg-base-100 border">
        <div class="card-body gap-3 compact">
          <div class="flex items-center justify-between gap-2">
            <h2 class="card-title text-base">Scratch Notes</h2>
            <button type="button" class="btn btn-ghost btn-xs" data-jump-view="reminders">Back to reminders</button>
          </div>
          <div
            id="notesToolbar"
            class="flex flex-wrap gap-2"
            role="toolbar"
            aria-label="Scratch notes formatting options"
            aria-controls="notes"
          >
            <button type="button" class="btn btn-xs" data-action="bullets">‚Ä¢ Bullets</button>
            <button type="button" class="btn btn-xs" data-action="numbers">1. Numbers</button>
            <button
              type="button"
              class="btn btn-xs"
              data-action="columns"
              aria-pressed="false"
            >
              Columns
            </button>
          </div>
          <div
            id="notes"
            class="notes-editor"
            contenteditable="true"
            role="textbox"
            aria-multiline="true"
            spellcheck="true"
            data-placeholder="Quick personal notes"
          ></div>
          <div class="flex gap-2">
            <button id="saveNotes" class="btn btn-outline flex-1" type="button">Save notes</button>
            <button id="loadNotes" class="btn btn-outline flex-1" type="button">Load notes</button>
          </div>
        </div>
      </section>

      <section class="card bg-base-100 border">
        <div class="card-body gap-3 compact">
          <h2 class="card-title text-base">Stay organised</h2>
          <p class="text-sm text-base-content/70">Use columns to create side-by-side checklists, or switch back to a single column for longer thoughts. Notes are saved locally so you can revisit them anytime.</p>
          <div class="flex flex-wrap gap-2">
            <button type="button" class="btn btn-outline btn-sm" data-scroll-target="notes">Jump to editor</button>
            <button type="button" class="btn btn-ghost btn-sm" data-jump-view="reminders">Create a reminder instead</button>
          </div>
        </div>
      </section>
    </section>
    <!-- END GPT CHANGE -->
  </main>

  <nav
    class="btm-nav btm-nav-xs fixed bottom-0 left-0 right-0 border-t bg-base-100 nonFocusUI nonEssential"
    role="tablist"
    aria-label="Primary navigation"
  >
    <button
      type="button"
      class="active"
      data-view-target="reminders"
      aria-controls="view-reminders"
      aria-current="page"
    >
      <span class="btm-nav-label">Reminders</span>
    </button>
    <button
      type="button"
      data-view-target="today"
      aria-controls="view-today"
      aria-current="false"
    >
      <span class="btm-nav-label">Today</span>
    </button>
    <button
      type="button"
      data-view-target="notebook"
      aria-controls="view-notebook"
      aria-current="false"
    >
      <span class="btm-nav-label">Notebook</span>
    </button>
  </nav>

  <script type="module" src="./js/mobile-theme-toggle.js"></script>
  <!-- BEGIN GPT CHANGE: bottom sheet for Create Reminder -->
  <div id="create-sheet" role="dialog" aria-modal="true" aria-labelledby="createSheetTitle" class="sheet hidden" tabindex="-1">
    <div class="sheet-panel bg-base-100 border-t border-base-200">
      <header class="sheet-header">
        <h2 id="createSheetTitle">Create Reminder</h2>
        <button type="button" id="closeCreateSheet" aria-label="Close">‚úï</button>
      </header>
      <form id="createReminderForm" class="inputs-compact">
        <div class="card-body gap-4 compact">
          <label class="form-control w-full">
            <div class="label"><span class="label-text">Reminder</span></div>
            <input
              id="reminderText"
              type="text"
              placeholder="e.g., Call Alex at 3pm"
              class="input input-bordered w-full"
              autocomplete="off"
            />
          </label>

          <label class="form-control w-full">
            <div class="label"><span class="label-text">Notes</span></div>
            <textarea
              id="reminderDetails"
              class="textarea textarea-bordered"
              rows="3"
              placeholder="Optional context for the reminder"
            ></textarea>
          </label>

          <div class="grid grid-cols-2 gap-3">
            <label class="form-control">
              <div class="label"><span class="label-text">Date</span></div>
              <input id="reminderDate" type="date" class="input input-bordered" />
            </label>
            <label class="form-control">
              <div class="label"><span class="label-text">Time</span></div>
              <input id="reminderTime" type="time" class="input input-bordered" />
            </label>
          </div>

          <div id="dateFeedback" class="text-xs text-info"></div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-control">
              <div class="label"><span class="label-text">Priority</span></div>
              <select id="priority" class="select select-bordered hidden" aria-hidden="true" tabindex="-1">
                <option value="High">High</option>
                <option value="Medium" selected>Medium</option>
                <option value="Low">Low</option>
              </select>
              <!-- BEGIN GPT CHANGE: priority chips -->
              <fieldset id="priorityChips" aria-label="Priority" class="chip-row">
                <label><input type="radio" name="priority" value="High"> High</label>
                <label><input type="radio" name="priority" value="Medium" checked> Medium</label>
                <label><input type="radio" name="priority" value="Low"> Low</label>
              </fieldset>
              <!-- END GPT CHANGE: priority chips -->
            </div>
            <label class="form-control">
              <div class="label"><span class="label-text">Category</span></div>
              <input
                id="category"
                class="input input-bordered"
                list="categorySuggestions"
                placeholder="General"
                value="General"
              />
              <datalist id="categorySuggestions">
                <option value="General"></option>
                <option value="General Appointments"></option>
                <option value="Home &amp; Personal"></option>
                <option value="School ‚Äì Appointments/Meetings"></option>
                <option value="School ‚Äì Communication &amp; Families"></option>
                <option value="School ‚Äì Excursions &amp; Events"></option>
                <option value="School ‚Äì Grading &amp; Assessment"></option>
                <option value="School ‚Äì Prep &amp; Resources"></option>
                <option value="School ‚Äì To-Do"></option>
                <option value="Wellbeing &amp; Support"></option>
              </datalist>
            </label>
          </div>

          <div class="flex flex-wrap items-center gap-3">
            <button id="voiceBtn" class="btn btn-ghost" type="button" aria-label="Voice input">üéôÔ∏è</button>
            <button id="notifBtn" class="btn btn-ghost" type="button">Enable notifications</button>
            <button id="quickAdd" class="btn btn-outline" type="button">Quick add</button>
          </div>

          <div class="card-actions justify-stretch">
            <button id="saveReminder" class="btn btn-primary w-full" type="button">Save Reminder</button>
            <button id="cancelEditBtn" class="btn btn-outline w-full hidden" type="button">Cancel</button>
          </div>
          <p id="statusMessage" class="text-sm text-base-content/70" role="status" aria-live="polite"></p>
        </div>
      </form>
    </div>
    <div class="sheet-backdrop" data-close></div>
  </div>
  <!-- END GPT CHANGE: bottom sheet for Create Reminder -->

  <!-- BEGIN GPT CHANGE: settings modal -->
  <div id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" class="hidden">
    <div class="modal-panel">
      <header class="modal-header">
        <h2 id="settingsTitle">Settings</h2>
        <button type="button" id="closeSettings" aria-label="Close">‚úï</button>
      </header>
      <div class="card bg-base-100 border-0">
        <div class="card-body gap-4 compact">
          <h2 class="card-title text-base">Sync Settings</h2>
          <p class="text-sm text-base-content/70">Configure your Google Apps Script endpoint to sync reminders to Calendar.</p>
          <label class="form-control">
            <div class="label"><span class="label-text">Apps Script URL</span></div>
            <input id="syncUrl" type="url" class="input input-bordered" placeholder="https://script.google.com/macros/s/.../exec" />
          </label>
          <div class="card-actions flex-col gap-2">
            <div class="flex gap-2 w-full">
              <button id="saveSyncSettings" class="btn btn-outline flex-1" type="button">Save Settings</button>
              <button id="testSync" class="btn btn-outline flex-1" type="button">Test Connection</button>
            </div>
            <button id="syncAll" class="btn btn-primary w-full" type="button">Sync All</button>
          </div>
          <p class="text-xs text-base-content/60">Tip: In Google Apps Script choose <strong>Deploy ‚Üí Web app</strong>, execute as yourself and allow access to anyone with the link.</p>
        </div>
      </div>
    </div>
    <div class="modal-backdrop" data-close></div>
  </div>
  <!-- END GPT CHANGE: settings modal -->

  <!-- BEGIN GPT CHANGE: global FAB -->
  <button id="fabCreate" class="fab nonFocusUI nonEssential" aria-label="Add reminder">Ôºã</button>
  <!-- END GPT CHANGE: global FAB -->

  <!-- BEGIN GPT CHANGE: include mobile.js -->
  <script type="module" src="./mobile.js"></script>
  <!-- END GPT CHANGE: include mobile.js -->
  <!--
  <script>
    /* Focus Mode controller */
    const Focus = (() => {
      const listEl = document.getElementById('focusList');
      const detailEl = document.getElementById('focusDetail');
      const detailBody = document.getElementById('focusDetailBody');
      const backBtn = document.getElementById('focusBackBtn');

      function enable() {
        document.body.classList.add('focus-mode');
        renderList();
      }

      function disable() {
        document.body.classList.remove('focus-mode');
        if (listEl) listEl.innerHTML = '';
        hideDetail();
      }

      function renderList() {
        if (!listEl) return;
        const tasks = (window.getAllReminders ? window.getAllReminders() : [])
          .sort((a, b) => new Date(a.dueISO || 0) - new Date(b.dueISO || 0));

        if (!tasks.length) {
          listEl.innerHTML = '<p role="status" class="opacity-70 p-3">No tasks yet.</p>';
          return;
        }

        listEl.innerHTML = tasks
          .map((t) => {
            const date = t.dueISO ? new Date(t.dueISO) : null;
            const dateStr = date
              ? date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })
              : '';
            const aria = t.notes ? `aria-describedby="note-hint-${t.id}"` : '';
            const noteHint = t.notes
              ? `<span id="note-hint-${t.id}" class="sr-only">Has notes</span>`
              : '';
            return `
      <article class="focus-list__item">
        <button class="focus-list__btn" data-taskid="${t.id}" aria-expanded="false" ${aria}>
          <div class="focus-list__title">${escapeHTML(t.title || 'Untitled')}</div>
          ${noteHint}
        </button>
        <time class="focus-list__date" datetime="${t.dueISO || ''}">${dateStr}</time>
      </article>`;
          })
          .join('');

        listEl.addEventListener(
          'click',
          (e) => {
            const btn = e.target.closest('button[data-taskid]');
            if (!btn) return;
            const id = btn.getAttribute('data-taskid');
            showDetail(id, btn);
          },
          { once: true }
        );
      }

      function showDetail(taskId, triggerEl) {
        const t = window.getReminderById ? window.getReminderById(taskId) : null;
        if (!t) return;

        if (triggerEl) triggerEl.setAttribute('aria-expanded', 'true');

        detailBody.innerHTML = `
      <h3 class="text-xl font-semibold">${escapeHTML(t.title || 'Untitled')}</h3>
      <div class="opacity-70">Due:
        <time datetime="${t.dueISO || ''}">${
          t.dueISO ? new Date(t.dueISO).toLocaleString() : '‚Äî'
        }</time>
      </div>

      <details class="mt-2">
        <summary class="cursor-pointer">Show notes</summary>
        <div class="mt-2 whitespace-pre-wrap">${escapeHTML(t.notes || '')}</div>
      </details>

      <div id="focusControls"></div>
    `;

        if (window.mountTaskControls) {
          window.mountTaskControls('focusControls', taskId);
        }

        detailEl.hidden = false;
        detailEl.focus();
        setInertExcept(detailEl);

        backBtn.onclick = () => {
          hideDetail(triggerEl);
          renderList();
        };
      }

      function hideDetail(triggerEl) {
        if (!detailEl.hidden) {
          detailEl.hidden = true;
          clearInert();
          if (triggerEl) {
            triggerEl.setAttribute('aria-expanded', 'false');
            triggerEl.focus();
          }
        }
      }

      function setInertExcept(el) {
        const els = Array.from(document.body.children).filter((n) => n !== el && !n.contains(el));
        els.forEach((n) => n.setAttribute('inert', ''));
      }
      function clearInert() {
        Array.from(document.querySelectorAll('[inert]')).forEach((n) => n.removeAttribute('inert'));
      }
      function escapeHTML(str) {
        return (str + '').replace(/[&<>"']/g, (s) => ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
        })[s]);
      }

      return { enable, disable };
    })();

    /* Enable Focus Mode on initial load */
    window.addEventListener('DOMContentLoaded', () => {
      if (!document.body.classList.contains('focus-mode')) {
        Focus.enable();
      }
    });
  </script>
  -->
  <script src="app.js" type="module"></script>
  <script>
    (function () {
      var btn = document.getElementById('toggleUiBtn');
      if (!btn) return;
      btn.addEventListener('click', function () {
        document.body.classList.toggle('show-full');
        btn.textContent = document.body.classList.contains('show-full') ? 'Minimal' : 'Full UI';
      });
    })();
    (function () {
      function applyMinimalLayout() {
        var list = document.getElementById('reminderList');
        if (!list) return;
        list.querySelectorAll('.task-item').forEach(function (item) {
          item.classList.add('task-row-min');
          var title = item.querySelector('.task-title');
          if (title) {
            title.classList.add('title');
          }
          var due = item.querySelector('.task-meta-row span');
          if (due && !due.querySelector('time')) {
            var text = due.textContent.trim();
            var timeEl = document.createElement('time');
            var iso = item.getAttribute('data-due') || (item.dataset ? item.dataset.due : '');
            if (iso) {
              timeEl.setAttribute('datetime', iso);
            }
            timeEl.textContent = text;
            due.textContent = '';
            due.appendChild(timeEl);
          }
        });
      }
      document.addEventListener('DOMContentLoaded', applyMinimalLayout);
      document.addEventListener('reminders:updated', applyMinimalLayout);
    })();
  </script>
  <script id="voice-add-script">
    (function(){
      const btn = document.getElementById('voiceAddBtn');
      const statusEl = document.getElementById('voiceStatus');

      if (!btn) return;

      // Web Speech API (Chrome/Edge/Android via webkit*, some desktop Chrome; graceful fallback elsewhere)
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

      // Helper: best-effort task creator using whatever the app exposes
      async function createTaskFromText(text){
        if (!text || !text.trim()) return;
        // Preferred hooks, if present:
        if (typeof window.addReminderFromVoice === 'function') return window.addReminderFromVoice(text);
        if (typeof window.createReminder === 'function') return window.createReminder(text);
        if (typeof window.createReminderFromInput === 'function') return window.createReminderFromInput(text);

        // Fallbacks: try to populate a known input and submit
        const input = document.getElementById('reminderText');
        if (input) {
          input.value = text;
          // try submit the nearest form
          const form = input.form || document.querySelector('form');
          if (form) form.requestSubmit ? form.requestSubmit() : form.submit();
        }

        // Emit an app-level event so existing code can listen and handle creation
        document.dispatchEvent(new CustomEvent('voice:addTask', { detail: { text } }));
      }

      function setStatus(msg, show=true){
        if (!statusEl) return;
        if (show) {
          statusEl.hidden = false;
          statusEl.textContent = msg;
        } else {
          statusEl.hidden = true;
        }
      }

      if (!SpeechRecognition) {
        // Graceful fallback: clicking mic prompts for manual entry
        btn.addEventListener('click', async () => {
          const text = window.prompt('Speak-to-text not supported here. Type your task:','');
          if (text) await createTaskFromText(text);
        });
        setStatus('Voice not supported here', true);
        return;
      }

      // Configure recognizer
      const recog = new SpeechRecognition();
      recog.lang = 'en-AU';          // Australian English
      recog.interimResults = true;    // show progress
      recog.maxAlternatives = 1;
      recog.continuous = false;       // single utterance per tap

      let collecting = false;
      let finalTranscript = '';

      function start(){
        if (collecting) return;
        finalTranscript = '';
        collecting = true;
        btn.setAttribute('aria-pressed', 'true');
        setStatus('Listening‚Ä¶ speak your task');
        try { recog.start(); } catch(_) {}
      }

      function stop(){
        if (!collecting) return;
        collecting = false;
        btn.setAttribute('aria-pressed', 'false');
        setStatus('Processing‚Ä¶');
        try { recog.stop(); } catch(_) {}
      }

      btn.addEventListener('click', () => (collecting ? stop() : start()));

      recog.onresult = async (e) => {
        let interim = '';
        for (let i = e.resultIndex; i < e.results.length; i++) {
          const transcript = e.results[i][0].transcript;
          if (e.results[i].isFinal) finalTranscript += transcript;
          else interim += transcript;
        }
        if (interim) setStatus('‚Ä¶' + interim);
      };

      recog.onerror = (e) => {
        setStatus('Mic error: ' + (e.error || 'unknown'));
        collecting = false;
        btn.setAttribute('aria-pressed','false');
      };

      recog.onend = async () => {
        // Called after stop or timeout
        const text = (finalTranscript || '').trim();
        if (text) {
          setStatus('Adding: ' + text);
          try { await createTaskFromText(text); }
          catch (err) { setStatus('Could not add task'); console.warn(err); }
          setStatus('Tap üé§ to speak', true);
        } else {
          setStatus('Tap üé§ to speak', true);
        }
        collecting = false;
        btn.setAttribute('aria-pressed','false');
      };
    })();
  </script>
</body>
</html>
