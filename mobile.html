<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <base href="/memory-cue/" />
  <!-- === SUPABASE CONFIG (put before your main JS) === -->
  <script type="module" src="./assets/init-env-MQHJLMJ2.js" defer></script>
  <script type="module" src="./assets/config-supabase-MP3TZUE5.js" defer></script>
  <script defer src="./js/firebase-config.js"></script>
  <!-- === /SUPABASE CONFIG === -->
  <!-- Production CSS: compiled via Tailwind/PostCSS; build rewrites this to a hashed asset -->
  <link rel="stylesheet" href="./styles/index.css" />
  <style>
    :root {
      --card-bg: #FFFFFF;
      --card-border: #CBE6D5;
      --text-primary: #1F2A24;
      --text-secondary: #4C6457;
      --accent-color: #B5A9FF;
      --success-color: #63C69B;
      --background-color: #2f2a33;
      --hover-bg: #DCEFE2;
      --shadow-color: rgba(31, 42, 36, 0.08);
      --delete-color: #EF6A6A;

      /* Legacy tokens mapped to Calming Tones palette */
      --primary-color: var(--accent-color);
      --primary-dark: #7A6AE0;
      --secondary-color: #B5A9FF;
      --warning-color: #F7C56C;
      --info-color: var(--accent-color);
      --bg-color: var(--background-color);
      --border-color: var(--card-border);
      --priority-high-border: #F4A259; /* Bio Orange */
      --priority-high-bg: color-mix(in srgb, var(--priority-high-border) 18%, #FFFFFF);
      --priority-medium-border: #6C8AE4; /* Quantum Blue */
      --priority-medium-bg: color-mix(in srgb, var(--priority-medium-border) 16%, #FFFFFF);
      --priority-low-border: #6B8F71; /* Digital Sage */
      --priority-low-bg: color-mix(in srgb, var(--priority-low-border) 16%, #FFFFFF);
      --shadow-sm: 0 1px 3px var(--shadow-color);
      --shadow-md: 0 4px 12px var(--shadow-color);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --reminder-card-padding-y: 0.35rem;
      --reminder-card-padding-x: 0.6rem;
      --reminder-card-gap: 0.3rem;
      --reminder-card-font-size: 0.85rem;
    }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  body[data-active-view="notebook"] .container {
    max-width: none;
    margin: 0;
    padding: 0;
  }

  body[data-active-view="notebook"] #main {
    max-width: none;
    margin: 0;
    padding-bottom: 0;
  }

  body[data-active-view="notebook"] #view-notebook {
    background: var(--card-bg);
  }

  body[data-active-view="notebook"] #view-notebook .card {
    margin: 0;
    border: none;
    border-radius: 0;
    box-shadow: none;
    background: transparent;
  }

  body[data-active-view="notebook"] #view-notebook .card-body {
    padding: clamp(1.25rem, 5vw, 2rem);
    padding-bottom: clamp(5rem, 10vw, 6rem);
    min-height: calc(100dvh - 4rem);
  }

  .card {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    padding: 24px;
    margin-bottom: 20px;
    transition: var(--transition);
  }

  .card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .quick-actions-panel {
    background: transparent;
    border: none;
    box-shadow: none;
  }

  .quick-actions {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 0.75rem;
    padding: 0.75rem;
    background: transparent;
    border: none;
    box-shadow: none;
    z-index: 50;
    justify-items: center;
  }

  .quick-actions li {
    list-style: none;
  }

  .quick-action-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.35rem;
    width: 3.25rem;
    height: 3.25rem;
    border-radius: 9999px;
    border: none;
    background: rgba(15, 23, 42, 0.1);
    color: var(--text-primary, rgba(15, 23, 42, 0.88));
    font-size: 1.2rem;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
  }

  .quick-action-btn:hover,
  .quick-action-btn:focus-visible {
    background: rgba(15, 23, 42, 0.16);
    transform: translateY(-1px);
    outline: none;
  }

  html[data-theme="dark"] .quick-action-btn {
    background: rgba(226, 232, 240, 0.08);
    color: rgba(226, 232, 240, 0.92);
  }

  html[data-theme="dark"] .quick-action-btn:hover,
  html[data-theme="dark"] .quick-action-btn:focus-visible {
    background: rgba(226, 232, 240, 0.16);
  }

  .quick-action-icon {
    font-size: 1.25rem;
    line-height: 1;
  }

  .menu-heading {
    margin: 0;
    padding: 0.75rem 1rem 0.25rem;
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: 600;
    color: rgba(15, 23, 42, 0.6);
  }

  html[data-theme="dark"] .menu-heading {
    color: rgba(226, 232, 240, 0.65);
  }

  /* Reminders wrapper spacing on mobile */
  #remindersWrapper {
    margin-top: 0.75rem;
  }

  /* Main reminders list container */
  #reminderList {
    list-style: none;
    margin: 0;
    padding: 0;
  }

    /* Each reminder item uses the Calming Tones card styling */
    #reminderList > * {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      align-items: start;
      gap: var(--reminder-card-gap);
      padding: var(--reminder-card-padding-y) var(--reminder-card-padding-x);
      margin: 0 0 var(--reminder-card-gap) 0;
      border: 1px solid var(--card-border);
      font-size: var(--reminder-card-font-size);
      line-height: 1.4;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 1px 3px var(--shadow-color);
      transition: all 0.2s ease;
    }

    #reminderList > *:hover {
      box-shadow: 0 4px 12px var(--shadow-color);
      transform: translateY(-2px);
      border-color: var(--accent-color);
      background: var(--hover-bg);
    }

    /* --- Priority Tints & Borders --- */

    /* Update the base card to include a default border */
    .reminder-card {
      border-left: 3px solid var(--border-color);
      transition: all 0.2s ease;
    }

    /* High priority: Bio Orange tint + border */
    .reminder-card.priority-high {
      background-color: var(--priority-high-bg);
      border-left-color: var(--priority-high-border);
    }

    /* Medium priority: Quantum Blue tint + border */
    .reminder-card.priority-medium {
      background-color: var(--priority-medium-bg);
      border-left-color: var(--priority-medium-border);
    }

    /* Low priority: Digital Sage accent */

    /* If reminders are wrapped in DaisyUI cards, ensure they inherit the new look */
    #reminderList > * .card,
    #reminderList > * .card-body {
      background: transparent;
      border-radius: inherit;
      box-shadow: none;
      padding: 0;
      margin: 0;
      border: none;
    }

    @media (max-width: 640px) {
      #reminderList > .reminder-card {
        display: grid;
        grid-template-columns: minmax(0, 1fr) auto;
        align-items: start;
        gap: 0.5rem;
        padding: 0.6rem 0.8rem;
        margin-bottom: 0.5rem;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 0.5rem;
        box-shadow: 0 1px 2px rgba(15, 23, 42, 0.06);
        font-size: var(--reminder-card-font-size);
        line-height: 1.4;
      }

      #reminderList > .reminder-card.priority-high {
        background: var(--priority-high-bg);
        border-left: 3px solid var(--priority-high-border);
      }

      #reminderList > .reminder-card.priority-medium {
        background: var(--priority-medium-bg);
        border-left: 3px solid var(--priority-medium-border);
      }

      #reminderList > .reminder-card.priority-low {
        background: var(--priority-low-bg);
        border-left: 3px solid var(--priority-low-border);
      }

      #reminderList > .reminder-card:last-child {
        margin-bottom: 0;
      }

      #reminderList > .reminder-card h3,
      #reminderList > .reminder-card h4,
      #reminderList > .reminder-card strong,
      #reminderList > .reminder-card [data-reminder-title] {
        margin: 0;
        font-size: 1rem;
        font-weight: 800;
      }

      #reminderList > .reminder-card time,
      #reminderList > .reminder-card .reminder-meta {
        font-size: 0.825rem;
        color: #6B7280;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      #reminderList > .reminder-card .priority-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .priority-pill {
        display: inline-flex;
        align-items: center;
        border-radius: 9999px;
        padding: 0.15rem 0.4rem;
        font-size: 0.75rem;
        font-weight: 600;
        line-height: 1;
      }

      .priority-pill.priority-high {
        background: color-mix(in srgb, var(--priority-high-border) 18%, #FFFFFF);
        border: 1px solid color-mix(in srgb, var(--priority-high-border) 32%, transparent);
        color: var(--priority-high-border);
      }

      .priority-pill.priority-medium {
        background: color-mix(in srgb, var(--priority-medium-border) 18%, #FFFFFF);
        border: 1px solid color-mix(in srgb, var(--priority-medium-border) 32%, transparent);
        color: var(--priority-medium-border);
      }

      .priority-pill.priority-low {
        background: color-mix(in srgb, var(--priority-low-border) 18%, #FFFFFF);
        border: 1px solid color-mix(in srgb, var(--priority-low-border) 32%, transparent);
        color: var(--priority-low-border);
      }
    }

  /* Remove extra spacing on the last item */
  #reminderList > *:last-child {
    margin-bottom: 0;
  }

    /* Title on the left */
    #reminderList > * h3,
    #reminderList > * h4,
    #reminderList > * strong,
    #reminderList > * [data-reminder-title] {
      margin: 0;
      color: var(--text-primary);
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      grid-column: 1;
      min-width: 0; /* allow text to truncate */
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-clamp: 2;
    }

    /* Meta info (right side: date/time/status) */
    #reminderList > * time,
    #reminderList > * .reminder-meta {
      color: var(--text-secondary);
      font-size: 0.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--reminder-card-gap);
      margin-top: 0.75rem;
      grid-column: 1 / -1;
    }

    #reminderList > * time {
      justify-content: flex-end;
      text-align: right;
    }

    #reminderList > * p,
    #reminderList > * .description,
    #reminderList > * .details {
      color: var(--text-secondary);
    }
  </style>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
  />
  <title>Memory Cue (Mobile)</title>
  <meta name="theme-color" content="#10b981" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)" />
  <link rel="manifest" href="./manifest.webmanifest" id="manifestLink" />
  <link rel="apple-touch-icon" href="./icons/apple-touch-icon.png" />
  <link rel="icon" href="./icons/icon-192.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./styles/tokens.css" />
  <link rel="stylesheet" href="./styles/a11y.css" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css"
    integrity="sha384-yxrQVVFFRZdq4Z/YbeTDzSYbn1W6VnVonm2vAgnxtxUMehcccE4k2NufOz2tJnOe"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="./styles/daisy-themes.css" />
  <link rel="stylesheet" href="./css/theme-mobile.css" />
  <style>
    /* Accessibility helper */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    /* Status dot colors */
    .sync-dot {
      font-size: 14px;
      line-height: 1;
      transition: color 0.2s ease;
    }
    .sync-dot.online {
      color: var(--success-color);
    }
    .sync-dot.offline {
      color: var(--secondary-color);
    }
    .sync-status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.55rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      line-height: 1;
      background: color-mix(in srgb, var(--text-primary) 6%, transparent);
      color: var(--text-secondary);
      transition: var(--transition);
    }

    .dark .sync-status-indicator {
      background: color-mix(in srgb, var(--text-secondary) 30%, transparent);
      color: color-mix(in srgb, var(--card-bg) 90%, var(--text-primary) 10%);
    }

    .sync-status-indicator.online {
      background: color-mix(in srgb, var(--success-color) 15%, transparent);
      color: color-mix(in srgb, var(--success-color) 92%, var(--text-primary) 8%);
    }

    .sync-status-indicator.offline,
    .sync-status-indicator.error {
      background: color-mix(in srgb, var(--secondary-color) 16%, transparent);
      color: color-mix(in srgb, var(--secondary-color) 92%, var(--text-primary) 8%);
    }

    .sync-dot {
      display: inline-block;
      width: 0.55rem;
      height: 0.55rem;
      border-radius: 9999px;
      background: color-mix(in srgb, var(--secondary-color) 90%, transparent);
      transition: var(--transition);
    }

    .sync-dot.online {
      background: color-mix(in srgb, var(--success-color) 90%, transparent);
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--success-color) 18%, transparent);
    }
    .notes-editor {
      min-height: 10rem;
      width: 100%;
      border-radius: 0.75rem;
      border: 1px solid color-mix(in srgb, var(--border-color) 50%, transparent);
      padding: 0.75rem 1rem;
      background-color: color-mix(in srgb, var(--card-bg) 90%, transparent);
      color: inherit;
      white-space: pre-wrap;
      overflow-wrap: break-word;
      line-height: 1.5;
      outline: none;
      transition: var(--transition);
    }
    .dark .notes-editor {
      border-color: color-mix(in srgb, var(--border-color) 35%, transparent);
      background-color: color-mix(in srgb, var(--text-primary) 65%, transparent);
    }
    .notes-editor:focus-visible {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent);
    }
    .notes-editor:empty::before {
      content: attr(data-placeholder);
      color: color-mix(in srgb, var(--text-secondary) 70%, transparent);
    }
    .dark .notes-editor:empty::before {
      color: color-mix(in srgb, var(--text-secondary) 70%, var(--card-bg) 30%);
    }
    .notes-editor ul,
    .notes-editor ol {
      margin: 0.25rem 0 0.25rem 1.25rem;
      padding-left: 0.75rem;
    }
    .notes-editor ul li,
    .notes-editor ol li {
      margin-bottom: 0.25rem;
    }
    .notes-editor--columns {
      column-width: 16rem;
      column-gap: 1.5rem;
    }
    
    /* Enhanced notes editor styles */
    .notes-editor.enhanced {
      min-height: 12rem;
      max-height: 60vh;
      overflow-y: auto;
      scroll-behavior: smooth;
    }
    
    .notes-editor strong {
      font-weight: 700;
    }
    
    .notes-editor em {
      font-style: italic;
    }
    
    .notes-editor s {
      text-decoration: line-through;
    }
    
    .notes-editor h1, .notes-editor h2, .notes-editor h3 {
      font-weight: 600;
      margin: 0.75rem 0 0.5rem 0;
      line-height: 1.3;
    }
    
    .notes-editor h1 {
      font-size: 1.25rem;
      border-bottom: 2px solid color-mix(in srgb, var(--primary-color) 30%, transparent);
      padding-bottom: 0.25rem;
    }
    
    .notes-editor h2 {
      font-size: 1.125rem;
    }
    
    .notes-editor h3 {
      font-size: 1rem;
    }
    
    .notes-editor a {
      color: var(--primary-color);
      text-decoration: underline;
    }
    
    .notes-editor hr {
      margin: 1rem 0;
      border: none;
      border-top: 1px solid color-mix(in srgb, var(--border-color) 50%, transparent);
    }
    
    .notes-editor .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      margin: 0.25rem 0;
    }
    
    .notes-editor .checklist-checkbox {
      cursor: pointer;
      margin-top: 0.125rem;
    }
    
    .notes-editor .highlight {
      background: color-mix(in srgb, var(--warning-color) 25%, transparent);
      padding: 0 0.25rem;
      border-radius: 0.25rem;
    }
    
    /* Mobile-optimized toolbar */
    @media (max-width: 640px) {
      #notesToolbar {
        gap: 1px;
        padding: 0.5rem;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      
      #notesToolbar::-webkit-scrollbar {
        display: none;
      }
      
      #notesToolbar .btn {
        min-width: 2.5rem;
        padding: 0.375rem 0.25rem;
        font-size: 0.875rem;
        flex-shrink: 0;
      }
      
      #notesToolbar > div {
        border-right: 1px solid color-mix(in srgb, var(--border-color) 40%, transparent);
        padding-right: 0.5rem;
        margin-right: 0.5rem;
        display: flex;
        gap: 1px;
        flex-shrink: 0;
      }
      
      #notesToolbar > div:last-child {
        border-right: none;
        padding-right: 0;
        margin-right: 0;
      }
      
      /* Improve search panel on mobile */
      #searchPanel {
        margin: 0 -0.5rem;
      }
      
      #searchPanel .flex {
        flex-wrap: nowrap;
      }
      
      #searchInput {
        font-size: 16px; /* Prevent zoom on iOS */
      }
    }

    .search-input,
    .filter-select,
    #searchPanel input,
    #searchPanel select {
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      color: var(--text-primary);
      border-radius: 10px;
      padding: 0.65rem 0.85rem;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px var(--shadow-color);
    }

    .search-input::placeholder,
    #searchPanel input::placeholder {
      color: color-mix(in srgb, var(--text-secondary) 70%, transparent);
    }

    .search-input:focus,
    .filter-select:focus,
    #searchPanel input:focus,
    #searchPanel select:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-color) 25%, transparent);
      outline: none;
    }

    /* Auto-save status indicator */
    .sync-dot {
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 50%;
      display: inline-block;
    }
    
    .sync-dot.saving {
      background: color-mix(in srgb, var(--warning-color) 80%, transparent);
      animation: pulse 1.5s infinite;
    }
    
    .sync-dot.saved {
      background: color-mix(in srgb, var(--success-color) 80%, transparent);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .view-panel {
      display: grid;
      gap: 1.5rem;
    }
    .section-jump {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      padding-bottom: 0.25rem;
      scrollbar-width: none;
      scroll-snap-type: x proximity;
    }

    .section-header h2,
    .view-panel h2 {
      color: var(--text-primary);
    }
    .section-jump::-webkit-scrollbar {
      display: none;
    }
    .section-jump .btn {
      scroll-snap-align: start;
    }
    .glass-panel {
      background-color: color-mix(in srgb, var(--bg-color) 85%, var(--card-bg) 15%);
      backdrop-filter: blur(12px);
    }
    .dark .glass-panel {
      background-color: color-mix(in srgb, var(--text-primary) 88%, transparent);
    }
    /* Enhanced reminder visibility styles */
    .task-item {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: stretch;
      padding: 0.75rem 0.875rem;
      margin-bottom: 0.5rem;
      background: color-mix(in srgb, var(--card-bg) 98%, transparent);
      border: 1px solid color-mix(in srgb, var(--border-color) 28%, transparent);
      border-left-width: 3px;
      border-left-color: color-mix(in srgb, var(--primary-color) 60%, transparent);
      border-radius: 0.75rem;
      box-shadow: 0 1px 2px var(--shadow-color);
      transition: var(--transition);
    }
    .task-item:hover {
      border-left-color: color-mix(in srgb, var(--primary-color) 85%, transparent);
      box-shadow: 0 2px 6px var(--shadow-color);
      transform: translateY(-1px);
    }
    .dark .task-item {
      background: color-mix(in srgb, var(--text-primary) 85%, transparent);
      border-color: color-mix(in srgb, var(--border-color) 25%, transparent);
      border-left-color: color-mix(in srgb, var(--primary-color) 70%, var(--card-bg) 30%);
      box-shadow: var(--shadow-sm);
    }
    .dark .task-item:hover {
      border-left-color: color-mix(in srgb, var(--primary-color) 100%, var(--card-bg) 20%);
      box-shadow: var(--shadow-md);
    }
    .task-item[data-notification-active="true"] {
      border-color: color-mix(in srgb, var(--success-color) 75%, transparent);
      border-left-color: color-mix(in srgb, var(--success-color) 95%, transparent);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--success-color) 35%, transparent),
        0 8px 18px color-mix(in srgb, var(--success-color) 25%, transparent);
    }
    .task-item[data-notification-active="true"]:hover {
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--success-color) 45%, transparent),
        0 10px 22px color-mix(in srgb, var(--success-color) 35%, transparent);
      transform: translateY(-1px);
    }
    .dark .task-item[data-notification-active="true"] {
      border-color: color-mix(in srgb, var(--success-color) 85%, var(--card-bg) 15%);
      border-left-color: color-mix(in srgb, var(--success-color) 95%, var(--card-bg) 5%);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--success-color) 35%, transparent),
        0 10px 24px color-mix(in srgb, var(--success-color) 35%, transparent);
    }
    .dark .task-item[data-notification-active="true"]:hover {
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--success-color) 50%, transparent),
        0 12px 26px color-mix(in srgb, var(--success-color) 45%, transparent);
    }
    .task-item[data-priority="High"] {
      border-left-color: color-mix(in srgb, var(--secondary-color) 70%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--secondary-color) 40%, var(--card-bg) 60%),
        color-mix(in srgb, var(--card-bg) 95%, transparent)
      );
    }
    .dark .task-item[data-priority="High"] {
      border-left-color: color-mix(in srgb, var(--secondary-color) 80%, var(--card-bg) 20%);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--secondary-color) 30%, var(--text-primary) 70%),
        color-mix(in srgb, var(--text-primary) 85%, transparent)
      );
    }
    .task-item[data-priority="Medium"] {
      border-left-color: color-mix(in srgb, var(--warning-color) 70%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--warning-color) 35%, var(--card-bg) 65%),
        color-mix(in srgb, var(--card-bg) 95%, transparent)
      );
    }
    .dark .task-item[data-priority="Medium"] {
      border-left-color: color-mix(in srgb, var(--warning-color) 80%, var(--card-bg) 20%);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--warning-color) 25%, var(--text-primary) 75%),
        color-mix(in srgb, var(--text-primary) 85%, transparent)
      );
    }
    .task-item[data-priority="Low"] {
      border-left-color: color-mix(in srgb, var(--success-color) 70%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--success-color) 35%, var(--card-bg) 65%),
        color-mix(in srgb, var(--card-bg) 95%, transparent)
      );
    }
    .dark .task-item[data-priority="Low"] {
      border-left-color: color-mix(in srgb, var(--success-color) 80%, var(--card-bg) 20%);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--success-color) 25%, var(--text-primary) 75%),
        color-mix(in srgb, var(--text-primary) 85%, transparent)
      );
    }
    .task-content {
      min-width: 0;
      text-align: left;
      flex: 1 1 auto;
    }
    .task-title,
    .task-meta,
    .task-notes {
      text-align: left;
    }
    .task-title {
      flex: 1 1 auto;
      min-width: 0;
      font-size: 0.95rem;
      font-weight: 600;
      line-height: 1.35;
      color: color-mix(in srgb, var(--text-primary) 95%, transparent);
      margin-bottom: 0.35rem;
    }
    .dark .task-title {
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);
    }
    .task-item:not([data-compact="true"]) .task-title strong {
      display: -webkit-box;
      overflow: hidden;
      text-overflow: ellipsis;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-clamp: 2;
      word-break: break-word;
    }
    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.8125rem;
      margin-top: 0.3rem;
    }
    .task-meta-text {
      color: color-mix(in srgb, var(--text-secondary) 85%, var(--text-primary) 15%);
      font-size: 0.8rem;
      line-height: 1.4;
      margin: 0;
    }
    .task-meta-text + .task-meta {
      margin-top: 0.25rem;
    }
    .dark .task-meta-text {
      color: color-mix(in srgb, var(--card-bg) 70%, var(--text-secondary) 30%);
    }
    .task-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      background: color-mix(in srgb, var(--border-color) 15%, transparent);
      color: color-mix(in srgb, var(--text-secondary) 90%, var(--text-primary) 10%);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      line-height: 1.3;
      border: 1px solid color-mix(in srgb, var(--border-color) 20%, transparent);
    }
    .dark .task-chip {
      background: color-mix(in srgb, var(--text-secondary) 30%, transparent);
      color: color-mix(in srgb, var(--card-bg) 90%, transparent);
      border-color: color-mix(in srgb, var(--text-secondary) 40%, transparent);
    }
    .task-chip[data-chip="priority"] {
      font-weight: 700;
      background: color-mix(in srgb, var(--primary-color) 12%, transparent);
      color: color-mix(in srgb, var(--primary-dark) 95%, transparent);
      border-color: color-mix(in srgb, var(--primary-color) 25%, transparent);
    }
    .dark .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--primary-color) 20%, transparent);
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);
      border-color: color-mix(in srgb, var(--primary-color) 30%, transparent);
    }
    .task-item[data-priority="High"] .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--secondary-color) 15%, transparent);
      color: color-mix(in srgb, var(--secondary-color) 95%, var(--text-primary) 5%);
      border-color: color-mix(in srgb, var(--secondary-color) 30%, transparent);
    }
    .dark .task-item[data-priority="High"] .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--secondary-color) 20%, transparent);
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);
      border-color: color-mix(in srgb, var(--secondary-color) 35%, transparent);
    }
    .task-item[data-priority="Medium"] .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--warning-color) 15%, transparent);
      color: color-mix(in srgb, var(--warning-color) 95%, var(--text-primary) 5%);
      border-color: color-mix(in srgb, var(--warning-color) 30%, transparent);
    }
    .dark .task-item[data-priority="Medium"] .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--warning-color) 20%, transparent);
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);
      border-color: color-mix(in srgb, var(--warning-color) 35%, transparent);
    }
    .task-item[data-priority="Low"] .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--success-color) 15%, transparent);
      color: color-mix(in srgb, var(--success-color) 95%, var(--text-primary) 5%);
      border-color: color-mix(in srgb, var(--success-color) 30%, transparent);
    }
    .dark .task-item[data-priority="Low"] .task-chip[data-chip="priority"] {
      background: color-mix(in srgb, var(--success-color) 20%, transparent);
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);
      border-color: color-mix(in srgb, var(--success-color) 35%, transparent);
    }
    .task-notes {
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid color-mix(in srgb, var(--border-color) 15%, transparent);
      font-size: 0.875rem;
      line-height: 1.5;
      color: color-mix(in srgb, var(--text-secondary) 85%, var(--text-primary) 15%);
    }
    .dark .task-notes {
      border-top-color: color-mix(in srgb, var(--text-secondary) 30%, transparent);
      color: color-mix(in srgb, var(--card-bg) 80%, transparent);
    }
    .task-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--reminder-card-gap);
      flex-wrap: wrap;
      margin-bottom: var(--reminder-card-gap);
    }
    .task-toolbar {
      display: inline-flex;
      gap: 0.375rem;
      align-items: center;
      flex-shrink: 0;
    }
    .task-toolbar-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.35rem 0.6rem;
      font-size: 0.75rem;
      font-weight: 600;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: color-mix(in srgb, var(--text-primary) 82%, transparent);
      transition: var(--transition);
      line-height: 1.2;
    }
    .task-toolbar-btn.cue-btn {
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      border: 1px solid transparent;
      color: color-mix(in srgb, var(--text-primary) 82%, transparent);
      line-height: 1.2;
    }
    .task-toolbar-btn:hover,
    .task-toolbar-btn:focus-visible {
      color: var(--text-primary);
      border-color: color-mix(in srgb, var(--primary-color) 35%, transparent);
      background: color-mix(in srgb, var(--primary-color) 12%, transparent);
    }
    .task-toolbar-btn .task-toolbar-label {
      display: inline-block;
    }
    #reminderList .task-toolbar-btn .task-toolbar-label {
      display: none;
    }
    .task-toolbar-btn.delete span[aria-hidden="true"] {
      font-size: 1.2rem;
      line-height: 1;
    }
    .dark .task-toolbar-btn {
      color: color-mix(in srgb, var(--card-bg) 92%, transparent);
      border-color: transparent;
    }
    .dark .task-toolbar-btn:hover,
    .dark .task-toolbar-btn:focus-visible {
      color: color-mix(in srgb, var(--card-bg) 100%, transparent);
      border-color: color-mix(in srgb, var(--primary-color) 35%, transparent);
      background: color-mix(in srgb, var(--primary-color) 20%, transparent);
    }
    /* Today-specific task styling - more prominent */
    .task-item[data-today="true"],
    .task-item.is-today {
      border-color: color-mix(in srgb, var(--primary-color) 45%, transparent);
      border-left-color: color-mix(in srgb, var(--primary-dark) 85%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--primary-color) 35%, var(--card-bg) 65%),
        color-mix(in srgb, var(--primary-color) 12%, var(--card-bg) 88%)
      );
      box-shadow: 0 4px 14px color-mix(in srgb, var(--primary-dark) 25%, transparent),
        0 2px 6px color-mix(in srgb, var(--primary-dark) 15%, transparent);
    }
    .dark .task-item[data-today="true"],
    .dark .task-item.is-today {
      border-color: color-mix(in srgb, var(--primary-color) 55%, transparent);
      border-left-color: color-mix(in srgb, var(--primary-color) 90%, var(--card-bg) 10%);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--primary-dark) 45%, var(--text-primary) 55%),
        color-mix(in srgb, var(--primary-dark) 30%, var(--text-primary) 70%)
      );
      box-shadow: 0 4px 14px color-mix(in srgb, var(--primary-dark) 40%, transparent),
        0 2px 6px color-mix(in srgb, var(--primary-dark) 25%, transparent);
    }

    /* Mobile-first optimizations */
    :root {
      --mobile-header-height: calc(45px / 4);
      --mobile-safe-area-top: env(safe-area-inset-top, 0px);
      --mobile-safe-area-bottom: env(safe-area-inset-bottom, 0px);
    }

    /* Enhanced mobile body */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.6;
      margin: 0;
      padding: 0;
      overscroll-behavior: contain;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: manipulation;
    }

    /* Mobile main container */
    main {
      padding-top: 0;
      padding-bottom: calc(32px + var(--mobile-safe-area-bottom));
      min-height: calc(100vh - var(--mobile-header-height));
      scroll-padding-top: calc(var(--mobile-header-height) + 16px);
    }

    /* Mobile task items */
    .task-item {
      margin-bottom: 16px;
      padding: 16px;
      border-radius: 12px;
      border-left-width: 3px;
      min-height: 80px;
      transition: var(--transition);
      transform: translateZ(0);
      display: flex;
      flex-direction: column;
    }

    .task-item:active {
      transform: scale(0.98);
    }

    /* Mobile cards */
    .card {
      border-radius: 16px;
      border: 1px solid color-mix(in srgb, var(--text-primary) 6%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--card-bg) 98%, transparent),
        color-mix(in srgb, var(--bg-color) 98%, transparent)
      );
      backdrop-filter: blur(8px);
    }

    .dark .card {
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--text-primary) 98%, transparent),
        color-mix(in srgb, var(--primary-dark) 40%, var(--text-primary) 60%)
      );
      border-color: color-mix(in srgb, var(--card-bg) 8%, transparent);
    }

    /* Mobile buttons */
    .btn {
      min-height: 44px;
      border-radius: 12px;
      font-weight: 600;
    }

    /* Responsive reminder grid - default grid layout */
    #reminderList {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
      align-content: start;
      width: 100%;
    }

    /* List view override */
    #reminderList.space-y-3 {
      display: block;
      gap: 0;
    }

    #reminderList.space-y-3 .task-item {
      margin-bottom: 0;
    }

    /* 2-column grid layout on wider screens */
    @media (min-width: 380px) {
      #reminderList.grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 4px;
      }
    }
    
    /* Ensure task items use full available width in grid */
    #reminderList .task-item {
      width: 100%;
      box-sizing: border-box;
      margin-left: 0;
      margin-right: 0;
      padding: 0.5rem 0.75rem;
    }
    
    /* Remove any inherited margins/padding that might constrain width */
    #reminderList > * {
      max-width: 100%;
      box-sizing: border-box;
    }

    /* Compact reminder card styling */
    .task-item[data-compact="true"] {
      margin-bottom: 0.5rem !important;
      padding: 0.6rem 0.85rem;
      min-height: 64px;
      border-left-width: 3px;
      border-radius: 0.75rem;
      gap: 0.4rem;
    }

    .task-item[data-compact="true"] .reminder-primary-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .task-item[data-compact="true"] .reminder-control-slot {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 2.25rem;
    }

    .task-item[data-compact="true"] .reminder-control-slot--empty {
      min-width: 1.5rem;
    }

    .task-item[data-compact="true"] .reminder-title-slot {
      flex: 1 1 auto;
      min-width: 0;
    }

    .task-item[data-compact="true"] .task-title {
      font-size: 0.95rem;
      line-height: 1.3;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .task-item[data-compact="true"] .task-title strong {
      font-weight: 600;
    }

    .task-item[data-compact="true"] .reminder-meta-slot {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.35rem;
      min-width: 0;
      font-size: 0.75rem;
      color: color-mix(in srgb, var(--text-secondary) 88%, transparent);
      text-align: right;
    }

    .task-item[data-compact="true"] .reminder-meta-slot--empty {
      display: none;
    }

    .dark .task-item[data-compact="true"] .reminder-meta-slot {
      color: color-mix(in srgb, var(--card-bg) 78%, transparent);
    }

    .task-item[data-compact="true"] .reminder-due {
      display: inline-block;
      font-size: 0.75rem;
      line-height: 1.2;
      max-width: 10.5rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .task-item[data-compact="true"] .priority-chip-dot {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0;
      background: transparent;
      border: 0;
      font-size: 0.68rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: color-mix(in srgb, var(--text-secondary) 85%, transparent);
      text-transform: uppercase;
    }

    .task-item[data-compact="true"] .priority-chip-dot::before {
      content: '';
      width: 0.45rem;
      height: 0.45rem;
      border-radius: 9999px;
      background: currentColor;
    }

    .priority-chip-dot.priority-high::before {
      background: var(--priority-high-border, #F4A259);
    }

    .priority-chip-dot.priority-medium::before {
      background: var(--priority-medium-border, #6C8AE4);
    }

    .priority-chip-dot.priority-low::before {
      background: var(--priority-low-border, #6B8F71);
    }

    .dark .priority-chip-dot {
      color: color-mix(in srgb, var(--card-bg) 90%, transparent);
    }

    .task-item[data-compact="true"] .reminder-secondary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
      font-size: 0.75rem;
      color: color-mix(in srgb, var(--text-secondary) 85%, var(--text-primary) 15%);
    }

    .dark .task-item[data-compact="true"] .reminder-secondary-row {
      color: color-mix(in srgb, var(--card-bg) 75%, transparent);
    }

    .task-item[data-compact="true"] .reminder-secondary-row .task-meta-text {
      font-size: inherit;
      color: inherit;
      margin-right: 0.25rem;
    }

    .task-item[data-compact="true"] .reminder-secondary-row .task-chip:not(.priority-chip-dot) {
      padding: 0.2rem 0.45rem;
      font-size: 0.68rem;
      border-radius: 9999px;
    }

    .task-item[data-compact="true"] .reminder-secondary-row .task-toolbar {
      margin-left: auto;
      display: inline-flex;
      gap: 0.35rem;
      align-items: center;
    }

    .task-item[data-compact="true"] .reminder-secondary-row .task-toolbar-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 2.5rem;
      min-height: 2.5rem;
      padding: 0;
      border-radius: 9999px;
      border: 1px solid color-mix(in srgb, var(--border-color) 35%, transparent);
      background: transparent;
      color: color-mix(in srgb, var(--text-secondary) 90%, transparent);
      font-size: 1rem;
    }

    .dark .task-item[data-compact="true"] .reminder-secondary-row .task-toolbar-btn {
      border-color: color-mix(in srgb, var(--text-secondary) 45%, transparent);
      color: color-mix(in srgb, var(--card-bg) 90%, transparent);
    }

    .task-item[data-compact="true"] .reminder-secondary-row .task-toolbar-btn .task-toolbar-label {
      display: none;
    }

    .task-item[data-compact="true"] .reminder-secondary-row .task-toolbar-btn:hover,
    .task-item[data-compact="true"] .reminder-secondary-row .task-toolbar-btn:focus-visible {
      color: var(--text-primary);
      border-color: color-mix(in srgb, var(--primary-color) 35%, transparent);
      background: color-mix(in srgb, var(--primary-color) 14%, transparent);
    }

    .task-item[data-compact="true"] .task-notes {
      flex-basis: 100%;
      margin: 0;
      margin-top: 0.25rem;
      padding-top: 0.35rem;
      border-top: 1px solid color-mix(in srgb, var(--border-color) 20%, transparent);
      font-size: 0.8rem;
      line-height: 1.4;
    }

    .dark .task-item[data-compact="true"] .task-notes {
      border-top-color: color-mix(in srgb, var(--text-secondary) 35%, transparent);
    }

  </style>
  <!-- Skip-link CSS: fully hidden until keyboard focus -->
  <style id="skip-link-css">
    .skip-link {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus-visible {
      left: 16px;
      top: 16px;
      width: auto;
      height: auto;
      overflow: visible;
      z-index: 50;
      border-radius: 9999px;
      padding: 8px 12px;
      background: var(--fallback-p, var(--primary-color));
      color: var(--fallback-pc, var(--card-bg));
      box-shadow: var(--shadow-sm);
    }

    /* --- Reminder list: Ocean Blue Professional card styling --- */

    #reminderList .task-item,
    #reminderList .task-card,
    #reminderList .card,
    #reminderList .card-body,
    #reminderList .task-grid {
      background: transparent;
      border: none;
      border-radius: 0;
      box-shadow: none;
      margin: 0;
      padding: 0;
    }

    .cue-item,
    #reminderList [data-reminder] {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      align-items: start;
      gap: var(--reminder-card-gap);
      padding: var(--reminder-card-padding-y) var(--reminder-card-padding-x);
      margin-bottom: var(--reminder-card-gap);
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      box-shadow: 0 1px 3px var(--shadow-color);
      transition: all 0.2s ease;
      font-size: var(--reminder-card-font-size);
      line-height: 1.4;
    }

    .cue-item:last-child,
    #reminderList [data-reminder]:last-child {
      margin-bottom: 0;
    }

    .cue-item:hover,
    #reminderList [data-reminder]:hover {
      box-shadow: 0 4px 12px var(--shadow-color);
      transform: translateY(-2px);
      border-color: var(--accent-color);
      background: var(--hover-bg);
    }

    .dark .cue-item,
    .dark #reminderList [data-reminder] {
      background: color-mix(in srgb, rgba(15, 23, 42, 0.92) 85%, var(--card-bg) 15%);
      border-color: color-mix(in srgb, var(--card-border) 45%, transparent);
      box-shadow: none;
    }

    .dark .cue-item:hover,
    .dark #reminderList [data-reminder]:hover {
      background: color-mix(in srgb, rgba(30, 41, 59, 0.95) 75%, var(--accent-color) 25%);
    }

    .cue-item[data-priority="High"],
    #reminderList [data-reminder][data-priority="High"] {
      border-left: 3px solid var(--priority-high-border);
      background: var(--priority-high-bg);
      padding-left: calc(var(--reminder-card-padding-x) - 1.5px);
    }

    .cue-item[data-priority="Medium"],
    #reminderList [data-reminder][data-priority="Medium"] {
      border-left: 3px solid var(--priority-medium-border);
      background: var(--priority-medium-bg);
      padding-left: calc(var(--reminder-card-padding-x) - 1.5px);
    }

    .cue-item[data-priority="Low"],
    #reminderList [data-reminder][data-priority="Low"] {
      border-left: 3px solid var(--priority-low-border);
      background: var(--priority-low-bg);
      padding-left: calc(var(--reminder-card-padding-x) - 1.5px);
    }

    .dark .cue-item[data-priority="High"],
    .dark #reminderList [data-reminder][data-priority="High"] {
      background: color-mix(in srgb, var(--priority-high-border) 28%, rgba(15, 23, 42, 0.92) 72%);
      border-left-color: color-mix(in srgb, var(--priority-high-border) 80%, transparent);
    }

    .dark .cue-item[data-priority="Medium"],
    .dark #reminderList [data-reminder][data-priority="Medium"] {
      background: color-mix(in srgb, var(--priority-medium-border) 26%, rgba(15, 23, 42, 0.92) 74%);
      border-left-color: color-mix(in srgb, var(--priority-medium-border) 80%, transparent);
    }

    .dark .cue-item[data-priority="Low"],
    .dark #reminderList [data-reminder][data-priority="Low"] {
      background: color-mix(in srgb, var(--priority-low-border) 26%, rgba(15, 23, 42, 0.92) 74%);
      border-left-color: color-mix(in srgb, var(--priority-low-border) 80%, transparent);
    }

    .cue-name,
    #reminderList [data-reminder] h3,
    #reminderList [data-reminder] h4,
    #reminderList [data-reminder] strong,
    #reminderList [data-reminder] [data-reminder-title] {
      margin: 0;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      grid-column: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-clamp: 2;
    }

    .cue-meta,
    #reminderList [data-reminder] time,
    #reminderList [data-reminder] .reminder-meta {
      color: var(--text-secondary);
      font-size: 0.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--reminder-card-gap);
      margin-top: 0.75rem;
      grid-column: 1 / -1;
    }

    #reminderList [data-reminder] time {
      justify-content: flex-end;
      text-align: right;
    }

    .cue-content,
    #reminderList [data-reminder] p,
    #reminderList [data-reminder] .description,
    #reminderList [data-reminder] .details {
      color: var(--text-secondary);
    }

    .cue-actions,
    #reminderList [data-reminder] .card-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      align-items: center;
      grid-column: 1 / -1;
      margin-top: 12px;
    }

    .cue-btn,
    #reminderList [data-reminder] .card-actions button,
    #reminderList [data-reminder] button {
      color: var(--text-secondary);
      background: transparent;
      border: none;
      padding: 6px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 16px;
      line-height: 1;
    }

    .cue-btn:hover,
    #reminderList [data-reminder] .card-actions button:hover,
    #reminderList [data-reminder] button:hover {
      color: var(--accent-color);
      background: rgba(14, 165, 233, 0.1);
    }

    .cue-btn.delete:hover,
    #reminderList [data-reminder] .card-actions .delete:hover,
    #reminderList [data-reminder] button.delete:hover,
    #reminderList [data-reminder] button[data-action="delete"]:hover {
      color: var(--delete-color);
      background: rgba(239, 68, 68, 0.1);
    }

    .cue-audio,
    #reminderList [data-reminder] audio {
      width: 100%;
      margin-top: 12px;
      border-radius: 8px;
      display: block;
    }

    .cue-item audio::-webkit-media-controls-panel,
    #reminderList [data-reminder] audio::-webkit-media-controls-panel {
      background-color: var(--hover-bg);
    }
  </style>
  <!-- BEGIN GPT CHANGE: bottom sheet styles -->
  <style>
    :root {
      --vh: 1vh;
    }

    body,
    .min-h-screen {
      min-height: calc(var(--vh, 1vh) * 100);
    }

    .hidden {
      display: none !important;
    }
    .sheet {
      position: fixed;
      inset: 0;
      min-height: calc(var(--vh, 1vh) * 100);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      z-index: 90;
    }
    .sheet-panel {
      position: relative;
      left: 0;
      right: 0;
      bottom: 0;
      max-height: calc(var(--vh, 1vh) * 85);
      overflow: auto;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      background: var(--fallback-b1, var(--card-bg));
      color: inherit;
      box-shadow: 0 -16px 32px color-mix(in srgb, var(--text-primary) 25%, transparent);
      padding: 16px;
    }
    .dark .sheet-panel {
      background: color-mix(in srgb, var(--text-primary) 97%, transparent);
    }
    .sheet-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 12px;
      gap: 12px;
    }
    .sheet-header-actions {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .sheet-header-actions .btn.is-listening {
      background: var(--fallback-p, var(--primary-color));
      color: var(--fallback-pc, var(--card-bg));
    }
    .sheet-backdrop {
      position: absolute;
      inset: 0;
      background: color-mix(in srgb, var(--text-primary) 45%, transparent);
    }
    #settingsModal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 80;
    }
    .modal-panel {
      position: relative;
      max-width: 420px;
      width: calc(100% - 32px);
      background: var(--fallback-b1, var(--card-bg));
      color: inherit;
      border-radius: 16px;
      box-shadow: 0 20px 40px color-mix(in srgb, var(--text-primary) 30%, transparent);
      overflow: hidden;
    }
    .dark .modal-panel {
      background: color-mix(in srgb, var(--text-primary) 97%, transparent);
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid color-mix(in srgb, var(--border-color) 30%, transparent);
    }
    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: color-mix(in srgb, var(--text-primary) 55%, transparent);
    }
  </style>
  <style id="add-task-stability-css">
    /* Make sure modal/sheet stays interactive and above other layers */
    [data-add-task-dialog] {
      position: fixed;
      inset: 0;
      z-index: 60;
    }
    [data-add-task-dialog] [data-dialog-content] {
      position: relative;
      z-index: 61;
      pointer-events: auto;
    }
    /* Backdrop element (if you have one) should sit under content but accept clicks */
    [data-add-task-dialog] .backdrop {
      position: absolute;
      inset: 0;
      z-index: 59;
    }
  </style>
  <!-- END GPT CHANGE: bottom sheet styles -->
  <!-- BEGIN GPT CHANGE: rhythm -->
  <style>
    .card-body.compact {
      gap: 0.5rem;
    }
    .inputs-compact input,
    .inputs-compact select,
    .inputs-compact textarea,
    .inputs-compact button {
      padding-top: 8px;
      padding-bottom: 8px;
    }
    main {
      padding-bottom: 96px;
    }
    .chip-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .chip-row label {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 6px 12px;
      border-radius: 9999px;
      border: 1px solid color-mix(in srgb, var(--border-color) 60%, transparent);
      cursor: pointer;
      font-size: 0.875rem;
    }
    .chip-row input[type='radio'] {
      accent-color: currentColor;
    }
    .voice-add-wrap {
      display: none !important;
    }
    .focus-list,
    .focus-detail {
      display: none !important;
    }
    #toggleUiBtn {
      display: none !important;
    }
  </style>
  <!-- END GPT CHANGE: rhythm -->
  <style id="min-expand-css">
    /* Expand/collapse behavior */
    .task-row-min {
      cursor: pointer;
      outline: none;
    }
    .task-row-min:focus {
      box-shadow: inset 0 0 0 2px color-mix(in srgb, var(--text-primary) 15%, transparent);
    }
    .task-row-min .min-notes {
      display: none;
      grid-column: 1 / -1;
      margin-top: 8px;
      font-size: 14px;
      line-height: 1.35;
      opacity: .95;
      white-space: pre-wrap;
    }
    .task-row-min.expanded .min-notes {
      display: block;
    }
    /* Slightly larger title when expanded */
    .task-row-min.expanded .title {
      font-weight: 600;
    }
    /* Optional small chevron indicator */
    .task-row-min::after {
      content: "";
      justify-self: end;
      opacity: .5;
      font-size: 12px;
    }
    .task-row-min.expanded::after { transform: rotate(180deg); }

  </style>
  <style id="empty-state-compact-css">
    #emptyState {
      text-align: left;
    }
    #emptyState .empty-state-compact {
      display: grid;
      gap: 0.75rem;
      justify-items: start;
      text-align: left;
      width: 100%;
    }
    #emptyState .empty-state-compact h3 {
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.4;
      color: var(--text-primary);
    }
    #emptyState .empty-state-compact p {
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text-secondary);
    }
    .dark #emptyState .empty-state-compact p {
      color: color-mix(in srgb, var(--card-bg) 85%, transparent);
    }
    #emptyState .empty-state-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      width: 100%;
    }
    #emptyState .empty-state-actions > * {
      flex: 1 1 auto;
    }
  </style>
</head>
<body class="min-h-screen bg-base-200 text-base-content show-full mobile-theme">
  <a class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-50 focus:rounded-full focus:bg-primary focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-primary-content" href="#main">Skip to main content</a>

  <!-- Clean Mobile Header -->
  <style id="mobile-header-compact" aria-hidden="true">
  :root {
    --mobile-header-height: calc(45px / 4);
  }

  /* Make header visually compact while preserving touch targets and accessibility */
  .mc-header {
    padding-top: calc(env(safe-area-inset-top, 0px) + 8px);
    padding-bottom: 6px;
    padding-left: 12px;
    padding-right: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    border-bottom: 1px solid color-mix(in srgb, var(--text-primary) 6%, transparent);
    background: color-mix(in srgb, var(--card-bg) 85%, transparent);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
  }

  .dark .mc-header {
    border-bottom-color: color-mix(in srgb, var(--card-bg) 8%, transparent);
    background: color-mix(in srgb, var(--text-primary) 85%, transparent);
  }

  .mc-header-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    order: 0;
  }

  .mc-header-meta {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Branding: very small */
  .mc-brand {
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0;
  }
  .mc-brand .logo {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.95rem;
  }
  .mc-brand .title {
    font-size: 0.95rem;
    font-weight: 600;
    margin-left: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: none; /* hide textual title on narrow screens; keeps brands minimal */
  }

  /* Status indicator is tiny and condensed */
  #mcStatus {
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 9999px;
    display: inline-block;
    margin: 0;
    vertical-align: middle;
    box-shadow: none;
  }
  #mcStatus.sync-inline {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    padding: 0 6px;
    border-radius: 9999px;
    background: color-mix(in srgb, var(--text-primary) 4%, transparent);
  }
  .dark #mcStatus.sync-inline {
    background: color-mix(in srgb, var(--text-secondary) 18%, transparent);
  }
  /* keep the verbose status text accessible but visually hidden */
  #mcStatusText {
    position: static !important;
    width: auto;
    height: auto;
    padding: 0;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: nowrap;
    border: 0;
  }

  /* Smaller circular buttons */
  .mc-btn {
    width: 36px;
    height: 36px;
    min-width: 36px;
    min-height: 36px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 1.05rem;
  }
  .mc-btn.icon-only { padding: 0.125rem; }

  /* Overflow menu anchor spacing */
  .mc-actions { display: flex; gap: 6px; align-items: center; }

  /* Reduce hit area bloat visually but keep target size via padding if needed for a11y */
  .mc-header .mc-btn { padding: 0; }

  .mc-add-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 0.625rem 1rem;
    border-radius: 14px;
    font-size: 0.875rem;
    font-weight: 700;
    line-height: 1.2;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: var(--card-bg);
    border: none;
    box-shadow: 0 4px 12px color-mix(in srgb, var(--primary-dark) 35%, transparent),
      0 2px 6px color-mix(in srgb, var(--primary-dark) 20%, transparent);
    transition: var(--transition);
    white-space: nowrap;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    letter-spacing: 0.01em;
  }

  .mc-add-btn::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, color-mix(in srgb, var(--card-bg) 20%, transparent) 0%,
        transparent 100%);
    opacity: 0;
    transition: opacity 0.2s ease;
    pointer-events: none;
  }

  .mc-add-btn:hover {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-dark) 45%, transparent),
      0 4px 10px color-mix(in srgb, var(--primary-dark) 25%, transparent);
    transform: translateY(-2px) scale(1.02);
  }

  .mc-add-btn:hover::before {
    opacity: 1;
  }

  .mc-add-btn:active {
    transform: translateY(0) scale(0.98);
    box-shadow: 0 2px 8px color-mix(in srgb, var(--primary-dark) 30%, transparent),
      0 1px 4px color-mix(in srgb, var(--primary-dark) 20%, transparent);
  }

  .mc-add-btn:focus-visible {
    outline: 3px solid color-mix(in srgb, var(--primary-color) 50%, transparent);
    outline-offset: 2px;
    box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-dark) 45%, transparent),
      0 4px 10px color-mix(in srgb, var(--primary-dark) 25%, transparent),
      0 0 0 4px color-mix(in srgb, var(--primary-color) 20%, transparent);
  }

  .mc-add-btn__hint {
    font-size: 1.125rem;
    opacity: 0.95;
    font-weight: 600;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    background: color-mix(in srgb, var(--card-bg) 20%, transparent);
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .mc-add-btn:hover .mc-add-btn__hint {
    background: color-mix(in srgb, var(--card-bg) 30%, transparent);
    transform: rotate(90deg);
  }

  @media (prefers-reduced-motion: reduce) {
    .mc-add-btn {
      transition: background-color 0.1s ease, box-shadow 0.1s ease;
    }
    
    .mc-add-btn:hover {
      transform: none;
    }
    
    .mc-add-btn:active {
      transform: none;
    }
    
    .mc-add-btn__hint {
      transition: background-color 0.1s ease;
    }
    
    .mc-add-btn:hover .mc-add-btn__hint {
      transform: none;
    }
  }

  .dark .mc-add-btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: var(--card-bg);
    box-shadow: 0 4px 12px color-mix(in srgb, var(--primary-dark) 40%, transparent),
      0 2px 6px color-mix(in srgb, var(--primary-dark) 25%, transparent);
  }

  .dark .mc-add-btn:hover {
    background: linear-gradient(135deg, color-mix(in srgb, var(--primary-color) 80%, var(--card-bg) 20%) 0%,
        var(--primary-dark) 100%);
    box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-dark) 50%, transparent),
      0 4px 10px color-mix(in srgb, var(--primary-dark) 30%, transparent);
  }

  .dark .mc-add-btn:active {
    box-shadow: 0 2px 8px color-mix(in srgb, var(--primary-dark) 35%, transparent),
      0 1px 4px color-mix(in srgb, var(--primary-dark) 20%, transparent);
  }

  /* Improve Add Reminder button visibility */
  .mc-add-btn {
    padding: 0.25rem 0.75rem !important;
    border-radius: 999px !important;
  }

  /* Prevent circle constraint on generic add button */
  .mc-add-btn {
    width: auto !important;
    height: auto !important;
  }

  .mc-add-btn-wide {
    padding: 0.35rem 0.85rem !important;
    border-radius: 999px !important;
    font-size: 0.9rem !important;
    line-height: 1.2 !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    white-space: nowrap !important;
    max-width: 100% !important;
  }

  /* Ensure Add Reminder button can expand horizontally */
  .mc-add-btn-wide {
    width: auto !important;
    height: auto !important;
    padding: 0.35rem 0.9rem !important;
    border-radius: 999px !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    white-space: nowrap !important;
  }

  /* On slightly larger phones show small text label next to logo (optional) */
  @media (min-width: 420px) {
    .mc-brand .title { display: inline; font-size: 0.95rem; }
  }
  </style>

  <!-- Header layout fix -->
  <style>
    /* Make the header a proper top bar */
    header.sticky {
      position: sticky;
      top: 0;
      z-index: 20;
      background-color: color-mix(in srgb, var(--text-primary) 90%, transparent); /* dark background */
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);            /* light text */
      box-shadow: 0 1px 4px color-mix(in srgb, var(--text-primary) 70%, transparent);
      min-height: var(--mobile-header-height);
      padding-block: 0;
    }

    /* Inner container: single row, spaced out */
    header.sticky .mx-auto {
      max-width: 28rem;          /* similar to max-w-md */
      margin-left: auto;
      margin-right: auto;
      padding: 0 0.75rem;
      min-height: var(--mobile-header-height);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    /* Centre title */
    header.sticky h1 {
      margin: 0;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-align: center;
      flex: 1;
    }

    /* Round icon buttons */
    header.sticky button {
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 999px;
      border: none;
      background-color: color-mix(in srgb, var(--text-primary) 80%, transparent);
      color: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      cursor: pointer;
    }

    header.sticky .mc-add-btn {
      padding-block: 0.15rem !important;
    }

    header.sticky .header-action-group {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    header.sticky button span {
      font-size: 1.2rem;
      line-height: 1;
    }

    header.sticky button:active {
      transform: scale(0.95);
      background-color: color-mix(in srgb, var(--primary-dark) 90%, transparent);
    }

    .mc-quick-add-bar {
      /* No longer sticky  just part of the normal flow under the header */
      position: static;
      background: transparent;
      border-bottom: none;
      backdrop-filter: none;
      margin: 0.25rem 0 0.25rem;
    }

    .mc-quick-add-inner {
      max-width: 28rem;
      margin: 0 auto;
      padding: 0.25rem 0.75rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .mc-quick-status {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.7rem;
      color: color-mix(in srgb, var(--text-primary, rgba(15, 23, 42, 0.88)) 85%, rgba(15, 23, 42, 0.9));
    }

    .dark .mc-quick-status {
      color: color-mix(in srgb, rgba(226, 232, 240, 0.92) 90%, transparent);
    }

    .mc-sync-message {
      margin: 0;
      display: inline-flex;
      align-items: center;
      white-space: nowrap;
    }

    .mc-status-text {
      white-space: nowrap;
    }

    .mc-quick-status .sync-dot {
      width: 0.5rem;
      height: 0.5rem;
    }

    .mc-quick-more {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      position: relative;
    }

    .mc-quick-menu-btn {
      border-radius: 999px;
      padding: 0.375rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .mc-quick-add-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
      min-width: 0;
    }

    .mc-quick-actions {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      align-items: center;
      flex-shrink: 0;
    }

    .mc-quick-input {
      flex: 1;
      min-width: 0;
      padding: 0.4rem 0.65rem;
      border-radius: 999px;
      border: 1px solid color-mix(in srgb, var(--border-color) 50%, transparent);
      background-color: color-mix(in srgb, var(--text-primary) 35%, transparent);
      color: inherit;
      font-size: 0.8rem;
    }

    .mc-quick-input::placeholder {
      color: color-mix(in srgb, var(--text-secondary) 80%, transparent);
    }

    .mc-quick-submit,
    .mc-quick-voice {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 2.1rem;
      min-height: 2.1rem;
      border-radius: 999px;
      border: none;
      background: color-mix(in srgb, var(--primary-color) 85%, transparent);
      color: var(--card-bg);
      font-size: 0.8rem;
      font-weight: 500;
      padding: 0 0.75rem;
      cursor: pointer;
    }

    .mc-quick-submit {
      padding-inline: 0.9rem;
    }

    .mc-quick-voice {
      background: color-mix(in srgb, var(--text-secondary) 35%, transparent);
      color: color-mix(in srgb, var(--card-bg) 95%, transparent);
      padding-inline: 0.6rem;
      font-size: 1rem;
    }

    .mc-quick-voice.is-listening {
      background: color-mix(in srgb, var(--primary-color) 95%, transparent);
      color: var(--card-bg);
    }

    @media (max-width: 420px) {
      .mc-quick-add-inner {
        gap: 0.5rem;
      }

      .mc-quick-add-row {
        gap: 0.4rem;
      }

      .mc-quick-actions {
        gap: 0.3rem;
      }

      .mc-quick-submit {
        padding-inline: 0.7rem;
      }
    }
  </style>

  <header class="sticky top-0 z-20 text-black shadow-md" style="background-color: #2f2a33;">
    <div class="mx-auto max-w-md px-3 py-0 flex items-center justify-between gap-2">
      <!-- Left: Home button -->
      <button
        id="btn-open-drawer"
        type="button"
        class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-slate-800/80 hover:bg-slate-700 active:scale-95 transition"
        aria-label="Open navigation menu"
        aria-controls="mobile-drawer"
        aria-expanded="false"
      >
        <span class="text-xl leading-none"></span>
      </button>

      <!-- Centre: Title -->
      <button
        id="addReminderBtn"
        type="button"
        class="mc-add-btn mc-add-btn-wide"
        data-open-add-task
      >
        <span class="mc-add-btn-icon" aria-hidden="true"></span>
        <span class="mc-add-btn-label">Add reminder</span>
      </button>

      <!-- Right: Settings button with quick menu -->
      <div class="relative">
        <button
          id="overflowMenuBtn"
          type="button"
          class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-slate-800/80 hover:bg-slate-700 active:scale-95 transition"
          aria-label="Open menu"
          aria-haspopup="menu"
          aria-controls="overflowMenu"
          aria-expanded="false"
        >
          <span class="text-xl leading-none"></span>
        </button>

        <div
          id="overflowMenu"
          class="hidden quick-actions-panel absolute right-0 mt-2"
          role="menu"
          aria-hidden="true"
          aria-labelledby="overflowMenuHeading"
        >
          <h2 id="overflowMenuHeading" class="sr-only">Quick settings</h2>
          <ul class="quick-actions" role="presentation">
            <li role="none">
              <button
                id="voiceAddBtn"
                type="button"
                class="quick-action-btn"
                title="Dictate reminder"
                role="menuitem"
              >
                <span class="quick-action-icon" aria-hidden="true"></span>
                <span class="sr-only">Dictate reminder</span>
              </button>
            </li>
            <li role="none">
              <button
                id="viewToggleMenu"
                type="button"
                class="quick-action-btn"
                title="Toggle layout"
                role="menuitem"
              >
                <span class="quick-action-icon" aria-hidden="true"></span>
                <span id="viewToggleLabel" class="sr-only">View layout: Full</span>
              </button>
            </li>
            <li role="none">
              <button
                id="openSettings"
                type="button"
                class="quick-action-btn"
                data-open="settings"
                title="Open settings"
                role="menuitem"
              >
                <span class="quick-action-icon" aria-hidden="true"></span>
                <span class="sr-only">Open settings</span>
              </button>
            </li>
            <li role="none">
              <button
                id="themeToggle"
                type="button"
                class="quick-action-btn"
                title="Toggle theme"
                role="menuitem"
              >
                <span class="quick-action-icon" aria-hidden="true"></span>
                <span class="sr-only">Toggle theme</span>
              </button>
            </li>
            <li role="none">
              <button
                id="googleSignInBtn"
                type="button"
                class="quick-action-btn"
                title="Sign in"
                role="menuitem"
              >
                <span class="quick-action-icon" aria-hidden="true"></span>
                <span class="sr-only">Sign in</span>
              </button>
            </li>
            <li role="none">
              <button
                id="googleSignOutBtn"
                type="button"
                class="quick-action-btn hidden"
                title="Sign out"
                role="menuitem"
              >
                <span class="quick-action-icon" aria-hidden="true"></span>
                <span class="sr-only">Sign out</span>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <section id="quickAddBar" class="mc-quick-add-bar" aria-label="Quick add reminder">
    <div class="mc-quick-add-inner">
      <!-- Left: Sync status -->
      <div class="mc-quick-status">
        <div id="syncStatus" class="sync-inline" data-state="offline" title="Sync status">
          <span id="mcStatus" class="sync-dot offline" role="status" aria-hidden="true"></span>
        </div>
        <p id="sync-status" class="mc-sync-message"></p>
        <span id="mcStatusText" class="mc-status-text">Offline</span>
      </div>

      <!-- Right: Quick add row -->
      <div class="mc-quick-add-row">
        <input
          id="quickAddInput"
          class="mc-quick-input"
          type="text"
          autocomplete="off"
          placeholder="Quick reminder"
        />
        <button
          id="quickAddSubmit"
          type="button"
          class="mc-quick-submit"
          aria-label="Add reminder"
        >
          Add
        </button>
        <div class="mc-quick-actions">
          <button
            id="quickAddVoice"
            type="button"
            class="mc-quick-voice"
            aria-label="Use voice to add reminder"
          ></button>
        </div>
      </div>
    </div>
  </section>

  <div
    id="mobile-drawer-scrim"
    class="fixed inset-0 z-30 bg-neutral-900/40 opacity-0 transition-opacity duration-200 pointer-events-none"
  ></div>
  <!-- Mobile navigation drawer - positioned fixed to avoid taking layout space -->
  <aside
    id="mobile-drawer"
    class="fixed inset-y-0 left-0 z-40 flex w-72 max-w-full -translate-x-full transform flex-col border-r border-neutral-200 bg-white/90 px-4 pb-6 pt-6 font-medium text-neutral-900 shadow-xl transition-transform duration-200 ease-out backdrop-blur dark:border-neutral-800 dark:bg-neutral-900/85 dark:text-neutral-100"
    inert
    tabindex="-1"
    style="position: fixed; padding-top: calc(env(safe-area-inset-top, 0px) + 1rem)"
  >
    <div class="mb-6 flex items-center justify-between">
           <button
        type="button"
        class="rounded-xl p-2 text-neutral-500 hover:bg-neutral-100 hover:text-neutral-900 dark:text-neutral-400 dark:hover:bg-neutral-800"
        aria-label="Close menu"
        data-close-drawer
      >
        <svg viewBox="0 0 24 24" class="size-5" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 6l12 12M6 18 18 6" />
        </svg>
      </button>
    </div>
    
    </div>
  </aside>

  <script>
    (function () {
      const drawerBtn = document.getElementById('btn-open-drawer');
      const drawer = document.getElementById('mobile-drawer');
      const scrim = document.getElementById('mobile-drawer-scrim');
      const scrollTopBtn = document.getElementById('btn-scroll-top');
      const quickAddBtn = document.getElementById('addReminderBtn');
      const searchBtn = document.getElementById('btn-search');
      const themeBtn = document.getElementById('btn-theme');
      const drawerSyncStatus = document.getElementById('drawerSyncStatus');
      const headerSyncStatus = document.getElementById('mcStatusText');
      const headerSyncDot = document.getElementById('mcStatus');
      const drawerSyncDot = drawer?.querySelector('.sync-dot');

      const toggleClass = (el, className, force) => {
        if (!el) return;
        if (typeof force === 'boolean') {
          el.classList.toggle(className, force);
        } else {
          el.classList.toggle(className);
        }
      };

      const setDrawerState = (open) => {
        if (!drawer) return;
        const isOpen = drawer.classList.contains('translate-x-0');
        const nextState = typeof open === 'boolean' ? open : !isOpen;
        if (nextState === isOpen) return;

        if (nextState) {
          drawer.inert = false;
          drawer.classList.add('translate-x-0');
          drawerBtn?.setAttribute('aria-expanded', 'true');
          if (scrim) {
            scrim.classList.remove('pointer-events-none');
            scrim.classList.remove('opacity-0');
            scrim.classList.add('opacity-100');
          }
          document.body.classList.add('overflow-hidden');
          if (!drawer.hasAttribute('data-focus-bound')) {
            drawer.setAttribute('data-focus-bound', 'true');
            drawer.focus({ preventScroll: true });
          } else {
            try {
              drawer.focus({ preventScroll: true });
            } catch {
              drawer.focus();
            }
          }
        } else {
          drawer.classList.remove('translate-x-0');
          drawerBtn?.setAttribute('aria-expanded', 'false');
          if (scrim) {
            scrim.classList.add('opacity-0');
            scrim.classList.add('pointer-events-none');
            scrim.classList.remove('opacity-100');
          }
          document.body.classList.remove('overflow-hidden');
          drawer.removeAttribute('data-focus-bound');
          if (drawerBtn instanceof HTMLElement) {
            try {
              drawerBtn.focus({ preventScroll: true });
            } catch {
              drawerBtn.focus();
            }
          }
          drawer.inert = true;
        }
      };

      drawerBtn?.addEventListener('click', () => setDrawerState());
      scrim?.addEventListener('click', () => setDrawerState(false));
      drawer?.addEventListener('click', (event) => {
        if (event.target instanceof Element && event.target.closest('[data-close-drawer]')) {
          setDrawerState(false);
        }
      });
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          setDrawerState(false);
        }
      });

      scrollTopBtn?.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      quickAddBtn?.addEventListener('click', () => {
        const tryCall = (fn) => {
          try {
            return typeof fn === 'function' ? fn() : undefined;
          } catch (error) {
            console.warn('Quick add hook failed', error);
            return undefined;
          }
        };
        const result =
          tryCall(window.quickAdd) ??
          tryCall(window.openAddModal) ??
          (function () {
            const fallback = document.querySelector('[data-open-add-task]') || document.getElementById('addReminderBtn');
            if (fallback instanceof HTMLElement) {
              fallback.click();
              return true;
            }
            return document.getElementById('quickAddInput')?.focus();
          })();
        return result;
      });

      searchBtn?.addEventListener('click', () => {
        const el = document.getElementById('search') || document.querySelector('input[type="search"]');
        if (el instanceof HTMLElement) {
          el.scrollIntoView({ block: 'center', behavior: 'smooth' });
          try {
            el.focus({ preventScroll: true });
          } catch {
            el.focus();
          }
        }
      });

      const THEME_STORAGE_KEY = 'theme';
      const root = document.documentElement;

      const applyTheme = (nextTheme) => {
        const next = nextTheme === 'dark' ? 'dark' : 'light';
        root.setAttribute('data-theme', next);
        root.classList.toggle('dark', next === 'dark');
        try {
          localStorage.setItem(THEME_STORAGE_KEY, next);
        } catch {
          /* storage might be unavailable */
        }
        toggleClass(document.getElementById('icon-sun'), 'hidden', next === 'dark');
        toggleClass(document.getElementById('icon-moon'), 'hidden', next !== 'dark');
      };

      const toggleTheme = () => {
        const current = root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
        applyTheme(current === 'dark' ? 'light' : 'dark');
      };

      themeBtn?.addEventListener('click', toggleTheme);

      window.__mcApplyTheme = applyTheme;
      window.__mcToggleTheme = toggleTheme;

      (function initTheme() {
        let saved = null;
        try {
          saved = localStorage.getItem(THEME_STORAGE_KEY);
        } catch {
          saved = null;
        }
        if (!saved) {
          saved = root.getAttribute('data-theme');
        }
        if (saved) {
          applyTheme(saved);
        }
      })();

      document.addEventListener('cue:sync-status', (event) => {
        const detail = event?.detail;
        if (!detail) return;
        if (typeof detail.message === 'string' && drawerSyncStatus) {
          drawerSyncStatus.textContent = detail.message;
        }
        if (typeof detail.state === 'string' && drawerSyncDot) {
          const isOnline = detail.state !== 'offline' && detail.state !== 'error';
          drawerSyncDot.classList.toggle('online', isOnline);
          drawerSyncDot.classList.toggle('offline', !isOnline);
        }
      });

      if (typeof MutationObserver === 'function') {
        const syncStatusObserver = new MutationObserver(() => {
          if (headerSyncStatus && drawerSyncStatus) {
            drawerSyncStatus.textContent = headerSyncStatus.textContent || '';
          }
        });

        if (headerSyncStatus) {
          syncStatusObserver.observe(headerSyncStatus, { childList: true });
        }

        const syncDotObserver = new MutationObserver(() => {
          if (headerSyncDot && drawerSyncDot) {
            const isOnline = headerSyncDot.classList.contains('online');
            drawerSyncDot.classList.toggle('online', isOnline);
            drawerSyncDot.classList.toggle('offline', !isOnline);
          }
        });

        if (headerSyncDot) {
          syncDotObserver.observe(headerSyncDot, { attributes: true, attributeFilter: ['class'] });
        }
      }

      if (headerSyncStatus && drawerSyncStatus) {
        drawerSyncStatus.textContent = headerSyncStatus.textContent || drawerSyncStatus.textContent || '';
      }
      if (headerSyncDot && drawerSyncDot) {
        const isOnline = headerSyncDot.classList.contains('online');
        drawerSyncDot.classList.toggle('online', isOnline);
        drawerSyncDot.classList.toggle('offline', !isOnline);
      }
    })();
  </script>

  <div class="container">
    <main id="main" class="mx-auto pt-0 pb-4 w-full max-w-none sm:max-w-lg" tabindex="-1" data-active-view="reminders">
    <!-- BEGIN GPT CHANGE: create form moved to bottom sheet -->
    <!-- END GPT CHANGE -->
    <!-- BEGIN GPT CHANGE: reminders view -->
    <section data-view="reminders" id="view-reminders" class="view-panel">
      <section
        id="reminderListSection"
        class="w-full relative"
      >
        <div class="w-full" id="remindersWrapper">
          <div id="emptyState" class="hidden text-center text-base-content/60 py-8 px-4"></div>
          <p id="reminderReorderHint" class="sr-only">
            Press, hold, and drag a reminder card to reorder your list. Screen reader users can double-tap and hold, then drag to move a reminder.
          </p>
          <p class="text-xs text-base-content/50 mb-2 pb-2 px-4 border-b border-base-200/30">Total reminders: <span id="totalCount">0</span></p>
          <ul id="reminderList" class="grid grid-cols-2 gap-1 w-full" aria-describedby="reminderReorderHint"></ul>
        </div>
      </section>
    </section>
    <!-- END GPT CHANGE -->
    <!-- BEGIN GPT CHANGE: notebook view -->
    <section data-view="notebook" id="view-notebook" class="view-panel hidden">
      <section class="card bg-base-100 border">
        <div class="card-body gap-3 compact">
          <div class="flex items-center justify-between gap-2">
            <h2 class="card-title text-base">Scratch Notes</h2>
            <button type="button" class="btn btn-ghost btn-xs" data-jump-view="reminders">Back to reminders</button>
          </div>
          <div
            id="notesToolbar"
            class="flex flex-wrap gap-1.5 p-2 bg-base-200/30 rounded-lg"
            role="toolbar"
            aria-label="Note formatting options"
            aria-controls="notes"
          >
            <div class="flex gap-1 border-r border-base-300 pr-2">
              <button type="button" class="btn btn-xs btn-ghost" data-action="bold" title="Bold (Ctrl+B)" aria-label="Make text bold">
                <strong>B</strong>
              </button>
              <button type="button" class="btn btn-xs btn-ghost" data-action="italic" title="Italic (Ctrl+I)" aria-label="Make text italic">
                <em>I</em>
              </button>
              <button type="button" class="btn btn-xs btn-ghost" data-action="strikethrough" title="Strikethrough" aria-label="Strike through text">
                <s>S</s>
              </button>
            </div>
            <div class="flex gap-1 border-r border-base-300 pr-2">
              <button type="button" class="btn btn-xs btn-ghost" data-action="bullets" title="Bullet list"></button>
              <button type="button" class="btn btn-xs btn-ghost" data-action="numbers" title="Numbered list">1.</button>
              <button type="button" class="btn btn-xs btn-ghost" data-action="checklist" title="Checklist"></button>
            </div>
            <div class="flex gap-1 border-r border-base-300 pr-2">
              <button type="button" class="btn btn-xs btn-ghost" data-action="heading" title="Heading">
                H
              </button>
              <button type="button" class="btn btn-xs btn-ghost" data-action="divider" title="Add divider">
                
              </button>
            </div>
            <div class="flex gap-1">
              <button type="button" class="btn btn-xs btn-ghost" data-action="link" title="Add link">
                
              </button>
              <button type="button" class="btn btn-xs btn-ghost" data-action="clear" title="Clear formatting">
                
              </button>
            </div>
          </div>
          <div
            id="notes"
            class="notes-editor enhanced"
            contenteditable="true"
            role="textbox"
            aria-multiline="true"
            spellcheck="true"
            data-placeholder="Start typing your notes... (auto-saves)"
            data-auto-save="true"
          ></div>
          <div class="flex items-center justify-between text-xs text-base-content/60">
            <div id="notesStatus" class="flex items-center gap-1">
              <span class="sync-dot offline" id="notesSyncStatus"></span>
              <span id="notesStatusText">Ready</span>
            </div>
            <div id="notesWordCount">0 words</div>
          </div>
          <div class="flex flex-wrap gap-2">
            <button id="searchNotes" class="btn btn-outline btn-sm flex-1" type="button">
               Search
            </button>
            <button id="exportNotes" class="btn btn-outline btn-sm flex-1" type="button">
               Export
            </button>
            <button id="voiceNotes" class="btn btn-outline btn-sm flex-1" type="button">
               Voice
            </button>
          </div>
          <div id="searchPanel" class="hidden bg-base-200/50 p-3 rounded-lg border">
            <div class="flex gap-2 mb-2">
              <input
                id="searchInput"
                type="text"
                placeholder="Search in notes..."
                class="input input-sm flex-1"
              />
              <button id="searchPrev" class="btn btn-sm btn-ghost" title="Previous"></button>
              <button id="searchNext" class="btn btn-sm btn-ghost" title="Next"></button>
              <button id="closeSearch" class="btn btn-sm btn-ghost" title="Close"></button>
            </div>
            <div id="searchResults" class="text-xs text-base-content/70"></div>
          </div>
        </div>
      </section>

    </section>
    <!-- END GPT CHANGE -->
    </main>
  </div>

  <nav class="btm-nav fixed bottom-0 left-0 right-0 bg-base-100 border-t" aria-label="Primary navigation">
    <button type="button" aria-current="page" class="active">
      <span class="btm-nav-label text-lg font-extrabold" style="font-size: var(--text-lg); font-weight: 800;">Reminders</span>
    </button>
    <button type="button">
      <span class="btm-nav-label">Notebook</span>
    </button>
  </nav>
  <!-- build-marker: mobile.html / runs mobile.js / EXPECTED LIVE -->
  <!-- When deployed, this should appear in View Source with todays date. -->

  <script>
    window.memoryCueEmptyStateCtaClasses = 'btn btn-primary btn-sm w-full sm:w-auto';
    window.memoryCueMountEmptyState = function mountCompactEmptyState(target, config) {
      if (!(target instanceof HTMLElement)) {
        return;
      }

      const { title, description, action } = config || {};
      const wrapper = document.createElement('div');
      wrapper.className = 'empty-state-compact';
      wrapper.setAttribute('role', 'presentation');

      if (title) {
        const heading = document.createElement('h3');
        heading.textContent = title;
        wrapper.appendChild(heading);
      }

      if (description) {
        const paragraph = document.createElement('p');
        paragraph.textContent = description;
        wrapper.appendChild(paragraph);
      }

      if (action) {
        const actions = document.createElement('div');
        actions.className = 'empty-state-actions';
        actions.innerHTML = action;
        wrapper.appendChild(actions);
      }

      target.replaceChildren(wrapper);
    };

    const viewToggleMenu = document.getElementById('viewToggleMenu');
    const viewToggleLabel = document.getElementById('viewToggleLabel');
    const reminderList = document.getElementById('reminderList');

    if (viewToggleMenu && reminderList) {
      const getPendingNotificationIds = () => {
        if (typeof Notification === 'undefined' || Notification.permission !== 'granted') {
          return new Set();
        }

        if (typeof localStorage === 'undefined') {
          return new Set();
        }

        try {
          const stored = JSON.parse(localStorage.getItem('scheduledReminders') || '{}');
          const entries = Object.values(stored || {}).filter((entry) => entry && typeof entry === 'object' && entry.id);
          return new Set(entries.map((entry) => entry.id));
        } catch (error) {
          console.warn('Unable to read scheduled reminders', error);
          return new Set();
        }
      };

      const applyNotificationHighlights = () => {
        const ids = getPendingNotificationIds();
        reminderList.querySelectorAll('[data-reminder]').forEach((el) => {
          if (!(el instanceof HTMLElement)) return;
          const reminderId = el.dataset.id || el.getAttribute('data-id');
          if (reminderId && ids.has(reminderId)) {
            el.setAttribute('data-notification-active', 'true');
          } else {
            el.removeAttribute('data-notification-active');
          }
        });
      };

      const updateViewToggleLabel = (isCompact) => {
        if (!viewToggleLabel) return;
        viewToggleLabel.textContent = isCompact ? 'View layout: Compact' : 'View layout: Full';
      };

      const updateToggleState = (isCompact) => {
        updateViewToggleLabel(isCompact);
        viewToggleMenu.setAttribute('aria-pressed', isCompact ? 'true' : 'false');
      };

      const setCompactMode = (compact) => {
        reminderList.querySelectorAll('.task-item, [data-compact]').forEach((item) => {
          if (!(item instanceof HTMLElement)) return;
          if (compact) {
            item.setAttribute('data-compact', 'true');
          } else {
            item.removeAttribute('data-compact');
          }
        });
      };

      const ensureInitialState = () => {
        let isGridView = reminderList.classList.contains('grid-cols-2');

        if (isGridView) {
          reminderList.classList.remove('grid-cols-2');
          reminderList.classList.add('space-y-3');
          isGridView = false;
        } else if (!reminderList.classList.contains('space-y-3')) {
          reminderList.classList.add('space-y-3');
        }

        updateToggleState(isGridView);
        setCompactMode(false);
        applyNotificationHighlights();
      };

      const observer = new MutationObserver(() => {
        const isGridView = reminderList.classList.contains('grid-cols-2');
        setCompactMode(isGridView);
        applyNotificationHighlights();
        updateToggleState(isGridView);
      });

      viewToggleMenu.addEventListener('click', function () {
        const isGridView = reminderList.classList.contains('grid-cols-2');

        if (isGridView) {
          reminderList.classList.remove('grid-cols-2');
          reminderList.classList.add('space-y-3');
        } else {
          reminderList.classList.add('grid-cols-2');
          reminderList.classList.remove('space-y-3');
        }

        const isNowGridView = !isGridView;
        updateToggleState(isNowGridView);
        setCompactMode(isNowGridView);

        applyNotificationHighlights();
      });

      ensureInitialState();
      observer.observe(reminderList, { childList: true });

      document.addEventListener('memoryCue:remindersUpdated', applyNotificationHighlights);
      window.addEventListener('storage', (event) => {
        if (event && event.key === 'scheduledReminders') {
          applyNotificationHighlights();
        }
      });
    }
  </script>
  <!-- Load the mobile app bundle (build will rewrite to hashed path) -->
  <script src="./assets/register-service-worker-J3ZRTHIR.js" defer></script>
  <script type="module" src="./assets/mobile-SPYY74RG.js?v=2025-10-29-1"></script>
  <script type="module" src="./assets/mobile-theme-toggle-CKY7BNGT.js"></script>
  <!-- BEGIN GPT CHANGE: bottom sheet for Create Reminder -->
  <div id="create-sheet" role="dialog" aria-modal="true" aria-labelledby="createSheetTitle" class="sheet hidden" tabindex="-1" data-add-task-dialog>
    <div class="sheet-panel bg-base-100 border-t border-base-200" data-dialog-content>
      <header class="sheet-header">
        <h2 id="createSheetTitle">Create Reminder</h2>
        <div class="sheet-header-actions">
          <button
            id="voiceBtn"
            type="button"
            class="btn btn-circle btn-ghost"
            aria-label="Start voice input"
            aria-pressed="false"
            title="Fill reminder using your voice"
          >
            <span aria-hidden="true"></span>
            <span class="sr-only">Start voice input</span>
          </button>
          <button type="button" id="closeCreateSheet" aria-label="Close"></button>
        </div>
      </header>
      <form id="createReminderForm" class="inputs-compact">
        <div class="card-body gap-4 compact">
          <label class="form-control w-full">
            <div class="label"><span class="label-text">Reminder</span></div>
            <input
              id="reminderText"
              type="text"
              placeholder=""
              class="input input-bordered w-full"
              autocomplete="off"
            />
          </label>

          <label class="form-control w-full">
            <div class="label"><span class="label-text">Notes</span></div>
            <textarea
              id="reminderDetails"
              class="textarea textarea-bordered"
              rows="3"
              placeholder="Optional context for the reminder"
            ></textarea>
          </label>

          <div class="grid grid-cols-2 gap-3">
            <label class="form-control">
              <div class="label"><span class="label-text">Date</span></div>
              <input id="reminderDate" type="date" class="input input-bordered" />
            </label>
            <label class="form-control">
              <div class="label"><span class="label-text">Time</span></div>
              <input id="reminderTime" type="time" class="input input-bordered" />
            </label>
          </div>

          <div id="dateFeedback" class="text-xs text-info"></div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-control">
              <div class="label"><span class="label-text">Priority</span></div>
              <select id="priority" class="select select-bordered hidden" aria-hidden="true" tabindex="-1">
                <option value="High">High</option>
                <option value="Medium" selected>Medium</option>
                <option value="Low">Low</option>
              </select>
              <!-- BEGIN GPT CHANGE: priority s -->
               <fieldset id="prioritys" aria-label="Priority" class="chip-row">
                <label><input type="radio" name="priority" value="High"> High</label>
                <label><input type="radio" name="priority" value="Medium" checked> Medium</label>
                <label><input type="radio" name="priority" value="Low"> Low</label>
              </fieldset>             
              <!-- END GPT CHANGE: priority chips -->
            </div>
            <label class="form-control">
              <div class="label"><span class="label-text">Category</span></div>
              <input
                id="category"
                class="input input-bordered"
                list="categorySuggestions"
                placeholder="General"
                value="General"
              />
              <datalist id="categorySuggestions">
                <option value="General"></option>
                <option value="General Appointments"></option>
                <option value="Home &amp; Personal"></option>
                <option value="School  Appointments/Meetings"></option>
                <option value="School  Communication &amp; Families"></option>
                <option value="School  Excursions &amp; Events"></option>
                <option value="School  Grading &amp; Assessment"></option>
                <option value="School  Prep &amp; Resources"></option>
                <option value="School  To-Do"></option>
                <option value="Wellbeing &amp; Support"></option>
              </datalist>
            </label>
          </div>

          <div class="flex flex-wrap items-center gap-3">
            <button id="notifBtn" class="btn btn-ghost" type="button">Enable notifications</button>
          </div>

          <div class="flex flex-col gap-2">
            <button
              id="sheetVoiceBtn"
              class="btn btn-outline justify-center"
              type="button"
              aria-pressed="false"
              aria-label="Dictate reminder"
            >
               Voice input
            </button>
            <p
              id="sheetVoiceStatus"
              class="text-xs text-base-content/60"
              role="status"
              aria-live="polite"
              hidden
            >
              Tap the microphone to start speaking.
            </p>
          </div>

          <div class="card-actions justify-stretch">
            <button id="saveReminder" class="btn btn-primary w-full" type="button">Save Reminder</button>
            <button id="cancelEditBtn" class="btn btn-outline w-full hidden" type="button">Cancel</button>
          </div>
          <p id="statusMessage" class="text-sm text-base-content/70" role="status" aria-live="polite"></p>
        </div>
      </form>
    </div>
    <div class="sheet-backdrop backdrop" data-close></div>
  </div>
  <!-- END GPT CHANGE: bottom sheet for Create Reminder -->

  <!-- BEGIN GPT CHANGE: settings modal -->
  <div id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" class="hidden">
    <div class="modal-panel">
      <header class="modal-header">
        <h2 id="settingsTitle">Settings</h2>
        <button type="button" id="closeSettings" aria-label="Close"></button>
      </header>
      <div class="card bg-base-100 border-0">
        <div class="card-body gap-4 compact">
          <h2 class="card-title text-base">Sync Settings</h2>
          <p class="text-sm text-base-content/70">Configure your Google Apps Script endpoint to sync reminders to Calendar.</p>
          <label class="form-control">
            <div class="label"><span class="label-text">Apps Script URL</span></div>
            <input id="syncUrl" type="url" class="input input-bordered" placeholder="https://script.google.com/macros/s/.../exec" />
          </label>
          <div class="card-actions flex-col gap-2">
            <div class="flex gap-2 w-full">
              <button id="saveSyncSettings" class="btn btn-outline flex-1" type="button">Save Settings</button>
              <button id="testSync" class="btn btn-outline flex-1" type="button">Test Connection</button>
            </div>
            <button id="syncAll" class="btn btn-primary w-full" type="button">Sync All</button>
          </div>
          <p class="text-xs text-base-content/60">Tip: In Google Apps Script choose <strong>Deploy  Web app</strong>, execute as yourself and allow access to anyone with the link.</p>
        </div>
      </div>
    </div>
    <div class="modal-backdrop" data-close></div>
  </div>
  <!-- END GPT CHANGE: settings modal -->

  <script id="mobile-enhancements">
    document.querySelectorAll('[data-close]').forEach((btn) => {
      btn.addEventListener('click', (event) => {
        const trigger = event.target;
        const dialog = trigger?.closest?.('.sheet, .modal');
        if (dialog) {
          dialog.classList.add('hidden');
        }
      });
    });

    (function () {
      const list = document.getElementById('reminderList');
      if (!list) return;

      const TEXT_NODE = typeof Node !== 'undefined' ? Node.TEXT_NODE : 3;
      const priorityLabels = {
        high: 'High priority',
        medium: 'Medium priority',
        low: 'Low priority',
      };
      const removePriorityText = (element) => {
        if (!(element instanceof HTMLElement)) return;
        Array.from(element.childNodes).forEach((child) => {
          if (child.nodeType === TEXT_NODE) {
            child.remove();
          } else if (child instanceof HTMLElement) {
            removePriorityText(child);
            if (!child.childNodes.length) {
              child.remove();
            }
          }
        });
      };

      const applyPriorityPills = (container) => {
        const pills = container.querySelectorAll('[data-chip="priority"], [data-priority-pill], .priority-pill');
        pills.forEach((pill) => {
          if (!(pill instanceof HTMLElement)) return;

          const prioritySource =
            pill.dataset.priority ||
            pill.dataset.level ||
            pill.dataset.value ||
            container.dataset.priority ||
            container.getAttribute('data-priority') ||
            '';

          const textPriority = prioritySource || pill.textContent?.trim() || '';
          const normalized = textPriority.toLowerCase();

          let priorityKey = '';

          pill.classList.add('priority-pill');
          pill.classList.remove('priority-high', 'priority-medium', 'priority-low');

          if (normalized.startsWith('h')) {
            pill.classList.add('priority-high');
            priorityKey = 'high';
          } else if (normalized.startsWith('m')) {
            pill.classList.add('priority-medium');
            priorityKey = 'medium';
          } else if (normalized.startsWith('l')) {
            pill.classList.add('priority-low');
            priorityKey = 'low';
          }

          const accessibleLabel = textPriority || (priorityKey ? priorityLabels[priorityKey] : '');
          if (accessibleLabel) {
            pill.setAttribute('aria-label', accessibleLabel);
            pill.setAttribute('title', accessibleLabel);
          }

          removePriorityText(pill);
        });
      };

      const restructureReminderCard = (card) => {
        if (!(card instanceof HTMLElement)) return;
        if (card.dataset.compactLayout === 'true') return;

        const content = card.querySelector('.task-content') || card;
        if (!(content instanceof HTMLElement)) return;

        const header = content.querySelector('.task-header');
        const titleEl = header?.querySelector('.task-title, [data-reminder-title], strong');
        if (!(titleEl instanceof HTMLElement)) return;

        const toolbar = header?.querySelector('.task-toolbar');
        const metaTextEl = content.querySelector('.task-meta-text');
        const metaContainer = content.querySelector('.task-meta');
        const notesEl = content.querySelector('.task-notes');

        const primaryRow = document.createElement('div');
        primaryRow.className = 'reminder-primary-row';

        const controlSlot = document.createElement('div');
        controlSlot.className = 'reminder-control-slot';
        const control =
          card.querySelector('[data-action="toggle"]') ||
          card.querySelector('[data-done]') ||
          card.querySelector('[data-complete]') ||
          card.querySelector('input[type="checkbox"]');
        if (control instanceof HTMLElement) {
          controlSlot.appendChild(control);
        } else {
          controlSlot.classList.add('reminder-control-slot--empty');
        }

        const titleSlot = document.createElement('div');
        titleSlot.className = 'reminder-title-slot';
        titleSlot.appendChild(titleEl);

        const metaSlot = document.createElement('div');
        metaSlot.className = 'reminder-meta-slot';

        let extraMetaEl = null;
        if (metaTextEl instanceof HTMLElement) {
          const segments = (metaTextEl.textContent || '')
            .split('')
            .map((segment) => segment.trim())
            .filter(Boolean);
          const dueSegments = [];
          if (segments.length) {
            dueSegments.push(segments.shift());
          }
          if (segments.length) {
            dueSegments.push(segments.shift());
          }
          if (dueSegments.length) {
            const dueEl = document.createElement('span');
            dueEl.className = 'reminder-due';
            dueEl.textContent = dueSegments.join('  ');
            metaSlot.appendChild(dueEl);
          }
          if (segments.length) {
            metaTextEl.textContent = segments.join('  ');
            extraMetaEl = metaTextEl;
          } else {
            metaTextEl.remove();
          }
        }

        let priorityChip = null;
        const secondaryChips = [];
        if (metaContainer instanceof HTMLElement) {
          Array.from(metaContainer.children).forEach((child) => {
            if (!(child instanceof HTMLElement)) return;
            if (!priorityChip && child.matches('[data-chip="priority"], [data-priority-pill], .priority-pill')) {
              priorityChip = child;
            } else {
              secondaryChips.push(child);
            }
          });
        }

        if (priorityChip) {
          priorityChip.remove();
        }
        if (metaContainer instanceof HTMLElement) {
          metaContainer.remove();
        }

        if (!metaSlot.childElementCount) {
          metaSlot.classList.add('reminder-meta-slot--empty');
        }

        primaryRow.append(controlSlot, titleSlot, metaSlot);

        const secondaryRow = document.createElement('div');
        secondaryRow.className = 'reminder-secondary-row';

        if (extraMetaEl) {
          secondaryRow.appendChild(extraMetaEl);
        }
        secondaryChips.forEach((chip) => secondaryRow.appendChild(chip));
        if (notesEl instanceof HTMLElement) {
          secondaryRow.appendChild(notesEl);
        }
        if (toolbar instanceof HTMLElement) {
          secondaryRow.appendChild(toolbar);
        }

        content.replaceChildren(primaryRow);
        if (secondaryRow.childElementCount) {
          content.appendChild(secondaryRow);
        }

        card.dataset.compactLayout = 'true';
        if (list.classList.contains('grid-cols-2')) {
          card.dataset.compact = 'true';
        } else {
          card.removeAttribute('data-compact');
        }
      };

      const upgrade = (node) => {
        if (!(node instanceof HTMLElement)) return;
        if (node.parentElement !== list) return;
        if (!node.classList.contains('reminder-card')) {
          if (node.classList.contains('card')) {
            node.classList.remove('card');
          }
          node.classList.add('reminder-card');
        }
        applyPriorityPills(node);
        restructureReminderCard(node);
      };

      Array.from(list.children).forEach((child) => {
        upgrade(child);
      });

      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (node instanceof HTMLElement) {
              upgrade(node);
            } else if (node instanceof DocumentFragment) {
              Array.from(node.childNodes).forEach((child) => {
                if (child instanceof HTMLElement) {
                  upgrade(child);
                }
              });
            }
          });
        });
      });

      observer.observe(list, { childList: true });
    })();

    // Enhanced add button functionality
    (function () {
      const addBtn = document.getElementById('addReminderBtn');
      const addOptionsFab = document.getElementById('addOptionsFab');
      if (!addBtn || !addOptionsFab) return;

      let suppressVoiceTrigger = false;

      addBtn.addEventListener('click', function () {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', String(!isExpanded));
        addOptionsFab.classList.toggle('active');

        if (!isExpanded) {
          this.style.transform = 'rotate(45deg)';
        } else {
          this.style.transform = 'rotate(0deg)';
        }
      });

      document.addEventListener('click', (event) => {
        if (!event.target.closest('.add-button-container')) {
          addOptionsFab.classList.remove('active');
          addBtn.setAttribute('aria-expanded', 'false');
          addBtn.style.transform = 'rotate(0deg)';
        }
      });

      document.querySelectorAll('.add-option-item').forEach((item) => {
        item.addEventListener('click', function () {
          const addType = this.dataset.addType;

          addOptionsFab.classList.remove('active');
          addBtn.setAttribute('aria-expanded', 'false');
          addBtn.style.transform = 'rotate(0deg)';

          switch (addType) {
            case 'reminder': {
              const quickAddInput = document.getElementById('quickAddInput');
              quickAddInput?.focus();
              break;
            }
            case 'voice': {
              if (suppressVoiceTrigger) {
                suppressVoiceTrigger = false;
                break;
              }
              const voiceOption = document.getElementById('voiceAddBtn');
              if (voiceOption) {
                suppressVoiceTrigger = true;
                voiceOption.click();
                const resetTrigger = () => {
                  suppressVoiceTrigger = false;
                };
                if (typeof queueMicrotask === 'function') {
                  queueMicrotask(resetTrigger);
                } else {
                  setTimeout(resetTrigger, 0);
                }
              }
              break;
            }
            case 'note': {
              // Add note creation logic here
              break;
            }
            default:
              break;
          }
        });
      });
    })();

    (function () {
      const views = {
        reminders: document.querySelector('[data-view="reminders"]'),
        notebook: document.querySelector('[data-view="notebook"]'),
      };
      const nav = document.querySelector('.btm-nav');
      if (!nav) return;

      const buttons = Array.from(nav.querySelectorAll('button')).slice(0, 2);
      const order = ['reminders', 'notebook'];

      if (!buttons.length || order.some((key) => !views[key])) {
        return;
      }

      const reduceMotion = typeof window !== 'undefined' && typeof window.matchMedia === 'function'
        ? window.matchMedia('(prefers-reduced-motion: reduce)')
        : null;

      let activeView = order[0];
      const main = document.getElementById('main') || document.querySelector('main');
      const body = document.body;

      if (main) {
        const preset = main.getAttribute('data-active-view');
        if (preset && order.includes(preset)) {
          activeView = preset;
        }
      }

      if (body && activeView) {
        body.setAttribute('data-active-view', activeView);
      }

      const setActiveView = (target) => {
        if (!order.includes(target)) return;

        order.forEach((key, index) => {
          const view = views[key];
          const button = buttons[index];
          const isActive = key === target;

          if (view) {
            view.classList.toggle('hidden', !isActive);
            view.setAttribute('aria-hidden', String(!isActive));
          }

          if (button) {
            button.setAttribute('aria-current', isActive ? 'page' : 'false');
            button.classList.toggle('active', Boolean(isActive));
          }
        });

        activeView = target;

        const skipLink =
          document.querySelector('.skip-link') ||
          document.querySelector('a[href$="#main"]');
        if (main) {
          main.setAttribute('data-active-view', target);
        }
        if (body) {
          body.setAttribute('data-active-view', target);
        }
        if (skipLink && main) {
          const behaviour = reduceMotion?.matches ? 'auto' : 'smooth';
          try {
            window.scrollTo({ top: 0, behavior: behaviour });
          } catch {
            window.scrollTo(0, 0);
          }
        }
      };

      buttons.forEach((button, index) => {
        button.addEventListener('click', () => {
          setActiveView(order[index]);
        });
      });

      document.querySelectorAll('[data-jump-view]').forEach((control) => {
        control.addEventListener('click', () => {
          const target = control.getAttribute('data-jump-view');
          if (target) {
            setActiveView(target);
          }
        });
      });

      document.querySelectorAll('[data-scroll-target]').forEach((control) => {
        control.addEventListener('click', () => {
          const targetId = control.getAttribute('data-scroll-target');
          if (!targetId) return;
          const el = document.getElementById(targetId);
          if (!el) return;
          try {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          } catch {
            el.scrollIntoView(true);
          }
        });
      });

      if (main) {
        const SWIPE_MIN_DISTANCE = 60;
        const SWIPE_MAX_OFF_AXIS = 80;
        const SWIPE_MAX_DURATION = 600;
        let startX = 0;
        let startY = 0;
        let startTime = 0;
        let tracking = false;

        const resetSwipeTracking = () => {
          tracking = false;
          startX = 0;
          startY = 0;
          startTime = 0;
        };

        const isInteractiveTarget = (target) => {
          if (!(target instanceof Element)) return false;
          return Boolean(
            target.closest(
              '[data-no-swipe], input, textarea, select, button, [role="button"], [role="textbox"], [contenteditable="true"], [contenteditable=""]'
            )
          );
        };

        main.addEventListener(
          'touchstart',
          (event) => {
            if (event.touches.length !== 1) {
              resetSwipeTracking();
              return;
            }

            const target = event.target;
            if (target instanceof Element && isInteractiveTarget(target)) {
              resetSwipeTracking();
              return;
            }

            const touch = event.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            startTime = event.timeStamp || Date.now();
            tracking = true;
          },
          { passive: true }
        );

        main.addEventListener(
          'touchmove',
          (event) => {
            if (!tracking) return;
            if (event.touches.length !== 1) {
              resetSwipeTracking();
            }
          },
          { passive: true }
        );

        main.addEventListener(
          'touchend',
          (event) => {
            if (!tracking) return;
            tracking = false;

            if (!event.changedTouches || !event.changedTouches.length) {
              resetSwipeTracking();
              return;
            }

            const touch = event.changedTouches[0];
            const deltaX = touch.clientX - startX;
            const deltaY = touch.clientY - startY;
            const duration = (event.timeStamp || Date.now()) - startTime;
            resetSwipeTracking();

            if (Math.abs(deltaX) < SWIPE_MIN_DISTANCE) return;
            if (Math.abs(deltaY) > SWIPE_MAX_OFF_AXIS) return;
            if (Math.abs(deltaX) <= Math.abs(deltaY)) return;
            if (duration > SWIPE_MAX_DURATION) return;

            const currentIndex = order.indexOf(activeView);
            if (currentIndex === -1) return;

            if (deltaX < 0 && currentIndex < order.length - 1) {
              setActiveView(order[currentIndex + 1]);
            } else if (deltaX > 0 && currentIndex > 0) {
              setActiveView(order[currentIndex - 1]);
            }
          },
          { passive: true }
        );

        main.addEventListener('touchcancel', resetSwipeTracking, { passive: true });
      }

      setActiveView('reminders');
    })();

    (function () {
      const list = document.getElementById('reminderList');
      if (!list) return;

      const allChildren = Array.from(list.children);
      if (allChildren.length <= 30) return;

      const PAGE_SIZE = 20;
      list.innerHTML = '';
      let index = 0;

      const appendPage = () => {
        const slice = allChildren.slice(index, index + PAGE_SIZE);
        slice.forEach((node) => list.appendChild(node));
        index += slice.length;
      };

      appendPage();

      const sentinel = document.createElement('div');
      sentinel.id = 'listSentinel';
      list.appendChild(sentinel);

      const observer = new IntersectionObserver((entries) => {
        if (entries.some((entry) => entry.isIntersecting) && index < allChildren.length) {
          appendPage();
          if (index >= allChildren.length) {
            observer.disconnect();
          }
        }
      });

      observer.observe(sentinel);
    })();

    (function () {
      const openBtns = Array.from(
        document.querySelectorAll('[data-open="settings"]'),
      ).filter((btn) => btn instanceof HTMLElement);
      const modal = document.getElementById('settingsModal');
      const closeBtn = document.getElementById('closeSettings');
      if (!openBtns.length || !modal || !closeBtn) return;

      const open = () => {
        modal.classList.remove('hidden');
      };

      const close = () => {
        modal.classList.add('hidden');
      };

      openBtns.forEach((btn) => btn.addEventListener('click', open));
      closeBtn.addEventListener('click', close);
      modal.addEventListener('click', (event) => {
        if (event.target instanceof HTMLElement && event.target.matches('[data-close]')) {
          close();
        }
      });
      modal.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          close();
        }
      });
    })();

    (function () {
      const statusContainer = document.getElementById('syncStatus');
      const statusDotEl = document.getElementById('mcStatus');
      const statusTextEl = document.getElementById('mcStatusText');
      if (!statusTextEl) return;

      const syncUrlInput = document.getElementById('syncUrl');
      const saveSettingsBtn = document.getElementById('saveSyncSettings');
      const testSyncBtn = document.getElementById('testSync');
      const syncAllBtn = document.getElementById('syncAll');
      const STORAGE_KEY = 'syncUrl';
      const ACTIVE_CLASSES = ['online', 'offline', 'error'];
      const DOT_CLASSES = ['online', 'offline'];

      let currentState = null;

      const DEFAULT_MESSAGES = {
        checking: 'Checking connection',
        syncing: 'Syncing your latest changes',
        online: 'Connected. Changes sync automatically.',
        offline: "You're offline. Changes are saved on this device until you reconnect.",
        error: "We couldn't sync right now. We'll retry soon.",
        info: '',
      };

      const DISPLAY_MESSAGES = {
        checking: 'Checking',
        syncing: 'Syncing',
        online: 'Synced. Auto-save on.',
        offline: 'Offline. Saving locally.',
        error: 'Sync issue. Retrying.',
        info: '',
      };

      const applyDotState = (state) => {
        if (!statusDotEl) return;
        DOT_CLASSES.forEach((cls) => statusDotEl.classList.remove(cls));
        const isOnline = state !== 'offline' && state !== 'error';
        statusDotEl.classList.add(isOnline ? 'online' : 'offline');
        statusDotEl.setAttribute('aria-label', isOnline ? 'Online' : 'Offline');
      };

      const setStatus = (state, message) => {
        currentState = state;
        ACTIVE_CLASSES.forEach((cls) => statusTextEl.classList.remove(cls));
        if (statusContainer) {
          ACTIVE_CLASSES.forEach((cls) => statusContainer.classList.remove(cls));
        }

        if (statusContainer) {
          statusContainer.setAttribute('data-state', state);
        }

        if (state === 'online') {
          statusTextEl.classList.add('online');
          if (statusContainer) statusContainer.classList.add('online');
        } else if (state === 'error') {
          statusTextEl.classList.add('error');
          if (statusContainer) statusContainer.classList.add('error');
        } else {
          statusTextEl.classList.add('offline');
          if (statusContainer) statusContainer.classList.add('offline');
        }

        const fullText =
          typeof message === 'string' && message.trim()
            ? message.trim()
            : DEFAULT_MESSAGES[state] || '';

        const displayText =
          typeof message === 'string' && message.trim()
            ? message.trim()
            : DISPLAY_MESSAGES[state] || fullText;

        const srText = fullText || displayText || '';
        statusTextEl.dataset.state = state;
        statusTextEl.textContent = srText;

        if (srText) {
          statusTextEl.setAttribute('title', srText);
          statusTextEl.setAttribute('aria-label', srText);
        } else {
          statusTextEl.removeAttribute('title');
          statusTextEl.removeAttribute('aria-label');
        }

        applyDotState(state);
      };

      const updateOnlineState = () => {
        if (currentState === 'syncing') return;
        if (navigator.onLine) {
          if (currentState !== 'online') setStatus('online');
        } else {
          setStatus('offline');
        }
      };

      const persistUrl = (value) => {
        if (typeof localStorage === 'undefined') return;
        if (value) {
          localStorage.setItem(STORAGE_KEY, value);
        } else {
          localStorage.removeItem(STORAGE_KEY);
        }
      };

      const getStoredUrl = () => {
        if (typeof localStorage === 'undefined') return '';
        try {
          return localStorage.getItem(STORAGE_KEY) || '';
        } catch {
          return '';
        }
      };

      const normaliseReminder = (raw) => {
        if (!raw || typeof raw !== 'object') return null;
        const id = raw.id || raw.uid || raw.key || raw.slug || raw.uuid;
        let title = typeof raw.title === 'string' ? raw.title.trim() : '';
        if (!title && typeof raw.name === 'string') {
          title = raw.name.trim();
        }
        if (!title) return null;

        const dueIso = typeof raw.dueIso === 'string' && raw.dueIso
          ? raw.dueIso
          : (typeof raw.due === 'string' ? raw.due : null);

        const priority = typeof raw.priority === 'string' && raw.priority.trim()
          ? raw.priority.trim()
          : (raw.level || raw.importance || 'Medium');

        const category = typeof raw.category === 'string' && raw.category.trim()
          ? raw.category.trim()
          : (raw.group || raw.bucket || 'General');

        const done = typeof raw.done === 'boolean'
          ? raw.done
          : Boolean(raw.completed || raw.isDone || raw.status === 'done');

        const ensuredId = id || (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function'
          ? crypto.randomUUID()
          : `${Date.now()}-${Math.random()}`);

        return {
          id: ensuredId,
          title,
          dueIso: dueIso && dueIso.trim() ? dueIso.trim() : null,
          priority,
          category,
          done,
        };
      };

      const collectFromDom = () => {
        const elements = Array.from(document.querySelectorAll('[data-reminder]'));
        if (!elements.length) return [];

        return elements
          .map((el) => {
            const dataset = el.dataset || {};
            let raw = null;

            if (dataset.reminder) {
              try {
                const parsed = JSON.parse(dataset.reminder);
                if (parsed && typeof parsed === 'object') {
                  raw = parsed;
                }
              } catch {
                raw = null;
              }
            }

            const candidate = raw || {
              id: dataset.id || dataset.reminderId || el.getAttribute('data-id') || null,
              title: dataset.title || dataset.reminderTitle || '',
              dueIso: dataset.due || dataset.reminderDue || el.getAttribute('data-due') || null,
              priority: dataset.priority || dataset.reminderPriority || el.getAttribute('data-priority') || '',
              category: dataset.category || dataset.reminderCategory || el.getAttribute('data-category') || '',
              done: dataset.done === 'true' || dataset.reminderDone === 'true' || el.getAttribute('data-done') === 'true',
            };

            if (!candidate.title) {
              const titleEl = el.querySelector('[data-reminder-title], [data-title], h3, h4, strong');
              if (titleEl) {
                candidate.title = titleEl.textContent.trim();
              }
            }

            if (!candidate.dueIso) {
              const dueEl = el.querySelector('[data-due], time');
              if (dueEl) {
                const attr = dueEl.getAttribute('datetime') || dueEl.getAttribute('data-due');
                candidate.dueIso = attr || dueEl.textContent.trim();
              }
            }

            return normaliseReminder(candidate);
          })
          .filter(Boolean);
      };

      const collectFromStorage = () => {
        if (typeof localStorage === 'undefined') return [];
        const reminders = [];
        const triedKeys = new Set();
        const preferredKeys = [
          'memoryCue.reminders.v1',
          'memoryCue.reminders',
          'memoryCueMobile.reminders',
          'memoryCue.reminders.cache',
          'reminders',
        ];

        preferredKeys.forEach((key) => {
          if (triedKeys.has(key)) return;
          triedKeys.add(key);
          try {
            const value = localStorage.getItem(key);
            if (!value) return;
            const parsed = JSON.parse(value);
            if (Array.isArray(parsed)) {
              parsed.forEach((item) => reminders.push(item));
            } else if (parsed && typeof parsed === 'object') {
              if (Array.isArray(parsed.items)) parsed.items.forEach((item) => reminders.push(item));
              if (Array.isArray(parsed.reminders)) parsed.reminders.forEach((item) => reminders.push(item));
            }
          } catch {
            // ignore invalid storage entries
          }
        });

        if (!reminders.length) {
          for (let index = 0; index < localStorage.length; index += 1) {
            const key = localStorage.key(index);
            if (!key || triedKeys.has(key) || !/remind/i.test(key)) continue;
            triedKeys.add(key);
            try {
              const value = localStorage.getItem(key);
              if (!value) continue;
              const parsed = JSON.parse(value);
              if (Array.isArray(parsed)) {
                parsed.forEach((item) => reminders.push(item));
              } else if (parsed && typeof parsed === 'object') {
                if (Array.isArray(parsed.items)) parsed.items.forEach((item) => reminders.push(item));
                if (Array.isArray(parsed.reminders)) parsed.reminders.forEach((item) => reminders.push(item));
              }
            } catch {
              // ignore
            }
          }
        }

        return reminders.map(normaliseReminder).filter(Boolean);
      };

      const collectReminders = () => {
        const fromDom = collectFromDom();
        if (fromDom.length) return fromDom;
        return collectFromStorage();
      };

      const toggleBusy = (isBusy) => {
        if (isBusy) {
          syncAllBtn?.setAttribute('aria-busy', 'true');
          syncAllBtn?.setAttribute('disabled', 'disabled');
          testSyncBtn?.setAttribute('aria-busy', 'true');
          testSyncBtn?.setAttribute('disabled', 'disabled');
        } else {
          syncAllBtn?.removeAttribute('aria-busy');
          testSyncBtn?.removeAttribute('aria-busy');
          updateButtonState();
        }
      };

      const updateButtonState = () => {
        const hasUrl = Boolean((syncUrlInput?.value || '').trim() || getStoredUrl());
        if (hasUrl) {
          syncAllBtn?.removeAttribute('disabled');
          testSyncBtn?.removeAttribute('disabled');
        } else {
          syncAllBtn?.setAttribute('disabled', 'disabled');
          testSyncBtn?.setAttribute('disabled', 'disabled');
        }
      };

      const storedUrl = getStoredUrl();
      if (syncUrlInput && storedUrl) {
        syncUrlInput.value = storedUrl;
      }

      updateButtonState();
      setStatus(navigator.onLine ? 'online' : 'offline');

      window.addEventListener('online', updateOnlineState);
      window.addEventListener('offline', updateOnlineState);

      syncUrlInput?.addEventListener('input', updateButtonState);

      saveSettingsBtn?.addEventListener('click', () => {
        const value = (syncUrlInput?.value || '').trim();
        if (!value) {
          persistUrl('');
          setStatus('info', 'Sync URL cleared. Add one to enable sync.');
          updateButtonState();
          return;
        }

        try {
          const parsed = new URL(value);
          if (!/^https?:/.test(parsed.protocol)) {
            throw new Error('Invalid protocol');
          }
        } catch {
          setStatus('error', 'Enter a valid sync URL before saving.');
          return;
        }

        persistUrl(value);
        setStatus('online', 'Sync settings saved.');
        updateButtonState();
      });

      testSyncBtn?.addEventListener('click', async () => {
        const url = (syncUrlInput?.value || getStoredUrl()).trim();
        if (!url) {
          setStatus('error', 'Add your sync URL in Settings first.');
          return;
        }

        toggleBusy(true);
        setStatus('syncing', 'Testing connection');

        try {
          const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ test: true }),
          });
          if (response.ok) {
            setStatus('online', 'Connection looks good.');
          } else {
            setStatus('error', 'Test failed. Check your Apps Script deployment.');
          }
        } catch (error) {
          console.error('Test sync failed', error);
          setStatus('error', 'Test failed. Check your Apps Script deployment.');
        } finally {
          toggleBusy(false);
        }
      });

      syncAllBtn?.addEventListener('click', async () => {
        const url = (syncUrlInput?.value || getStoredUrl()).trim();
        if (!url) {
          setStatus('error', 'Add your sync URL in Settings first.');
          return;
        }

        const reminders = collectReminders();
        if (!reminders.length) {
          setStatus('info', 'Nothing to sync right now.');
          return;
        }

        toggleBusy(true);
        setStatus('syncing', `Syncing ${reminders.length} reminder${reminders.length === 1 ? '' : 's'}`);

        const chunkSize = 20;
        let okCount = 0;
        let failCount = 0;

        const makePayload = (reminder) => ({
          id: reminder.id,
          title: reminder.title,
          dueIso: reminder.dueIso || null,
          priority: reminder.priority || 'Medium',
          category: reminder.category || 'General',
          done: Boolean(reminder.done),
          source: 'memory-cue-mobile',
        });

        try {
          for (let index = 0; index < reminders.length; index += chunkSize) {
            const slice = reminders.slice(index, index + chunkSize);
            const results = await Promise.allSettled(slice.map((reminder) => (
              fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(makePayload(reminder)),
              })
            )));

            results.forEach((result) => {
              if (result.status === 'fulfilled' && result.value?.ok) {
                okCount += 1;
              } else if (result.status === 'fulfilled') {
                failCount += 1;
              } else {
                failCount += 1;
              }
            });

            await new Promise((resolve) => setTimeout(resolve, 300));
          }

          if (!failCount) {
            setStatus('online', `Sync complete. ${okCount} updated.`);
          } else if (!okCount) {
            setStatus('error', 'Sync failed. Check your sync URL and retry.');
          } else {
            setStatus('error', `Partial sync: ${okCount} success, ${failCount} failed.`);
          }
        } catch (error) {
          console.error('Sync failed', error);
          setStatus('error', 'Sync failed. Try again soon.');
        } finally {
          toggleBusy(false);
        }
      });
    })();
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const homeBtn = document.querySelector('header.sticky [aria-label="Go to home"]');

      // Locate reminders section or fall back to the document body
      const remindersSection =
        document.getElementById('remindersWrapper') ||
        document.querySelector('[data-section="reminders"]') ||
        document.getElementById('reminders') ||
        document.body;

      if (homeBtn && remindersSection) {
        homeBtn.addEventListener('click', () => {
          remindersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      }
    });
  </script>

  <!-- Enhanced Notes Functionality -->
  <script>
    (function() {
      // Enhanced Notes Editor
      const notesEditor = document.getElementById('notes');
      const notesToolbar = document.getElementById('notesToolbar');
      const notesStatus = document.getElementById('notesStatusText');
      const notesSyncStatus = document.getElementById('notesSyncStatus');
      const notesWordCount = document.getElementById('notesWordCount');
      const searchPanel = document.getElementById('searchPanel');
      const searchInput = document.getElementById('searchInput');
      const searchResults = document.getElementById('searchResults');

      if (!notesEditor) return;

      let autoSaveTimeout;
      let currentSearchIndex = 0;
      let searchMatches = [];

      const FALLBACK_FIREBASE_CONFIG = Object.freeze({
        apiKey: 'AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c',
        authDomain: 'memory-cue-app.firebaseapp.com',
        projectId: 'memory-cue-app',
        storageBucket: 'memory-cue-app.firebasestorage.app',
        messagingSenderId: '751284466633',
        appId: '1:751284466633:web:3b10742970bef1a5d5ee18',
        measurementId: 'G-R0V4M7VCE6'
      });

      let firebaseContextPromise;
      let firebaseContext;
      let remoteNotesUnsubscribe = null;
      let remoteNotesDocRef = null;
      let remoteSaveTimeout = null;
      let remoteSyncActive = false;
      let isApplyingRemoteUpdate = false;
      let remoteUserId = null;
      let lastStoredLocalContent = '';
      let lastRemoteContent = '';

      const getFirebaseContext = () => {
        if (firebaseContextPromise) {
          return firebaseContextPromise;
        }

        firebaseContextPromise = (async () => {
          try {
            const [appMod, firestoreMod, authMod] = await Promise.all([
              import('https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js'),
              import('https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js'),
              import('https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js'),
            ]);

            const { initializeApp, getApps, getApp } = appMod || {};
            const { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } = firestoreMod || {};
            const { getAuth, onAuthStateChanged } = authMod || {};

            if (
              typeof initializeApp !== 'function' ||
              typeof getFirestore !== 'function' ||
              typeof getAuth !== 'function'
            ) {
              return null;
            }

            const api = window?.memoryCueFirebase || {};
            const configCandidate = typeof api.getFirebaseConfig === 'function'
              ? api.getFirebaseConfig()
              : null;
            const config =
              (configCandidate && typeof configCandidate === 'object' ? configCandidate : null)
              || (api.DEFAULT_FIREBASE_CONFIG ? { ...api.DEFAULT_FIREBASE_CONFIG } : null)
              || FALLBACK_FIREBASE_CONFIG;

            if (!config || !config.projectId) {
              console.warn('Notes sync: Firebase config unavailable; remote sync disabled.');
              return null;
            }

            const app = (typeof getApps === 'function' && getApps().length)
              ? getApp()
              : initializeApp(config);
            const db = getFirestore(app);
            const auth = getAuth(app);

            return {
              app,
              db,
              auth,
              doc,
              onSnapshot,
              setDoc,
              serverTimestamp,
              onAuthStateChanged,
            };
          } catch (error) {
            console.warn('Notes sync: Firebase modules unavailable; remote sync disabled.', error);
            return null;
          }
        })();

        return firebaseContextPromise;
      };

      const stopRemoteNotesSync = () => {
        remoteSyncActive = false;
        remoteNotesDocRef = null;
        remoteUserId = null;
        if (remoteSaveTimeout) {
          clearTimeout(remoteSaveTimeout);
          remoteSaveTimeout = null;
        }
        if (typeof remoteNotesUnsubscribe === 'function') {
          try {
            remoteNotesUnsubscribe();
          } catch (error) {
            console.warn('Notes sync: Unable to clean up listener', error);
          }
        }
        remoteNotesUnsubscribe = null;
      };

      const scheduleRemoteSave = (content) => {
        if (!remoteSyncActive || !firebaseContext || !remoteNotesDocRef) {
          setStatus('saved', 'Saved');
          setTimeout(() => setStatus('ready', 'Ready'), 1500);
          return;
        }

        if (content === lastRemoteContent) {
          setStatus('saved', 'Synced');
          setTimeout(() => setStatus('ready', 'Ready'), 1200);
          return;
        }

        if (remoteSaveTimeout) {
          clearTimeout(remoteSaveTimeout);
        }

        remoteSaveTimeout = setTimeout(async () => {
          try {
            const payload = { content };
            if (remoteUserId) {
              payload.ownerUid = remoteUserId;
            }
            if (typeof firebaseContext.serverTimestamp === 'function') {
              payload.updatedAt = firebaseContext.serverTimestamp();
            } else {
              payload.updatedAt = new Date();
            }
            const user = firebaseContext?.auth?.currentUser;
            console.log(
              'Notes sync debug:',
              'user.uid =',
              user?.uid,
              'remoteNotesDocRef path =',
              remoteNotesDocRef.path
            );
            await firebaseContext.setDoc(remoteNotesDocRef, payload, { merge: true });
            lastRemoteContent = content;
            setStatus('saved', 'Synced');
            setTimeout(() => setStatus('ready', 'Ready'), 1200);
          } catch (error) {
            console.error('Notes sync: Failed to sync notes', error);
            if (error && error.code === 'permission-denied') {
              setStatus('error', 'Sync unavailable');
              stopRemoteNotesSync();
            } else {
              setStatus('error', 'Sync failed');
            }
          }
        }, 400);
      };

      const handleRemoteSnapshot = (snapshot) => {
        if (!snapshot || typeof snapshot.exists !== 'function') {
          return;
        }

        if (!snapshot.exists()) {
          if (lastStoredLocalContent) {
            setStatus('saving', 'Syncing...');
            scheduleRemoteSave(lastStoredLocalContent);
          }
          return;
        }

        const data = snapshot.data();
        const remoteContent = typeof data?.content === 'string' ? data.content : '';
        lastRemoteContent = remoteContent;

        if (remoteContent === (notesEditor.innerHTML || '')) {
          return;
        }

        isApplyingRemoteUpdate = true;
        notesEditor.innerHTML = remoteContent;
        updateWordCount();
        try {
          localStorage.setItem('memory-cue-notes', remoteContent);
          lastStoredLocalContent = remoteContent;
        } catch (error) {
          console.warn('Notes sync: Unable to persist remote notes locally', error);
        }
        setStatus('saved', 'Synced');
        setTimeout(() => setStatus('ready', 'Ready'), 1200);
        isApplyingRemoteUpdate = false;
      };

      const startRemoteNotesSync = (user, context) => {
        if (!user || !context || !context.db || typeof context.doc !== 'function' || typeof context.onSnapshot !== 'function') {
          return;
        }

        stopRemoteNotesSync();
        firebaseContext = context;
        remoteSyncActive = true;
        remoteNotesDocRef = context.doc(context.db, 'users', user.uid, 'notebook', 'scratch');
        remoteUserId = user.uid;

        const ensureRemoteDoc = typeof context.setDoc === 'function'
          ? context.setDoc(remoteNotesDocRef, { ownerUid: user.uid }, { merge: true }).catch((error) => {
              console.error('Notes sync: Unable to prepare remote notebook', error);
              if (error && error.code === 'permission-denied') {
                setStatus('error', 'Sync unavailable');
                stopRemoteNotesSync();
              }
              return null;
            })
          : Promise.resolve(null);

        ensureRemoteDoc.then(() => {
          if (!remoteSyncActive) {
            return;
          }

          try {
            remoteNotesUnsubscribe = context.onSnapshot(remoteNotesDocRef, handleRemoteSnapshot, (error) => {
              console.error('Notes sync: Listener error', error);
              if (error && error.code === 'permission-denied') {
                setStatus('error', 'Sync unavailable');
                stopRemoteNotesSync();
              } else {
                setStatus('error', 'Sync error');
              }
            });
          } catch (error) {
            console.error('Notes sync: Unable to subscribe to updates', error);
            return;
          }

          const initialContent = notesEditor.innerHTML || lastStoredLocalContent;
          if (initialContent && !isApplyingRemoteUpdate) {
            setStatus('saving', 'Syncing...');
            scheduleRemoteSave(initialContent);
          }
        });
      };

      const initRemoteNotebookSync = () => {
        if (initRemoteNotebookSync._started) {
          return;
        }
        initRemoteNotebookSync._started = true;

        getFirebaseContext().then((context) => {
          if (!context || !context.auth || typeof context.onAuthStateChanged !== 'function') {
            return;
          }

          firebaseContext = context;
          context.onAuthStateChanged(context.auth, (user) => {
            if (user && user.uid) {
              startRemoteNotesSync(user, context);
            } else {
              stopRemoteNotesSync();
              setStatus('ready', 'Ready');
            }
          });
        });
      };

      // Auto-save functionality
      const autoSave = () => {
        if (!notesEditor) return;

        const content = notesEditor.innerHTML;
        clearTimeout(autoSaveTimeout);
        setStatus('saving', remoteSyncActive ? 'Syncing...' : 'Saving...');

        autoSaveTimeout = setTimeout(() => {
          try {
            if (content !== lastStoredLocalContent) {
              localStorage.setItem('memory-cue-notes', content);
              lastStoredLocalContent = content;
            }
          } catch (error) {
            console.error('Failed to save notes:', error);
            setStatus('error', 'Save failed');
            setTimeout(autoSave, 3000);
            return;
          }

          if (remoteSyncActive && !isApplyingRemoteUpdate) {
            scheduleRemoteSave(content);
          } else {
            setStatus('saved', 'Saved');
            setTimeout(() => setStatus('ready', 'Ready'), 1500);
          }
        }, 800);
      };

      // Status management
      const setStatus = (state, message) => {
        if (notesStatus) notesStatus.textContent = message;
        if (notesSyncStatus) {
          notesSyncStatus.className = `sync-dot ${state}`;
        }
      };

      // Word count
      const updateWordCount = () => {
        if (!notesWordCount || !notesEditor) return;
        const text = notesEditor.textContent || '';
        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
        notesWordCount.textContent = `${words.length} words`;
      };

      // Load saved notes
      const loadNotes = () => {
        try {
          const saved = localStorage.getItem('memory-cue-notes');
          if (typeof saved === 'string' && saved && notesEditor) {
            notesEditor.innerHTML = saved;
            lastStoredLocalContent = saved;
            lastRemoteContent = saved;
            setStatus('ready', 'Notes loaded');
          } else {
            lastStoredLocalContent = notesEditor.innerHTML || '';
            lastRemoteContent = lastStoredLocalContent;
          }
        } catch (error) {
          console.error('Failed to load notes:', error);
          lastStoredLocalContent = notesEditor.innerHTML || '';
          lastRemoteContent = lastStoredLocalContent;
        }
      };

      // Formatting functions
      const formatText = (command, value = null) => {
        document.execCommand(command, false, value);
        notesEditor.focus();
        autoSave();
      };

      const insertAtCursor = (html) => {
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          range.deleteContents();
          const fragment = range.createContextualFragment(html);
          range.insertNode(fragment);
          range.collapse(false);
          selection.removeAllRanges();
          selection.addRange(range);
        }
        autoSave();
      };

      // Toolbar event handlers
      if (notesToolbar) {
        notesToolbar.addEventListener('click', (e) => {
          const button = e.target.closest('button');
          if (!button) return;

          const action = button.dataset.action;
          e.preventDefault();

          switch(action) {
            case 'bold':
              formatText('bold');
              break;
            case 'italic':
              formatText('italic');
              break;
            case 'strikethrough':
              formatText('strikeThrough');
              break;
            case 'bullets':
              formatText('insertUnorderedList');
              break;
            case 'numbers':
              formatText('insertOrderedList');
              break;
            case 'checklist':
              insertAtCursor('<div class="checklist-item"><span class="checklist-checkbox" role="button" tabindex="0" onclick="toggleCheckbox(this)" onkeypress="if(event.key===\'Enter\')toggleCheckbox(this)"></span><span contenteditable="true">New item</span></div>');
              break;
            case 'heading':
              formatText('formatBlock', 'h2');
              break;
            case 'divider':
              insertAtCursor('<hr>');
              break;
            case 'link':
              const url = prompt('Enter URL:');
              if (url) formatText('createLink', url);
              break;
            case 'clear':
              formatText('removeFormat');
              break;
          }
        });
      }

      // Search functionality
      const performSearch = (query) => {
        if (!query.trim()) {
          clearHighlights();
          updateSearchResults(0);
          return;
        }

        clearHighlights();
        searchMatches = [];
        
        try {
          const content = notesEditor.innerHTML;
          const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const regex = new RegExp(`(${escapedQuery})`, 'gi');
          
          const highlightedContent = content.replace(regex, '<span class="highlight">$1</span>');
          notesEditor.innerHTML = highlightedContent;
          
          searchMatches = Array.from(notesEditor.querySelectorAll('.highlight'));
          updateSearchResults(searchMatches.length);
          
          if (searchMatches.length > 0) {
            currentSearchIndex = 0;
            highlightCurrentMatch();
          }
        } catch (error) {
          console.error('Search error:', error);
          updateSearchResults(0);
        }
      };

      const clearHighlights = () => {
        const highlights = notesEditor.querySelectorAll('.highlight');
        highlights.forEach(highlight => {
          const parent = highlight.parentNode;
          parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
          parent.normalize();
        });
      };

      const highlightCurrentMatch = () => {
        searchMatches.forEach((match, index) => {
          match.style.backgroundColor = index === currentSearchIndex 
            ? 'color-mix(in srgb, var(--primary-color) 40%, transparent)' 
            : 'color-mix(in srgb, var(--warning-color) 25%, transparent)';
        });
        
        if (searchMatches[currentSearchIndex]) {
          searchMatches[currentSearchIndex].scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
        }
      };

      const updateSearchResults = (count) => {
        if (searchResults) {
          searchResults.textContent = count > 0 
            ? `${count} matches found` 
            : 'No matches found';
        }
      };

      // Search controls
      document.getElementById('searchNotes')?.addEventListener('click', () => {
        searchPanel?.classList.toggle('hidden');
        if (!searchPanel?.classList.contains('hidden')) {
          searchInput?.focus();
        } else {
          clearHighlights();
        }
      });

      document.getElementById('closeSearch')?.addEventListener('click', () => {
        searchPanel?.classList.add('hidden');
        clearHighlights();
      });

      searchInput?.addEventListener('input', (e) => {
        performSearch(e.target.value);
      });

      document.getElementById('searchNext')?.addEventListener('click', () => {
        if (searchMatches.length > 0) {
          currentSearchIndex = (currentSearchIndex + 1) % searchMatches.length;
          highlightCurrentMatch();
        }
      });

      document.getElementById('searchPrev')?.addEventListener('click', () => {
        if (searchMatches.length > 0) {
          currentSearchIndex = currentSearchIndex === 0 
            ? searchMatches.length - 1 
            : currentSearchIndex - 1;
          highlightCurrentMatch();
        }
      });

      // Export functionality
      document.getElementById('exportNotes')?.addEventListener('click', () => {
        if (!notesEditor) return;
        
        try {
          const content = notesEditor.textContent || '';
          if (!content.trim()) {
            alert('No content to export');
            return;
          }
          
          // For mobile devices, use share API if available
          if (navigator.share) {
            navigator.share({
              title: 'My Notes',
              text: content,
            }).catch(error => {
              console.log('Error sharing:', error);
              fallbackExport(content);
            });
          } else {
            fallbackExport(content);
          }
        } catch (error) {
          console.error('Export failed:', error);
          alert('Export failed. Please try again.');
        }
      });
      
      const fallbackExport = (content) => {
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `memory-cue-notes-${new Date().toISOString().split('T')[0]}.txt`;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      // Voice notes (integrate with existing voice functionality)
      document.getElementById('voiceNotes')?.addEventListener('click', () => {
        // Trigger existing voice functionality if available
        const voiceBtn = document.getElementById('voiceBtn') || document.getElementById('quickAddVoice');
        if (voiceBtn) {
          voiceBtn.click();
        } else {
          alert('Voice functionality not available');
        }
      });

      // Event listeners
      notesEditor.addEventListener('input', () => {
        updateWordCount();
        autoSave();
      });

      notesEditor.addEventListener('paste', (e) => {
        // Clean pasted content
        setTimeout(() => {
          updateWordCount();
          autoSave();
        }, 100);
      });

      // Keyboard shortcuts
      notesEditor.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key.toLowerCase()) {
            case 'b':
              e.preventDefault();
              formatText('bold');
              break;
            case 'i':
              e.preventDefault();
              formatText('italic');
              break;
            case 'f':
              e.preventDefault();
              document.getElementById('searchNotes')?.click();
              break;
          }
        }
      });

      // Helper function for checkbox toggling
      window.toggleCheckbox = function(element) {
        if (element && element.textContent) {
          element.textContent = element.textContent === '' ? '' : '';
          autoSave();
        }
      };
      
      // Improve mobile keyboard handling
      notesEditor.addEventListener('focus', () => {
        // Prevent zoom on iOS
        if (window.navigator.userAgent.includes('iPhone') || window.navigator.userAgent.includes('iPad')) {
          const viewport = document.querySelector('meta[name="viewport"]');
          if (viewport) {
            viewport.setAttribute('content', viewport.getAttribute('content') + ', user-scalable=no');
          }
        }
      });
      
      notesEditor.addEventListener('blur', () => {
        // Re-enable zoom
        const viewport = document.querySelector('meta[name="viewport"]');
        if (viewport) {
          const content = viewport.getAttribute('content').replace(', user-scalable=no', '');
          viewport.setAttribute('content', content);
        }
      });

      // Initialize
      loadNotes();
      updateWordCount();
      initRemoteNotebookSync();
      setStatus('ready', 'Ready');
      
      // Add mobile-friendly touch handling for toolbar
      if (notesToolbar) {
        notesToolbar.addEventListener('touchstart', (e) => {
          e.preventDefault(); // Prevent double-tap zoom
        }, { passive: false });
      }
    })();
  </script>

</body>
</html>
