import{a as Ii}from"./chunk-RCZ4YZVR.js";function Sn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function En(){let d=Sn(),g=d&&d.TimestampTrigger;return typeof g=="function"?g:null}function oe(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!En()}function Ai(){if(typeof window>"u"||!window.location)return Ht;try{return new URL(Ht,window.location.href).href}catch{return Ht}}async function ue(){return St||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(St=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Ai()),await navigator.serviceWorker.ready}catch(d){return console.warn("Service worker registration failed",d),null}})(),St))}async function wn(d){if(!d||typeof d!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let g=await ue();if(!g)return!1;let D=new Set;navigator.serviceWorker.controller&&D.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(O=>{let $=g[O];$&&D.add($)});let I=!1;return D.forEach(O=>{try{O.postMessage(d),I=!0}catch($){console.warn("Failed posting message to service worker",$)}}),I}catch(g){return console.warn("Unable to reach service worker",g),!1}}async function Et(){if(oe())return!1;if(qt)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(He)try{return await He}catch{}He=(async()=>{let d=await ue();if(!d)return!1;let g=!1;if("periodicSync"in d)try{let D=await d.periodicSync.getTags();(!Array.isArray(D)||!D.includes(Yt))&&await d.periodicSync.register(Yt,{minInterval:15*60*1e3}),g=!0}catch(D){console.warn("Periodic background sync unavailable",D)}if(!g&&"sync"in d)try{await d.sync.register(Yt),g=!0}catch(D){console.warn("Background sync unavailable",D)}return g})();try{let d=await He;return d&&(qt=!0),d}catch(d){return console.warn("Background reminder sync setup failed",d),qt=!1,!1}finally{He=null}}async function Vt(d=[],{requestCheck:g=!1}={}){if(!oe()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let D=await ue();if(!D)return;let I=await wn({type:vn.updateScheduledReminders,reminders:Array.isArray(d)?d:[]});if(g&&await wn({type:vn.checkScheduledReminders}),!I&&typeof D.update=="function")try{await D.update()}catch{}}catch(D){console.warn("Failed syncing reminders with service worker",D)}}async function Gt(d,g){if(oe())try{let D=g||await ue();if(!D)return;let I=[];try{I=await D.getNotifications({tag:d,includeTriggered:!0})}catch{I=await D.getNotifications({tag:d})}for(let O of I)try{O.close()}catch{}}catch{}}function In(){for(let d of Array.from(ie.values()))try{d.close()}catch{}ie.clear()}function Li(){if(bn||typeof window>"u"||typeof window.addEventListener!="function")return;let d=()=>In();["pagehide","beforeunload"].forEach(g=>{try{window.addEventListener(g,d)}catch{}}),bn=!0}function B(d){if(typeof d=="string"){let g=d.replace(/\s+/g," ").trim();if(g)return g}return _}async function Ci(d={}){let g=e=>e?document.querySelector(e):null,D=e=>e?Array.from(document.querySelectorAll(e)):[],I=g(d.titleSel),O=g(d.dateSel),$=g(d.timeSel),J=g(d.detailsSel),fe=g(d.prioritySel),F=g(d.categorySel),Le=g(d.saveBtnSel),It=g(d.cancelEditBtnSel),S=g(d.listSel),Ye=D(d.googleSignInBtnSel),qe=D(d.googleSignOutBtnSel),x=g(d.statusSel),R=g(d.syncStatusSel),Tn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},An=6e3,G=null;function we(e,{clearMessage:t=!0}={}){G&&(e&&G.tokenId!==e||(G.timeoutId&&clearTimeout(G.timeoutId),t&&x&&x.dataset.undoToken===G.tokenId&&(typeof x.replaceChildren=="function"?x.replaceChildren():x.textContent="",delete x.dataset.undoToken,delete x.dataset.statusKind),G=null))}function Ln(e){if(!x)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>bi(e.tokenId)),e.button=i,typeof x.replaceChildren=="function"?x.replaceChildren(t,n,i):(x.textContent="",x.append(t,n,i)),x.dataset.statusKind="undo",x.dataset.undoToken=e.tokenId}function Tt(e,t){if(!R)return;let n=["online","offline","error"];n.forEach(r=>R.classList.remove(r)),n.includes(e)&&R.classList.add(e),R.dataset.state=e;let i=typeof t=="string"?t:Tn[e]||"";e==="online"||e==="offline"?(R.textContent="",R.dataset.compact="true",i?(R.setAttribute("aria-label",i),R.setAttribute("title",i)):(R.removeAttribute("aria-label"),R.removeAttribute("title"))):(R.textContent=i,R.removeAttribute("data-compact"),i?(R.setAttribute("aria-label",i),R.setAttribute("title",i)):(R.removeAttribute("aria-label"),R.removeAttribute("title")))}let U=g(d.notesSel),Dn=g(d.saveNotesBtnSel),xn=g(d.loadNotesBtnSel),Xt=g(d.countTotalSel),We=g(d.googleUserNameSel),pe=g(d.dateFeedbackSel),Y=g(d.voiceBtnSel),kn=g(d.notifBtnSel),De=g(d.moreBtnSel),xe=g(d.moreMenuSel),Cn=g(d.copyMtlBtnSel),At=g(d.importFileSel),Nn=g(d.exportBtnSel),Rn=g(d.syncAllBtnSel),Se=g(d.syncUrlInputSel),Mn=g(d.saveSettingsSel),Fn=g(d.testSyncSel),Bn=D(d.openSettingsSel),Ve=g(d.settingsSectionSel),Ee=g(d.emptyStateSel),zt=g(d.listWrapperSel),Lt=g(d.categoryOptionsSel),me=d.variant||"mobile",Jt="mc:lastDefaults";function Dt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Jt)||"{}")||{}}catch{return{}}}function On(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Jt,JSON.stringify(e))}catch{}}function Kt(e){let t=Dt(),n={category:B(e?.category||t.category||_),priority:e?.priority||t.priority||"Medium"};On(n)}let Qt='fieldset#priorityChips input[name="priority"]';function xt(){try{let e=document.querySelector(`${Qt}:checked`);if(e&&e.value)return e.value}catch{}return fe&&typeof fe.value=="string"&&fe.value?fe.value:"Medium"}function Ge(e){let t=e||"Medium";fe&&typeof fe.value<"u"&&(fe.value=t);try{let n=Array.from(document.querySelectorAll(Qt));if(!n.length)return;let i=!1;if(n.forEach(o=>{let r=o.value===t;o.checked=r,i=i||r}),!i){let o=n.find(r=>r.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function Zt(){let e=Dt();e.category&&F&&(F.value=e.category),e.priority&&Ge(e.priority)}Zt();let q=typeof document<"u"?document.getElementById("quickAddInput"):null,$n=typeof document<"u"?document.getElementById("quickAddSubmit"):null,W=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,kt=null;function Pn(e,t){let n=Date.now(),i=Dt(),o=typeof t=="string"&&t?t:null;return{id:pt(),title:(e||"").trim(),priority:i.priority||xt(),category:B(i.category||F?.value||_),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!j}}async function Ct(){if(!q)return;if(typeof kt=="function")try{kt()}catch{}let e=(q.value||"").trim();if(!e)return;let t=null;try{let o=ht(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=Pn(e,t);Mt(n,{position:"start"}),a.unshift(n),X(a);let i=$e(a);ye=!0,N(),P(),i?a.forEach(o=>H(o)):H(n),_e(n),be(n),ce(),Kt(n),ke();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:a}}))}catch{}K({action:"created",label:`Reminder added \xB7 ${n.title}`}),q.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Ct),$n?.addEventListener("click",()=>{Ct()}),q?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Ct())});function _n(){if(typeof HTMLElement>"u"||!(W instanceof HTMLElement)||!(q instanceof HTMLInputElement)||W.dataset.voiceBound==="true")return;if(W.dataset.voiceBound="true",typeof window>"u"){W.setAttribute("disabled","true"),W.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){W.setAttribute("disabled","true"),W.setAttribute("aria-disabled","true"),W.getAttribute("title")||(W.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=s=>{n=s,W.setAttribute("aria-pressed",s?"true":"false"),W.dataset.listening=s?"true":"false",W.classList.toggle("is-listening",s)},o=()=>{if(t)return t;t=new e;let s=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=s,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",m=>{let y=m?.results?.[0]?.[0]?.transcript?.trim()||"";if(y){q.value=y;try{q.focus({preventScroll:!0})}catch{q.focus()}try{let b=q.value.length;typeof q.setSelectionRange=="function"&&q.setSelectionRange(b,b)}catch{}}});let u=()=>{i(!1)};return t.addEventListener("end",u),t.addEventListener("error",u),t},r=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};kt=r,W.addEventListener("click",()=>{let s=o();if(s){if(n){r();return}try{s.start(),i(!0)}catch(u){console.warn("Quick add voice error:",u),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",r),i(!1)}_n(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&q&&(e.preventDefault(),q.focus())})));try{me==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Un=d.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",en=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,jn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Xe=d.reminderLandingPath||(me==="desktop"?"index.html#reminders":"mobile.html"),re=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function tn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function ke(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:a}}))}catch{}}F&&!F.value&&(F.value=_),oe()&&ue();function K(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(hn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(hn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function Hn(){if(typeof HTMLElement>"u"||!(Y instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&I instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&I instanceof HTMLTextAreaElement;if(!e&&!t||Y.dataset.voiceBound==="true")return;if(Y.dataset.voiceBound="true",typeof window>"u"){Y.setAttribute("disabled","true"),Y.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){Y.setAttribute("disabled","true"),Y.setAttribute("aria-disabled","true"),Y.getAttribute("title")||(Y.title="Voice input is not supported in this browser.");return}let i=null,o=!1,r=y=>{o=y,Y.setAttribute("aria-pressed",y?"true":"false"),Y.dataset.listening=y?"true":"false",Y.classList.toggle("is-listening",y)},s=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",b=>{let A=b.results?.[0]?.[0]?.transcript?.trim()||"";if(A){I.value=A;try{I.focus({preventScroll:!0})}catch{try{I.focus()}catch{}}try{let k=I.value.length;typeof I.setSelectionRange=="function"&&I.setSelectionRange(k,k)}catch{}K({action:"dictated",label:`Voice input captured \xB7 ${A}`})}});let y=()=>{r(!1)};return i.addEventListener("end",y),i.addEventListener("error",y),i},u=()=>{if(!(!o||!i)){try{i.stop()}catch{}r(!1)}};Y.addEventListener("click",()=>{let y=s();if(y){if(o){u();return}try{y.start(),r(!0)}catch(b){console.warn("Speech recognition error:",b),r(!1)}}});let m=()=>{u()};typeof document<"u"&&(document.addEventListener("cue:close",m),document.addEventListener("reminders:updated",m)),r(!1)}Li(),Hn();let ze,Je,Ke,Qe,Ie,Ze,et,tt,nt,it,ot,Ce,Ne,rt,at,st,dt,ct,lt,nn=d.firebaseDeps,Nt=typeof d.importModule=="function"?d.importModule:e=>import(e),Re=Sn(),Me=!1,Q=!1,Rt=null,te=null,ge=null,a=[],ye=!1,j=null,Fe=null,Be=null,he={},M={};function X(e=a){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?cn(t||{},n||{}):o-i})}function Yn(e=a){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function Oe(e=a){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),X(n);else{n=e.slice().sort(cn);let i=n.length;n.forEach((o,r)=>{o.orderIndex=(i-r)*ee})}return e===a&&(a=n),n}function Mt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Yn();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-ee||ee}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+ee||ee}}function $e(e=a){if(!Array.isArray(e)||e.length<2)return!1;X(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],r=Number.isFinite(i?.orderIndex)?i.orderIndex:null,s=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(r==null||s==null||r<=s||r-s<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*ee;return e===a&&X(a),!0}let T={draggingId:null,dropTargetId:null,dropBefore:!0},on=!1,l={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function qn(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Pe(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function ae(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function Ft(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),ae(),T.draggingId=null,T.dropTargetId=null,T.dropBefore=!0}function rn(e,t,n){if(!e||e===t)return;let i=a.findIndex(k=>k?.id===e);if(i<0)return;let[o]=a.splice(i,1),r;if(!t)r=a.length;else{let k=a.findIndex(V=>V?.id===t);if(k<0){a.splice(i,0,o);return}r=n?k:k+1}a.splice(r,0,o);let s=a[r-1],u=a[r+1],m=Number.isFinite(s?.orderIndex)?s.orderIndex:null,y=Number.isFinite(u?.orderIndex)?u.orderIndex:null,b;m!=null&&y!=null?b=(m+y)/2:m!=null?b=m-ee:y!=null?b=y+ee:b=ee,Number.isFinite(b)||(b=ee*(a.length+1)),o.orderIndex=b,X(a);let A=$e(a);ye=!0,N(),P(),A?a.forEach(k=>H(k)):H(o),ke(),re("memoryCue:remindersUpdated",{items:a}),K({action:"reordered",label:"Reminders reordered"})}function Wn(e){let t=Pe(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(T.draggingId=i,T.dropTargetId=null,T.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Vn(e){if(!T.draggingId)return;let t=Pe(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),T.dropTargetId=null,T.dropBefore=!1,ae(),S?.classList.add("drag-over-list");return}if(t.dataset.id===T.draggingId){e.preventDefault(),ae();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(T.dropTargetId!==t.dataset.id||T.dropBefore!==o)&&(ae(),t.classList.add(o?"drag-over-before":"drag-over-after"),T.dropTargetId=t.dataset.id,T.dropBefore=o)}function Gn(e){let t=Pe(e.target);if(!t){S?.contains(e.relatedTarget)||ae();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function Xn(e){if(!T.draggingId)return;e.preventDefault();let t=Pe(e.target),n=t?.dataset.id||null,i=T.dropBefore;if(t){let o=t.getBoundingClientRect(),r=o.top+o.height/2;i=e.clientY<r}else n=null,i=!1;rn(T.draggingId,n,i),Ft()}function zn(){Ft()}function Jn(){!S||on||(on=!0,S.addEventListener("dragstart",Wn),S.addEventListener("dragover",Vn),S.addEventListener("drop",Xn),S.addEventListener("dragend",zn),S.addEventListener("dragleave",Gn),ut())}function ut(){if(!S||ut._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){ut._bound=!0;return}let t=6,n=160;function i(){l.longPressTimer&&(clearTimeout(l.longPressTimer),l.longPressTimer=null)}function o(){S&&(l.initialTouchAction!=null?S.style.touchAction=l.initialTouchAction:S.style.removeProperty("touch-action"))}function r({keepHighlights:h=!1}={}){if(i(),l.item&&l.pointerId!=null)try{l.item.hasPointerCapture?.(l.pointerId)&&l.item.releasePointerCapture(l.pointerId)}catch{}if(l.placeholder?.parentNode)try{l.placeholder.parentNode.removeChild(l.placeholder)}catch{}l.item&&(l.item.classList.remove("is-dragging"),l.originalStyles?l.item.setAttribute("style",l.originalStyles):l.item.removeAttribute("style")),o(),h||ae(),Object.assign(l,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function s(h){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(E=>E!==h):[]}function u(h){let E=l.item;if(!E||l.ready)return;let L=E.getBoundingClientRect(),c=window.getComputedStyle(E);l.ready=!0,T.draggingId=E.dataset.id||null,l.offsetY=h.clientY-L.top,l.fixedX=L.left;let f=document.createElement("div");f.className="touch-drag-placeholder",f.setAttribute("aria-hidden","true"),f.style.height=`${L.height}px`,f.style.boxSizing="border-box",f.style.marginTop=c.marginTop,f.style.marginBottom=c.marginBottom,f.style.marginLeft=c.marginLeft,f.style.marginRight=c.marginRight,f.style.borderRadius=c.borderRadius,f.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",f.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",f.style.pointerEvents="none",f.style.display="block",f.style.width="100%",E.parentNode?.insertBefore(f,E),l.placeholder=f,l.longPressTimer=null,l.originalStyles=E.getAttribute("style")||"",E.classList.add("is-dragging"),E.style.position="fixed",E.style.left=`${L.left}px`,E.style.top=`${L.top}px`,E.style.width=`${L.width}px`,E.style.zIndex="999",E.style.pointerEvents="none",E.style.touchAction="none",l.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function m(h){let E=l.item;if(!E||!l.ready)return;let L=h-l.offsetY;E.style.top=`${L}px`,E.style.left=`${l.fixedX}px`}function y(h){if(!l.ready||!S)return;let E=l.item,L=s(E);if(ae(),!L.length){T.dropTargetId=null,T.dropBefore=!1;return}let c=null,f=!1;for(let z of L){let le=z.getBoundingClientRect(),Ae=le.top+le.height/2;if(h<Ae){c=z,f=!0;break}}if(!c){c=L[L.length-1];let z=c.getBoundingClientRect(),le=z.top+z.height/2;f=h<le,f||(f=!1)}if(!c){T.dropTargetId=null,T.dropBefore=!1;return}let p=c.getBoundingClientRect(),w=p.top+p.height/2,C=h<w;c.classList.add(C?"drag-over-before":"drag-over-after"),T.dropTargetId=c.dataset.id||null,T.dropBefore=C}function b(h){let E=T.draggingId,L=l.moved;if(!l.ready){r();return}r(),!h&&L&&E&&rn(E,T.dropTargetId,T.dropBefore),Ft()}function A(h){let E=h.pointerType||"";if(E&&E!=="touch"&&E!=="pen"||l.active)return;let L=Pe(h.target);if(!L)return;let c=qn(h.target);if(!(c&&c!==L)){l.active=!0,l.pointerId=h.pointerId,l.item=L,l.startX=h.clientX,l.startY=h.clientY,l.lastClientX=h.clientX,l.lastClientY=h.clientY,l.moved=!1,l.ready=!1,l.originalStyles=L.getAttribute("style")||"",l.startTime=h.timeStamp||Date.now(),T.dropTargetId=null,T.dropBefore=!0,T.draggingId=null,i(),l.longPressTimer=setTimeout(()=>{u({clientY:l.lastClientY})},n);try{L.setPointerCapture(h.pointerId)}catch{}}}function k(h){if(!l.active||h.pointerId!==l.pointerId)return;let E=h.pointerType||"";if(!(E&&E!=="touch"&&E!=="pen")){if(l.lastClientX=h.clientX,l.lastClientY=h.clientY,!l.ready){let L=Math.abs(h.clientX-l.startX),c=Math.abs(h.clientY-l.startY);if(L>t||c>t){let f=typeof h.timeStamp=="number"?h.timeStamp:Date.now();Math.abs(f-l.startTime)>=n?(i(),u({clientY:l.lastClientY})):r()}return}h.preventDefault(),l.moved=!0,m(h.clientY),y(h.clientY)}}function V(h){!l.active||h.pointerId!==l.pointerId||b(!1)}function ve(h){!l.active||h.pointerId!==l.pointerId||b(!0)}S.addEventListener("pointerdown",A),window.addEventListener("pointermove",k),window.addEventListener("pointerup",V),window.addEventListener("pointercancel",ve),ut._bound=!0}function an(){j=null,Tt("offline"),Ye.forEach(e=>e.classList.remove("hidden")),qe.forEach(e=>e.classList.add("hidden")),We&&(We.textContent=""),Fe?.(),Fe=null,Ot(),N(),P(),ce()}function Bt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Wt);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,r=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:pt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:B(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(r)?r:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Kn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Wt);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:B(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(Wt,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function P(){X(a),Kn(a)}function Ot(){a=Oe(Bt())}Ot();async function Qn(){if(!j){a=Bt();return}let e=Oe(Bt());if(!e.length){a=[],P();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await H(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}a=Oe(e.map(n=>({...n,pendingSync:!1}))),P(),N(),ce()}try{M=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{M={}}if(M&&typeof M=="object"&&Object.values(M).forEach(e=>{e&&typeof e=="object"&&(e.category=B(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:je(e),e.urlPath=e.urlPath||Xe,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!oe()){let e=mn();typeof Notification<"u"&&Notification.permission==="granted"?(Et(),e.length&&Vt(e,{requestCheck:!0})):e.length&&Vt(e)}let ft=e=>{if(!Re)return;let t=[Re];Re.window&&!t.includes(Re.window)&&t.push(Re.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Zn(){if(!U)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",r=()=>"value"in U?U.value:U.innerHTML,s=b=>{if("value"in U){U.value=b;return}if(typeof b!="string"||b.length===0){U.innerHTML="";return}let A=b.trim();if(/<\/?[a-z][\s\S]*>/i.test(A)){U.innerHTML=b;return}let V=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");U.innerHTML=V},u=b=>{b?U.classList.add("notes-editor--columns"):U.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!b))},m="";try{m=localStorage.getItem(n)||""}catch{v("Unable to access saved notes")}s(m);let y=!1;try{y=localStorage.getItem(i)==="1"}catch{y=!1}u(y),U.addEventListener("input",()=>{m=r();try{localStorage.setItem(n,m)}catch{v("Notes saved for this session only")}}),Dn?.addEventListener("click",()=>{m=r();try{localStorage.setItem(n,m),v("Notes saved")}catch{v("Notes saved for this session only")}}),xn?.addEventListener("click",()=>{let b=m;try{b=localStorage.getItem(n)||m}catch{v("Unable to load saved notes")}m=b,s(m)}),e?.addEventListener("click",b=>{let A=b.target;if(!(A instanceof Element))return;let k=A.closest("button[data-action]");if(!k)return;let V=k.getAttribute("data-action");if(V==="columns"){let ve=!U.classList.contains("notes-editor--columns");u(ve);try{localStorage.setItem(i,ve?"1":"0")}catch{v("Column preference saved for this session only")}return}if(!o){v("Formatting controls are not supported in this browser");return}U.focus(),V==="bullets"?document.execCommand("insertUnorderedList"):V==="numbers"&&document.execCommand("insertOrderedList")})}if(Zn(),Le?.addEventListener("click",yn),nn)({initializeApp:ze,getFirestore:Je,enableMultiTabIndexedDbPersistence:Ke,enableIndexedDbPersistence:Qe,doc:Ie,setDoc:Ze,deleteDoc:et,onSnapshot:tt,collection:nt,query:it,orderBy:ot,serverTimestamp:Ce,getAuth:Ne,onAuthStateChanged:rt,GoogleAuthProvider:at,signInWithPopup:st,signInWithRedirect:dt,getRedirectResult:ct,signOut:lt}=nn),Me=!0;else try{({initializeApp:ze}=await Nt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Je,enableMultiTabIndexedDbPersistence:Ke,enableIndexedDbPersistence:Qe,doc:Ie,setDoc:Ze,deleteDoc:et,onSnapshot:tt,collection:nt,query:it,orderBy:ot,serverTimestamp:Ce}=await Nt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ne,onAuthStateChanged:rt,GoogleAuthProvider:at,signInWithPopup:st,signInWithRedirect:dt,getRedirectResult:ct,signOut:lt}=await Nt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Me=!0}catch(e){Me=!1,console.warn("Firebase modules failed to load:",e),v("Firebase failed to load; notes available offline"),ft(!1)}if(Me&&typeof ze=="function"&&typeof Je=="function"&&typeof Ne=="function")try{Rt=ze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),te=Je(Rt),Q=!0,ft(!0)}catch(e){Q=!1,console.warn("Firebase initialization failed:",e),v("Firebase failed to load; notes available offline"),ft(!1)}else Me?(Q=!1,ft(!1)):Q=!1;Q&&typeof Ke=="function"&&typeof Qe=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ke(te),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Qe(te),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),Q&&typeof Ne=="function"&&(ge=Ne(Rt));function ei(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let ti=typeof navigator<"u"&&navigator.language?navigator.language:"",sn=ei(ti),Te=sn||"en-US",ne="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(ne=e.timeZone),!sn&&e.locale&&(Te=e.locale)}catch{}let ni=new Intl.DateTimeFormat(Te,{timeZone:ne,hour:"2-digit",minute:"2-digit"}),ii=new Intl.DateTimeFormat(Te,{timeZone:ne,weekday:"long",day:"numeric",month:"long"}),oi=new Intl.DateTimeFormat("en-CA",{timeZone:ne,year:"numeric",month:"2-digit",day:"2-digit"}),ri=new Intl.DateTimeFormat(Te,{timeZone:ne,weekday:"long"}),ai=new Intl.DateTimeFormat(Te,{timeZone:ne,month:"short",day:"numeric"});function se(e){let t=oi.formatToParts(e),n=t.find(r=>r.type==="year").value,i=t.find(r=>r.type==="month").value,o=t.find(r=>r.type==="day").value;return`${n}-${i}-${o}`}function dn(e,t){let[n,i,o]=e.split("-").map(m=>parseInt(m,10)),[r,s]=t.split(":").map(m=>parseInt(m,10)),u=new Date;return u.setFullYear(n,(i||1)-1,o||1),u.setHours(r||0,s||0,0,0),u.toISOString()}let si=new Intl.DateTimeFormat("en-CA",{timeZone:ne,year:"numeric",month:"2-digit",day:"2-digit"}),di=new Intl.DateTimeFormat("en-CA",{timeZone:ne,hour:"2-digit",minute:"2-digit",hour12:!1});function ci(e){try{let t=new Date(e),n=si.formatToParts(t),i=n.find(s=>s.type==="year")?.value||"0000",o=n.find(s=>s.type==="month")?.value||"00",r=n.find(s=>s.type==="day")?.value||"00";return`${i}-${o}-${r}`}catch{return""}}function li(e){try{let t=new Date(e),n=di.formatToParts(t),i=n.find(r=>r.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(r=>r.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function pt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function mt(){return se(new Date)}function ui(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function xi(e){let t=ui(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function gt(e){return e==="High"?3:e==="Medium"?2:1}function cn(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,r=t?.due?new Date(t.due).getTime():1/0;if(o!==r)return o-r;let s=gt(t?.priority)-gt(e?.priority);return s||(t?.updatedAt||0)-(e?.updatedAt||0)}function ki(e,t){let n=gt(t.priority)-gt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function $t(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return ii.format(t)}catch{return e}}function yt(e){return ni.format(e)}function de(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ln(e){return e?de(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function v(e){x&&(we(),x.dataset.statusKind="toast",x.textContent=e,clearTimeout(v._t),v._t=setTimeout(()=>{x&&x.dataset.statusKind==="toast"&&(x.textContent="",delete x.dataset.statusKind)},2500))}function fi(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function ht(e){e=String(e||"").toLowerCase();let t={date:mt(),time:""},n=u=>{let m=new Date,y=m.getDay(),b=(u-y+7)%7,A=new Date(m);return A.setDate(m.getDate()+(b===0?7:b)),A},i=u=>{let m=new Date,y=m.getDay(),b=(u-y+7)%7,A=new Date(m);return A.setDate(m.getDate()+b),A},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},r={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let u=new Date;u.setDate(u.getDate()+1),t.date=se(u)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=o[u[1]],y=n(m);t.date=se(y)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=o[u[1]],y=i(m);t.date=se(y)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=o[u[1]],y=n(m);t.date=se(y)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let u=e.match(/\bin\s+(\d+)\s+days?\b/),m=parseInt(u[1],10),y=new Date;y.setDate(y.getDate()+m),t.date=se(y)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let u=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),m=parseInt(u[1],10),y=parseInt(u[2],10)-1,b=u[3]?parseInt(u[3],10):new Date().getFullYear(),A=new Date(b,y,m);t.date=se(A)}else for(let[u,m]of Object.entries(r)){let y=new RegExp(`\\b${u}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(y.test(e)){let b=e.match(y),A=parseInt(b[1],10),k=new Date().getFullYear(),V=new Date(k,m,A);t.date=se(V);break}}let s=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(s){let u=parseInt(s[1],10),m=s[2]?parseInt(s[2],10):0,y=s[3];y&&(y==="pm"&&u<12&&(u+=12),y==="am"&&u===12&&(u=0)),t.time=`${String(u).padStart(2,"0")}:${String(m).padStart(2,"0")}`}return t}let bt=Q&&ge&&typeof at=="function";if(Ye.length){let e=async()=>{if(!bt||typeof st!="function"||typeof dt!="function"){v("Sign-in unavailable offline");return}let t=new at;try{await st(ge,t)}catch{try{await dt(ge,t)}catch{v("Google sign-in failed")}}};Ye.forEach(t=>{t.addEventListener("click",e)})}if(bt&&typeof ct=="function"&&ct(ge).catch(()=>{}),qe.length){let e=async()=>{if(!bt||typeof lt!="function"){v("Sign-out unavailable offline");return}try{await lt(ge),v("Signed out")}catch{v("Sign-out failed")}};qe.forEach(t=>{t.addEventListener("click",e)})}bt&&typeof rt=="function"?rt(ge,async e=>{e?(j=e.uid,Tt("online"),Ye.forEach(t=>t.classList.add("hidden")),qe.forEach(t=>t.classList.remove("hidden")),We&&(We.textContent=e.displayName||e.email||""),pi(),await Qn()):an()}):an();function pi(){if(!Q||!te||typeof nt!="function"||typeof it!="function"||typeof ot!="function"||typeof tt!="function")return;if(!j){Ot(),N(),P(),ce();return}Fe&&Fe();let e=nt(te,"users",j,"reminders"),t=it(e,ot("updatedAt","desc"));Fe=tt(t,n=>{let i=[];n.forEach(o=>{let r=o.data(),s=Number(r.orderIndex);i.push({id:o.id,title:r.title,priority:r.priority,notes:r.notes||"",done:!!r.done,due:r.due||null,category:B(r.category),createdAt:r.createdAt?.toMillis?.()||0,updatedAt:r.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(s)?s:null})}),a=Oe(i),N(),P(),ce()},n=>{console.error("Firestore sync error:",n),R&&Tt("error","Sync Error")})}async function H(e){if(!(!Q||!j||!te||typeof Ie!="function"||typeof Ze!="function"||typeof Ce!="function"))try{await Ze(Ie(te,"users",j,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||_,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):Ce(),updatedAt:Ce()},{merge:!0})}catch(t){console.error("Save failed:",t),v("Save queued (offline)")}}async function mi(e){if(!(!Q||!j||!te||typeof Ie!="function"||typeof et!="function"))try{await et(Ie(te,"users",j,"reminders",e))}catch{v("Delete queued (offline)")}}async function _e(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||_,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ue(){I&&(I.value=""),O&&(O.value=""),$&&($.value=""),J&&(J.value=""),Ge("Medium"),F&&(F.value=_),Zt(),Be=null,Le&&(Le.textContent="Save Cue"),It?.classList.add("hidden")}function un(e){let t=a.find(n=>n.id===e);t&&(I&&(I.value=t.title||""),O&&$&&(t.due?(O.value=ci(t.due),$.value=li(t.due)):(O.value="",$.value="")),Ge(t?.priority||"Medium"),F&&(F.value=B(t.category)),J&&(J.value=typeof t.notes=="string"?t.notes:""),Be=e,Le&&(Le.textContent="Update Cue"),It?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),I?.focus(),re("cue:open",{mode:"edit"}))}function gi(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=B(e.category??(F?F.value:"")),o={id:pt(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!j};Mt(o,{position:"start"}),a=[o,...a],X(a);let r=$e(a);return ye=!0,N(),P(),Kt(o),r?a.forEach(s=>H(s)):H(o),_e(o),be(o),ke(),re("memoryCue:remindersUpdated",{items:a}),tn(),K({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function yi(e,t){if(!j)return v("Sign in to add notes"),null;if(!e)return null;let n=a.find(s=>s.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let r=typeof n.notes=="string"?n.notes:"";return n.notes=r?`${r}
${o}`:o,n.updatedAt=Date.now(),H(n),N(),P(),K({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function hi(e){let t=a.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),H(t),_e(t),N(),P(),t.done?(wt(e),K({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(be(t),K({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function bi(e){if(!G||G.tokenId!==e)return;let{item:t,index:n}=G;if(!t){we(e);return}we(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),a.length):a.length;t.pendingSync=!j,t.updatedAt=Date.now(),a.splice(i,0,t),X(a);let o=$e(a);ye=!0,N(),P(),be(t),o?a.forEach(r=>H(r)):H(t),_e(t),ke(),re("memoryCue:remindersUpdated",{items:a}),K({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),v("Reminder restored")}function fn(e){let t=a.findIndex(o=>o.id===e),n=t>=0?a.splice(t,1)[0]:null;N(),P(),mi(e),wt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(K({action:"deleted",label:i}),n&&x){we();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;G={tokenId:o,item:n,index:t,timeoutId:null},Ln(G),G.timeoutId=setTimeout(()=>{we(o)},An)}else n&&we()}function je(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=yt(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=yt(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function pn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}v("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function mn(){return Object.values(M||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||_,notes:typeof e.notes=="string"?e.notes:"",body:je(e),urlPath:e.urlPath||Xe,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Pt(){try{localStorage.setItem("scheduledReminders",JSON.stringify(M))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=mn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Et(),Vt(e,{requestCheck:t})}function vt(e,{closeNotification:t=!0}={}){if(t){let n=ie.get(e);if(n){try{n.close()}catch{}ie.delete(e)}}he[e]&&(clearTimeout(he[e]),delete he[e]),Gt(e),M[e]&&(delete M[e],Pt())}function wt(e){vt(e)}function gn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ie.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:je(e),tag:e.id});ie.set(e.id,n);let i=()=>{ie.get(e.id)===n&&ie.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function vi(e){if(!oe())return!1;let t=En();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await ue();if(!i)return!1;await Gt(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||_,body:r,urlPath:Xe},r=je(e),s={body:r,tag:e.id,data:o,renotify:!0};n>Date.now()&&(s.showTrigger=new t(n));try{return await i.showNotification(e.title,s),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function be(e){if(!e||!e.id)return;if(e.category=B(e.category),!e.due||e.done){wt(e.id);return}let t=M[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||_,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:je(e),urlPath:Xe,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let s=typeof t.due=="string"?t.due:null,u=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return s===e.due?u:null})()};if(M[e.id]=n,Pt(),he[e.id]&&(clearTimeout(he[e.id]),delete he[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(M[e.id]?.viaTrigger){vt(e.id,{closeNotification:!1});return}gn(e),vt(e.id,{closeNotification:!1});return}let r=oe();r&&(n.viaTrigger=!1,vi(e).then(s=>{s&&M[e.id]&&(M[e.id]={...M[e.id],viaTrigger:!0},Pt())})),he[e.id]=setTimeout(()=>{r&&Gt(e.id),gn(e),vt(e.id,{closeNotification:!1})},o)}function ce(){Object.values(M).forEach(e=>be({...e,category:B(e?.category)}))}function wi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=ri.format(t),i=ai.format(t),o=yt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function N(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),ae(),X(a),Xt)try{Xt.textContent=String(a.length)}catch{}a.forEach(c=>{c&&typeof c=="object"&&(c.category=B(c.category))});let o=new Set(Ti.map(c=>B(c)));a.forEach(c=>{c&&typeof c=="object"&&o.add(B(c.category))});let r=Array.from(o).sort((c,f)=>c.localeCompare(f,void 0,{sensitivity:"base"}));if(Lt){let c=new Set;Array.from(Lt.querySelectorAll("option")).forEach(f=>{c.add(f.value.trim().toLowerCase())}),r.forEach(f=>{let p=f.toLowerCase();if(!c.has(p)){let w=document.createElement("option");w.value=f,Lt.appendChild(w),c.add(p)}})}if(ye)ye=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let c=a.map(f=>({...f}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:c}}));else if(document.createEvent){let f=document.createEvent("CustomEvent");f&&f.initCustomEvent&&(f.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:c}),document.dispatchEvent(f))}}catch{}}let s=a.slice();X(s);let u=!0,m=a.length>0,y=s.length>0,b=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let c=Object.values(M||{}).filter(f=>f&&typeof f=="object"&&f.id);return new Set(c.map(f=>f.id))})();if(Ee)if(y)Ee.classList.add("hidden");else{let c=m?"No reminders to show right now.":Un;en?en(Ee,{icon:m?"sparkles":"bell",title:m?"Nothing to display":"Create your first cue",description:c,action:m?void 0:`<button type="button" class="${jn}" data-trigger="open-cue">Create reminder</button>`}):Ee.textContent=c,Ee.classList.remove("hidden")}if(zt&&zt.classList.toggle("has-items",y),!S)return;if(!y){Ee?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden"));return}S.classList.remove("hidden"),S.replaceChildren();let A=document.createDocumentFragment(),k=S.tagName==="UL"||S.tagName==="OL",V=!0,ve=(c,f)=>{let p=document.createElement("div");p.className="task-item";let w={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:f,done:!!c.done};p.dataset.category=f,p.dataset.reminder=JSON.stringify(w),p.dataset.id=w.id,p.dataset.title=w.title,p.dataset.priority=w.priority,p.dataset.done=String(w.done),p.dataset.orderIndex=Number.isFinite(c.orderIndex)?String(c.orderIndex):"",p.dataset.reminderItem="true",p.setAttribute("draggable","true"),p.classList.add("reminder-draggable"),w.dueIso&&(p.dataset.due=w.dueIso),b.has(w.id)?p.dataset.notificationActive="true":delete p.dataset.notificationActive;let C=w.dueIso?new Date(w.dueIso):null;u&&C&&C>=n&&C<=i&&(p.classList.add("is-today"),p.dataset.today="true");let le=c.due?`${yt(new Date(c.due))} \u2022 ${$t(c.due.slice(0,10))}`:"No due date",Ae=f?de(f):"",_t=de(w.priority),Ut=[`<span class="task-chip" data-chip="due">${de(le)}</span>`,Ae?`<span class="task-chip" data-chip="category">${Ae}</span>`:"",`<span class="task-chip" data-chip="priority">${_t}</span>`].filter(Boolean).join(""),jt=c.notes?`<div class="task-notes">${ln(c.notes)}</div>`:"";return p.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${de(c.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn" data-edit type="button" aria-label="Edit reminder">
                <span aria-hidden="true">\u270F\uFE0F</span>
                <span class="task-toolbar-label">Edit</span>
              </button>
              <button class="task-toolbar-btn" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          <div class="task-meta">
            <div class="task-meta-row" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              ${Ut}
            </div>
          </div>
          ${jt}
        </div>`,p.querySelector("[data-edit]").addEventListener("click",()=>un(c.id)),p.querySelector("[data-del]").addEventListener("click",()=>fn(c.id)),p};if(me!=="desktop"&&!V){s.forEach(c=>{let f=c.category||_;A.appendChild(ve(c,f))}),S.appendChild(A);return}let h=new Map;s.forEach(c=>{let f=c.category||_;h.has(f)||h.set(f,[]),h.get(f).push(c)});let E=Array.from(h.entries()).sort((c,f)=>c[0].localeCompare(f[0],void 0,{sensitivity:"base"})),L=!0;E.forEach(([c,f])=>{if(c!==_){let p=document.createElement(k?"li":"div");p.dataset.categoryHeading=c,k&&(p.setAttribute("role","presentation"),p.style.listStyle="none"),p.className=me==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",L||(p.style.marginTop=me==="desktop"?"1.25rem":"1rem");let w=document.createElement("div");w.setAttribute("role","heading"),w.setAttribute("aria-level","3"),w.className=me==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let C=document.createElement("span");C.textContent=c;let z=document.createElement("span");z.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",z.textContent=`${f.length} ${f.length===1?"item":"items"}`,w.append(C,z),p.appendChild(w),A.appendChild(p)}f.forEach(p=>{if(me==="desktop"){let w=document.createElement(k?"li":"div"),C={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:c,done:!!p.done};w.dataset.id=C.id,w.dataset.category=C.category,w.dataset.title=C.title,w.dataset.priority=C.priority,w.dataset.done=String(C.done),C.dueIso&&(w.dataset.due=C.dueIso),w.dataset.reminder=JSON.stringify(C),w.dataset.orderIndex=Number.isFinite(p.orderIndex)?String(p.orderIndex):"",w.dataset.reminderItem="true",w.setAttribute("draggable","true"),w.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200",b.has(C.id)?w.dataset.notificationActive="true":delete w.dataset.notificationActive;let z=wi(p),le=p.done?"line-through text-base-content/50":"text-base-content",Ae=p.done?"Completed":"Active",_t=p.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Ut=p.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",jt=p.notes?`<p class="text-sm leading-relaxed text-base-content/70">${ln(p.notes)}</p>`:"";w.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${le}">${de(p.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${de(z)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${de(c)}
            </span>
            <span class="${_t} text-[0.7rem] sm:text-xs">${Ae}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${jt}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Ut}">${p.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,w.querySelector('[data-action="toggle"]').addEventListener("click",()=>hi(p.id)),w.querySelector('[data-action="edit"]').addEventListener("click",()=>un(p.id)),w.querySelector('[data-action="delete"]').addEventListener("click",()=>fn(p.id)),A.appendChild(w);return}A.appendChild(ve(p,c))}),L=!1}),S.appendChild(A)}function Z(){De?.setAttribute("aria-expanded","false"),xe?.classList.add("hidden")}function Si(){De?.setAttribute("aria-expanded","true"),xe?.classList.remove("hidden")}De?.addEventListener("click",e=>{e.stopPropagation(),De.getAttribute("aria-expanded")==="true"?Z():Si()}),document.addEventListener("click",e=>{xe&&!xe.classList.contains("hidden")&&!xe.contains(e.target)&&e.target!==De&&Z()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Z()}),Bn.forEach(e=>{e.addEventListener("click",()=>{let t=Ve?.classList.contains("hidden");Ve?.classList.toggle("hidden"),t&&Ve?.scrollIntoView({behavior:"smooth",block:"start"}),Z()})}),document.addEventListener("DOMContentLoaded",()=>{Ve?.classList.add("hidden")});function yn(){try{console.log("handleSaveAction invoked",{editingId:Be,title:I?.value})}catch{}if(Be){let i=a.find(u=>u.id===Be);if(!i){Ue();return}let o=I.value.trim();if(!o){v("Add a reminder title");return}let r=null;if(O.value||$.value){let u=O.value||mt(),m=$.value||"09:00";r=dn(u,m)}else{let u=ht(o);u.time&&(r=new Date(`${u.date}T${u.time}:00`).toISOString())}i.title=o;let s=xt();i.priority=s,Ge(s),F&&(i.category=B(F.value)),i.due=r,J&&(i.notes=J.value.trim()),i.updatedAt=Date.now(),H(i),_e(i),ye=!0,N(),be(i),P(),ke(),re("memoryCue:remindersUpdated",{items:a}),tn(),K({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Ue(),v("Reminder updated"),re("cue:close",{reason:"updated"});return}let e=I.value.trim();if(!e){v("Add a reminder title");return}let t=J?J.value.trim():"",n=null;if(O.value||$.value){let i=O.value||mt(),o=$.value||"09:00";n=dn(i,o)}else{let i=ht(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}gi({title:e,priority:xt(),category:F?F.value:"",due:n,notes:t}),I.value="",$.value="",J&&(J.value=""),re("cue:close",{reason:"created"})}I?.addEventListener("keydown",e=>{e.key==="Enter"&&yn()});function Ei(){if(!I||!pe)return;let e=I.value.trim();if(!e){pe.style.display="none";return}try{let t=ht(e),n=mt();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${$t(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(pe.textContent=`Parsed: ${i}`,pe.style.display="block"):pe.style.display="none"}else pe.style.display="none"}catch{pe.style.display="none"}}return I?.addEventListener("input",fi(Ei,300)),It?.addEventListener("click",()=>{Ue(),v("Edit cancelled"),re("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Ue()}),document.addEventListener("cue:prepare",()=>{Ue()}),window.addEventListener("load",()=>I?.focus()),Cn?.addEventListener("click",()=>{let e=a.filter(t=>!t.done).map(t=>{let n=t.due?$t(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Te,{hour:"2-digit",minute:"2-digit",timeZone:ne}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){v("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>v("Copied for Master Task List")).catch(()=>v("Copy failed")),Z()}),At?.addEventListener("change",()=>{let e=At.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(r=>{let s={...r,id:pt(),category:B(r.category),pendingSync:!j,orderIndex:null};Mt(s,{position:"start"}),a=[s,...a],i.push(s)}),X(a);let o=$e(a);N(),P(),o?a.forEach(r=>H(r)):i.forEach(r=>H(r)),v("Import successful")}catch{v("Invalid JSON")}},t.readAsText(e),At.value="",Z()}),Nn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Z()}),Rn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){v("Add your Apps Script URL in Settings first"),Z();return}if(!a.length){v("No tasks to sync"),Z();return}v("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<a.length;i+=t){let o=a.slice(i,i+t),r=await Promise.allSettled(o.map(s=>{let u={id:s.id,title:s.title,dueIso:s.due||null,priority:s.priority||"Medium",category:s.category||_,done:!!s.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})}));n+=r.filter(s=>s.status==="rejected").length,await new Promise(s=>setTimeout(s,400))}v(`Sync complete: ${a.length-n} ok${n?`, ${n} failed`:""}`),Z()}),Se&&(Se.value=localStorage.getItem("syncUrl")||""),Mn?.addEventListener("click",()=>{Se&&(localStorage.setItem("syncUrl",Se.value.trim()),v("Settings saved"))}),Fn?.addEventListener("click",async()=>{if(!Se)return;let e=Se.value.trim();if(!e){v("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});v(t.ok?"Test ok":"Test failed")}catch{v("Test failed")}}),kn?.addEventListener("click",async()=>{if(!("Notification"in window)){v("Notifications not supported");return}if(Notification.permission==="granted"){v("Notifications enabled"),oe()?ue():(Et(),pn()),ce(),N();return}try{await Notification.requestPermission()==="granted"?(v("Notifications enabled"),oe()?ue():(Et(),pn()),ce(),N()):v("Notifications blocked")}catch{v("Notifications blocked")}}),Jn(),ce(),N(),P(),{cancelReminder:wt,scheduleReminder:be,closeActiveNotifications:In,getActiveNotifications:()=>ie,addNoteToReminder:yi,__testing:{setItems(e=[]){a=Array.isArray(e)?e.map(t=>({...t,category:B(t?.category)})):[],a=Oe(a),X(a),N()},render:N,getItems:()=>a.map(e=>({...e}))}}}var hn,ie,bn,Ht,Yt,vn,St,He,qt,_,Ti,Wt,ee,Di=Ii(()=>{hn="memoryCue:activity",ie=new Map,bn=!1,Ht="service-worker.js",Yt="memory-cue-reminder-sync",vn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),St=null,He=null,qt=!1,_="General",Ti=Object.freeze([_,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Wt="memoryCue:offlineReminders",ee=1024});export{Ci as a,Di as b};
