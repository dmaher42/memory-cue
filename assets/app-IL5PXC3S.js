import{a as Et,b as Mn,c as ye,d as Pn,f as qe,g as ge,h as _e,i as Hn,j as vt,k as Rn}from"./chunk-K4LZ4PFQ.js";import{a as wt,b as Nn}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as Ue,c as Fn}from"./chunk-GUVSRPRW.js";function St(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let i of o){if(typeof i!="string"||!i)continue;let s=t.getElementById(i);if(s)return{key:n,element:s}}return null}).filter(n=>!!(n&&n.element))}function J(e,t){if(!e||typeof e!="object")return"";let n=On[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let i=e[o];return i==null?"":typeof i=="string"?i:String(i)}return""}function Un(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function qn(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function kt(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let i=e&&typeof e=="object"?J(e,n):"";Un(o,i)})}function xt(e,t,n,o){Array.isArray(e)&&e.forEach(({element:i})=>{i instanceof HTMLInputElement?["checkbox","radio"].includes(i.type)?i.checked=!1:i.value="":(i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function Tt(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let i=qn(o);if(typeof i=="boolean"){t[n]=i;return}let s=typeof i=="string"?i.trim():i;t[n]=s??""}),t}function v(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Lt,On,$e,We,At=Ue(()=>{Lt=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],On={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},$e="Create Cue",We="Edit Cue"});function Dt(e){return new Ve(e)}var _n,$n,Ve,Ct=Ue(()=>{_n=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),$n={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Ve=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...$n,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let o=n[0],i=n[n.length-1],s=document.activeElement;t.shiftKey&&s===o?(t.preventDefault(),i.focus()):!t.shiftKey&&s===i&&(t.preventDefault(),o.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(_n)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let o=this.events[t];if(!o||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let i=new CustomEvent(o,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(i)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var It,Ye,je,Wn,Bt,Vn,Ft,jn,Yn,Nt,Ke,Kn,Mt,Ge,se,re,Pt,Gn,Ht,ze,we,ie,be,X,Rt,ae,Ot,Ut,Ee,zn,oe,le,qt,W,ve,Qe,_t,V,$t,Wt,Vt,jt,Yt,Kt=Ue(()=>{It="memoryCue:plannerPlans",Ye="memoryCue:plannerUpdated",je=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Wn=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],Bt=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},Vn=e=>{try{return JSON.parse(e)}catch{return null}},Ft=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,jn=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,Yn=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),o=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t},Nt=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`},Ke=e=>{if(typeof e!="string")return null;let[t,n,o]=e.split("-"),i=Number.parseInt(t,10),s=Number.parseInt(n,10),r=Number.parseInt(o,10);if(!Number.isFinite(i)||!Number.isFinite(s)||!Number.isFinite(r))return null;let a=new Date(i,s-1,r);return Number.isNaN(a.getTime())?null:(a.setHours(0,0,0,0),a)},Kn=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=je.findIndex(o=>o.toLowerCase()===t);return n>=0?n:0},Mt=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:Ft(),badge:n,text:t}},Ge=(e,t={})=>{let n=typeof t=="object"&&t?t:{},o=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:Kn(e?.dayName||n.dayName||n.dayLabel),i=jn(o),s=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():je[i],r=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",m=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(y=>Mt(y)).filter(Boolean);return{id:typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:Ft(),dayIndex:i,dayLabel:je[i]||"Lesson",title:s,summary:r,details:m}},se=e=>[...e].sort((t,n)=>t.dayIndex!==n.dayIndex?t.dayIndex-n.dayIndex:t.title.localeCompare(n.title)),re=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,o=Ke(n),i=Array.isArray(e?.lessons)?e.lessons.map(s=>Ge(s)).filter(Boolean):[];return{weekId:n,startDate:o?o.toISOString():"",lessons:se(i),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString()}},Pt=()=>{if(!Bt())return{};try{let e=window.localStorage.getItem(It);if(typeof e!="string"||!e.length)return{};let t=Vn(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Gn=e=>{if(Bt())try{window.localStorage.setItem(It,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},Ht=e=>{if(!e)return null;let n=Pt()[e];return n?re(n,e):null},ze=(e,t)=>{if(!e||!t)return t;let n=Pt();return n[e]=t,Gn(n),t},we=new Map,ie=null,be=null,X=!1,Rt=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},ae=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(Ye,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},Ot=async()=>ie?be||(be=ie().then(e=>{let{db:t,getCollection:n}=e||{},o=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),be):null,Ut=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:o,db:i}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(i,"plannerPlans",t)},Ee=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&we.set(e.weekId,e),e),zn=e=>{let t=W();return re({weekId:e,lessons:e===t?Wn:[]},e)},oe=e=>{let t=Ht(e);if(t)return Ee(t),t;let n=zn(e);return ze(e,n),Ee(n),n},le=async e=>{if(!e?.weekId)return e;let t=re(e,e.weekId);if(ze(t.weekId,t),Ee(t),X||!ie)return t;try{let n=await Ot();if(!n)return t;let o=Ut(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(o,t,{merge:!0}):await n.updateDoc(o,t),t}catch(n){return Rt(n)?(console.warn("Persisting planner data locally due to permission issue",n),X=!0,t):(console.error("Failed to persist planner plan",n),t)}},qt=(e={})=>{typeof e.ensureFirestore=="function"&&(ie=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(X=e.forceLocal)},W=(e=new Date)=>{let t=Yn(e);return Nt(t)},ve=(e,t=0)=>{let n=Ke(e);if(!n||!Number.isFinite(t))return e;let o=new Date(n);return o.setDate(n.getDate()+t*7),Nt(o)},Qe=(e,{short:t=!1}={})=>{let n=Ke(e);if(!n)return"";let o=new Date(n);o.setDate(n.getDate()+6);let i=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),s=i.format(n),r=i.format(o),a=n.getFullYear()===o.getFullYear();if(t)return`Week of ${s}`;let m=a?n.getFullYear():`${n.getFullYear()} \u2013 ${o.getFullYear()}`;return`${s} \u2013 ${r}, ${m}`},_t=(e=W())=>{if(!e)return[];let t=we.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=Ht(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},V=async(e=W())=>{if(!e)return null;if(we.has(e))return we.get(e);if(X||!ie)return oe(e);try{let t=await Ot();if(!t)return oe(e);let n=Ut(t,e),o=await t.getDoc(n);if(o.exists()){let s=o.data(),r=re({...s,weekId:e},e);return ze(e,r),Ee(r),X=!1,r}let i=oe(e);return typeof t.setDoc=="function"&&await t.setDoc(n,i,{merge:!0}),i}catch(t){return Rt(t)?(console.warn("Falling back to local planner data due to permission issue",t),X=!0,oe(e)):(console.error("Failed to load planner data",t),oe(e))}},$t=async(e,t)=>{if(!e)return null;let n=await V(e),o=Ge(t),i={...n,lessons:se([...n?.lessons||[],o]),updatedAt:new Date().toISOString()},s=await le(i);return ae(s),s},Wt=async(e,t,n={})=>{if(!e||!t)return null;let o=await V(e),i=[...o?.lessons||[]],s=i.findIndex(l=>l.id===t);if(s===-1)return o;let r=Ge({...i[s],...n,id:t},i[s]);i[s]=r;let a={...o,lessons:se(i),updatedAt:new Date().toISOString()},m=await le(a);return ae(m),m},Vt=async(e,t)=>{if(!e||!t)return null;let n=await V(e),o=(n?.lessons||[]).filter(r=>r.id!==t),i={...n,lessons:se(o),updatedAt:new Date().toISOString()},s=await le(i);return ae(s),s},jt=async(e,t,n)=>{if(!e||!t)return null;let o=await V(e),i=[...o?.lessons||[]],s=i.findIndex(h=>h.id===t);if(s===-1)return o;let r=Mt(n);if(!r)return o;let a=i[s],m={...a,details:[...a.details||[],r]};i[s]=m;let l={...o,lessons:se(i),updatedAt:new Date().toISOString()},y=await le(l);return ae(y),y},Yt=async(e,t)=>{if(!e||!t)return null;let o=((await V(e))?.lessons||[]).map(r=>({title:r.title,summary:r.summary,dayIndex:r.dayIndex,details:(r.details||[]).map(a=>({badge:a.badge,text:a.text}))})),i=re({weekId:t,lessons:o},t);i.updatedAt=new Date().toISOString();let s=await le(i);return ae(s),s}});var Qo=Fn(()=>{Nn();Pn();At();Ct();Mn();Hn();Rn();Kt();wt();function Qn(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!t||!n)return;let o=document.querySelectorAll("[data-open-reminder-modal]");if(!o.length)return;let i=e.querySelector("[data-reminder-modal-backdrop]"),s=e.querySelectorAll("[data-close-modal]"),r=document.getElementById("mainContent"),a=document.querySelector('nav[aria-label="Primary"]'),m=[r,a],l=e.querySelector('[role="dialog"]')??e,y=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],h=null,d=()=>{if(!(l instanceof HTMLElement))return[];let c=l.querySelectorAll(y.join(","));return Array.from(c).filter(f=>{let k=f instanceof HTMLElement,_=typeof SVGElement<"u"&&f instanceof SVGElement;if(!k&&!_||f.getAttribute("aria-hidden")==="true"||"disabled"in f&&f.disabled||f.hidden||f.closest("[hidden]"))return!1;let $=f.getBoundingClientRect();return $.width>0&&$.height>0})},u=()=>{let c=d(),f=c.find(k=>k.hasAttribute("data-autofocus")||k.hasAttribute("autofocus"))||(n&&c.includes(n)?n:null)||c[0];if(f&&typeof f.focus=="function"){f.focus({preventScroll:!0});return}l instanceof HTMLElement&&typeof l.focus=="function"&&l.focus({preventScroll:!0})},p=c=>{l instanceof HTMLElement&&(!(c.target instanceof Node)||!l.contains(c.target))&&(c.stopPropagation(),u())},b=c=>{if(c.key!=="Tab")return;let f=d();if(!f.length){c.preventDefault(),l instanceof HTMLElement&&l.focus({preventScroll:!0});return}let k=f[0],_=f[f.length-1],$=document.activeElement;if(c.shiftKey){(!l.contains($)||$===k)&&(c.preventDefault(),_.focus());return}(!l.contains($)||$===_)&&(c.preventDefault(),k.focus())},g=c=>{m.forEach(f=>{f&&(c?f.setAttribute("inert",""):f.removeAttribute("inert"))})},A=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),g(!1),document.removeEventListener("keydown",M,!0),e.removeEventListener("keydown",b,!0),e.removeEventListener("focusin",p,!0),h&&typeof h.focus=="function"&&h.focus(),h=null},M=c=>{c.key==="Escape"&&(c.preventDefault(),A())},ne=({triggerElement:c}={})=>{c&&typeof c.focus=="function"?h=c:h=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),g(!0),document.addEventListener("keydown",M,!0),e.addEventListener("keydown",b,!0),e.addEventListener("focusin",p,!0),window.requestAnimationFrame(()=>{u()})},S=(c,f={})=>{try{document.dispatchEvent(new CustomEvent(c,{detail:f}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let k=document.createEvent("CustomEvent");k.initCustomEvent(c,!0,!0,f),document.dispatchEvent(k)}}},T=(c={})=>{S("cue:cancelled",c)};o.forEach(c=>{c.addEventListener("click",f=>{f.preventDefault();let _={trigger:f.currentTarget instanceof HTMLElement?f.currentTarget:null,mode:"create"};S("cue:prepare",_),S("cue:open",_)})}),s.forEach(c=>{c.addEventListener("click",f=>{f.preventDefault(),T({trigger:c,reason:"button"})})}),e.addEventListener("click",c=>{c.target===e&&T({reason:"backdrop"})}),i?.addEventListener("click",c=>{c.target===i&&T({reason:"backdrop"})}),document.addEventListener("cue:open",c=>{let f=c?.detail?.trigger,k=f instanceof HTMLElement?f:null;ne({triggerElement:k})});let P=()=>{A()};document.addEventListener("cue:close",P),document.addEventListener("cue:cancelled",P);let I=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&I instanceof HTMLElement&&t.addEventListener("submit",c=>{c.preventDefault(),!I.matches(":disabled")&&I.click()}),I instanceof HTMLElement&&document.addEventListener("reminder:save",c=>{let f=c?.detail?.trigger;f&&f!==I||I.matches(":disabled")||I.click()})}Qn();var Gt=null;function fn(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Jn(e){typeof document>"u"||!e||(window.clearTimeout(Gt),Gt=window.setTimeout(()=>{let t=document.querySelector(`[data-route="${e}"]`);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function De(e){let t=e||fn();t&&Jn(t)}function Xn(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{De()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{if(!(o.currentTarget instanceof HTMLAnchorElement))return;let i=o.currentTarget.getAttribute("href")||"";if(!i.startsWith("#"))return;o.preventDefault();let s=i||"#dashboard",r=s.replace("#","")||"dashboard";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),De(r)})}),typeof window.renderRoute=="function"&&window.renderRoute(),De()}Xn();var mn="memoryCue:accountPanelCollapsed";function Zn(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem(mn);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function eo(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem(mn,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function to(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let o=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",i=(t.getAttribute("data-expanded-label")||"").trim()||o,s=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",r=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",a=t.querySelector("[data-account-toggle-label]"),m=t.querySelector("[data-account-toggle-a11y]"),l=Zn();typeof l!="boolean"&&(l=!0);let y=(h,{persist:d=!0}={})=>{l=!!h,e.setAttribute("data-account-collapsed",l?"true":"false"),t.setAttribute("aria-expanded",l?"false":"true");let u=l?o:i,p=l?s:r;a?a.textContent=u:t.textContent=u,t.setAttribute("aria-label",p),m&&(m.textContent=p),l?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),l||n.removeAttribute("hidden"),d&&eo(l)};y(l,{persist:!1}),t.addEventListener("click",h=>{h.preventDefault(),y(!l)})}to();var zt=document.getElementById("settings-save-button"),Le=document.getElementById("settings-save-confirmation"),Ne=document.getElementById("live-status"),Je=null;zt&&Le&&zt.addEventListener("click",e=>{e.preventDefault(),Le.classList.remove("hidden"),Le.textContent="Settings saved!",Ne&&(Ne.textContent="Settings saved!"),Je&&window.clearTimeout(Je),Je=window.setTimeout(()=>{Le.classList.add("hidden")},3e3)});function no(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),De(t),Ne&&(Ne.textContent="Opening planner to add a new lesson."),Ln(),window.requestAnimationFrame(()=>{let o=vn();o&&typeof o.catch=="function"&&o.catch(i=>{console.error("Planner quick action failed to start new lesson flow",i)})})}function oo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",no)})}oo();var pn=document.getElementById("reminder-title"),io=document.getElementById("reminderText"),F=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),o=e.querySelector(".modal-backdrop button"),i=document.getElementById("modal-title");return Dt({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:o instanceof HTMLElement?o:null,titleInput:pn,modalTitle:i instanceof HTMLElement?i:null,defaultTitle:$e,editTitle:We})})();F?.setEditMode(!1);var so=()=>{let e=!!pn;if(!!io)return ye({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0};return e?ye(n):ye({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};so().catch(e=>{console.error("Failed to initialise reminders",e)});var nt=vt(),Xe=Et({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{nt?.handleSessionChange(e)}});if(Xe?.supabase){nt?.setSupabaseClient(Xe.supabase);try{Xe.supabase.auth.getSession().then(({data:e})=>{nt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var O=document.getElementById("cues-list"),Ze=document.getElementById("pinnedNotesCard"),Z=document.getElementById("pinnedNotesList"),G=document.getElementById("cue-form"),B=G?.querySelector("#cue-id-input"),ro=F?.defaultTitle||F?.modalTitle?.textContent?.trim()||$e,li=F?.editTitle||We,Me=document.getElementById("tab-cues"),Pe=document.getElementById("tab-daily"),de=document.getElementById("cues-view"),ue=document.getElementById("daily-list-view"),Qt=document.getElementById("daily-list-header"),hn=document.getElementById("quick-add-form"),x=document.getElementById("quick-add-input"),D=document.getElementById("daily-voice-btn"),j=document.getElementById("daily-tasks-container"),ot=document.getElementById("clear-completed-btn"),He=document.getElementById("daily-list-permission-notice"),z=document.getElementById("plannerCards")||document.getElementById("planner-grid"),Jt=document.getElementById("planner-week"),ao=document.getElementById("planner-prev"),lo=document.getElementById("planner-next"),co=document.getElementById("planner-today"),uo=document.getElementById("planner-duplicate-btn"),fo=document.getElementById("planner-new-lesson-btn"),Xt=document.getElementById("remindersCount"),Zt=document.getElementById("plannerCount"),en=document.getElementById("plannerSubtitle"),ci=document.getElementById("resourcesCount"),di=document.getElementById("templatesCount"),Se=document.getElementById("dailySnapshotList"),ke=document.getElementById("todaysFocusList"),H=document.getElementById("weekAtAGlanceList"),R=null;H&&(R=document.createElement("li"),R.dataset.emptyState="week",R.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",R.textContent="No upcoming events this week.");var tn=()=>{if(!H||!R)return;H.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?H.contains(R)||H.appendChild(R):H.contains(R)&&H.removeChild(R)};H&&(tn(),new MutationObserver(tn).observe(H,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var et=e=>{Ze&&(e?Ze.classList.remove("hidden"):Ze.classList.add("hidden"))},fe={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},nn=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),on=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),Ce=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",dt=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},mo=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),yn=e=>{if(!e)return"";if(nn)try{return nn.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},po=e=>{if(!e)return"";if(on)try{return on.format(e)}catch{}return e.toLocaleDateString()},gn=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(fe,t)?t:"medium"},sn=e=>{let t=gn(e);return fe[t]?.rank??fe.medium.rank},ho=e=>{let t=gn(e);return fe[t]??fe.medium},rn=e=>{let t=dt(e);return t?t.getTime():Number.POSITIVE_INFINITY};function bn(e=[]){if(!Se)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(o=>({reminder:o,date:dt(o)})).filter(({date:o})=>o&&mo(o,t)).sort((o,i)=>o.date.getTime()-i.date.getTime());if(!n.length){Se.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Se.innerHTML="",n.forEach(({reminder:o,date:i})=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let r=document.createElement("p");r.className="font-semibold text-base-content",r.textContent=Ce(o),s.appendChild(r);let a=yn(i),m=document.createElement("p");m.className="text-xs text-base-content/70",m.textContent=a?`Due ${a}`:"Due today",s.appendChild(m),Se.appendChild(s)})}function wn(e=[]){if(!ke)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,o)=>{let i=sn(n)-sn(o);if(i!==0)return i;let s=rn(n)-rn(o);return s!==0?s:Ce(n).localeCompare(Ce(o),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){ke.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}ke.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let i=document.createElement("div");i.className="flex items-center justify-between gap-3";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=Ce(n),i.appendChild(s);let r=ho(n),a=document.createElement("span");a.className=r.badgeClass,a.textContent=r.badgeLabel,i.appendChild(a),o.appendChild(i);let m=dt(n),l=document.createElement("p");if(l.className="text-xs text-base-content/70",m){let y=yn(m),h=po(m),d=[];y&&d.push(`Due ${y}`),h&&d.push(h),l.textContent=d.length?d.join(" \u2022 "):"Due soon"}else l.textContent="No due date";o.appendChild(l),ke.appendChild(o)})}var yo=e=>{if(!Xt)return;let t=Array.isArray(e)?e.length:0;Xt.textContent=String(t)},go=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];yo(t),bn(t),wn(t)};document.addEventListener("memoryCue:remindersUpdated",go);bn();wn();var it=St(Lt),bo={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},xe=null,wo=3,an=120;function Eo(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=an?t:`${t.slice(0,an-1)}\u2026`:""}function vo(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let o=n.trim().toLowerCase();return o==="true"||o==="1"||o==="yes"}return!1})}function ln(e){if(!Z)return;let t=Array.isArray(e)?e:[];if(!t.length){Z.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',et(!1);return}let n=t.filter(s=>vo(s));if(!n.length){Z.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',et(!1);return}et(!0);let i=n.slice(0,wo).map(s=>{let r=v(J(s,"title")||"Untitled Cue"),a=J(s,"details"),m=v(Eo(a)),l=m?`<p class="mt-1 text-sm text-base-content/70">${m}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${r}</p>
          ${l}
        </li>
      `}).join("");Z.innerHTML=i}function st(e,{tone:t="muted"}={}){if(!O)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),O.innerHTML=`<p class="${n.join(" ")}">${v(e)}</p>`}function Lo(e){if(!O)return;if(!Array.isArray(e)||e.length===0){st("No cues yet.");return}let t=e.map(n=>{let o=v(J(n,"title")||"Untitled Cue"),i=v(J(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${i?`<p>${i}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${v(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${v(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");O.innerHTML=t}async function he(){return xe||(xe=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:i,collection:s,doc:r,getDoc:a,addDoc:m,updateDoc:l,getDocs:y,query:h,orderBy:d,serverTimestamp:u,setDoc:p,arrayUnion:b}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),g=t(),A=g&&g.length?g[0]:e(bo),M=n(A);(function(){let T=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;T&&(T.__persistenceInitialized__||(T.__persistenceInitialized__=!0,(async()=>{try{await o(M),console.info("[Firestore] Persistence: multi-tab enabled")}catch(P){if(P&&P.code==="failed-precondition")try{await i(M),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(I){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",I?.code||I)}else P&&P.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",P?.code||P)}})()))})();let ne=s(M,"cues");return{db:M,cuesCollection:ne,getCollection:s,doc:r,getDoc:a,addDoc:m,updateDoc:l,getDocs:y,query:h,orderBy:d,serverTimestamp:u,setDoc:p,arrayUnion:b}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),xe)}async function So(){let e=await he(),{getDocs:t,cuesCollection:n,query:o,orderBy:i}=e,s=o&&i?o(n,i("createdAt","desc")):n;return(await t(s)).docs.map(a=>({id:a.id,...a.data()}))}async function ko(e){if(!e)return null;let t=await he(),{db:n,doc:o,getDoc:i}=t,s=o(n,"cues",e),r=await i(s);return r.exists()?{id:r.id,...r.data()}:null}async function En(){if(!(!O&&!Z))try{let e=await So();Lo(e),ln(e)}catch(e){console.error("Failed to load cues",e),Oe(e)?st("Sign in to view your cues.",{tone:"muted"}):st("Unable to load cues right now.",{tone:"error"}),ln([])}}function xo(e){!G||!B||(kt(e,it),B.value=e?.id||"",F?.setEditMode(!0),F?.show({mode:"edit"}))}async function To(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await ko(n);if(!o)return;xo(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function Ao(e){if(e.preventDefault(),!G||!B)return;let t=B.value.trim(),n=Tt(it);try{let o=await he(),{db:i,doc:s,addDoc:r,updateDoc:a,cuesCollection:m,serverTimestamp:l}=o,y=typeof l=="function"?l():null;if(t){let h=s(i,"cues",t),d={...n};y&&(d.updatedAt=y),await a(h,d)}else{let h={...n};y&&(h.createdAt=y,h.updatedAt=y),await r(m,h)}await En(),xt(it,B,F?.modalTitle??null,ro),await F?.hide({reason:"form-submit"})}catch(o){console.error("Failed to save cue",o)}}async function Do(){!G||!B||!O||(O.addEventListener("click",To),G.addEventListener("submit",Ao))}G&&B&&(document.addEventListener("cue:prepare",()=>{B.value="",F?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{B.value="",F?.setEditMode(!1)}));G&&B&&O&&Do().catch(e=>{console.error("Failed to initialise cue editing",e)});(O||Z)&&En();var w=[],Te=null,Y=!1,me=W(),Ie=!1,E=me,N=null,Co=e=>{if(!Zt)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=_t(me),Zt.textContent=String(t.length)};function q(e,t){if(Co(e),en){let n=Qe(e?.weekId||t,{short:!0});en.textContent=n||""}}function rt(e,{tone:t="muted"}={}){if(!z)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),z.innerHTML=`<p class="${n.join(" ")}">${v(e)}</p>`}function ut(e){if(!Jt)return;let t=Qe(e);Jt.textContent=t||""}function Q(e){if(!z)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){rt("No lessons saved for this week yet.");return}let n=t.map(o=>{let i=Array.isArray(o.details)?o.details.map(m=>`
                <li class="flex items-center gap-2">
                  ${m.badge?`<span class="badge badge-outline badge-sm text-secondary">${v(m.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${v(m.text)}</span>
                </li>
              `).join(""):"",s=i?`<ul class="space-y-2 text-sm text-base-content/70">${i}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',r=typeof o.id=="string"?o.id:"",a=o.summary?`<p class="text-sm text-base-content/70">${v(o.summary)}</p>`:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow">
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${v(o.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${v(o.title||o.dayLabel||"Lesson")}</h2>
                ${a}
              </div>
              <div class="flex items-center gap-1">
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${r}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${r}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${s}
            <div>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${r}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");z.innerHTML=n}async function ce(e){if(!z)return;let t=e||W();E=t,ut(t),rt("Loading plan\u2026");try{let n=await V(t);N=n,Q(n),q(n,t)}catch(n){console.error("Failed to load planner week",n),rt("Unable to load this week's planner.",{tone:"error"})}}function Io(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),o=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":Fo(o);break;case"edit":No(o);break;case"delete":Mo(o);break;default:break}}async function vn(){if(typeof window>"u")return;let e=N?.lessons?.[0]?.dayLabel||"Monday",t=window.prompt("Which day is this lesson for?",e);if(!t)return;let n=window.prompt("Lesson title",`${t.trim()} lesson`);if(!n)return;let o=window.prompt("What is the focus for this lesson?","");if(o!==null)try{let i=await $t(E,{dayName:t,title:n,summary:o});i&&(N=i,Q(i),q(i,E))}catch(i){console.error("Failed to add planner lesson",i),window.alert("Unable to add a new lesson right now. Please try again.")}}async function Bo(){if(typeof window>"u")return;let e=ve(E,1),t=window.prompt("Enter the Monday date (YYYY-MM-DD) for the week that should receive this copy.",e);if(!(!t||t===E))try{let n=await Yt(E,t);n&&(E=t,N=n,Q(n),ut(t),q(n,t))}catch(n){console.error("Failed to duplicate planner week",n),window.alert("Unable to duplicate that plan right now. Please try again.")}}async function Fo(e){if(!e||typeof window>"u")return;let t=window.prompt("Label for this detail (optional):","");if(t===null)return;let n=window.prompt("What detail would you like to add?","");if(!(!n||!n.trim()))try{let o=await jt(E,e,{badge:t,text:n});o&&(N=o,Q(o),q(o,E))}catch(o){console.error("Failed to add planner detail",o),window.alert("Unable to add this detail right now.")}}async function No(e){if(!e||typeof window>"u")return;let t=N?.lessons?.find(s=>s.id===e);if(!t)return;let n=window.prompt("Lesson title",t.title);if(n===null||!n.trim())return;let o=window.prompt("Lesson summary",t.summary||"");if(o===null)return;let i=window.prompt("Day of the week",t.dayLabel||"Monday");if(i)try{let s=await Wt(E,e,{title:n,summary:o,dayName:i});s&&(N=s,Q(s),q(s,E))}catch(s){console.error("Failed to update planner lesson",s),window.alert("Unable to update that lesson right now.")}}async function Mo(e){if(!e||typeof window>"u")return;let t=N?.lessons?.find(o=>o.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let o=await Vt(E,e);o&&(N=o,Q(o),q(o,E))}catch(o){console.error("Failed to delete planner lesson",o),window.alert("Unable to delete that lesson right now.")}}function Ln(){if(Ie||!z){Ie&&ce(E);return}Ie=!0,qt({ensureFirestore:he}),z.addEventListener("click",Io),fo?.addEventListener("click",vn),uo?.addEventListener("click",Bo),ao?.addEventListener("click",()=>{let e=ve(E,-1);ce(e)}),lo?.addEventListener("click",()=>{let e=ve(E,1);ce(e)}),co?.addEventListener("click",()=>{ce(W())}),ce(E)}function cn(){typeof window>"u"||fn()==="planner"&&Ln()}function Po(e){let t=e?.detail?.plan;t&&(Ie&&t.weekId===E&&(N=t,Q(t),ut(t.weekId)),t.weekId===me&&q(t,me))}q(null,me);typeof document<"u"&&document.addEventListener(Ye,Po);typeof window<"u"&&(window.addEventListener("hashchange",cn),window.addEventListener("DOMContentLoaded",cn));var Sn="dailyTasksByDate",Ae=null;function ft(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function Ho(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),i=Number.parseInt(t,10),s=Number.parseInt(n,10),r=Number.parseInt(o,10);if(!Number.isFinite(i)||!Number.isFinite(s)||!Number.isFinite(r))return e;let a=new Date(i,s-1,r);return Number.isNaN(a.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(a)}function pe(e){if(!ot)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);ot.disabled=!t}function K(e){if(!j)return;if(!Array.isArray(e)||e.length===0){j.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',pe([]);return}let t=e.map((n,o)=>{let i=v(n?.text||""),s=!!n?.completed,r=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return s&&r.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${i}" ${s?"checked":""} />
          <span class="${r.join(" ")}">${i}</span>
        </div>
      `}).join("");j.innerHTML=t,pe(e)}function Re(){He&&He.classList.remove("hidden")}function Ro(){He&&He.classList.add("hidden")}function mt(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function te(e){return Array.isArray(e)?e.map(t=>mt(t)):[]}function pt(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Sn);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function kn(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Sn,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function dn(e){let t=pt(),n=t&&typeof t=="object"?t[e]:[];return te(n)}function Be(e,t){let n=pt(),o=te(t);return n[e]=o,kn(n),o}function tt(e,t){let n=pt(),o=te(n[e]);return o.push(mt(t)),n[e]=o,kn(n),o}function Oe(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function ht(){return Ae||(Ae=he().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),Ae)}function yt(e,t){let{doc:n,dailyListsCollection:o,db:i}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(i,"dailyLists",t)}async function gt(){if(!Qt||!j)return;let e=ft(),t=Ho(e);if(Qt.textContent=t?`Today's List - ${t}`:"Today's List",Y){Re();let n=dn(e);return w=n,K(n),Promise.resolve(n)}return Te||(j.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',pe([]),Te=(async()=>{try{let n=await ht(),o=yt(n,e),i=await n.getDoc(o),s=i.exists()?i.data()?.tasks:[];return w=te(s),K(w),Be(e,w),Y=!1,Ro(),w}catch(n){if(Oe(n)){console.warn("Falling back to local daily tasks due to permission issue",n),Y=!0,Re();let o=dn(e);return w=o,K(o),o}return console.error("Failed to load daily list",n),j.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',w=[],pe(w),w}})().finally(()=>{Te=null})),Te}async function Oo(e){let t=ft(),n=mt(e);if(Y){tt(t,n);return}try{let o=await ht(),i=yt(o,t),s=await o.getDoc(i);if(s.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(i,{tasks:o.arrayUnion(n)});else{let r=s.exists()?s.data()?.tasks:[],a=Array.isArray(r)?te(r):[];a.push(n),typeof o.setDoc=="function"?await o.setDoc(i,{tasks:a},{merge:!0}):await o.updateDoc(i,{tasks:a})}tt(t,n)}catch(o){if(Oe(o)){console.warn("Saving task locally because cloud sync is unavailable",o),Y=!0,Re(),tt(t,n);return}throw o}}async function xn(e){let t=ft(),n=te(e);if(Y){Be(t,n);return}try{let o=await ht(),i=yt(o,t);typeof o.setDoc=="function"?await o.setDoc(i,{tasks:n},{merge:!0}):await o.updateDoc(i,{tasks:n}),Be(t,n)}catch(o){if(Oe(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),Y=!0,Re(),Be(t,n);return}throw o}}function Tn(e){[Me,Pe].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function Uo(){!de||!ue||(de.classList.remove("hidden"),ue.classList.add("hidden"),Tn(Me))}function qo(){!de||!ue||(de.classList.add("hidden"),ue.classList.remove("hidden"),Tn(Pe),gt())}Me&&Pe&&de&&ue&&(Me.addEventListener("click",e=>{e.preventDefault(),Uo()}),Pe.addEventListener("click",e=>{e.preventDefault(),qo()}));var L=null,C=!1,Fe=null;function ee(e){if(!D)return;D.setAttribute("aria-pressed",e?"true":"false");let t=D.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":D.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function _o(){C&&(window.clearTimeout(Fe),Fe=window.setTimeout(()=>{Fe=null,C&&An(!0)},400))}function An(e=!1){if(!L)return!1;if(C&&!e)return!0;try{return L.start(),C=!0,ee(!0),!0}catch{return C=!1,ee(!1),!1}}function bt(){if(L){C=!1,window.clearTimeout(Fe);try{L.stop()}catch{}ee(!1)}}function $o(){if(D)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){D.setAttribute("disabled","true"),D.setAttribute("aria-disabled","true"),D.title="Voice input is not supported in this browser.";return}L=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(L.lang=t,L.interimResults=!1,"continuous"in L)try{L.continuous=!0}catch{}L.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&x){x.value=o.trim();try{x.focus({preventScroll:!0})}catch{x.focus()}try{let i=x.value.length;x.setSelectionRange(i,i)}catch{}}},L.onend=()=>{if(!C){ee(!1);return}_o()},L.onerror=()=>{C=!1,ee(!1)}}catch{L=null,ee(!1),D.setAttribute("disabled","true"),D.setAttribute("aria-disabled","true")}}$o();D?.addEventListener("click",()=>{L&&(C?bt():An())});hn?.addEventListener("submit",()=>{C&&bt()});window.addEventListener("pagehide",()=>{C&&bt()});hn?.addEventListener("submit",async e=>{if(e.preventDefault(),!x)return;let t=x.value.trim();if(!t){x.focus();return}let n={text:t,completed:!1};x.value="",x.focus();try{await Oo(n),await gt()}catch(o){console.error("Failed to add task to the daily list",o),x.value=t,x.focus()}});j?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(w)||Number.isNaN(n)||!w[n])return;let o=w.map(s=>({...s})),i=o.map((s,r)=>r===n?{...s,completed:t.checked}:s);w=i,K(i);try{await xn(i)}catch(s){console.error("Failed to update task completion state",s),w=o,K(o)}});ot?.addEventListener("click",async()=>{if(!Array.isArray(w)||w.length===0)return;let e=w.filter(n=>!n.completed);if(e.length===w.length)return;let t=w.map(n=>({...n}));w=e,K(e);try{await xn(e)}catch(n){console.error("Failed to clear completed tasks",n),w=t,K(t)}});pe(w);gt();function Wo(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),o=document.getElementById("noteNewBtn"),i=document.getElementById("notesList");if(!e||!t||!n||!o)return;let s=null,r=d=>{if(!d){s=null,e.value="",t.value="";return}s=d.id,e.value=d.title||"",t.value=d.body||""},a=()=>{if(!i)return;i.querySelectorAll("button[data-note-id]").forEach(u=>{if(!(u instanceof HTMLElement))return;let p=u.getAttribute("data-note-id")===s;u.classList.toggle("bg-base-200/80",p),u.classList.toggle("border-base-300",!p),u.classList.toggle("border-primary",p),u.classList.toggle("font-medium",p),u.setAttribute("aria-current",p?"true":"false")})},m=()=>{let d=ge();return Array.isArray(d)?[...d].sort((u,p)=>{let b=Date.parse(u?.updatedAt||""),g=Date.parse(p?.updatedAt||"");return(Number.isNaN(g)?0:g)-(Number.isNaN(b)?0:b)}):[]},l=d=>{if(!d)return;let u=ge();if(!Array.isArray(u))return;let p=u.filter(g=>g.id!==d);if(p.length===u.length)return;_e(p),s===d&&(s=null);let b=y();if(s){let g=b.find(A=>A.id===s)||null;r(g)}else b.length?r(b[0]):r(null);a()},y=(d=m())=>{if(!i)return d;if(i.innerHTML="",!d.length){let u=document.createElement("li");return u.className="text-sm italic text-base-content/60",u.textContent="No saved notes yet.",i.appendChild(u),d}return d.forEach(u=>{let p=document.createElement("li");p.className="flex items-center gap-2";let b=document.createElement("button");b.type="button",b.dataset.noteId=u.id,b.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",b.textContent=u.title||"Untitled note",b.addEventListener("click",()=>{r(u),a()});let g=document.createElement("button");g.type="button",g.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",g.setAttribute("aria-label",`Delete note "${u.title||"Untitled note"}"`),g.textContent="Delete",g.addEventListener("click",A=>{A.stopPropagation(),l(u.id)}),p.appendChild(b),p.appendChild(g),i.appendChild(p)}),a(),d},h=()=>{let d=y();if(!d.length){r(null),a();return}let u=s?d.find(p=>p.id===s):null;r(u||d[0]),a()};n.addEventListener("click",()=>{let d=ge(),u=Array.isArray(d)?[...d]:[],p=typeof e.value=="string"?e.value.trim():"",b=typeof t.value=="string"?t.value:"",g=p||"Untitled note",A=new Date().toISOString();if(s){let S=u.findIndex(T=>T.id===s);if(S>=0)u[S]={...u[S],title:g,body:b,updatedAt:A};else{let T=qe(g,b,{updatedAt:A});s=T.id,u.unshift(T)}}else{let S=qe(g,b);s=S.id,u.unshift(S)}_e(u);let M=y(),ne=s?M.find(S=>S.id===s):null;r(ne||null),a()}),o.addEventListener("click",()=>{s=null,e.value="",t.value="",a(),typeof e.focus=="function"&&e.focus()}),h()}Wo();var Dn="theme",Vo="professional",at="memoryCue:theme-change",jo="professional",lt=document.getElementById("theme-menu"),Cn="[data-theme-name],[data-theme-option]",Yo=new Set(["dark","dracula","synthwave"]);function U(e){return typeof e=="string"?e.trim():""}function In(e){return e instanceof HTMLElement?U(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Ko(e){let t=U(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Yo.has(t)))}function un(e){let t=U(e);if(t)try{localStorage.setItem(Dn,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Bn(e){if(!lt)return;let t=U(e);lt.querySelectorAll(Cn).forEach(o=>{if(!(o instanceof HTMLElement))return;let i=In(o),s=t&&i===t;o.setAttribute("aria-checked",s?"true":"false"),o.classList.toggle("active",s)})}function Go(e){let t=U(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(at,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent(at,!0,!0,{theme:t}),window.dispatchEvent(o)}}}function ct(e,{persist:t=!0,notify:n=!0}={}){let o=U(e);if(!o)return;U(document.documentElement.getAttribute("data-theme"))!==o&&Ko(o),t&&un(o),Bn(o),n&&Go(o)}function zo(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){ct(jo,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Dn)||""}catch(o){console.warn("Unable to load theme preference",o)}let n=t||document.documentElement.getAttribute("data-theme")||Vo;n&&ct(n,{persist:!1,notify:!0})}lt?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(Cn):null;if(!t)return;e.preventDefault();let n=In(t);n&&ct(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(at,e=>{let t=U(e?.detail?.theme);t&&Bn(t)});zo()});export default Qo();
