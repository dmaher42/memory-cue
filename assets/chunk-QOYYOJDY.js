import{a as ti}from"./chunk-RCZ4YZVR.js";function rn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function sn(){let a=rn(),l=a&&a.TimestampTrigger;return typeof l=="function"?l:null}function Q(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!sn()}function ii(){if(typeof window>"u"||!window.location)return It;try{return new URL(It,window.location.href).href}catch{return It}}async function te(){return lt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(lt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(ii()),await navigator.serviceWorker.ready}catch(a){return console.warn("Service worker registration failed",a),null}})(),lt))}async function an(a){if(!a||typeof a!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let l=await te();if(!l)return!1;let S=new Set;navigator.serviceWorker.controller&&S.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(C=>{let I=l[C];I&&S.add(I)});let b=!1;return S.forEach(C=>{try{C.postMessage(a),b=!0}catch(I){console.warn("Failed posting message to service worker",I)}}),b}catch(l){return console.warn("Unable to reach service worker",l),!1}}async function ut(){if(Q())return!1;if(xt)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Ie)try{return await Ie}catch{}Ie=(async()=>{let a=await te();if(!a)return!1;let l=!1;if("periodicSync"in a)try{let S=await a.periodicSync.getTags();(!Array.isArray(S)||!S.includes(Nt))&&await a.periodicSync.register(Nt,{minInterval:15*60*1e3}),l=!0}catch(S){console.warn("Periodic background sync unavailable",S)}if(!l&&"sync"in a)try{await a.sync.register(Nt),l=!0}catch(S){console.warn("Background sync unavailable",S)}return l})();try{let a=await Ie;return a&&(xt=!0),a}catch(a){return console.warn("Background reminder sync setup failed",a),xt=!1,!1}finally{Ie=null}}async function Mt(a=[],{requestCheck:l=!1}={}){if(!Q()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let S=await te();if(!S)return;let b=await an({type:on.updateScheduledReminders,reminders:Array.isArray(a)?a:[]});if(l&&await an({type:on.checkScheduledReminders}),!b&&typeof S.update=="function")try{await S.update()}catch{}}catch(S){console.warn("Failed syncing reminders with service worker",S)}}async function Ft(a,l){if(Q())try{let S=l||await te();if(!S)return;let b=[];try{b=await S.getNotifications({tag:a,includeTriggered:!0})}catch{b=await S.getNotifications({tag:a})}for(let C of b)try{C.close()}catch{}}catch{}}function dn(){for(let a of Array.from(K.values()))try{a.close()}catch{}K.clear()}function oi(){if(nn||typeof window>"u"||typeof window.addEventListener!="function")return;let a=()=>dn();["pagehide","beforeunload"].forEach(l=>{try{window.addEventListener(l,a)}catch{}}),nn=!0}function T(a){if(typeof a=="string"){let l=a.replace(/\s+/g," ").trim();if(l)return l}return x}async function di(a={}){let l=e=>e?document.querySelector(e):null,S=e=>e?Array.from(document.querySelectorAll(e)):[],b=l(a.titleSel),C=l(a.dateSel),I=l(a.timeSel),_=l(a.detailsSel),ne=l(a.prioritySel),L=l(a.categorySel),ge=l(a.saveBtnSel),ft=l(a.cancelEditBtnSel),j=l(a.listSel),Ne=S(a.googleSignInBtnSel),xe=S(a.googleSignOutBtnSel),E=l(a.statusSel),A=l(a.syncStatusSel),cn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},ln=6e3,P=null;function ce(e,{clearMessage:t=!0}={}){P&&(e&&P.tokenId!==e||(P.timeoutId&&clearTimeout(P.timeoutId),t&&E&&E.dataset.undoToken===P.tokenId&&(typeof E.replaceChildren=="function"?E.replaceChildren():E.textContent="",delete E.dataset.undoToken,delete E.dataset.statusKind),P=null))}function un(e){if(!E)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Kn(e.tokenId)),e.button=i,typeof E.replaceChildren=="function"?E.replaceChildren(t,n,i):(E.textContent="",E.append(t,n,i)),E.dataset.statusKind="undo",E.dataset.undoToken=e.tokenId}function pt(e,t){if(!A)return;let n=["online","offline","error"];n.forEach(r=>A.classList.remove(r)),n.includes(e)&&A.classList.add(e),A.dataset.state=e;let i=typeof t=="string"?t:cn[e]||"";e==="online"||e==="offline"?(A.textContent="",A.dataset.compact="true",i?(A.setAttribute("aria-label",i),A.setAttribute("title",i)):(A.removeAttribute("aria-label"),A.removeAttribute("title"))):(A.textContent=i,A.removeAttribute("data-compact"),i?(A.setAttribute("aria-label",i),A.setAttribute("title",i)):(A.removeAttribute("aria-label"),A.removeAttribute("title")))}let R=l(a.notesSel),fn=l(a.saveNotesBtnSel),pn=l(a.loadNotesBtnSel),$t=l(a.countTotalSel),Re=l(a.googleUserNameSel),ie=l(a.dateFeedbackSel),$=l(a.voiceBtnSel),mn=l(a.notifBtnSel),he=l(a.moreBtnSel),ve=l(a.moreMenuSel),yn=l(a.copyMtlBtnSel),mt=l(a.importFileSel),gn=l(a.exportBtnSel),hn=l(a.syncAllBtnSel),le=l(a.syncUrlInputSel),vn=l(a.saveSettingsSel),bn=l(a.testSyncSel),wn=S(a.openSettingsSel),Me=l(a.settingsSectionSel),ue=l(a.emptyStateSel),Ot=l(a.listWrapperSel),yt=l(a.categoryOptionsSel),oe=a.variant||"mobile",Bt="mc:lastDefaults";function gt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Bt)||"{}")||{}}catch{return{}}}function Sn(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Bt,JSON.stringify(e))}catch{}}function Pt(e){let t=gt(),n={category:T(e?.category||t.category||x),priority:e?.priority||t.priority||"Medium"};Sn(n)}let Ut='fieldset#priorityChips input[name="priority"]';function ht(){try{let e=document.querySelector(`${Ut}:checked`);if(e&&e.value)return e.value}catch{}return ne&&typeof ne.value=="string"&&ne.value?ne.value:"Medium"}function Fe(e){let t=e||"Medium";ne&&typeof ne.value<"u"&&(ne.value=t);try{let n=Array.from(document.querySelectorAll(Ut));if(!n.length)return;let i=!1;if(n.forEach(o=>{let r=o.value===t;o.checked=r,i=i||r}),!i){let o=n.find(r=>r.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function jt(){let e=gt();e.category&&L&&(L.value=e.category),e.priority&&Fe(e.priority)}jt();let O=typeof document<"u"?document.getElementById("quickAddInput"):null,En=typeof document<"u"?document.getElementById("quickAddSubmit"):null,B=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,vt=null;function kn(e,t){let n=Date.now(),i=gt(),o=typeof t=="string"&&t?t:null;return{id:et(),title:(e||"").trim(),priority:i.priority||ht(),category:T(i.category||L?.value||x),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!M}}async function bt(){if(!O)return;if(typeof vt=="function")try{vt()}catch{}let e=(O.value||"").trim();if(!e)return;let t=null;try{let i=ot(e);i&&i.time&&(t=new Date(`${i.date}T${i.time}:00`).toISOString())}catch{t=null}let n=kn(e,t);y.unshift(n),pe=!0,N(),F(),X(n),Le(n),de(n),ee(),Pt(n),Oe();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:y}}))}catch{}q({action:"created",label:`Reminder added \xB7 ${n.title}`}),O.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=bt),En?.addEventListener("click",()=>{bt()}),O?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),bt())});function An(){if(typeof HTMLElement>"u"||!(B instanceof HTMLElement)||!(O instanceof HTMLInputElement)||B.dataset.voiceBound==="true")return;if(B.dataset.voiceBound="true",typeof window>"u"){B.setAttribute("disabled","true"),B.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){B.setAttribute("disabled","true"),B.setAttribute("aria-disabled","true"),B.getAttribute("title")||(B.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=c=>{n=c,B.setAttribute("aria-pressed",c?"true":"false"),B.dataset.listening=c?"true":"false",B.classList.toggle("is-listening",c)},o=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",f=>{let p=f?.results?.[0]?.[0]?.transcript?.trim()||"";if(p){O.value=p;try{O.focus({preventScroll:!0})}catch{O.focus()}try{let v=O.value.length;typeof O.setSelectionRange=="function"&&O.setSelectionRange(v,v)}catch{}}});let s=()=>{i(!1)};return t.addEventListener("end",s),t.addEventListener("error",s),t},r=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};vt=r,B.addEventListener("click",()=>{let c=o();if(c){if(n){r();return}try{c.start(),i(!0)}catch(s){console.warn("Quick add voice error:",s),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",r),i(!1)}An(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&O&&(e.preventDefault(),O.focus())})));try{oe==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Ln=a.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",_t=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Dn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",$e=a.reminderLandingPath||(oe==="desktop"?"index.html#reminders":"mobile.html"),ae=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Ht(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Oe(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:y}}))}catch{}}L&&!L.value&&(L.value=x),Q()&&te();function q(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(tn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(tn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function Tn(){if(typeof HTMLElement>"u"||!($ instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&b instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&b instanceof HTMLTextAreaElement;if(!e&&!t||$.dataset.voiceBound==="true")return;if($.dataset.voiceBound="true",typeof window>"u"){$.setAttribute("disabled","true"),$.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){$.setAttribute("disabled","true"),$.setAttribute("aria-disabled","true"),$.getAttribute("title")||($.title="Voice input is not supported in this browser.");return}let i=null,o=!1,r=p=>{o=p,$.setAttribute("aria-pressed",p?"true":"false"),$.dataset.listening=p?"true":"false",$.classList.toggle("is-listening",p)},c=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",v=>{let w=v.results?.[0]?.[0]?.transcript?.trim()||"";if(w){b.value=w;try{b.focus({preventScroll:!0})}catch{try{b.focus()}catch{}}try{let U=b.value.length;typeof b.setSelectionRange=="function"&&b.setSelectionRange(U,U)}catch{}q({action:"dictated",label:`Voice input captured \xB7 ${w}`})}});let p=()=>{r(!1)};return i.addEventListener("end",p),i.addEventListener("error",p),i},s=()=>{if(!(!o||!i)){try{i.stop()}catch{}r(!1)}};$.addEventListener("click",()=>{let p=c();if(p){if(o){s();return}try{p.start(),r(!0)}catch(v){console.warn("Speech recognition error:",v),r(!1)}}});let f=()=>{s()};typeof document<"u"&&(document.addEventListener("cue:close",f),document.addEventListener("reminders:updated",f)),r(!1)}oi(),Tn();let Be,Pe,Ue,je,fe,_e,He,We,qe,Ve,Ge,be,we,Je,ze,Ke,Qe,Ye,Ze,Wt=a.firebaseDeps,wt=typeof a.importModule=="function"?a.importModule:e=>import(e),Se=rn(),Ee=!1,H=!1,St=null,V=null,re=null,y=[],pe=!1,M=null,ke=null,Ae=null,se={},D={};function qt(){M=null,pt("offline"),Ne.forEach(e=>e.classList.remove("hidden")),xe.forEach(e=>e.classList.add("hidden")),Re&&(Re.textContent=""),ke?.(),ke=null,kt(),N(),F(),ee()}function Et(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Rt);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i;return{id:typeof n.id=="string"&&n.id?n.id:et(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:T(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Cn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Rt);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:T(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem(Rt,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function F(){Cn(y)}function kt(){y=Et()}kt();async function In(){if(!M){y=Et();return}let e=Et();if(!e.length){y=[],F();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await X(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}y=e.map(n=>({...n,pendingSync:!1})),F(),N(),ee()}try{D=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{D={}}if(D&&typeof D=="object"&&Object.values(D).forEach(e=>{e&&typeof e=="object"&&(e.category=T(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Te(e),e.urlPath=e.urlPath||$e,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Q()){let e=Yt();typeof Notification<"u"&&Notification.permission==="granted"?(ut(),e.length&&Mt(e,{requestCheck:!0})):e.length&&Mt(e)}let Xe=e=>{if(!Se)return;let t=[Se];Se.window&&!t.includes(Se.window)&&t.push(Se.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Nn(){if(!R)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",r=()=>"value"in R?R.value:R.innerHTML,c=v=>{if("value"in R){R.value=v;return}if(typeof v!="string"||v.length===0){R.innerHTML="";return}let w=v.trim();if(/<\/?[a-z][\s\S]*>/i.test(w)){R.innerHTML=v;return}let J=v.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");R.innerHTML=J},s=v=>{v?R.classList.add("notes-editor--columns"):R.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!v))},f="";try{f=localStorage.getItem(n)||""}catch{m("Unable to access saved notes")}c(f);let p=!1;try{p=localStorage.getItem(i)==="1"}catch{p=!1}s(p),R.addEventListener("input",()=>{f=r();try{localStorage.setItem(n,f)}catch{m("Notes saved for this session only")}}),fn?.addEventListener("click",()=>{f=r();try{localStorage.setItem(n,f),m("Notes saved")}catch{m("Notes saved for this session only")}}),pn?.addEventListener("click",()=>{let v=f;try{v=localStorage.getItem(n)||f}catch{m("Unable to load saved notes")}f=v,c(f)}),e?.addEventListener("click",v=>{let w=v.target;if(!(w instanceof Element))return;let U=w.closest("button[data-action]");if(!U)return;let J=U.getAttribute("data-action");if(J==="columns"){let Ce=!R.classList.contains("notes-editor--columns");s(Ce);try{localStorage.setItem(i,Ce?"1":"0")}catch{m("Column preference saved for this session only")}return}if(!o){m("Formatting controls are not supported in this browser");return}R.focus(),J==="bullets"?document.execCommand("insertUnorderedList"):J==="numbers"&&document.execCommand("insertOrderedList")})}if(Nn(),ge?.addEventListener("click",Xt),Wt)({initializeApp:Be,getFirestore:Pe,enableMultiTabIndexedDbPersistence:Ue,enableIndexedDbPersistence:je,doc:fe,setDoc:_e,deleteDoc:He,onSnapshot:We,collection:qe,query:Ve,orderBy:Ge,serverTimestamp:be,getAuth:we,onAuthStateChanged:Je,GoogleAuthProvider:ze,signInWithPopup:Ke,signInWithRedirect:Qe,getRedirectResult:Ye,signOut:Ze}=Wt),Ee=!0;else try{({initializeApp:Be}=await wt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Pe,enableMultiTabIndexedDbPersistence:Ue,enableIndexedDbPersistence:je,doc:fe,setDoc:_e,deleteDoc:He,onSnapshot:We,collection:qe,query:Ve,orderBy:Ge,serverTimestamp:be}=await wt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:we,onAuthStateChanged:Je,GoogleAuthProvider:ze,signInWithPopup:Ke,signInWithRedirect:Qe,getRedirectResult:Ye,signOut:Ze}=await wt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Ee=!0}catch(e){Ee=!1,console.warn("Firebase modules failed to load:",e),m("Firebase failed to load; notes available offline"),Xe(!1)}if(Ee&&typeof Be=="function"&&typeof Pe=="function"&&typeof we=="function")try{St=Be({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),V=Pe(St),H=!0,Xe(!0)}catch(e){H=!1,console.warn("Firebase initialization failed:",e),m("Firebase failed to load; notes available offline"),Xe(!1)}else Ee?(H=!1,Xe(!1)):H=!1;H&&typeof Ue=="function"&&typeof je=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ue(V),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await je(V),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),H&&typeof we=="function"&&(re=we(St));function xn(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Rn=typeof navigator<"u"&&navigator.language?navigator.language:"",Vt=xn(Rn),me=Vt||"en-US",G="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(G=e.timeZone),!Vt&&e.locale&&(me=e.locale)}catch{}let Mn=new Intl.DateTimeFormat(me,{timeZone:G,hour:"2-digit",minute:"2-digit"}),Fn=new Intl.DateTimeFormat(me,{timeZone:G,weekday:"long",day:"numeric",month:"long"}),$n=new Intl.DateTimeFormat("en-CA",{timeZone:G,year:"numeric",month:"2-digit",day:"2-digit"}),On=new Intl.DateTimeFormat(me,{timeZone:G,weekday:"long"}),Bn=new Intl.DateTimeFormat(me,{timeZone:G,month:"short",day:"numeric"});function Y(e){let t=$n.formatToParts(e),n=t.find(r=>r.type==="year").value,i=t.find(r=>r.type==="month").value,o=t.find(r=>r.type==="day").value;return`${n}-${i}-${o}`}function Gt(e,t){let[n,i,o]=e.split("-").map(f=>parseInt(f,10)),[r,c]=t.split(":").map(f=>parseInt(f,10)),s=new Date;return s.setFullYear(n,(i||1)-1,o||1),s.setHours(r||0,c||0,0,0),s.toISOString()}let Pn=new Intl.DateTimeFormat("en-CA",{timeZone:G,year:"numeric",month:"2-digit",day:"2-digit"}),Un=new Intl.DateTimeFormat("en-CA",{timeZone:G,hour:"2-digit",minute:"2-digit",hour12:!1});function jn(e){try{let t=new Date(e),n=Pn.formatToParts(t),i=n.find(c=>c.type==="year")?.value||"0000",o=n.find(c=>c.type==="month")?.value||"00",r=n.find(c=>c.type==="day")?.value||"00";return`${i}-${o}-${r}`}catch{return""}}function _n(e){try{let t=new Date(e),n=Un.formatToParts(t),i=n.find(r=>r.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(r=>r.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function et(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function tt(){return Y(new Date)}function Hn(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function ri(e){let t=Hn(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function nt(e){return e==="High"?3:e==="Medium"?2:1}function si(e,t){let n=nt(t.priority)-nt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function At(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Fn.format(t)}catch{return e}}function it(e){return Mn.format(e)}function Z(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Jt(e){return e?Z(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function m(e){E&&(ce(),E.dataset.statusKind="toast",E.textContent=e,clearTimeout(m._t),m._t=setTimeout(()=>{E&&E.dataset.statusKind==="toast"&&(E.textContent="",delete E.dataset.statusKind)},2500))}function Wn(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function ot(e){e=String(e||"").toLowerCase();let t={date:tt(),time:""},n=s=>{let f=new Date,p=f.getDay(),v=(s-p+7)%7,w=new Date(f);return w.setDate(f.getDate()+(v===0?7:v)),w},i=s=>{let f=new Date,p=f.getDay(),v=(s-p+7)%7,w=new Date(f);return w.setDate(f.getDate()+v),w},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},r={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let s=new Date;s.setDate(s.getDate()+1),t.date=Y(s)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let s=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[s[1]],p=n(f);t.date=Y(p)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let s=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[s[1]],p=i(f);t.date=Y(p)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let s=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[s[1]],p=n(f);t.date=Y(p)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let s=e.match(/\bin\s+(\d+)\s+days?\b/),f=parseInt(s[1],10),p=new Date;p.setDate(p.getDate()+f),t.date=Y(p)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let s=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),f=parseInt(s[1],10),p=parseInt(s[2],10)-1,v=s[3]?parseInt(s[3],10):new Date().getFullYear(),w=new Date(v,p,f);t.date=Y(w)}else for(let[s,f]of Object.entries(r)){let p=new RegExp(`\\b${s}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(p.test(e)){let v=e.match(p),w=parseInt(v[1],10),U=new Date().getFullYear(),J=new Date(U,f,w);t.date=Y(J);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let s=parseInt(c[1],10),f=c[2]?parseInt(c[2],10):0,p=c[3];p&&(p==="pm"&&s<12&&(s+=12),p==="am"&&s===12&&(s=0)),t.time=`${String(s).padStart(2,"0")}:${String(f).padStart(2,"0")}`}return t}let at=H&&re&&typeof ze=="function";if(Ne.length){let e=async()=>{if(!at||typeof Ke!="function"||typeof Qe!="function"){m("Sign-in unavailable offline");return}let t=new ze;try{await Ke(re,t)}catch{try{await Qe(re,t)}catch{m("Google sign-in failed")}}};Ne.forEach(t=>{t.addEventListener("click",e)})}if(at&&typeof Ye=="function"&&Ye(re).catch(()=>{}),xe.length){let e=async()=>{if(!at||typeof Ze!="function"){m("Sign-out unavailable offline");return}try{await Ze(re),m("Signed out")}catch{m("Sign-out failed")}};xe.forEach(t=>{t.addEventListener("click",e)})}at&&typeof Je=="function"?Je(re,async e=>{e?(M=e.uid,pt("online"),Ne.forEach(t=>t.classList.add("hidden")),xe.forEach(t=>t.classList.remove("hidden")),Re&&(Re.textContent=e.displayName||e.email||""),qn(),await In()):qt()}):qt();function qn(){if(!H||!V||typeof qe!="function"||typeof Ve!="function"||typeof Ge!="function"||typeof We!="function")return;if(!M){kt(),N(),F(),ee();return}ke&&ke();let e=qe(V,"users",M,"reminders"),t=Ve(e,Ge("updatedAt","desc"));ke=We(t,n=>{let i=[];n.forEach(o=>{let r=o.data();i.push({id:o.id,title:r.title,priority:r.priority,notes:r.notes||"",done:!!r.done,due:r.due||null,category:T(r.category),createdAt:r.createdAt?.toMillis?.()||0,updatedAt:r.updatedAt?.toMillis?.()||0,pendingSync:!1})}),y=i,N(),F(),ee()},n=>{console.error("Firestore sync error:",n),A&&pt("error","Sync Error")})}async function X(e){if(!(!H||!M||!V||typeof fe!="function"||typeof _e!="function"||typeof be!="function"))try{await _e(fe(V,"users",M,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||x,createdAt:e.createdAt?new Date(e.createdAt):be(),updatedAt:be()},{merge:!0})}catch(t){console.error("Save failed:",t),m("Save queued (offline)")}}async function Vn(e){if(!(!H||!M||!V||typeof fe!="function"||typeof He!="function"))try{await He(fe(V,"users",M,"reminders",e))}catch{m("Delete queued (offline)")}}async function Le(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||x,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function De(){b&&(b.value=""),C&&(C.value=""),I&&(I.value=""),_&&(_.value=""),Fe("Medium"),L&&(L.value=x),jt(),Ae=null,ge&&(ge.textContent="Save Cue"),ft?.classList.add("hidden")}function zt(e){let t=y.find(n=>n.id===e);t&&(b&&(b.value=t.title||""),C&&I&&(t.due?(C.value=jn(t.due),I.value=_n(t.due)):(C.value="",I.value="")),Fe(t?.priority||"Medium"),L&&(L.value=T(t.category)),_&&(_.value=typeof t.notes=="string"?t.notes:""),Ae=e,ge&&(ge.textContent="Update Cue"),ft?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),b?.focus(),ae("cue:open",{mode:"edit"}))}function Gn(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=T(e.category??(L?L.value:"")),o={id:et(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!M};return y=[o,...y],pe=!0,N(),F(),Pt(o),X(o),Le(o),de(o),Oe(),ae("memoryCue:remindersUpdated",{items:y}),Ht(),q({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Jn(e,t){if(!M)return m("Sign in to add notes"),null;if(!e)return null;let n=y.find(c=>c.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let r=typeof n.notes=="string"?n.notes:"";return n.notes=r?`${r}
${o}`:o,n.updatedAt=Date.now(),X(n),N(),F(),q({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function zn(e){let t=y.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),X(t),Le(t),N(),F(),t.done?(st(e),q({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(de(t),q({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Kn(e){if(!P||P.tokenId!==e)return;let{item:t,index:n}=P;if(!t){ce(e);return}ce(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),y.length):y.length;t.pendingSync=!M,t.updatedAt=Date.now(),y.splice(i,0,t),pe=!0,N(),F(),de(t),X(t),Le(t),Oe(),ae("memoryCue:remindersUpdated",{items:y}),q({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),m("Reminder restored")}function Kt(e){let t=y.findIndex(o=>o.id===e),n=t>=0?y.splice(t,1)[0]:null;N(),F(),Vn(e),st(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(q({action:"deleted",label:i}),n&&E){ce();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;P={tokenId:o,item:n,index:t,timeoutId:null},un(P),P.timeoutId=setTimeout(()=>{ce(o)},ln)}else n&&ce()}function Te(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=it(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=it(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function Qt(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}m("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Yt(){return Object.values(D||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||x,notes:typeof e.notes=="string"?e.notes:"",body:Te(e),urlPath:e.urlPath||$e,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Lt(){try{localStorage.setItem("scheduledReminders",JSON.stringify(D))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Yt(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&ut(),Mt(e,{requestCheck:t})}function rt(e,{closeNotification:t=!0}={}){if(t){let n=K.get(e);if(n){try{n.close()}catch{}K.delete(e)}}se[e]&&(clearTimeout(se[e]),delete se[e]),Ft(e),D[e]&&(delete D[e],Lt())}function st(e){rt(e)}function Zt(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=K.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Te(e),tag:e.id});K.set(e.id,n);let i=()=>{K.get(e.id)===n&&K.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Qn(e){if(!Q())return!1;let t=sn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await te();if(!i)return!1;await Ft(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||x,body:r,urlPath:$e},r=Te(e),c={body:r,tag:e.id,data:o,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await i.showNotification(e.title,c),!0}catch(s){return console.warn("Failed to schedule persistent notification",s),!1}}function de(e){if(!e||!e.id)return;if(e.category=T(e.category),!e.due||e.done){st(e.id);return}let t=D[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||x,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Te(e),urlPath:$e,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,s=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?s:null})()};if(D[e.id]=n,Lt(),se[e.id]&&(clearTimeout(se[e.id]),delete se[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(D[e.id]?.viaTrigger){rt(e.id,{closeNotification:!1});return}Zt(e),rt(e.id,{closeNotification:!1});return}let r=Q();r&&(n.viaTrigger=!1,Qn(e).then(c=>{c&&D[e.id]&&(D[e.id]={...D[e.id],viaTrigger:!0},Lt())})),se[e.id]=setTimeout(()=>{r&&Ft(e.id),Zt(e),rt(e.id,{closeNotification:!1})},o)}function ee(){Object.values(D).forEach(e=>de({...e,category:T(e?.category)}))}function Yn(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=On.format(t),i=Bn.format(t),o=it(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function N(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),$t)try{$t.textContent=String(y.length)}catch{}y.forEach(d=>{d&&typeof d=="object"&&(d.category=T(d.category))});let o=new Set(ni.map(d=>T(d)));y.forEach(d=>{d&&typeof d=="object"&&o.add(T(d.category))});let r=Array.from(o).sort((d,g)=>d.localeCompare(g,void 0,{sensitivity:"base"}));if(yt){let d=new Set;Array.from(yt.querySelectorAll("option")).forEach(g=>{d.add(g.value.trim().toLowerCase())}),r.forEach(g=>{let u=g.toLowerCase();if(!d.has(u)){let h=document.createElement("option");h.value=g,yt.appendChild(h),d.add(u)}})}if(pe)pe=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let d=y.map(g=>({...g}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:d}}));else if(document.createEvent){let g=document.createEvent("CustomEvent");g&&g.initCustomEvent&&(g.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:d}),document.dispatchEvent(g))}}catch{}}let c=y.slice(),s=(d,g)=>{let u=d.done?1:0,h=g.done?1:0;if(u!==h)return u-h;let k=d.due?new Date(d.due).getTime():1/0,z=g.due?new Date(g.due).getTime():1/0;if(k!==z)return k-z;let ye=nt(g.priority)-nt(d.priority);return ye||(g.updatedAt||0)-(d.updatedAt||0)},f=!0;c.sort(s);let p=y.length>0,v=c.length>0;if(ue)if(v)ue.classList.add("hidden");else{let d=p?"No reminders to show right now.":Ln;_t?_t(ue,{icon:p?"sparkles":"bell",title:p?"Nothing to display":"Create your first cue",description:d,action:p?void 0:`<button type="button" class="${Dn}" data-trigger="open-cue">Create reminder</button>`}):ue.textContent=d,ue.classList.remove("hidden")}if(Ot&&Ot.classList.toggle("has-items",v),!j)return;if(!v){ue?(j.innerHTML="",j.classList.add("hidden")):(j.innerHTML='<div class="text-muted">No reminders found.</div>',j.classList.remove("hidden"));return}j.classList.remove("hidden"),j.replaceChildren();let w=document.createDocumentFragment(),U=j.tagName==="UL"||j.tagName==="OL",J=!0,Ce=(d,g)=>{let u=document.createElement("div");u.className="task-item";let h={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:g,done:!!d.done};u.dataset.category=g,u.dataset.reminder=JSON.stringify(h),u.dataset.id=h.id,u.dataset.title=h.title,u.dataset.priority=h.priority,u.dataset.done=String(h.done),h.dueIso&&(u.dataset.due=h.dueIso);let k=h.dueIso?new Date(h.dueIso):null;f&&k&&k>=n&&k<=i&&(u.classList.add("is-today"),u.dataset.today="true");let ye=d.due?`${it(new Date(d.due))} \u2022 ${At(d.due.slice(0,10))}`:"No due date",ct=g?Z(g):"",Dt=Z(h.priority),Tt=[`<span class="task-chip" data-chip="due">${Z(ye)}</span>`,ct?`<span class="task-chip" data-chip="category">${ct}</span>`:"",`<span class="task-chip" data-chip="priority">${Dt}</span>`].filter(Boolean).join(""),Ct=d.notes?`<div class="task-notes">${Jt(d.notes)}</div>`:"";return u.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${Z(d.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn" data-edit type="button" aria-label="Edit reminder">
                <span aria-hidden="true">\u270F\uFE0F</span>
                <span class="task-toolbar-label">Edit</span>
              </button>
              <button class="task-toolbar-btn" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          <div class="task-meta">
            <div class="task-meta-row" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              ${Tt}
            </div>
          </div>
          ${Ct}
        </div>`,u.querySelector("[data-edit]").addEventListener("click",()=>zt(d.id)),u.querySelector("[data-del]").addEventListener("click",()=>Kt(d.id)),u};if(oe!=="desktop"&&!J){c.forEach(d=>{let g=d.category||x;w.appendChild(Ce(d,g))}),j.appendChild(w);return}let dt=new Map;c.forEach(d=>{let g=d.category||x;dt.has(g)||dt.set(g,[]),dt.get(g).push(d)});let ei=Array.from(dt.entries()).sort((d,g)=>d[0].localeCompare(g[0],void 0,{sensitivity:"base"})),en=!0;ei.forEach(([d,g])=>{if(d!==x){let u=document.createElement(U?"li":"div");u.dataset.categoryHeading=d,U&&(u.setAttribute("role","presentation"),u.style.listStyle="none"),u.className=oe==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",en||(u.style.marginTop=oe==="desktop"?"1.25rem":"1rem");let h=document.createElement("div");h.setAttribute("role","heading"),h.setAttribute("aria-level","3"),h.className=oe==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let k=document.createElement("span");k.textContent=d;let z=document.createElement("span");z.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",z.textContent=`${g.length} ${g.length===1?"item":"items"}`,h.append(k,z),u.appendChild(h),w.appendChild(u)}g.forEach(u=>{if(oe==="desktop"){let h=document.createElement(U?"li":"div"),k={id:u.id,title:u.title,dueIso:u.due||null,priority:u.priority||"Medium",category:d,done:!!u.done};h.dataset.id=k.id,h.dataset.category=k.category,h.dataset.title=k.title,h.dataset.priority=k.priority,h.dataset.done=String(k.done),k.dueIso&&(h.dataset.due=k.dueIso),h.dataset.reminder=JSON.stringify(k),h.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let z=Yn(u),ye=u.done?"line-through text-base-content/50":"text-base-content",ct=u.done?"Completed":"Active",Dt=u.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Tt=u.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Ct=u.notes?`<p class="text-sm leading-relaxed text-base-content/70">${Jt(u.notes)}</p>`:"";h.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${ye}">${Z(u.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${Z(z)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${Z(d)}
            </span>
            <span class="${Dt} text-[0.7rem] sm:text-xs">${ct}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Ct}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Tt}">${u.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,h.querySelector('[data-action="toggle"]').addEventListener("click",()=>zn(u.id)),h.querySelector('[data-action="edit"]').addEventListener("click",()=>zt(u.id)),h.querySelector('[data-action="delete"]').addEventListener("click",()=>Kt(u.id)),w.appendChild(h);return}w.appendChild(Ce(u,d))}),en=!1}),j.appendChild(w)}function W(){he?.setAttribute("aria-expanded","false"),ve?.classList.add("hidden")}function Zn(){he?.setAttribute("aria-expanded","true"),ve?.classList.remove("hidden")}he?.addEventListener("click",e=>{e.stopPropagation(),he.getAttribute("aria-expanded")==="true"?W():Zn()}),document.addEventListener("click",e=>{ve&&!ve.classList.contains("hidden")&&!ve.contains(e.target)&&e.target!==he&&W()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&W()}),wn.forEach(e=>{e.addEventListener("click",()=>{let t=Me?.classList.contains("hidden");Me?.classList.toggle("hidden"),t&&Me?.scrollIntoView({behavior:"smooth",block:"start"}),W()})}),document.addEventListener("DOMContentLoaded",()=>{Me?.classList.add("hidden")});function Xt(){try{console.log("handleSaveAction invoked",{editingId:Ae,title:b?.value})}catch{}if(Ae){let i=y.find(s=>s.id===Ae);if(!i){De();return}let o=b.value.trim();if(!o){m("Add a reminder title");return}let r=null;if(C.value||I.value){let s=C.value||tt(),f=I.value||"09:00";r=Gt(s,f)}else{let s=ot(o);s.time&&(r=new Date(`${s.date}T${s.time}:00`).toISOString())}i.title=o;let c=ht();i.priority=c,Fe(c),L&&(i.category=T(L.value)),i.due=r,_&&(i.notes=_.value.trim()),i.updatedAt=Date.now(),X(i),Le(i),pe=!0,N(),de(i),F(),Oe(),ae("memoryCue:remindersUpdated",{items:y}),Ht(),q({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),De(),m("Reminder updated"),ae("cue:close",{reason:"updated"});return}let e=b.value.trim();if(!e){m("Add a reminder title");return}let t=_?_.value.trim():"",n=null;if(C.value||I.value){let i=C.value||tt(),o=I.value||"09:00";n=Gt(i,o)}else{let i=ot(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Gn({title:e,priority:ht(),category:L?L.value:"",due:n,notes:t}),b.value="",I.value="",_&&(_.value=""),ae("cue:close",{reason:"created"})}b?.addEventListener("keydown",e=>{e.key==="Enter"&&Xt()});function Xn(){if(!b||!ie)return;let e=b.value.trim();if(!e){ie.style.display="none";return}try{let t=ot(e),n=tt();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${At(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(ie.textContent=`Parsed: ${i}`,ie.style.display="block"):ie.style.display="none"}else ie.style.display="none"}catch{ie.style.display="none"}}return b?.addEventListener("input",Wn(Xn,300)),ft?.addEventListener("click",()=>{De(),m("Edit cancelled"),ae("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{De()}),document.addEventListener("cue:prepare",()=>{De()}),window.addEventListener("load",()=>b?.focus()),yn?.addEventListener("click",()=>{let e=y.filter(t=>!t.done).map(t=>{let n=t.due?At(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(me,{hour:"2-digit",minute:"2-digit",timeZone:G}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){m("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>m("Copied for Master Task List")).catch(()=>m("Copy failed")),W()}),mt?.addEventListener("change",()=>{let e=mt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(i=>{i.id=et(),i.category=T(i.category),i.pendingSync=!M,y=[i,...y],X(i)}),N(),F(),m("Import successful")}catch{m("Invalid JSON")}},t.readAsText(e),mt.value="",W()}),gn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),W()}),hn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){m("Add your Apps Script URL in Settings first"),W();return}if(!y.length){m("No tasks to sync"),W();return}m("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<y.length;i+=t){let o=y.slice(i,i+t),r=await Promise.allSettled(o.map(c=>{let s={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||x,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}));n+=r.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}m(`Sync complete: ${y.length-n} ok${n?`, ${n} failed`:""}`),W()}),le&&(le.value=localStorage.getItem("syncUrl")||""),vn?.addEventListener("click",()=>{le&&(localStorage.setItem("syncUrl",le.value.trim()),m("Settings saved"))}),bn?.addEventListener("click",async()=>{if(!le)return;let e=le.value.trim();if(!e){m("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});m(t.ok?"Test ok":"Test failed")}catch{m("Test failed")}}),mn?.addEventListener("click",async()=>{if(!("Notification"in window)){m("Notifications not supported");return}if(Notification.permission==="granted"){m("Notifications enabled"),Q()?te():(ut(),Qt()),ee();return}try{await Notification.requestPermission()==="granted"?(m("Notifications enabled"),Q()?te():(ut(),Qt()),ee()):m("Notifications blocked")}catch{m("Notifications blocked")}}),ee(),N(),F(),{cancelReminder:st,scheduleReminder:de,closeActiveNotifications:dn,getActiveNotifications:()=>K,addNoteToReminder:Jn,__testing:{setItems(e=[]){y=Array.isArray(e)?e.map(t=>({...t,category:T(t?.category)})):[],N()},render:N,getItems:()=>y.map(e=>({...e}))}}}var tn,K,nn,It,Nt,on,lt,Ie,xt,x,ni,Rt,ai=ti(()=>{tn="memoryCue:activity",K=new Map,nn=!1,It="service-worker.js",Nt="memory-cue-reminder-sync",on=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),lt=null,Ie=null,xt=!1,x="General",ni=Object.freeze([x,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Rt="memoryCue:offlineReminders"});export{di as a,ai as b};
