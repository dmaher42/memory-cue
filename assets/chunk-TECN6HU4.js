import{b as pn,c as xo}from"./chunk-QHE5AMPX.js";import{a as Hi,b as jn,c as Do}from"./chunk-GUVSRPRW.js";function $i(o={}){try{Object.assign(U,o||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function qi(o={}){try{if(U&&typeof U.signInWithPopup=="function"&&U.auth&&typeof U.GoogleAuthProvider=="function")return U.signInWithPopup(U.auth,new U.GoogleAuthProvider);if(U&&typeof U.signInWithRedirect=="function"&&U.auth&&typeof U.GoogleAuthProvider=="function")return U.signInWithRedirect(U.auth,new U.GoogleAuthProvider);let r=pn();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...o});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{U?.toast?.("Sign-in failed")}catch(c){console.warn("[supabase-auth] toast handler failed",c)}throw r}return Promise.resolve(null)}async function ji(){try{if(U&&typeof U.signOut=="function")return U.signOut(U.auth);let o=pn();if(o&&o.auth&&typeof o.auth.signOut=="function")return o.auth.signOut()}catch(o){throw console.error("[supabase-auth] startSignOutFlow error",o),o}return Promise.resolve(null)}function Ro(o){return o?Array.isArray(o)?o:[o]:[]}function At(o){return Array.from(new Set(o.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function fe(o,r){let c=Ro(r).filter(Boolean);if(!c.length)return[];let h=c.flatMap(L=>Array.from(o.querySelectorAll(L)));return At(h)}function Fo(o,r=document){let c=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:fe(c,o.authForm),emailInputs:fe(c,o.emailInput),signInButtons:fe(c,o.signInButtons),signOutButtons:fe(c,o.signOutButtons),userBadges:fe(c,o.userBadge),userBadgeEmails:fe(c,o.userBadgeEmail),userBadgeInitials:fe(c,o.userBadgeInitial),userNameEls:fe(c,o.userName),syncStatusEls:fe(c,o.syncStatus),syncStatusTextEls:fe(c,o.syncStatusText),statusIndicatorEls:fe(c,o.statusIndicator),feedbackEls:fe(c,o.feedback)}}function Et(o,r){At(Array.isArray(o)?o:[o]).forEach(c=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!r),r?c.removeAttribute("hidden"):c.setAttribute("hidden",""))})}function Me(o,r){At(Array.isArray(o)?o:[o]).forEach(c=>{c instanceof HTMLElement&&(c.textContent=r||"")})}function Bo(o,r){At(o).forEach(c=>{c instanceof HTMLElement&&(c.dataset.state=r,c.classList.toggle("online",r==="online"),c.classList.toggle("offline",r!=="online"))})}function Tt(o,r){At(o).forEach(c=>{if(!(c instanceof HTMLElement))return;c.textContent=r||"";let h=!!r;c.classList.toggle("hidden",!h),h?c.removeAttribute("hidden"):c.setAttribute("hidden","")})}function Vi(o={}){let r={...Ui.syncStatusText,...o.syncStatusText||{}};return{...Ui,...o,syncStatusText:r}}function St(o,{user:r,messages:c}={}){let h=Vi(c),L=!!r;Et(o.signInButtons,!L),Et(o.authForms,!L),Et(o.signOutButtons,L),Et(o.userBadges,L);let F=typeof r?.email=="string"?r.email:"",M=F?F.charAt(0).toUpperCase():"U";L?(Me(o.userBadgeEmails,F),Me(o.userBadgeInitials,M),Me(o.userNameEls,F)):(Me(o.userBadgeEmails,""),Me(o.userBadgeInitials,""),Me(o.userNameEls,""));let ne=typeof h.signedIn=="function"?h.signedIn(r):h.signedIn,N=typeof h.signedOut=="function"?h.signedOut(r):h.signedOut,ie=L?ne:N,ae=!L;o.syncStatusEls.length&&(Me(o.syncStatusEls,ie),o.syncStatusEls.forEach(Se=>{Se instanceof HTMLElement&&(Se.classList.toggle("online",L),Se.dataset.state=L?"online":"offline")}),Et(o.syncStatusEls,ae));let A=L?h.syncStatusText?.signedIn:h.syncStatusText?.signedOut;Me(o.syncStatusTextEls,A||""),Bo(o.statusIndicatorEls,L?"online":"offline"),Tt(o.feedbackEls,"")}function Mo(o,r){r.authForms.forEach(c=>{!(c instanceof HTMLFormElement)||c.dataset.supabaseAuthBound==="true"||(c.dataset.supabaseAuthBound="true",c.addEventListener("submit",async h=>{h.preventDefault();let L=r.emailInputs.find(M=>c.contains(M))||c.querySelector('input[type="email"]'),F=typeof L?.value=="string"?L.value.trim():"";if(!F){Tt(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:M}=await o.auth.signInWithOtp({email:F});M?Tt(r.feedbackEls,M.message||"Unable to send magic link."):Tt(r.feedbackEls,"Magic link sent. Check your email.")}catch(M){Tt(r.feedbackEls,M?.message||"Unable to send magic link.")}}))})}function Oo(o,r){r.signOutButtons.forEach(c=>{!(c instanceof HTMLElement)||c.dataset.supabaseAuthBound==="true"||(c.dataset.supabaseAuthBound="true",c.addEventListener("click",async()=>{try{await o.auth.signOut()}catch(h){console.error("[supabase] Sign-out failed.",h)}}))})}function Zo(o={}){let{supabase:r,scope:c=document,selectors:h={},messages:L={},disableButtonBinding:F=!1,onSessionChange:M}=o,ne={...No,...h},N=Fo(ne,c),ie=Vi(L);St(N,{user:null,messages:ie});let ae=r||pn()||(typeof window<"u"?window.supabase:null);if(!ae)return{supabase:null,elements:N,applyAuthState:de=>St(N,{...de,messages:ie}),destroy(){}};Mo(ae,N),F||Oo(ae,N);let A=[],{data:Se}=ae.auth.onAuthStateChange((de,me)=>{if(St(N,{user:me?.user??null,messages:ie}),typeof M=="function")try{M(me?.user??null,me)}catch(et){console.error("[supabase] onSessionChange handler failed.",et)}});return Se?.subscription&&A.push(()=>{try{Se.subscription.unsubscribe()}catch{}}),ae.auth.getSession().then(({data:de,error:me})=>{me||St(N,{user:de?.session?.user??null,messages:ie})}).catch(de=>{console.error("[supabase] getSession failed.",de)}),{supabase:ae,elements:N,applyAuthState:de=>St(N,{...de,messages:ie}),destroy(){A.forEach(de=>{try{de()}catch{}})}}}var U,No,Ui,Wi=jn(()=>{xo();U={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};No={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},Ui={signedOut:"",signedIn:o=>`Reminders syncing for ${o?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Xi=Do((ts,It)=>{var mn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Yi(o){if(!o||typeof o!="object")return null;let r=Object.entries(o).filter(([c,h])=>typeof h=="string"&&h.trim()!=="");return r.length?Object.fromEntries(r):null}function Po(){let o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=Yi(o?.__FIREBASE_CONFIG);if(r)return r;let c=Yi(o?.__ENV?.FIREBASE_CONFIG);if(c)return c;let L=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((F,[M,ne])=>{let N=o?.__ENV?.[M]??o?.[M];return typeof N=="string"&&N.trim()!==""&&(F[ne]=N),F},{});return Object.keys(L).length?L:null}function Ki(){let o=Po();return o?{...mn,...o}:{...mn}}var Gi={DEFAULT_FIREBASE_CONFIG:mn,getFirebaseConfig:Ki};if(typeof globalThis<"u"){let o=globalThis;o.memoryCueFirebase=o.memoryCueFirebase||{},o.memoryCueFirebase.getFirebaseConfig=Ki,o.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=mn}typeof It<"u"&&It.exports&&(It.exports=Gi,It.exports.default=Gi)});function Uo(){if(Ee)return{...Ee};let r=zn()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return Ee=r.getFirebaseConfig(),{...Ee};if(typeof Hi=="function")try{let c=Xi();if(c){let h=typeof c.getFirebaseConfig=="function"?c.getFirebaseConfig:typeof c.default?.getFirebaseConfig=="function"?c.default.getFirebaseConfig:null;if(h)return Ee=h(),{...Ee}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(Ee={...r.DEFAULT_FIREBASE_CONFIG},{...Ee}):(Ee={...Ho},{...Ee})}function zn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function er(){let o=zn(),r=o&&o.TimestampTrigger;return typeof r=="function"?r:null}function De(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!er()}function $o(){if(typeof window>"u"||!window.location)return Vn;try{return new URL(Vn,window.location.href).href}catch{return Vn}}async function Oe(){return yn||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(yn=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register($o()),await navigator.serviceWorker.ready}catch(o){return console.warn("Service worker registration failed",o),null}})(),yn))}async function Zi(o){if(!o||typeof o!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await Oe();if(!r)return!1;let c=new Set;navigator.serviceWorker.controller&&c.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(L=>{let F=r[L];F&&c.add(F)});let h=!1;return c.forEach(L=>{try{L.postMessage(o),h=!0}catch(F){console.warn("Failed posting message to service worker",F)}}),h}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function hn(){if(De())return!1;if(Yn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Lt)try{return await Lt}catch{}Lt=(async()=>{let o=await Oe();if(!o)return!1;let r=!1;if("periodicSync"in o)try{let c=await o.periodicSync.getTags();(!Array.isArray(c)||!c.includes(Wn))&&await o.periodicSync.register(Wn,{minInterval:15*60*1e3}),r=!0}catch(c){console.warn("Periodic background sync unavailable",c)}if(!r&&"sync"in o)try{await o.sync.register(Wn),r=!0}catch(c){console.warn("Background sync unavailable",c)}return r})();try{let o=await Lt;return o&&(Yn=!0),o}catch(o){return console.warn("Background reminder sync setup failed",o),Yn=!1,!1}finally{Lt=null}}async function Kn(o=[],{requestCheck:r=!1}={}){if(!De()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let c=await Oe();if(!c)return;let h=await Zi({type:Qi.updateScheduledReminders,reminders:Array.isArray(o)?o:[]});if(r&&await Zi({type:Qi.checkScheduledReminders}),!h&&typeof c.update=="function")try{await c.update()}catch{}}catch(c){console.warn("Failed syncing reminders with service worker",c)}}async function Xn(o,r){if(De())try{let c=r||await Oe();if(!c)return;let h=[];try{h=await c.getNotifications({tag:o,includeTriggered:!0})}catch{h=await c.getNotifications({tag:o})}for(let L of h)try{L.close()}catch{}}catch{}}function tr(){for(let o of Array.from(ke.values()))try{o.close()}catch{}ke.clear()}function qo(){if(Ji||typeof window>"u"||typeof window.addEventListener!="function")return;let o=()=>tr();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,o)}catch{}}),Ji=!0}function X(o){if(typeof o=="string"){let r=o.replace(/\s+/g," ").trim();if(r)return r}return W}async function is(o={}){let r=e=>e?document.querySelector(e):null,c=e=>e?Array.from(document.querySelectorAll(e)):[],h=r(o.titleSel),L=r(o.dateSel),F=r(o.timeSel),M=r(o.detailsSel),ne=r(o.prioritySel),N=r(o.categorySel),ie=r(o.saveBtnSel),ae=r(o.cancelEditBtnSel),A=r(o.listSel),Se="reminder-title-pinned",de="reminder-title-unpinned",me=r(o.detailPanelSel),et=r(o.detailEmptySel),gn=r(o.detailContentSel),Ct=r(o.detailTitleSel),kt=r(o.detailDueSel),Dt=r(o.detailPrioritySel),xt=r(o.detailCategorySel),Te=r(o.detailNotesSel),Qn=Te?.dataset?.placeholder||"No notes added yet.",nr=r(o.detailClearSel),Nt=c(o.googleSignInBtnSel),Rt=c(o.googleSignOutBtnSel),H=r(o.statusSel),Y=r(o.syncStatusSel),ir={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},rr=6e3,ce=null,Ft=null;function qe(e,{clearMessage:t=!0}={}){ce&&(e&&ce.tokenId!==e||(ce.timeoutId&&clearTimeout(ce.timeoutId),t&&H&&H.dataset.undoToken===ce.tokenId&&(typeof H.replaceChildren=="function"?H.replaceChildren():H.textContent="",delete H.dataset.undoToken,delete H.dataset.statusKind),ce=null))}function or(e){if(!H)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>wo(e.tokenId)),e.button=i,typeof H.replaceChildren=="function"?H.replaceChildren(t,n,i):(H.textContent="",H.append(t,n,i)),H.dataset.statusKind="undo",H.dataset.undoToken=e.tokenId}function tt(e){if(!me)return;let t=!!e;if(me.dataset.state=t?"active":"empty",me.dataset.selectedId=t&&e?.id?e.id:"",et&&(et.classList.toggle("hidden",t),et.setAttribute("aria-hidden",t?"true":"false")),gn&&(gn.classList.toggle("hidden",!t),gn.setAttribute("aria-hidden",t?"false":"true")),!t){Ct&&(Ct.textContent=""),kt&&(kt.textContent=""),Dt&&(Dt.textContent=""),xt&&(xt.textContent=""),Te&&(Te.textContent=Qn,Te.dataset.empty="true");return}if(Ct&&(Ct.textContent=e.title||"Untitled reminder"),kt&&(kt.textContent=Ni(e)),Dt&&(Dt.textContent=e.priority||"Medium"),xt&&(xt.textContent=e.category||W),Te){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Te.textContent=n,Te.dataset.empty="false"):(Te.textContent=Qn,Te.dataset.empty="true")}}function Zn(){Ft=null,tt(null)}function sr(e){Ft=e?.id||null,tt(e||null)}function ar(){if(!me)return;if(!Ft){tt(null);return}let e=p.find(t=>t?.id===Ft);if(e){tt(e);return}Zn()}tt(null);function bn(e,t){if(!Y)return;let n=["online","offline","error"];n.forEach(a=>Y.classList.remove(a)),n.includes(e)&&Y.classList.add(e),Y.dataset.state=e;let i=typeof t=="string"?t:ir[e]||"";e==="online"||e==="offline"?(Y.textContent="",Y.dataset.compact="true",i?(Y.setAttribute("aria-label",i),Y.setAttribute("title",i)):(Y.removeAttribute("aria-label"),Y.removeAttribute("title"))):(Y.textContent=i,Y.removeAttribute("data-compact"),i?(Y.setAttribute("aria-label",i),Y.setAttribute("title",i)):(Y.removeAttribute("aria-label"),Y.removeAttribute("title")))}let Q=r(o.notesSel),dr=r(o.saveNotesBtnSel),cr=r(o.loadNotesBtnSel),ei=r(o.countTotalSel),Bt=r(o.googleUserNameSel),Pe=r(o.dateFeedbackSel),re=r(o.voiceBtnSel),lr=r(o.notifBtnSel),nt=r(o.moreBtnSel),it=r(o.moreMenuSel),ur=r(o.copyMtlBtnSel),wn=r(o.importFileSel),fr=r(o.exportBtnSel),pr=r(o.syncAllBtnSel),je=r(o.syncUrlInputSel),mr=r(o.saveSettingsSel),yr=r(o.testSyncSel),hr=c(o.openSettingsSel),Mt=r(o.settingsSectionSel),Ve=r(o.emptyStateSel),ti=r(o.listWrapperSel),vn=r(o.categoryOptionsSel),Z=r(o.plannerContextSel),$=r(o.plannerLessonInputSel),ee=o.variant||"mobile",gr=typeof o.autoWireAuthButtons=="boolean"?o.autoWireAuthButtons:ee!=="desktop",rt="all",En=[],Sn="";function br(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function We(){if(ee!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=br(),n;rt==="today"?n=`Today\u2019s reminders \u2022 ${t}`:rt==="completed"?n=`Completed reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,Sn&&(n+=` \u2022 ${Sn}`),e.textContent=n}function wr(){ee==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(s=>{if(!s.ok)throw new Error("Weather request failed");return s.json()}).then(s=>{s&&s.current_weather&&typeof s.current_weather.temperature=="number"&&(Sn=`${Math.round(s.current_weather.temperature)}\xB0C`,We())}).catch(s=>{console.warn("Failed to fetch current temperature",s)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let ni="mc:lastDefaults",Tn=()=>{Z&&(Z.classList.add("hidden"),Z.setAttribute("aria-hidden","true"),typeof Z.replaceChildren=="function"?Z.replaceChildren():Z.textContent=""),$&&($.value="",$.dataset&&(delete $.dataset.lessonDayLabel,delete $.dataset.lessonTitle,delete $.dataset.lessonSummary))},vr=(e={})=>{if(!Z)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",s=document.createElement("p");s.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",s.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let d=i?document.createElement("p"):null;d&&(d.className="text-sm text-base-content/70",d.textContent=i),typeof Z.replaceChildren=="function"?Z.replaceChildren(...[s,a,d].filter(Boolean)):(Z.textContent="",Z.append(s,a),d&&Z.append(d)),Z.classList.remove("hidden"),Z.removeAttribute("aria-hidden")},Er=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";h&&typeof e.reminderTitle=="string"&&(h.value=e.reminderTitle),M&&typeof e.reminderNotes=="string"&&(M.value=e.reminderNotes),L&&typeof e.dueDate=="string"&&(L.value=e.dueDate),$&&($.value=t,$.dataset&&($.dataset.lessonDayLabel=dayLabel,$.dataset.lessonTitle=lessonTitle,$.dataset.lessonSummary=summary)),vr(e)};function An(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(ni)||"{}")||{}}catch{return{}}}function Sr(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(ni,JSON.stringify(e))}catch{}}function Tr(e){let t=An(),n={category:X(e?.category||t.category||W),priority:e?.priority||t.priority||"Medium"};Sr(n)}let ii='fieldset#priorityChips input[name="priority"]';function Ot(){try{let e=document.querySelector(`${ii}:checked`);if(e&&e.value)return e.value}catch{}return ne&&typeof ne.value=="string"&&ne.value?ne.value:"Medium"}function Pt(e){let t=e||"Medium";ne&&typeof ne.value<"u"&&(ne.value=t);try{let n=Array.from(document.querySelectorAll(ii));if(!n.length)return;let i=!1;if(n.forEach(s=>{let a=s.value===t;s.checked=a,i=i||a}),!i){let s=n.find(a=>a.value==="Medium")||n[0];s&&(s.checked=!0)}}catch{}}function ri(){let e=An();e.category&&N&&(N.value=e.category),e.priority&&Pt(e.priority)}ri();let Ar=typeof document<"u"?document.getElementById("quickAddForm"):null,K=typeof document<"u"?document.getElementById("quickAddInput"):null,Ir=typeof document<"u"?document.getElementById("quickAddSubmit"):null,oe=typeof document<"u"?document.getElementById("quickAddVoice")||document.getElementById("voiceBtn"):null,xe=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,In=null,Ln="memoryCueNotes",oi="memoryCueFolders",si="Lesson \u2013 Reflections";function Lr(e){let t=typeof e=="string"?e:"",n=[{kind:"footy-drill",pattern:/^\s*footy\s+drill\s*:\s*/i},{kind:"reflection",pattern:/^\s*reflection\s*:\s*/i},{kind:"task",pattern:/^\s*task\s*:\s*/i}];for(let i of n)if(i.pattern.test(t))return{kind:i.kind,text:t.replace(i.pattern,"").trim()};return{kind:"default",text:t.trim()}}function ai(e,t=[]){if(typeof localStorage>"u")return Array.isArray(t)?[...t]:[];try{let n=localStorage.getItem(e);if(!n)return Array.isArray(t)?[...t]:[];let i=JSON.parse(n);return Array.isArray(i)?i:Array.isArray(t)?[...t]:[]}catch{return Array.isArray(t)?[...t]:[]}}function Cr(){let t=ai(oi,[{id:"unsorted",name:"Unsorted",order:0}]).filter(d=>d&&typeof d=="object"&&typeof d.id=="string"),n=t.find(d=>d.name===si);if(n?.id)return n.id;let i=new Set(t.map(d=>d.id)),s="lesson-reflections",a=1;for(;i.has(s);)a+=1,s=`lesson-reflections-${a}`;t.push({id:s,name:si,order:t.length});try{localStorage.setItem(oi,JSON.stringify(t))}catch{}return s}function kr(e){let t=typeof e=="string"?e.trim():"";if(!t||typeof localStorage>"u")return null;let n=Cr(),i=ai(Ln,[]),s=new Date().toISOString(),a={id:nn(),title:t,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:s,folderId:n};i.unshift(a);try{localStorage.setItem(Ln,JSON.stringify(i))}catch{return null}return a}function Dr(e,t){let n=An(),i=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||Ot(),category:X(n.category||N?.value||W),notes:"",due:i,pinToToday:!1}}function di(e,t=null){let n=typeof e=="string"?e.trim():"";if(!n)return{keywordQuery:"",timeRange:null};let i=t instanceof Date&&!Number.isNaN(t.getTime())?new Date(t):new Date,s=n.toLowerCase(),a=/\b(monday|mon|tuesday|tue|tues|wednesday|wed|thursday|thu|thur|thurs|friday|fri|saturday|sat|sunday|sun)\b/i,d=/\b(\d{1,2})(?::(\d{2}))?\s*(am|pm)?\b/i,l=/\btoday\b/i,f=/\byesterday\b/i,u=s.match(a),m=s.match(d),S=s.match(l),T=s.match(f),O=()=>{if(!m)return null;let v=Number.parseInt(m[1],10),x=Number.parseInt(m[2]||"0",10),j=m[3]?m[3].toLowerCase():null;return!Number.isFinite(v)||!Number.isFinite(x)||x>59||(j==="pm"&&v<12?v+=12:j==="am"&&v===12&&(v=0),v>23)?null:{hours:v,minutes:x}},D=v=>String(v).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),w=()=>{let v=n;return u&&(v=v.replace(new RegExp(`\\b${D(u[0])}\\b`,"i")," ")),S&&(v=v.replace(new RegExp(`\\b${D(S[0])}\\b`,"i")," ")),T&&(v=v.replace(new RegExp(`\\b${D(T[0])}\\b`,"i")," ")),m&&(v=v.replace(new RegExp(D(m[0]),"i")," ")),v.replace(/\s+/g," ").trim()},b=(v=0)=>{let x=new Date(i);x.setHours(0,0,0,0),x.setDate(x.getDate()+v);let j=new Date(x);return j.setHours(23,59,59,999),{start:x.getTime(),end:j.getTime()}},C=O();if(u&&C){let v=u[1].slice(0,3).toLowerCase(),j={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[v];if(typeof j=="number"){let be=new Date(i),Ue=(j-be.getDay()+7)%7;return be.setDate(be.getDate()+Ue),be.setHours(C.hours,C.minutes,0,0),{keywordQuery:w(),timeRange:{start:be.getTime()-60*60*1e3,end:be.getTime()+60*60*1e3}}}}if(S||T){if(C){let v=new Date(i);return T&&v.setDate(v.getDate()-1),v.setHours(C.hours,C.minutes,0,0),{keywordQuery:w(),timeRange:{start:v.getTime()-60*60*1e3,end:v.getTime()+60*60*1e3}}}return{keywordQuery:w(),timeRange:b(T?-1:0)}}return{keywordQuery:n,timeRange:null}}function xr(){let e=typeof document<"u"?document.getElementById("inboxSearchInput"):null,t=typeof document<"u"?document.getElementById("inboxSearchResults"):null;if(!e||!t)return;let n=()=>{if(typeof localStorage>"u")return[];try{let d=localStorage.getItem(Ln),l=d?JSON.parse(d):[];return Array.isArray(l)?l:[]}catch{return[]}},i=d=>{if(!Number.isFinite(d))return"No date";try{return new Date(d).toLocaleString()}catch{return"No date"}},s=d=>{if(t.innerHTML="",!d.length)return;let l=document.createDocumentFragment();d.slice(0,20).forEach(f=>{let u=document.createElement("li");u.className="text-xs py-1 border-b border-base-300/60";let m=document.createElement("span");m.className="badge badge-outline badge-xs mr-2",m.textContent=f.type;let S=document.createElement("span");S.textContent=f.title||"(untitled)";let T=document.createElement("div");T.className="opacity-70",T.textContent=i(f.timestamp),u.appendChild(m),u.appendChild(S),u.appendChild(T),l.appendChild(u)}),t.appendChild(l)},a=()=>{let l=(e.value||"").trim();if(!l){t.innerHTML="";return}let f=di(l),u=(f.keywordQuery||"").toLowerCase().split(/\s+/).map(D=>D.trim()).filter(Boolean),m=(Array.isArray(p)?p:[]).map(D=>({type:"Reminder",title:D?.title||"",body:D?.notes||"",timestamp:Number.isFinite(D?.createdAt)?D.createdAt:null})),S=n().map(D=>{let w=typeof D?.updatedAt=="string"?Date.parse(D.updatedAt):Number.NaN,b=typeof D?.createdAt=="string"?Date.parse(D.createdAt):Number.NaN;return{type:"Note",title:D?.title||"",body:D?.bodyText||D?.body||"",timestamp:Number.isFinite(w)?w:Number.isFinite(b)?b:null}}),O=[...m,...S].filter(D=>{let w=`${D.title} ${D.body}`.toLowerCase();return!u.length||u.every(C=>w.includes(C))?f.timeRange?Number.isFinite(D.timestamp)?D.timestamp>=f.timeRange.start&&D.timestamp<=f.timeRange.end:!1:!0:!1});O.sort((D,w)=>(w.timestamp||0)-(D.timestamp||0)),s(O)};e.addEventListener("input",a),document.addEventListener("memoryCue:remindersUpdated",a)}async function ot(e={}){if(!K)return null;if(typeof In=="function")try{In()}catch{}let t=typeof e.text=="string"?e.text:(K.value||"").trim(),n=Lr(t),i=n.text;if(!i)return null;if(n.kind==="reflection"){let u=kr(i);return u?(K.value="",u):null}let a=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,d=null;if(a)d=new Date(a).toISOString();else try{let u=sn(i);u&&u.time&&(d=new Date(`${u.date}T${u.time}:00`).toISOString())}catch{d=null}let l=Dr(i,d);if(n.kind==="footy-drill"?l.category="Footy \u2013 Drills":n.kind==="task"&&(l.category="Tasks"),e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{l.notifyAt=new Date(e.notifyAt).toISOString()}catch{l.notifyAt=null}let f=Ci(l,{closeSheet:!1});if(f&&typeof document<"u"){K.value="";try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:f}}))}catch{}}return f||null}typeof window<"u"&&(window.memoryCueQuickAddNow=ot),Ir?.addEventListener("click",()=>{ot()}),K?.addEventListener("keydown",e=>{(e.key==="Enter"||e.key==="NumpadEnter")&&(e.preventDefault(),ot())}),Ar?.addEventListener("submit",e=>{e.preventDefault(),ot()}),xr();function Nr(){if(typeof HTMLElement>"u"||!(oe instanceof HTMLElement)||!(K instanceof HTMLInputElement)||oe.dataset.voiceBound==="true")return;if(oe.dataset.voiceBound="true",typeof window>"u"){oe.setAttribute("disabled","true"),oe.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){oe.setAttribute("disabled","true"),oe.setAttribute("aria-disabled","true"),oe.getAttribute("title")||(oe.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,oe.setAttribute("aria-pressed",d?"true":"false"),oe.dataset.listening=d?"true":"false",oe.classList.toggle("is-listening",d)},s=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",f=>{let u=f?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){K.value=u;try{K.focus({preventScroll:!0})}catch{K.focus()}try{let m=K.value.length;typeof K.setSelectionRange=="function"&&K.setSelectionRange(m,m)}catch{}}});let l=()=>{i(!1)};return t.addEventListener("end",l),t.addEventListener("error",l),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};In=a,oe.addEventListener("click",()=>{let d=s();if(d){if(n){a();return}try{d.start(),i(!0)}catch(l){console.warn("Quick add voice error:",l),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}Nr();let ci=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,ye=null,li=!!ci;li&&(ye=new ci,ye.lang="en-AU",ye.interimResults=!1,ye.maxAlternatives=1);function Rr(){try{if(typeof I=="function"){I("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}xe&&(li&&ye?xe.addEventListener("click",()=>{try{ye.start(),xe.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):xe.addEventListener("click",()=>{Rr()})),ye&&(ye.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Mr(t)}),ye.addEventListener("end",()=>{xe&&xe.classList.remove("is-recording")}),ye.addEventListener("error",()=>{xe&&xe.classList.remove("is-recording")}));function Fr(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function Br(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,s=new Date(i);if(n.includes("tomorrow"))s.setDate(s.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let d=parseInt(a[1],10),l=a[2]?parseInt(a[2],10):0,f=a[3];f||(/\b(p\.?m\.?|p m)\b/.test(n)?f="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(f="am")),f==="pm"&&d<12&&(d+=12),f==="am"&&d===12&&(d=0),s.setHours(d,l,0,0);let u=new Date(s),m=new Date(u.getTime()-10*60*1e3);return t.dueDate=u,t.notifyAt=m,t}function Mr(e){if(!e||!K)return;let t=Fr(e),{dueDate:n,notifyAt:i}=Br(e);K.value=t,ot({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&K&&(e.preventDefault(),K.focus())})));try{ee==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Or=o.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",ui=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Pr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",_t=o.reminderLandingPath||(ee==="desktop"?"index.html#reminders":"mobile.html"),le=(e,t={})=>{let n=null;try{n=typeof CustomEvent<"u"?CustomEvent:null}catch{n=null}!n&&typeof window<"u"&&typeof window.CustomEvent<"u"&&(n=window.CustomEvent),n||(n=function(i,s){s=s||{bubbles:!1,cancelable:!1,detail:null};let a=new Event(i,s);return a.detail=s.detail,a}),document.dispatchEvent(new n(e,{detail:t}))};function fi(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function st(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:p}}))}catch{}}N&&!N.value&&(N.value=W),De()&&Oe();function Ae(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let s=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(s.push(n);s.length>20;)s.shift();window.memoryCueActivityQueue=s}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(zi,{detail:n}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent(zi,!1,!1,n),document.dispatchEvent(s))}}catch{}}}function _r(){if(typeof HTMLElement>"u"||!(re instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&h instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&h instanceof HTMLTextAreaElement;if(!e&&!t||re.dataset.voiceBound==="true")return;if(re.dataset.voiceBound="true",typeof window>"u"){re.setAttribute("disabled","true"),re.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){re.setAttribute("disabled","true"),re.setAttribute("aria-disabled","true"),re.getAttribute("title")||(re.title="Voice input is not supported in this browser.");return}let i=null,s=!1,a=u=>{s=u,re.setAttribute("aria-pressed",u?"true":"false"),re.dataset.listening=u?"true":"false",re.classList.toggle("is-listening",u)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",m=>{let S=m.results?.[0]?.[0]?.transcript?.trim()||"";if(S){h.value=S;try{h.focus({preventScroll:!0})}catch{try{h.focus()}catch{}}try{let T=h.value.length;typeof h.setSelectionRange=="function"&&h.setSelectionRange(T,T)}catch{}Ae({action:"dictated",label:`Voice input captured \xB7 ${S}`})}});let u=()=>{a(!1)};return i.addEventListener("end",u),i.addEventListener("error",u),i},l=()=>{if(!(!s||!i)){try{i.stop()}catch{}a(!1)}};re.addEventListener("click",()=>{let u=d();if(u){if(s){l();return}try{u.start(),a(!0)}catch(m){console.warn("Speech recognition error:",m),a(!1)}}});let f=()=>{l()};typeof document<"u"&&(document.addEventListener("cue:close",f),document.addEventListener("reminders:updated",f)),a(!1)}qo(),_r();let Ht,Ut,$t,qt,Ye,jt,Vt,Wt,Yt,Gt,Kt,at,dt,Xt,zt,Cn,kn,Jt,Dn,pi=o.firebaseDeps,xn=typeof o.importModule=="function"?o.importModule:e=>import(e),ct=zn(),lt=!1,he=!1,Nn=null,Ie=null,ut=null,p=[],Ge=!1,te=null,ft=null,Ke=null,pt=null,Qt=null,_e={},He={},G={},mi=typeof document<"u"?document.getElementById("createSheetTitle"):null,yi=()=>{h instanceof HTMLElement&&setTimeout(()=>{try{h.focus()}catch{}},0)},Xe=(e,t=null)=>{pt=e||null,Qt=t||null,Ke=pt==="edit"?Qt:null,mi instanceof HTMLElement&&(mi.textContent=pt==="edit"?"Edit reminder":"New reminder")};function pe(e=p){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,s=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===s?Si(t||{},n||{}):s-i})}function Hr(e=p){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let s=Number.isFinite(i?.orderIndex)?i.orderIndex:null;s!=null&&(s<t&&(t=s),s>n&&(n=s))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function mt(e=p){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),pe(n);else{n=e.slice().sort(Si);let i=n.length;n.forEach((s,a)=>{s.orderIndex=(i-a)*ve})}return e===p&&(p=n),n}function hi(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Hr();if(t==="end"){let s=Number.isFinite(n)?n:0;e.orderIndex=s-ve||ve}else{let s=Number.isFinite(i)?i:0;e.orderIndex=s+ve||ve}}function Zt(e=p){if(!Array.isArray(e)||e.length<2)return!1;pe(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],s=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(s?.orderIndex)?s.orderIndex:null;if(a==null||d==null||a<=d||a-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*ve;return e===p&&pe(p),!0}let B={draggingId:null,dropTargetId:null,dropBefore:!0},gi=!1,g={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Ur(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function yt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Ne(){A&&(A.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),A.classList.remove("drag-over-list"))}function Rn(){if(!A)return;let e=A.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Ne(),B.draggingId=null,B.dropTargetId=null,B.dropBefore=!0}function bi(e,t,n){if(!e||e===t)return;let i=p.findIndex(T=>T?.id===e);if(i<0)return;let[s]=p.splice(i,1),a;if(!t)a=p.length;else{let T=p.findIndex(O=>O?.id===t);if(T<0){p.splice(i,0,s);return}a=n?T:T+1}p.splice(a,0,s);let d=p[a-1],l=p[a+1],f=Number.isFinite(d?.orderIndex)?d.orderIndex:null,u=Number.isFinite(l?.orderIndex)?l.orderIndex:null,m;f!=null&&u!=null?m=(f+u)/2:f!=null?m=f-ve:u!=null?m=u+ve:m=ve,Number.isFinite(m)||(m=ve*(p.length+1)),s.orderIndex=m,pe(p);let S=Zt(p);Ge=!0,q(),z(),S?p.forEach(T=>se(T)):se(s),st(),le("memoryCue:remindersUpdated",{items:p}),Ae({action:"reordered",label:"Reminders reordered"})}function $r(e){let t=yt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(B.draggingId=i,B.dropTargetId=null,B.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function qr(e){if(!B.draggingId)return;let t=yt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),B.dropTargetId=null,B.dropBefore=!1,Ne(),A?.classList.add("drag-over-list");return}if(t.dataset.id===B.draggingId){e.preventDefault(),Ne();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,s=e.clientY<i;(B.dropTargetId!==t.dataset.id||B.dropBefore!==s)&&(Ne(),t.classList.add(s?"drag-over-before":"drag-over-after"),B.dropTargetId=t.dataset.id,B.dropBefore=s)}function jr(e){let t=yt(e.target);if(!t){A?.contains(e.relatedTarget)||Ne();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),A?.contains(e.relatedTarget)||A?.classList.remove("drag-over-list"))}function Vr(e){if(!B.draggingId)return;e.preventDefault();let t=yt(e.target),n=t?.dataset.id||null,i=B.dropBefore;if(t){let s=t.getBoundingClientRect(),a=s.top+s.height/2;i=e.clientY<a}else n=null,i=!1;bi(B.draggingId,n,i),Rn()}function Wr(){Rn()}function Yr(){!A||gi||(gi=!0,A.addEventListener("dragstart",$r),A.addEventListener("dragover",qr),A.addEventListener("drop",Vr),A.addEventListener("dragend",Wr),A.addEventListener("dragleave",jr),en())}function en(){if(!A||en._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){en._bound=!0;return}let t=6,n=160;function i(){g.longPressTimer&&(clearTimeout(g.longPressTimer),g.longPressTimer=null)}function s(){A&&(g.initialTouchAction!=null?A.style.touchAction=g.initialTouchAction:A.style.removeProperty("touch-action"))}function a({keepHighlights:w=!1}={}){if(i(),g.item&&g.pointerId!=null)try{g.item.hasPointerCapture?.(g.pointerId)&&g.item.releasePointerCapture(g.pointerId)}catch{}if(g.placeholder?.parentNode)try{g.placeholder.parentNode.removeChild(g.placeholder)}catch{}g.item&&(g.item.classList.remove("is-dragging"),g.originalStyles?g.item.setAttribute("style",g.originalStyles):g.item.removeAttribute("style")),s(),w||Ne(),Object.assign(g,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(w){return A?Array.from(A.querySelectorAll("[data-reminder-item]")).filter(b=>b!==w):[]}function l(w){let b=g.item;if(!b||g.ready)return;let C=b.getBoundingClientRect(),v=window.getComputedStyle(b);g.ready=!0,B.draggingId=b.dataset.id||null,g.offsetY=w.clientY-C.top,g.fixedX=C.left;let x=document.createElement("div");x.className="touch-drag-placeholder",x.setAttribute("aria-hidden","true"),x.style.height=`${C.height}px`,x.style.boxSizing="border-box",x.style.marginTop=v.marginTop,x.style.marginBottom=v.marginBottom,x.style.marginLeft=v.marginLeft,x.style.marginRight=v.marginRight,x.style.borderRadius=v.borderRadius,x.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",x.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",x.style.pointerEvents="none",x.style.display="block",x.style.width="100%",b.parentNode?.insertBefore(x,b),g.placeholder=x,g.longPressTimer=null,g.originalStyles=b.getAttribute("style")||"",b.classList.add("is-dragging"),b.style.position="fixed",b.style.left=`${C.left}px`,b.style.top=`${C.top}px`,b.style.width=`${C.width}px`,b.style.zIndex="999",b.style.pointerEvents="none",b.style.touchAction="none",g.initialTouchAction=A.style.touchAction||"",A.style.touchAction="none"}function f(w){let b=g.item;if(!b||!g.ready)return;let C=w-g.offsetY;b.style.top=`${C}px`,b.style.left=`${g.fixedX}px`}function u(w){if(!g.ready||!A)return;let b=g.item,C=d(b);if(Ne(),!C.length){B.dropTargetId=null,B.dropBefore=!1;return}let v=null,x=!1;for(let y of C){let E=y.getBoundingClientRect(),P=E.top+E.height/2;if(w<P){v=y,x=!0;break}}if(!v){v=C[C.length-1];let y=v.getBoundingClientRect(),E=y.top+y.height/2;x=w<E,x||(x=!1)}if(!v){B.dropTargetId=null,B.dropBefore=!1;return}let j=v.getBoundingClientRect(),be=j.top+j.height/2,Ue=w<be;v.classList.add(Ue?"drag-over-before":"drag-over-after"),B.dropTargetId=v.dataset.id||null,B.dropBefore=Ue}function m(w){let b=B.draggingId,C=g.moved;if(!g.ready){a();return}a(),!w&&C&&b&&bi(b,B.dropTargetId,B.dropBefore),Rn()}function S(w){let b=w.pointerType||"";if(b&&b!=="touch"&&b!=="pen"||g.active)return;let C=yt(w.target);if(!C)return;let v=Ur(w.target);if(!(v&&v!==C)){g.active=!0,g.pointerId=w.pointerId,g.item=C,g.startX=w.clientX,g.startY=w.clientY,g.lastClientX=w.clientX,g.lastClientY=w.clientY,g.moved=!1,g.ready=!1,g.originalStyles=C.getAttribute("style")||"",g.startTime=w.timeStamp||Date.now(),B.dropTargetId=null,B.dropBefore=!0,B.draggingId=null,i(),g.longPressTimer=setTimeout(()=>{l({clientY:g.lastClientY})},n);try{C.setPointerCapture(w.pointerId)}catch{}}}function T(w){if(!g.active||w.pointerId!==g.pointerId)return;let b=w.pointerType||"";if(!(b&&b!=="touch"&&b!=="pen")){if(g.lastClientX=w.clientX,g.lastClientY=w.clientY,!g.ready){let C=Math.abs(w.clientX-g.startX),v=Math.abs(w.clientY-g.startY);if(C>t||v>t){let x=typeof w.timeStamp=="number"?w.timeStamp:Date.now();Math.abs(x-g.startTime)>=n?(i(),l({clientY:g.lastClientY})):a()}return}w.preventDefault(),g.moved=!0,f(w.clientY),u(w.clientY)}}function O(w){!g.active||w.pointerId!==g.pointerId||m(!1)}function D(w){!g.active||w.pointerId!==g.pointerId||m(!0)}A.addEventListener("pointerdown",S),window.addEventListener("pointermove",T),window.addEventListener("pointerup",O),window.addEventListener("pointercancel",D),en._bound=!0}function wi(){te=null,bn("offline"),Nt.forEach(e=>e.classList.remove("hidden")),Rt.forEach(e=>e.classList.add("hidden")),Bt&&(Bt.textContent=""),ft?.(),ft=null,Bn(),q(),z(),Be()}function Fn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Gn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),s=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:nn(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:X(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:s,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Gr(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Gn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:X(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(Gn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function z(){pe(p),Gr(p)}function Bn(){p=mt(Fn())}Bn();async function Kr(){if(!te){p=Fn();return}let e=mt(Fn());if(!e.length){p=[],z();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await se(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}p=mt(e.map(n=>({...n,pendingSync:!1}))),z(),q(),Be()}try{G=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{G={}}if(G&&typeof G=="object"&&Object.values(G).forEach(e=>{e&&typeof e=="object"&&(e.category=X(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:ht(e),e.urlPath=e.urlPath||_t,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!De()){let e=xi();typeof Notification<"u"&&Notification.permission==="granted"?(hn(),e.length&&Kn(e,{requestCheck:!0})):e.length&&Kn(e)}let tn=e=>{if(!ct)return;let t=[ct];ct.window&&!t.includes(ct.window)&&t.push(ct.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Xr(){if(!Q)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",s=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in Q?Q.value:Q.innerHTML,d=m=>{if("value"in Q){Q.value=m;return}if(typeof m!="string"||m.length===0){Q.innerHTML="";return}let S=m.trim();if(/<\/?[a-z][\s\S]*>/i.test(S)){Q.innerHTML=m;return}let O=m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");Q.innerHTML=O},l=m=>{m?Q.classList.add("notes-editor--columns"):Q.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!m))},f="";try{f=localStorage.getItem(n)||""}catch{I("Unable to access saved notes")}d(f);let u=!1;try{u=localStorage.getItem(i)==="1"}catch{u=!1}l(u),Q.addEventListener("input",()=>{f=a();try{localStorage.setItem(n,f)}catch{I("Notes saved for this session only")}}),dr?.addEventListener("click",()=>{f=a();try{localStorage.setItem(n,f),I("Notes saved")}catch{I("Notes saved for this session only")}}),cr?.addEventListener("click",()=>{let m=f;try{m=localStorage.getItem(n)||f}catch{I("Unable to load saved notes")}f=m,d(f)}),e?.addEventListener("click",m=>{let S=m.target;if(!(S instanceof Element))return;let T=S.closest("button[data-action]");if(!T)return;let O=T.getAttribute("data-action");if(O==="columns"){let D=!Q.classList.contains("notes-editor--columns");l(D);try{localStorage.setItem(i,D?"1":"0")}catch{I("Column preference saved for this session only")}return}if(!s){I("Formatting controls are not supported in this browser");return}Q.focus(),O==="bullets"?document.execCommand("insertUnorderedList"):O==="numbers"&&document.execCommand("insertOrderedList")})}if(Xr(),ie?.addEventListener("click",Pi),pi)({initializeApp:Ht,getFirestore:Ut,enableMultiTabIndexedDbPersistence:$t,enableIndexedDbPersistence:qt,doc:Ye,setDoc:jt,deleteDoc:Vt,onSnapshot:Wt,collection:Yt,query:Gt,orderBy:Kt,serverTimestamp:at,getAuth:dt,onAuthStateChanged:Xt,GoogleAuthProvider:zt,signInWithPopup:Cn,signInWithRedirect:kn,getRedirectResult:Jt,signOut:Dn}=pi),lt=!0;else try{({initializeApp:Ht}=await xn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Ut,enableMultiTabIndexedDbPersistence:$t,enableIndexedDbPersistence:qt,doc:Ye,setDoc:jt,deleteDoc:Vt,onSnapshot:Wt,collection:Yt,query:Gt,orderBy:Kt,serverTimestamp:at}=await xn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:dt,onAuthStateChanged:Xt,GoogleAuthProvider:zt,signInWithPopup:Cn,signInWithRedirect:kn,getRedirectResult:Jt,signOut:Dn}=await xn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),lt=!0}catch(e){lt=!1,console.warn("Firebase modules failed to load:",e),I("Firebase failed to load; notes available offline"),tn(!1)}if(lt&&typeof Ht=="function"&&typeof Ut=="function"&&typeof dt=="function")try{let e=Uo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Nn=Ht(e),Ie=Ut(Nn),he=!0,console.info("[Firebase] Firestore initialised",e.projectId),tn(!0)}catch(e){he=!1,console.warn("Firebase initialization failed:",e),I("Firebase failed to load; notes available offline"),tn(!1)}else lt?(he=!1,tn(!1)):he=!1;he&&typeof $t=="function"&&typeof qt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await $t(Ie),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await qt(Ie),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),he&&typeof dt=="function"&&(ut=dt(Nn));function zr(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Jr=typeof navigator<"u"&&navigator.language?navigator.language:"",vi=zr(Jr),ze=vi||"en-US",Le="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Le=e.timeZone),!vi&&e.locale&&(ze=e.locale)}catch{}let Qr=new Intl.DateTimeFormat(ze,{timeZone:Le,hour:"2-digit",minute:"2-digit"}),Zr=new Intl.DateTimeFormat(ze,{timeZone:Le,weekday:"long",day:"numeric",month:"long"}),eo=new Intl.DateTimeFormat("en-CA",{timeZone:Le,year:"numeric",month:"2-digit",day:"2-digit"}),to=new Intl.DateTimeFormat(ze,{timeZone:Le,weekday:"long"}),no=new Intl.DateTimeFormat(ze,{timeZone:Le,month:"short",day:"numeric"});function Re(e){let t=eo.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,s=t.find(a=>a.type==="day").value;return`${n}-${i}-${s}`}function Ei(e,t){let[n,i,s]=e.split("-").map(f=>parseInt(f,10)),[a,d]=t.split(":").map(f=>parseInt(f,10)),l=new Date;return l.setFullYear(n,(i||1)-1,s||1),l.setHours(a||0,d||0,0,0),l.toISOString()}let io=new Intl.DateTimeFormat("en-CA",{timeZone:Le,year:"numeric",month:"2-digit",day:"2-digit"}),ro=new Intl.DateTimeFormat("en-CA",{timeZone:Le,hour:"2-digit",minute:"2-digit",hour12:!1});function oo(e){try{let t=new Date(e),n=io.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",s=n.find(d=>d.type==="month")?.value||"00",a=n.find(d=>d.type==="day")?.value||"00";return`${i}-${s}-${a}`}catch{return""}}function so(e){try{let t=new Date(e),n=ro.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",s=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${s}`}catch{return""}}function nn(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function rn(){return Re(new Date)}function ao(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Go(e){let t=ao(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function on(e){return e==="High"?3:e==="Medium"?2:1}function Si(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let s=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(s!==a)return s-a;let d=on(t?.priority)-on(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function Ko(e,t){let n=on(t.priority)-on(e.priority);if(n)return n;let i=+new Date(e.due||0),s=+new Date(t.due||0);return i!==s?i-s:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Ti(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Zr.format(t)}catch{return e}}function Mn(e){return Qr.format(e)}function co(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Xo(e){return e?co(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function I(e){H&&(qe(),H.dataset.statusKind="toast",H.textContent=e,clearTimeout(I._t),I._t=setTimeout(()=>{H&&H.dataset.statusKind==="toast"&&(H.textContent="",delete H.dataset.statusKind)},2500))}function lo(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function sn(e){e=String(e||"").toLowerCase();let t={date:rn(),time:""},n=l=>{let f=new Date,u=f.getDay(),m=(l-u+7)%7,S=new Date(f);return S.setDate(f.getDate()+(m===0?7:m)),S},i=l=>{let f=new Date,u=f.getDay(),m=(l-u+7)%7,S=new Date(f);return S.setDate(f.getDate()+m),S},s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let l=new Date;l.setDate(l.getDate()+1),t.date=Re(l)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=s[l[1]],u=n(f);t.date=Re(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=s[l[1]],u=i(f);t.date=Re(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=s[l[1]],u=n(f);t.date=Re(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let l=e.match(/\bin\s+(\d+)\s+days?\b/),f=parseInt(l[1],10),u=new Date;u.setDate(u.getDate()+f),t.date=Re(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let l=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),f=parseInt(l[1],10),u=parseInt(l[2],10)-1,m=l[3]?parseInt(l[3],10):new Date().getFullYear(),S=new Date(m,u,f);t.date=Re(S)}else for(let[l,f]of Object.entries(a)){let u=new RegExp(`\\b${l}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let m=e.match(u),S=parseInt(m[1],10),T=new Date().getFullYear(),O=new Date(T,f,S);t.date=Re(O);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let l=parseInt(d[1],10),f=d[2]?parseInt(d[2],10):0,u=d[3];u&&(u==="pm"&&l<12&&(l+=12),u==="am"&&l===12&&(l=0)),t.time=`${String(l).padStart(2,"0")}:${String(f).padStart(2,"0")}`}return t}let On=he&&ut&&typeof zt=="function";$i({authReady:On,auth:ut,GoogleAuthProvider:zt,signInWithPopup:Cn,signInWithRedirect:kn,signOut:Dn,toast:I});let Ai=gr,Ii=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(s=>{console.error("Auth handler error:",s)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Ai&&Nt.length&&Nt.forEach(e=>Ii(e,qi)),On&&typeof Jt=="function"&&Jt(ut).catch(()=>{}),Ai&&Rt.length&&Rt.forEach(e=>Ii(e,ji)),On&&typeof Xt=="function"?Xt(ut,async e=>{e?(te=e.uid,bn("online"),Nt.forEach(t=>t.classList.add("hidden")),Rt.forEach(t=>t.classList.remove("hidden")),Bt&&(Bt.textContent=e.displayName||e.email||""),uo(),await Kr()):wi()}):wi();function uo(){if(!he||!Ie||typeof Yt!="function"||typeof Gt!="function"||typeof Kt!="function"||typeof Wt!="function")return;if(!te){Bn(),q(),We(),z(),Be();return}ft&&ft();let e=Yt(Ie,"users",te,"reminders"),t=Gt(e,Kt("updatedAt","desc"));ft=Wt(t,n=>{let i=[];n.forEach(s=>{let a=s.data(),d=Number(a.orderIndex),l=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,f=a.pinToToday===!0;i.push({id:s.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:X(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:l,pinToToday:f})}),p=mt(i),q(),We(),z(),Be()},n=>{console.error("Firestore sync error:",n),Y&&bn("error","Sync Error")})}async function se(e){if(!(!he||!te||!Ie||typeof Ye!="function"||typeof jt!="function"||typeof at!="function"))try{await jt(Ye(Ie,"users",te,"reminders",e.id),{ownerUid:te,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||W,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):at(),updatedAt:at()},{merge:!0})}catch(t){console.error("Save failed:",t),I("Save queued (offline)")}}async function fo(e){if(!(!he||!te||!Ie||typeof Ye!="function"||typeof Vt!="function"))try{await Vt(Ye(Ie,"users",te,"reminders",e))}catch{I("Delete queued (offline)")}}async function an(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||W,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Fe({preserveDetail:e=!1,resetMode:t=!0}={}){h&&(h.value=""),L&&(L.value=""),F&&(F.value=""),M&&(M.value=""),Pt("Medium"),N&&(N.value=W),ri(),t?Xe(null):Ke=pt==="edit"?Qt:null,ie&&(ie.textContent="Save"),ae?.classList.add("hidden"),Tn(),e||Zn()}function po(e){let t=p.find(n=>n.id===e);t&&(Xe("edit",e),h&&(h.value=t.title||""),L&&F&&(t.due?(L.value=oo(t.due),F.value=so(t.due)):(L.value="",F.value="")),Pt(t?.priority||"Medium"),N&&(N.value=X(t.category)),M&&(M.value=typeof t.notes=="string"?t.notes:""),$&&($.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),Tn(),sr(t),ie&&(ie.textContent="Update"),ae?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),yi(),le("cue:open",{mode:"edit"}))}function Li(e){let t=e?.id||e;t&&(Xe("edit",t),po(t))}function mo(e=null){Fe({resetMode:!1}),Xe("new");let t={mode:"create",trigger:e};le("cue:prepare",t),le("cue:open",t),yi()}typeof window<"u"&&(window.openNewReminderSheet=mo,window.openEditReminderSheet=Li);function Ci(e={},t={}){let{closeSheet:n=!0,activityAction:i="created",activityLabelPrefix:s="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let d=Date.now(),l=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),f=X(e.category??(N?N.value:W)),u=null;e.due instanceof Date?u=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(u=e.due);let m=null;e.notifyAt instanceof Date?m=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(m=e.notifyAt);let S={id:nn(),title:a,priority:e.priority||Ot(),category:f,notes:l,done:!1,createdAt:d,updatedAt:d,due:u,pendingSync:!te,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:m};hi(S,{position:"start"}),p=[S,...p],pe(p);let T=Zt(p);return Ge=!0,q(),z(),Tr(S),T?p.forEach(O=>se(O)):se(S),an(S),Je(S),Be(),st(),le("memoryCue:remindersUpdated",{items:p}),n&&fi(),Ae({action:i,label:`${s} \xB7 ${S.title}`}),S}function yo(e){return Ci(e,{closeSheet:!0})}function ho(e,t){if(!te)return I("Sign in to add notes"),null;if(!e)return null;let n=p.find(d=>d.id===e);if(!n)return null;let s=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!s)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${s}`:s,n.updatedAt=Date.now(),se(n),q(),z(),Ae({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function go(e){let t=p.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),se(t),an(t),q(),z(),t.done?(cn(e),Ae({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Je(t),Ae({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function bo(e,t){let n=p.find(s=>s?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),se(n),q(),z(),st(),le("memoryCue:remindersUpdated",{items:p}))}function wo(e){if(!ce||ce.tokenId!==e)return;let{item:t,index:n}=ce;if(!t){qe(e);return}qe(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),p.length):p.length;t.pendingSync=!te,t.updatedAt=Date.now(),p.splice(i,0,t),pe(p);let s=Zt(p);Ge=!0,q(),z(),Je(t),s?p.forEach(a=>se(a)):se(t),an(t),st(),le("memoryCue:remindersUpdated",{items:p}),Ae({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),I("Reminder restored")}function Pn(e){let t=p.findIndex(s=>s.id===e),n=t>=0?p.splice(t,1)[0]:null;n&&Ke===e&&Fe(),q(),z(),fo(e),cn(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Ae({action:"deleted",label:i}),n&&H){qe();let s=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ce={tokenId:s,item:n,index:t,timeoutId:null},or(ce),ce.timeoutId=setTimeout(()=>{qe(s)},rr)}else n&&qe()}function ki(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,s=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,l=!1,f=0,u=0,m=0,S=()=>{if(l){if(l=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",O),e.removeEventListener("pointerup",D),e.removeEventListener("pointercancel",w),e.removeEventListener("pointerleave",w),window.removeEventListener("pointerup",D),window.removeEventListener("pointercancel",w)}},T=b=>{if(b.pointerType==="mouse"&&b.button!==0)return;l&&S();let C=b.target;C instanceof Element&&C.closest(a)||(d=b.pointerId,f=b.clientX,u=b.clientY,m=typeof b.timeStamp=="number"?b.timeStamp:Date.now(),l=!0,e.addEventListener("pointermove",O),e.addEventListener("pointerup",D),e.addEventListener("pointercancel",w),e.addEventListener("pointerleave",w),window.addEventListener("pointerup",D),window.addEventListener("pointercancel",w))},O=b=>{if(!l||b.pointerId!==d)return;Math.abs(b.clientY-u)>i&&S()},D=b=>{if(!l||b.pointerId!==d)return;let C=b.clientX-f,v=Math.abs(b.clientY-u),x=(typeof b.timeStamp=="number"?b.timeStamp:Date.now())-m;if(S(),C<=-n&&v<=i&&x<=s){b.preventDefault(),b.stopPropagation();try{t()}catch(j){console.warn("Swipe delete handler failed",j)}}},w=b=>{l&&(typeof b.pointerId=="number"&&b.pointerId!==d||S())};e.addEventListener("pointerdown",T)}function ht(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=Mn(i);if(s)return`${n} \u2022 ${s}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=Mn(i);if(s)return`Due ${s}`}}catch{}return"Due now"}function Di(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}I("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function xi(){return Object.values(G||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||W,notes:typeof e.notes=="string"?e.notes:"",body:ht(e),urlPath:e.urlPath||_t,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function _n(){try{localStorage.setItem("scheduledReminders",JSON.stringify(G))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=xi(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&hn(),Kn(e,{requestCheck:t})}function dn(e,{closeNotification:t=!0}={}){if(t){let n=ke.get(e);if(n){try{n.close()}catch{}ke.delete(e)}}_e[e]&&(clearTimeout(_e[e]),delete _e[e]),He[e]&&(clearTimeout(He[e]),delete He[e]),Xn(e),G[e]&&(delete G[e],_n())}function cn(e){dn(e)}function Hn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ke.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:ht(e),tag:e.id});ke.set(e.id,n);let i=()=>{ke.get(e.id)===n&&ke.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function vo(e){if(!De())return!1;let t=er();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Oe();if(!i)return!1;await Xn(e.id,i);let s={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||W,body:a,urlPath:_t},a=ht(e),d={body:a,tag:e.id,data:s,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(l){return console.warn("Failed to schedule persistent notification",l),!1}}function Je(e){if(!e||!e.id)return;if(e.category=X(e.category),!e.due||e.done){cn(e.id);return}let t=G[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||W,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:ht(e),urlPath:_t,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let l=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return l===e.due?f:null})()};if(G[e.id]=n,_n(),_e[e.id]&&(clearTimeout(_e[e.id]),delete _e[e.id]),He[e.id]&&(clearTimeout(He[e.id]),delete He[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let s=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(G[e.id]?.viaTrigger){dn(e.id,{closeNotification:!1});return}Hn(e),dn(e.id,{closeNotification:!1});return}let d=De();if(Number.isFinite(s)&&s>Date.now()&&s<i){let l=s-Date.now();He[e.id]=setTimeout(()=>{Hn({...e,due:e.due||n.due})},l)}d&&(n.viaTrigger=!1,vo(e).then(l=>{l&&G[e.id]&&(G[e.id]={...G[e.id],viaTrigger:!0},_n())})),_e[e.id]=setTimeout(()=>{d&&Xn(e.id),Hn(e),dn(e.id,{closeNotification:!1})},a)}function Be(){Object.values(G).forEach(e=>Je({...e,category:X(e?.category)}))}function Ni(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=to.format(t),i=no.format(t),s=Mn(t);return`${n}, ${i}${s?` at ${s}`:""}`}catch{return"No due date"}}let Ri="__mcPinToggleHandler";var Un=!1;function gt(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Se,t),e.classList.toggle(de,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Fi(e){if(!(e instanceof HTMLElement)||e[Ri])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let s=i.currentTarget;if(!(s instanceof HTMLElement))return;let d=(typeof s.closest=="function"?s.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){gt(s,!1);return}let l=!s.classList.contains(Se);await Promise.resolve(bo(d,l)),gt(s,l)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Ri]={click:t,keydown:n}}function Eo(){if(!A)return;let e=A.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){gt(t,!1),Fi(t);return}let a=!!p.find(d=>d?.id===i)?.pinToToday;gt(t,a),Fi(t)})}function Bi(){if(!A||Un)return;Un=!0;let e=()=>{Un=!1,Eo()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function So(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function To(e,t,n){if(!Array.isArray(e))return[];let s=t==="completed"?e.filter(a=>!!a?.done):e.filter(a=>!a?.done);return t==="today"?s.filter(a=>So(a,n)):s}function Ao(){let e=document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]");e.length&&e.forEach(t=>{let i=t.getAttribute("data-reminders-tab")===rt;t.setAttribute("aria-pressed",i?"true":"false"),i?t.classList.add("reminders-tab-active","active"):t.classList.remove("reminders-tab-active","active")})}function Mi(e){if(!e||e===rt)return!1;document.querySelectorAll("#reminders-slim-header [data-reminders-tab], #view-reminders [data-reminders-tab]").length&&(Array.isArray(En)&&q(),We())}function Oi(){if(ee!=="mobile"||typeof document>"u"||Oi._wired)return;Ao(),We(),document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]").forEach(t=>{t.addEventListener("click",()=>{let n=t.getAttribute("data-reminders-tab");Mi(n)})})}function q(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let s={start:n,end:i};if(Ne(),pe(p),ei)try{ei.textContent=String(p.length)}catch{}p.forEach(y=>{y&&typeof y=="object"&&(y.category=X(y.category))});let a=new Set(_o.map(y=>X(y)));p.forEach(y=>{y&&typeof y=="object"&&a.add(X(y.category))});let d=Array.from(a).sort((y,E)=>y.localeCompare(E,void 0,{sensitivity:"base"}));if(vn){let y=new Set;Array.from(vn.querySelectorAll("option")).forEach(E=>{y.add(E.value.trim().toLowerCase())}),d.forEach(E=>{let P=E.toLowerCase();if(!y.has(P)){let _=document.createElement("option");_.value=E,vn.appendChild(_),y.add(P)}})}if(Ge)Ge=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let y=p.map(E=>({...E}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:y}}));else if(document.createEvent){let E=document.createEvent("CustomEvent");E&&E.initCustomEvent&&(E.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:y}),document.dispatchEvent(E))}}catch{}}let l=p.slice();pe(l),ee==="mobile"&&(En=l.slice(),l=To(En,rt,s),We());let f=!0,u=p.length>0,m=l.length>0,S=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let y=Object.values(G||{}).filter(E=>E&&typeof E=="object"&&E.id);return new Set(y.map(E=>E.id))})();if(Ve)if(m)Ve.classList.add("hidden");else{let y=u?"No reminders to show right now.":Or;ui?ui(Ve,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:y,action:u?void 0:`<button type="button" class="${Pr}" data-trigger="open-cue">Create reminder</button>`}):Ve.textContent=y,Ve.classList.remove("hidden")}if(ti&&ti.classList.toggle("has-items",m),!A)return;if(!m){Ve?(A.innerHTML="",A.classList.add("hidden")):(A.innerHTML='<div class="text-muted">No reminders found.</div>',A.classList.remove("hidden")),Bi();return}A.classList.remove("hidden"),A.replaceChildren();let T=document.createDocumentFragment(),O=A.tagName==="UL"||A.tagName==="OL",D=!0,w=["priority-high","priority-medium","priority-low"],b=(y,E)=>{if(!(y instanceof HTMLElement))return;y.classList.remove(...w);let P=typeof E=="string"?E.trim().toLowerCase():"";P.startsWith("h")?y.classList.add("priority-high"):P.startsWith("m")?y.classList.add("priority-medium"):P.startsWith("l")&&y.classList.add("priority-low")},C=(y,E="neutral")=>{let P=document.createElement("span");P.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",P.title=y,P.dataset.tone=E;let _=document.createElement("span");_.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",E==="priority-high"?_.classList.add("bg-error"):E==="priority-medium"?_.classList.add("bg-warning"):E==="priority-low"?_.classList.add("bg-secondary"):E==="category"?_.classList.add("bg-primary"):_.classList.add("bg-base-content","opacity-40");let R=document.createElement("span");return R.className="truncate",R.textContent=y,P.append(_,R),P},v=(y,E,{elementTag:P,isMobile:_})=>{let R={id:y.id,title:y.title,dueIso:y.due||null,priority:y.priority||"Medium",category:E,done:!!y.done,pinToToday:y.pinToToday===!0},bt="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Co="task-item reminder-row reminder-card w-full text-base-content",k=document.createElement(P);k.className=_?Co:bt,k.dataset.id=R.id,k.dataset.category=R.category,k.dataset.title=R.title;let _i=R.priority&&String(R.priority).trim();_i?k.dataset.priority=_i:delete k.dataset.priority,k.dataset.done=String(R.done),R.dueIso?k.dataset.due=R.dueIso:delete k.dataset.due,R.pinToToday?k.dataset.pinToToday="true":delete k.dataset.pinToToday,k.dataset.reminder=JSON.stringify(R),k.dataset.orderIndex=Number.isFinite(y.orderIndex)?String(y.orderIndex):"",k.dataset.reminderItem="true",k.classList.add("reminder-draggable"),k.setAttribute("draggable","true"),k.setAttribute("role","button"),k.tabIndex=0,k.setAttribute("aria-label",`Edit reminder: ${y.title}`),b(k,R.priority),S.has(R.id)?k.dataset.notificationActive="true":delete k.dataset.notificationActive;let wt=R.dueIso?new Date(R.dueIso):null;f&&wt&&wt>=n&&wt<=i?(k.classList.add("is-today"),k.dataset.today="true"):(k.classList.remove("is-today"),delete k.dataset.today);let $n=Ni(y),ln=$n&&$n!=="No due date"?$n:"",Qe=document.createElement("div");Qe.className="task-toolbar flex items-start gap-1",Qe.setAttribute("role","toolbar"),Qe.setAttribute("aria-label","Reminder actions"),_&&Qe.classList.add("flex-shrink-0");let J=document.createElement("button");J.type="button",J.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",J.classList.toggle("reminder-complete-toggle--active",R.done);let ko=R.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";J.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${ko}"
          />
        </svg>`,R.done?(J.classList.add("text-base-content/60"),J.setAttribute("aria-label",`Mark reminder as active: ${y.title}`)):(J.classList.add("text-success"),J.setAttribute("aria-label",`Mark reminder as done: ${y.title}`)),J.setAttribute("aria-pressed",R.done?"true":"false"),J.setAttribute("data-reminder-control","toggle"),J.setAttribute("data-no-swipe","true"),J.addEventListener("click",V=>{V.preventDefault(),V.stopPropagation(),go(R.id)});let un=()=>Li(y);if(_){let V=document.createElement("div");V.className="reminder-card-main reminder-row-main";let we=document.createElement("div");we.className="reminder-title reminder-row-title",we.dataset.reminderTitle="true";let $e=document.createElement("span");if($e.dataset.role="reminder-today-toggle",$e.className="reminder-title-toggle cursor-pointer",$e.setAttribute("role","button"),$e.tabIndex=0,$e.textContent=y.title,gt($e,R.pinToToday),we.appendChild($e),V.appendChild(we),ln){let ue=document.createElement("div");ue.className="reminder-date reminder-row-meta",ue.textContent=ln,V.appendChild(ue)}return R.done?k.classList.add("reminder-row-completed"):wt&&wt<e&&k.classList.add("reminder-row-overdue"),J.classList.add("reminder-row-complete","reminder-complete-btn"),k.append(J,V),k.addEventListener("click",ue=>{if(ue.defaultPrevented)return;let qn=ue.target;qn&&typeof qn.closest=="function"&&qn.closest("[data-reminder-control]")||un()}),k.addEventListener("keydown",ue=>{ue.defaultPrevented||ue.target===k&&(ue.key==="Enter"||ue.key===" ")&&(ue.preventDefault(),un())}),_&&ki(k,()=>Pn(R.id)),k}let fn=document.createElement("div");fn.className="flex min-w-0 flex-1 flex-col gap-2";let Ze=document.createElement("p");Ze.className="text-lg font-bold leading-snug text-base-content",Ze.classList.add("desktop-reminder-title"),Ze.classList.add("sm:text-[0.95rem]"),R.done&&Ze.classList.add("line-through","text-base-content/60"),Ze.textContent=y.title,fn.appendChild(Ze);let vt=document.createElement("div");vt.className="desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70",ln&&vt.appendChild(C(ln,"due")),!!(E&&E!==W)&&vt.appendChild(C(E,"category")),vt.children.length&&fn.appendChild(vt),k.appendChild(fn);let Ce=document.createElement("button");return Ce.type="button",Ce.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Ce.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Ce.setAttribute("aria-label",`Delete reminder: ${y.title}`),Ce.setAttribute("data-action","delete"),Ce.setAttribute("data-reminder-control","delete"),Ce.setAttribute("data-no-swipe","true"),Ce.addEventListener("click",V=>{V.preventDefault(),V.stopPropagation();try{Pn(R.id)}catch(we){console.warn("Delete handler failed",we)}}),Qe.append(J,Ce),k.appendChild(Qe),k.addEventListener("click",V=>{if(V.defaultPrevented)return;let we=V.target;we&&typeof we.closest=="function"&&we.closest("[data-reminder-control]")||un()}),k.addEventListener("keydown",V=>{V.defaultPrevented||V.target===k&&(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),un())}),_&&ki(k,()=>Pn(R.id)),k},x=(y,E)=>v(y,E,{elementTag:"div",isMobile:!0});if(ee!=="desktop"&&!D){l.forEach(y=>{let E=y.category||W;T.appendChild(x(y,E))}),A.appendChild(T);return}let j=new Map;l.forEach(y=>{let E=y.category||W;j.has(E)||j.set(E,[]),j.get(E).push(y)});let be=Array.from(j.entries()).sort((y,E)=>y[0].localeCompare(E[0],void 0,{sensitivity:"base"})),Ue=!0;be.forEach(([y,E])=>{if(y!==W){let P=document.createElement(O?"li":"div");P.dataset.categoryHeading=y,O&&(P.setAttribute("role","presentation"),P.style.listStyle="none"),P.className=ee==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",Ue||(P.style.marginTop=ee==="desktop"?"1.25rem":"1rem");let _=document.createElement("div");_.setAttribute("role","heading"),_.setAttribute("aria-level","3"),_.className=ee==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let R=document.createElement("span");R.textContent=y;let bt=document.createElement("span");bt.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",bt.textContent=`${E.length} ${E.length===1?"item":"items"}`,_.append(R,bt),P.appendChild(_),T.appendChild(P)}E.forEach(P=>{if(ee==="desktop"){let _=v(P,y,{elementTag:O?"li":"div",isMobile:!1});T.appendChild(_);return}T.appendChild(x(P,y))}),Ue=!1}),A.appendChild(T),ar(),Bi()}function ge(){nt?.setAttribute("aria-expanded","false"),it?.classList.add("hidden")}function Io(){nt?.setAttribute("aria-expanded","true"),it?.classList.remove("hidden")}nt?.addEventListener("click",e=>{e.stopPropagation(),nt.getAttribute("aria-expanded")==="true"?ge():Io()}),document.addEventListener("click",e=>{it&&!it.classList.contains("hidden")&&!it.contains(e.target)&&e.target!==nt&&ge()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ge()}),hr.forEach(e=>{e.addEventListener("click",()=>{let t=Mt?.classList.contains("hidden");Mt?.classList.toggle("hidden"),t&&Mt?.scrollIntoView({behavior:"smooth",block:"start"}),ge()})}),document.addEventListener("DOMContentLoaded",()=>{Mt?.classList.add("hidden")});function Pi(){try{console.log("handleSaveAction invoked",{editingId:Ke,title:h?.value})}catch{}let t=(typeof h?.value=="string"?h.value:"").trim(),n=typeof L?.value=="string"?L.value:"",i=typeof F?.value=="string"?F.value:"",s=typeof $?.value=="string"?$.value.trim():"";if(pt==="edit"&&Ke){let u=p.find(T=>T.id===Ke);if(!u){Fe();return}if(!t){I("Add a reminder title");return}let m=null;if(n||i){let T=n||rn();m=Ei(T,i||"09:00")}else{let T=sn(t);T.time&&(m=new Date(`${T.date}T${T.time}:00`).toISOString())}u.title=t;let S=Ot();u.priority=S,Pt(S),N&&(u.category=X(N.value)),u.due=m,M&&(u.notes=M.value.trim()),u.plannerLessonId=s||null,u.updatedAt=Date.now(),se(u),an(u),Ge=!0,q(),Je(u),z(),st(),le("memoryCue:remindersUpdated",{items:p}),fi(),Ae({action:"updated",label:`Reminder updated \xB7 ${u.title}`}),Fe(),I("Reminder updated"),le("cue:close",{reason:"updated"});return}if(!t){I("Add a reminder title");return}let a=M?M.value.trim():"",d=null;if(n||i){let u=n||rn();d=Ei(u,i||"09:00")}else{let u=sn(t);u.time&&(d=new Date(`${u.date}T${u.time}:00`).toISOString())}let l=s?{lessonId:s,dayLabel:$?.dataset?.lessonDayLabel||"",lessonTitle:$?.dataset?.lessonTitle||"",summary:$?.dataset?.lessonSummary||""}:null,f=yo({title:t,priority:Ot(),category:N?N.value:"",due:d,notes:a,plannerLessonId:s||null});f&&(l?(I("Planner reminder created"),le("planner:reminderCreated",{lessonId:l.lessonId,dayLabel:l.dayLabel,lessonTitle:l.lessonTitle,summary:l.summary,reminderId:f.id,reminderTitle:f.title,reminderDue:f.due||null})):I("Reminder created")),h&&(h.value=""),F&&(F.value=""),M&&(M.value=""),Tn(),le("cue:close",{reason:"created"})}h?.addEventListener("keydown",e=>{e.key==="Enter"&&Pi()});function Lo(){if(!h||!Pe)return;let e=h.value.trim();if(!e){Pe.style.display="none";return}try{let t=sn(e),n=rn();if(t.date!==n||t.time){let i="";if(t.date!==n){let s=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Ti(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Pe.textContent=`Parsed: ${i}`,Pe.style.display="block"):Pe.style.display="none"}else Pe.style.display="none"}catch{Pe.style.display="none"}}if(h?.addEventListener("input",lo(Lo,300)),ae?.addEventListener("click",()=>{Fe(),I("Edit cancelled"),le("cue:close",{reason:"edit-cancelled"})}),nr?.addEventListener("click",()=>{Fe()}),document.addEventListener("cue:cancelled",()=>{Fe()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";Fe({resetMode:!1}),Xe(t,t==="edit"?Qt:null)}),document.addEventListener("cue:close",()=>{Xe(null)}),document.addEventListener("planner:prefillReminder",e=>{Er(e?.detail||{})}),window.addEventListener("load",()=>h?.focus()),ur?.addEventListener("click",()=>{let e=p.filter(t=>!t.done).map(t=>{let n=t.due?Ti(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(ze,{hour:"2-digit",minute:"2-digit",timeZone:Le}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){I("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>I("Copied for Master Task List")).catch(()=>I("Copy failed")),ge()}),wn?.addEventListener("change",()=>{let e=wn.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let d={...a,id:nn(),category:X(a.category),pendingSync:!te,orderIndex:null};hi(d,{position:"start"}),p=[d,...p],i.push(d)}),pe(p);let s=Zt(p);q(),z(),s?p.forEach(a=>se(a)):i.forEach(a=>se(a)),I("Import successful")}catch{I("Invalid JSON")}},t.readAsText(e),wn.value="",ge()}),fr?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),ge()}),pr?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){I("Add your Apps Script URL in Settings first"),ge();return}if(!p.length){I("No tasks to sync"),ge();return}I("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<p.length;i+=t){let s=p.slice(i,i+t),a=await Promise.allSettled(s.map(d=>{let l={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||W,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}));n+=a.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}I(`Sync complete: ${p.length-n} ok${n?`, ${n} failed`:""}`),ge()}),je&&(je.value=localStorage.getItem("syncUrl")||""),mr?.addEventListener("click",()=>{je&&(localStorage.setItem("syncUrl",je.value.trim()),I("Settings saved"))}),yr?.addEventListener("click",async()=>{if(!je)return;let e=je.value.trim();if(!e){I("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});I(t.ok?"Test ok":"Test failed")}catch{I("Test failed")}}),lr?.addEventListener("click",async()=>{if(!("Notification"in window)){I("Notifications not supported");return}if(Notification.permission==="granted"){I("Notifications enabled"),De()?Oe():(hn(),Di()),Be(),q();return}try{await Notification.requestPermission()==="granted"?(I("Notifications enabled"),De()?Oe():(hn(),Di()),Be(),q()):I("Notifications blocked")}catch{I("Notifications blocked")}}),Oi(),ee==="mobile"){let e=()=>{try{wr()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return Yr(),Be(),q(),z(),ee==="mobile"&&(window.setMobileRemindersFilter=Mi),{cancelReminder:cn,scheduleReminder:Je,closeActiveNotifications:tr,getActiveNotifications:()=>ke,addNoteToReminder:ho,__testing:{setItems(e=[]){p=Array.isArray(e)?e.map(t=>({...t,category:X(t?.category)})):[],p=mt(p),pe(p),q()},render:q,getItems:()=>p.map(e=>({...e})),parseInboxTimeQuery:di}}}var zi,ke,Ji,Vn,Wn,Qi,yn,Lt,Yn,W,_o,Gn,ve,Ho,Ee,jo=jn(()=>{Wi();zi="memoryCue:activity",ke=new Map,Ji=!1,Vn="service-worker.js",Wn="memory-cue-reminder-sync",Qi=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),yn=null,Lt=null,Yn=!1,W="General",_o=Object.freeze([W,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Gn="memoryCue:offlineReminders",ve=1024,Ho=Object.freeze({}),Ee=null});function ss(o){return new Jn(o)}var Vo,Wo,Jn,Yo=jn(()=>{Vo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Wo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Jn=class o{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...Wo,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let c=this.getFocusableElements();if(c.length===0){r.preventDefault(),this.modal.focus();return}let h=c[0],L=c[c.length-1],F=document.activeElement;r.shiftKey&&F===h?(r.preventDefault(),L.focus()):!r.shiftKey&&F===L&&(r.preventDefault(),h.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Vo)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let c=r?.detail?.mode==="edit";this.setEditMode(c),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let c=r.detail?.reason||"external-close";this.hide({reason:c})}dispatchEvent(r,c={}){let h=this.events[r];if(!h||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let L=new CustomEvent(h,{detail:c,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(L)}requestClose(r){let c={reason:r,controller:this};this.dispatchEvent("cancelled",c),this.dispatchEvent("closeRequest",{...c,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let c=this.animationHooks?.[r];typeof c=="function"&&await c(this)}addToStack(){let r=o.activeStack,c=r.indexOf(this);c!==-1&&r.splice(c,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=o.activeStack,c=r.indexOf(this);c!==-1&&r.splice(c,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{Zo as a,Wi as b,is as c,jo as d,Jn as e,ss as f,Yo as g};
