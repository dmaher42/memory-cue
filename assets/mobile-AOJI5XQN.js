import{a as cn,b as ao,c as un,d as co,e as at,g as uo}from"./chunk-5FG3T7L3.js";import{a as an,b as so}from"./chunk-MG4MJA24.js";import{b as dn,c as lo}from"./chunk-QHE5AMPX.js";import{b as ln,c as io}from"./chunk-GUVSRPRW.js";var Ge,dt,fo,De,At,mn,yn,pn,Tt,mo,It,gn,pe,ct,fn,yo,ge,ae,Nt,j,de,Ye,hn,He=ln(()=>{Ge="memoryCueNotes",dt="memoryCueFolders",fo=["mobileNotes","memory-cue-notes"],De=()=>typeof localStorage<"u",At=null,mn=r=>{At=typeof r=="function"?r:null},yn=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,pn=r=>{if(typeof r!="string")return"";let n=r.trim();return n.length?(/[<>]/.test(n),r):""},Tt=r=>{if(typeof r!="string")return"";let n=r.trim();return n.length?/[<>]/.test(n)?r:pn(r):""},mo=(r="")=>{if(typeof document<"u"&&typeof document.createElement=="function"){let n=document.createElement("div");return n.innerHTML=typeof r=="string"?r:"",(n.textContent||n.innerText||"").replace(/\s+/g," ").trim()}return typeof r!="string"?"":r.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim()},It=(r="",n="")=>{let i=mo(r);return i||(typeof n=="string"?n.trim():"")},gn=r=>{if(typeof r!="string")return!1;let n=Date.parse(r);return!Number.isNaN(n)},pe=(r,n,i={})=>{let s=typeof r=="string"?r.trim():"",f=typeof i.bodyHtml=="string"&&i.bodyHtml.length?i.bodyHtml:n,a=Tt(f),m=typeof i.bodyText=="string"?i.bodyText:null,I=m!==null?m.trim():It(a);return{id:i.id&&typeof i.id=="string"?i.id:yn(),title:s||"Untitled note",body:a,bodyHtml:a,bodyText:I,pinned:typeof i.pinned=="boolean"?i.pinned:!1,updatedAt:i.updatedAt&&gn(i.updatedAt)?i.updatedAt:new Date().toISOString(),folderId:i.folderId&&typeof i.folderId=="string"?i.folderId:null}},ct=r=>{if(Array.isArray(r))return r.map(n=>{if(!n||typeof n!="object")return null;let i=typeof n.title=="string"?n.title.trim():"",s=typeof n.bodyHtml=="string"&&n.bodyHtml.length?n.bodyHtml:typeof n.body=="string"?n.body:typeof n.bodyText=="string"?n.bodyText:"",f=typeof n.bodyText=="string"?n.bodyText:"",a=Tt(s||f),m=It(a,f),I=typeof n.id=="string"&&n.id.trim()?n.id:yn(),L=gn(n.updatedAt)?n.updatedAt:new Date().toISOString(),H=typeof n.pinned=="boolean"?n.pinned:!1;return!i&&!a&&!f?null:pe(i||"Untitled note",a,{id:I,updatedAt:L,folderId:typeof n.folderId=="string"&&n.folderId?n.folderId:null,bodyHtml:a,bodyText:m,pinned:H})}).filter(Boolean);if(r&&typeof r=="object"){let n=typeof r.title=="string"?r.title:"",i=typeof r.bodyHtml=="string"&&r.bodyHtml.length?r.bodyHtml:typeof r.body=="string"?r.body:typeof r.bodyText=="string"?r.bodyText:"",s=typeof r.bodyText=="string"?r.bodyText:"",f=Tt(i||s),a=It(f,s),m=typeof r.pinned=="boolean"?r.pinned:!1;return!n&&!f&&!a?[]:[pe(n,f,{id:typeof r.id=="string"?r.id:void 0,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:void 0,folderId:typeof r.folderId=="string"?r.folderId:void 0,bodyHtml:f,bodyText:a,pinned:m})]}return typeof r=="string"&&r.trim().length?[pe("Notebook (legacy)",pn(r))]:[]},fn=r=>{if(!De())return null;try{return localStorage.getItem(r)}catch{return null}},yo=r=>{if(De())try{localStorage.removeItem(r)}catch{}},ge=()=>{if(!De())return[];let r=fn(Ge);if(typeof r=="string")try{let n=JSON.parse(r),i=ct(n);if(i.length)return i}catch{let n=ct(r);if(n.length)return ae(n),n}for(let n of fo){let i=fn(n);if(typeof i=="string"&&i.trim().length){let s=ct(i);if(s.length)return ae(s),yo(n),s}}return[]},ae=(r,n={})=>{if(!De()||!Array.isArray(r))return!1;let i=r.map(s=>{let a=ct([s])[0];return a&&(a.folderId=typeof s.folderId=="string"&&s.folderId?s.folderId:a.folderId||null,a.pinned=typeof s.pinned=="boolean"?s.pinned:!!a.pinned),a}).filter(Boolean);try{if(localStorage.setItem(Ge,JSON.stringify(i)),!n.skipRemoteSync&&typeof At=="function")try{let s=At(i);s&&typeof s.then=="function"&&s.catch(f=>{console.error("[notes-storage] Remote sync failed.",f)})}catch(s){console.error("[notes-storage] Remote sync handler threw.",s)}return!0}catch{return!1}},Nt=()=>[{id:"unsorted",name:"Unsorted"}],j=()=>{if(!De())return Nt();try{let n=localStorage.getItem(dt);if(typeof n=="string"){let i=JSON.parse(n);if(Array.isArray(i)&&i.length){let s=!1,f=i.map((a,m)=>{let I=String(a.id),L=typeof a.name=="string"?a.name:String(a.id),H=typeof a.order=="number"?a.order:m;return typeof a.order!="number"&&(s=!0),{id:I,name:L,order:H}});if(s)try{localStorage.setItem(dt,JSON.stringify(f))}catch{}return f}}}catch{}let r=Nt();try{localStorage.setItem(dt,JSON.stringify(r))}catch{}return r},de=r=>{let i=j().find(s=>s&&String(s.id)===String(r));return i?String(i.name):"Unsorted"},Ye=r=>{if(!De()||!Array.isArray(r))return!1;try{let n=r.filter(i=>i&&typeof i.id=="string"&&i.id.trim()).map((i,s)=>({id:i.id,name:typeof i.name=="string"?i.name:String(i.id),order:typeof i.order=="number"?i.order:s}));return n.length||n.push(...Nt()),localStorage.setItem(dt,JSON.stringify(n)),!0}catch{return!1}},hn=(r,n)=>{if(!r||typeof r!="string")return!1;let i=ge(),s=!1,f=i.map(m=>m.id===r?(s=!0,{...m,folderId:n&&typeof n=="string"?n:null,updatedAt:new Date().toISOString()}):m);return s?ae(f):!1}});var po,go,ho,ut,bo,Eo,bn,En=ln(()=>{lo();He();po="notes",go="user_id",ho="updated_at",ut=r=>{if(typeof r!="string")return 0;let n=Date.parse(r);return Number.isNaN(n)?0:n},bo=(r=[],n=[])=>{let i=new Map;return n.forEach(s=>{s&&typeof s.id=="string"&&i.set(s.id,s)}),r.forEach(s=>{if(!s||typeof s.id!="string")return;let f=i.get(s.id);if(!f){i.set(s.id,s);return}let a=ut(s.updatedAt),m=ut(f.updatedAt);a>m&&i.set(s.id,s)}),Array.from(i.values()).sort((s,f)=>ut(f?.updatedAt)-ut(s?.updatedAt))},Eo=r=>n=>{if(!n||typeof n!="object")return null;let i=typeof n.body_text=="string"?n.body_text:void 0,s=(typeof n.body_html=="string"&&n.body_html.length?n.body_html:null)??(typeof n.body=="string"&&n.body.length?n.body:null)??i,f={id:typeof n.id=="string"&&n.id?n.id:void 0,updatedAt:typeof n[r]=="string"?n[r]:void 0,folderId:typeof n.folder_id=="string"&&n.folder_id?n.folder_id:void 0,bodyHtml:s,bodyText:i,pinned:typeof n.pinned=="boolean"?n.pinned:void 0};return pe(n.title,s,f)},bn=(r={})=>{let{tableName:n=po,userColumn:i=go,updatedAtColumn:s=ho,supabase:f=null}=r,a=f||null,m=null,I=!1,L=new Set,H=null,z=()=>a||(a=dn(),a),U=Eo(s),V=async()=>(!m||I||H||(H=x().catch(()=>{}).finally(()=>{H=null})),H),q=async b=>{let A=z();if(!A||!m)return;let D=(Array.isArray(b)?b.filter(T=>T&&typeof T.id=="string"):[]).map(T=>({id:T.id,[i]:m,title:T.title,body:typeof T.bodyHtml=="string"&&T.bodyHtml.length?T.bodyHtml:T.body,body_html:typeof T.bodyHtml=="string"?T.bodyHtml:null,body_text:typeof T.bodyText=="string"?T.bodyText:null,folder_id:typeof T.folderId=="string"&&T.folderId?T.folderId:null,[s]:typeof T.updatedAt=="string"&&T.updatedAt?T.updatedAt:new Date().toISOString()})),Z=new Set(D.map(T=>T.id));if(D.length){let{error:T}=await A.from(n).upsert(D);if(T)throw T}let te=[...L].filter(T=>T&&!Z.has(T));if(te.length){let{error:T}=await A.from(n).delete().in("id",te).eq(i,m);if(T)throw T}L=new Set(Z)},x=async()=>{let b=z();if(!(!b||!m))try{let{data:A,error:v}=await b.from(n).select(`id,title,body,body_html,body_text,folder_id,${s}`).eq(i,m);if(v)throw v;let D=Array.isArray(A)?A:[];L=new Set(D.map(G=>typeof G.id=="string"?G.id:null).filter(Boolean));let Z=D.map(U).filter(Boolean),te=ge();if(!Z.length){if(te.length)try{await q(te)}catch(G){console.error("[notes-sync] Failed to upload local notes to Supabase.",G)}return}let T=bo(te,Z);I=!0;let O=ae(T,{skipRemoteSync:!0});I=!1,O||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await q(T)}catch(G){console.error("[notes-sync] Failed to reconcile notes with Supabase.",G)}}catch(A){console.error("[notes-sync] Failed to fetch notes from Supabase.",A)}finally{I=!1}};mn(async b=>{if(!I)try{await q(b)}catch(A){console.error("[notes-sync] Failed to sync notes to Supabase.",A)}});let p=async b=>{if(m=typeof b?.id=="string"?b.id:null,!m){L=new Set;return}await x()};return typeof window<"u"&&(window.addEventListener("online",V),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&V()})),{setSupabaseClient(b){b&&(a=b)},handleSessionChange:p,syncFromRemote:x}}});var wo=io(()=>{so();co();ao();He();He();He();En();uo();He();an();(function(){let r=()=>{let n=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!(n instanceof HTMLElement)||!(i instanceof HTMLElement)){let d=typeof r._retryCount=="number"?r._retryCount:0;d<10&&(r._retryCount=d+1,setTimeout(r,50));return}if(r._initialised)return;r._initialised=!0;let s=n.querySelector("[data-dialog-content]"),f=n.querySelector(".sheet-backdrop"),a=document.getElementById("createReminderForm"),m=document.getElementById("saveReminder"),I=document.getElementById("priority"),L=document.getElementById("priorityChips"),H=n.querySelector(".reminder-editor-shell"),z=n.querySelector(".notif-switch-row"),U=n.querySelector("#notifBtn"),V=L?Array.from(L.querySelectorAll('input[name="priority"]')):[],q=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),x=Array.from(q).filter(d=>d instanceof HTMLElement),p=x[0]||null,b=()=>{n.classList.add("hidden"),n.setAttribute("hidden",""),n.setAttribute("aria-hidden","true"),n.removeAttribute("open"),n.classList.remove("open"),[f,s].forEach(d=>{d instanceof HTMLElement&&(d.classList.add("hidden"),d.setAttribute("hidden",""),d.setAttribute("aria-hidden","true"))})};b(),[z,U].forEach(d=>{d?.addEventListener("click",h=>h.stopPropagation())});let A=null,v=(d,h)=>{try{document.dispatchEvent(new CustomEvent(d,{detail:h}))}catch(E){console.warn(`${d} dispatch failed`,E)}},D=()=>{let d=I?.value||"Medium";V.forEach(h=>{let E=h.value===d;h.checked=E,h.setAttribute("aria-checked",E?"true":"false")})},Z=d=>{I&&(I.value!==d&&(I.value=d,I.dispatchEvent(new Event("change",{bubbles:!0}))),D())};V.forEach(d=>{d.addEventListener("change",()=>{d.checked&&Z(d.value)})}),I?.addEventListener("change",D),D();let te=()=>{let d=n.querySelector('input, textarea, select, button, [contenteditable="true"]');d instanceof HTMLElement&&setTimeout(()=>{try{d.focus()}catch{}},0)},T=()=>{H instanceof HTMLElement&&(H.classList.remove("reminder-enter","reminder-enter-active"),H.offsetWidth,H.classList.add("reminder-enter"),requestAnimationFrame(()=>{H.classList.add("reminder-enter-active")}))},O=d=>{if(A=d instanceof HTMLElement?d:null,!(n instanceof HTMLElement)){console.warn("cue:open skipped: sheet element missing");return}let h=[];f instanceof HTMLElement||h.push("backdrop"),s instanceof HTMLElement||h.push("content"),h.length&&console.warn(`cue:open incomplete: missing ${h.join(", ")}`),f instanceof HTMLElement&&(f.classList.remove("hidden"),f.removeAttribute("hidden"),f.setAttribute("aria-hidden","false")),s instanceof HTMLElement&&(s.classList.remove("hidden"),s.removeAttribute("hidden"),s.setAttribute("aria-hidden","false")),n.classList.remove("hidden"),n.removeAttribute("hidden"),n.setAttribute("aria-hidden","false"),n.setAttribute("open",""),n.classList.add("open"),A&&A.setAttribute("aria-expanded","true"),D(),te(),T();let E=[{name:"sheet",el:n},{name:"backdrop",el:f},{name:"content",el:s}].filter(({el:S})=>S instanceof HTMLElement).filter(({el:S})=>S.classList.contains("hidden")||S.hasAttribute("hidden")||S.getAttribute("aria-hidden")==="true");E.length&&console.warn(`cue:open visibility issue: ${E.map(({name:S})=>S).join(", ")}`),v("reminder:sheet-opened",{trigger:A})},G=(d="dismissed")=>{let h=!n.classList.contains("hidden");H&&H.classList.remove("reminder-enter","reminder-enter-active"),b(),A&&A.setAttribute("aria-expanded","false");let E=A&&document.body.contains(A)&&A||p;if(E&&typeof E.focus=="function")try{E.focus()}catch{}h&&v("reminder:sheet-closed",{reason:d,trigger:A}),A=null},u=d=>{if(typeof window<"u"&&typeof window.openNewReminderSheet=="function"){window.openNewReminderSheet(d);return}let h={mode:"create",trigger:d};v("cue:prepare",h),v("cue:open",h)},w=(d,h=void 0)=>{if(!(d instanceof HTMLElement))return;let E=h||!1;d.addEventListener("click",S=>{S.preventDefault(),u(d)},E)},B=document.getElementById("mobile-footer-new-reminder");x.forEach(d=>{w(d,d===B?{capture:!0}:void 0)}),B&&!x.includes(B)&&w(B,{capture:!0}),i.addEventListener("click",d=>{d.preventDefault(),G("close-button")}),f?.addEventListener("click",d=>{d.target===f&&G("backdrop")}),n.addEventListener("keydown",d=>{d.key==="Escape"&&(d.stopPropagation(),G("escape"))}),s?.addEventListener("click",d=>{d.stopPropagation()}),n.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.hasAttribute("data-close")&&G("backdrop")}),document.addEventListener("cue:open",d=>{D(),O(d?.detail?.trigger||null)}),document.addEventListener("cue:close",d=>{G(d?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{D()}),document.addEventListener("cue:cancelled",()=>{G("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=G),document.addEventListener("reminder:save",d=>{if(!(m instanceof HTMLElement))return;let h=d?.detail?.trigger;h&&h!==m||m.matches(":disabled")||m.click()}),a instanceof HTMLFormElement&&m instanceof HTMLElement&&a.addEventListener("submit",d=>{d.preventDefault(),!m.matches(":disabled")&&m.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r()})();var ft=()=>{ft._initialised||(ft._initialised=!0,un({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#startVoiceCaptureGlobal, #quickAddVoice"}).then(()=>{vo()}).catch(r=>{console.error("Failed to initialise reminders:",r)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ft,{once:!0}):ft();var Sn=()=>{let r=document.getElementById("notifHeaderBtn"),n=document.getElementById("notifBtn");r&&n&&r.addEventListener("click",()=>{n.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Sn,{once:!0}):Sn();var Ct=null;function So(){typeof Ct=="function"&&Ct({preserveDraft:!0})}var vn=()=>{if(typeof document>"u")return;let r=document.getElementById("noteTitleMobile"),n=document.getElementById("notebook-editor-body"),i=document.getElementById("noteSaveMobile"),s=document.getElementById("notesListMobile"),f=document.getElementById("notesCountMobile"),a=document.getElementById("notebook-search-input"),m=document.getElementById("folderFilterSelect"),I=document.getElementById("folderFilterNewFolder"),L=document.getElementById("savedNotesSheet"),H=document.getElementById("openSavedNotesGlobal")||document.getElementById("savedNotesShortcut"),z=document.querySelector('[data-action="close-saved-notes"]'),U=document.getElementById("moveFolderSheet"),V=document.getElementById("move-folder-unsorted"),q=document.getElementById("move-folder-list"),x=document.getElementById("move-folder-create"),p=document.getElementById("move-folder-cancel"),b=U?.querySelector(".sheet-panel"),A=document.getElementById("note-folder-sheet"),v=document.getElementById("note-folder-sheet-backdrop"),D=A?.querySelector(".note-folder-sheet-list"),Z=A?.querySelector(".note-folder-sheet-close"),te="shadow-[0_0_0_3px_var(--accent-color)]",O=(()=>{if(!n)return null;let e=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return e?new e("#notebook-editor-body",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(n.setAttribute("contenteditable","true"),n.setAttribute("role","textbox"),n.setAttribute("aria-multiline","true"),n.dataset.placeholder="Start typing your note\u2026",{element:n,setContent(t=""){n.innerHTML=t||""},getHTML(){return n.innerHTML||""},getText(){return n.textContent||""},focus(){try{n.focus()}catch{}}})})();if(!r||!O||!n||!i)return;let G=new Set(["bold","italic","underline","insertunorderedlist","insertorderedlist","indent","outdent"]);function u(){document.querySelectorAll(".rte-btn[data-cmd]").forEach(t=>{let o=(t.dataset.cmd||"").toLowerCase();if(!o||!G.has(o)){t.classList.remove("active");return}try{let l=document.queryCommandState(o);t.classList.toggle("active",!!l)}catch{t.classList.remove("active")}})}let w=e=>{if(!(!e||!n)){try{n.focus()}catch{}try{document.execCommand(e,!1,null)}catch{}u();try{let t=new Event("input",{bubbles:!0});n.dispatchEvent(t)}catch{}}},B=document.getElementById("scratchNotesToolbar");B&&n&&B.addEventListener("click",e=>{let t=e.target.closest(".rte-btn[data-cmd]");if(!t)return;e.preventDefault(),e.stopPropagation();let o=t.getAttribute("data-cmd");o&&w(o)});let d=()=>O&&typeof O.getHtml=="function"?O.getHtml()||"":O&&typeof O.getHTML=="function"?O.getHTML()||"":n.innerHTML||"",h=(e="")=>{let t=typeof e=="string"?e:"";O&&typeof O.setHtml=="function"?O.setHtml(t):O&&typeof O.setContent=="function"?O.setContent(t):n.innerHTML=t},E=(e="")=>{let t=document.createElement("div");return t.innerHTML=typeof e=="string"?e:"",(t.textContent||t.innerText||"").replace(/\s+/g," ").trim()},S=(e="")=>{h(typeof e=="string"?e:""),u()},re=()=>d(),Bt=()=>E(d()),ce=e=>{let t=e;for(;t&&t!==n;){if(t.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(t.tagName?.toLowerCase()))return t;t=t.parentNode}return n},wn=e=>{if(typeof e!="string")return null;let t=e.replace(/\u00a0/g," ");return/^\s*[\*-]\s*$/.test(t)?"ul":/^\s*1\.?\s*$/.test(t)?"ol":null},Ln=e=>{e.key===" "&&setTimeout(()=>{let t=window.getSelection();if(!t||t.rangeCount===0)return;let o=t.getRangeAt(0);if(!n.contains(o.startContainer))return;let l=ce(o.startContainer),c=o.cloneRange();c.selectNodeContents(l),c.setEnd(o.startContainer,o.startOffset);let y=c.toString(),g=wn(y);g&&(e.preventDefault(),c.deleteContents(),w(g==="ul"?"insertUnorderedList":"insertOrderedList"))},0)},An=e=>{if(!e||e.altKey||!(e.ctrlKey||e.metaKey))return;let t=(e.key||"").toLowerCase(),o=null;t==="b"?o="bold":t==="i"?o="italic":t==="u"&&(o="underline"),o&&(e.preventDefault(),w(o))},kt=(e,t=200)=>{let o;return(...l)=>{o&&clearTimeout(o),o=setTimeout(()=>{e(...l)},t)}},Y=null,be=!1,ue=!1,Q=[],ee="all",X="unsorted",Oe=null,mt=null,_e=null,je=null,We="",Re=!1,Ne=null,Ft=()=>{We="",a&&(a.value="")},xt=()=>L?.dataset.open==="true",Tn=()=>{if(L){Ne&&(clearTimeout(Ne),Ne=null),L.classList.remove("hidden"),L.dataset.open="true",L.setAttribute("aria-hidden","false"),document.body.dataset.savedNotesOpen="true",document.documentElement.dataset.savedNotesOpen="true",window.scrollTo({top:0,left:0,behavior:"auto"});try{Ie()}catch{}try{Vn()}catch{}}},Je=()=>{L&&(L.dataset.open="false",L.setAttribute("aria-hidden","true"),delete document.body.dataset.savedNotesOpen,delete document.documentElement.dataset.savedNotesOpen,Ne&&clearTimeout(Ne),Ne=setTimeout(()=>{L?.classList.add("hidden")},200))};(()=>{L&&(H?.addEventListener("click",e=>{e.preventDefault(),Tn();let t=document.getElementById("notesListMobile");t&&(t.scrollTop=0)}),z?.addEventListener("click",e=>{e.preventDefault(),Je()}),L.addEventListener("click",e=>{e.target===L&&Je()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&xt()&&Je()}))})();let Mt=()=>typeof We=="string"?We.trim().toLowerCase():"",In=(e=Q)=>{if(!Array.isArray(e))return[];let t=Mt();return t?e.filter(o=>{let l=typeof o?.title=="string"?o.title.toLowerCase():"",c=Bn(o).toLowerCase();return l.includes(t)||c.includes(t)}):[...e]},Nn=(e=[])=>[...e].sort((t,o)=>{let l=!!t?.pinned,c=!!o?.pinned;return l!==c?l?-1:1:Qe(o)-Qe(t)}),Dt=(e=Q)=>{if(!Array.isArray(e))return[];let t;return ee===null||ee==="all"?t=[...e]:ee==="unsorted"?t=e.filter(o=>!o.folderId||o.folderId==="unsorted"):t=e.filter(o=>o.folderId===ee),Nn(In(t))},Ht=(e=[],t=[])=>{let o={all:Array.isArray(e)?e.length:0,unsorted:0};return(Array.isArray(t)?t:[]).forEach(l=>{l&&l.id&&l.id!=="unsorted"&&(o[l.id]=0)}),(Array.isArray(e)?e:[]).forEach(l=>{let c=l?.folderId||"unsorted";!c||c==="unsorted"?o.unsorted+=1:Object.prototype.hasOwnProperty.call(o,c)?o[c]+=1:o.unsorted+=1}),o},Ee=(e,t={})=>{let{isNew:o=!1}=t;if(e&&Y===e.id&&!o)return;if(!e){be=!1,ue=!1,Y=null,r.value="",S(""),delete r.dataset.noteOriginalTitle,n.dataset.noteOriginalBody=re();let C=document.getElementById("note-folder-label");C&&(C.textContent=de(X||"unsorted"));return}be=!!o,ue=!1,Y=e.id;let l=e.title||"",c=typeof e.bodyHtml=="string"?e.bodyHtml:null,y=typeof e.body=="string"?e.body:"",g=(c??y)||"";r.value=o?"":l,S(o?"":g),r.dataset.noteOriginalTitle=o?"":l,n.dataset.noteOriginalBody=re(),X=e.folderId&&typeof e.folderId=="string"?e.folderId:"unsorted";let _=document.getElementById("note-folder-label");_&&(_.textContent=de(X))},Cn=(e="")=>E(e),Bn=e=>{if(!e)return"";if(typeof e.bodyText=="string"&&e.bodyText.trim().length)return e.bodyText.trim();let t=typeof e.bodyHtml=="string"&&e.bodyHtml.trim().length?e.bodyHtml:typeof e.body=="string"?e.body:"";return Cn(t)},Ue=()=>{if(!s)return;s.querySelectorAll('[data-role="open-note"][data-note-id]').forEach(t=>{if(!(t instanceof HTMLElement))return;let o=t.getAttribute("data-note-id")===Y;o?t.setAttribute("data-state","active"):t.removeAttribute("data-state"),t.classList.toggle("selected",o),t.classList.toggle("active",o),t.classList.toggle("outline",o),t.classList.toggle("outline-2",o),t.classList.toggle("outline-accent",o),t.classList.toggle(te,o),t.setAttribute("aria-current",o?"true":"false");let l=t.closest(".note-list-item, .note-row");l&&(l.classList.toggle("is-active",o),l.classList.toggle("selected",o))})},kn=e=>{if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let o=new Date,l=t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate(),c=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return l?`Today \xB7 ${c}`:`${t.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${c}`},yt=()=>{if(be&&!ue)return!1;let e=typeof r.value=="string"?r.value:"",t=d(),o=r.dataset.noteOriginalTitle??"",l=n.dataset.noteOriginalBody??"";return e!==o||t!==l},Ot=()=>{let e=typeof r.value=="string"?r.value.trim():"",t=Bt();return!!e||!!t},Fn=()=>{let e=document.querySelector(".note-editor-card");e&&(e.scrollTop=0);let t=document.querySelector(".note-editor-inner");t&&(t.scrollTop=0)},xn=()=>typeof window<"u"&&window.innerWidth<768||/Mobi|Android/i.test(typeof navigator<"u"?navigator.userAgent:""),Qe=e=>{if(!e)return 0;let t=[e.updatedAt,e.modifiedAt,e.createdAt];for(let o of t){let l=Date.parse(o||"");if(!Number.isNaN(l))return l}return 0},Mn=()=>{let e=ge();return Array.isArray(e)?[...e].sort((t,o)=>Qe(o)-Qe(t)):[]},pt=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(Ge)}catch{return null}},qe=pt(),Xe=()=>(qe=pt(),qe),fe=({preserveDraft:e=!0}={})=>{let t=Mn();Q=Array.isArray(t)?[...t]:[];let o=e&&yt(),l=Q.length>0,c=Dt();if(gt(c),!l)return o||Ee(null),Ue(),Xe(),Re=!1,c;if(Y){let y=Q.find(g=>g.id===Y)||null;y?o||Ee(y):(Y=null,!o&&!Re&&Q[0]&&Ee(Q[0]))}else!o&&!Re&&Q[0]&&Ee(Q[0]);return Re=!1,Ue(),Xe(),c};Ct=(e={})=>{try{fe(e)}catch(t){console.warn("[notebook] requestNotesRefresh failed",t)}};let Dn=160,Hn=e=>{if(!e)return null;let t=document.createElement("div");return t.className="note-toast",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t&&t.parentNode&&t.parentNode.removeChild(t)},2800),t},On=e=>{Hn(`Moved to ${e||"folder"}`)},_n=typeof requestAnimationFrame=="function"?requestAnimationFrame:e=>setTimeout(e,0),Rn=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:e=>clearTimeout(e),Ze=null,et=null,Un=e=>{if(typeof e=="function"){if(!s){e();return}Ze&&(clearTimeout(Ze),Ze=null),et&&(Rn(et),et=null),s.classList.remove("notebook-list-transition-in","notebook-list-transition-in-active"),s.classList.add("notebook-list-transition-out"),Ze=setTimeout(()=>{e(),s.classList.remove("notebook-list-transition-out"),s.classList.add("notebook-list-transition-in"),et=_n(()=>{s.classList.add("notebook-list-transition-in-active")})},Dn)}},_t=e=>{if(!e)return;let t=ge();if(!Array.isArray(t))return;let o=t.filter(l=>l.id!==e);o.length!==t.length&&(ae(o),Xe(),Y===e&&(Ee(null),Re=!0),fe({preserveDraft:!1}))},Se=null,Ce=null,ve=()=>{Se&&Se.classList.remove("open"),Ce&&Ce.setAttribute("aria-expanded","false"),Se=null,Ce=null},qn=(e,t)=>{if(!(!e||!t)){if(Se===e){ve();return}ve(),Se=e,Ce=t,t.setAttribute("aria-expanded","true"),e.classList.add("open")}},Pn=e=>{if(!Se||!Ce)return;let t=e.target;t instanceof HTMLElement&&(Se.contains(t)||Ce.contains(t)||ve())};document.addEventListener("click",Pn),document.addEventListener("keydown",e=>{e.key==="Escape"&&ve()});let gt=(e=[],{withTransition:t=!0}={})=>{if(t)return Un(()=>gt(e,{withTransition:!1})),e;if(!s)return e;if(ve(),s.innerHTML="",f){let o=Q.length,l=e.length;f.textContent=o?`${l} of ${o} saved`:"No saved notes yet"}if(!e.length){let o=!!Mt(),l=o?"No notes found":"No notes yet",c=o?"Try a different search term or clear the search.":"Create a new note to start capturing your ideas.";return s.innerHTML=`
        <div class="notebook-empty">
          <div class="notebook-empty-title">${l}</div>
          <div class="notebook-empty-body">${c}</div>
        </div>
      `,e}return e.forEach(o=>{let l=document.createElement("li"),c=String(o.id)===String(Y),y=!!o?.pinned;l.className="note-item-mobile";let g=document.createElement("div");g.className="note-card note-row note-list-item",g.classList.toggle("selected",c),g.classList.toggle("is-active",c),g.dataset.noteId=o.id,g.dataset.role="open-note",g.setAttribute("role","button"),g.tabIndex=0;let _=document.createElement("div");_.className="note-row-main note-list-main note-card-main",_.dataset.role="open-note",_.dataset.noteId=o.id;let C=typeof o.title=="string"&&o.title.trim()||"Untitled",k=document.createElement("div");k.className="note-row-title note-list-title note-card-title",k.textContent=C,k.setAttribute("title",C);let N=document.createElement("div");if(N.className="note-row-title-row note-list-title-row note-card-header",N.appendChild(k),y){let K=document.createElement("span");K.className="note-list-pin-icon",K.textContent="\u{1F4CC}",K.setAttribute("aria-hidden","true"),N.appendChild(K)}let M=o.folderId&&typeof o.folderId=="string"?o.folderId:"unsorted",P=de(M)||"Unsorted",se=kn(o.updatedAt),F=document.createElement("div");F.className="note-row-meta note-list-meta note-card-meta";let R=document.createElement("button");if(R.type="button",R.className="note-row-folder note-list-folder note-card-folder",R.textContent=P,R.setAttribute("aria-label","Move note to folder"),R.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),rt(o.id,{initialFolderId:M,triggerEl:R})}),F.appendChild(R),se){let K=document.createElement("span");K.className="note-row-dot note-list-dot note-card-meta-dot",K.textContent="\u2022";let Lt=document.createElement("span");Lt.className="note-row-timestamp note-list-date note-card-timestamp",Lt.textContent=se,F.appendChild(K),F.appendChild(Lt)}_.appendChild(N),_.appendChild(F);let $=document.createElement("button");$.type="button",$.dataset.noteId=o.id,$.dataset.role="note-menu",$.className="note-row-overflow note-list-overflow note-options-button note-card-action",$.setAttribute("aria-label","Note actions"),$.setAttribute("aria-expanded","false"),$.tabIndex=0,$.setAttribute("aria-haspopup","true"),$.textContent="\u22EE";let J=document.createElement("div");J.className="note-card-menu",J.setAttribute("role","menu");let ne=document.createElement("button");ne.type="button",ne.className="note-card-menu-item",ne.textContent="Move to Folder",ne.setAttribute("role","menuitem"),ne.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),ve(),rt(o.id,{initialFolderId:M,triggerEl:$})});let le=document.createElement("button");le.type="button",le.className="note-card-menu-item note-card-menu-danger",le.textContent="Delete",le.setAttribute("role","menuitem"),le.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),ve(),_t(o.id)}),$.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),qn(J,$)}),J.appendChild(ne),J.appendChild(le),g.appendChild($),g.appendChild(_),g.appendChild(J),l.appendChild(g),s.appendChild(l)}),Ue(),e},Rt=()=>document.getElementById("notebook-folder-bar"),Ut=e=>{let t=Rt();if(!t)return;t.querySelectorAll(".notebook-folder-chip").forEach(l=>{let c=String(l.dataset.folderId)===String(e);if(l.classList.toggle("notebook-folder-chip--active",c),l.classList.toggle("active",c),c)try{l.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}catch{try{l.scrollIntoView()}catch{}}})},qt=()=>{let e=[];try{e=Array.isArray(j())?j():[]}catch{e=[]}let t=Array.isArray(e)?e.filter(Boolean):[],o=t.find(y=>y&&y.id==="unsorted")||{id:"unsorted",name:"Unsorted"},l=t.filter(y=>y&&y.id!=="unsorted").sort((y,g)=>String(y.name||"").localeCompare(String(g.name||""),void 0,{sensitivity:"base"}));return{chipModel:[{id:"all",name:"All notes",isVirtual:!0},{...o,isVirtual:!1},...l.map(y=>({...y,isVirtual:!1}))],unsortedFolder:o,extraFolders:l}},zn=e=>{if(!m)return;let t=e||"all";m.value=t},ht=(e=null)=>{if(!m)return;let t=Array.isArray(e)?e:qt().chipModel;m.innerHTML="",t.forEach(o=>{let l=document.createElement("option");l.value=o.id||"unsorted",l.textContent=o.name||"Folder",m.appendChild(l)}),zn(ee)},Pe=()=>{let e=Rt();if(!e)return;e.innerHTML="";let t=document.createElement("div");t.className="notebook-folder-filter-bar";let{chipModel:o,unsortedFolder:l,extraFolders:c}=qt(),y=[l,...c],g=Ht(Q,y),_=M=>{let P=document.createElement("button");P.type="button",P.className="folder-chip notebook-folder-chip notebook-tab",P.dataset.folderId=M.id;let se=document.createElement("span");se.className="notebook-folder-chip-label",se.textContent=M.name,P.appendChild(se);let F=document.createElement("span");F.className="notebook-folder-chip-count";let R=M.id==="all"?"all":M.id||"unsorted",$=typeof g[R]=="number"?g[R]:0;if(F.textContent=$,P.appendChild(F),P.addEventListener("click",()=>{ee=M.id==="all"?"all":M.id,Ut(ee),Ft(),Ie()}),M.id!=="all"&&M.id!=="unsorted"){let J=document.createElement("button");J.type="button",J.className="notebook-folder-chip-overflow",J.setAttribute("aria-label","Folder options"),J.innerHTML="\u22EF",J.addEventListener("click",ne=>{ne.stopPropagation(),Wn(M.id,P)}),P.appendChild(J)}return P};o.forEach(M=>{t.appendChild(_(M))});let C=document.createElement("div");C.className="notebook-folder-scroll-wrap",C.appendChild(t);let k=document.createElement("div");k.className="notebook-folder-header";let N=document.createElement("div");N.className="folder-chips",N.appendChild(C),k.appendChild(N),e.appendChild(k),Ut(ee),ht(o)},Vn=()=>{if(!L)return;try{let t=document.getElementById("notebook-folder-bar");if(t){let o=t.querySelector('[data-folder-id="new-folder"], .new-folder-btn, .notebook-folder-chip--new');o&&o.remove()}}catch{}if(document.getElementById("fabNewFolder"))return;try{L.style.position=L.style.position||"fixed"}catch{}let e=document.createElement("button");e.id="fabNewFolder",e.type="button",e.className="fab-new-folder fab-button",e.setAttribute("aria-label","Create new folder"),e.setAttribute("title","Create new folder"),e.innerHTML=`
      <span aria-hidden="true">+</span>
      <span class="sr-only">New folder</span>
    `,e.addEventListener("click",t=>{t.preventDefault();try{ze()}catch(o){console.warn("[notebook] openNewFolderDialog() not available",o)}}),L.appendChild(e)},Pt=document.getElementById("newFolderModal"),ie=document.getElementById("newFolderName"),Be=document.getElementById("newFolderError"),zt=document.getElementById("newFolderCreate"),bt=document.getElementById("newFolderCancel"),tt=null,we=null,Vt=()=>{Be&&(Be.classList.add("sr-only"),Be.textContent="")},Et=e=>{Be&&(Be.textContent=e,Be.classList.remove("sr-only"))},ze=()=>{if(!Pt){console.warn("[notebook] #newFolderModal not found; create folder modal missing");return}tt||(tt=new at({modalElement:Pt,closeButton:bt,titleInput:ie,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),Vt(),ie&&(ie.value="",setTimeout(()=>{try{ie.focus(),ie.select&&ie.select()}catch{}},20)),tt.show()};typeof window<"u"&&typeof window.openNewFolderDialog>"u"&&(window.openNewFolderDialog=ze),I&&I.addEventListener("click",e=>{e.preventDefault(),ze()});let $t=()=>{if(!ie)return;let t=String(ie.value||"").trim();if(Vt(),!t.length){Et("Folder name can't be empty.");return}let o=[];try{o=Array.isArray(j())?j():[]}catch{o=[]}if(o.some(C=>String(C.name).toLowerCase()===t.toLowerCase())){Et("You already have a folder with this name.");return}let c=`folder-${Date.now().toString(36)}`,y={id:c,name:t},g=[...o.filter(Boolean),y];if(!Ye(g))return Et("Unable to create folder. Please try again."),null;try{tt.requestClose("created")}catch{}try{Pe()}catch(C){console.warn("[notebook] rebuild folder chips failed",C)}try{ht()}catch(C){console.warn("[notebook] rebuild folder filter failed",C)}if(typeof we=="function"){try{we(c,t)}catch(C){console.warn("[notebook] post-create handler failed",C)}we=null}return c};zt&&zt.addEventListener("click",e=>{e.preventDefault(),$t()}),ie&&ie.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),$t())}),bt&&bt.addEventListener("click",()=>{we=null});let Le=document.getElementById("note-folder-button")||document.getElementById("noteFolderPillMobile");Le&&Le.addEventListener("click",e=>{e.preventDefault(),rt(Y,{initialFolderId:X,triggerEl:Le})});let he=null,ke=null,oe=()=>{he&&he.parentNode&&he.parentNode.removeChild(he);let e=ke&&document.body.contains(ke)&&typeof ke.focus=="function"?ke:null;if(he=null,ke=null,document.removeEventListener("click",oe),document.removeEventListener("keydown",Kt),e)try{e.focus()}catch{}},Kt=e=>{e.key==="Escape"&&(e.preventDefault(),oe()),e.key==="Tab"&&requestAnimationFrame(()=>{he&&!he.contains(document.activeElement)&&oe()})},me=document.getElementById("note-options-overlay"),W=document.getElementById("note-options-sheet"),St=W?.querySelector(".note-action-move"),nt=W?.querySelector(".note-action-toggle-pin"),Gt=W?.querySelector(".note-action-delete"),ye=null,$n=()=>W&&W.classList.contains("open"),Fe=()=>{ye=null,W&&(W.classList.remove("open"),W.setAttribute("aria-hidden","true"),W.removeAttribute("data-note-id")),me&&(me.classList.remove("open"),me.setAttribute("aria-hidden","true"))},Kn=e=>{e.key==="Escape"&&$n()&&(e.preventDefault(),Fe())},Yt=e=>{if(!e||!W||!me)return;Fe(),oe(),ye=e;let t=Q.find(o=>o.id===e);if(nt){let o=!!t?.pinned;nt.textContent=o?"Unpin note":"Pin note"}W.classList.add("open"),W.setAttribute("aria-hidden","false"),W.setAttribute("data-note-id",e),me.classList.add("open"),me.setAttribute("aria-hidden","false")};me&&me.addEventListener("click",e=>{e.preventDefault(),Fe()}),W&&St&&St.addEventListener("click",e=>{e.preventDefault();let t=Q.find(o=>o.id===ye);Fe(),ye&&rt(ye,{initialFolderId:t&&t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted",triggerEl:St})}),W&&nt&&nt.addEventListener("click",e=>{if(e.preventDefault(),!ye)return;let t=ge(),o=!1,l=(Array.isArray(t)?t:[]).map(c=>{if(c&&c.id===ye){o=!0;let y=!c.pinned;return{...c,pinned:y,updatedAt:new Date().toISOString()}}return c});o&&(ae(l),fe({preserveDraft:!0})),Fe()}),W&&Gt&&Gt.addEventListener("click",e=>{e.preventDefault(),ye&&_t(ye),Fe()}),W&&me&&document.addEventListener("keydown",Kn);let ot=(e,t)=>{if(!e)return;let o=t==="unsorted"?null:t;if(hn(e,o)){try{fe({preserveDraft:!0})}catch(c){console.warn("[notebook] failed to refresh notes after move",c)}try{Pe()}catch(c){console.warn("[notebook] failed to refresh folder chips after move",c)}try{let c=de(o||"unsorted")||"Unsorted";On(c)}catch{}if(e===Y){X=o||"unsorted";let c=document.getElementById("note-folder-label");c&&(c.textContent=de(X))}oe()}},Ve=()=>{A&&(A.classList.remove("open"),A.setAttribute("aria-hidden","true")),v&&(v.classList.remove("open"),v.setAttribute("aria-hidden","true")),mt=null,document.removeEventListener("keydown",Gn),D&&(D.innerHTML="")},jt=e=>{let t=mt||Y;t&&ot(t,e||"unsorted"),Ve()},Wt=e=>{e&&(e.preventDefault(),e.stopPropagation());let t=mt||Y;we=o=>{t&&ot(t,o||"unsorted"),Ve()},ze()},Gn=e=>{e.key==="Escape"&&(e.preventDefault(),Ve())};D&&(D.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(".note-folder-row"):null;if(!(!t||!D.contains(t))){if(t.classList.contains("note-folder-row-new")){Wt(e);return}e.preventDefault(),jt(t.dataset.folderId||"unsorted")}}),D.addEventListener("keydown",e=>{if(e.key!=="Enter"&&e.key!==" ")return;let t=e.target instanceof HTMLElement?e.target.closest(".note-folder-row"):null;if(!(!t||!D.contains(t))){if(t.classList.contains("note-folder-row-new")){Wt(e);return}e.preventDefault(),jt(t.dataset.folderId||"unsorted")}})),Z&&Z.addEventListener("click",e=>{e.preventDefault(),Ve()}),v&&v.addEventListener("click",e=>{e.preventDefault(),Ve()});let Yn='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Jt=()=>{if(!b)return[];let e=b.querySelectorAll(Yn);return Array.from(e).filter(t=>t instanceof HTMLElement&&!t.hasAttribute("disabled")&&t.tabIndex!==-1&&t.offsetParent!==null)},jn=()=>{let e=Jt();if(e.length){try{e[0].focus({preventScroll:!0})}catch{}return}if(b)try{b.focus({preventScroll:!0})}catch{}},Qt=e=>{let t=String(e||"unsorted");if((q?.querySelectorAll(".folder-select-row")||[]).forEach(l=>{if(!(l instanceof HTMLElement))return;let c=l.dataset.folderId===t;l.classList.toggle("folder-select-row--active",c),l.setAttribute("aria-selected",c?"true":"false")}),V){let l=t==="unsorted";V.classList.toggle("folder-select-row--active",l),V.setAttribute("aria-selected",l?"true":"false")}},Xt=e=>{if(!U||U.classList.contains("hidden"))return;if(e.key==="Escape"){e.preventDefault(),xe();return}if(e.key!=="Tab")return;let t=Jt();if(!t.length)return;let o=t[0],l=t[t.length-1],c=document.activeElement;e.shiftKey&&c===o?(e.preventDefault(),l.focus()):!e.shiftKey&&c===l&&(e.preventDefault(),o.focus())},vt=e=>{let t=e||"unsorted";if(Qt(t),_e)_e(t);else if(Oe)ot(Oe,t);else{X=t;let o=document.getElementById("note-folder-label");o&&(o.textContent=de(X))}xe()},xe=(e={})=>{let{preserveCreateHandler:t=!1}=e||{};if(U&&(U.classList.add("hidden"),U.setAttribute("aria-hidden","true")),q&&q.querySelectorAll(".folder-select-row").forEach(l=>{l.id!=="move-folder-unsorted"&&l.remove()}),Oe=null,_e=null,t||(we=null),document.removeEventListener("keydown",Xt),Le&&Le.setAttribute("aria-expanded","false"),je instanceof HTMLElement)try{je.focus({preventScroll:!0})}catch{}je=null},rt=(e,t={})=>{if(!U||!q)return;let{onSelect:o=null,initialFolderId:l=null,triggerEl:c=null}=t;Oe=e||null,_e=typeof o=="function"?o:null,je=c||document.activeElement,q.querySelectorAll(".folder-select-row").forEach(F=>{F.id!=="move-folder-unsorted"&&F.remove()});let g=[];try{g=Array.isArray(j())?j():[]}catch{g=[]}let _={id:"unsorted",name:"Unsorted"},C=g.some(F=>F&&F.id==="unsorted");C||g.unshift(_);let k=e&&Q.find(F=>F.id===e)||null,N=l||(k&&typeof k.folderId=="string"&&k.folderId?k.folderId:X||"unsorted"),M=g.filter(F=>F&&F.id!=="unsorted").sort((F,R)=>(Number(F.order)||0)-(Number(R.order)||0)),P=Ht(Q,[_,...M]);if(V){let F=V.querySelector(".folder-select-row__count");F&&(F.textContent=P.unsorted||0);let R=V.querySelector(".folder-select-row__name");R&&(R.textContent=C&&de("unsorted")||"Unsorted")}let se=F=>{let R=document.createElement("button");R.className="folder-select-row",R.dataset.folderId=F.id,R.setAttribute("role","option"),R.type="button",R.setAttribute("aria-selected","false");let $=document.createElement("div");$.className="folder-select-row__left";let J=document.createElement("span");J.className="folder-select-row__dot",J.setAttribute("aria-hidden","true"),$.appendChild(J);let ne=document.createElement("span");ne.className="folder-select-row__name",ne.textContent=F.name||String(F.id),$.appendChild(ne),R.appendChild($);let le=document.createElement("span");return le.className="folder-select-row__count",le.textContent=P[F.id]||0,R.appendChild(le),R};if(M.forEach(F=>{if(typeof F.id>"u")return;let R=se(F);q.appendChild(R)}),Qt(N),U.classList.remove("hidden"),U.setAttribute("aria-hidden","false"),b)try{b.focus({preventScroll:!0})}catch{}c===Le&&Le.setAttribute("aria-expanded","true"),document.addEventListener("keydown",Xt),jn()};q&&(q.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(".folder-select-row"):null;!t||!q.contains(t)||(e.preventDefault(),vt(t.dataset.folderId||"unsorted"))}),q.addEventListener("keydown",e=>{if(e.key!=="Enter"&&e.key!==" ")return;let t=e.target instanceof HTMLElement?e.target.closest(".folder-select-row"):null;!t||!q.contains(t)||(e.preventDefault(),vt(t.dataset.folderId||"unsorted"))})),V&&V.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),vt("unsorted")}),U&&U.addEventListener("click",e=>{e.target===U&&(e.preventDefault(),xe())}),p&&p.addEventListener("click",e=>{e.preventDefault(),xe()}),x&&x.addEventListener("click",e=>{e.preventDefault();let t=Oe||Y,o=_e;we=l=>{if(o)o(l);else if(t)ot(t,l);else{X=l||"unsorted";let c=document.getElementById("note-folder-label");c&&(c.textContent=de(X))}xe()},xe({preserveCreateHandler:!0}),ze()});let Zt=(e,t)=>{if(!e||t!==-1&&t!==1)return;let o=[];try{o=Array.isArray(j())?j().slice():[]}catch{o=[]}if(!o.length)return;let l=o.filter(N=>N&&N.id!=="unsorted");l.sort((N,M)=>(Number(N.order)||0)-(Number(M.order)||0));let c=l.findIndex(N=>String(N.id)===String(e));if(c===-1)return;let y=c+t;if(y<0||y>=l.length)return;let g=l[c].order;l[c].order=l[y].order,l[y].order=g;let k=[o.find(N=>N&&N.id==="unsorted")||{id:"unsorted",name:"Unsorted",order:-1},...l].map((N,M)=>({id:N.id,name:N.name,order:M}));try{if(Ye(k)){try{Pe()}catch{}try{Ie()}catch{}}}catch(N){console.warn("[notebook] reorder save failed",N)}},Wn=(e,t)=>{if(!e||e==="all"||e==="unsorted")return;oe();let o=document.createElement("div");o.className="memory-glass-card p-2 rounded shadow-lg",o.style.position="absolute",o.style.zIndex=1200,o.style.minWidth="160px";let l=!1,c=!1;try{let N=(Array.isArray(j())?j().filter(Boolean):[]).filter(P=>P&&P.id!=="unsorted").sort((P,se)=>(Number(P.order)||0)-(Number(se.order)||0)),M=N.findIndex(P=>String(P.id)===String(e));l=M===0,c=M===-1?!0:M===N.length-1}catch{l=!1,c=!1}let y=document.createElement("button");y.type="button",y.className="w-full text-left px-3 py-2 btn-ghost",y.textContent="Move up",l&&(y.setAttribute("disabled",""),y.classList.add("opacity-50","cursor-not-allowed")),y.addEventListener("click",k=>{k.preventDefault();try{Zt(e,-1)}catch(N){console.warn("[notebook] reorder move up failed",N)}oe()});let g=document.createElement("button");g.type="button",g.className="w-full text-left px-3 py-2 btn-ghost",g.textContent="Move down",c&&(g.setAttribute("disabled",""),g.classList.add("opacity-50","cursor-not-allowed")),g.addEventListener("click",k=>{k.preventDefault();try{Zt(e,1)}catch(N){console.warn("[notebook] reorder move down failed",N)}oe()});let _=document.createElement("button");_.type="button",_.className="w-full text-left px-3 py-2 btn-ghost",_.textContent="Rename folder",_.addEventListener("click",k=>{k.preventDefault(),Qn(e),oe()});let C=document.createElement("button");C.type="button",C.className="w-full text-left px-3 py-2 btn-ghost text-accent",C.textContent="Delete folder",C.addEventListener("click",k=>{k.preventDefault(),Zn(e),oe()}),o.appendChild(y),o.appendChild(g),o.appendChild(_),o.appendChild(C),document.body.appendChild(o),he=o,ke=t instanceof HTMLElement?t:null;try{let k=t.getBoundingClientRect(),N=k.bottom+window.scrollY+6,M=k.left+window.scrollX;o.style.top=`${N}px`,o.style.left=`${M}px`}catch{o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)"}document.addEventListener("click",oe),document.addEventListener("keydown",Kt)},en=document.getElementById("renameFolderModal"),Ae=document.getElementById("renameFolderName"),Me=document.getElementById("renameFolderError"),tn=document.getElementById("renameFolderSave"),Jn=document.getElementById("renameFolderCancel"),it=null,$e=null,nn=()=>{Me&&(Me.classList.add("sr-only"),Me.textContent="")},wt=e=>{Me&&(Me.textContent=e,Me.classList.remove("sr-only"))},Qn=e=>{if(!en||e==="all"||e==="unsorted")return;$e=e;let o=(Array.isArray(j())?j():[]).find(l=>l&&String(l.id)===String(e));o&&(it||(it=new at({modalElement:en,closeButton:Jn,titleInput:Ae,modalTitle:document.getElementById("renameFolderTitle"),autoFocus:!0})),nn(),Ae&&(Ae.value=o.name||""),it.show())},on=()=>{if(!$e||!Ae)return;let t=String(Ae.value||"").trim();if(nn(),!t.length){wt("Folder name can't be empty.");return}let o=[];try{o=Array.isArray(j())?j():[]}catch{o=[]}if(o.some(g=>String(g.name).toLowerCase()===t.toLowerCase()&&String(g.id)!==String($e))){wt("You already have a folder with this name.");return}let c=o.map(g=>String(g.id)===String($e)?{...g,name:t}:g);if(!Ye(c)){wt("Unable to rename folder. Please try again.");return}try{it.requestClose("saved")}catch{}$e=null;try{Pe()}catch{}Ie()};tn&&tn.addEventListener("click",e=>{e.preventDefault(),on()}),Ae&&Ae.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),on())});let rn=document.getElementById("deleteFolderModal"),sn=document.getElementById("deleteFolderConfirm"),Xn=document.getElementById("deleteFolderCancel"),Ke=null,Te=null,Zn=e=>{!rn||e==="all"||e==="unsorted"||(Te=e,Ke||(Ke=new at({modalElement:rn,closeButton:Xn,titleInput:null,modalTitle:document.getElementById("deleteFolderTitle"),autoFocus:!1})),Ke.show())},eo=()=>{if(!Te)return;let e=[];try{e=Array.isArray(j())?j():[]}catch{e=[]}let t=e.filter(y=>String(y.id)!==String(Te));if(t.some(y=>y&&y.id==="unsorted")||t.unshift({id:"unsorted",name:"Unsorted"}),!Ye(t)){try{Ke.requestClose("failed")}catch{}Te=null;return}let l=ge(),c=(Array.isArray(l)?l:[]).map(y=>y&&String(y.folderId)===String(Te)?{...y,folderId:"unsorted",updatedAt:new Date().toISOString()}:y);ae(c),String(ee)===String(Te)&&(ee="unsorted",Ft()),Te=null;try{Ke.requestClose("deleted")}catch{}Pe(),Ie()};sn&&sn.addEventListener("click",e=>{e.preventDefault(),eo()}),s&&(s.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let o=t.closest('.note-options-button, button[data-role="note-menu"]');if(o&&s.contains(o)){e.preventDefault(),e.stopPropagation();let c=o.getAttribute("data-note-id")||(o.closest("[data-note-id]")||o).getAttribute("data-note-id");if(!c)return;Yt(c);return}let l=t.closest('[data-role="open-note"]');if(l&&s.contains(l)){e.preventDefault();let c=l.getAttribute("data-note-id");if(!c)return;let y=Q.find(g=>g.id===c);y&&(Ee(y),Ue(),xt()&&Je())}}),s.addEventListener("pointerup",e=>{if(!(e instanceof PointerEvent)||e.pointerType!=="touch")return;let t=e.target instanceof HTMLElement?e.target:null;if(!t)return;let o=t.closest('.note-options-button, button[data-role="note-menu"]');if(o&&s.contains(o)){e.preventDefault(),e.stopPropagation();let l=o.getAttribute("data-note-id")||(o.closest("[data-note-id]")||o).getAttribute("data-note-id");if(!l)return;Yt(l);return}}));let Ie=()=>{gt(Dt())};if(a){let e=kt(()=>{We=typeof a.value=="string"?a.value.trim():"",Ie()},200);a.addEventListener("input",e),a.addEventListener("search",e)}folderFilterDropdown&&folderFilterDropdown.addEventListener("change",e=>{let t=e?.target;if(!(t instanceof HTMLSelectElement))return;ee=((t.value||"").toLowerCase()==="all"?"all":t.value)||"all",Ie()});let to=()=>{fe({preserveDraft:!1})},no=e=>{if(!e)return;X=e.folderId&&typeof e.folderId=="string"?e.folderId:"unsorted",Fn(),Ee(e,{isNew:!0}),Ue();let t=document.getElementById("note-folder-label");if(t&&(t.textContent=de(X)),xn())try{O&&typeof O.focus=="function"?O.focus():n&&typeof n.focus=="function"&&n.focus()}catch{}else if(typeof r.focus=="function")try{r.focus()}catch{}},oo=()=>{let e=new Date().toISOString(),t=ee&&ee!=="all"?ee:"unsorted",l={...pe("","",{folderId:t,updatedAt:e}),title:"",body:"",bodyHtml:"",bodyText:"",updatedAt:e,folderId:t};no(l)};i.addEventListener("click",()=>{if(be&&!ue&&!Ot())return;let e=ge(),t=Array.isArray(e)?[...e]:[],o=d()||"",l=E(o),y=(typeof r.value=="string"?r.value.trim():"")||"Untitled note",g=new Date().toISOString(),_=X&&X!=="all"?X:"unsorted";if(Y){let C=t.findIndex(k=>k.id===Y);if(C>=0)t[C]={...t[C],title:y,body:o,bodyHtml:o,bodyText:l,updatedAt:g,folderId:_};else{let k=pe(y,o,{updatedAt:g,folderId:_,bodyText:l});Y=k.id,t.unshift(k)}}else{let C=pe(y,o,{folderId:_,bodyText:l});Y=C.id,t.unshift(C)}ae(t),Xe(),be=!1,ue=!1,fe({preserveDraft:!1})});let st=document.getElementById("mobile-footer-new-note");st&&st.addEventListener("click",e=>{e.preventDefault();try{st.getAttribute("data-nav-target")&&(document.querySelectorAll("[data-nav-target]").forEach(l=>l.classList.remove("active")),st.classList.add("active"))}catch{}oo()});let lt=kt(()=>{try{if(be&&!ue||!yt())return;i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}},1500),ro=()=>{if(be){if(!Ot()){ue=!1;return}ue=!0}else ue=!0;lt()};try{r.addEventListener("input",ro)}catch{}try{n.addEventListener("input",lt),n.addEventListener("input",u),n.addEventListener("keyup",u),n.addEventListener("mouseup",u),n.addEventListener("keydown",Ln),n.addEventListener("keydown",An),n.addEventListener("blur",()=>{lt()}),r.addEventListener("blur",()=>lt())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",e=>{try{yt()&&i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}}),u(),to(),ht(),typeof window<"u"&&(window.addEventListener("storage",e=>{e.key===Ge&&(qe=e.newValue??null,fe({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let e=pt();e!==qe&&(qe=e,fe({preserveDraft:!0}))},2e3)));try{fe({preserveDraft:!0})}catch(e){console.warn("[notebook] initial refreshFromStorage failed",e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",vn,{once:!0}):vn();function vo(){let r=bn?.();if(!r)console.warn("[notes-sync] initNotesSync() did not return a controller; notes will remain local-only.");else if(typeof r.syncFromRemote=="function"){let s=r.syncFromRemote.bind(r);r.syncFromRemote=async(...f)=>{let a=await s(...f);try{So()}catch{}return a}}let i=cn({selectors:{signInButtons:["#googleSignInBtn","#googleSignInBtnMenu"],signOutButtons:["#googleSignOutBtn","#googleSignOutBtnMenu"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#notesSyncStatus"],feedback:["#notesSyncMessage"]},disableButtonBinding:!1,onSessionChange(s,f){r&&typeof r.handleSessionChange=="function"&&r.handleSessionChange(s??null,f??null)}})?.supabase;!i||!r||(typeof r.setSupabaseClient=="function"&&r.setSupabaseClient(i),i.auth.getSession().then(({data:s})=>{let f=s?.session??null,a=f?.user??null;typeof r.handleSessionChange=="function"&&r.handleSessionChange(a,f)}).catch(s=>{console.warn("[notes-sync] Failed to get initial Supabase session on mobile:",s)}))}(()=>{let r=document.getElementById("headerMenuBtn")||document.getElementById("overflowMenuBtn")||document.getElementById("headerMenuBtnSlim"),n=document.getElementById("headerMenu")||document.getElementById("overflowMenu")||document.getElementById("headerMenuSlim");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;r.dataset.overflowMenuHandled="mobile-js";let i='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',s=r,f=p=>{if(!(p instanceof HTMLElement)||p.getAttribute("aria-hidden")==="true"||p.hasAttribute("disabled")||p.tabIndex<0)return!1;let b=p.getBoundingClientRect();return b.width>0||b.height>0},a=()=>Array.from(n.querySelectorAll(i)).filter(f),m=()=>{let p=n.classList.contains("hidden");n.setAttribute("aria-hidden",p?"true":"false")};m();let I=p=>{!n.contains(p.target)&&p.target!==r&&z({restoreFocus:!1})},L=()=>{let[p]=a();if(p instanceof HTMLElement)try{p.focus()}catch{}},H=()=>{n.classList.contains("hidden")&&(s=document.activeElement instanceof HTMLElement?document.activeElement:r,n.classList.remove("hidden"),r.setAttribute("aria-expanded","true"),m(),document.addEventListener("focusin",I),!n.contains(document.activeElement)&&L())},z=({restoreFocus:p=!0}={})=>{if(!n.classList.contains("hidden")&&(n.classList.add("hidden"),r.setAttribute("aria-expanded","false"),m(),document.removeEventListener("focusin",I),p&&s instanceof HTMLElement))try{s.focus()}catch{}},U=p=>{let b=document.documentElement;if(b){p?b.setAttribute("data-theme",p):b.removeAttribute("data-theme");try{window.localStorage?.setItem("mc-theme",p||"")}catch{}}},V=p=>{let b=document.body;b&&(b.classList.remove("layout-cozy","layout-compact"),p&&b.classList.add(`layout-${p}`))};r.addEventListener("click",p=>{p.stopPropagation(),n.classList.contains("hidden")?H():z()}),document.addEventListener("click",p=>{p.target===r||n.contains(p.target)||z({restoreFocus:!1})}),document.addEventListener("keydown",p=>{if(p.key==="Escape"){z();return}p.key==="ArrowDown"&&!n.classList.contains("hidden")&&(p.preventDefault(),L())});let q=p=>{let b=p.target;return b instanceof Element?b.closest("[data-menu-action]"):null},x=p=>{let b=q(p);if(!b)return;p.stopPropagation();let A=b.getAttribute("data-menu-action");if(A){switch(A){case"completed":case"completed-reminders":{let v=document.querySelector('[data-reminders-tab="completed"]')||document.querySelector('[data-reminders-filter="completed"]');v instanceof HTMLElement?v.click():window.remindersController&&typeof window.remindersController.setFilter=="function"?window.remindersController.setFilter("completed"):typeof window.setMobileRemindersFilter=="function"&&window.setMobileRemindersFilter("completed");break}case"settings":{let v=document.querySelector('[data-open="settings"]');v instanceof HTMLElement&&v.click();break}case"saved-notes":{try{if(typeof window.showSavedNotesSheet=="function")window.showSavedNotesSheet();else{let v=document.getElementById("openSavedNotesGlobal")||document.getElementById("openSavedNotesSheetButton")||document.getElementById("openSavedNotesSheet")||document.getElementById("savedNotesShortcut")||document.querySelector(".open-saved-notes-global");v instanceof HTMLElement&&v.click()}}catch(v){console.warn("[overflow-menu] failed to open saved notes sheet",v)}break}case"sign-in":{let v=document.getElementById("googleSignInBtn");v instanceof HTMLElement?v.click():typeof window.startSignInFlow=="function"&&window.startSignInFlow();break}case"sign-out":{let v=document.getElementById("googleSignOutBtn");v instanceof HTMLElement?v.click():window.__supabaseAuth&&window.__supabaseAuth.supabase&&window.__supabaseAuth.supabase.auth&&typeof window.__supabaseAuth.supabase.auth.signOut=="function"&&window.__supabaseAuth.supabase.auth.signOut().catch(()=>{});break}case"sync-all":case"sync-now":{let v=document.getElementById("syncAll");v instanceof HTMLElement?v.click():window.remindersController&&typeof window.remindersController.syncAll=="function"?window.remindersController.syncAll().catch(()=>{}):typeof window.syncAllReminders=="function"&&window.syncAllReminders();break}case"theme-light":U("light");break;case"theme-dark":U("dark");break;case"theme-professional-dark":U("professional-dark");break;case"layout-cozy":V("cozy");break;case"layout-compact":V("compact");break;case"about":{let v=document.querySelector('[data-open="about"]')||document.getElementById("aboutMemoryCueBtn");v instanceof HTMLElement?v.click():typeof window.showAboutMemoryCue=="function"&&window.showAboutMemoryCue();break}default:break}try{z()}catch{}}};n instanceof HTMLElement&&n.addEventListener("click",x),n.addEventListener("click",p=>{p.stopPropagation(),p.target instanceof HTMLElement&&p.target.closest("button")&&z({restoreFocus:!1})}),n.addEventListener("keydown",p=>{if(p.key!=="Tab")return;let b=a();if(!b.length)return;let A=b.indexOf(document.activeElement),v=b.length-1,D=A;p.shiftKey?D=A<=0?v:A-1:D=A===v?0:A+1,p.preventDefault();let Z=b[D]||b[0];if(Z instanceof HTMLElement)try{Z.focus()}catch{}})})();(()=>{let r=document.getElementById("voiceAddBtn");if(!(r instanceof HTMLElement))return;let n=()=>{let f=document.getElementById("startVoiceCaptureGlobal")||document.getElementById("quickAddVoice");return f instanceof HTMLElement?f:null},i=()=>{let f=n();if(!f)return;let a=()=>{f.hasAttribute("disabled")||f.getAttribute("aria-disabled")==="true"?(r.setAttribute("disabled","true"),r.setAttribute("aria-disabled","true")):(r.removeAttribute("disabled"),r.removeAttribute("aria-disabled"));let I=f.getAttribute("title");I&&r.setAttribute("title",I)};a(),typeof MutationObserver=="function"&&new MutationObserver(a).observe(f,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i();let s=()=>{let f=n();if(f&&!(f.hasAttribute("disabled")||f.getAttribute("aria-disabled")==="true")){try{f.focus({preventScroll:!0})}catch{try{f.focus()}catch{}}try{f.click()}catch(a){console.warn("Voice add trigger failed",a)}}};r.addEventListener("click",f=>{f.preventDefault();let a=!1,m=null,I=()=>{a||(a=!0,document.removeEventListener("reminder:sheet-opened",L),s())},L=z=>{if(z?.detail?.trigger!==r)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&m&&(window.clearTimeout(m),m=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(I,150)};document.addEventListener("reminder:sheet-opened",L);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:r}}))}catch(z){document.removeEventListener("reminder:sheet-opened",L),typeof window<"u"&&typeof window.clearTimeout=="function"&&m&&(window.clearTimeout(m),m=null),console.warn("Voice add open failed",z);return}let H=document.getElementById("create-sheet");H instanceof HTMLElement&&H.classList.contains("open")&&(m=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(I,120))})})();(()=>{let r=document.getElementById("toggleReminderFilters"),n=document.getElementById("reminderFilters");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;let i=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],s=()=>{let a=n.hasAttribute("open");r.setAttribute("aria-expanded",String(a)),r.classList.toggle("btn-active",a)},f=()=>{for(let a of i){let m=n.querySelector(a);if(m instanceof HTMLElement&&!m.hasAttribute("disabled")){try{m.focus({preventScroll:!0})}catch{m.focus()}return}}};r.addEventListener("click",()=>{let a=n.hasAttribute("open");n.open=!a,a||f(),s()}),n.addEventListener("toggle",s),s()})();(()=>{let r=document.getElementById("create-sheet");if(!(r instanceof HTMLElement))return;function n(){!r.classList.contains("open")&&r.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",n),document.addEventListener("reminders:updated",n)})();document.addEventListener("memoryCue:remindersUpdated",r=>{let n=document.getElementById("totalCount");if(!n)return;let i=Array.isArray(r?.detail?.items)?r.detail.items.length:0;n.textContent=String(i)});document.addEventListener("click",r=>{try{let n=r.target;if(!n)return;if(n instanceof HTMLElement&&n.id==="saveReminder"||n instanceof Element&&n.closest&&n.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:n});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let r=document.getElementById("reminderList");if(!r)return;let n=Array.from(r.children);if(n.length<=30)return;let i=20;r.innerHTML="";let s=0;function f(){let I=n.slice(s,s+i);I.forEach(L=>r.appendChild(L)),s+=I.length}f();let a=document.createElement("div");a.id="listSentinel",r.appendChild(a);let m=new IntersectionObserver(I=>{I.some(L=>L.isIntersecting)&&s<n.length&&(f(),s>=n.length&&m.disconnect())});m.observe(a)})();(function(){let r=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(a=>a instanceof HTMLElement),n=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!r.length||!n||!i)return;function s(){n.classList.remove("hidden")}function f(){n.classList.add("hidden")}r.forEach(a=>{a.addEventListener("click",s)}),i.addEventListener("click",f),n.addEventListener("click",a=>{a.target instanceof HTMLElement&&a.target.matches("[data-close]")&&f()}),n.addEventListener("keydown",a=>{a.key==="Escape"&&f()})})();(function(){let r=document.getElementById("syncStatus"),n=document.getElementById("mcStatus"),i=document.getElementById("mcStatusText"),s=document.getElementById("syncUrl"),f=document.getElementById("saveSyncSettings"),a=document.getElementById("testSync"),m=document.getElementById("syncAll"),I="syncUrl";if(!i)return;let L=["online","offline","error"],H=["online","offline"],z={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},U={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},V=null;function q(u){if(!n)return;H.forEach(B=>n.classList.remove(B));let w=u!=="offline"&&u!=="error";n.classList.add(w?"online":"offline"),n.setAttribute("aria-label",w?"Online":"Offline")}function x(u,w){V=u,L.forEach(E=>i.classList.remove(E)),r&&L.forEach(E=>r.classList.remove(E)),u==="online"?(i.classList.add("online"),r&&r.classList.add("online")):u==="error"?(i.classList.add("error"),r&&r.classList.add("error")):(i.classList.add("offline"),r&&r.classList.add("offline"));let B=typeof w=="string"&&w.trim()?w.trim():z[u]||"",d=typeof w=="string"&&w.trim()?w.trim():U[u]||B,h=B||d||"";i.textContent=h,h?(i.setAttribute("title",h),i.setAttribute("aria-label",h)):(i.removeAttribute("title"),i.removeAttribute("aria-label")),q(u),i.dataset.state=u}function p(){V!=="syncing"&&x(navigator.onLine?"online":"offline")}function b(u){typeof localStorage>"u"||(u?localStorage.setItem(I,u):localStorage.removeItem(I))}function A(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(I)||""}catch{return""}}function v(u){if(!u||typeof u!="object")return null;let w=u.id||u.uid||u.key||u.slug||u.uuid,B=typeof u.title=="string"&&u.title.trim()?u.title.trim():typeof u.name=="string"?u.name.trim():"";if(!B)return null;let d=typeof u.dueIso=="string"&&u.dueIso?u.dueIso:typeof u.due=="string"?u.due:null,h=typeof u.priority=="string"&&u.priority.trim()?u.priority.trim():u.level||u.importance||"Medium",E=typeof u.category=="string"&&u.category.trim()?u.category.trim():u.group||u.bucket||"General",S=typeof u.done=="boolean"?u.done:!!(u.completed||u.isDone||u.status==="done");return{id:w||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:B,dueIso:d&&d.trim()?d.trim():null,priority:h,category:E,done:S}}function D(){let u=Array.from(document.querySelectorAll("[data-reminder]"));return u.length?u.map(w=>{let B=w.dataset||{},d=null;if(B.reminder)try{d=JSON.parse(B.reminder)}catch{d=null}let h=d||{id:B.id||B.reminderId||w.getAttribute("data-id")||null,title:B.title||B.reminderTitle||"",dueIso:B.due||B.reminderDue||w.getAttribute("data-due")||null,priority:B.priority||B.reminderPriority||w.getAttribute("data-priority")||"",category:B.category||B.reminderCategory||w.getAttribute("data-category")||"",done:B.done==="true"||B.reminderDone==="true"||w.getAttribute("data-done")==="true"};if(!h.title){let E=w.querySelector("[data-reminder-title], [data-title], h3, h4, strong");E&&(h.title=E.textContent.trim())}if(!h.dueIso){let E=w.querySelector("[data-due], time");if(E){let S=E.getAttribute("datetime")||E.getAttribute("data-due");h.dueIso=S||E.textContent.trim()}}return v(h)}).filter(Boolean):[]}function Z(){if(typeof localStorage>"u")return[];let u=[],w=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(d=>{if(!w.has(d)){w.add(d);try{let h=localStorage.getItem(d);if(!h)return;let E=JSON.parse(h);Array.isArray(E)?E.forEach(S=>u.push(S)):E&&typeof E=="object"&&(Array.isArray(E.items)&&E.items.forEach(S=>u.push(S)),Array.isArray(E.reminders)&&E.reminders.forEach(S=>u.push(S)))}catch{}}}),!u.length)for(let d=0;d<localStorage.length;d+=1){let h=localStorage.key(d);if(!(!h||w.has(h)||!/remind/i.test(h))){w.add(h);try{let E=localStorage.getItem(h);if(!E)continue;let S=JSON.parse(E);Array.isArray(S)?S.forEach(re=>u.push(re)):S&&typeof S=="object"&&(Array.isArray(S.items)&&S.items.forEach(re=>u.push(re)),Array.isArray(S.reminders)&&S.reminders.forEach(re=>u.push(re)))}catch{}}}return u.map(v).filter(Boolean)}function te(){let u=D();return u.length?u:Z()}function T(u){u?(m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled"),a?.setAttribute("aria-busy","true"),a?.setAttribute("disabled","disabled")):(m?.removeAttribute("aria-busy"),a?.removeAttribute("aria-busy"),O())}function O(){!!((s?.value||"").trim()||A())?(m?.removeAttribute("disabled"),a?.removeAttribute("disabled")):(m?.setAttribute("disabled","disabled"),a?.setAttribute("disabled","disabled"))}let G=A();s&&G&&(s.value=G),O(),x(navigator.onLine?"online":"offline"),window.addEventListener("online",p),window.addEventListener("offline",p),s?.addEventListener("input",O),f?.addEventListener("click",()=>{let u=(s?.value||"").trim();if(!u){b(""),x("info","Sync URL cleared. Add one to enable sync."),O();return}try{let w=new URL(u);if(!/^https?:/.test(w.protocol))throw new Error("Invalid protocol")}catch{x("error","Enter a valid sync URL before saving.");return}b(u),x("online","Sync settings saved."),O()}),a?.addEventListener("click",async()=>{let u=(s?.value||A()).trim();if(!u){x("error","Add your sync URL in Settings first.");return}T(!0),x("syncing","Testing connection\u2026");try{(await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?x("online","Connection looks good."):x("error","Test failed. Check your Apps Script deployment.")}catch(w){console.error("Test sync failed",w),x("error","Test failed. Check your Apps Script deployment.")}finally{T(!1)}}),m?.addEventListener("click",async()=>{let u=(s?.value||A()).trim();if(!u){x("error","Add your sync URL in Settings first.");return}let w=te();if(!w.length){x("info","Nothing to sync right now.");return}T(!0),x("syncing",`Syncing ${w.length} reminder${w.length===1?"":"s"}\u2026`);let B=20,d=0,h=0,E=S=>({id:S.id,title:S.title,dueIso:S.dueIso||null,priority:S.priority||"Medium",category:S.category||"General",done:!!S.done,source:"memory-cue-mobile"});try{for(let S=0;S<w.length;S+=B){let re=w.slice(S,S+B);(await Promise.allSettled(re.map(ce=>fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E(ce))})))).forEach(ce=>{ce.status==="fulfilled"&&ce.value?.ok?d+=1:(ce.status,h+=1)}),await new Promise(ce=>setTimeout(ce,300))}h?d?x("error",`Partial sync: ${d} success, ${h} failed.`):x("error","Sync failed. Check your sync URL and retry."):x("online",`Sync complete. ${d} updated.`)}catch(S){console.error("Sync failed",S),x("error","Sync failed. Try again soon.")}finally{T(!1)}})})()});export default wo();
