import{b as an,c as gr}from"./chunk-QHE5AMPX.js";import{a as Di,b as _n,c as hr}from"./chunk-GUVSRPRW.js";function Ri(r={}){try{Object.assign(U,r||{})}catch(i){console.warn("[supabase-auth] setAuthContext failed",i)}}async function Fi(r={}){try{if(U&&typeof U.signInWithPopup=="function"&&U.auth&&typeof U.GoogleAuthProvider=="function")return U.signInWithPopup(U.auth,new U.GoogleAuthProvider);if(U&&typeof U.signInWithRedirect=="function"&&U.auth&&typeof U.GoogleAuthProvider=="function")return U.signInWithRedirect(U.auth,new U.GoogleAuthProvider);let i=an();if(i&&i.auth){if(typeof i.auth.signInWithOAuth=="function")return i.auth.signInWithOAuth({provider:"google",...r});if(typeof i.auth.signIn=="function")return i.auth.signIn({provider:"google"})}}catch(i){console.error("[supabase-auth] startSignInFlow error",i);try{U?.toast?.("Sign-in failed")}catch(d){console.warn("[supabase-auth] toast handler failed",d)}throw i}return Promise.resolve(null)}async function Bi(){try{if(U&&typeof U.signOut=="function")return U.signOut(U.auth);let r=an();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function br(r){return r?Array.isArray(r)?r:[r]:[]}function wt(r){return Array.from(new Set(r.filter(i=>i instanceof HTMLElement||typeof SVGElement<"u"&&i instanceof SVGElement)))}function le(r,i){let d=br(i).filter(Boolean);if(!d.length)return[];let h=d.flatMap(T=>Array.from(r.querySelectorAll(T)));return wt(h)}function vr(r,i=document){let d=i instanceof Document||i instanceof HTMLElement?i:document;return{authForms:le(d,r.authForm),emailInputs:le(d,r.emailInput),signInButtons:le(d,r.signInButtons),signOutButtons:le(d,r.signOutButtons),userBadges:le(d,r.userBadge),userBadgeEmails:le(d,r.userBadgeEmail),userBadgeInitials:le(d,r.userBadgeInitial),userNameEls:le(d,r.userName),syncStatusEls:le(d,r.syncStatus),syncStatusTextEls:le(d,r.syncStatusText),statusIndicatorEls:le(d,r.statusIndicator),feedbackEls:le(d,r.feedback)}}function yt(r,i){wt(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.classList.toggle("hidden",!i),i?d.removeAttribute("hidden"):d.setAttribute("hidden",""))})}function Fe(r,i){wt(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.textContent=i||"")})}function wr(r,i){wt(r).forEach(d=>{d instanceof HTMLElement&&(d.dataset.state=i,d.classList.toggle("online",i==="online"),d.classList.toggle("offline",i!=="online"))})}function vt(r,i){wt(r).forEach(d=>{if(!(d instanceof HTMLElement))return;d.textContent=i||"";let h=!!i;d.classList.toggle("hidden",!h),h?d.removeAttribute("hidden"):d.setAttribute("hidden","")})}function Mi(r={}){let i={...Ni.syncStatusText,...r.syncStatusText||{}};return{...Ni,...r,syncStatusText:i}}function bt(r,{user:i,messages:d}={}){let h=Mi(d),T=!!i;yt(r.signInButtons,!T),yt(r.authForms,!T),yt(r.signOutButtons,T),yt(r.userBadges,T);let x=typeof i?.email=="string"?i.email:"",B=x?x.charAt(0).toUpperCase():"U";T?(Fe(r.userBadgeEmails,x),Fe(r.userBadgeInitials,B),Fe(r.userNameEls,x)):(Fe(r.userBadgeEmails,""),Fe(r.userBadgeInitials,""),Fe(r.userNameEls,""));let Q=typeof h.signedIn=="function"?h.signedIn(i):h.signedIn,C=typeof h.signedOut=="function"?h.signedOut(i):h.signedOut,Z=T?Q:C,re=!T;r.syncStatusEls.length&&(Fe(r.syncStatusEls,Z),r.syncStatusEls.forEach(we=>{we instanceof HTMLElement&&(we.classList.toggle("online",T),we.dataset.state=T?"online":"offline")}),yt(r.syncStatusEls,re));let S=T?h.syncStatusText?.signedIn:h.syncStatusText?.signedOut;Fe(r.syncStatusTextEls,S||""),wr(r.statusIndicatorEls,T?"online":"offline"),vt(r.feedbackEls,"")}function Sr(r,i){i.authForms.forEach(d=>{!(d instanceof HTMLFormElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("submit",async h=>{h.preventDefault();let T=i.emailInputs.find(B=>d.contains(B))||d.querySelector('input[type="email"]'),x=typeof T?.value=="string"?T.value.trim():"";if(!x){vt(i.feedbackEls,"Enter an email address to continue.");return}try{let{error:B}=await r.auth.signInWithOtp({email:x});B?vt(i.feedbackEls,B.message||"Unable to send magic link."):vt(i.feedbackEls,"Magic link sent. Check your email.")}catch(B){vt(i.feedbackEls,B?.message||"Unable to send magic link.")}}))})}function Er(r,i){i.signOutButtons.forEach(d=>{!(d instanceof HTMLElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(h){console.error("[supabase] Sign-out failed.",h)}}))})}function Hr(r={}){let{supabase:i,scope:d=document,selectors:h={},messages:T={},disableButtonBinding:x=!1,onSessionChange:B}=r,Q={...yr,...h},C=vr(Q,d),Z=Mi(T);bt(C,{user:null,messages:Z});let re=i||an()||(typeof window<"u"?window.supabase:null);if(!re)return{supabase:null,elements:C,applyAuthState:se=>bt(C,{...se,messages:Z}),destroy(){}};Sr(re,C),x||Er(re,C);let S=[],{data:we}=re.auth.onAuthStateChange((se,fe)=>{if(bt(C,{user:fe?.user??null,messages:Z}),typeof B=="function")try{B(fe?.user??null,fe)}catch(Xe){console.error("[supabase] onSessionChange handler failed.",Xe)}});return we?.subscription&&S.push(()=>{try{we.subscription.unsubscribe()}catch{}}),re.auth.getSession().then(({data:se,error:fe})=>{fe||bt(C,{user:se?.session?.user??null,messages:Z})}).catch(se=>{console.error("[supabase] getSession failed.",se)}),{supabase:re,elements:C,applyAuthState:se=>bt(C,{...se,messages:Z}),destroy(){S.forEach(se=>{try{se()}catch{}})}}}var U,yr,Ni,Oi=_n(()=>{gr();U={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};yr={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},Ni={signedOut:"",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Ui=hr(($r,St)=>{var dn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Pi(r){if(!r||typeof r!="object")return null;let i=Object.entries(r).filter(([d,h])=>typeof h=="string"&&h.trim()!=="");return i.length?Object.fromEntries(i):null}function Tr(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},i=Pi(r?.__FIREBASE_CONFIG);if(i)return i;let d=Pi(r?.__ENV?.FIREBASE_CONFIG);if(d)return d;let T=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((x,[B,Q])=>{let C=r?.__ENV?.[B]??r?.[B];return typeof C=="string"&&C.trim()!==""&&(x[Q]=C),x},{});return Object.keys(T).length?T:null}function Hi(){let r=Tr();return r?{...dn,...r}:{...dn}}var _i={DEFAULT_FIREBASE_CONFIG:dn,getFirebaseConfig:Hi};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=Hi,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=dn}typeof St<"u"&&St.exports&&(St.exports=_i,St.exports.default=_i)});function Lr(){if(ve)return{...ve};let i=Wn()?.memoryCueFirebase;if(i&&typeof i.getFirebaseConfig=="function")return ve=i.getFirebaseConfig(),{...ve};if(typeof Di=="function")try{let d=Ui();if(d){let h=typeof d.getFirebaseConfig=="function"?d.getFirebaseConfig:typeof d.default?.getFirebaseConfig=="function"?d.default.getFirebaseConfig:null;if(h)return ve=h(),{...ve}}}catch{}return i&&i.DEFAULT_FIREBASE_CONFIG?(ve={...i.DEFAULT_FIREBASE_CONFIG},{...ve}):(ve={...Ir},{...ve})}function Wn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Wi(){let r=Wn(),i=r&&r.TimestampTrigger;return typeof i=="function"?i:null}function Ce(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Wi()}function Cr(){if(typeof window>"u"||!window.location)return Hn;try{return new URL(Hn,window.location.href).href}catch{return Hn}}async function Be(){return ln||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(ln=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Cr()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),ln))}async function Vi(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let i=await Be();if(!i)return!1;let d=new Set;navigator.serviceWorker.controller&&d.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(T=>{let x=i[T];x&&d.add(x)});let h=!1;return d.forEach(T=>{try{T.postMessage(r),h=!0}catch(x){console.warn("Failed posting message to service worker",x)}}),h}catch(i){return console.warn("Unable to reach service worker",i),!1}}async function cn(){if(Ce())return!1;if($n)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Et)try{return await Et}catch{}Et=(async()=>{let r=await Be();if(!r)return!1;let i=!1;if("periodicSync"in r)try{let d=await r.periodicSync.getTags();(!Array.isArray(d)||!d.includes(Un))&&await r.periodicSync.register(Un,{minInterval:15*60*1e3}),i=!0}catch(d){console.warn("Periodic background sync unavailable",d)}if(!i&&"sync"in r)try{await r.sync.register(Un),i=!0}catch(d){console.warn("Background sync unavailable",d)}return i})();try{let r=await Et;return r&&($n=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),$n=!1,!1}finally{Et=null}}async function qn(r=[],{requestCheck:i=!1}={}){if(!Ce()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let d=await Be();if(!d)return;let h=await Vi({type:qi.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(i&&await Vi({type:qi.checkScheduledReminders}),!h&&typeof d.update=="function")try{await d.update()}catch{}}catch(d){console.warn("Failed syncing reminders with service worker",d)}}async function Vn(r,i){if(Ce())try{let d=i||await Be();if(!d)return;let h=[];try{h=await d.getNotifications({tag:r,includeTriggered:!0})}catch{h=await d.getNotifications({tag:r})}for(let T of h)try{T.close()}catch{}}catch{}}function Yi(){for(let r of Array.from(Le.values()))try{r.close()}catch{}Le.clear()}function kr(){if(ji||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>Yi();["pagehide","beforeunload"].forEach(i=>{try{window.addEventListener(i,r)}catch{}}),ji=!0}function Y(r){if(typeof r=="string"){let i=r.replace(/\s+/g," ").trim();if(i)return i}return q}async function qr(r={}){let i=e=>e?document.querySelector(e):null,d=e=>e?Array.from(document.querySelectorAll(e)):[],h=i(r.titleSel),T=i(r.dateSel),x=i(r.timeSel),B=i(r.detailsSel),Q=i(r.prioritySel),C=i(r.categorySel),Z=i(r.saveBtnSel),re=i(r.cancelEditBtnSel),S=i(r.listSel),we="reminder-title-pinned",se="reminder-title-unpinned",fe=i(r.detailPanelSel),Xe=i(r.detailEmptySel),un=i(r.detailContentSel),Tt=i(r.detailTitleSel),At=i(r.detailDueSel),It=i(r.detailPrioritySel),Lt=i(r.detailCategorySel),Se=i(r.detailNotesSel),Gn=Se?.dataset?.placeholder||"No notes added yet.",Gi=i(r.detailClearSel),Ct=d(r.googleSignInBtnSel),kt=d(r.googleSignOutBtnSel),P=i(r.statusSel),V=i(r.syncStatusSel),Ki={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Xi=6e3,ae=null,xt=null;function _e(e,{clearMessage:t=!0}={}){ae&&(e&&ae.tokenId!==e||(ae.timeoutId&&clearTimeout(ae.timeoutId),t&&P&&P.dataset.undoToken===ae.tokenId&&(typeof P.replaceChildren=="function"?P.replaceChildren():P.textContent="",delete P.dataset.undoToken,delete P.dataset.statusKind),ae=null))}function zi(e){if(!P)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),o=document.createElement("button");o.type="button",o.textContent="Undo",o.className="status-undo",o.addEventListener("click",()=>rr(e.tokenId)),e.button=o,typeof P.replaceChildren=="function"?P.replaceChildren(t,n,o):(P.textContent="",P.append(t,n,o)),P.dataset.statusKind="undo",P.dataset.undoToken=e.tokenId}function ze(e){if(!fe)return;let t=!!e;if(fe.dataset.state=t?"active":"empty",fe.dataset.selectedId=t&&e?.id?e.id:"",Xe&&(Xe.classList.toggle("hidden",t),Xe.setAttribute("aria-hidden",t?"true":"false")),un&&(un.classList.toggle("hidden",!t),un.setAttribute("aria-hidden",t?"false":"true")),!t){Tt&&(Tt.textContent=""),At&&(At.textContent=""),It&&(It.textContent=""),Lt&&(Lt.textContent=""),Se&&(Se.textContent=Gn,Se.dataset.empty="true");return}if(Tt&&(Tt.textContent=e.title||"Untitled reminder"),At&&(At.textContent=Ei(e)),It&&(It.textContent=e.priority||"Medium"),Lt&&(Lt.textContent=e.category||q),Se){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Se.textContent=n,Se.dataset.empty="false"):(Se.textContent=Gn,Se.dataset.empty="true")}}function Kn(){xt=null,ze(null)}function Ji(e){xt=e?.id||null,ze(e||null)}function Qi(){if(!fe)return;if(!xt){ze(null);return}let e=f.find(t=>t?.id===xt);if(e){ze(e);return}Kn()}ze(null);function fn(e,t){if(!V)return;let n=["online","offline","error"];n.forEach(a=>V.classList.remove(a)),n.includes(e)&&V.classList.add(e),V.dataset.state=e;let o=typeof t=="string"?t:Ki[e]||"";e==="online"||e==="offline"?(V.textContent="",V.dataset.compact="true",o?(V.setAttribute("aria-label",o),V.setAttribute("title",o)):(V.removeAttribute("aria-label"),V.removeAttribute("title"))):(V.textContent=o,V.removeAttribute("data-compact"),o?(V.setAttribute("aria-label",o),V.setAttribute("title",o)):(V.removeAttribute("aria-label"),V.removeAttribute("title")))}let X=i(r.notesSel),Zi=i(r.saveNotesBtnSel),eo=i(r.loadNotesBtnSel),Xn=i(r.countTotalSel),Dt=i(r.googleUserNameSel),Me=i(r.dateFeedbackSel),ee=i(r.voiceBtnSel),to=i(r.notifBtnSel),Je=i(r.moreBtnSel),Qe=i(r.moreMenuSel),no=i(r.copyMtlBtnSel),pn=i(r.importFileSel),io=i(r.exportBtnSel),oo=i(r.syncAllBtnSel),He=i(r.syncUrlInputSel),ro=i(r.saveSettingsSel),so=i(r.testSyncSel),ao=d(r.openSettingsSel),Nt=i(r.settingsSectionSel),Ue=i(r.emptyStateSel),zn=i(r.listWrapperSel),mn=i(r.categoryOptionsSel),z=i(r.plannerContextSel),$=i(r.plannerLessonInputSel),te=r.variant||"mobile",lo=typeof r.autoWireAuthButtons=="boolean"?r.autoWireAuthButtons:te!=="desktop",Ze="all",hn=[],gn="";function co(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function $e(){if(te!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=co(),n;Ze==="today"?n=`Today\u2019s reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,gn&&(n+=` \u2022 ${gn}`),e.textContent=n}function uo(){te==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,o=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(o).then(s=>{if(!s.ok)throw new Error("Weather request failed");return s.json()}).then(s=>{s&&s.current_weather&&typeof s.current_weather.temperature=="number"&&(gn=`${Math.round(s.current_weather.temperature)}\xB0C`,$e())}).catch(s=>{console.warn("Failed to fetch current temperature",s)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let Jn="mc:lastDefaults",yn=()=>{z&&(z.classList.add("hidden"),z.setAttribute("aria-hidden","true"),typeof z.replaceChildren=="function"?z.replaceChildren():z.textContent=""),$&&($.value="",$.dataset&&(delete $.dataset.lessonDayLabel,delete $.dataset.lessonTitle,delete $.dataset.lessonSummary))},fo=(e={})=>{if(!z)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",o=typeof e.summary=="string"?e.summary.trim():"",s=document.createElement("p");s.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",s.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||o||"Planner reminder";let l=o?document.createElement("p"):null;l&&(l.className="text-sm text-base-content/70",l.textContent=o),typeof z.replaceChildren=="function"?z.replaceChildren(...[s,a,l].filter(Boolean)):(z.textContent="",z.append(s,a),l&&z.append(l)),z.classList.remove("hidden"),z.removeAttribute("aria-hidden")},po=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";h&&typeof e.reminderTitle=="string"&&(h.value=e.reminderTitle),B&&typeof e.reminderNotes=="string"&&(B.value=e.reminderNotes),T&&typeof e.dueDate=="string"&&(T.value=e.dueDate),$&&($.value=t,$.dataset&&($.dataset.lessonDayLabel=dayLabel,$.dataset.lessonTitle=lessonTitle,$.dataset.lessonSummary=summary)),fo(e)};function bn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Jn)||"{}")||{}}catch{return{}}}function mo(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Jn,JSON.stringify(e))}catch{}}function ho(e){let t=bn(),n={category:Y(e?.category||t.category||q),priority:e?.priority||t.priority||"Medium"};mo(n)}let Qn='fieldset#priorityChips input[name="priority"]';function Rt(){try{let e=document.querySelector(`${Qn}:checked`);if(e&&e.value)return e.value}catch{}return Q&&typeof Q.value=="string"&&Q.value?Q.value:"Medium"}function Ft(e){let t=e||"Medium";Q&&typeof Q.value<"u"&&(Q.value=t);try{let n=Array.from(document.querySelectorAll(Qn));if(!n.length)return;let o=!1;if(n.forEach(s=>{let a=s.value===t;s.checked=a,o=o||a}),!o){let s=n.find(a=>a.value==="Medium")||n[0];s&&(s.checked=!0)}}catch{}}function Zn(){let e=bn();e.category&&C&&(C.value=e.category),e.priority&&Ft(e.priority)}Zn();let G=typeof document<"u"?document.getElementById("quickAddInput"):null,go=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ne=typeof document<"u"?document.getElementById("quickAddVoice"):null,ke=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,vn=null;function yo(e,t){let n=bn(),o=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||Rt(),category:Y(n.category||C?.value||q),notes:"",due:o,pinToToday:!1}}async function Bt(e={}){if(!G)return null;if(typeof vn=="function")try{vn()}catch{}let n=((typeof e.text=="string"?e.text:(G.value||"").trim())||"").trim();if(!n)return null;let s=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,a=null;if(s)a=new Date(s).toISOString();else try{let p=tn(n);p&&p.time&&(a=new Date(`${p.date}T${p.time}:00`).toISOString())}catch{a=null}let l=yo(n,a);if(e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{l.notifyAt=new Date(e.notifyAt).toISOString()}catch{l.notifyAt=null}let c=bi(l,{closeSheet:!1});if(c&&typeof document<"u"){G.value="";try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:c}}))}catch{}}return c||null}typeof window<"u"&&(window.memoryCueQuickAddNow=Bt),go?.addEventListener("click",()=>{Bt()}),G?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Bt())});function bo(){if(typeof HTMLElement>"u"||!(ne instanceof HTMLElement)||!(G instanceof HTMLInputElement)||ne.dataset.voiceBound==="true")return;if(ne.dataset.voiceBound="true",typeof window>"u"){ne.setAttribute("disabled","true"),ne.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ne.setAttribute("disabled","true"),ne.setAttribute("aria-disabled","true"),ne.getAttribute("title")||(ne.title="Voice input is not supported in this browser.");return}let t=null,n=!1,o=l=>{n=l,ne.setAttribute("aria-pressed",l?"true":"false"),ne.dataset.listening=l?"true":"false",ne.classList.toggle("is-listening",l)},s=()=>{if(t)return t;t=new e;let l=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=l,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",p=>{let u=p?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){G.value=u;try{G.focus({preventScroll:!0})}catch{G.focus()}try{let y=G.value.length;typeof G.setSelectionRange=="function"&&G.setSelectionRange(y,y)}catch{}}});let c=()=>{o(!1)};return t.addEventListener("end",c),t.addEventListener("error",c),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}o(!1)}};vn=a,ne.addEventListener("click",()=>{let l=s();if(l){if(n){a();return}try{l.start(),o(!0)}catch(c){console.warn("Quick add voice error:",c),o(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),o(!1)}bo();let ei=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,pe=null,ti=!!ei;ti&&(pe=new ei,pe.lang="en-AU",pe.interimResults=!1,pe.maxAlternatives=1);function vo(){try{if(typeof E=="function"){E("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}ke&&(ti&&pe?ke.addEventListener("click",()=>{try{pe.start(),ke.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):ke.addEventListener("click",()=>{vo()})),pe&&(pe.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Eo(t)}),pe.addEventListener("end",()=>{ke&&ke.classList.remove("is-recording")}),pe.addEventListener("error",()=>{ke&&ke.classList.remove("is-recording")}));function wo(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function So(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),o=new Date,s=new Date(o);if(n.includes("tomorrow"))s.setDate(s.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let l=parseInt(a[1],10),c=a[2]?parseInt(a[2],10):0,p=a[3];p||(/\b(p\.?m\.?|p m)\b/.test(n)?p="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(p="am")),p==="pm"&&l<12&&(l+=12),p==="am"&&l===12&&(l=0),s.setHours(l,c,0,0);let u=new Date(s),y=new Date(u.getTime()-10*60*1e3);return t.dueDate=u,t.notifyAt=y,t}function Eo(e){if(!e||!G)return;let t=wo(e),{dueDate:n,notifyAt:o}=So(e);G.value=t,Bt({text:t,dueDate:n,notifyAt:o})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&G&&(e.preventDefault(),G.focus())})));try{te==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let To=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",ni=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Ao=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Mt=r.reminderLandingPath||(te==="desktop"?"index.html#reminders":"mobile.html"),de=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function ii(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function et(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:f}}))}catch{}}C&&!C.value&&(C.value=q),Ce()&&Be();function Ee(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let o=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),o=!0)}catch{o=!1}if(!o){if(typeof window<"u"){let s=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(s.push(n);s.length>20;)s.shift();window.memoryCueActivityQueue=s}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent($i,{detail:n}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent($i,!1,!1,n),document.dispatchEvent(s))}}catch{}}}function Io(){if(typeof HTMLElement>"u"||!(ee instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&h instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&h instanceof HTMLTextAreaElement;if(!e&&!t||ee.dataset.voiceBound==="true")return;if(ee.dataset.voiceBound="true",typeof window>"u"){ee.setAttribute("disabled","true"),ee.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ee.setAttribute("disabled","true"),ee.setAttribute("aria-disabled","true"),ee.getAttribute("title")||(ee.title="Voice input is not supported in this browser.");return}let o=null,s=!1,a=u=>{s=u,ee.setAttribute("aria-pressed",u?"true":"false"),ee.dataset.listening=u?"true":"false",ee.classList.toggle("is-listening",u)},l=()=>{if(o)return o;o=new n,o.lang="en-US",o.interimResults=!1,o.maxAlternatives=1,o.addEventListener("result",y=>{let A=y.results?.[0]?.[0]?.transcript?.trim()||"";if(A){h.value=A;try{h.focus({preventScroll:!0})}catch{try{h.focus()}catch{}}try{let I=h.value.length;typeof h.setSelectionRange=="function"&&h.setSelectionRange(I,I)}catch{}Ee({action:"dictated",label:`Voice input captured \xB7 ${A}`})}});let u=()=>{a(!1)};return o.addEventListener("end",u),o.addEventListener("error",u),o},c=()=>{if(!(!s||!o)){try{o.stop()}catch{}a(!1)}};ee.addEventListener("click",()=>{let u=l();if(u){if(s){c();return}try{u.start(),a(!0)}catch(y){console.warn("Speech recognition error:",y),a(!1)}}});let p=()=>{c()};typeof document<"u"&&(document.addEventListener("cue:close",p),document.addEventListener("reminders:updated",p)),a(!1)}kr(),Io();let Ot,Pt,_t,Ht,je,Ut,$t,jt,qt,Vt,Wt,tt,nt,Yt,Gt,wn,Sn,Kt,En,oi=r.firebaseDeps,Tn=typeof r.importModule=="function"?r.importModule:e=>import(e),it=Wn(),ot=!1,me=!1,An=null,Te=null,rt=null,f=[],qe=!1,J=null,st=null,Ve=null,at=null,Xt=null,Oe={},Pe={},W={},ri=typeof document<"u"?document.getElementById("createSheetTitle"):null,si=()=>{h instanceof HTMLElement&&setTimeout(()=>{try{h.focus()}catch{}},0)},We=(e,t=null)=>{at=e||null,Xt=t||null,Ve=at==="edit"?Xt:null,ri instanceof HTMLElement&&(ri.textContent=at==="edit"?"Edit reminder":"New reminder")};function ce(e=f){Array.isArray(e)&&e.sort((t,n)=>{let o=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,s=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return o===s?pi(t||{},n||{}):s-o})}function Lo(e=f){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(o=>{let s=Number.isFinite(o?.orderIndex)?o.orderIndex:null;s!=null&&(s<t&&(t=s),s>n&&(n=s))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function dt(e=f){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(o=>Number.isFinite(o?.orderIndex)),n;if(t)n=e.slice(),ce(n);else{n=e.slice().sort(pi);let o=n.length;n.forEach((s,a)=>{s.orderIndex=(o-a)*be})}return e===f&&(f=n),n}function ai(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:o}=Lo();if(t==="end"){let s=Number.isFinite(n)?n:0;e.orderIndex=s-be||be}else{let s=Number.isFinite(o)?o:0;e.orderIndex=s+be||be}}function zt(e=f){if(!Array.isArray(e)||e.length<2)return!1;ce(e);let t=!1;for(let n=1;n<e.length;n+=1){let o=e[n-1],s=e[n],a=Number.isFinite(o?.orderIndex)?o.orderIndex:null,l=Number.isFinite(s?.orderIndex)?s.orderIndex:null;if(a==null||l==null||a<=l||a-l<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*be;return e===f&&ce(f),!0}let D={draggingId:null,dropTargetId:null,dropBefore:!0},di=!1,g={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Co(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function lt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function xe(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function In(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),xe(),D.draggingId=null,D.dropTargetId=null,D.dropBefore=!0}function li(e,t,n){if(!e||e===t)return;let o=f.findIndex(I=>I?.id===e);if(o<0)return;let[s]=f.splice(o,1),a;if(!t)a=f.length;else{let I=f.findIndex(_=>_?.id===t);if(I<0){f.splice(o,0,s);return}a=n?I:I+1}f.splice(a,0,s);let l=f[a-1],c=f[a+1],p=Number.isFinite(l?.orderIndex)?l.orderIndex:null,u=Number.isFinite(c?.orderIndex)?c.orderIndex:null,y;p!=null&&u!=null?y=(p+u)/2:p!=null?y=p-be:u!=null?y=u+be:y=be,Number.isFinite(y)||(y=be*(f.length+1)),s.orderIndex=y,ce(f);let A=zt(f);qe=!0,j(),K(),A?f.forEach(I=>ie(I)):ie(s),et(),de("memoryCue:remindersUpdated",{items:f}),Ee({action:"reordered",label:"Reminders reordered"})}function ko(e){let t=lt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let o=t.dataset.id;if(o&&(D.draggingId=o,D.dropTargetId=null,D.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",o)}catch{}}function xo(e){if(!D.draggingId)return;let t=lt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),D.dropTargetId=null,D.dropBefore=!1,xe(),S?.classList.add("drag-over-list");return}if(t.dataset.id===D.draggingId){e.preventDefault(),xe();return}e.preventDefault();let n=t.getBoundingClientRect(),o=n.top+n.height/2,s=e.clientY<o;(D.dropTargetId!==t.dataset.id||D.dropBefore!==s)&&(xe(),t.classList.add(s?"drag-over-before":"drag-over-after"),D.dropTargetId=t.dataset.id,D.dropBefore=s)}function Do(e){let t=lt(e.target);if(!t){S?.contains(e.relatedTarget)||xe();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function No(e){if(!D.draggingId)return;e.preventDefault();let t=lt(e.target),n=t?.dataset.id||null,o=D.dropBefore;if(t){let s=t.getBoundingClientRect(),a=s.top+s.height/2;o=e.clientY<a}else n=null,o=!1;li(D.draggingId,n,o),In()}function Ro(){In()}function Fo(){!S||di||(di=!0,S.addEventListener("dragstart",ko),S.addEventListener("dragover",xo),S.addEventListener("drop",No),S.addEventListener("dragend",Ro),S.addEventListener("dragleave",Do),Jt())}function Jt(){if(!S||Jt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Jt._bound=!0;return}let t=6,n=160;function o(){g.longPressTimer&&(clearTimeout(g.longPressTimer),g.longPressTimer=null)}function s(){S&&(g.initialTouchAction!=null?S.style.touchAction=g.initialTouchAction:S.style.removeProperty("touch-action"))}function a({keepHighlights:w=!1}={}){if(o(),g.item&&g.pointerId!=null)try{g.item.hasPointerCapture?.(g.pointerId)&&g.item.releasePointerCapture(g.pointerId)}catch{}if(g.placeholder?.parentNode)try{g.placeholder.parentNode.removeChild(g.placeholder)}catch{}g.item&&(g.item.classList.remove("is-dragging"),g.originalStyles?g.item.setAttribute("style",g.originalStyles):g.item.removeAttribute("style")),s(),w||xe(),Object.assign(g,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function l(w){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(b=>b!==w):[]}function c(w){let b=g.item;if(!b||g.ready)return;let k=b.getBoundingClientRect(),O=window.getComputedStyle(b);g.ready=!0,D.draggingId=b.dataset.id||null,g.offsetY=w.clientY-k.top,g.fixedX=k.left;let R=document.createElement("div");R.className="touch-drag-placeholder",R.setAttribute("aria-hidden","true"),R.style.height=`${k.height}px`,R.style.boxSizing="border-box",R.style.marginTop=O.marginTop,R.style.marginBottom=O.marginBottom,R.style.marginLeft=O.marginLeft,R.style.marginRight=O.marginRight,R.style.borderRadius=O.borderRadius,R.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",R.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",R.style.pointerEvents="none",R.style.display="block",R.style.width="100%",b.parentNode?.insertBefore(R,b),g.placeholder=R,g.longPressTimer=null,g.originalStyles=b.getAttribute("style")||"",b.classList.add("is-dragging"),b.style.position="fixed",b.style.left=`${k.left}px`,b.style.top=`${k.top}px`,b.style.width=`${k.width}px`,b.style.zIndex="999",b.style.pointerEvents="none",b.style.touchAction="none",g.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function p(w){let b=g.item;if(!b||!g.ready)return;let k=w-g.offsetY;b.style.top=`${k}px`,b.style.left=`${g.fixedX}px`}function u(w){if(!g.ready||!S)return;let b=g.item,k=l(b);if(xe(),!k.length){D.dropTargetId=null,D.dropBefore=!1;return}let O=null,R=!1;for(let m of k){let v=m.getBoundingClientRect(),M=v.top+v.height/2;if(w<M){O=m,R=!0;break}}if(!O){O=k[k.length-1];let m=O.getBoundingClientRect(),v=m.top+m.height/2;R=w<v,R||(R=!1)}if(!O){D.dropTargetId=null,D.dropBefore=!1;return}let ge=O.getBoundingClientRect(),Mn=ge.top+ge.height/2,ft=w<Mn;O.classList.add(ft?"drag-over-before":"drag-over-after"),D.dropTargetId=O.dataset.id||null,D.dropBefore=ft}function y(w){let b=D.draggingId,k=g.moved;if(!g.ready){a();return}a(),!w&&k&&b&&li(b,D.dropTargetId,D.dropBefore),In()}function A(w){let b=w.pointerType||"";if(b&&b!=="touch"&&b!=="pen"||g.active)return;let k=lt(w.target);if(!k)return;let O=Co(w.target);if(!(O&&O!==k)){g.active=!0,g.pointerId=w.pointerId,g.item=k,g.startX=w.clientX,g.startY=w.clientY,g.lastClientX=w.clientX,g.lastClientY=w.clientY,g.moved=!1,g.ready=!1,g.originalStyles=k.getAttribute("style")||"",g.startTime=w.timeStamp||Date.now(),D.dropTargetId=null,D.dropBefore=!0,D.draggingId=null,o(),g.longPressTimer=setTimeout(()=>{c({clientY:g.lastClientY})},n);try{k.setPointerCapture(w.pointerId)}catch{}}}function I(w){if(!g.active||w.pointerId!==g.pointerId)return;let b=w.pointerType||"";if(!(b&&b!=="touch"&&b!=="pen")){if(g.lastClientX=w.clientX,g.lastClientY=w.clientY,!g.ready){let k=Math.abs(w.clientX-g.startX),O=Math.abs(w.clientY-g.startY);if(k>t||O>t){let R=typeof w.timeStamp=="number"?w.timeStamp:Date.now();Math.abs(R-g.startTime)>=n?(o(),c({clientY:g.lastClientY})):a()}return}w.preventDefault(),g.moved=!0,p(w.clientY),u(w.clientY)}}function _(w){!g.active||w.pointerId!==g.pointerId||y(!1)}function ue(w){!g.active||w.pointerId!==g.pointerId||y(!0)}S.addEventListener("pointerdown",A),window.addEventListener("pointermove",I),window.addEventListener("pointerup",_),window.addEventListener("pointercancel",ue),Jt._bound=!0}function ci(){J=null,fn("offline"),Ct.forEach(e=>e.classList.remove("hidden")),kt.forEach(e=>e.classList.add("hidden")),Dt&&(Dt.textContent=""),st?.(),st=null,Cn(),j(),K(),Re()}function Ln(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(jn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let o=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),s=Number.isFinite(n.updatedAt)?n.updatedAt:o,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:kn(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:Y(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:o,updatedAt:s,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Bo(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(jn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:Y(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(jn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function K(){ce(f),Bo(f)}function Cn(){f=dt(Ln())}Cn();async function Mo(){if(!J){f=Ln();return}let e=dt(Ln());if(!e.length){f=[],K();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await ie(n),n.pendingSync=!1}catch(o){console.warn("Failed to sync offline reminder",o)}f=dt(e.map(n=>({...n,pendingSync:!1}))),K(),j(),Re()}try{W=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{W={}}if(W&&typeof W=="object"&&Object.values(W).forEach(e=>{e&&typeof e=="object"&&(e.category=Y(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:ct(e),e.urlPath=e.urlPath||Mt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Ce()){let e=Si();typeof Notification<"u"&&Notification.permission==="granted"?(cn(),e.length&&qn(e,{requestCheck:!0})):e.length&&qn(e)}let Qt=e=>{if(!it)return;let t=[it];it.window&&!t.includes(it.window)&&t.push(it.window);let n=!e;t.forEach(o=>{try{o.__memoryCueFirebaseUnavailable__=n}catch{}})};function Oo(){if(!X)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",o="mobileNotesColumns",s=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in X?X.value:X.innerHTML,l=y=>{if("value"in X){X.value=y;return}if(typeof y!="string"||y.length===0){X.innerHTML="";return}let A=y.trim();if(/<\/?[a-z][\s\S]*>/i.test(A)){X.innerHTML=y;return}let _=y.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");X.innerHTML=_},c=y=>{y?X.classList.add("notes-editor--columns"):X.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!y))},p="";try{p=localStorage.getItem(n)||""}catch{E("Unable to access saved notes")}l(p);let u=!1;try{u=localStorage.getItem(o)==="1"}catch{u=!1}c(u),X.addEventListener("input",()=>{p=a();try{localStorage.setItem(n,p)}catch{E("Notes saved for this session only")}}),Zi?.addEventListener("click",()=>{p=a();try{localStorage.setItem(n,p),E("Notes saved")}catch{E("Notes saved for this session only")}}),eo?.addEventListener("click",()=>{let y=p;try{y=localStorage.getItem(n)||p}catch{E("Unable to load saved notes")}p=y,l(p)}),e?.addEventListener("click",y=>{let A=y.target;if(!(A instanceof Element))return;let I=A.closest("button[data-action]");if(!I)return;let _=I.getAttribute("data-action");if(_==="columns"){let ue=!X.classList.contains("notes-editor--columns");c(ue);try{localStorage.setItem(o,ue?"1":"0")}catch{E("Column preference saved for this session only")}return}if(!s){E("Formatting controls are not supported in this browser");return}X.focus(),_==="bullets"?document.execCommand("insertUnorderedList"):_==="numbers"&&document.execCommand("insertOrderedList")})}if(Oo(),Z?.addEventListener("click",Li),oi)({initializeApp:Ot,getFirestore:Pt,enableMultiTabIndexedDbPersistence:_t,enableIndexedDbPersistence:Ht,doc:je,setDoc:Ut,deleteDoc:$t,onSnapshot:jt,collection:qt,query:Vt,orderBy:Wt,serverTimestamp:tt,getAuth:nt,onAuthStateChanged:Yt,GoogleAuthProvider:Gt,signInWithPopup:wn,signInWithRedirect:Sn,getRedirectResult:Kt,signOut:En}=oi),ot=!0;else try{({initializeApp:Ot}=await Tn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Pt,enableMultiTabIndexedDbPersistence:_t,enableIndexedDbPersistence:Ht,doc:je,setDoc:Ut,deleteDoc:$t,onSnapshot:jt,collection:qt,query:Vt,orderBy:Wt,serverTimestamp:tt}=await Tn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:nt,onAuthStateChanged:Yt,GoogleAuthProvider:Gt,signInWithPopup:wn,signInWithRedirect:Sn,getRedirectResult:Kt,signOut:En}=await Tn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),ot=!0}catch(e){ot=!1,console.warn("Firebase modules failed to load:",e),E("Firebase failed to load; notes available offline"),Qt(!1)}if(ot&&typeof Ot=="function"&&typeof Pt=="function"&&typeof nt=="function")try{let e=Lr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),An=Ot(e),Te=Pt(An),me=!0,console.info("[Firebase] Firestore initialised",e.projectId),Qt(!0)}catch(e){me=!1,console.warn("Firebase initialization failed:",e),E("Firebase failed to load; notes available offline"),Qt(!1)}else ot?(me=!1,Qt(!1)):me=!1;me&&typeof _t=="function"&&typeof Ht=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await _t(Te),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Ht(Te),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(o){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",o?.code||o)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),me&&typeof nt=="function"&&(rt=nt(An));function Po(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let _o=typeof navigator<"u"&&navigator.language?navigator.language:"",ui=Po(_o),Ye=ui||"en-US",Ae="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Ae=e.timeZone),!ui&&e.locale&&(Ye=e.locale)}catch{}let Ho=new Intl.DateTimeFormat(Ye,{timeZone:Ae,hour:"2-digit",minute:"2-digit"}),Uo=new Intl.DateTimeFormat(Ye,{timeZone:Ae,weekday:"long",day:"numeric",month:"long"}),$o=new Intl.DateTimeFormat("en-CA",{timeZone:Ae,year:"numeric",month:"2-digit",day:"2-digit"}),jo=new Intl.DateTimeFormat(Ye,{timeZone:Ae,weekday:"long"}),qo=new Intl.DateTimeFormat(Ye,{timeZone:Ae,month:"short",day:"numeric"});function De(e){let t=$o.formatToParts(e),n=t.find(a=>a.type==="year").value,o=t.find(a=>a.type==="month").value,s=t.find(a=>a.type==="day").value;return`${n}-${o}-${s}`}function fi(e,t){let[n,o,s]=e.split("-").map(p=>parseInt(p,10)),[a,l]=t.split(":").map(p=>parseInt(p,10)),c=new Date;return c.setFullYear(n,(o||1)-1,s||1),c.setHours(a||0,l||0,0,0),c.toISOString()}let Vo=new Intl.DateTimeFormat("en-CA",{timeZone:Ae,year:"numeric",month:"2-digit",day:"2-digit"}),Wo=new Intl.DateTimeFormat("en-CA",{timeZone:Ae,hour:"2-digit",minute:"2-digit",hour12:!1});function Yo(e){try{let t=new Date(e),n=Vo.formatToParts(t),o=n.find(l=>l.type==="year")?.value||"0000",s=n.find(l=>l.type==="month")?.value||"00",a=n.find(l=>l.type==="day")?.value||"00";return`${o}-${s}-${a}`}catch{return""}}function Go(e){try{let t=new Date(e),n=Wo.formatToParts(t),o=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",s=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${o}:${s}`}catch{return""}}function kn(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Zt(){return De(new Date)}function Ko(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Fr(e){let t=Ko(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function en(e){return e==="High"?3:e==="Medium"?2:1}function pi(e,t){let n=e?.done?1:0,o=t?.done?1:0;if(n!==o)return n-o;let s=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(s!==a)return s-a;let l=en(t?.priority)-en(e?.priority);return l||(t?.updatedAt||0)-(e?.updatedAt||0)}function Br(e,t){let n=en(t.priority)-en(e.priority);if(n)return n;let o=+new Date(e.due||0),s=+new Date(t.due||0);return o!==s?o-s:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function mi(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Uo.format(t)}catch{return e}}function xn(e){return Ho.format(e)}function Xo(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Mr(e){return e?Xo(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function E(e){P&&(_e(),P.dataset.statusKind="toast",P.textContent=e,clearTimeout(E._t),E._t=setTimeout(()=>{P&&P.dataset.statusKind==="toast"&&(P.textContent="",delete P.dataset.statusKind)},2500))}function zo(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}function tn(e){e=String(e||"").toLowerCase();let t={date:Zt(),time:""},n=c=>{let p=new Date,u=p.getDay(),y=(c-u+7)%7,A=new Date(p);return A.setDate(p.getDate()+(y===0?7:y)),A},o=c=>{let p=new Date,u=p.getDay(),y=(c-u+7)%7,A=new Date(p);return A.setDate(p.getDate()+y),A},s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let c=new Date;c.setDate(c.getDate()+1),t.date=De(c)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=s[c[1]],u=n(p);t.date=De(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=s[c[1]],u=o(p);t.date=De(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=s[c[1]],u=n(p);t.date=De(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let c=e.match(/\bin\s+(\d+)\s+days?\b/),p=parseInt(c[1],10),u=new Date;u.setDate(u.getDate()+p),t.date=De(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let c=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),p=parseInt(c[1],10),u=parseInt(c[2],10)-1,y=c[3]?parseInt(c[3],10):new Date().getFullYear(),A=new Date(y,u,p);t.date=De(A)}else for(let[c,p]of Object.entries(a)){let u=new RegExp(`\\b${c}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let y=e.match(u),A=parseInt(y[1],10),I=new Date().getFullYear(),_=new Date(I,p,A);t.date=De(_);break}}let l=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(l){let c=parseInt(l[1],10),p=l[2]?parseInt(l[2],10):0,u=l[3];u&&(u==="pm"&&c<12&&(c+=12),u==="am"&&c===12&&(c=0)),t.time=`${String(c).padStart(2,"0")}:${String(p).padStart(2,"0")}`}return t}let Dn=me&&rt&&typeof Gt=="function";Ri({authReady:Dn,auth:rt,GoogleAuthProvider:Gt,signInWithPopup:wn,signInWithRedirect:Sn,signOut:En,toast:E});let hi=lo,gi=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let o=t(n);o&&typeof o.then=="function"&&o.catch(s=>{console.error("Auth handler error:",s)})}catch(o){console.error("Auth handler error:",o)}}),e._authWired=!0)};hi&&Ct.length&&Ct.forEach(e=>gi(e,Fi)),Dn&&typeof Kt=="function"&&Kt(rt).catch(()=>{}),hi&&kt.length&&kt.forEach(e=>gi(e,Bi)),Dn&&typeof Yt=="function"?Yt(rt,async e=>{e?(J=e.uid,fn("online"),Ct.forEach(t=>t.classList.add("hidden")),kt.forEach(t=>t.classList.remove("hidden")),Dt&&(Dt.textContent=e.displayName||e.email||""),Jo(),await Mo()):ci()}):ci();function Jo(){if(!me||!Te||typeof qt!="function"||typeof Vt!="function"||typeof Wt!="function"||typeof jt!="function")return;if(!J){Cn(),j(),$e(),K(),Re();return}st&&st();let e=qt(Te,"users",J,"reminders"),t=Vt(e,Wt("updatedAt","desc"));st=jt(t,n=>{let o=[];n.forEach(s=>{let a=s.data(),l=Number(a.orderIndex),c=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,p=a.pinToToday===!0;o.push({id:s.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:Y(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(l)?l:null,plannerLessonId:c,pinToToday:p})}),f=dt(o),j(),$e(),K(),Re()},n=>{console.error("Firestore sync error:",n),V&&fn("error","Sync Error")})}async function ie(e){if(!(!me||!J||!Te||typeof je!="function"||typeof Ut!="function"||typeof tt!="function"))try{await Ut(je(Te,"users",J,"reminders",e.id),{ownerUid:J,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||q,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):tt(),updatedAt:tt()},{merge:!0})}catch(t){console.error("Save failed:",t),E("Save queued (offline)")}}async function Qo(e){if(!(!me||!J||!Te||typeof je!="function"||typeof $t!="function"))try{await $t(je(Te,"users",J,"reminders",e))}catch{E("Delete queued (offline)")}}async function nn(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||q,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ne({preserveDetail:e=!1,resetMode:t=!0}={}){h&&(h.value=""),T&&(T.value=""),x&&(x.value=""),B&&(B.value=""),Ft("Medium"),C&&(C.value=q),Zn(),t?We(null):Ve=at==="edit"?Xt:null,Z&&(Z.textContent="Save"),re?.classList.add("hidden"),yn(),e||Kn()}function Zo(e){let t=f.find(n=>n.id===e);t&&(We("edit",e),h&&(h.value=t.title||""),T&&x&&(t.due?(T.value=Yo(t.due),x.value=Go(t.due)):(T.value="",x.value="")),Ft(t?.priority||"Medium"),C&&(C.value=Y(t.category)),B&&(B.value=typeof t.notes=="string"?t.notes:""),$&&($.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),yn(),Ji(t),Z&&(Z.textContent="Update"),re?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),si(),de("cue:open",{mode:"edit"}))}function yi(e){let t=e?.id||e;t&&(We("edit",t),Zo(t))}function er(e=null){Ne({resetMode:!1}),We("new");let t={mode:"create",trigger:e};de("cue:prepare",t),de("cue:open",t),si()}typeof window<"u"&&(window.openNewReminderSheet=er,window.openEditReminderSheet=yi);function bi(e={},t={}){let{closeSheet:n=!0,activityAction:o="created",activityLabelPrefix:s="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let l=Date.now(),c=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),p=Y(e.category??(C?C.value:q)),u=null;e.due instanceof Date?u=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(u=e.due);let y=null;e.notifyAt instanceof Date?y=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(y=e.notifyAt);let A={id:kn(),title:a,priority:e.priority||Rt(),category:p,notes:c,done:!1,createdAt:l,updatedAt:l,due:u,pendingSync:!J,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:y};ai(A,{position:"start"}),f=[A,...f],ce(f);let I=zt(f);return qe=!0,j(),K(),ho(A),I?f.forEach(_=>ie(_)):ie(A),nn(A),Ge(A),Re(),et(),de("memoryCue:remindersUpdated",{items:f}),n&&ii(),Ee({action:o,label:`${s} \xB7 ${A.title}`}),A}function tr(e){return bi(e,{closeSheet:!0})}function nr(e,t){if(!J)return E("Sign in to add notes"),null;if(!e)return null;let n=f.find(l=>l.id===e);if(!n)return null;let s=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!s)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${s}`:s,n.updatedAt=Date.now(),ie(n),j(),K(),Ee({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function ir(e){let t=f.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),ie(t),nn(t),j(),K(),t.done?(rn(e),Ee({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ge(t),Ee({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function or(e,t){let n=f.find(s=>s?.id===e);if(!n)return;let o=!!t;n.pinToToday!==o&&(n.pinToToday=o,n.updatedAt=Date.now(),ie(n),j(),K(),et(),de("memoryCue:remindersUpdated",{items:f}))}function rr(e){if(!ae||ae.tokenId!==e)return;let{item:t,index:n}=ae;if(!t){_e(e);return}_e(e);let o=Number.isInteger(n)?Math.min(Math.max(n,0),f.length):f.length;t.pendingSync=!J,t.updatedAt=Date.now(),f.splice(o,0,t),ce(f);let s=zt(f);qe=!0,j(),K(),Ge(t),s?f.forEach(a=>ie(a)):ie(t),nn(t),et(),de("memoryCue:remindersUpdated",{items:f}),Ee({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),E("Reminder restored")}function vi(e){let t=f.findIndex(s=>s.id===e),n=t>=0?f.splice(t,1)[0]:null;n&&Ve===e&&Ne(),j(),K(),Qo(e),rn(e);let o=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Ee({action:"deleted",label:o}),n&&P){_e();let s=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ae={tokenId:s,item:n,index:t,timeoutId:null},zi(ae),ae.timeoutId=setTimeout(()=>{_e(s)},Xi)}else n&&_e()}function sr(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,o=48,s=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',l=null,c=!1,p=0,u=0,y=0,A=()=>{if(c){if(c=!1,l!=null&&e.hasPointerCapture?.(l))try{e.releasePointerCapture(l)}catch{}l=null,e.removeEventListener("pointermove",_),e.removeEventListener("pointerup",ue),e.removeEventListener("pointercancel",w),e.removeEventListener("pointerleave",w),window.removeEventListener("pointerup",ue),window.removeEventListener("pointercancel",w)}},I=b=>{if(b.pointerType==="mouse"&&b.button!==0)return;c&&A();let k=b.target;k instanceof Element&&k.closest(a)||(l=b.pointerId,p=b.clientX,u=b.clientY,y=typeof b.timeStamp=="number"?b.timeStamp:Date.now(),c=!0,e.addEventListener("pointermove",_),e.addEventListener("pointerup",ue),e.addEventListener("pointercancel",w),e.addEventListener("pointerleave",w),window.addEventListener("pointerup",ue),window.addEventListener("pointercancel",w))},_=b=>{if(!c||b.pointerId!==l)return;Math.abs(b.clientY-u)>o&&A()},ue=b=>{if(!c||b.pointerId!==l)return;let k=b.clientX-p,O=Math.abs(b.clientY-u),R=(typeof b.timeStamp=="number"?b.timeStamp:Date.now())-y;if(A(),k<=-n&&O<=o&&R<=s){b.preventDefault(),b.stopPropagation();try{t()}catch(ge){console.warn("Swipe delete handler failed",ge)}}},w=b=>{c&&(typeof b.pointerId=="number"&&b.pointerId!==l||A())};e.addEventListener("pointerdown",I)}function ct(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(o=>o.trim()).find(Boolean);if(n){if(e.due)try{let o=new Date(e.due);if(!Number.isNaN(o.getTime())){let s=xn(o);if(s)return`${n} \u2022 ${s}`}}catch{}return n}if(e.due)try{let o=new Date(e.due);if(!Number.isNaN(o.getTime())){let s=xn(o);if(s)return`Due ${s}`}}catch{}return"Due now"}function wi(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}E("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Si(){return Object.values(W||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||q,notes:typeof e.notes=="string"?e.notes:"",body:ct(e),urlPath:e.urlPath||Mt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Nn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(W))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Si(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&cn(),qn(e,{requestCheck:t})}function on(e,{closeNotification:t=!0}={}){if(t){let n=Le.get(e);if(n){try{n.close()}catch{}Le.delete(e)}}Oe[e]&&(clearTimeout(Oe[e]),delete Oe[e]),Pe[e]&&(clearTimeout(Pe[e]),delete Pe[e]),Vn(e),W[e]&&(delete W[e],Nn())}function rn(e){on(e)}function Rn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Le.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:ct(e),tag:e.id});Le.set(e.id,n);let o=()=>{Le.get(e.id)===n&&Le.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",o),n.addEventListener("click",o)),n.onclose=o,n.onclick=o}catch{}}async function ar(e){if(!Ce())return!1;let t=Wi();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let o=await Be();if(!o)return!1;await Vn(e.id,o);let s={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||q,body:a,urlPath:Mt},a=ct(e),l={body:a,tag:e.id,data:s,renotify:!0};n>Date.now()&&(l.showTrigger=new t(n));try{return await o.showNotification(e.title,l),!0}catch(c){return console.warn("Failed to schedule persistent notification",c),!1}}function Ge(e){if(!e||!e.id)return;if(e.category=Y(e.category),!e.due||e.done){rn(e.id);return}let t=W[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||q,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:ct(e),urlPath:Mt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,p=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?p:null})()};if(W[e.id]=n,Nn(),Oe[e.id]&&(clearTimeout(Oe[e.id]),delete Oe[e.id]),Pe[e.id]&&(clearTimeout(Pe[e.id]),delete Pe[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let o=new Date(e.due).getTime();if(!Number.isFinite(o))return;let s=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=o-Date.now();if(a<=0){if(W[e.id]?.viaTrigger){on(e.id,{closeNotification:!1});return}Rn(e),on(e.id,{closeNotification:!1});return}let l=Ce();if(Number.isFinite(s)&&s>Date.now()&&s<o){let c=s-Date.now();Pe[e.id]=setTimeout(()=>{Rn({...e,due:e.due||n.due})},c)}l&&(n.viaTrigger=!1,ar(e).then(c=>{c&&W[e.id]&&(W[e.id]={...W[e.id],viaTrigger:!0},Nn())})),Oe[e.id]=setTimeout(()=>{l&&Vn(e.id),Rn(e),on(e.id,{closeNotification:!1})},a)}function Re(){Object.values(W).forEach(e=>Ge({...e,category:Y(e?.category)}))}function Ei(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=jo.format(t),o=qo.format(t),s=xn(t);return`${n}, ${o}${s?` at ${s}`:""}`}catch{return"No due date"}}let Ti="__mcPinToggleHandler";var Fn=!1;function ut(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(we,t),e.classList.toggle(se,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Ai(e){if(!(e instanceof HTMLElement)||e[Ti])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async o=>{if(o?.defaultPrevented)return;o.stopPropagation(),typeof o?.preventDefault=="function"&&o.preventDefault();let s=o.currentTarget;if(!(s instanceof HTMLElement))return;let l=(typeof s.closest=="function"?s.closest("[data-reminder-item]"):null)?.dataset?.id;if(!l){ut(s,!1);return}let c=!s.classList.contains(we);await Promise.resolve(or(l,c)),ut(s,c)},n=o=>{o?.defaultPrevented||(o?.key==="Enter"||o?.key===" ")&&(o.preventDefault(),t(o))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Ti]={click:t,keydown:n}}function dr(){if(!S)return;let e=S.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let o=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!o){ut(t,!1),Ai(t);return}let a=!!f.find(l=>l?.id===o)?.pinToToday;ut(t,a),Ai(t)})}function Ii(){if(!S||Fn)return;Fn=!0;let e=()=>{Fn=!1,dr()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function lr(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function cr(e,t,n){return t!=="today"?e:Array.isArray(e)?e.filter(o=>lr(o,n)):[]}function Bn(){if(te!=="mobile"||typeof document>"u"||Bn._wired)return;let e=document.querySelectorAll("#view-reminders [data-reminders-tab]");if(!e.length)return;Bn._wired=!0;let t=()=>{e.forEach(n=>{let s=n.getAttribute("data-reminders-tab")===Ze;n.setAttribute("aria-pressed",s?"true":"false"),s?n.classList.add("reminders-tab-active"):n.classList.remove("reminders-tab-active")})};t(),$e(),e.forEach(n=>{n.addEventListener("click",()=>{let o=n.getAttribute("data-reminders-tab");!o||o===Ze||(Ze=o,t(),Array.isArray(hn)&&j(),$e())})})}function j(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let o=new Date(t);o.setHours(23,59,59,999);let s={start:n,end:o};if(xe(),ce(f),Xn)try{Xn.textContent=String(f.length)}catch{}f.forEach(m=>{m&&typeof m=="object"&&(m.category=Y(m.category))});let a=new Set(Ar.map(m=>Y(m)));f.forEach(m=>{m&&typeof m=="object"&&a.add(Y(m.category))});let l=Array.from(a).sort((m,v)=>m.localeCompare(v,void 0,{sensitivity:"base"}));if(mn){let m=new Set;Array.from(mn.querySelectorAll("option")).forEach(v=>{m.add(v.value.trim().toLowerCase())}),l.forEach(v=>{let M=v.toLowerCase();if(!m.has(M)){let F=document.createElement("option");F.value=v,mn.appendChild(F),m.add(M)}})}if(qe)qe=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=f.map(v=>({...v}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let v=document.createEvent("CustomEvent");v&&v.initCustomEvent&&(v.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(v))}}catch{}}let c=f.slice();ce(c),te==="mobile"&&(hn=c.slice(),c=cr(hn,Ze,s),$e());let p=!0,u=f.length>0,y=c.length>0,A=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(W||{}).filter(v=>v&&typeof v=="object"&&v.id);return new Set(m.map(v=>v.id))})();if(Ue)if(y)Ue.classList.add("hidden");else{let m=u?"No reminders to show right now.":To;ni?ni(Ue,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:m,action:u?void 0:`<button type="button" class="${Ao}" data-trigger="open-cue">Create reminder</button>`}):Ue.textContent=m,Ue.classList.remove("hidden")}if(zn&&zn.classList.toggle("has-items",y),!S)return;if(!y){Ue?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden")),Ii();return}S.classList.remove("hidden"),S.replaceChildren();let I=document.createDocumentFragment(),_=S.tagName==="UL"||S.tagName==="OL",ue=!0,w=["priority-high","priority-medium","priority-low"],b=(m,v)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...w);let M=typeof v=="string"?v.trim().toLowerCase():"";M.startsWith("h")?m.classList.add("priority-high"):M.startsWith("m")?m.classList.add("priority-medium"):M.startsWith("l")&&m.classList.add("priority-low")},k=(m,v="neutral")=>{let M=document.createElement("span");M.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",M.title=m,M.dataset.tone=v;let F=document.createElement("span");F.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",v==="priority-high"?F.classList.add("bg-error"):v==="priority-medium"?F.classList.add("bg-warning"):v==="priority-low"?F.classList.add("bg-secondary"):v==="category"?F.classList.add("bg-primary"):F.classList.add("bg-base-content","opacity-40");let N=document.createElement("span");return N.className="truncate",N.textContent=m,M.append(F,N),M},O=(m,v,{elementTag:M,isMobile:F})=>{let N={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:v,done:!!m.done,pinToToday:m.pinToToday===!0},pt="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",pr="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",L=document.createElement(M);L.className=F?pr:pt,L.dataset.id=N.id,L.dataset.category=N.category,L.dataset.title=N.title;let Ci=N.priority&&String(N.priority).trim();Ci?L.dataset.priority=Ci:delete L.dataset.priority,L.dataset.done=String(N.done),N.dueIso?L.dataset.due=N.dueIso:delete L.dataset.due,N.pinToToday?L.dataset.pinToToday="true":delete L.dataset.pinToToday,L.dataset.reminder=JSON.stringify(N),L.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",L.dataset.reminderItem="true",L.dataset.compact="true",L.classList.add("reminder-draggable"),L.setAttribute("draggable","true"),L.setAttribute("role","button"),L.tabIndex=0,L.setAttribute("aria-label",`Edit reminder: ${m.title}`),b(L,N.priority),A.has(N.id)?L.dataset.notificationActive="true":delete L.dataset.notificationActive;let On=N.dueIso?new Date(N.dueIso):null;p&&On&&On>=n&&On<=o?(L.classList.add("is-today"),L.dataset.today="true"):(L.classList.remove("is-today"),delete L.dataset.today);let mt=document.createElement("div");mt.className="flex min-w-0 flex-1 flex-col gap-2",F&&mt.classList.add("text-sm","text-base-content");let ye=document.createElement("p");if(ye.className=F?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",ye.classList.add("desktop-reminder-title"),F||ye.classList.add("sm:text-[0.95rem]"),N.done&&ye.classList.add("line-through","text-base-content/60"),F){ye.dataset.reminderTitle="true",ye.textContent="";let H=document.createElement("span");H.dataset.role="reminder-today-toggle",H.className="reminder-title-toggle cursor-pointer",H.setAttribute("role","button"),H.tabIndex=0,H.textContent=m.title,ut(H,N.pinToToday),ye.appendChild(H)}else ye.textContent=m.title;let sn=ye;F&&(sn=document.createElement("div"),sn.className="reminder-title-slot",sn.appendChild(ye)),mt.appendChild(sn);let ht=document.createElement("div");ht.className=F?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let Pn=Ei(m),ki=Pn&&Pn!=="No due date"?Pn:"";ki&&ht.appendChild(k(ki,"due")),!!(v&&v!==q)&&ht.appendChild(k(v,"category")),ht.children.length&&mt.appendChild(ht),L.appendChild(mt);let Ke=document.createElement("div");Ke.className="task-toolbar flex items-start gap-1",Ke.setAttribute("role","toolbar"),Ke.setAttribute("aria-label","Reminder actions"),F&&Ke.classList.add("flex-shrink-0");let oe=document.createElement("button");oe.type="button",oe.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",oe.classList.toggle("reminder-complete-toggle--active",N.done);let mr=N.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";oe.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${mr}"
          />
        </svg>`,N.done?(oe.classList.add("text-base-content/60"),oe.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(oe.classList.add("text-success"),oe.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),oe.setAttribute("aria-pressed",N.done?"true":"false"),oe.setAttribute("data-reminder-control","toggle"),oe.setAttribute("data-no-swipe","true"),oe.addEventListener("click",H=>{H.preventDefault(),H.stopPropagation(),ir(N.id)});let Ie=document.createElement("button");Ie.type="button",Ie.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Ie.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Ie.setAttribute("aria-label",`Delete reminder: ${m.title}`),Ie.setAttribute("data-action","delete"),Ie.setAttribute("data-reminder-control","delete"),Ie.setAttribute("data-no-swipe","true"),Ie.addEventListener("click",H=>{H.preventDefault(),H.stopPropagation();try{vi(N.id)}catch(gt){console.warn("Delete handler failed",gt)}}),Ke.append(oe,Ie),L.appendChild(Ke);let xi=()=>yi(m);return L.addEventListener("click",H=>{if(H.defaultPrevented)return;let gt=H.target;gt&&typeof gt.closest=="function"&&gt.closest("[data-reminder-control]")||xi()}),L.addEventListener("keydown",H=>{H.defaultPrevented||H.target===L&&(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),xi())}),F&&sr(L,()=>vi(N.id)),L},R=(m,v)=>O(m,v,{elementTag:"div",isMobile:!0});if(te!=="desktop"&&!ue){c.forEach(m=>{let v=m.category||q;I.appendChild(R(m,v))}),S.appendChild(I);return}let ge=new Map;c.forEach(m=>{let v=m.category||q;ge.has(v)||ge.set(v,[]),ge.get(v).push(m)});let Mn=Array.from(ge.entries()).sort((m,v)=>m[0].localeCompare(v[0],void 0,{sensitivity:"base"})),ft=!0;Mn.forEach(([m,v])=>{if(m!==q){let M=document.createElement(_?"li":"div");M.dataset.categoryHeading=m,_&&(M.setAttribute("role","presentation"),M.style.listStyle="none"),M.className=te==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",ft||(M.style.marginTop=te==="desktop"?"1.25rem":"1rem");let F=document.createElement("div");F.setAttribute("role","heading"),F.setAttribute("aria-level","3"),F.className=te==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let N=document.createElement("span");N.textContent=m;let pt=document.createElement("span");pt.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",pt.textContent=`${v.length} ${v.length===1?"item":"items"}`,F.append(N,pt),M.appendChild(F),I.appendChild(M)}v.forEach(M=>{if(te==="desktop"){let F=O(M,m,{elementTag:_?"li":"div",isMobile:!1});I.appendChild(F);return}I.appendChild(R(M,m))}),ft=!1}),S.appendChild(I),Qi(),Ii()}function he(){Je?.setAttribute("aria-expanded","false"),Qe?.classList.add("hidden")}function ur(){Je?.setAttribute("aria-expanded","true"),Qe?.classList.remove("hidden")}Je?.addEventListener("click",e=>{e.stopPropagation(),Je.getAttribute("aria-expanded")==="true"?he():ur()}),document.addEventListener("click",e=>{Qe&&!Qe.classList.contains("hidden")&&!Qe.contains(e.target)&&e.target!==Je&&he()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&he()}),ao.forEach(e=>{e.addEventListener("click",()=>{let t=Nt?.classList.contains("hidden");Nt?.classList.toggle("hidden"),t&&Nt?.scrollIntoView({behavior:"smooth",block:"start"}),he()})}),document.addEventListener("DOMContentLoaded",()=>{Nt?.classList.add("hidden")});function Li(){try{console.log("handleSaveAction invoked",{editingId:Ve,title:h?.value})}catch{}let t=(typeof h?.value=="string"?h.value:"").trim(),n=typeof T?.value=="string"?T.value:"",o=typeof x?.value=="string"?x.value:"",s=typeof $?.value=="string"?$.value.trim():"";if(at==="edit"&&Ve){let u=f.find(I=>I.id===Ve);if(!u){Ne();return}if(!t){E("Add a reminder title");return}let y=null;if(n||o){let I=n||Zt();y=fi(I,o||"09:00")}else{let I=tn(t);I.time&&(y=new Date(`${I.date}T${I.time}:00`).toISOString())}u.title=t;let A=Rt();u.priority=A,Ft(A),C&&(u.category=Y(C.value)),u.due=y,B&&(u.notes=B.value.trim()),u.plannerLessonId=s||null,u.updatedAt=Date.now(),ie(u),nn(u),qe=!0,j(),Ge(u),K(),et(),de("memoryCue:remindersUpdated",{items:f}),ii(),Ee({action:"updated",label:`Reminder updated \xB7 ${u.title}`}),Ne(),E("Reminder updated"),de("cue:close",{reason:"updated"});return}if(!t){E("Add a reminder title");return}let a=B?B.value.trim():"",l=null;if(n||o){let u=n||Zt();l=fi(u,o||"09:00")}else{let u=tn(t);u.time&&(l=new Date(`${u.date}T${u.time}:00`).toISOString())}let c=s?{lessonId:s,dayLabel:$?.dataset?.lessonDayLabel||"",lessonTitle:$?.dataset?.lessonTitle||"",summary:$?.dataset?.lessonSummary||""}:null,p=tr({title:t,priority:Rt(),category:C?C.value:"",due:l,notes:a,plannerLessonId:s||null});p&&(c?(E("Planner reminder created"),de("planner:reminderCreated",{lessonId:c.lessonId,dayLabel:c.dayLabel,lessonTitle:c.lessonTitle,summary:c.summary,reminderId:p.id,reminderTitle:p.title,reminderDue:p.due||null})):E("Reminder created")),h&&(h.value=""),x&&(x.value=""),B&&(B.value=""),yn(),de("cue:close",{reason:"created"})}h?.addEventListener("keydown",e=>{e.key==="Enter"&&Li()});function fr(){if(!h||!Me)return;let e=h.value.trim();if(!e){Me.style.display="none";return}try{let t=tn(e),n=Zt();if(t.date!==n||t.time){let o="";if(t.date!==n){let s=new Date(t.date+"T00:00:00");o+=`\u{1F4C5} ${mi(t.date)}`}t.time&&(o+=`${o?" ":""}\u{1F550} ${t.time}`),o?(Me.textContent=`Parsed: ${o}`,Me.style.display="block"):Me.style.display="none"}else Me.style.display="none"}catch{Me.style.display="none"}}if(h?.addEventListener("input",zo(fr,300)),re?.addEventListener("click",()=>{Ne(),E("Edit cancelled"),de("cue:close",{reason:"edit-cancelled"})}),Gi?.addEventListener("click",()=>{Ne()}),document.addEventListener("cue:cancelled",()=>{Ne()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";Ne({resetMode:!1}),We(t,t==="edit"?Xt:null)}),document.addEventListener("cue:close",()=>{We(null)}),document.addEventListener("planner:prefillReminder",e=>{po(e?.detail||{})}),window.addEventListener("load",()=>h?.focus()),no?.addEventListener("click",()=>{let e=f.filter(t=>!t.done).map(t=>{let n=t.due?mi(t.due.slice(0,10)):"",o=t.due?new Date(t.due).toLocaleTimeString(Ye,{hour:"2-digit",minute:"2-digit",timeZone:Ae}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${o}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){E("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>E("Copied for Master Task List")).catch(()=>E("Copy failed")),he()}),pn?.addEventListener("change",()=>{let e=pn.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),o=[];n.forEach(a=>{let l={...a,id:kn(),category:Y(a.category),pendingSync:!J,orderIndex:null};ai(l,{position:"start"}),f=[l,...f],o.push(l)}),ce(f);let s=zt(f);j(),K(),s?f.forEach(a=>ie(a)):o.forEach(a=>ie(a)),E("Import successful")}catch{E("Invalid JSON")}},t.readAsText(e),pn.value="",he()}),io?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),he()}),oo?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){E("Add your Apps Script URL in Settings first"),he();return}if(!f.length){E("No tasks to sync"),he();return}E("Syncing all tasks\u2026");let t=20,n=0;for(let o=0;o<f.length;o+=t){let s=f.slice(o,o+t),a=await Promise.allSettled(s.map(l=>{let c={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:l.category||q,done:!!l.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}));n+=a.filter(l=>l.status==="rejected").length,await new Promise(l=>setTimeout(l,400))}E(`Sync complete: ${f.length-n} ok${n?`, ${n} failed`:""}`),he()}),He&&(He.value=localStorage.getItem("syncUrl")||""),ro?.addEventListener("click",()=>{He&&(localStorage.setItem("syncUrl",He.value.trim()),E("Settings saved"))}),so?.addEventListener("click",async()=>{if(!He)return;let e=He.value.trim();if(!e){E("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});E(t.ok?"Test ok":"Test failed")}catch{E("Test failed")}}),to?.addEventListener("click",async()=>{if(!("Notification"in window)){E("Notifications not supported");return}if(Notification.permission==="granted"){E("Notifications enabled"),Ce()?Be():(cn(),wi()),Re(),j();return}try{await Notification.requestPermission()==="granted"?(E("Notifications enabled"),Ce()?Be():(cn(),wi()),Re(),j()):E("Notifications blocked")}catch{E("Notifications blocked")}}),Bn(),te==="mobile"){let e=()=>{try{uo()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return Fo(),Re(),j(),K(),{cancelReminder:rn,scheduleReminder:Ge,closeActiveNotifications:Yi,getActiveNotifications:()=>Le,addNoteToReminder:nr,__testing:{setItems(e=[]){f=Array.isArray(e)?e.map(t=>({...t,category:Y(t?.category)})):[],f=dt(f),ce(f),j()},render:j,getItems:()=>f.map(e=>({...e}))}}}var $i,Le,ji,Hn,Un,qi,ln,Et,$n,q,Ar,jn,be,Ir,ve,xr=_n(()=>{Oi();$i="memoryCue:activity",Le=new Map,ji=!1,Hn="service-worker.js",Un="memory-cue-reminder-sync",qi=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),ln=null,Et=null,$n=!1,q="General",Ar=Object.freeze([q,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),jn="memoryCue:offlineReminders",be=1024,Ir=Object.freeze({}),ve=null});function Yr(r){return new Yn(r)}var Dr,Nr,Yn,Rr=_n(()=>{Dr=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Nr={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Yn=class r{static activeStack=[];constructor(i={}){this.modal=i.modalElement??null,this.openButton=i.openButton??null,this.closeButton=i.closeButton??null,this.backdropButton=i.backdropButton??null,this.titleInput=i.titleInput??null,this.modalTitle=i.modalTitle??null,this.defaultTitle=i.defaultTitle??"",this.editTitle=i.editTitle??i.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=i.manageAria!==!1,this.enableFocusTrap=i.focusTrap!==!1,this.shouldAutoFocus=i.autoFocus!==!1,this.eventTarget=i.eventTarget??document,this.events={...Nr,...i.events||{}},this.animationHooks=i.animationHooks??{},this.enableStacking=i.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(i={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...i}),await this.runHook("onAfterShow")}}async hide(i={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...i}),await this.runHook("onAfterHide"))}focusTitleInput(){let i=this.titleInput||this.modal?.querySelector("[autofocus]");!i||typeof i.focus!="function"||window.setTimeout(()=>{try{i.focus({preventScroll:!0})}catch{i.focus()}},50)}async restoreFocus(){let i=this.previouslyFocusedElement||this.openButton;if(i&&typeof i.focus=="function")try{i.focus({preventScroll:!0})}catch{i.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(i={}){this.isDestroyed||(await this.hide(i),this.cleanup(),this.isDestroyed=!0)}setEditMode(i=!1){this.modalTitle&&(this.modalTitle.textContent=i?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",i?"edit":"create"),this.currentMode=i?"edit":"create"}handleOpenClick(i){i.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(i){i.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(i){i.preventDefault(),this.requestClose("backdrop")}handleCancel(i){i.preventDefault(),this.requestClose("keyboard")}handleKeydown(i){this.enableFocusTrap&&i.key==="Tab"&&this.maintainFocus(i),i.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(i){if(!this.modal)return;let d=this.getFocusableElements();if(d.length===0){i.preventDefault(),this.modal.focus();return}let h=d[0],T=d[d.length-1],x=document.activeElement;i.shiftKey&&x===h?(i.preventDefault(),T.focus()):!i.shiftKey&&x===T&&(i.preventDefault(),h.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Dr)).filter(i=>!(i instanceof HTMLElement)||i.hasAttribute("disabled")?!1:i.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(i){if(!i||i.detail&&i.detail.controller&&i.detail.controller!==this)return;let d=i?.detail?.mode==="edit";this.setEditMode(d),this.show({reason:i?.detail?.reason||"external-open",mode:i?.detail?.mode})}handleDocumentCloseRequest(i){if(!i||i.detail?.controller&&i.detail.controller!==this||i.detail?.initiatedBy==="controller")return;let d=i.detail?.reason||"external-close";this.hide({reason:d})}dispatchEvent(i,d={}){let h=this.events[i];if(!h||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let T=new CustomEvent(h,{detail:d,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(T)}requestClose(i){let d={reason:i,controller:this};this.dispatchEvent("cancelled",d),this.dispatchEvent("closeRequest",{...d,initiatedBy:"controller"}),this.hide({reason:i})}async runHook(i){let d=this.animationHooks?.[i];typeof d=="function"&&await d(this)}addToStack(){let i=r.activeStack,d=i.indexOf(this);d!==-1&&i.splice(d,1),i.push(this),this.stackIndex=i.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let i=r.activeStack,d=i.indexOf(this);d!==-1&&i.splice(d,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{Hr as a,Oi as b,qr as c,xr as d,Yn as e,Yr as f,Rr as g};
