import{a as ue,b as tt}from"./chunk-WMMEAIOE.js";import{a as Ae,b as et}from"./chunk-ERL7JLDU.js";import{a as De,b as Xe}from"./chunk-RCZ4YZVR.js";function Be(t,e=document){return!Array.isArray(t)||!e||typeof e.getElementById!="function"?[]:t.map(({key:n,ids:i})=>{if(!Array.isArray(i))return null;for(let s of i){if(typeof s!="string"||!s)continue;let o=e.getElementById(s);if(o)return{key:n,element:o}}return null}).filter(n=>!!(n&&n.element))}function z(t,e){if(!t||typeof t!="object")return"";let n=nt[e]||[e];for(let i of n)if(Object.prototype.hasOwnProperty.call(t,i)){let s=t[i];return s==null?"":typeof s=="string"?s:String(s)}return""}function it(t,e){if(!t)return;let n=e??"";if(t instanceof HTMLInputElement){t.type==="checkbox"?t.checked=!!n:t.value=typeof n=="string"?n:String(n);return}(t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)&&(t.value=typeof n=="string"?n:String(n))}function st(t){return t?t instanceof HTMLInputElement?t.type==="checkbox"?t.checked:t.value:t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?t.value:"":""}function Ie(t,e){Array.isArray(e)&&e.forEach(({key:n,element:i})=>{let s=t&&typeof t=="object"?z(t,n):"";it(i,s)})}function Fe(t,e,n,i){Array.isArray(t)&&t.forEach(({element:s})=>{s instanceof HTMLInputElement?["checkbox","radio"].includes(s.type)?s.checked=!1:s.value="":(s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement)&&(s.value="")}),e&&(e.value=""),n&&(n.textContent=i)}function Me(t){let e={};return Array.isArray(t)&&t.forEach(({key:n,element:i})=>{let s=st(i);if(typeof s=="boolean"){e[n]=s;return}let o=typeof s=="string"?s.trim():s;e[n]=o??""}),e}function H(t){return t==null?"":String(t).replace(/[&<>'"]/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}var xe,nt,me,fe,He=De(()=>{xe=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],nt={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},me="Create Cue",fe="Edit Cue"});function qe(t){return new he(t)}var ot,at,he,Re=De(()=>{ot=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),at={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},he=class t{static activeStack=[];constructor(e={}){this.modal=e.modalElement??null,this.openButton=e.openButton??null,this.closeButton=e.closeButton??null,this.backdropButton=e.backdropButton??null,this.titleInput=e.titleInput??null,this.modalTitle=e.modalTitle??null,this.defaultTitle=e.defaultTitle??"",this.editTitle=e.editTitle??e.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=e.manageAria!==!1,this.enableFocusTrap=e.focusTrap!==!1,this.shouldAutoFocus=e.autoFocus!==!1,this.eventTarget=e.eventTarget??document,this.events={...at,...e.events||{}},this.animationHooks=e.animationHooks??{},this.enableStacking=e.enableStacking!==!1,this.isDisabled=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(!this.validateModal()){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return!this.modal||!(this.modal instanceof HTMLElement)?(console.warn("[ModalController] Modal element is not provided or invalid."),!1):(typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(e={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...e}),await this.runHook("onAfterShow")}}async hide(e={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...e}),await this.runHook("onAfterHide"))}focusTitleInput(){let e=this.titleInput||this.modal?.querySelector("[autofocus]");!e||typeof e.focus!="function"||window.setTimeout(()=>{try{e.focus({preventScroll:!0})}catch{e.focus()}},50)}async restoreFocus(){let e=this.previouslyFocusedElement||this.openButton;if(e&&typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(e={}){this.isDestroyed||(await this.hide(e),this.cleanup(),this.isDestroyed=!0)}setEditMode(e=!1){this.modalTitle&&(this.modalTitle.textContent=e?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",e?"edit":"create"),this.currentMode=e?"edit":"create"}handleOpenClick(e){e.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(e){e.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(e){e.preventDefault(),this.requestClose("backdrop")}handleCancel(e){e.preventDefault(),this.requestClose("keyboard")}handleKeydown(e){this.enableFocusTrap&&e.key==="Tab"&&this.maintainFocus(e),e.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(e){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){e.preventDefault(),this.modal.focus();return}let i=n[0],s=n[n.length-1],o=document.activeElement;e.shiftKey&&o===i?(e.preventDefault(),s.focus()):!e.shiftKey&&o===s&&(e.preventDefault(),i.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(ot)).filter(e=>!(e instanceof HTMLElement)||e.hasAttribute("disabled")?!1:e.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(e){if(!e||e.detail&&e.detail.controller&&e.detail.controller!==this)return;let n=e?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:e?.detail?.reason||"external-open",mode:e?.detail?.mode})}handleDocumentCloseRequest(e){if(!e||e.detail?.controller&&e.detail.controller!==this||e.detail?.initiatedBy==="controller")return;let n=e.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(e,n={}){let i=this.events[e];if(!i||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let s=new CustomEvent(i,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(s)}requestClose(e){let n={reason:e,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:e})}async runHook(e){let n=this.animationHooks?.[e];typeof n=="function"&&await n(this)}addToStack(){let e=t.activeStack,n=e.indexOf(this);n!==-1&&e.splice(n,1),e.push(this),this.stackIndex=e.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let e=t.activeStack,n=e.indexOf(this);n!==-1&&e.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var xt=Xe(()=>{et();tt();He();Re();Ae();function rt(){if(typeof document>"u")return;let t=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),e=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!e||!n)return;let i=document.querySelectorAll("[data-open-reminder-modal]");if(!i.length)return;let s=t.querySelector("[data-reminder-modal-backdrop]"),o=t.querySelectorAll("[data-close-modal]"),a=document.getElementById("mainContent"),d=document.querySelector('nav[aria-label="Primary"]'),B=[a,d],v=null,g=r=>{B.forEach(c=>{c&&(r?c.setAttribute("inert",""):c.removeAttribute("inert"))})},m=()=>{t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""),g(!1),document.removeEventListener("keydown",k,!0),v&&typeof v.focus=="function"&&v.focus()},k=r=>{r.key==="Escape"&&(r.preventDefault(),m())},se=()=>{v=document.activeElement,t.classList.remove("hidden"),t.removeAttribute("aria-hidden"),t.removeAttribute("inert"),g(!0),document.addEventListener("keydown",k,!0),window.requestAnimationFrame(()=>{n.focus()})};i.forEach(r=>{r.addEventListener("click",c=>{c.preventDefault(),se()})}),o.forEach(r=>{r.addEventListener("click",c=>{c.preventDefault(),m()})}),t.addEventListener("click",r=>{r.target===t&&m()}),s?.addEventListener("click",r=>{r.target===s&&m()});let N=document.getElementById("reminders-list"),oe=document.getElementById("reminder-date"),O=document.getElementById("reminder-priority"),ae=document.getElementById("reminder-notes"),I=r=>{if(!r)return"";let c=new Date(r);return Number.isNaN(c.getTime())?"":c.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},re=({title:r,dueDate:c,priority:h,notes:T})=>{if(typeof document>"u")return null;let w=document.createElement("li");w.className="reminder-item";let _=document.createElement("div");_.className="reminder-main space-y-2";let le=document.createElement("p");le.className="font-semibold text-base-content",le.textContent=r,_.appendChild(le);let $=[],Le=I(c);Le&&$.push(`Due ${Le}`);let Ze=h?h.trim().toLowerCase():"",j={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",detailLabel:"High priority"},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",detailLabel:"Medium priority"},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",detailLabel:"Low priority"}}[Ze]??{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",detailLabel:h||""};if(j.detailLabel&&$.push(j.detailLabel),$.length){let S=document.createElement("p");S.className="text-sm text-base-content/70",S.textContent=$.join(" \xB7 "),_.appendChild(S)}if(T){let S=document.createElement("p");S.className="text-sm text-base-content/60",S.textContent=T,_.appendChild(S)}w.appendChild(_);let K=document.createElement("div");K.className="reminder-meta flex flex-col items-end gap-2 sm:flex-row sm:items-center sm:gap-3";let ce=document.createElement("span");ce.className=j.badgeClass,ce.textContent=j.badgeLabel,K.appendChild(ce);let de=document.createElement("div");de.className="reminder-actions flex flex-wrap items-center justify-end gap-2";let F=document.createElement("button");F.className="btn btn-sm btn-success",F.type="button",F.textContent="Complete",F.disabled=!0,F.title="Coming soon";let M=document.createElement("button");return M.className="btn btn-sm btn-outline",M.type="button",M.textContent="Snooze",M.disabled=!0,M.title="Coming soon",de.append(F,M),K.appendChild(de),w.appendChild(K),w};e.addEventListener("submit",r=>{r.preventDefault();let c=n.value.trim();if(!c){n.focus();return}let h=ae?.value??"",T={title:c,dueDate:oe?.value||"",priority:O?.value||"",notes:h.trim()},w=N?re(T):null;w&&N&&N.prepend(w),e.reset(),m()})}rt();var Ne=document.getElementById("settings-save-button"),Q=document.getElementById("settings-save-confirmation"),Oe=document.getElementById("live-status"),pe=null;Ne&&Q&&Ne.addEventListener("click",t=>{t.preventDefault(),Q.classList.remove("hidden"),Q.textContent="Settings saved!",Oe&&(Oe.textContent="Settings saved!"),pe&&window.clearTimeout(pe),pe=window.setTimeout(()=>{Q.classList.add("hidden")},3e3)});var Pe=document.getElementById("title"),lt=document.getElementById("reminderText"),E=(()=>{let t=document.getElementById("cue-modal")??document.getElementById("cue_modal");return qe({modalElement:t,openButton:document.getElementById("openCueModal"),closeButton:document.getElementById("closeCueModal"),backdropButton:t?.querySelector(".modal-backdrop button")??null,titleInput:Pe,modalTitle:document.getElementById("modal-title"),defaultTitle:me,editTitle:fe})})();E?.setEditMode(!1);var ct=()=>{let t=!!Pe,e=!!lt;return!t&&!e?Promise.resolve():e?ue({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"}):ue({titleSel:"#title",dateSel:"#date",timeSel:"#time",detailsSel:"#details",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveBtn",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",statusSel:"#status",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#inlineTotalCount",emptyStateSel:"#emptyState",listWrapperSel:"#remindersWrapper",dateFeedbackSel:"#dateFeedback",variant:"desktop"})};ct().catch(t=>{console.error("Failed to initialise reminders",t)});var C=document.getElementById("cues-list"),x=document.getElementById("cue-form"),b=x?.querySelector("#cue-id-input"),dt=E?.defaultTitle||E?.modalTitle?.textContent?.trim()||me,Nt=E?.editTitle||fe,X=document.getElementById("tab-cues"),ee=document.getElementById("tab-daily"),U=document.getElementById("cues-view"),P=document.getElementById("daily-list-view"),_e=document.getElementById("daily-list-header"),Ve=document.getElementById("quick-add-form"),f=document.getElementById("quick-add-input"),p=document.getElementById("daily-voice-btn"),L=document.getElementById("daily-tasks-container"),ge=document.getElementById("clear-completed-btn"),te=document.getElementById("daily-list-permission-notice"),be=Be(xe),ut={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},Y=null;function mt(t){if(!C)return;if(!Array.isArray(t)||t.length===0){C.innerHTML='<p class="text-sm text-base-content/60">No cues yet.</p>';return}let e=t.map(n=>{let i=H(z(n,"title")||"Untitled Cue"),s=H(z(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${i}</h2>
            ${s?`<p>${s}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${H(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${H(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");C.innerHTML=e}async function ie(){return Y||(Y=(async()=>{let[{initializeApp:t,getApps:e},{getFirestore:n,enableMultiTabIndexedDbPersistence:i,enableIndexedDbPersistence:s,collection:o,doc:a,getDoc:d,addDoc:B,updateDoc:v,getDocs:g,query:m,orderBy:k,serverTimestamp:se,setDoc:N,arrayUnion:oe}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),O=e(),ae=O&&O.length?O[0]:t(ut),I=n(ae);(function(){let c=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;c&&(c.__persistenceInitialized__||(c.__persistenceInitialized__=!0,(async()=>{try{await i(I),console.info("[Firestore] Persistence: multi-tab enabled")}catch(h){if(h&&h.code==="failed-precondition")try{await s(I),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(T){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",T?.code||T)}else h&&h.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",h?.code||h)}})()))})();let re=o(I,"cues");return{db:I,cuesCollection:re,getCollection:o,doc:a,getDoc:d,addDoc:B,updateDoc:v,getDocs:g,query:m,orderBy:k,serverTimestamp:se,setDoc:N,arrayUnion:oe}})().catch(t=>{throw console.error("Failed to initialise Firestore for cues",t),t}),Y)}async function ft(){let t=await ie(),{getDocs:e,cuesCollection:n,query:i,orderBy:s}=t,o=i&&s?i(n,s("createdAt","desc")):n;return(await e(o)).docs.map(d=>({id:d.id,...d.data()}))}async function ht(t){if(!t)return null;let e=await ie(),{db:n,doc:i,getDoc:s}=e,o=i(n,"cues",t),a=await s(o);return a.exists()?{id:a.id,...a.data()}:null}async function $e(){if(C)try{let t=await ft();mt(t)}catch(t){console.error("Failed to load cues",t)}}function pt(t){!x||!b||(Ie(t,be),b.value=t?.id||"",E?.setEditMode(!0),E?.show({mode:"edit"}))}async function yt(t){let e=t.target instanceof Element?t.target.closest(".edit-btn"):null;if(!e)return;t.preventDefault();let n=e.getAttribute("data-id");if(n)try{let i=await ht(n);if(!i)return;pt(i)}catch(i){console.error("Failed to prepare cue for editing",i)}}async function gt(t){if(t.preventDefault(),!x||!b)return;let e=b.value.trim(),n=Me(be);try{let i=await ie(),{db:s,doc:o,addDoc:a,updateDoc:d,cuesCollection:B,serverTimestamp:v}=i,g=typeof v=="function"?v():null;if(e){let m=o(s,"cues",e),k={...n};g&&(k.updatedAt=g),await d(m,k)}else{let m={...n};g&&(m.createdAt=g,m.updatedAt=g),await a(B,m)}await $e(),Fe(be,b,E?.modalTitle??null,dt),await E?.hide({reason:"form-submit"})}catch(i){console.error("Failed to save cue",i)}}async function bt(){!x||!b||!C||(await $e(),C.addEventListener("click",yt),x.addEventListener("submit",gt))}x&&b&&(document.addEventListener("cue:prepare",()=>{b.value="",E?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{b.value="",E?.setEditMode(!1)}));x&&b&&C&&bt().catch(t=>{console.error("Failed to initialise cue editing",t)});var l=[],G=null,D=!1,je="dailyTasksByDate",W=null;function Ee(){let t=new Date,e=String(t.getFullYear()),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${i}`}function Et(t){if(typeof t!="string")return"";let[e,n,i]=t.split("-"),s=Number.parseInt(e,10),o=Number.parseInt(n,10),a=Number.parseInt(i,10);if(!Number.isFinite(s)||!Number.isFinite(o)||!Number.isFinite(a))return t;let d=new Date(s,o-1,a);return Number.isNaN(d.getTime())?t:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(d)}function V(t){if(!ge)return;let e=Array.isArray(t)&&t.some(n=>!!n?.completed);ge.disabled=!e}function A(t){if(!L)return;if(!Array.isArray(t)||t.length===0){L.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',V([]);return}let e=t.map((n,i)=>{let s=H(n?.text||""),o=!!n?.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return o&&a.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${i}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${i}" data-task-text="${s}" ${o?"checked":""} />
          <span class="${a.join(" ")}">${s}</span>
        </div>
      `}).join("");L.innerHTML=e,V(t)}function ne(){te&&te.classList.remove("hidden")}function vt(){te&&te.classList.add("hidden")}function ve(t){return{text:typeof t?.text=="string"?t.text:"",completed:!!t?.completed}}function R(t){return Array.isArray(t)?t.map(e=>ve(e)):[]}function ke(){if(typeof localStorage>"u")return{};try{let t=localStorage.getItem(je);if(!t)return{};let e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch(t){return console.warn("Unable to read daily tasks from storage",t),{}}}function Ke(t){if(!(typeof localStorage>"u"))try{let e=t&&typeof t=="object"?t:{};localStorage.setItem(je,JSON.stringify(e))}catch(e){console.warn("Unable to persist daily tasks locally",e)}}function Ue(t){let e=ke(),n=e&&typeof e=="object"?e[t]:[];return R(n)}function J(t,e){let n=ke(),i=R(e);return n[t]=i,Ke(n),i}function ye(t,e){let n=ke(),i=R(n[t]);return i.push(ve(e)),n[t]=i,Ke(n),i}function Te(t){let e=typeof t?.code=="string"?t.code.toLowerCase():"";if(e)return e.includes("permission-denied")||e.includes("insufficient-permission");let n=typeof t?.message=="string"?t.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function we(){return W||(W=ie().then(t=>{let{db:e,getCollection:n}=t,i=typeof n=="function"&&e?n(e,"dailyLists"):null;return{...t,dailyListsCollection:i}}).catch(t=>{throw console.error("Failed to initialise Firestore for daily lists",t),t}),W)}function Se(t,e){let{doc:n,dailyListsCollection:i,db:s}=t||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return i?n(i,e):n(s,"dailyLists",e)}async function ze(){if(!_e||!L)return;let t=Ee(),e=Et(t);if(_e.textContent=e?`Today's List - ${e}`:"Today's List",D){ne();let n=Ue(t);return l=n,A(n),Promise.resolve(n)}return G||(L.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',V([]),G=(async()=>{try{let n=await we(),i=Se(n,t),s=await n.getDoc(i),o=s.exists()?s.data()?.tasks:[];l=R(o),A(l),J(t,l),D=!1,vt()}catch(n){if(Te(n)){console.warn("Falling back to local daily tasks due to permission issue",n),D=!0,ne();let i=Ue(t);l=i,A(i);return}console.error("Failed to load daily list",n),L.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',l=[],V(l)}})().finally(()=>{G=null})),G}async function kt(t){let e=Ee(),n=ve(t);if(D){ye(e,n);return}try{let i=await we(),s=Se(i,e),o=await i.getDoc(s);if(o.exists()&&typeof i.arrayUnion=="function")await i.updateDoc(s,{tasks:i.arrayUnion(n)});else{let a=o.exists()?o.data()?.tasks:[],d=Array.isArray(a)?R(a):[];d.push(n),typeof i.setDoc=="function"?await i.setDoc(s,{tasks:d},{merge:!0}):await i.updateDoc(s,{tasks:d})}ye(e,n)}catch(i){if(Te(i)){console.warn("Saving task locally because cloud sync is unavailable",i),D=!0,ne(),ye(e,n);return}throw i}}async function Qe(t){let e=Ee(),n=R(t);if(D){J(e,n);return}try{let i=await we(),s=Se(i,e);typeof i.setDoc=="function"?await i.setDoc(s,{tasks:n},{merge:!0}):await i.updateDoc(s,{tasks:n}),J(e,n)}catch(i){if(Te(i)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",i),D=!0,ne(),J(e,n);return}throw i}}function Ye(t){[X,ee].forEach(e=>{if(!e)return;let n=e===t;e.classList.toggle("tab-active",n),e.setAttribute("aria-selected",n?"true":"false")})}function Tt(){!U||!P||(U.classList.remove("hidden"),P.classList.add("hidden"),Ye(X))}function wt(){!U||!P||(U.classList.add("hidden"),P.classList.remove("hidden"),Ye(ee),ze())}X&&ee&&U&&P&&(X.addEventListener("click",t=>{t.preventDefault(),Tt()}),ee.addEventListener("click",t=>{t.preventDefault(),wt()}));var u=null,y=!1,Z=null;function q(t){if(!p)return;p.setAttribute("aria-pressed",t?"true":"false");let e=p.querySelector('[aria-hidden="true"]');e?e.textContent=t?"\u{1F442}":"\u{1F399}\uFE0F":p.textContent=t?"\u{1F442}":"\u{1F399}\uFE0F"}function St(){y&&(window.clearTimeout(Z),Z=window.setTimeout(()=>{Z=null,y&&Ge(!0)},400))}function Ge(t=!1){if(!u)return!1;if(y&&!t)return!0;try{return u.start(),y=!0,q(!0),!0}catch{return y=!1,q(!1),!1}}function Ce(){if(u){y=!1,window.clearTimeout(Z);try{u.stop()}catch{}q(!1)}}function Ct(){if(p)try{let t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){p.setAttribute("disabled","true"),p.setAttribute("aria-disabled","true"),p.title="Voice input is not supported in this browser.";return}u=new t;let e=document.documentElement?.lang||navigator?.language||"en-AU";if(u.lang=e,u.interimResults=!1,"continuous"in u)try{u.continuous=!0}catch{}u.onresult=n=>{let i=n?.results?.[0]?.[0]?.transcript||"";if(i&&f){f.value=i.trim();try{f.focus({preventScroll:!0})}catch{f.focus()}try{let s=f.value.length;f.setSelectionRange(s,s)}catch{}}},u.onend=()=>{if(!y){q(!1);return}St()},u.onerror=()=>{y=!1,q(!1)}}catch{u=null,q(!1),p.setAttribute("disabled","true"),p.setAttribute("aria-disabled","true")}}Ct();p?.addEventListener("click",()=>{u&&(y?Ce():Ge())});Ve?.addEventListener("submit",()=>{y&&Ce()});window.addEventListener("pagehide",()=>{y&&Ce()});Ve?.addEventListener("submit",async t=>{if(t.preventDefault(),!f)return;let e=f.value.trim();if(!e){f.focus();return}let n={text:e,completed:!1};f.value="",f.focus();try{await kt(n),await ze()}catch(i){console.error("Failed to add task to the daily list",i),f.value=e,f.focus()}});L?.addEventListener("change",async t=>{let e=t.target instanceof HTMLInputElement?t.target:null;if(!e||e.type!=="checkbox")return;let n=Number.parseInt(e.getAttribute("data-task-index")||"",10);if(!Array.isArray(l)||Number.isNaN(n)||!l[n])return;let i=l.map(o=>({...o})),s=i.map((o,a)=>a===n?{...o,completed:e.checked}:o);l=s,A(s);try{await Qe(s)}catch(o){console.error("Failed to update task completion state",o),l=i,A(i)}});ge?.addEventListener("click",async()=>{if(!Array.isArray(l)||l.length===0)return;let t=l.filter(n=>!n.completed);if(t.length===l.length)return;let e=l.map(n=>({...n}));l=t,A(t);try{await Qe(t)}catch(n){console.error("Failed to clear completed tasks",n),l=e,A(e)}});V(l);var We="theme",Lt=document.getElementById("theme-menu");function Je(t){if(typeof t!="string"||!t.trim())return;let e=t.trim();document.documentElement.setAttribute("data-theme",e);let n=new Set(["dark","dracula","synthwave"]);document.documentElement.classList.toggle("dark",n.has(e))}function Dt(t){if(typeof t!="string"||!t.trim())return;let e=t.trim();try{localStorage.setItem(We,e)}catch(n){console.warn("Unable to save theme preference",n)}}function At(){let t="";try{t=localStorage.getItem(We)||""}catch(e){console.warn("Unable to load theme preference",e)}t&&Je(t)}Lt?.addEventListener("click",t=>{let e=t.target instanceof HTMLElement?t.target.closest("[data-theme-name]"):null;if(!e)return;t.preventDefault();let n=e.getAttribute("data-theme-name");n&&(Je(n),Dt(n))});At()});export default xt();
