import{a as St,b as nn,c as vt,d as on,e as Se,g as rn}from"./chunk-NQOL4S2N.js";import{a as bt,b as en}from"./chunk-MG4MJA24.js";import{b as Et,c as tn}from"./chunk-CTK42JWW.js";import{b as ht,c as Zt}from"./chunk-GUVSRPRW.js";var ve,De,sn,me,je,Lt,wt,Ct,Ke,It,ae,Me,At,ln,Z,J,We,R,ye,Ae,Tt,pe=ht(()=>{ve="memoryCueNotes",De="memoryCueFolders",sn=["mobileNotes"],me=()=>typeof localStorage<"u",je=null,Lt=n=>{je=typeof n=="function"?n:null},wt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Ct=n=>{if(typeof n!="string")return"";let e=n.trim();return e.length?(/[<>]/.test(e),n):""},Ke=n=>{if(typeof n!="string")return"";let e=n.trim();return e.length?/[<>]/.test(e)?n:Ct(n):""},It=n=>{if(typeof n!="string")return!1;let e=Date.parse(n);return!Number.isNaN(e)},ae=(n,e,i={})=>{let l=typeof n=="string"?n.trim():"";return{id:i.id&&typeof i.id=="string"?i.id:wt(),title:l||"Untitled note",body:Ke(e),updatedAt:i.updatedAt&&It(i.updatedAt)?i.updatedAt:new Date().toISOString(),folderId:i.folderId&&typeof i.folderId=="string"?i.folderId:null}},Me=n=>{if(Array.isArray(n))return n.map(e=>{if(!e||typeof e!="object")return null;let i=typeof e.title=="string"?e.title.trim():"",l=Ke(e.body),c=typeof e.id=="string"&&e.id.trim()?e.id:wt(),u=It(e.updatedAt)?e.updatedAt:new Date().toISOString();return!i&&!l&&!e.body?null:{id:c,title:i||"Untitled note",body:l,updatedAt:u,folderId:typeof e.folderId=="string"&&e.folderId?e.folderId:null}}).filter(Boolean);if(n&&typeof n=="object"){let e=typeof n.title=="string"?n.title:"",i=typeof n.body=="string"?n.body:"",l=Ke(i);return!e&&!l?[]:[ae(e,l,{id:typeof n.id=="string"?n.id:void 0,updatedAt:typeof n.updatedAt=="string"?n.updatedAt:void 0,folderId:typeof n.folderId=="string"?n.folderId:void 0})]}return typeof n=="string"&&n.trim().length?[ae("Notebook (legacy)",Ct(n))]:[]},At=n=>{if(!me())return null;try{return localStorage.getItem(n)}catch{return null}},ln=n=>{if(me())try{localStorage.removeItem(n)}catch{}},Z=()=>{if(!me())return[];let n=At(ve);if(typeof n=="string")try{let e=JSON.parse(n),i=Me(e);if(i.length)return i}catch{let e=Me(n);if(e.length)return J(e),e}for(let e of sn){let i=At(e);if(typeof i=="string"&&i.trim().length){let l=Me(i);if(l.length)return J(l),ln(e),l}}return[]},J=(n,e={})=>{if(!me()||!Array.isArray(n))return!1;let i=n.map(l=>{let u=Me([l])[0];return u&&(u.folderId=typeof l.folderId=="string"&&l.folderId?l.folderId:u.folderId||null),u}).filter(Boolean);try{if(localStorage.setItem(ve,JSON.stringify(i)),!e.skipRemoteSync&&typeof je=="function")try{let l=je(i);l&&typeof l.then=="function"&&l.catch(c=>{console.error("[notes-storage] Remote sync failed.",c)})}catch(l){console.error("[notes-storage] Remote sync handler threw.",l)}return!0}catch{return!1}},We=()=>[{id:"unsorted",name:"Unsorted"}],R=()=>{if(!me())return We();try{let e=localStorage.getItem(De);if(typeof e=="string"){let i=JSON.parse(e);if(Array.isArray(i)&&i.length){let l=!1,c=i.map((u,p)=>{let b=String(u.id),D=typeof u.name=="string"?u.name:String(u.id),H=typeof u.order=="number"?u.order:p;return typeof u.order!="number"&&(l=!0),{id:b,name:D,order:H}});if(l)try{localStorage.setItem(De,JSON.stringify(c))}catch{}return c}}}catch{}let n=We();try{localStorage.setItem(De,JSON.stringify(n))}catch{}return n},ye=n=>{let i=R().find(l=>l&&String(l.id)===String(n));return i?String(i.name):"Unsorted"},Ae=n=>{if(!me()||!Array.isArray(n))return!1;try{let e=n.filter(i=>i&&typeof i.id=="string"&&i.id.trim()).map((i,l)=>({id:i.id,name:typeof i.name=="string"?i.name:String(i.id),order:typeof i.order=="number"?i.order:l}));return e.length||e.push(...We()),localStorage.setItem(De,JSON.stringify(e)),!0}catch{return!1}},Tt=(n,e)=>{if(!n||typeof n!="string")return!1;let i=Z(),l=!1,c=i.map(p=>p.id===n?(l=!0,{...p,folderId:e&&typeof e=="string"?e:null,updatedAt:new Date().toISOString()}):p);return l?J(c):!1}});var an,dn,cn,Oe,un,fn,Nt,kt=ht(()=>{tn();pe();an="notes",dn="user_id",cn="updated_at",Oe=n=>{if(typeof n!="string")return 0;let e=Date.parse(n);return Number.isNaN(e)?0:e},un=(n=[],e=[])=>{let i=new Map;return e.forEach(l=>{l&&typeof l.id=="string"&&i.set(l.id,l)}),n.forEach(l=>{if(!l||typeof l.id!="string")return;let c=i.get(l.id);if(!c){i.set(l.id,l);return}let u=Oe(l.updatedAt),p=Oe(c.updatedAt);u>p&&i.set(l.id,l)}),Array.from(i.values()).sort((l,c)=>Oe(c?.updatedAt)-Oe(l?.updatedAt))},fn=n=>e=>{if(!e||typeof e!="object")return null;let i={id:typeof e.id=="string"&&e.id?e.id:void 0,updatedAt:typeof e[n]=="string"?e[n]:void 0,folderId:typeof e.folder_id=="string"&&e.folder_id?e.folder_id:void 0};return ae(e.title,e.body,i)},Nt=(n={})=>{let{tableName:e=an,userColumn:i=dn,updatedAtColumn:l=cn,supabase:c=null}=n,u=c||null,p=null,b=!1,D=new Set,H=()=>u||(u=Et(),u),O=fn(l),E=async g=>{let M=H();if(!M||!p)return;let q=(Array.isArray(g)?g.filter(A=>A&&typeof A.id=="string"):[]).map(A=>({id:A.id,[i]:p,title:A.title,body:A.body,folder_id:typeof A.folderId=="string"&&A.folderId?A.folderId:null,[l]:typeof A.updatedAt=="string"&&A.updatedAt?A.updatedAt:new Date().toISOString()})),Y=new Set(q.map(A=>A.id));if(q.length){let{error:A}=await M.from(e).upsert(q);if(A)throw A}let j=[...D].filter(A=>A&&!Y.has(A));if(j.length){let{error:A}=await M.from(e).delete().in("id",j).eq(i,p);if(A)throw A}D=new Set(Y)},x=async()=>{let g=H();if(!(!g||!p))try{let{data:M,error:_}=await g.from(e).select(`id,title,body,folder_id,${l}`).eq(i,p);if(_)throw _;let q=Array.isArray(M)?M:[];D=new Set(q.map(L=>typeof L.id=="string"?L.id:null).filter(Boolean));let Y=q.map(O).filter(Boolean),j=Z();if(!Y.length){if(j.length)try{await E(j)}catch(L){console.error("[notes-sync] Failed to upload local notes to Supabase.",L)}return}let A=un(j,Y);b=!0;let m=J(A,{skipRemoteSync:!0});b=!1,m||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await E(A)}catch(L){console.error("[notes-sync] Failed to reconcile notes with Supabase.",L)}}catch(M){console.error("[notes-sync] Failed to fetch notes from Supabase.",M)}finally{b=!1}};return Lt(async g=>{if(!b)try{await E(g)}catch(M){console.error("[notes-sync] Failed to sync notes to Supabase.",M)}}),{setSupabaseClient(g){g&&(u=g)},handleSessionChange:async g=>{if(p=typeof g?.id=="string"?g.id:null,!p){D=new Set;return}await x()},syncFromRemote:x}}});var mn=Zt(()=>{en();on();nn();pe();pe();pe();kt();rn();pe();bt();(function(){let n=()=>{let e=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(i instanceof HTMLElement)){let m=typeof n._retryCount=="number"?n._retryCount:0;m<10&&(n._retryCount=m+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let l=e.querySelector("[data-dialog-content]"),c=e.querySelector(".sheet-backdrop"),u=document.getElementById("createReminderForm"),p=document.getElementById("saveReminder"),b=document.getElementById("priority"),D=document.getElementById("priorityChips"),H=D?Array.from(D.querySelectorAll('input[name="priority"]')):[],O=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),E=Array.from(O).filter(m=>m instanceof HTMLElement),x=E[0]||null,P=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};P();let g=null,M=(m,L)=>{try{document.dispatchEvent(new CustomEvent(m,{detail:L}))}catch(C){console.warn(`${m} dispatch failed`,C)}},_=()=>{let m=b?.value||"Medium";H.forEach(L=>{let C=L.value===m;L.checked=C,L.setAttribute("aria-checked",C?"true":"false")})},q=m=>{b&&(b.value!==m&&(b.value=m,b.dispatchEvent(new Event("change",{bubbles:!0}))),_())};H.forEach(m=>{m.addEventListener("change",()=>{m.checked&&q(m.value)})}),b?.addEventListener("change",_),_();let Y=()=>{let m=e.querySelector('input, textarea, select, button, [contenteditable="true"]');m instanceof HTMLElement&&setTimeout(()=>{try{m.focus()}catch{}},0)},j=m=>{g=m instanceof HTMLElement?m:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),g&&g.setAttribute("aria-expanded","true"),_(),Y(),M("reminder:sheet-opened",{trigger:g})},A=(m="dismissed")=>{let L=!e.classList.contains("hidden");P(),g&&g.setAttribute("aria-expanded","false");let C=g&&document.body.contains(g)&&g||x;if(C&&typeof C.focus=="function")try{C.focus()}catch{}L&&M("reminder:sheet-closed",{reason:m,trigger:g}),g=null};E.forEach(m=>{m.addEventListener("click",L=>{L.preventDefault();let C={mode:"create",trigger:m};M("cue:prepare",C),M("cue:open",C)})}),i.addEventListener("click",m=>{m.preventDefault(),A("close-button")}),c?.addEventListener("click",m=>{m.target===c&&A("backdrop")}),e.addEventListener("keydown",m=>{m.key==="Escape"&&(m.stopPropagation(),A("escape"))}),l?.addEventListener("click",m=>{m.stopPropagation()}),e.addEventListener("click",m=>{m.target instanceof HTMLElement&&m.target.hasAttribute("data-close")&&A("backdrop")}),document.addEventListener("cue:open",m=>{_(),j(m?.detail?.trigger||null)}),document.addEventListener("cue:close",m=>{A(m?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{_()}),document.addEventListener("cue:cancelled",()=>{A("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=A),document.addEventListener("reminder:save",m=>{if(!(p instanceof HTMLElement))return;let L=m?.detail?.trigger;L&&L!==p||p.matches(":disabled")||p.click()}),u instanceof HTMLFormElement&&p instanceof HTMLElement&&u.addEventListener("submit",m=>{m.preventDefault(),!p.matches(":disabled")&&p.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var Re=()=>{Re._initialised||(Re._initialised=!0,vt({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Re,{once:!0}):Re();var Bt=()=>{let n=document.getElementById("notifHeaderBtn"),e=document.getElementById("notifBtn");n&&e&&n.addEventListener("click",()=>{e.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Bt,{once:!0}):Bt();var xt=()=>{if(typeof document>"u")return;let n=document.getElementById("noteTitleMobile"),e=document.getElementById("scratchNotesEditor"),i=document.getElementById("noteSaveMobile"),l=document.getElementById("noteNewMobile"),c=document.getElementById("notesListMobile"),u=document.getElementById("notesCountMobile"),p=document.getElementById("notebook-search-input"),b=document.getElementById("savedNotesSheet"),D=document.getElementById("openSavedNotesSheet"),H=document.querySelector('[data-action="close-saved-notes"]'),O="shadow-[0_0_0_3px_var(--accent-color)]",x=(()=>{if(!e)return null;let t=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return t?new t("#scratchNotesEditor",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.dataset.placeholder="Start typing your note\u2026",{element:e,setContent(r=""){e.innerHTML=r||""},getHTML(){return e.innerHTML||""},getText(){return e.textContent||""},focus(){try{e.focus()}catch{}}})})();if(!n||!x||!e||!i)return;let P=document.getElementById("scratchNotesToolbar");P&&e&&P.addEventListener("click",t=>{let r=t.target.closest("button[data-format]");if(!r)return;let o=r.getAttribute("data-format");try{e.focus()}catch{}switch(o){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"ul":document.execCommand("insertUnorderedList",!1,null);break;case"ol":document.execCommand("insertOrderedList",!1,null);break;default:break}});let g=(t="")=>{if(x&&typeof x.setContent=="function"){x.setContent(t||"");return}e.innerHTML=t||""},M=()=>x&&typeof x.getHTML=="function"?x.getHTML()||"":e.innerHTML||"",_=()=>x&&typeof x.getText=="function"?x.getText()||"":e.textContent||"",q=t=>{let r=t;for(;r&&r!==e;){if(r.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(r.tagName?.toLowerCase()))return r;r=r.parentNode}return e},Y=t=>{if(typeof t!="string")return null;let r=t.replace(/\u00a0/g," ").trim();return r==="*"?"ul":r==="1"?"ol":null},j=t=>{if(![" ","Enter"].includes(t.key))return;let r=window.getSelection();if(!r||r.rangeCount===0)return;let o=r.getRangeAt(0);if(!e.contains(o.startContainer))return;let s=q(o.startContainer),a=o.cloneRange();a.selectNodeContents(s),a.setEnd(o.startContainer,o.startOffset);let f=Y(a.toString());if(!f)return;t.preventDefault();let N=(s.textContent||"").replace(/^\s*[\*1]\s?/,"");s.textContent=N;let T=s.firstChild||s,h=document.createRange();h.setStart(T,(T.nodeType===Node.TEXT_NODE,0)),h.collapse(!0),r.removeAllRanges(),r.addRange(h);try{e.focus()}catch{}document.execCommand(f==="ul"?"insertUnorderedList":"insertOrderedList",!1,null)},A=(t,r=200)=>{let o;return(...s)=>{o&&clearTimeout(o),o=setTimeout(()=>{t(...s)},r)}},m=null,L=[],C="all",$="unsorted",d="",S=!1,I=null,F=()=>{d="",p&&(p.value="")},k=()=>b?.dataset.open==="true",B=()=>{if(b){I&&(clearTimeout(I),I=null),b.classList.remove("hidden"),b.dataset.open="true",b.setAttribute("aria-hidden","false");try{X()}catch{}try{se()}catch{}}},w=()=>{b&&(b.dataset.open="false",b.setAttribute("aria-hidden","true"),I&&clearTimeout(I),I=setTimeout(()=>{b?.classList.add("hidden")},200))};(()=>{b&&(D?.addEventListener("click",t=>{t.preventDefault(),B();let r=document.getElementById("notesListMobile");r&&(r.scrollTop=0)}),H?.addEventListener("click",t=>{t.preventDefault(),w()}),b.addEventListener("click",t=>{t.target===b&&w()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&k()&&w()}))})();let _e=()=>typeof d=="string"?d.trim().toLowerCase():"",G=(t=L)=>{if(!Array.isArray(t))return[];let r=_e();return r?t.filter(o=>{let s=typeof o?.title=="string"?o.title.toLowerCase():"",a=typeof o?.body=="string"?o.body.toLowerCase():"";return s.includes(r)||a.includes(r)}):[...t]},Qe=(t=L)=>{if(!Array.isArray(t))return[];let r;return C===null||C==="all"?r=[...t]:C==="unsorted"?r=t.filter(o=>!o.folderId||o.folderId==="unsorted"):r=t.filter(o=>o.folderId===C),G(r)},Ft=(t=[],r=[])=>{let o={all:Array.isArray(t)?t.length:0,unsorted:0};return(Array.isArray(r)?r:[]).forEach(s=>{s&&s.id&&s.id!=="unsorted"&&(o[s.id]=0)}),(Array.isArray(t)?t:[]).forEach(s=>{let a=s?.folderId||"unsorted";!a||a==="unsorted"?o.unsorted+=1:Object.prototype.hasOwnProperty.call(o,a)?o[a]+=1:o.unsorted+=1}),o},ee=t=>{if(!t){m=null,n.value="",g(""),delete n.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;let a=document.getElementById("note-folder-label");a&&(a.textContent=ye($||"unsorted"));return}m=t.id;let r=t.title||"",o=t.body||"";n.value=r,g(o),n.dataset.noteOriginalTitle=r,e.dataset.noteOriginalBody=o,$=t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted";let s=document.getElementById("note-folder-label");s&&(s.textContent=ye($))},Dt=()=>({title:typeof n.value=="string"?n.value.trim():"",body:M()}),ge=()=>{if(!c)return;c.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(r=>{if(!(r instanceof HTMLElement))return;let o=r.getAttribute("data-note-id")===m;o?r.setAttribute("data-state","active"):r.removeAttribute("data-state"),r.classList.toggle("active",o),r.classList.toggle("outline",o),r.classList.toggle("outline-2",o),r.classList.toggle("outline-accent",o),r.classList.toggle(O,o),r.setAttribute("aria-current",o?"true":"false")})},Mt=t=>{if(!t)return"";let r=new Date(t);if(Number.isNaN(r.getTime()))return"";let o=new Date,s=r.getFullYear()===o.getFullYear()&&r.getMonth()===o.getMonth()&&r.getDate()===o.getDate(),a=r.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return s?`Today \xB7 ${a}`:`${r.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${a}`},Ue=()=>{let t=typeof n.value=="string"?n.value:"",r=M(),o=n.dataset.noteOriginalTitle??"",s=e.dataset.noteOriginalBody??"";return t!==o||r!==s},Ot=()=>{let t=Z();return Array.isArray(t)?[...t].sort((r,o)=>{let s=Date.parse(r?.updatedAt||""),a=Date.parse(o?.updatedAt||"");return(Number.isNaN(a)?0:a)-(Number.isNaN(s)?0:s)}):[]},He=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(ve)}catch{return null}},he=He(),Le=()=>(he=He(),he),de=({preserveDraft:t=!0}={})=>{let r=Ot();L=Array.isArray(r)?[...r]:[];try{X()}catch{}let o=t&&Ue(),s=L.length>0,a=Qe();if(qe(a),!s)return o||ee(null),ge(),Le(),S=!1,a;if(m){let f=L.find(y=>y.id===m)||null;f?o||ee(f):(m=null,!o&&!S&&L[0]&&ee(L[0]))}else!o&&!S&&L[0]&&ee(L[0]);return S=!1,ge(),Le(),a},Rt=160,_t=typeof requestAnimationFrame=="function"?requestAnimationFrame:t=>setTimeout(t,0),Ut=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:t=>clearTimeout(t),we=null,Ce=null,Ht=t=>{if(typeof t=="function"){if(!c){t();return}we&&(clearTimeout(we),we=null),Ce&&(Ut(Ce),Ce=null),c.classList.remove("notebook-list-transition-in","notebook-list-transition-in-active"),c.classList.add("notebook-list-transition-out"),we=setTimeout(()=>{t(),c.classList.remove("notebook-list-transition-out"),c.classList.add("notebook-list-transition-in"),Ce=_t(()=>{c.classList.add("notebook-list-transition-in-active")})},Rt)}},Xe=t=>{if(!t)return;let r=Z();if(!Array.isArray(r))return;let o=r.filter(s=>s.id!==t);o.length!==r.length&&(J(o),Le(),m===t&&(ee(null),S=!0),de({preserveDraft:!1}))},qe=(t=[],{withTransition:r=!0}={})=>{if(r)return Ht(()=>qe(t,{withTransition:!1})),t;if(!c)return t;if(c.innerHTML="",u){let o=L.length,s=t.length;u.textContent=o?`${s} of ${o} saved`:"No saved notes yet"}if(!t.length){let o=!!_e(),f=o?"No notes match this filter":!C||C==="all"?"You don't have any notes yet.":C&&C!=="all"&&C!=="unsorted"?"No notes in this folder yet.":"No notes here yet",y=o?"Try adjusting your search or filters.":"Create your first note in this folder to get started.";return c.innerHTML=`
        <div class="notebook-empty-state">
          <h3 class="notebook-empty-title">${f}</h3>
          <p class="notebook-empty-body">${y}</p>
        </div>
      `,t}return t.forEach(o=>{let s=document.createElement("li");s.className="note-item-mobile w-full";let a=document.createElement("button");a.type="button",a.dataset.noteId=o.id,a.dataset.role="open-note",a.className="saved-note-item note-list-item w-full text-left active:scale-[0.99] focus:outline-none";let f=document.createElement("div");f.className="flex items-center justify-between gap-2";let y=document.createElement("div");y.className="flex items-center gap-2";let N=document.createElement("span");N.className="saved-note-title note-list-title truncate";let T=o.title||"Untitled";N.textContent=T,N.setAttribute("title",T);let h=document.createElement("span");h.className="note-folder-badge";let v=o.folderId&&typeof o.folderId=="string"?o.folderId:"unsorted";h.textContent=ye(v);let U=document.createElement("span");U.className="saved-note-meta note-list-meta";let V=o.updatedAt||o.modifiedAt||o.createdAt||"";U.textContent=V?Mt(V):"";let W=document.createElement("button");W.type="button",W.dataset.noteId=o.id,W.dataset.role="note-menu",W.className="btn btn-ghost btn-xs rounded-full text-base-content/80 hover:bg-base-100",W.setAttribute("aria-label","Note actions"),W.textContent="\u22EF";let fe=document.createElement("div");fe.className="flex items-center gap-1",fe.appendChild(U),fe.appendChild(W),y.appendChild(N),y.appendChild(h),f.appendChild(y),f.appendChild(fe);let z=document.createElement("p");z.className="saved-note-preview note-list-preview line-clamp-2";let Ye=o.body||"",Xt=String(Ye).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();z.textContent=Xt||"No content yet.",a.appendChild(f),a.appendChild(z);let le=document.createElement("button");le.type="button",le.dataset.noteId=o.id,le.dataset.role="delete-note",le.className="delete-note-btn btn btn-ghost btn-xs text-error shrink-0 focus-visible:outline-none focus-visible:ring-0",le.setAttribute("aria-label","Delete note"),le.textContent="\u2715";let Fe=document.createElement("div");Fe.className="flex items-start justify-between gap-3",Fe.appendChild(a),Fe.appendChild(le),s.appendChild(Fe),c.appendChild(s)}),ge(),t},Ze=()=>document.getElementById("notebook-folder-bar"),et=t=>{let r=Ze();if(!r)return;r.querySelectorAll(".notebook-folder-chip").forEach(s=>{let a=String(s.dataset.folderId)===String(t);if(s.classList.toggle("notebook-folder-chip--active",a),s.classList.toggle("active",a),a)try{s.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}catch{try{s.scrollIntoView()}catch{}}})},X=()=>{let t=Ze();if(!t)return;t.innerHTML="";let r=[];try{r=Array.isArray(R())?R():[]}catch{r=[]}let o=Array.isArray(r)?r.filter(Boolean):[],s=o.find(h=>h&&h.id==="unsorted")||{id:"unsorted",name:"Unsorted"},a=o.filter(h=>h&&h.id!=="unsorted").sort((h,v)=>String(h.name||"").localeCompare(String(v.name||""),void 0,{sensitivity:"base"})),f=[s,...a],y=Ft(L,f);[{id:"all",name:"All",isVirtual:!0},{...s,isVirtual:!1},...a.map(h=>({...h,isVirtual:!1}))].forEach(h=>{let v=document.createElement("button");if(v.type="button",v.className="folder-chip notebook-folder-chip",v.dataset.folderId=h.id,h.id!=="all"&&h.id!=="unsorted"){let z=document.createElement("span");z.className="notebook-folder-chip-grip",z.setAttribute("aria-hidden","true"),v.appendChild(z)}let U=document.createElement("span");U.className="notebook-folder-chip-label",U.textContent=h.name,v.appendChild(U);let V=document.createElement("span");V.className="notebook-folder-chip-count";let W=h.id==="all"?"all":h.id||"unsorted",fe=typeof y[W]=="number"?y[W]:0;if(V.textContent=fe,v.appendChild(V),v.addEventListener("click",()=>{C=h.id==="all"?"all":h.id,et(C),F(),se()}),h.id!=="all"&&h.id!=="unsorted"){let z=document.createElement("button");z.type="button",z.className="notebook-folder-chip-overflow",z.setAttribute("aria-label","Folder options"),z.innerHTML="\u22EF",z.addEventListener("click",Ye=>{Ye.stopPropagation(),Yt(h.id,v)}),v.appendChild(z)}t.appendChild(v)});let T=document.createElement("button");T.type="button",T.className="folder-chip outlined notebook-folder-chip notebook-folder-chip--new",T.dataset.folderId="new-folder",T.textContent="+ New folder",T.addEventListener("click",h=>{h.preventDefault();try{Pt()}catch(v){console.warn("[notebook] failed to open new folder dialog",v)}}),t.appendChild(T),et(C)},yn=()=>{try{X()}catch(t){console.warn("[notebook] Unable to build folder bar",t)}},tt=document.getElementById("newFolderModal"),te=document.getElementById("newFolderName"),ce=document.getElementById("newFolderError"),nt=document.getElementById("newFolderCreate"),qt=document.getElementById("newFolderCancel"),Ie=null,ot=()=>{ce&&(ce.classList.add("sr-only"),ce.textContent="")},Pe=t=>{ce&&(ce.textContent=t,ce.classList.remove("sr-only"))},Pt=()=>{tt&&(Ie||(Ie=new Se({modalElement:tt,closeButton:qt,titleInput:te,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),ot(),te&&(te.value=""),Ie.show())},rt=()=>{if(!te)return;let r=String(te.value||"").trim();if(ot(),!r.length){Pe("Folder name can't be empty.");return}let o=[];try{o=Array.isArray(R())?R():[]}catch{o=[]}if(o.some(T=>String(T.name).toLowerCase()===r.toLowerCase())){Pe("You already have a folder with this name.");return}let a=`folder-${Date.now().toString(36)}`,f={id:a,name:r},y=[...o.filter(Boolean),f];if(!Ae(y)){Pe("Unable to create folder. Please try again.");return}try{Ie.requestClose("created")}catch{}C=a,F();try{X()}catch(T){console.warn("[notebook] rebuild folder chips failed",T)}se()};nt&&nt.addEventListener("click",t=>{t.preventDefault(),rt()}),te&&te.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),rt())});let it=document.getElementById("pickFolderModal"),$e=document.getElementById("pickFolderList"),st=document.getElementById("pickFolderConfirm"),$t=document.getElementById("pickFolderCancel"),Te=null,ne=null,Ne=null,lt=(t={})=>{let{initialFolderId:r=null,onConfirm:o=null}=t||{};if(!it||!$e)return;ne=(r&&typeof r=="string"?r:$)||"unsorted",Ne=typeof o=="function"?o:null,$e.innerHTML="";let s=[];try{s=Array.isArray(R())?R():[]}catch{s=[]}s.some(a=>a&&a.id==="unsorted")||s.unshift({id:"unsorted",name:"Unsorted"}),s.forEach(a=>{let f=document.createElement("div");f.className="flex items-center gap-3 p-2 rounded-md hover:bg-base-100";let y=document.createElement("input");y.type="radio",y.name="pick-folder",y.value=a.id,y.id=`pick-folder-${a.id}`,(String(a.id)===String(ne)||!ne&&a.id==="unsorted")&&(y.checked=!0,ne=a.id),y.addEventListener("change",()=>{ne=y.value});let T=document.createElement("label");T.setAttribute("for",y.id),T.textContent=a.name,f.appendChild(y),f.appendChild(T),$e.appendChild(f)}),Te||(Te=new Se({modalElement:it,closeButton:$t,titleInput:null,autoFocus:!0})),Te.show()};st&&st.addEventListener("click",t=>{if(t.preventDefault(),!ne)return;let r=ne;if(Ne){try{Ne(r)}catch(o){console.warn("[notebook] folder pick handler failed",o)}Ne=null}else{$=r==="unsorted"?"unsorted":r;let o=document.getElementById("note-folder-label");o&&(o.textContent=ye($))}try{Te.requestClose("selected")}catch{}});let at=document.getElementById("note-folder-button");at&&at.addEventListener("click",t=>{t.preventDefault(),lt()});let oe=null,K=()=>{oe&&oe.parentNode&&oe.parentNode.removeChild(oe),oe=null,document.removeEventListener("click",K),document.removeEventListener("keydown",ze)},ze=t=>{t.key==="Escape"&&K()},zt=(t,r)=>{if(!(!t||!Tt(t,r==="unsorted"?null:r))){try{de({preserveDraft:!0})}catch(a){console.warn("[notebook] failed to refresh notes after move",a)}try{X()}catch(a){console.warn("[notebook] failed to refresh folder chips after move",a)}K()}},Vt=(t,r)=>{if(!t||!r)return;K();let o=document.createElement("div");o.className="memory-glass-card p-2 rounded-2xl shadow-xl backdrop-blur-md border border-base-200/80",o.style.position="absolute",o.style.zIndex=1200,o.style.minWidth="180px";let s=document.createElement("button");s.type="button",s.className="w-full text-left px-3 py-2 btn-ghost rounded-xl",s.textContent="Move to folder\u2026",s.addEventListener("click",f=>{f.preventDefault(),lt({initialFolderId:t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted",onConfirm:y=>zt(t.id,y)})});let a=document.createElement("button");a.type="button",a.className="w-full text-left px-3 py-2 btn-ghost text-error rounded-xl",a.textContent="Delete note",a.addEventListener("click",f=>{f.preventDefault();let y=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(y?y("Delete this note? This cannot be undone."):!0)&&Xe(t.id),K()}),o.appendChild(s),o.appendChild(a),document.body.appendChild(o),oe=o;try{let f=r.getBoundingClientRect(),y=f.bottom+window.scrollY+6,N=f.right+window.scrollX-o.offsetWidth;o.style.top=`${y}px`,o.style.left=`${N}px`}catch{o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)"}document.addEventListener("click",K),document.addEventListener("keydown",ze)},dt=(t,r)=>{if(!t||r!==-1&&r!==1)return;let o=[];try{o=Array.isArray(R())?R().slice():[]}catch{o=[]}if(!o.length)return;let s=o.filter(v=>v&&v.id!=="unsorted");s.sort((v,U)=>(Number(v.order)||0)-(Number(U.order)||0));let a=s.findIndex(v=>String(v.id)===String(t));if(a===-1)return;let f=a+r;if(f<0||f>=s.length)return;let y=s[a].order;s[a].order=s[f].order,s[f].order=y;let h=[o.find(v=>v&&v.id==="unsorted")||{id:"unsorted",name:"Unsorted",order:-1},...s].map((v,U)=>({id:v.id,name:v.name,order:U}));try{if(Ae(h)){try{X()}catch{}try{se()}catch{}}}catch(v){console.warn("[notebook] reorder save failed",v)}},Yt=(t,r)=>{if(!t||t==="all"||t==="unsorted")return;K();let o=document.createElement("div");o.className="memory-glass-card p-2 rounded shadow-lg",o.style.position="absolute",o.style.zIndex=1200,o.style.minWidth="160px";let s=!1,a=!1;try{let v=(Array.isArray(R())?R().filter(Boolean):[]).filter(V=>V&&V.id!=="unsorted").sort((V,W)=>(Number(V.order)||0)-(Number(W.order)||0)),U=v.findIndex(V=>String(V.id)===String(t));s=U===0,a=U===-1?!0:U===v.length-1}catch{s=!1,a=!1}let f=document.createElement("button");f.type="button",f.className="w-full text-left px-3 py-2 btn-ghost",f.textContent="Move up",s&&(f.setAttribute("disabled",""),f.classList.add("opacity-50","cursor-not-allowed")),f.addEventListener("click",h=>{h.preventDefault();try{dt(t,-1)}catch(v){console.warn("[notebook] reorder move up failed",v)}K()});let y=document.createElement("button");y.type="button",y.className="w-full text-left px-3 py-2 btn-ghost",y.textContent="Move down",a&&(y.setAttribute("disabled",""),y.classList.add("opacity-50","cursor-not-allowed")),y.addEventListener("click",h=>{h.preventDefault();try{dt(t,1)}catch(v){console.warn("[notebook] reorder move down failed",v)}K()});let N=document.createElement("button");N.type="button",N.className="w-full text-left px-3 py-2 btn-ghost",N.textContent="Rename folder",N.addEventListener("click",h=>{h.preventDefault(),Kt(t),K()});let T=document.createElement("button");T.type="button",T.className="w-full text-left px-3 py-2 btn-ghost text-accent",T.textContent="Delete folder",T.addEventListener("click",h=>{h.preventDefault(),Gt(t),K()}),o.appendChild(f),o.appendChild(y),o.appendChild(N),o.appendChild(T),document.body.appendChild(o),oe=o;try{let h=r.getBoundingClientRect(),v=h.bottom+window.scrollY+6,U=h.left+window.scrollX;o.style.top=`${v}px`,o.style.left=`${U}px`}catch{o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)"}document.addEventListener("click",K),document.addEventListener("keydown",ze)},ct=document.getElementById("renameFolderModal"),re=document.getElementById("renameFolderName"),ue=document.getElementById("renameFolderError"),ut=document.getElementById("renameFolderSave"),jt=document.getElementById("renameFolderCancel"),ke=null,be=null,ft=()=>{ue&&(ue.classList.add("sr-only"),ue.textContent="")},Ve=t=>{ue&&(ue.textContent=t,ue.classList.remove("sr-only"))},Kt=t=>{if(!ct||t==="all"||t==="unsorted")return;be=t;let o=(Array.isArray(R())?R():[]).find(s=>s&&String(s.id)===String(t));o&&(ke||(ke=new Se({modalElement:ct,closeButton:jt,titleInput:re,modalTitle:document.getElementById("renameFolderTitle"),autoFocus:!0})),ft(),re&&(re.value=o.name||""),ke.show())},mt=()=>{if(!be||!re)return;let r=String(re.value||"").trim();if(ft(),!r.length){Ve("Folder name can't be empty.");return}let o=[];try{o=Array.isArray(R())?R():[]}catch{o=[]}if(o.some(y=>String(y.name).toLowerCase()===r.toLowerCase()&&String(y.id)!==String(be))){Ve("You already have a folder with this name.");return}let a=o.map(y=>String(y.id)===String(be)?{...y,name:r}:y);if(!Ae(a)){Ve("Unable to rename folder. Please try again.");return}try{ke.requestClose("saved")}catch{}be=null;try{X()}catch{}se()};ut&&ut.addEventListener("click",t=>{t.preventDefault(),mt()}),re&&re.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),mt())});let yt=document.getElementById("deleteFolderModal"),pt=document.getElementById("deleteFolderConfirm"),Wt=document.getElementById("deleteFolderCancel"),Ee=null,ie=null,Gt=t=>{!yt||t==="all"||t==="unsorted"||(ie=t,Ee||(Ee=new Se({modalElement:yt,closeButton:Wt,titleInput:null,modalTitle:document.getElementById("deleteFolderTitle"),autoFocus:!1})),Ee.show())},Jt=()=>{if(!ie)return;let t=[];try{t=Array.isArray(R())?R():[]}catch{t=[]}let r=t.filter(f=>String(f.id)!==String(ie));if(r.some(f=>f&&f.id==="unsorted")||r.unshift({id:"unsorted",name:"Unsorted"}),!Ae(r)){try{Ee.requestClose("failed")}catch{}ie=null;return}let s=Z(),a=(Array.isArray(s)?s:[]).map(f=>f&&String(f.folderId)===String(ie)?{...f,folderId:"unsorted",updatedAt:new Date().toISOString()}:f);J(a),String(C)===String(ie)&&(C="unsorted",F()),ie=null;try{Ee.requestClose("deleted")}catch{}X(),se()};pt&&pt.addEventListener("click",t=>{t.preventDefault(),Jt()}),c&&c.addEventListener("click",t=>{let r=t.target;if(!(r instanceof HTMLElement))return;let o=r.closest('button[data-role="delete-note"]');if(o&&c.contains(o)){t.preventDefault();let f=o.getAttribute("data-note-id");if(!f)return;let y=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(y?y("Delete this note? This cannot be undone."):!0)&&Xe(f);return}let s=r.closest('button[data-role="note-menu"]');if(s&&c.contains(s)){t.preventDefault();let f=s.getAttribute("data-note-id");if(!f)return;let y=L.find(N=>N.id===f);y&&Vt(y,s);return}let a=r.closest('button[data-role="open-note"]');if(a&&c.contains(a)){t.preventDefault();let f=a.getAttribute("data-note-id");if(!f)return;let y=L.find(N=>N.id===f);y&&(ee(y),ge(),k()&&w())}});let se=()=>{qe(Qe())};if(p){let t=A(()=>{d=typeof p.value=="string"?p.value:"",se()},180);p.addEventListener("input",t),p.addEventListener("search",t)}let Qt=()=>{de({preserveDraft:!1})};i.addEventListener("click",()=>{let t=Z(),r=Array.isArray(t)?[...t]:[],{title:o,body:s}=Dt(),a=o||"Untitled note",f=new Date().toISOString(),y=$&&$!=="all"?$:"unsorted";if(m){let N=r.findIndex(T=>T.id===m);if(N>=0)r[N]={...r[N],title:a,body:s,updatedAt:f,folderId:y};else{let T=ae(a,s,{updatedAt:f,folderId:y});m=T.id,r.unshift(T)}}else{let N=ae(a,s,{folderId:y});m=N.id,r.unshift(N)}J(r),Le(),de({preserveDraft:!1})});let gt=()=>{ee(null),$=C&&C!=="all"?C:"unsorted";let t=document.getElementById("note-folder-label");if(t&&(t.textContent=ye($)),ge(),typeof n.focus=="function")try{n.focus()}catch{}};l&&l.addEventListener("click",t=>{t.preventDefault(),gt()});let Be=document.getElementById("mobile-footer-new-note");Be&&Be.addEventListener("click",t=>{t.preventDefault();try{Be.getAttribute("data-nav-target")&&(document.querySelectorAll("[data-nav-target]").forEach(s=>s.classList.remove("active")),Be.classList.add("active"))}catch{}gt()});let xe=A(()=>{try{if(!Ue())return;i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}},1500);try{n.addEventListener("input",xe)}catch{}try{e.addEventListener("input",xe),e.addEventListener("keydown",j),e.addEventListener("blur",()=>{xe()}),n.addEventListener("blur",()=>xe())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",t=>{try{Ue()&&i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}}),Qt(),typeof window<"u"&&(window.addEventListener("storage",t=>{t.key===ve&&(he=t.newValue??null,de({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let t=He();t!==he&&(he=t,de({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",xt,{once:!0}):xt();var Je=Nt(),Ge=St({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:n=>{Je?.handleSessionChange(n)}});if(Ge?.supabase){Je?.setSupabaseClient(Ge.supabase);try{Ge.supabase.auth.getSession().then(({data:n})=>{Je?.handleSessionChange(n?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let n=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let i='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',l=n,c=E=>{if(!(E instanceof HTMLElement)||E.getAttribute("aria-hidden")==="true"||E.hasAttribute("disabled")||E.tabIndex<0)return!1;let x=E.getBoundingClientRect();return x.width>0||x.height>0},u=()=>Array.from(e.querySelectorAll(i)).filter(c),p=()=>{let E=e.classList.contains("hidden");e.setAttribute("aria-hidden",E?"true":"false")};p();let b=E=>{!e.contains(E.target)&&E.target!==n&&O({restoreFocus:!1})},D=()=>{let[E]=u();if(E instanceof HTMLElement)try{E.focus()}catch{}},H=()=>{e.classList.contains("hidden")&&(l=document.activeElement instanceof HTMLElement?document.activeElement:n,e.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),p(),document.addEventListener("focusin",b),!e.contains(document.activeElement)&&D())},O=({restoreFocus:E=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),n.setAttribute("aria-expanded","false"),p(),document.removeEventListener("focusin",b),E&&l instanceof HTMLElement))try{l.focus()}catch{}};n.addEventListener("click",E=>{E.stopPropagation(),e.classList.contains("hidden")?H():O()}),document.addEventListener("click",E=>{E.target===n||e.contains(E.target)||O({restoreFocus:!1})}),document.addEventListener("keydown",E=>{if(E.key==="Escape"){O();return}E.key==="ArrowDown"&&!e.classList.contains("hidden")&&(E.preventDefault(),D())}),e.addEventListener("click",E=>{E.stopPropagation(),E.target instanceof HTMLElement&&E.target.closest("button")&&O({restoreFocus:!1})}),e.addEventListener("keydown",E=>{if(E.key!=="Tab")return;let x=u();if(!x.length)return;let P=x.indexOf(document.activeElement),g=x.length-1,M=P;E.shiftKey?M=P<=0?g:P-1:M=P===g?0:P+1,E.preventDefault();let _=x[M]||x[0];if(_ instanceof HTMLElement)try{_.focus()}catch{}})})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let e=()=>{let c=document.getElementById("voiceBtn");return c instanceof HTMLElement?c:null},i=()=>{let c=e();if(!c)return;let u=()=>{c.hasAttribute("disabled")||c.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let b=c.getAttribute("title");b&&n.setAttribute("title",b)};u(),typeof MutationObserver=="function"&&new MutationObserver(u).observe(c,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i();let l=()=>{let c=e();if(c&&!(c.hasAttribute("disabled")||c.getAttribute("aria-disabled")==="true")){try{c.focus({preventScroll:!0})}catch{try{c.focus()}catch{}}try{c.click()}catch(u){console.warn("Voice add trigger failed",u)}}};n.addEventListener("click",c=>{c.preventDefault();let u=!1,p=null,b=()=>{u||(u=!0,document.removeEventListener("reminder:sheet-opened",D),l())},D=O=>{if(O?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&p&&(window.clearTimeout(p),p=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,150)};document.addEventListener("reminder:sheet-opened",D);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(O){document.removeEventListener("reminder:sheet-opened",D),typeof window<"u"&&typeof window.clearTimeout=="function"&&p&&(window.clearTimeout(p),p=null),console.warn("Voice add open failed",O);return}let H=document.getElementById("create-sheet");H instanceof HTMLElement&&H.classList.contains("open")&&(p=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let i=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],l=()=>{let u=e.hasAttribute("open");n.setAttribute("aria-expanded",String(u)),n.classList.toggle("btn-active",u)},c=()=>{for(let u of i){let p=e.querySelector(u);if(p instanceof HTMLElement&&!p.hasAttribute("disabled")){try{p.focus({preventScroll:!0})}catch{p.focus()}return}}};n.addEventListener("click",()=>{let u=e.hasAttribute("open");e.open=!u,u||c(),l()}),e.addEventListener("toggle",l),l()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function e(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let e=document.getElementById("totalCount");if(!e)return;let i=Array.isArray(n?.detail?.items)?n.detail.items.length:0;e.textContent=String(i)});document.addEventListener("click",n=>{try{let e=n.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let e=Array.from(n.children);if(e.length<=30)return;let i=20;n.innerHTML="";let l=0;function c(){let b=e.slice(l,l+i);b.forEach(D=>n.appendChild(D)),l+=b.length}c();let u=document.createElement("div");u.id="listSentinel",n.appendChild(u);let p=new IntersectionObserver(b=>{b.some(D=>D.isIntersecting)&&l<e.length&&(c(),l>=e.length&&p.disconnect())});p.observe(u)})();(function(){let n=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(u=>u instanceof HTMLElement),e=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!n.length||!e||!i)return;function l(){e.classList.remove("hidden")}function c(){e.classList.add("hidden")}n.forEach(u=>{u.addEventListener("click",l)}),i.addEventListener("click",c),e.addEventListener("click",u=>{u.target instanceof HTMLElement&&u.target.matches("[data-close]")&&c()}),e.addEventListener("keydown",u=>{u.key==="Escape"&&c()})})();(function(){let n=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),i=document.getElementById("mcStatusText"),l=document.getElementById("syncUrl"),c=document.getElementById("saveSyncSettings"),u=document.getElementById("testSync"),p=document.getElementById("syncAll"),b="syncUrl";if(!i)return;let D=["online","offline","error"],H=["online","offline"],O={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},E={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},x=null;function P(d){if(!e)return;H.forEach(I=>e.classList.remove(I));let S=d!=="offline"&&d!=="error";e.classList.add(S?"online":"offline"),e.setAttribute("aria-label",S?"Online":"Offline")}function g(d,S){x=d,D.forEach(B=>i.classList.remove(B)),n&&D.forEach(B=>n.classList.remove(B)),d==="online"?(i.classList.add("online"),n&&n.classList.add("online")):d==="error"?(i.classList.add("error"),n&&n.classList.add("error")):(i.classList.add("offline"),n&&n.classList.add("offline"));let I=typeof S=="string"&&S.trim()?S.trim():O[d]||"",F=typeof S=="string"&&S.trim()?S.trim():E[d]||I,k=I||F||"";i.textContent=k,k?(i.setAttribute("title",k),i.setAttribute("aria-label",k)):(i.removeAttribute("title"),i.removeAttribute("aria-label")),P(d),i.dataset.state=d}function M(){x!=="syncing"&&g(navigator.onLine?"online":"offline")}function _(d){typeof localStorage>"u"||(d?localStorage.setItem(b,d):localStorage.removeItem(b))}function q(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(b)||""}catch{return""}}function Y(d){if(!d||typeof d!="object")return null;let S=d.id||d.uid||d.key||d.slug||d.uuid,I=typeof d.title=="string"&&d.title.trim()?d.title.trim():typeof d.name=="string"?d.name.trim():"";if(!I)return null;let F=typeof d.dueIso=="string"&&d.dueIso?d.dueIso:typeof d.due=="string"?d.due:null,k=typeof d.priority=="string"&&d.priority.trim()?d.priority.trim():d.level||d.importance||"Medium",B=typeof d.category=="string"&&d.category.trim()?d.category.trim():d.group||d.bucket||"General",w=typeof d.done=="boolean"?d.done:!!(d.completed||d.isDone||d.status==="done");return{id:S||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:I,dueIso:F&&F.trim()?F.trim():null,priority:k,category:B,done:w}}function j(){let d=Array.from(document.querySelectorAll("[data-reminder]"));return d.length?d.map(S=>{let I=S.dataset||{},F=null;if(I.reminder)try{F=JSON.parse(I.reminder)}catch{F=null}let k=F||{id:I.id||I.reminderId||S.getAttribute("data-id")||null,title:I.title||I.reminderTitle||"",dueIso:I.due||I.reminderDue||S.getAttribute("data-due")||null,priority:I.priority||I.reminderPriority||S.getAttribute("data-priority")||"",category:I.category||I.reminderCategory||S.getAttribute("data-category")||"",done:I.done==="true"||I.reminderDone==="true"||S.getAttribute("data-done")==="true"};if(!k.title){let B=S.querySelector("[data-reminder-title], [data-title], h3, h4, strong");B&&(k.title=B.textContent.trim())}if(!k.dueIso){let B=S.querySelector("[data-due], time");if(B){let w=B.getAttribute("datetime")||B.getAttribute("data-due");k.dueIso=w||B.textContent.trim()}}return Y(k)}).filter(Boolean):[]}function A(){if(typeof localStorage>"u")return[];let d=[],S=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(F=>{if(!S.has(F)){S.add(F);try{let k=localStorage.getItem(F);if(!k)return;let B=JSON.parse(k);Array.isArray(B)?B.forEach(w=>d.push(w)):B&&typeof B=="object"&&(Array.isArray(B.items)&&B.items.forEach(w=>d.push(w)),Array.isArray(B.reminders)&&B.reminders.forEach(w=>d.push(w)))}catch{}}}),!d.length)for(let F=0;F<localStorage.length;F+=1){let k=localStorage.key(F);if(!(!k||S.has(k)||!/remind/i.test(k))){S.add(k);try{let B=localStorage.getItem(k);if(!B)continue;let w=JSON.parse(B);Array.isArray(w)?w.forEach(Q=>d.push(Q)):w&&typeof w=="object"&&(Array.isArray(w.items)&&w.items.forEach(Q=>d.push(Q)),Array.isArray(w.reminders)&&w.reminders.forEach(Q=>d.push(Q)))}catch{}}}return d.map(Y).filter(Boolean)}function m(){let d=j();return d.length?d:A()}function L(d){d?(p?.setAttribute("aria-busy","true"),p?.setAttribute("disabled","disabled"),u?.setAttribute("aria-busy","true"),u?.setAttribute("disabled","disabled")):(p?.removeAttribute("aria-busy"),u?.removeAttribute("aria-busy"),C())}function C(){!!((l?.value||"").trim()||q())?(p?.removeAttribute("disabled"),u?.removeAttribute("disabled")):(p?.setAttribute("disabled","disabled"),u?.setAttribute("disabled","disabled"))}let $=q();l&&$&&(l.value=$),C(),g(navigator.onLine?"online":"offline"),window.addEventListener("online",M),window.addEventListener("offline",M),l?.addEventListener("input",C),c?.addEventListener("click",()=>{let d=(l?.value||"").trim();if(!d){_(""),g("info","Sync URL cleared. Add one to enable sync."),C();return}try{let S=new URL(d);if(!/^https?:/.test(S.protocol))throw new Error("Invalid protocol")}catch{g("error","Enter a valid sync URL before saving.");return}_(d),g("online","Sync settings saved."),C()}),u?.addEventListener("click",async()=>{let d=(l?.value||q()).trim();if(!d){g("error","Add your sync URL in Settings first.");return}L(!0),g("syncing","Testing connection\u2026");try{(await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?g("online","Connection looks good."):g("error","Test failed. Check your Apps Script deployment.")}catch(S){console.error("Test sync failed",S),g("error","Test failed. Check your Apps Script deployment.")}finally{L(!1)}}),p?.addEventListener("click",async()=>{let d=(l?.value||q()).trim();if(!d){g("error","Add your sync URL in Settings first.");return}let S=m();if(!S.length){g("info","Nothing to sync right now.");return}L(!0),g("syncing",`Syncing ${S.length} reminder${S.length===1?"":"s"}\u2026`);let I=20,F=0,k=0,B=w=>({id:w.id,title:w.title,dueIso:w.dueIso||null,priority:w.priority||"Medium",category:w.category||"General",done:!!w.done,source:"memory-cue-mobile"});try{for(let w=0;w<S.length;w+=I){let Q=S.slice(w,w+I);(await Promise.allSettled(Q.map(G=>fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B(G))})))).forEach(G=>{G.status==="fulfilled"&&G.value?.ok?F+=1:(G.status,k+=1)}),await new Promise(G=>setTimeout(G,300))}k?F?g("error",`Partial sync: ${F} success, ${k} failed.`):g("error","Sync failed. Check your sync URL and retry."):g("online",`Sync complete. ${F} updated.`)}catch(w){console.error("Sync failed",w),g("error","Sync failed. Try again soon.")}finally{L(!1)}})})()});export default mn();
