import{b as T,c as M}from"./chunk-CTK42JWW.js";import{b as L}from"./chunk-GUVSRPRW.js";function x(t){if(s?.toast&&typeof s.toast=="function")try{s.toast(t);return}catch{}if(!(typeof document>"u"))try{let n=document.createElement("div");n.textContent=t,n.setAttribute("role","alert"),n.setAttribute("aria-live","polite"),n.style.cssText=`
      position: fixed;
      bottom: ${k};
      left: 50%;
      transform: translateX(-50%);
      background: rgba(30, 30, 30, 0.95);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: ${C};
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 90%;
      text-align: center;
    `,document.body.appendChild(n),setTimeout(()=>{try{n.remove()}catch{}},F)}catch{}}function N(t={}){try{Object.assign(s,t||{})}catch(n){console.warn("[supabase-auth] setAuthContext failed",n)}}async function W(t={}){try{if(s&&typeof s.signInWithPopup=="function"&&s.auth&&typeof s.GoogleAuthProvider=="function")return s.signInWithPopup(s.auth,new s.GoogleAuthProvider);if(s&&typeof s.signInWithRedirect=="function"&&s.auth&&typeof s.GoogleAuthProvider=="function")return s.signInWithRedirect(s.auth,new s.GoogleAuthProvider);let n=T();if(n&&n.auth){let a={redirectTo:typeof window<"u"&&window.location&&window.location.origin?`${window.location.origin}/oauth/consent`:void 0,...t};if(typeof n.auth.signInWithOAuth=="function")return n.auth.signInWithOAuth({provider:"google",...a});if(typeof n.auth.signIn=="function")return n.auth.signIn({provider:"google"})}console.warn("[supabase-auth] No auth provider configured. Sign-in unavailable."),x("Sign-in is not available. Authentication service may be offline or not configured.")}catch(n){throw console.error("[supabase-auth] startSignInFlow error",n),x("Sign-in failed. Please try again."),n}return Promise.resolve(null)}async function D(){try{if(s&&typeof s.signOut=="function")return s.signOut(s.auth);let t=T();if(t&&t.auth&&typeof t.auth.signOut=="function")return t.auth.signOut()}catch(t){throw console.error("[supabase-auth] startSignOutFlow error",t),t}return Promise.resolve(null)}function _(t){return t?Array.isArray(t)?t:[t]:[]}function b(t){return Array.from(new Set(t.filter(n=>n instanceof HTMLElement||typeof SVGElement<"u"&&n instanceof SVGElement)))}function o(t,n){let e=_(n).filter(Boolean);if(!e.length)return[];let a=e.flatMap(i=>Array.from(t.querySelectorAll(i)));return b(a)}function B(t,n=document){let e=n instanceof Document||n instanceof HTMLElement?n:document;return{authForms:o(e,t.authForm),emailInputs:o(e,t.emailInput),signInButtons:o(e,t.signInButtons),signOutButtons:o(e,t.signOutButtons),userBadges:o(e,t.userBadge),userBadgeEmails:o(e,t.userBadgeEmail),userBadgeInitials:o(e,t.userBadgeInitial),userNameEls:o(e,t.userName),syncStatusEls:o(e,t.syncStatus),syncStatusTextEls:o(e,t.syncStatusText),statusIndicatorEls:o(e,t.statusIndicator),feedbackEls:o(e,t.feedback)}}function y(t,n){b(Array.isArray(t)?t:[t]).forEach(e=>{e instanceof HTMLElement&&(e.classList.toggle("hidden",!n),n?e.removeAttribute("hidden"):e.setAttribute("hidden",""))})}function f(t,n){b(Array.isArray(t)?t:[t]).forEach(e=>{e instanceof HTMLElement&&(e.textContent=n||"")})}function U(t,n){b(t).forEach(e=>{e instanceof HTMLElement&&(e.dataset.state=n,e.classList.toggle("online",n==="online"),e.classList.toggle("offline",n!=="online"))})}function E(t,n){b(t).forEach(e=>{if(!(e instanceof HTMLElement))return;e.textContent=n||"";let a=!!n;e.classList.toggle("hidden",!a),a?e.removeAttribute("hidden"):e.setAttribute("hidden","")})}function w(t={}){let n={...O.syncStatusText,...t.syncStatusText||{}};return{...O,...t,syncStatusText:n}}function S(t,{user:n,messages:e}={}){let a=w(e),i=!!n;y(t.signInButtons,!i),y(t.authForms,!i),y(t.signOutButtons,i),y(t.userBadges,i);let l=typeof n?.email=="string"?n.email:"",u=l?l.charAt(0).toUpperCase():"U";i?(f(t.userBadgeEmails,l),f(t.userBadgeInitials,u),f(t.userNameEls,l)):(f(t.userBadgeEmails,""),f(t.userBadgeInitials,""),f(t.userNameEls,""));let I=typeof a.signedIn=="function"?a.signedIn(n):a.signedIn,r=typeof a.signedOut=="function"?a.signedOut(n):a.signedOut,g=i?I:r,d=!i;t.syncStatusEls.length&&(f(t.syncStatusEls,g),t.syncStatusEls.forEach(h=>{h instanceof HTMLElement&&(h.classList.toggle("online",i),h.dataset.state=i?"online":"offline")}),y(t.syncStatusEls,d));let A=i?a.syncStatusText?.signedIn:a.syncStatusText?.signedOut;f(t.syncStatusTextEls,A||""),U(t.statusIndicatorEls,i?"online":"offline"),E(t.feedbackEls,"")}function P(t,n){n.authForms.forEach(e=>{!(e instanceof HTMLFormElement)||e.dataset.supabaseAuthBound==="true"||(e.dataset.supabaseAuthBound="true",e.addEventListener("submit",async a=>{a.preventDefault();let i=n.emailInputs.find(u=>e.contains(u))||e.querySelector('input[type="email"]'),l=typeof i?.value=="string"?i.value.trim():"";if(!l){E(n.feedbackEls,"Enter an email address to continue.");return}try{let{error:u}=await t.auth.signInWithOtp({email:l});u?E(n.feedbackEls,u.message||"Unable to send magic link."):E(n.feedbackEls,"Magic link sent. Check your email.")}catch(u){E(n.feedbackEls,u?.message||"Unable to send magic link.")}}))})}function H(t,n){n.signOutButtons.forEach(e=>{!(e instanceof HTMLElement)||e.dataset.supabaseAuthBound==="true"||(e.dataset.supabaseAuthBound="true",e.addEventListener("click",async()=>{try{await t.auth.signOut()}catch(a){console.error("[supabase] Sign-out failed.",a)}}))})}function q(t={}){let{supabase:n,scope:e=document,selectors:a={},messages:i={},disableButtonBinding:l=!1,onSessionChange:u}=t,I={...m,...a},r=B(I,e),g=w(i);S(r,{user:null,messages:g});let d=n||T()||(typeof window<"u"?window.supabase:null);if(!d)return{supabase:null,elements:r,applyAuthState:c=>S(r,{...c,messages:g}),destroy(){}};P(d,r),l||H(d,r);let A=[],{data:h}=d.auth.onAuthStateChange((c,p)=>{if(S(r,{user:p?.user??null,messages:g}),typeof u=="function")try{u(p?.user??null,p)}catch(v){console.error("[supabase] onSessionChange handler failed.",v)}});return h?.subscription&&A.push(()=>{try{h.subscription.unsubscribe()}catch{}}),d.auth.getSession().then(({data:c,error:p})=>{p||S(r,{user:c?.session?.user??null,messages:g})}).catch(c=>{console.error("[supabase] getSession failed.",c)}),{supabase:d,elements:r,applyAuthState:c=>S(r,{...c,messages:g}),destroy(){A.forEach(c=>{try{c()}catch{}})}}}function $(t={},n=document){return B({...m,...t},n)}var s,F,k,C,m,O,R=L(()=>{M();s={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null},F=4e3,k="80px",C=1e4;m={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},O={signedOut:"",signedIn:t=>`Reminders syncing for ${t?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});export{N as a,W as b,D as c,m as d,O as e,S as f,q as g,$ as h,R as i};
