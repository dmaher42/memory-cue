import{a as $e,b as pt,c as Ve,d as gt,e as Le,g as ht}from"./chunk-NQOL4S2N.js";import{a as qe,b as mt}from"./chunk-MG4MJA24.js";import{b as Pe,c as yt}from"./chunk-CTK42JWW.js";import{b as _e,c as ft}from"./chunk-GUVSRPRW.js";var se,Ye,Et,W,Ie,Ge,je,Je,Te,Ke,j,fe,ze,bt,Q,J,we,V,X,We,Z=_e(()=>{se="memoryCueNotes",Ye="memoryCueFolders",Et=["mobileNotes"],W=()=>typeof localStorage<"u",Ie=null,Ge=t=>{Ie=typeof t=="function"?t:null},je=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Je=t=>{if(typeof t!="string")return"";let e=t.trim();return e.length?(/[<>]/.test(e),t):""},Te=t=>{if(typeof t!="string")return"";let e=t.trim();return e.length?/[<>]/.test(e)?t:Je(t):""},Ke=t=>{if(typeof t!="string")return!1;let e=Date.parse(t);return!Number.isNaN(e)},j=(t,e,r={})=>{let s=typeof t=="string"?t.trim():"";return{id:r.id&&typeof r.id=="string"?r.id:je(),title:s||"Untitled note",body:Te(e),updatedAt:r.updatedAt&&Ke(r.updatedAt)?r.updatedAt:new Date().toISOString(),folderId:r.folderId&&typeof r.folderId=="string"?r.folderId:null}},fe=t=>{if(Array.isArray(t))return t.map(e=>{if(!e||typeof e!="object")return null;let r=typeof e.title=="string"?e.title.trim():"",s=Te(e.body),c=typeof e.id=="string"&&e.id.trim()?e.id:je(),d=Ke(e.updatedAt)?e.updatedAt:new Date().toISOString();return!r&&!s&&!e.body?null:{id:c,title:r||"Untitled note",body:s,updatedAt:d,folderId:typeof e.folderId=="string"&&e.folderId?e.folderId:null}}).filter(Boolean);if(t&&typeof t=="object"){let e=typeof t.title=="string"?t.title:"",r=typeof t.body=="string"?t.body:"",s=Te(r);return!e&&!s?[]:[j(e,s,{id:typeof t.id=="string"?t.id:void 0,updatedAt:typeof t.updatedAt=="string"?t.updatedAt:void 0,folderId:typeof t.folderId=="string"?t.folderId:void 0})]}return typeof t=="string"&&t.trim().length?[j("Notebook (legacy)",Je(t))]:[]},ze=t=>{if(!W())return null;try{return localStorage.getItem(t)}catch{return null}},bt=t=>{if(W())try{localStorage.removeItem(t)}catch{}},Q=()=>{if(!W())return[];let t=ze(se);if(typeof t=="string")try{let e=JSON.parse(t),r=fe(e);if(r.length)return r}catch{let e=fe(t);if(e.length)return J(e),e}for(let e of Et){let r=ze(e);if(typeof r=="string"&&r.trim().length){let s=fe(r);if(s.length)return J(s),bt(e),s}}return[]},J=(t,e={})=>{if(!W()||!Array.isArray(t))return!1;let r=t.map(s=>{let d=fe([s])[0];return d&&(d.folderId=typeof s.folderId=="string"&&s.folderId?s.folderId:d.folderId||null),d}).filter(Boolean);try{if(localStorage.setItem(se,JSON.stringify(r)),!e.skipRemoteSync&&typeof Ie=="function")try{let s=Ie(r);s&&typeof s.then=="function"&&s.catch(c=>{console.error("[notes-storage] Remote sync failed.",c)})}catch(s){console.error("[notes-storage] Remote sync handler threw.",s)}return!0}catch{return!1}},we=()=>[{id:"unsorted",name:"Unsorted"}],V=()=>{if(!W())return we();try{let t=localStorage.getItem(Ye);if(typeof t=="string"){let e=JSON.parse(t);if(Array.isArray(e)&&e.length)return e.map(r=>({id:String(r.id),name:String(r.name)}))}}catch{}return we()},X=t=>{let r=V().find(s=>s&&String(s.id)===String(t));return r?String(r.name):"Unsorted"},We=t=>{if(!W()||!Array.isArray(t))return!1;try{let e=t.filter(r=>r&&typeof r.id=="string"&&r.id.trim()).map(r=>({id:r.id,name:typeof r.name=="string"?r.name:String(r.id)}));return e.length||e.push(...we()),localStorage.setItem(Ye,JSON.stringify(e)),!0}catch{return!1}}});var St,vt,At,me,Lt,It,Qe,Xe=_e(()=>{yt();Z();St="notes",vt="user_id",At="updated_at",me=t=>{if(typeof t!="string")return 0;let e=Date.parse(t);return Number.isNaN(e)?0:e},Lt=(t=[],e=[])=>{let r=new Map;return e.forEach(s=>{s&&typeof s.id=="string"&&r.set(s.id,s)}),t.forEach(s=>{if(!s||typeof s.id!="string")return;let c=r.get(s.id);if(!c){r.set(s.id,s);return}let d=me(s.updatedAt),f=me(c.updatedAt);d>f&&r.set(s.id,s)}),Array.from(r.values()).sort((s,c)=>me(c?.updatedAt)-me(s?.updatedAt))},It=t=>e=>{if(!e||typeof e!="object")return null;let r={id:typeof e.id=="string"&&e.id?e.id:void 0,updatedAt:typeof e[t]=="string"?e[t]:void 0,folderId:typeof e.folder_id=="string"&&e.folder_id?e.folder_id:void 0};return j(e.title,e.body,r)},Qe=(t={})=>{let{tableName:e=St,userColumn:r=vt,updatedAtColumn:s=At,supabase:c=null}=t,d=c||null,f=null,g=!1,k=new Set,O=()=>d||(d=Pe(),d),x=It(s),p=async m=>{let N=O();if(!N||!f)return;let D=(Array.isArray(m)?m.filter(E=>E&&typeof E.id=="string"):[]).map(E=>({id:E.id,[r]:f,title:E.title,body:E.body,folder_id:typeof E.folderId=="string"&&E.folderId?E.folderId:null,[s]:typeof E.updatedAt=="string"&&E.updatedAt?E.updatedAt:new Date().toISOString()})),R=new Set(D.map(E=>E.id));if(D.length){let{error:E}=await N.from(e).upsert(D);if(E)throw E}let _=[...k].filter(E=>E&&!R.has(E));if(_.length){let{error:E}=await N.from(e).delete().in("id",_).eq(r,f);if(E)throw E}k=new Set(R)},C=async()=>{let m=O();if(!(!m||!f))try{let{data:N,error:M}=await m.from(e).select(`id,title,body,folder_id,${s}`).eq(r,f);if(M)throw M;let D=Array.isArray(N)?N:[];k=new Set(D.map(S=>typeof S.id=="string"?S.id:null).filter(Boolean));let R=D.map(x).filter(Boolean),_=Q();if(!R.length){if(_.length)try{await p(_)}catch(S){console.error("[notes-sync] Failed to upload local notes to Supabase.",S)}return}let E=Lt(_,R);g=!0;let l=J(E,{skipRemoteSync:!0});g=!1,l||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await p(E)}catch(S){console.error("[notes-sync] Failed to reconcile notes with Supabase.",S)}}catch(N){console.error("[notes-sync] Failed to fetch notes from Supabase.",N)}finally{g=!1}};return Ge(async m=>{if(!g)try{await p(m)}catch(N){console.error("[notes-sync] Failed to sync notes to Supabase.",N)}}),{setSupabaseClient(m){m&&(d=m)},handleSessionChange:async m=>{if(f=typeof m?.id=="string"?m.id:null,!f){k=new Set;return}await C()},syncFromRemote:C}}});var Tt=ft(()=>{mt();gt();pt();Z();Z();Z();Xe();ht();Z();qe();(function(){let t=()=>{let e=document.getElementById("create-sheet"),r=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(r instanceof HTMLElement)){let l=typeof t._retryCount=="number"?t._retryCount:0;l<10&&(t._retryCount=l+1,setTimeout(t,50));return}if(t._initialised)return;t._initialised=!0;let s=e.querySelector("[data-dialog-content]"),c=e.querySelector(".sheet-backdrop"),d=document.getElementById("createReminderForm"),f=document.getElementById("saveReminder"),g=document.getElementById("priority"),k=document.getElementById("priorityChips"),O=k?Array.from(k.querySelectorAll('input[name="priority"]')):[],x=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),p=Array.from(x).filter(l=>l instanceof HTMLElement),C=p[0]||null,U=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};U();let m=null,N=(l,S)=>{try{document.dispatchEvent(new CustomEvent(l,{detail:S}))}catch(T){console.warn(`${l} dispatch failed`,T)}},M=()=>{let l=g?.value||"Medium";O.forEach(S=>{let T=S.value===l;S.checked=T,S.setAttribute("aria-checked",T?"true":"false")})},D=l=>{g&&(g.value!==l&&(g.value=l,g.dispatchEvent(new Event("change",{bubbles:!0}))),M())};O.forEach(l=>{l.addEventListener("change",()=>{l.checked&&D(l.value)})}),g?.addEventListener("change",M),M();let R=()=>{let l=e.querySelector('input, textarea, select, button, [contenteditable="true"]');l instanceof HTMLElement&&setTimeout(()=>{try{l.focus()}catch{}},0)},_=l=>{m=l instanceof HTMLElement?l:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),m&&m.setAttribute("aria-expanded","true"),M(),R(),N("reminder:sheet-opened",{trigger:m})},E=(l="dismissed")=>{let S=!e.classList.contains("hidden");U(),m&&m.setAttribute("aria-expanded","false");let T=m&&document.body.contains(m)&&m||C;if(T&&typeof T.focus=="function")try{T.focus()}catch{}S&&N("reminder:sheet-closed",{reason:l,trigger:m}),m=null};p.forEach(l=>{l.addEventListener("click",S=>{S.preventDefault();let T={mode:"create",trigger:l};N("cue:prepare",T),N("cue:open",T)})}),r.addEventListener("click",l=>{l.preventDefault(),E("close-button")}),c?.addEventListener("click",l=>{l.target===c&&E("backdrop")}),e.addEventListener("keydown",l=>{l.key==="Escape"&&(l.stopPropagation(),E("escape"))}),s?.addEventListener("click",l=>{l.stopPropagation()}),e.addEventListener("click",l=>{l.target instanceof HTMLElement&&l.target.hasAttribute("data-close")&&E("backdrop")}),document.addEventListener("cue:open",l=>{M(),_(l?.detail?.trigger||null)}),document.addEventListener("cue:close",l=>{E(l?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{M()}),document.addEventListener("cue:cancelled",()=>{E("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=E),document.addEventListener("reminder:save",l=>{if(!(f instanceof HTMLElement))return;let S=l?.detail?.trigger;S&&S!==f||f.matches(":disabled")||f.click()}),d instanceof HTMLFormElement&&f instanceof HTMLElement&&d.addEventListener("submit",l=>{l.preventDefault(),!f.matches(":disabled")&&f.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();var ye=()=>{ye._initialised||(ye._initialised=!0,Ve({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(t=>{console.error("Failed to initialise reminders:",t)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ye,{once:!0}):ye();var Ze=()=>{let t=document.getElementById("notifHeaderBtn"),e=document.getElementById("notifBtn");t&&e&&t.addEventListener("click",()=>{e.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ze,{once:!0}):Ze();var et=()=>{if(typeof document>"u")return;let t=document.getElementById("noteTitleMobile"),e=document.getElementById("scratchNotesEditor"),r=document.getElementById("noteSaveMobile"),s=document.getElementById("noteNewMobile"),c=document.getElementById("notesListMobile"),d=document.getElementById("notesCountMobile"),f=document.getElementById("notesSearchMobile"),g=document.getElementById("savedNotesSheet"),k=document.getElementById("openSavedNotesSheet"),O=document.querySelector('[data-action="close-saved-notes"]'),x="shadow-[0_0_0_3px_var(--accent-color)]",C=(()=>{if(!e)return null;let o=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return o?new o("#scratchNotesEditor",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.dataset.placeholder="Start typing your note\u2026",{element:e,setContent(n=""){e.innerHTML=n||""},getHTML(){return e.innerHTML||""},getText(){return e.textContent||""},focus(){try{e.focus()}catch{}}})})();if(!t||!C||!e||!r)return;let U=document.getElementById("scratchNotesToolbar");U&&e&&U.addEventListener("click",o=>{let n=o.target.closest("button[data-format]");if(!n)return;let a=n.getAttribute("data-format");try{e.focus()}catch{}switch(a){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"ul":document.execCommand("insertUnorderedList",!1,null);break;case"ol":document.execCommand("insertOrderedList",!1,null);break;default:break}});let m=(o="")=>{if(C&&typeof C.setContent=="function"){C.setContent(o||"");return}e.innerHTML=o||""},N=()=>C&&typeof C.getHTML=="function"?C.getHTML()||"":e.innerHTML||"",M=()=>C&&typeof C.getText=="function"?C.getText()||"":e.textContent||"",D=o=>{let n=o;for(;n&&n!==e;){if(n.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(n.tagName?.toLowerCase()))return n;n=n.parentNode}return e},R=o=>{if(typeof o!="string")return null;let n=o.replace(/\u00a0/g," ").trim();return n==="*"?"ul":n==="1"?"ol":null},_=o=>{if(![" ","Enter"].includes(o.key))return;let n=window.getSelection();if(!n||n.rangeCount===0)return;let a=n.getRangeAt(0);if(!e.contains(a.startContainer))return;let u=D(a.startContainer),y=a.cloneRange();y.selectNodeContents(u),y.setEnd(a.startContainer,a.startOffset);let b=R(y.toString());if(!b)return;o.preventDefault();let q=(u.textContent||"").replace(/^\s*[\*1]\s?/,"");u.textContent=q;let H=u.firstChild||u,ie=document.createRange();ie.setStart(H,(H.nodeType===Node.TEXT_NODE,0)),ie.collapse(!0),n.removeAllRanges(),n.addRange(ie);try{e.focus()}catch{}document.execCommand(b==="ul"?"insertUnorderedList":"insertOrderedList",!1,null)},E=(o,n=200)=>{let a;return(...u)=>{a&&clearTimeout(a),a=setTimeout(()=>{o(...u)},n)}},l=null,S=[],T="all",F=null,i="",h=!1,v=null,B=()=>g?.dataset.open==="true",w=()=>{g&&(v&&(clearTimeout(v),v=null),g.classList.remove("hidden"),g.dataset.open="true",g.setAttribute("aria-hidden","false"))},L=()=>{g&&(g.dataset.open="false",g.setAttribute("aria-hidden","true"),v&&clearTimeout(v),v=setTimeout(()=>{g?.classList.add("hidden")},200))};(()=>{g&&(k?.addEventListener("click",o=>{o.preventDefault(),w();let n=document.getElementById("notesListMobile");n&&(n.scrollTop=0)}),O?.addEventListener("click",o=>{o.preventDefault(),L()}),g.addEventListener("click",o=>{o.target===g&&L()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&B()&&L()}))})();let P=()=>typeof i=="string"?i.trim().toLowerCase():"",pe=(o=S)=>{if(!Array.isArray(o))return[];let n=P();return n?o.filter(a=>{let u=typeof a?.title=="string"?a.title.toLowerCase():"",y=typeof a?.body=="string"?a.body.toLowerCase():"";return u.includes(n)||y.includes(n)}):[...o]},$=(o=S)=>{if(!Array.isArray(o))return[];let n;return T===null||T==="all"?n=[...o]:T==="unsorted"?n=o.filter(a=>!a.folderId||a.folderId==="unsorted"):n=o.filter(a=>a.folderId===T),pe(n)},z=o=>{if(!o){l=null,t.value="",m(""),delete t.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;let y=document.getElementById("note-folder-label");y&&!F&&(y.textContent=X("unsorted"));return}l=o.id;let n=o.title||"",a=o.body||"";t.value=n,m(a),t.dataset.noteOriginalTitle=n,e.dataset.noteOriginalBody=a,F=o.folderId&&typeof o.folderId=="string"?o.folderId:"unsorted";let u=document.getElementById("note-folder-label");u&&(u.textContent=X(F))},tt=()=>({title:typeof t.value=="string"?t.value.trim():"",body:N()}),ee=()=>{if(!c)return;c.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(n=>{if(!(n instanceof HTMLElement))return;let a=n.getAttribute("data-note-id")===l;a?n.setAttribute("data-state","active"):n.removeAttribute("data-state"),n.classList.toggle("active",a),n.classList.toggle("outline",a),n.classList.toggle("outline-2",a),n.classList.toggle("outline-accent",a),n.classList.toggle(x,a),n.setAttribute("aria-current",a?"true":"false")})},nt=o=>{if(!o)return"";let n=new Date(o);if(Number.isNaN(n.getTime()))return"";let a=new Date,u=n.getFullYear()===a.getFullYear()&&n.getMonth()===a.getMonth()&&n.getDate()===a.getDate(),y=n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return u?`Today \xB7 ${y}`:`${n.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${y}`},ge=()=>{let o=typeof t.value=="string"?t.value:"",n=N(),a=t.dataset.noteOriginalTitle??"",u=e.dataset.noteOriginalBody??"";return o!==a||n!==u},ot=()=>{let o=Q();return Array.isArray(o)?[...o].sort((n,a)=>{let u=Date.parse(n?.updatedAt||""),y=Date.parse(a?.updatedAt||"");return(Number.isNaN(y)?0:y)-(Number.isNaN(u)?0:u)}):[]},he=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(se)}catch{return null}},te=he(),ae=()=>(te=he(),te),ne=({preserveDraft:o=!0}={})=>{let n=ot();S=Array.isArray(n)?[...n]:[];let a=o&&ge(),u=S.length>0,y=$();if(Be(y),!u)return a||z(null),ee(),ae(),h=!1,y;if(l){let b=S.find(I=>I.id===l)||null;b?a||z(b):(l=null,!a&&!h&&S[0]&&z(S[0]))}else!a&&!h&&S[0]&&z(S[0]);return h=!1,ee(),ae(),y},rt=o=>{if(!o)return;let n=Q();if(!Array.isArray(n))return;let a=n.filter(u=>u.id!==o);a.length!==n.length&&(J(a),ae(),l===o&&(z(null),h=!0),ne({preserveDraft:!1}))},Be=(o=[])=>{if(!c)return o;if(c.innerHTML="",d){let n=S.length,a=o.length;d.textContent=n?`${a} of ${n} saved`:"No saved notes yet"}if(!o.length){let n=document.createElement("li");return n.className="text-xs italic text-base-content/60 px-3 py-4 text-center rounded-2xl border border-dashed border-base-200/80 bg-base-100/50",n.textContent=S.length&&P()?"No notes match this filter.":"No saved notes yet.",c.appendChild(n),o}return o.forEach(n=>{let a=document.createElement("li");a.className="note-item-mobile w-full";let u=document.createElement("button");u.type="button",u.dataset.noteId=n.id,u.dataset.role="open-note",u.className="saved-note-item note-list-item w-full text-left active:scale-[0.99] focus:outline-none";let y=document.createElement("div");y.className="flex items-center justify-between gap-2";let b=document.createElement("div");b.className="flex items-center gap-2";let I=document.createElement("span");I.className="saved-note-title note-list-title truncate";let q=n.title||"Untitled";I.textContent=q,I.setAttribute("title",q);let H=document.createElement("span");H.className="note-folder-badge";let ie=n.folderId&&typeof n.folderId=="string"?n.folderId:"unsorted";H.textContent=X(ie);let ve=document.createElement("span");ve.className="saved-note-meta note-list-meta";let Re=n.updatedAt||n.modifiedAt||n.createdAt||"";ve.textContent=Re?nt(Re):"",b.appendChild(I),b.appendChild(H),y.appendChild(b),y.appendChild(ve);let Ae=document.createElement("p");Ae.className="saved-note-preview note-list-preview line-clamp-2";let ct=n.body||"",ut=String(ct).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();Ae.textContent=ut||"No content yet.",u.appendChild(y),u.appendChild(Ae);let G=document.createElement("button");G.type="button",G.dataset.noteId=n.id,G.dataset.role="delete-note",G.className="delete-note-btn btn btn-ghost btn-xs text-error shrink-0 focus-visible:outline-none focus-visible:ring-0",G.setAttribute("aria-label","Delete note"),G.textContent="\u2715";let ue=document.createElement("div");ue.className="flex items-start justify-between gap-3",ue.appendChild(u),ue.appendChild(G),a.appendChild(ue),c.appendChild(a)}),ee(),o},oe=document.getElementById("notebook-folder-bar"),ke=()=>{if(!oe)return;oe.innerHTML="";let o=[];try{o=Array.isArray(V())?V():[]}catch{o=[]}o.some(b=>b&&b.id==="unsorted")||o.unshift({id:"unsorted",name:"Unsorted"});let a=o.filter(b=>b&&b.id!=="unsorted").sort((b,I)=>String(b.name).localeCompare(String(I.name))),u=[];u.push({id:"all",name:"All"}),u.push({id:"unsorted",name:"Unsorted"}),u.push(...a),u.forEach(b=>{let I=document.createElement("button");I.type="button",I.className="folder-chip",I.dataset.folderId=b.id,I.textContent=b.name,String(T)===String(b.id)&&I.classList.add("active"),I.addEventListener("click",()=>{T=b.id==="all"?"all":b.id,oe.querySelectorAll(".folder-chip").forEach(H=>H.classList.remove("active")),I.classList.add("active"),Se()}),oe.appendChild(I)});let y=document.createElement("button");y.type="button",y.className="folder-chip outlined",y.textContent="+ New folder",y.addEventListener("click",b=>{b.preventDefault(),st()}),oe.appendChild(y)},wt=()=>{try{ke()}catch(o){console.warn("[notebook] Unable to build folder bar",o)}},xe=document.getElementById("newFolderModal"),Y=document.getElementById("newFolderName"),K=document.getElementById("newFolderError"),Fe=document.getElementById("newFolderCreate"),it=document.getElementById("newFolderCancel"),le=null,Me=()=>{K&&(K.classList.add("sr-only"),K.textContent="")},Ee=o=>{K&&(K.textContent=o,K.classList.remove("sr-only"))},st=()=>{xe&&(le||(le=new Le({modalElement:xe,closeButton:it,titleInput:Y,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),Me(),Y&&(Y.value=""),le.show())},De=()=>{if(!Y)return;let n=String(Y.value||"").trim();if(Me(),!n.length){Ee("Folder name can't be empty.");return}let a=[];try{a=Array.isArray(V())?V():[]}catch{a=[]}if(a.some(H=>String(H.name).toLowerCase()===n.toLowerCase())){Ee("You already have a folder with this name.");return}let y=`folder-${Date.now().toString(36)}`,b={id:y,name:n},I=[...a.filter(Boolean),b];if(!We(I)){Ee("Unable to create folder. Please try again.");return}try{le.requestClose("created")}catch{}T=y;try{ke()}catch(H){console.warn("[notebook] rebuild folder chips failed",H)}Se()};Fe&&Fe.addEventListener("click",o=>{o.preventDefault(),De()}),Y&&Y.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),De())});let Oe=document.getElementById("pickFolderModal"),be=document.getElementById("pickFolderList"),Ue=document.getElementById("pickFolderConfirm"),at=document.getElementById("pickFolderCancel"),de=null,re=null,lt=()=>{if(!Oe||!be)return;be.innerHTML="";let o=[];try{o=Array.isArray(V())?V():[]}catch{o=[]}o.some(n=>n&&n.id==="unsorted")||o.unshift({id:"unsorted",name:"Unsorted"}),o.forEach(n=>{let a=document.createElement("div");a.className="flex items-center gap-3 p-2 rounded-md hover:bg-base-100";let u=document.createElement("input");u.type="radio",u.name="pick-folder",u.value=n.id,u.id=`pick-folder-${n.id}`,(String(n.id)===String(F)||!F&&n.id==="unsorted")&&(u.checked=!0,re=n.id),u.addEventListener("change",()=>{re=u.value});let y=document.createElement("label");y.setAttribute("for",u.id),y.textContent=n.name,a.appendChild(u),a.appendChild(y),be.appendChild(a)}),de||(de=new Le({modalElement:Oe,closeButton:at,titleInput:null,autoFocus:!0})),de.show()};Ue&&Ue.addEventListener("click",o=>{if(o.preventDefault(),!re)return;F=re==="unsorted"?"unsorted":re;let n=document.getElementById("note-folder-label");n&&(n.textContent=X(F));try{de.requestClose("selected")}catch{}});let He=document.getElementById("note-folder-button");He&&He.addEventListener("click",o=>{o.preventDefault(),lt()}),c&&c.addEventListener("click",o=>{let n=o.target;if(!(n instanceof HTMLElement))return;let a=n.closest('button[data-role="delete-note"]');if(a&&c.contains(a)){o.preventDefault();let y=a.getAttribute("data-note-id");if(!y)return;let b=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(b?b("Delete this note? This cannot be undone."):!0)&&rt(y);return}let u=n.closest('button[data-role="open-note"]');if(u&&c.contains(u)){o.preventDefault();let y=u.getAttribute("data-note-id");if(!y)return;let b=S.find(I=>I.id===y);b&&(z(b),ee(),B()&&L())}});let Se=()=>{Be(pe())};if(f){let o=E(()=>{i=typeof f.value=="string"?f.value:"",Se()},180);f.addEventListener("input",o),f.addEventListener("search",o)}let dt=()=>{ne({preserveDraft:!1})};r.addEventListener("click",()=>{let o=Q(),n=Array.isArray(o)?[...o]:[],{title:a,body:u}=tt(),y=a||"Untitled note",b=new Date().toISOString();if(l){let I=n.findIndex(q=>q.id===l);if(I>=0)n[I]={...n[I],title:y,body:u,updatedAt:b,folderId:F==="all"?null:F||null};else{let q=j(y,u,{updatedAt:b,folderId:F==="all"?null:F||null});l=q.id,n.unshift(q)}}else{let I=j(y,u,{folderId:F==="all"?null:F||null});l=I.id,n.unshift(I)}J(n),ae(),ne({preserveDraft:!1})}),s&&s.addEventListener("click",()=>{z(null),F=T&&T!=="all"?T:"unsorted";let o=document.getElementById("note-folder-label");o&&(o.textContent=X(F)),ee(),typeof t.focus=="function"&&t.focus()});let ce=E(()=>{try{if(!ge())return;r instanceof HTMLElement&&!r.matches(":disabled")&&r.click()}catch{}},1500);try{t.addEventListener("input",ce)}catch{}try{e.addEventListener("input",ce),e.addEventListener("keydown",_),e.addEventListener("blur",()=>{ce()}),t.addEventListener("blur",()=>ce())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",o=>{try{ge()&&r instanceof HTMLElement&&!r.matches(":disabled")&&r.click()}catch{}}),dt(),typeof window<"u"&&(window.addEventListener("storage",o=>{o.key===se&&(te=o.newValue??null,ne({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let o=he();o!==te&&(te=o,ne({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",et,{once:!0}):et();var Ne=Qe(),Ce=$e({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:t=>{Ne?.handleSessionChange(t)}});if(Ce?.supabase){Ne?.setSupabaseClient(Ce.supabase);try{Ce.supabase.auth.getSession().then(({data:t})=>{Ne?.handleSessionChange(t?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let t=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let r='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',s=t,c=p=>{if(!(p instanceof HTMLElement)||p.getAttribute("aria-hidden")==="true"||p.hasAttribute("disabled")||p.tabIndex<0)return!1;let C=p.getBoundingClientRect();return C.width>0||C.height>0},d=()=>Array.from(e.querySelectorAll(r)).filter(c),f=()=>{let p=e.classList.contains("hidden");e.setAttribute("aria-hidden",p?"true":"false")};f();let g=p=>{!e.contains(p.target)&&p.target!==t&&x({restoreFocus:!1})},k=()=>{let[p]=d();if(p instanceof HTMLElement)try{p.focus()}catch{}},O=()=>{e.classList.contains("hidden")&&(s=document.activeElement instanceof HTMLElement?document.activeElement:t,e.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),f(),document.addEventListener("focusin",g),!e.contains(document.activeElement)&&k())},x=({restoreFocus:p=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),t.setAttribute("aria-expanded","false"),f(),document.removeEventListener("focusin",g),p&&s instanceof HTMLElement))try{s.focus()}catch{}};t.addEventListener("click",p=>{p.stopPropagation(),e.classList.contains("hidden")?O():x()}),document.addEventListener("click",p=>{p.target===t||e.contains(p.target)||x({restoreFocus:!1})}),document.addEventListener("keydown",p=>{if(p.key==="Escape"){x();return}p.key==="ArrowDown"&&!e.classList.contains("hidden")&&(p.preventDefault(),k())}),e.addEventListener("click",p=>{p.stopPropagation(),p.target instanceof HTMLElement&&p.target.closest("button")&&x({restoreFocus:!1})}),e.addEventListener("keydown",p=>{if(p.key!=="Tab")return;let C=d();if(!C.length)return;let U=C.indexOf(document.activeElement),m=C.length-1,N=U;p.shiftKey?N=U<=0?m:U-1:N=U===m?0:U+1,p.preventDefault();let M=C[N]||C[0];if(M instanceof HTMLElement)try{M.focus()}catch{}})})();(()=>{let t=document.getElementById("voiceAddBtn");if(!(t instanceof HTMLElement))return;let e=()=>{let c=document.getElementById("voiceBtn");return c instanceof HTMLElement?c:null},r=()=>{let c=e();if(!c)return;let d=()=>{c.hasAttribute("disabled")||c.getAttribute("aria-disabled")==="true"?(t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"));let g=c.getAttribute("title");g&&t.setAttribute("title",g)};d(),typeof MutationObserver=="function"&&new MutationObserver(d).observe(c,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r();let s=()=>{let c=e();if(c&&!(c.hasAttribute("disabled")||c.getAttribute("aria-disabled")==="true")){try{c.focus({preventScroll:!0})}catch{try{c.focus()}catch{}}try{c.click()}catch(d){console.warn("Voice add trigger failed",d)}}};t.addEventListener("click",c=>{c.preventDefault();let d=!1,f=null,g=()=>{d||(d=!0,document.removeEventListener("reminder:sheet-opened",k),s())},k=x=>{if(x?.detail?.trigger!==t)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&f&&(window.clearTimeout(f),f=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(g,150)};document.addEventListener("reminder:sheet-opened",k);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:t}}))}catch(x){document.removeEventListener("reminder:sheet-opened",k),typeof window<"u"&&typeof window.clearTimeout=="function"&&f&&(window.clearTimeout(f),f=null),console.warn("Voice add open failed",x);return}let O=document.getElementById("create-sheet");O instanceof HTMLElement&&O.classList.contains("open")&&(f=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(g,120))})})();(()=>{let t=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let r=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],s=()=>{let d=e.hasAttribute("open");t.setAttribute("aria-expanded",String(d)),t.classList.toggle("btn-active",d)},c=()=>{for(let d of r){let f=e.querySelector(d);if(f instanceof HTMLElement&&!f.hasAttribute("disabled")){try{f.focus({preventScroll:!0})}catch{f.focus()}return}}};t.addEventListener("click",()=>{let d=e.hasAttribute("open");e.open=!d,d||c(),s()}),e.addEventListener("toggle",s),s()})();(()=>{let t=document.getElementById("create-sheet");if(!(t instanceof HTMLElement))return;function e(){!t.classList.contains("open")&&t.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",t=>{let e=document.getElementById("totalCount");if(!e)return;let r=Array.isArray(t?.detail?.items)?t.detail.items.length:0;e.textContent=String(r)});document.addEventListener("click",t=>{try{let e=t.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let r=document.createElement("div");r.textContent="Save clicked",r.style.position="fixed",r.style.right="16px",r.style.bottom="16px",r.style.background="rgba(34,197,94,0.95)",r.style.color="#fff",r.style.padding="8px 12px",r.style.borderRadius="8px",r.style.zIndex="99999",document.body.appendChild(r),setTimeout(()=>r.remove(),900)}catch{}}}catch{}});(function(){let t=document.getElementById("reminderList");if(!t)return;let e=Array.from(t.children);if(e.length<=30)return;let r=20;t.innerHTML="";let s=0;function c(){let g=e.slice(s,s+r);g.forEach(k=>t.appendChild(k)),s+=g.length}c();let d=document.createElement("div");d.id="listSentinel",t.appendChild(d);let f=new IntersectionObserver(g=>{g.some(k=>k.isIntersecting)&&s<e.length&&(c(),s>=e.length&&f.disconnect())});f.observe(d)})();(function(){let t=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(d=>d instanceof HTMLElement),e=document.getElementById("settingsModal"),r=document.getElementById("closeSettings");if(!t.length||!e||!r)return;function s(){e.classList.remove("hidden")}function c(){e.classList.add("hidden")}t.forEach(d=>{d.addEventListener("click",s)}),r.addEventListener("click",c),e.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.matches("[data-close]")&&c()}),e.addEventListener("keydown",d=>{d.key==="Escape"&&c()})})();(function(){let t=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),r=document.getElementById("mcStatusText"),s=document.getElementById("syncUrl"),c=document.getElementById("saveSyncSettings"),d=document.getElementById("testSync"),f=document.getElementById("syncAll"),g="syncUrl";if(!r)return;let k=["online","offline","error"],O=["online","offline"],x={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},p={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},C=null;function U(i){if(!e)return;O.forEach(v=>e.classList.remove(v));let h=i!=="offline"&&i!=="error";e.classList.add(h?"online":"offline"),e.setAttribute("aria-label",h?"Online":"Offline")}function m(i,h){C=i,k.forEach(L=>r.classList.remove(L)),t&&k.forEach(L=>t.classList.remove(L)),i==="online"?(r.classList.add("online"),t&&t.classList.add("online")):i==="error"?(r.classList.add("error"),t&&t.classList.add("error")):(r.classList.add("offline"),t&&t.classList.add("offline"));let v=typeof h=="string"&&h.trim()?h.trim():x[i]||"",B=typeof h=="string"&&h.trim()?h.trim():p[i]||v,w=v||B||"";r.textContent=w,w?(r.setAttribute("title",w),r.setAttribute("aria-label",w)):(r.removeAttribute("title"),r.removeAttribute("aria-label")),U(i),r.dataset.state=i}function N(){C!=="syncing"&&m(navigator.onLine?"online":"offline")}function M(i){typeof localStorage>"u"||(i?localStorage.setItem(g,i):localStorage.removeItem(g))}function D(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(g)||""}catch{return""}}function R(i){if(!i||typeof i!="object")return null;let h=i.id||i.uid||i.key||i.slug||i.uuid,v=typeof i.title=="string"&&i.title.trim()?i.title.trim():typeof i.name=="string"?i.name.trim():"";if(!v)return null;let B=typeof i.dueIso=="string"&&i.dueIso?i.dueIso:typeof i.due=="string"?i.due:null,w=typeof i.priority=="string"&&i.priority.trim()?i.priority.trim():i.level||i.importance||"Medium",L=typeof i.category=="string"&&i.category.trim()?i.category.trim():i.group||i.bucket||"General",A=typeof i.done=="boolean"?i.done:!!(i.completed||i.isDone||i.status==="done");return{id:h||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:v,dueIso:B&&B.trim()?B.trim():null,priority:w,category:L,done:A}}function _(){let i=Array.from(document.querySelectorAll("[data-reminder]"));return i.length?i.map(h=>{let v=h.dataset||{},B=null;if(v.reminder)try{B=JSON.parse(v.reminder)}catch{B=null}let w=B||{id:v.id||v.reminderId||h.getAttribute("data-id")||null,title:v.title||v.reminderTitle||"",dueIso:v.due||v.reminderDue||h.getAttribute("data-due")||null,priority:v.priority||v.reminderPriority||h.getAttribute("data-priority")||"",category:v.category||v.reminderCategory||h.getAttribute("data-category")||"",done:v.done==="true"||v.reminderDone==="true"||h.getAttribute("data-done")==="true"};if(!w.title){let L=h.querySelector("[data-reminder-title], [data-title], h3, h4, strong");L&&(w.title=L.textContent.trim())}if(!w.dueIso){let L=h.querySelector("[data-due], time");if(L){let A=L.getAttribute("datetime")||L.getAttribute("data-due");w.dueIso=A||L.textContent.trim()}}return R(w)}).filter(Boolean):[]}function E(){if(typeof localStorage>"u")return[];let i=[],h=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(B=>{if(!h.has(B)){h.add(B);try{let w=localStorage.getItem(B);if(!w)return;let L=JSON.parse(w);Array.isArray(L)?L.forEach(A=>i.push(A)):L&&typeof L=="object"&&(Array.isArray(L.items)&&L.items.forEach(A=>i.push(A)),Array.isArray(L.reminders)&&L.reminders.forEach(A=>i.push(A)))}catch{}}}),!i.length)for(let B=0;B<localStorage.length;B+=1){let w=localStorage.key(B);if(!(!w||h.has(w)||!/remind/i.test(w))){h.add(w);try{let L=localStorage.getItem(w);if(!L)continue;let A=JSON.parse(L);Array.isArray(A)?A.forEach(P=>i.push(P)):A&&typeof A=="object"&&(Array.isArray(A.items)&&A.items.forEach(P=>i.push(P)),Array.isArray(A.reminders)&&A.reminders.forEach(P=>i.push(P)))}catch{}}}return i.map(R).filter(Boolean)}function l(){let i=_();return i.length?i:E()}function S(i){i?(f?.setAttribute("aria-busy","true"),f?.setAttribute("disabled","disabled"),d?.setAttribute("aria-busy","true"),d?.setAttribute("disabled","disabled")):(f?.removeAttribute("aria-busy"),d?.removeAttribute("aria-busy"),T())}function T(){!!((s?.value||"").trim()||D())?(f?.removeAttribute("disabled"),d?.removeAttribute("disabled")):(f?.setAttribute("disabled","disabled"),d?.setAttribute("disabled","disabled"))}let F=D();s&&F&&(s.value=F),T(),m(navigator.onLine?"online":"offline"),window.addEventListener("online",N),window.addEventListener("offline",N),s?.addEventListener("input",T),c?.addEventListener("click",()=>{let i=(s?.value||"").trim();if(!i){M(""),m("info","Sync URL cleared. Add one to enable sync."),T();return}try{let h=new URL(i);if(!/^https?:/.test(h.protocol))throw new Error("Invalid protocol")}catch{m("error","Enter a valid sync URL before saving.");return}M(i),m("online","Sync settings saved."),T()}),d?.addEventListener("click",async()=>{let i=(s?.value||D()).trim();if(!i){m("error","Add your sync URL in Settings first.");return}S(!0),m("syncing","Testing connection\u2026");try{(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?m("online","Connection looks good."):m("error","Test failed. Check your Apps Script deployment.")}catch(h){console.error("Test sync failed",h),m("error","Test failed. Check your Apps Script deployment.")}finally{S(!1)}}),f?.addEventListener("click",async()=>{let i=(s?.value||D()).trim();if(!i){m("error","Add your sync URL in Settings first.");return}let h=l();if(!h.length){m("info","Nothing to sync right now.");return}S(!0),m("syncing",`Syncing ${h.length} reminder${h.length===1?"":"s"}\u2026`);let v=20,B=0,w=0,L=A=>({id:A.id,title:A.title,dueIso:A.dueIso||null,priority:A.priority||"Medium",category:A.category||"General",done:!!A.done,source:"memory-cue-mobile"});try{for(let A=0;A<h.length;A+=v){let P=h.slice(A,A+v);(await Promise.allSettled(P.map($=>fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L($))})))).forEach($=>{$.status==="fulfilled"&&$.value?.ok?B+=1:($.status,w+=1)}),await new Promise($=>setTimeout($,300))}w?B?m("error",`Partial sync: ${B} success, ${w} failed.`):m("error","Sync failed. Check your sync URL and retry."):m("online",`Sync complete. ${B} updated.`)}catch(A){console.error("Sync failed",A),m("error","Sync failed. Try again soon.")}finally{S(!1)}})})()});export default Tt();
