import{a as z,b as X,c as K,d as ee,e as P,f as q,g as H,h as $,i as te,j as W,k as ne}from"./chunk-K4LZ4PFQ.js";import{a as j,b as Z}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{c as Q}from"./chunk-GUVSRPRW.js";var oe=Q(()=>{Z();ee();X();te();ne();j();(function(){let t=()=>{let e=document.getElementById("create-sheet"),l=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(l instanceof HTMLElement)){let c=typeof t._retryCount=="number"?t._retryCount:0;c<10&&(t._retryCount=c+1,setTimeout(t,50));return}if(t._initialised)return;t._initialised=!0;let p=e.querySelector("[data-dialog-content]"),d=e.querySelector(".sheet-backdrop"),u=document.getElementById("createReminderForm"),m=document.getElementById("saveReminder"),b=document.getElementById("priority"),h=document.getElementById("priorityChips"),v=h?Array.from(h.querySelectorAll('input[name="priority"]')):[],L=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),f=Array.from(L).filter(c=>c instanceof HTMLElement),I=f[0]||null,k=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};k();let y=null,T=(c,E)=>{try{document.dispatchEvent(new CustomEvent(c,{detail:E}))}catch(A){console.warn(`${c} dispatch failed`,A)}},w=()=>{let c=b?.value||"Medium";v.forEach(E=>{let A=E.value===c;E.checked=A,E.setAttribute("aria-checked",A?"true":"false")})},M=c=>{b&&(b.value!==c&&(b.value=c,b.dispatchEvent(new Event("change",{bubbles:!0}))),w())};v.forEach(c=>{c.addEventListener("change",()=>{c.checked&&M(c.value)})}),b?.addEventListener("change",w),w();let O=()=>{let c=e.querySelector('input, textarea, select, button, [contenteditable="true"]');c instanceof HTMLElement&&setTimeout(()=>{try{c.focus()}catch{}},0)},N=c=>{y=c instanceof HTMLElement?c:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),y&&y.setAttribute("aria-expanded","true"),w(),O(),T("reminder:sheet-opened",{trigger:y})},x=(c="dismissed")=>{let E=!e.classList.contains("hidden");k(),y&&y.setAttribute("aria-expanded","false");let A=y&&document.body.contains(y)&&y||I;if(A&&typeof A.focus=="function")try{A.focus()}catch{}E&&T("reminder:sheet-closed",{reason:c,trigger:y}),y=null};f.forEach(c=>{c.addEventListener("click",E=>{E.preventDefault();let A={mode:"create",trigger:c};T("cue:prepare",A),T("cue:open",A)})}),l.addEventListener("click",c=>{c.preventDefault(),x("close-button")}),d?.addEventListener("click",c=>{c.target===d&&x("backdrop")}),e.addEventListener("keydown",c=>{c.key==="Escape"&&(c.stopPropagation(),x("escape"))}),p?.addEventListener("click",c=>{c.stopPropagation()}),e.addEventListener("click",c=>{c.target instanceof HTMLElement&&c.target.hasAttribute("data-close")&&x("backdrop")}),document.addEventListener("cue:open",c=>{w(),N(c?.detail?.trigger||null)}),document.addEventListener("cue:close",c=>{x(c?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{w()}),document.addEventListener("cue:cancelled",()=>{x("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=x),document.addEventListener("reminder:save",c=>{if(!(m instanceof HTMLElement))return;let E=c?.detail?.trigger;E&&E!==m||m.matches(":disabled")||m.click()}),u instanceof HTMLFormElement&&m instanceof HTMLElement&&u.addEventListener("submit",c=>{c.preventDefault(),!m.matches(":disabled")&&m.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();var U=()=>{U._initialised||(U._initialised=!0,K({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(t=>{console.error("Failed to initialise reminders:",t)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",U,{once:!0}):U();var Y=()=>{if(typeof document>"u")return;let t=document.getElementById("noteTitleMobile"),e=document.getElementById("noteBodyMobile"),l=document.getElementById("noteSaveMobile"),p=document.getElementById("noteNewMobile"),d=document.getElementById("notesListMobile"),u=document.getElementById("notesCountMobile"),m=document.getElementById("notesFilterMobile");if(!t||!e||!l)return;let b=(i,n=200)=>{let r;return(...a)=>{r&&clearTimeout(r),r=setTimeout(()=>{i(...a)},n)}},h=null,v=[],L="",f=!1,I=()=>typeof L=="string"?L.trim().toLowerCase():"",k=(i=v)=>{if(!Array.isArray(i))return[];let n=I();return n?i.filter(r=>{let a=typeof r?.title=="string"?r.title.toLowerCase():"",s=typeof r?.body=="string"?r.body.toLowerCase():"";return a.includes(n)||s.includes(n)}):[...i]},y=i=>{if(!i){h=null,t.value="",e.value="",delete t.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;return}h=i.id,t.value=i.title||"",e.value=i.body||"",t.dataset.noteOriginalTitle=i.title||"",e.dataset.noteOriginalBody=i.body||""},T=()=>{if(!d)return;d.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(n=>{if(!(n instanceof HTMLElement))return;let r=n.getAttribute("data-note-id")===h;r?n.setAttribute("data-state","active"):n.removeAttribute("data-state"),n.setAttribute("aria-current",r?"true":"false")})},w=i=>{if(!i)return"";let n=new Date(i);if(Number.isNaN(n.getTime()))return"";let r=new Date,a=n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()&&n.getDate()===r.getDate(),s=n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return a?`Today \xB7 ${s}`:`${n.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${s}`},M=()=>{let i=typeof t.value=="string"?t.value:"",n=typeof e.value=="string"?e.value:"",r=t.dataset.noteOriginalTitle??"",a=e.dataset.noteOriginalBody??"";return i!==r||n!==a},O=()=>{let i=H();return Array.isArray(i)?[...i].sort((n,r)=>{let a=Date.parse(n?.updatedAt||""),s=Date.parse(r?.updatedAt||"");return(Number.isNaN(s)?0:s)-(Number.isNaN(a)?0:a)}):[]},N=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(P)}catch{return null}},x=N(),c=()=>(x=N(),x),E=({preserveDraft:i=!0}={})=>{let n=O();v=Array.isArray(n)?[...n]:[];let r=i&&M(),a=v.length>0,s=k();if(F(s),!a)return r||y(null),T(),c(),f=!1,s;if(h){let S=v.find(B=>B.id===h)||null;S?r||y(S):(h=null,!r&&!f&&v[0]&&y(v[0]))}else!r&&!f&&v[0]&&y(v[0]);return f=!1,T(),c(),s},A=i=>{if(!i)return;let n=H();if(!Array.isArray(n))return;let r=n.filter(a=>a.id!==i);r.length!==n.length&&($(r),c(),h===i&&(y(null),f=!0),E({preserveDraft:!1}))},F=(i=[])=>{if(!d)return i;if(d.innerHTML="",u){let n=v.length;u.textContent=`${n} saved`}if(!i.length){let n=document.createElement("li");return n.className="text-xs italic text-base-content/60 px-1",n.textContent=v.length&&I()?"No notes match this filter.":"No saved notes yet.",d.appendChild(n),i}return i.forEach(n=>{let r=document.createElement("li");r.className="note-item-mobile";let a=document.createElement("div");a.className="flex items-stretch gap-1";let s=document.createElement("button");s.type="button",s.dataset.noteId=n.id,s.dataset.role="open-note",s.className="flex-1 text-left rounded-xl border border-base-200/70 bg-base-100 px-3 py-2.5 flex flex-col gap-0.5 active:scale-[0.99] transition-transform";let S=document.createElement("div");S.className="flex items-center justify-between gap-2";let B=document.createElement("span");B.className="text-[0.82rem] font-medium truncate",B.textContent=n.title||"Untitled note",S.appendChild(B);let C=w(n.updatedAt||n.createdAt);if(C){let _=document.createElement("span");_.className="text-[0.7rem] text-base-content/50 whitespace-nowrap",_.textContent=C,S.appendChild(_)}let R=document.createElement("p");R.className="text-[0.75rem] text-base-content/60 line-clamp-2";let J=typeof n.body=="string"?n.body.replace(/\s+/g," ").trim():"";R.textContent=J||"No body text yet.",s.appendChild(S),s.appendChild(R);let D=document.createElement("button");D.type="button",D.dataset.noteId=n.id,D.dataset.role="delete-note",D.className="shrink-0 w-9 h-9 rounded-full flex items-center justify-center bg-base-200/80 text-base-content/60 text-xs active:scale-95",D.setAttribute("aria-label","Delete note"),D.textContent="\u2715",a.appendChild(s),a.appendChild(D),r.appendChild(a),d.appendChild(r)}),T(),i};d&&d.addEventListener("click",i=>{let n=i.target;if(!(n instanceof HTMLElement))return;let r=n.closest('button[data-role="delete-note"]');if(r&&d.contains(r)){i.preventDefault();let s=r.getAttribute("data-note-id");if(!s)return;let S=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(S?S("Delete this note? This cannot be undone."):!0)&&A(s);return}let a=n.closest('button[data-role="open-note"]');if(a&&d.contains(a)){i.preventDefault();let s=a.getAttribute("data-note-id");if(!s)return;let S=v.find(B=>B.id===s);S&&(y(S),T())}});let o=()=>{F(k())};if(m){let i=b(()=>{L=typeof m.value=="string"?m.value:"",o()},180);m.addEventListener("input",i),m.addEventListener("search",i)}let g=()=>{E({preserveDraft:!1})};l.addEventListener("click",()=>{let i=H(),n=Array.isArray(i)?[...i]:[],r=typeof t.value=="string"?t.value.trim():"",a=typeof e.value=="string"?e.value:"",s=r||"Untitled note",S=new Date().toISOString();if(h){let B=n.findIndex(C=>C.id===h);if(B>=0)n[B]={...n[B],title:s,body:a,updatedAt:S};else{let C=q(s,a,{updatedAt:S});h=C.id,n.unshift(C)}}else{let B=q(s,a);h=B.id,n.unshift(B)}$(n),c(),E({preserveDraft:!1})}),p&&p.addEventListener("click",()=>{y(null),T(),typeof t.focus=="function"&&t.focus()}),g(),typeof window<"u"&&(window.addEventListener("storage",i=>{i.key===P&&(x=i.newValue??null,E({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let i=N();i!==x&&(x=i,E({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Y,{once:!0}):Y();var G=W(),V=z({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:t=>{G?.handleSessionChange(t)}});if(V?.supabase){G?.setSupabaseClient(V.supabase);try{V.supabase.auth.getSession().then(({data:t})=>{G?.handleSessionChange(t?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let t=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let l='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',p=t,d=f=>{if(!(f instanceof HTMLElement)||f.getAttribute("aria-hidden")==="true"||f.hasAttribute("disabled")||f.tabIndex<0)return!1;let I=f.getBoundingClientRect();return I.width>0||I.height>0},u=()=>Array.from(e.querySelectorAll(l)).filter(d),m=()=>{let f=e.classList.contains("hidden");e.setAttribute("aria-hidden",f?"true":"false")};m();let b=f=>{!e.contains(f.target)&&f.target!==t&&L({restoreFocus:!1})},h=()=>{let[f]=u();if(f instanceof HTMLElement)try{f.focus()}catch{}},v=()=>{e.classList.contains("hidden")&&(p=document.activeElement instanceof HTMLElement?document.activeElement:t,e.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),m(),document.addEventListener("focusin",b),!e.contains(document.activeElement)&&h())},L=({restoreFocus:f=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),t.setAttribute("aria-expanded","false"),m(),document.removeEventListener("focusin",b),f&&p instanceof HTMLElement))try{p.focus()}catch{}};t.addEventListener("click",f=>{f.stopPropagation(),e.classList.contains("hidden")?v():L()}),document.addEventListener("click",f=>{f.target===t||e.contains(f.target)||L({restoreFocus:!1})}),document.addEventListener("keydown",f=>{if(f.key==="Escape"){L();return}f.key==="ArrowDown"&&!e.classList.contains("hidden")&&(f.preventDefault(),h())}),e.addEventListener("click",f=>{f.stopPropagation(),f.target instanceof HTMLElement&&f.target.closest("button")&&L({restoreFocus:!1})}),e.addEventListener("keydown",f=>{if(f.key!=="Tab")return;let I=u();if(!I.length)return;let k=I.indexOf(document.activeElement),y=I.length-1,T=k;f.shiftKey?T=k<=0?y:k-1:T=k===y?0:k+1,f.preventDefault();let w=I[T]||I[0];if(w instanceof HTMLElement)try{w.focus()}catch{}})})();(()=>{let t=document.getElementById("voiceAddBtn");if(!(t instanceof HTMLElement))return;let e=()=>{let d=document.getElementById("voiceBtn");return d instanceof HTMLElement?d:null},l=()=>{let d=e();if(!d)return;let u=()=>{d.hasAttribute("disabled")||d.getAttribute("aria-disabled")==="true"?(t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"));let b=d.getAttribute("title");b&&t.setAttribute("title",b)};u(),typeof MutationObserver=="function"&&new MutationObserver(u).observe(d,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l,{once:!0}):l();let p=()=>{let d=e();if(d&&!(d.hasAttribute("disabled")||d.getAttribute("aria-disabled")==="true")){try{d.focus({preventScroll:!0})}catch{try{d.focus()}catch{}}try{d.click()}catch(u){console.warn("Voice add trigger failed",u)}}};t.addEventListener("click",d=>{d.preventDefault();let u=!1,m=null,b=()=>{u||(u=!0,document.removeEventListener("reminder:sheet-opened",h),p())},h=L=>{if(L?.detail?.trigger!==t)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&m&&(window.clearTimeout(m),m=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,150)};document.addEventListener("reminder:sheet-opened",h);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:t}}))}catch(L){document.removeEventListener("reminder:sheet-opened",h),typeof window<"u"&&typeof window.clearTimeout=="function"&&m&&(window.clearTimeout(m),m=null),console.warn("Voice add open failed",L);return}let v=document.getElementById("create-sheet");v instanceof HTMLElement&&v.classList.contains("open")&&(m=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,120))})})();(()=>{let t=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let l=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],p=()=>{let u=e.hasAttribute("open");t.setAttribute("aria-expanded",String(u)),t.classList.toggle("btn-active",u)},d=()=>{for(let u of l){let m=e.querySelector(u);if(m instanceof HTMLElement&&!m.hasAttribute("disabled")){try{m.focus({preventScroll:!0})}catch{m.focus()}return}}};t.addEventListener("click",()=>{let u=e.hasAttribute("open");e.open=!u,u||d(),p()}),e.addEventListener("toggle",p),p()})();(()=>{let t=document.getElementById("create-sheet");if(!(t instanceof HTMLElement))return;function e(){!t.classList.contains("open")&&t.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",t=>{let e=document.getElementById("totalCount");if(!e)return;let l=Array.isArray(t?.detail?.items)?t.detail.items.length:0;e.textContent=String(l)});document.addEventListener("click",t=>{try{let e=t.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let l=document.createElement("div");l.textContent="Save clicked",l.style.position="fixed",l.style.right="16px",l.style.bottom="16px",l.style.background="rgba(34,197,94,0.95)",l.style.color="#fff",l.style.padding="8px 12px",l.style.borderRadius="8px",l.style.zIndex="99999",document.body.appendChild(l),setTimeout(()=>l.remove(),900)}catch{}}}catch{}});(function(){let t=document.getElementById("reminderList");if(!t)return;let e=Array.from(t.children);if(e.length<=30)return;let l=20;t.innerHTML="";let p=0;function d(){let b=e.slice(p,p+l);b.forEach(h=>t.appendChild(h)),p+=b.length}d();let u=document.createElement("div");u.id="listSentinel",t.appendChild(u);let m=new IntersectionObserver(b=>{b.some(h=>h.isIntersecting)&&p<e.length&&(d(),p>=e.length&&m.disconnect())});m.observe(u)})();(function(){let t=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(u=>u instanceof HTMLElement),e=document.getElementById("settingsModal"),l=document.getElementById("closeSettings");if(!t.length||!e||!l)return;function p(){e.classList.remove("hidden")}function d(){e.classList.add("hidden")}t.forEach(u=>{u.addEventListener("click",p)}),l.addEventListener("click",d),e.addEventListener("click",u=>{u.target instanceof HTMLElement&&u.target.matches("[data-close]")&&d()}),e.addEventListener("keydown",u=>{u.key==="Escape"&&d()})})();(function(){let t=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),l=document.getElementById("mcStatusText"),p=document.getElementById("syncUrl"),d=document.getElementById("saveSyncSettings"),u=document.getElementById("testSync"),m=document.getElementById("syncAll"),b="syncUrl";if(!l)return;let h=["online","offline","error"],v=["online","offline"],L={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},f={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},I=null;function k(o){if(!e)return;v.forEach(i=>e.classList.remove(i));let g=o!=="offline"&&o!=="error";e.classList.add(g?"online":"offline"),e.setAttribute("aria-label",g?"Online":"Offline")}function y(o,g){I=o,h.forEach(a=>l.classList.remove(a)),t&&h.forEach(a=>t.classList.remove(a)),o==="online"?(l.classList.add("online"),t&&t.classList.add("online")):o==="error"?(l.classList.add("error"),t&&t.classList.add("error")):(l.classList.add("offline"),t&&t.classList.add("offline"));let i=typeof g=="string"&&g.trim()?g.trim():L[o]||"",n=typeof g=="string"&&g.trim()?g.trim():f[o]||i,r=i||n||"";l.textContent=r,r?(l.setAttribute("title",r),l.setAttribute("aria-label",r)):(l.removeAttribute("title"),l.removeAttribute("aria-label")),k(o),l.dataset.state=o}function T(){I!=="syncing"&&y(navigator.onLine?"online":"offline")}function w(o){typeof localStorage>"u"||(o?localStorage.setItem(b,o):localStorage.removeItem(b))}function M(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(b)||""}catch{return""}}function O(o){if(!o||typeof o!="object")return null;let g=o.id||o.uid||o.key||o.slug||o.uuid,i=typeof o.title=="string"&&o.title.trim()?o.title.trim():typeof o.name=="string"?o.name.trim():"";if(!i)return null;let n=typeof o.dueIso=="string"&&o.dueIso?o.dueIso:typeof o.due=="string"?o.due:null,r=typeof o.priority=="string"&&o.priority.trim()?o.priority.trim():o.level||o.importance||"Medium",a=typeof o.category=="string"&&o.category.trim()?o.category.trim():o.group||o.bucket||"General",s=typeof o.done=="boolean"?o.done:!!(o.completed||o.isDone||o.status==="done");return{id:g||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:i,dueIso:n&&n.trim()?n.trim():null,priority:r,category:a,done:s}}function N(){let o=Array.from(document.querySelectorAll("[data-reminder]"));return o.length?o.map(g=>{let i=g.dataset||{},n=null;if(i.reminder)try{n=JSON.parse(i.reminder)}catch{n=null}let r=n||{id:i.id||i.reminderId||g.getAttribute("data-id")||null,title:i.title||i.reminderTitle||"",dueIso:i.due||i.reminderDue||g.getAttribute("data-due")||null,priority:i.priority||i.reminderPriority||g.getAttribute("data-priority")||"",category:i.category||i.reminderCategory||g.getAttribute("data-category")||"",done:i.done==="true"||i.reminderDone==="true"||g.getAttribute("data-done")==="true"};if(!r.title){let a=g.querySelector("[data-reminder-title], [data-title], h3, h4, strong");a&&(r.title=a.textContent.trim())}if(!r.dueIso){let a=g.querySelector("[data-due], time");if(a){let s=a.getAttribute("datetime")||a.getAttribute("data-due");r.dueIso=s||a.textContent.trim()}}return O(r)}).filter(Boolean):[]}function x(){if(typeof localStorage>"u")return[];let o=[],g=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(n=>{if(!g.has(n)){g.add(n);try{let r=localStorage.getItem(n);if(!r)return;let a=JSON.parse(r);Array.isArray(a)?a.forEach(s=>o.push(s)):a&&typeof a=="object"&&(Array.isArray(a.items)&&a.items.forEach(s=>o.push(s)),Array.isArray(a.reminders)&&a.reminders.forEach(s=>o.push(s)))}catch{}}}),!o.length)for(let n=0;n<localStorage.length;n+=1){let r=localStorage.key(n);if(!(!r||g.has(r)||!/remind/i.test(r))){g.add(r);try{let a=localStorage.getItem(r);if(!a)continue;let s=JSON.parse(a);Array.isArray(s)?s.forEach(S=>o.push(S)):s&&typeof s=="object"&&(Array.isArray(s.items)&&s.items.forEach(S=>o.push(S)),Array.isArray(s.reminders)&&s.reminders.forEach(S=>o.push(S)))}catch{}}}return o.map(O).filter(Boolean)}function c(){let o=N();return o.length?o:x()}function E(o){o?(m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled"),u?.setAttribute("aria-busy","true"),u?.setAttribute("disabled","disabled")):(m?.removeAttribute("aria-busy"),u?.removeAttribute("aria-busy"),A())}function A(){!!((p?.value||"").trim()||M())?(m?.removeAttribute("disabled"),u?.removeAttribute("disabled")):(m?.setAttribute("disabled","disabled"),u?.setAttribute("disabled","disabled"))}let F=M();p&&F&&(p.value=F),A(),y(navigator.onLine?"online":"offline"),window.addEventListener("online",T),window.addEventListener("offline",T),p?.addEventListener("input",A),d?.addEventListener("click",()=>{let o=(p?.value||"").trim();if(!o){w(""),y("info","Sync URL cleared. Add one to enable sync."),A();return}try{let g=new URL(o);if(!/^https?:/.test(g.protocol))throw new Error("Invalid protocol")}catch{y("error","Enter a valid sync URL before saving.");return}w(o),y("online","Sync settings saved."),A()}),u?.addEventListener("click",async()=>{let o=(p?.value||M()).trim();if(!o){y("error","Add your sync URL in Settings first.");return}E(!0),y("syncing","Testing connection\u2026");try{(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?y("online","Connection looks good."):y("error","Test failed. Check your Apps Script deployment.")}catch(g){console.error("Test sync failed",g),y("error","Test failed. Check your Apps Script deployment.")}finally{E(!1)}}),m?.addEventListener("click",async()=>{let o=(p?.value||M()).trim();if(!o){y("error","Add your sync URL in Settings first.");return}let g=c();if(!g.length){y("info","Nothing to sync right now.");return}E(!0),y("syncing",`Syncing ${g.length} reminder${g.length===1?"":"s"}\u2026`);let i=20,n=0,r=0,a=s=>({id:s.id,title:s.title,dueIso:s.dueIso||null,priority:s.priority||"Medium",category:s.category||"General",done:!!s.done,source:"memory-cue-mobile"});try{for(let s=0;s<g.length;s+=i){let S=g.slice(s,s+i);(await Promise.allSettled(S.map(C=>fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(C))})))).forEach(C=>{C.status==="fulfilled"&&C.value?.ok?n+=1:(C.status,r+=1)}),await new Promise(C=>setTimeout(C,300))}r?n?y("error",`Partial sync: ${n} success, ${r} failed.`):y("error","Sync failed. Check your sync URL and retry."):y("online",`Sync complete. ${n} updated.`)}catch(s){console.error("Sync failed",s),y("error","Sync failed. Try again soon.")}finally{E(!1)}})})()});export default oe();
