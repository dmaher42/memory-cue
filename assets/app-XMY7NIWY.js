import{a as _t,b as ao,c as Fe,d as lo,f as nt,g as Me,h as ot,i as co,j as $t,k as uo}from"./chunk-K4LZ4PFQ.js";import{a as Ut,b as ro}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as tt,c as io}from"./chunk-GUVSRPRW.js";function Vt(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let s of o){if(typeof s!="string"||!s)continue;let i=t.getElementById(s);if(i)return{key:n,element:i}}return null}).filter(n=>!!(n&&n.element))}function ae(e,t){if(!e||typeof e!="object")return"";let n=fo[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let s=e[o];return s==null?"":typeof s=="string"?s:String(s)}return""}function mo(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function po(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function jt(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let s=e&&typeof e=="object"?ae(e,n):"";mo(o,s)})}function Kt(e,t,n,o){Array.isArray(e)&&e.forEach(({element:s})=>{s instanceof HTMLInputElement?["checkbox","radio"].includes(s.type)?s.checked=!1:s.value="":(s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement)&&(s.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function Yt(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let s=po(o);if(typeof s=="boolean"){t[n]=s;return}let i=typeof s=="string"?s.trim():s;t[n]=i??""}),t}function D(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Wt,fo,st,it,Gt=tt(()=>{Wt=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],fo={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},st="Create Cue",it="Edit Cue"});function zt(e){return new rt(e)}var ho,yo,rt,Qt=tt(()=>{ho=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),yo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},rt=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...yo,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let o=n[0],s=n[n.length-1],i=document.activeElement;t.shiftKey&&i===o?(t.preventDefault(),s.focus()):!t.shiftKey&&i===s&&(t.preventDefault(),o.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(ho)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let o=this.events[t];if(!o||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let s=new CustomEvent(o,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(s)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Jt,lt,at,go,Xt,bo,Zt,Eo,vo,en,ct,wo,tn,dt,ye,ge,nn,Lo,on,ut,Pe,he,Ne,le,sn,be,rn,an,He,So,pe,Ee,ln,X,Re,ft,cn,Z,dn,un,fn,mn,pn,hn=tt(()=>{Jt="memoryCue:plannerPlans",lt="memoryCue:plannerUpdated",at=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],go=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],Xt=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},bo=e=>{try{return JSON.parse(e)}catch{return null}},Zt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Eo=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,vo=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),o=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t},en=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`},ct=e=>{if(typeof e!="string")return null;let[t,n,o]=e.split("-"),s=Number.parseInt(t,10),i=Number.parseInt(n,10),r=Number.parseInt(o,10);if(!Number.isFinite(s)||!Number.isFinite(i)||!Number.isFinite(r))return null;let l=new Date(s,i-1,r);return Number.isNaN(l.getTime())?null:(l.setHours(0,0,0,0),l)},wo=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=at.findIndex(o=>o.toLowerCase()===t);return n>=0?n:0},tn=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:Zt(),badge:n,text:t}},dt=(e,t={})=>{let n=typeof t=="object"&&t?t:{},o=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:wo(e?.dayName||n.dayName||n.dayLabel),s=Eo(o),i=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():at[s],r=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",p=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(y=>tn(y)).filter(Boolean);return{id:typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:Zt(),dayIndex:s,dayLabel:at[s]||"Lesson",title:i,summary:r,details:p}},ye=e=>[...e].sort((t,n)=>t.dayIndex!==n.dayIndex?t.dayIndex-n.dayIndex:t.title.localeCompare(n.title)),ge=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,o=ct(n),s=Array.isArray(e?.lessons)?e.lessons.map(i=>dt(i)).filter(Boolean):[];return{weekId:n,startDate:o?o.toISOString():"",lessons:ye(s),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString()}},nn=()=>{if(!Xt())return{};try{let e=window.localStorage.getItem(Jt);if(typeof e!="string"||!e.length)return{};let t=bo(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Lo=e=>{if(Xt())try{window.localStorage.setItem(Jt,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},on=e=>{if(!e)return null;let n=nn()[e];return n?ge(n,e):null},ut=(e,t)=>{if(!e||!t)return t;let n=nn();return n[e]=t,Lo(n),t},Pe=new Map,he=null,Ne=null,le=!1,sn=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},be=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(lt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},rn=async()=>he?Ne||(Ne=he().then(e=>{let{db:t,getCollection:n}=e||{},o=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),Ne):null,an=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:o,db:s}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(s,"plannerPlans",t)},He=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Pe.set(e.weekId,e),e),So=e=>{let t=X();return ge({weekId:e,lessons:e===t?go:[]},e)},pe=e=>{let t=on(e);if(t)return He(t),t;let n=So(e);return ut(e,n),He(n),n},Ee=async e=>{if(!e?.weekId)return e;let t=ge(e,e.weekId);if(ut(t.weekId,t),He(t),le||!he)return t;try{let n=await rn();if(!n)return t;let o=an(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(o,t,{merge:!0}):await n.updateDoc(o,t),t}catch(n){return sn(n)?(console.warn("Persisting planner data locally due to permission issue",n),le=!0,t):(console.error("Failed to persist planner plan",n),t)}},ln=(e={})=>{typeof e.ensureFirestore=="function"&&(he=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(le=e.forceLocal)},X=(e=new Date)=>{let t=vo(e);return en(t)},Re=(e,t=0)=>{let n=ct(e);if(!n||!Number.isFinite(t))return e;let o=new Date(n);return o.setDate(n.getDate()+t*7),en(o)},ft=(e,{short:t=!1}={})=>{let n=ct(e);if(!n)return"";let o=new Date(n);o.setDate(n.getDate()+6);let s=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),i=s.format(n),r=s.format(o),l=n.getFullYear()===o.getFullYear();if(t)return`Week of ${i}`;let p=l?n.getFullYear():`${n.getFullYear()} \u2013 ${o.getFullYear()}`;return`${i} \u2013 ${r}, ${p}`},cn=(e=X())=>{if(!e)return[];let t=Pe.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=on(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},Z=async(e=X())=>{if(!e)return null;if(Pe.has(e))return Pe.get(e);if(le||!he)return pe(e);try{let t=await rn();if(!t)return pe(e);let n=an(t,e),o=await t.getDoc(n);if(o.exists()){let i=o.data(),r=ge({...i,weekId:e},e);return ut(e,r),He(r),le=!1,r}let s=pe(e);return typeof t.setDoc=="function"&&await t.setDoc(n,s,{merge:!0}),s}catch(t){return sn(t)?(console.warn("Falling back to local planner data due to permission issue",t),le=!0,pe(e)):(console.error("Failed to load planner data",t),pe(e))}},dn=async(e,t)=>{if(!e)return null;let n=await Z(e),o=dt(t),s={...n,lessons:ye([...n?.lessons||[],o]),updatedAt:new Date().toISOString()},i=await Ee(s);return be(i),i},un=async(e,t,n={})=>{if(!e||!t)return null;let o=await Z(e),s=[...o?.lessons||[]],i=s.findIndex(c=>c.id===t);if(i===-1)return o;let r=dt({...s[i],...n,id:t},s[i]);s[i]=r;let l={...o,lessons:ye(s),updatedAt:new Date().toISOString()},p=await Ee(l);return be(p),p},fn=async(e,t)=>{if(!e||!t)return null;let n=await Z(e),o=(n?.lessons||[]).filter(r=>r.id!==t),s={...n,lessons:ye(o),updatedAt:new Date().toISOString()},i=await Ee(s);return be(i),i},mn=async(e,t,n)=>{if(!e||!t)return null;let o=await Z(e),s=[...o?.lessons||[]],i=s.findIndex(g=>g.id===t);if(i===-1)return o;let r=tn(n);if(!r)return o;let l=s[i],p={...l,details:[...l.details||[],r]};s[i]=p;let c={...o,lessons:ye(s),updatedAt:new Date().toISOString()},y=await Ee(c);return be(y),y},pn=async(e,t)=>{if(!e||!t)return null;let o=((await Z(e))?.lessons||[]).map(r=>({title:r.title,summary:r.summary,dayIndex:r.dayIndex,details:(r.details||[]).map(l=>({badge:l.badge,text:l.text}))})),s=ge({weekId:t,lessons:o},t);s.updatedAt=new Date().toISOString();let i=await Ee(s);return be(i),i}});var Ts=io(()=>{ro();lo();Gt();Qt();ao();co();uo();hn();Ut();function To(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!t||!n)return;let o=document.querySelectorAll("[data-open-reminder-modal]");if(!o.length)return;let s=e.querySelector("[data-reminder-modal-backdrop]"),i=e.querySelectorAll("[data-close-modal]"),r=document.getElementById("mainContent"),l=document.querySelector('nav[aria-label="Primary"]'),p=[r,l],c=e.querySelector('[role="dialog"]')??e,y=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],g=null,u=()=>{if(!(c instanceof HTMLElement))return[];let d=c.querySelectorAll(y.join(","));return Array.from(d).filter(h=>{let T=h instanceof HTMLElement,O=typeof SVGElement<"u"&&h instanceof SVGElement;if(!T&&!O||h.getAttribute("aria-hidden")==="true"||"disabled"in h&&h.disabled||h.hidden||h.closest("[hidden]"))return!1;let U=h.getBoundingClientRect();return U.width>0&&U.height>0})},f=()=>{let d=u(),h=d.find(T=>T.hasAttribute("data-autofocus")||T.hasAttribute("autofocus"))||(n&&d.includes(n)?n:null)||d[0];if(h&&typeof h.focus=="function"){h.focus({preventScroll:!0});return}c instanceof HTMLElement&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},b=d=>{c instanceof HTMLElement&&(!(d.target instanceof Node)||!c.contains(d.target))&&(d.stopPropagation(),f())},w=d=>{if(d.key!=="Tab")return;let h=u();if(!h.length){d.preventDefault(),c instanceof HTMLElement&&c.focus({preventScroll:!0});return}let T=h[0],O=h[h.length-1],U=document.activeElement;if(d.shiftKey){(!c.contains(U)||U===T)&&(d.preventDefault(),O.focus());return}(!c.contains(U)||U===O)&&(d.preventDefault(),T.focus())},v=d=>{p.forEach(h=>{h&&(d?h.setAttribute("inert",""):h.removeAttribute("inert"))})},C=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),v(!1),document.removeEventListener("keydown",N,!0),e.removeEventListener("keydown",w,!0),e.removeEventListener("focusin",b,!0),g&&typeof g.focus=="function"&&g.focus(),g=null},N=d=>{d.key==="Escape"&&(d.preventDefault(),C())},J=({triggerElement:d}={})=>{d&&typeof d.focus=="function"?g=d:g=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),v(!0),document.addEventListener("keydown",N,!0),e.addEventListener("keydown",w,!0),e.addEventListener("focusin",b,!0),window.requestAnimationFrame(()=>{f()})},x=(d,h={})=>{try{document.dispatchEvent(new CustomEvent(d,{detail:h}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let T=document.createEvent("CustomEvent");T.initCustomEvent(d,!0,!0,h),document.dispatchEvent(T)}}},I=(d={})=>{x("cue:cancelled",d)};o.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault();let O={trigger:h.currentTarget instanceof HTMLElement?h.currentTarget:null,mode:"create"};x("cue:prepare",O),x("cue:open",O)})}),i.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault(),I({trigger:d,reason:"button"})})}),e.addEventListener("click",d=>{d.target===e&&I({reason:"backdrop"})}),s?.addEventListener("click",d=>{d.target===s&&I({reason:"backdrop"})}),document.addEventListener("cue:open",d=>{let h=d?.detail?.trigger,T=h instanceof HTMLElement?h:null;J({triggerElement:T})});let P=()=>{C()};document.addEventListener("cue:close",P),document.addEventListener("cue:cancelled",P);let E=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&E instanceof HTMLElement&&t.addEventListener("submit",d=>{d.preventDefault(),!E.matches(":disabled")&&E.click()}),E instanceof HTMLElement&&document.addEventListener("reminder:save",d=>{let h=d?.detail?.trigger;h&&h!==E||E.matches(":disabled")||E.click()})}To();var yn=null;function Mn(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function ko(e){typeof document>"u"||!e||(window.clearTimeout(yn),yn=window.setTimeout(()=>{let t=document.querySelector(`[data-route="${e}"]`);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Ve(e){let t=e||Mn();t&&ko(t)}function Ao(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Ve()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{if(!(o.currentTarget instanceof HTMLAnchorElement))return;let s=o.currentTarget.getAttribute("href")||"";if(!s.startsWith("#"))return;o.preventDefault();let i=s||"#dashboard",r=i.replace("#","")||"dashboard";window.location.hash!==i&&(window.location.hash=i),typeof window.renderRoute=="function"&&window.renderRoute(),Ve(r)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Ve()}Ao();var Nn="memoryCue:accountPanelCollapsed";function xo(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem(Nn);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function Do(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem(Nn,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function Co(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let o=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",s=(t.getAttribute("data-expanded-label")||"").trim()||o,i=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",r=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",l=t.querySelector("[data-account-toggle-label]"),p=t.querySelector("[data-account-toggle-a11y]"),c=xo();typeof c!="boolean"&&(c=!0);let y=(g,{persist:u=!0}={})=>{c=!!g,e.setAttribute("data-account-collapsed",c?"true":"false"),t.setAttribute("aria-expanded",c?"false":"true");let f=c?o:s,b=c?i:r;l?l.textContent=f:t.textContent=f,t.setAttribute("aria-label",b),p&&(p.textContent=b),c?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),c||n.removeAttribute("hidden"),u&&Do(c)};y(c,{persist:!1}),t.addEventListener("click",g=>{g.preventDefault(),y(!c)})}Co();var gn=document.getElementById("settings-save-button"),qe=document.getElementById("settings-save-confirmation"),ze=document.getElementById("live-status"),mt=null;gn&&qe&&gn.addEventListener("click",e=>{e.preventDefault(),qe.classList.remove("hidden"),qe.textContent="Settings saved!",ze&&(ze.textContent="Settings saved!"),mt&&window.clearTimeout(mt),mt=window.setTimeout(()=>{qe.classList.add("hidden")},3e3)});function Io(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Ve(t),ze&&(ze.textContent="Opening planner to add a new lesson."),Wn(),window.requestAnimationFrame(()=>{let o=$n();o&&typeof o.catch=="function"&&o.catch(s=>{console.error("Planner quick action failed to start new lesson flow",s)})})}function Bo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Io)})}Bo();var Pn=document.getElementById("reminder-title"),Fo=document.getElementById("reminderText"),$=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),o=e.querySelector(".modal-backdrop button"),s=document.getElementById("modal-title");return zt({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:o instanceof HTMLElement?o:null,titleInput:Pn,modalTitle:s instanceof HTMLElement?s:null,defaultTitle:st,editTitle:it})})();$?.setEditMode(!1);var Mo=()=>{let e=!!Pn;if(!!Fo)return Fe({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0};return e?Fe(n):Fe({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Mo().catch(e=>{console.error("Failed to initialise reminders",e)});var bt=$t(),pt=_t({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{bt?.handleSessionChange(e)}});if(pt?.supabase){bt?.setSupabaseClient(pt.supabase);try{pt.supabase.auth.getSession().then(({data:e})=>{bt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var K=document.getElementById("cues-list"),ht=document.getElementById("pinnedNotesCard"),ce=document.getElementById("pinnedNotesList"),se=document.getElementById("cue-form"),_=se?.querySelector("#cue-id-input"),No=$?.defaultTitle||$?.modalTitle?.textContent?.trim()||st,Hs=$?.editTitle||it,Qe=document.getElementById("tab-cues"),Je=document.getElementById("tab-daily"),we=document.getElementById("cues-view"),Le=document.getElementById("daily-list-view"),bn=document.getElementById("daily-list-header"),Hn=document.getElementById("quick-add-form"),M=document.getElementById("quick-add-input"),H=document.getElementById("daily-voice-btn"),te=document.getElementById("daily-tasks-container"),Et=document.getElementById("clear-completed-btn"),Xe=document.getElementById("daily-list-permission-notice"),ie=document.getElementById("plannerCards")||document.getElementById("planner-grid"),En=document.getElementById("planner-week"),Po=document.getElementById("planner-prev"),Ho=document.getElementById("planner-next"),Ro=document.getElementById("planner-today"),qo=document.getElementById("planner-duplicate-btn"),Oo=document.getElementById("planner-new-lesson-btn");function Uo(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),o=document.getElementById("planner-modal-description"),s=document.getElementById("planner-modal-error"),i=document.getElementById("planner-modal-submit"),r=document.getElementById("planner-lesson-day"),l=document.getElementById("planner-lesson-title"),p=document.getElementById("planner-lesson-summary"),c=document.getElementById("planner-detail-badge"),y=document.getElementById("planner-detail-text"),g=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(i instanceof HTMLElement)||!(r instanceof HTMLSelectElement)||!(l instanceof HTMLInputElement)||!(p instanceof HTMLTextAreaElement))return null;let u=t.querySelector("[data-planner-lesson-section]"),f=t.querySelector("[data-planner-summary-section]"),b=t.querySelector("[data-planner-detail-section]"),w=t.querySelector("[data-planner-duplicate-section]"),v=e.querySelector("[data-planner-modal-dialog]"),C=e.querySelector("[data-planner-modal-backdrop]"),N=e.querySelectorAll("[data-planner-modal-close]"),J=document.getElementById("mainContent"),x=document.querySelector('nav[aria-label="Primary"]'),I=[J,x].filter(Boolean),P=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],E={mode:"add",lessonId:null,trigger:null},d=null,h=null,T=a=>{d=a instanceof HTMLElement?a:null},O=a=>{I.forEach(m=>{m&&(a?m.setAttribute("inert",""):m.removeAttribute("inert"))})},U=()=>{if(!(v instanceof HTMLElement))return[];let a=v.querySelectorAll(P.join(","));return Array.from(a).filter(m=>{if(m.closest('[aria-hidden="true"]')||"disabled"in m&&m.disabled)return!1;let L=m.getBoundingClientRect();return L.width>0&&L.height>0})},Pt=()=>{let a=U(),m=(d&&a.includes(d)?d:null)||a[0]||v;m&&typeof m.focus=="function"&&m.focus({preventScroll:!0})},Ht=a=>{v instanceof HTMLElement&&(v.contains(a.target)||Pt())},Zn=a=>{if(a.key!=="Tab")return;let m=U();if(!m.length){a.preventDefault();return}let L=m[0],me=m[m.length-1];if(a.shiftKey&&document.activeElement===L){a.preventDefault(),me.focus();return}!a.shiftKey&&document.activeElement===me&&(a.preventDefault(),L.focus())},Rt=a=>{if(a.key==="Escape"){a.preventDefault(),W();return}Zn(a)},qt=()=>{s&&(s.textContent="",s.classList.add("hidden"),s.setAttribute("aria-hidden","true"))},Y=a=>{s&&(s.textContent=a,s.classList.remove("hidden"),s.removeAttribute("aria-hidden"))},Ot=a=>{i.disabled=!!a,i.classList.toggle("loading",!!a)},A=(a,m)=>{a instanceof HTMLElement&&(a.classList.toggle("hidden",!m),m?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden","true"))},xe=a=>{[r,l,p].forEach(m=>{m instanceof HTMLElement&&(m.disabled=!!a,m.classList.toggle("opacity-60",!!a),m.classList.toggle("cursor-not-allowed",!!a))})},fe=()=>{t.reset(),qt(),T(null),xe(!1),c instanceof HTMLInputElement&&(c.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),g instanceof HTMLInputElement&&(g.value="")},De=({title:a,description:m,action:L})=>{n&&(n.textContent=a||"Plan lesson"),o&&(o.textContent=m||""),i.textContent=L||"Save lesson"},Ce=({trigger:a}={})=>{E.trigger=a instanceof HTMLElement?a:null,h=E.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),O(!0),document.addEventListener("keydown",Rt,!0),e.addEventListener("focusin",Ht,!0),window.requestAnimationFrame(()=>{Pt()})},W=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),O(!1),document.removeEventListener("keydown",Rt,!0),e.removeEventListener("focusin",Ht,!0);let a=E.trigger||h;E.mode="add",E.lessonId=null,E.trigger=null,T(null),fe(),a&&typeof a.focus=="function"&&a.focus({preventScroll:!0})},eo=({defaultDay:a="Monday",trigger:m}={})=>{E.mode="add",E.lessonId=null,fe(),A(u,!0),A(f,!0),A(b,!1),A(w,!1),xe(!1);let L=typeof a=="string"&&a.trim()?a.trim():"Monday";r.value=L,r.value!==L&&(r.value="Monday"),l.value=L?`${L} lesson`:"",p.value="",De({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),T(l),Ce({trigger:m})},to=({lesson:a,trigger:m}={})=>{if(!a)return;E.mode="edit",E.lessonId=a.id,fe(),A(u,!0),A(f,!0),A(b,!1),A(w,!1),xe(!1);let L=a.dayLabel||a.dayName||"Monday";r.value=L,r.value!==L&&(r.value="Monday"),l.value=a.title||"",p.value=a.summary||"",De({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),T(l),Ce({trigger:m})},no=({lesson:a,trigger:m}={})=>{if(!a)return;E.mode="detail",E.lessonId=a.id,fe(),A(u,!0),A(f,!0),A(b,!0),A(w,!1),xe(!0);let L=a.dayLabel||a.dayName||"Monday";r.value=L,r.value!==L&&(r.value="Monday"),l.value=a.title||"",p.value=a.summary||"",c instanceof HTMLInputElement&&(c.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),De({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),T(y instanceof HTMLElement?y:null),Ce({trigger:m})},oo=({suggestedWeekId:a="",trigger:m}={})=>{E.mode="duplicate",E.lessonId=null,fe(),A(u,!1),A(f,!1),A(b,!1),A(w,!0),g instanceof HTMLInputElement&&(g.value=a),De({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),T(g instanceof HTMLElement?g:null),Ce({trigger:m})},so=async a=>{a.preventDefault(),qt(),Ot(!0);try{if(E.mode==="duplicate"){let B=g?.value?.trim();if(!B){Y("Enter the Monday date for the destination week.");return}if(B===k){Y("Choose a different week to duplicate into.");return}let re=await pn(k,B);re&&(k=B,R=re,ee(re),xt(B),G(re,B),W());return}if(E.mode==="detail"){if(!E.lessonId){Y("Select a lesson before adding details.");return}let B=y?.value?.trim();if(!B){Y("Add text for this detail.");return}let re=c?.value?.trim()||"",Be=await mn(k,E.lessonId,{badge:re,text:B});Be&&(R=Be,ee(Be),G(Be,k),W());return}let m=r.value.trim(),L=l.value.trim(),me=p.value.trim();if(!m){Y("Choose a day for this lesson.");return}if(!L){Y("Enter a lesson title.");return}if(E.mode==="edit"){if(!E.lessonId){Y("Select a lesson to edit.");return}let B=await un(k,E.lessonId,{dayName:m,title:L,summary:me});B&&(R=B,ee(B),G(B,k),W());return}let Ie=await dn(k,{dayName:m,title:L,summary:me});Ie&&(R=Ie,ee(Ie),G(Ie,k),W())}catch(m){console.error("Failed to save planner change",m),Y("Unable to save changes right now. Please try again.")}finally{Ot(!1)}};return t.addEventListener("submit",so),N.forEach(a=>{a.addEventListener("click",m=>{m.preventDefault(),W()})}),e.addEventListener("click",a=>{a.target===e&&W()}),C?.addEventListener("click",a=>{a.target===C&&W()}),{openAddLesson:eo,openEditLesson:to,openAddDetail:no,openDuplicatePlan:oo,close:W}}var vn=document.getElementById("remindersCount"),wn=document.getElementById("plannerCount"),Ln=document.getElementById("plannerSubtitle"),Rs=document.getElementById("resourcesCount"),qs=document.getElementById("templatesCount"),Oe=document.getElementById("dailySnapshotList"),Ue=document.getElementById("todaysFocusList"),V=document.getElementById("weekAtAGlanceList"),j=null;V&&(j=document.createElement("li"),j.dataset.emptyState="week",j.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",j.textContent="No upcoming events this week.");var Sn=()=>{if(!V||!j)return;V.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?V.contains(j)||V.appendChild(j):V.contains(j)&&V.removeChild(j)};V&&(Sn(),new MutationObserver(Sn).observe(V,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var yt=e=>{ht&&(e?ht.classList.remove("hidden"):ht.classList.add("hidden"))},Se={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Tn=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),kn=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),je=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",At=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},_o=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Rn=e=>{if(!e)return"";if(Tn)try{return Tn.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},$o=e=>{if(!e)return"";if(kn)try{return kn.format(e)}catch{}return e.toLocaleDateString()},qn=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Se,t)?t:"medium"},An=e=>{let t=qn(e);return Se[t]?.rank??Se.medium.rank},Wo=e=>{let t=qn(e);return Se[t]??Se.medium},xn=e=>{let t=At(e);return t?t.getTime():Number.POSITIVE_INFINITY};function On(e=[]){if(!Oe)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(o=>({reminder:o,date:At(o)})).filter(({date:o})=>o&&_o(o,t)).sort((o,s)=>o.date.getTime()-s.date.getTime());if(!n.length){Oe.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Oe.innerHTML="",n.forEach(({reminder:o,date:s})=>{let i=document.createElement("li");i.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let r=document.createElement("p");r.className="font-semibold text-base-content",r.textContent=je(o),i.appendChild(r);let l=Rn(s),p=document.createElement("p");p.className="text-xs text-base-content/70",p.textContent=l?`Due ${l}`:"Due today",i.appendChild(p),Oe.appendChild(i)})}function Un(e=[]){if(!Ue)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,o)=>{let s=An(n)-An(o);if(s!==0)return s;let i=xn(n)-xn(o);return i!==0?i:je(n).localeCompare(je(o),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){Ue.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}Ue.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let s=document.createElement("div");s.className="flex items-center justify-between gap-3";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=je(n),s.appendChild(i);let r=Wo(n),l=document.createElement("span");l.className=r.badgeClass,l.textContent=r.badgeLabel,s.appendChild(l),o.appendChild(s);let p=At(n),c=document.createElement("p");if(c.className="text-xs text-base-content/70",p){let y=Rn(p),g=$o(p),u=[];y&&u.push(`Due ${y}`),g&&u.push(g),c.textContent=u.length?u.join(" \u2022 "):"Due soon"}else c.textContent="No due date";o.appendChild(c),Ue.appendChild(o)})}var Vo=e=>{if(!vn)return;let t=Array.isArray(e)?e.length:0;vn.textContent=String(t)},jo=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Vo(t),On(t),Un(t)};document.addEventListener("memoryCue:remindersUpdated",jo);On();Un();var vt=Vt(Wt),Ko={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},_e=null,Yo=3,Dn=120;function Go(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Dn?t:`${t.slice(0,Dn-1)}\u2026`:""}function zo(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let o=n.trim().toLowerCase();return o==="true"||o==="1"||o==="yes"}return!1})}function Cn(e){if(!ce)return;let t=Array.isArray(e)?e:[];if(!t.length){ce.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',yt(!1);return}let n=t.filter(i=>zo(i));if(!n.length){ce.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',yt(!1);return}yt(!0);let s=n.slice(0,Yo).map(i=>{let r=D(ae(i,"title")||"Untitled Cue"),l=ae(i,"details"),p=D(Go(l)),c=p?`<p class="mt-1 text-sm text-base-content/70">${p}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${r}</p>
          ${c}
        </li>
      `}).join("");ce.innerHTML=s}function wt(e,{tone:t="muted"}={}){if(!K)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),K.innerHTML=`<p class="${n.join(" ")}">${D(e)}</p>`}function Qo(e){if(!K)return;if(!Array.isArray(e)||e.length===0){wt("No cues yet.");return}let t=e.map(n=>{let o=D(ae(n,"title")||"Untitled Cue"),s=D(ae(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${s?`<p>${s}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${D(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${D(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");K.innerHTML=t}async function Ae(){return _e||(_e=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:s,collection:i,doc:r,getDoc:l,addDoc:p,updateDoc:c,getDocs:y,query:g,orderBy:u,serverTimestamp:f,setDoc:b,arrayUnion:w}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),v=t(),C=v&&v.length?v[0]:e(Ko),N=n(C);(function(){let I=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;I&&(I.__persistenceInitialized__||(I.__persistenceInitialized__=!0,(async()=>{try{await o(N),console.info("[Firestore] Persistence: multi-tab enabled")}catch(P){if(P&&P.code==="failed-precondition")try{await s(N),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(E){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",E?.code||E)}else P&&P.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",P?.code||P)}})()))})();let J=i(N,"cues");return{db:N,cuesCollection:J,getCollection:i,doc:r,getDoc:l,addDoc:p,updateDoc:c,getDocs:y,query:g,orderBy:u,serverTimestamp:f,setDoc:b,arrayUnion:w}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),_e)}async function Jo(){let e=await Ae(),{getDocs:t,cuesCollection:n,query:o,orderBy:s}=e,i=o&&s?o(n,s("createdAt","desc")):n;return(await t(i)).docs.map(l=>({id:l.id,...l.data()}))}async function Xo(e){if(!e)return null;let t=await Ae(),{db:n,doc:o,getDoc:s}=t,i=o(n,"cues",e),r=await s(i);return r.exists()?{id:r.id,...r.data()}:null}async function _n(){if(!(!K&&!ce))try{let e=await Jo();Qo(e),Cn(e)}catch(e){console.error("Failed to load cues",e),et(e)?wt("Sign in to view your cues.",{tone:"muted"}):wt("Unable to load cues right now.",{tone:"error"}),Cn([])}}function Zo(e){!se||!_||(jt(e,vt),_.value=e?.id||"",$?.setEditMode(!0),$?.show({mode:"edit"}))}async function es(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await Xo(n);if(!o)return;Zo(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function ts(e){if(e.preventDefault(),!se||!_)return;let t=_.value.trim(),n=Yt(vt);try{let o=await Ae(),{db:s,doc:i,addDoc:r,updateDoc:l,cuesCollection:p,serverTimestamp:c}=o,y=typeof c=="function"?c():null;if(t){let g=i(s,"cues",t),u={...n};y&&(u.updatedAt=y),await l(g,u)}else{let g={...n};y&&(g.createdAt=y,g.updatedAt=y),await r(p,g)}await _n(),Kt(vt,_,$?.modalTitle??null,No),await $?.hide({reason:"form-submit"})}catch(o){console.error("Failed to save cue",o)}}async function ns(){!se||!_||!K||(K.addEventListener("click",es),se.addEventListener("submit",ts))}se&&_&&(document.addEventListener("cue:prepare",()=>{_.value="",$?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{_.value="",$?.setEditMode(!1)}));se&&_&&K&&ns().catch(e=>{console.error("Failed to initialise cue editing",e)});(K||ce)&&_n();var S=[],$e=null,ne=!1,Te=X(),Ke=!1,k=Te,R=null,z=Uo(),os=e=>{if(!wn)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=cn(Te),wn.textContent=String(t.length)};function G(e,t){if(os(e),Ln){let n=ft(e?.weekId||t,{short:!0});Ln.textContent=n||""}}function Lt(e,{tone:t="muted"}={}){if(!ie)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),ie.innerHTML=`<p class="${n.join(" ")}">${D(e)}</p>`}function xt(e){if(!En)return;let t=ft(e);En.textContent=t||""}function ee(e){if(!ie)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){Lt("No lessons saved for this week yet.");return}let n=t.map(o=>{let s=Array.isArray(o.details)?o.details.map(p=>`
                <li class="flex items-center gap-2">
                  ${p.badge?`<span class="badge badge-outline badge-sm text-secondary">${D(p.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${D(p.text)}</span>
                </li>
              `).join(""):"",i=s?`<ul class="space-y-2 text-sm text-base-content/70">${s}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',r=typeof o.id=="string"?o.id:"",l=o.summary?`<p class="text-sm text-base-content/70">${D(o.summary)}</p>`:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow">
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${D(o.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${D(o.title||o.dayLabel||"Lesson")}</h2>
                ${l}
              </div>
              <div class="flex items-center gap-1">
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${r}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${r}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${i}
            <div>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${r}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");ie.innerHTML=n}async function ve(e){if(!ie)return;let t=e||X();k=t,xt(t),Lt("Loading plan\u2026");try{let n=await Z(t);R=n,ee(n),G(n,t)}catch(n){console.error("Failed to load planner week",n),Lt("Unable to load this week's planner.",{tone:"error"})}}function ss(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),o=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":rs(o,t);break;case"edit":as(o,t);break;case"delete":ls(o);break;default:break}}async function $n(e){if(typeof document>"u"||!z)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=R?.lessons?.[0]?.dayLabel||"Monday";z.openAddLesson({defaultDay:n,trigger:t})}async function is(e){if(!z)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Re(k,1);z.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function rs(e,t){if(!e||!z)return;let n=R?.lessons?.find(s=>s.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;z.openAddDetail({lesson:n,trigger:o})}async function as(e,t){if(!e||!z)return;let n=R?.lessons?.find(s=>s.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;z.openEditLesson({lesson:n,trigger:o})}async function ls(e){if(!e||typeof window>"u")return;let t=R?.lessons?.find(o=>o.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let o=await fn(k,e);o&&(R=o,ee(o),G(o,k))}catch(o){console.error("Failed to delete planner lesson",o),window.alert("Unable to delete that lesson right now.")}}function Wn(){if(Ke||!ie){Ke&&ve(k);return}Ke=!0,ln({ensureFirestore:Ae}),ie.addEventListener("click",ss),Oo?.addEventListener("click",$n),qo?.addEventListener("click",is),Po?.addEventListener("click",()=>{let e=Re(k,-1);ve(e)}),Ho?.addEventListener("click",()=>{let e=Re(k,1);ve(e)}),Ro?.addEventListener("click",()=>{ve(X())}),ve(k)}function In(){typeof window>"u"||Mn()==="planner"&&Wn()}function cs(e){let t=e?.detail?.plan;t&&(Ke&&t.weekId===k&&(R=t,ee(t),xt(t.weekId)),t.weekId===Te&&G(t,Te))}G(null,Te);typeof document<"u"&&document.addEventListener(lt,cs);typeof window<"u"&&(window.addEventListener("hashchange",In),window.addEventListener("DOMContentLoaded",In));var Vn="dailyTasksByDate",We=null;function Dt(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function ds(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),s=Number.parseInt(t,10),i=Number.parseInt(n,10),r=Number.parseInt(o,10);if(!Number.isFinite(s)||!Number.isFinite(i)||!Number.isFinite(r))return e;let l=new Date(s,i-1,r);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(l)}function ke(e){if(!Et)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);Et.disabled=!t}function oe(e){if(!te)return;if(!Array.isArray(e)||e.length===0){te.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',ke([]);return}let t=e.map((n,o)=>{let s=D(n?.text||""),i=!!n?.completed,r=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return i&&r.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${s}" ${i?"checked":""} />
          <span class="${r.join(" ")}">${s}</span>
        </div>
      `}).join("");te.innerHTML=t,ke(e)}function Ze(){Xe&&Xe.classList.remove("hidden")}function us(){Xe&&Xe.classList.add("hidden")}function Ct(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function ue(e){return Array.isArray(e)?e.map(t=>Ct(t)):[]}function It(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Vn);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function jn(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Vn,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Bn(e){let t=It(),n=t&&typeof t=="object"?t[e]:[];return ue(n)}function Ye(e,t){let n=It(),o=ue(t);return n[e]=o,jn(n),o}function gt(e,t){let n=It(),o=ue(n[e]);return o.push(Ct(t)),n[e]=o,jn(n),o}function et(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Bt(){return We||(We=Ae().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),We)}function Ft(e,t){let{doc:n,dailyListsCollection:o,db:s}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(s,"dailyLists",t)}async function Mt(){if(!bn||!te)return;let e=Dt(),t=ds(e);if(bn.textContent=t?`Today's List - ${t}`:"Today's List",ne){Ze();let n=Bn(e);return S=n,oe(n),Promise.resolve(n)}return $e||(te.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',ke([]),$e=(async()=>{try{let n=await Bt(),o=Ft(n,e),s=await n.getDoc(o),i=s.exists()?s.data()?.tasks:[];return S=ue(i),oe(S),Ye(e,S),ne=!1,us(),S}catch(n){if(et(n)){console.warn("Falling back to local daily tasks due to permission issue",n),ne=!0,Ze();let o=Bn(e);return S=o,oe(o),o}return console.error("Failed to load daily list",n),te.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',S=[],ke(S),S}})().finally(()=>{$e=null})),$e}async function fs(e){let t=Dt(),n=Ct(e);if(ne){gt(t,n);return}try{let o=await Bt(),s=Ft(o,t),i=await o.getDoc(s);if(i.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(s,{tasks:o.arrayUnion(n)});else{let r=i.exists()?i.data()?.tasks:[],l=Array.isArray(r)?ue(r):[];l.push(n),typeof o.setDoc=="function"?await o.setDoc(s,{tasks:l},{merge:!0}):await o.updateDoc(s,{tasks:l})}gt(t,n)}catch(o){if(et(o)){console.warn("Saving task locally because cloud sync is unavailable",o),ne=!0,Ze(),gt(t,n);return}throw o}}async function Kn(e){let t=Dt(),n=ue(e);if(ne){Ye(t,n);return}try{let o=await Bt(),s=Ft(o,t);typeof o.setDoc=="function"?await o.setDoc(s,{tasks:n},{merge:!0}):await o.updateDoc(s,{tasks:n}),Ye(t,n)}catch(o){if(et(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),ne=!0,Ze(),Ye(t,n);return}throw o}}function Yn(e){[Qe,Je].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function ms(){!we||!Le||(we.classList.remove("hidden"),Le.classList.add("hidden"),Yn(Qe))}function ps(){!we||!Le||(we.classList.add("hidden"),Le.classList.remove("hidden"),Yn(Je),Mt())}Qe&&Je&&we&&Le&&(Qe.addEventListener("click",e=>{e.preventDefault(),ms()}),Je.addEventListener("click",e=>{e.preventDefault(),ps()}));var F=null,q=!1,Ge=null;function de(e){if(!H)return;H.setAttribute("aria-pressed",e?"true":"false");let t=H.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":H.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function hs(){q&&(window.clearTimeout(Ge),Ge=window.setTimeout(()=>{Ge=null,q&&Gn(!0)},400))}function Gn(e=!1){if(!F)return!1;if(q&&!e)return!0;try{return F.start(),q=!0,de(!0),!0}catch{return q=!1,de(!1),!1}}function Nt(){if(F){q=!1,window.clearTimeout(Ge);try{F.stop()}catch{}de(!1)}}function ys(){if(H)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){H.setAttribute("disabled","true"),H.setAttribute("aria-disabled","true"),H.title="Voice input is not supported in this browser.";return}F=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(F.lang=t,F.interimResults=!1,"continuous"in F)try{F.continuous=!0}catch{}F.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&M){M.value=o.trim();try{M.focus({preventScroll:!0})}catch{M.focus()}try{let s=M.value.length;M.setSelectionRange(s,s)}catch{}}},F.onend=()=>{if(!q){de(!1);return}hs()},F.onerror=()=>{q=!1,de(!1)}}catch{F=null,de(!1),H.setAttribute("disabled","true"),H.setAttribute("aria-disabled","true")}}ys();H?.addEventListener("click",()=>{F&&(q?Nt():Gn())});Hn?.addEventListener("submit",()=>{q&&Nt()});window.addEventListener("pagehide",()=>{q&&Nt()});Hn?.addEventListener("submit",async e=>{if(e.preventDefault(),!M)return;let t=M.value.trim();if(!t){M.focus();return}let n={text:t,completed:!1};M.value="",M.focus();try{await fs(n),await Mt()}catch(o){console.error("Failed to add task to the daily list",o),M.value=t,M.focus()}});te?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(S)||Number.isNaN(n)||!S[n])return;let o=S.map(i=>({...i})),s=o.map((i,r)=>r===n?{...i,completed:t.checked}:i);S=s,oe(s);try{await Kn(s)}catch(i){console.error("Failed to update task completion state",i),S=o,oe(o)}});Et?.addEventListener("click",async()=>{if(!Array.isArray(S)||S.length===0)return;let e=S.filter(n=>!n.completed);if(e.length===S.length)return;let t=S.map(n=>({...n}));S=e,oe(e);try{await Kn(e)}catch(n){console.error("Failed to clear completed tasks",n),S=t,oe(t)}});ke(S);Mt();function gs(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),o=document.getElementById("noteNewBtn"),s=document.getElementById("notesList");if(!e||!t||!n||!o)return;let i=null,r=u=>{if(!u){i=null,e.value="",t.value="";return}i=u.id,e.value=u.title||"",t.value=u.body||""},l=()=>{if(!s)return;s.querySelectorAll("button[data-note-id]").forEach(f=>{if(!(f instanceof HTMLElement))return;let b=f.getAttribute("data-note-id")===i;f.classList.toggle("bg-base-200/80",b),f.classList.toggle("border-base-300",!b),f.classList.toggle("border-primary",b),f.classList.toggle("font-medium",b),f.setAttribute("aria-current",b?"true":"false")})},p=()=>{let u=Me();return Array.isArray(u)?[...u].sort((f,b)=>{let w=Date.parse(f?.updatedAt||""),v=Date.parse(b?.updatedAt||"");return(Number.isNaN(v)?0:v)-(Number.isNaN(w)?0:w)}):[]},c=u=>{if(!u)return;let f=Me();if(!Array.isArray(f))return;let b=f.filter(v=>v.id!==u);if(b.length===f.length)return;ot(b),i===u&&(i=null);let w=y();if(i){let v=w.find(C=>C.id===i)||null;r(v)}else w.length?r(w[0]):r(null);l()},y=(u=p())=>{if(!s)return u;if(s.innerHTML="",!u.length){let f=document.createElement("li");return f.className="text-sm italic text-base-content/60",f.textContent="No saved notes yet.",s.appendChild(f),u}return u.forEach(f=>{let b=document.createElement("li");b.className="flex items-center gap-2";let w=document.createElement("button");w.type="button",w.dataset.noteId=f.id,w.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",w.textContent=f.title||"Untitled note",w.addEventListener("click",()=>{r(f),l()});let v=document.createElement("button");v.type="button",v.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",v.setAttribute("aria-label",`Delete note "${f.title||"Untitled note"}"`),v.textContent="Delete",v.addEventListener("click",C=>{C.stopPropagation(),c(f.id)}),b.appendChild(w),b.appendChild(v),s.appendChild(b)}),l(),u},g=()=>{let u=y();if(!u.length){r(null),l();return}let f=i?u.find(b=>b.id===i):null;r(f||u[0]),l()};n.addEventListener("click",()=>{let u=Me(),f=Array.isArray(u)?[...u]:[],b=typeof e.value=="string"?e.value.trim():"",w=typeof t.value=="string"?t.value:"",v=b||"Untitled note",C=new Date().toISOString();if(i){let x=f.findIndex(I=>I.id===i);if(x>=0)f[x]={...f[x],title:v,body:w,updatedAt:C};else{let I=nt(v,w,{updatedAt:C});i=I.id,f.unshift(I)}}else{let x=nt(v,w);i=x.id,f.unshift(x)}ot(f);let N=y(),J=i?N.find(x=>x.id===i):null;r(J||null),l()}),o.addEventListener("click",()=>{i=null,e.value="",t.value="",l(),typeof e.focus=="function"&&e.focus()}),g()}gs();var zn="theme",bs="professional",St="memoryCue:theme-change",Es="professional",Tt=document.getElementById("theme-menu"),Qn="[data-theme-name],[data-theme-option]",vs=new Set(["dark","dracula","synthwave"]);function Q(e){return typeof e=="string"?e.trim():""}function Jn(e){return e instanceof HTMLElement?Q(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function ws(e){let t=Q(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",vs.has(t)))}function Fn(e){let t=Q(e);if(t)try{localStorage.setItem(zn,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Xn(e){if(!Tt)return;let t=Q(e);Tt.querySelectorAll(Qn).forEach(o=>{if(!(o instanceof HTMLElement))return;let s=Jn(o),i=t&&s===t;o.setAttribute("aria-checked",i?"true":"false"),o.classList.toggle("active",i)})}function Ls(e){let t=Q(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(St,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent(St,!0,!0,{theme:t}),window.dispatchEvent(o)}}}function kt(e,{persist:t=!0,notify:n=!0}={}){let o=Q(e);if(!o)return;Q(document.documentElement.getAttribute("data-theme"))!==o&&ws(o),t&&Fn(o),Xn(o),n&&Ls(o)}function Ss(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){kt(Es,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(zn)||""}catch(o){console.warn("Unable to load theme preference",o)}let n=t||document.documentElement.getAttribute("data-theme")||bs;n&&kt(n,{persist:!1,notify:!0})}Tt?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(Qn):null;if(!t)return;e.preventDefault();let n=Jn(t);n&&kt(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(St,e=>{let t=Q(e?.detail?.theme);t&&Xn(t)});Ss()});export default Ts();
