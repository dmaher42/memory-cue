import{a as yi,b as gi,c as bi,i as Jo}from"./chunk-DJ2N4447.js";import{a as mi,b as hi,c as zo}from"./chunk-GUVSRPRW.js";var Si=zo((pr,lt)=>{var Wt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function vi(d){if(!d||typeof d!="object")return null;let r=Object.entries(d).filter(([y,w])=>typeof w=="string"&&w.trim()!=="");return r.length?Object.fromEntries(r):null}function Qo(){let d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=vi(d?.__FIREBASE_CONFIG);if(r)return r;let y=vi(d?.__ENV?.FIREBASE_CONFIG);if(y)return y;let F=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((O,[W,me])=>{let P=d?.__ENV?.[W]??d?.[W];return typeof P=="string"&&P.trim()!==""&&(O[me]=P),O},{});return Object.keys(F).length?F:null}function Ei(){let d=Qo();return d?{...Wt,...d}:{...Wt}}var wi={DEFAULT_FIREBASE_CONFIG:Wt,getFirebaseConfig:Ei};if(typeof globalThis<"u"){let d=globalThis;d.memoryCueFirebase=d.memoryCueFirebase||{},d.memoryCueFirebase.getFirebaseConfig=Ei,d.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Wt}typeof lt<"u"&&lt.exports&&(lt.exports=wi,lt.exports.default=wi)});function tr(){if(pe)return{...pe};let r=Rn()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return pe=r.getFirebaseConfig(),{...pe};if(typeof mi=="function")try{let y=Si();if(y){let w=typeof y.getFirebaseConfig=="function"?y.getFirebaseConfig:typeof y.default?.getFirebaseConfig=="function"?y.default.getFirebaseConfig:null;if(w)return pe=w(),{...pe}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(pe={...r.DEFAULT_FIREBASE_CONFIG},{...pe}):(pe={...er},{...pe})}function Rn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Ci(){let d=Rn(),r=d&&d.TimestampTrigger;return typeof r=="function"?r:null}function we(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Ci()}function nr(){if(typeof window>"u"||!window.location)return Ln;try{return new URL(Ln,window.location.href).href}catch{return Ln}}async function Ie(){return Gt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Gt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(nr()),await navigator.serviceWorker.ready}catch(d){return console.warn("Service worker registration failed",d),null}})(),Gt))}async function Li(d){if(!d||typeof d!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await Ie();if(!r)return!1;let y=new Set;navigator.serviceWorker.controller&&y.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(F=>{let O=r[F];O&&y.add(O)});let w=!1;return y.forEach(F=>{try{F.postMessage(d),w=!0}catch(O){console.warn("Failed posting message to service worker",O)}}),w}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function Kt(){if(we())return!1;if(kn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(ct)try{return await ct}catch{}ct=(async()=>{let d=await Ie();if(!d)return!1;let r=!1;if("periodicSync"in d)try{let y=await d.periodicSync.getTags();(!Array.isArray(y)||!y.includes(Cn))&&await d.periodicSync.register(Cn,{minInterval:15*60*1e3}),r=!0}catch(y){console.warn("Periodic background sync unavailable",y)}if(!r&&"sync"in d)try{await d.sync.register(Cn),r=!0}catch(y){console.warn("Background sync unavailable",y)}return r})();try{let d=await ct;return d&&(kn=!0),d}catch(d){return console.warn("Background reminder sync setup failed",d),kn=!1,!1}finally{ct=null}}async function xn(d=[],{requestCheck:r=!1}={}){if(!we()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let y=await Ie();if(!y)return;let w=await Li({type:Ii.updateScheduledReminders,reminders:Array.isArray(d)?d:[]});if(r&&await Li({type:Ii.checkScheduledReminders}),!w&&typeof y.update=="function")try{await y.update()}catch{}}catch(y){console.warn("Failed syncing reminders with service worker",y)}}async function Nn(d,r){if(we())try{let y=r||await Ie();if(!y)return;let w=[];try{w=await y.getNotifications({tag:d,includeTriggered:!0})}catch{w=await y.getNotifications({tag:d})}for(let F of w)try{F.close()}catch{}}catch{}}function ki(){for(let d of Array.from(ve.values()))try{d.close()}catch{}ve.clear()}function ir(){if(Ai||typeof window>"u"||typeof window.addEventListener!="function")return;let d=()=>ki();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,d)}catch{}}),Ai=!0}function Y(d){if(typeof d=="string"){let r=d.replace(/\s+/g," ").trim();if(r)return r}return j}async function hr(d={}){let r=e=>e?document.querySelector(e):null,y=e=>e?Array.from(document.querySelectorAll(e)):[],w=r(d.titleSel),F=r(d.dateSel),O=r(d.timeSel),W=r(d.detailsSel),me=r(d.prioritySel),P=r(d.categorySel),Ue=r(d.saveBtnSel),Xt=r(d.cancelEditBtnSel),S=r(d.listSel),Bn="reminder-title-pinned",Di="reminder-title-unpinned",ut=r(d.detailPanelSel),zt=r(d.detailEmptySel),Jt=r(d.detailContentSel),ft=r(d.detailTitleSel),pt=r(d.detailDueSel),mt=r(d.detailPrioritySel),ht=r(d.detailCategorySel),he=r(d.detailNotesSel),Mn=he?.dataset?.placeholder||"No notes added yet.",xi=r(d.detailClearSel),yt=y(d.googleSignInBtnSel),gt=y(d.googleSignOutBtnSel),B=r(d.statusSel),U=r(d.syncStatusSel),Ni={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Ri=6e3,ne=null,bt=null;function Re(e,{clearMessage:t=!0}={}){ne&&(e&&ne.tokenId!==e||(ne.timeoutId&&clearTimeout(ne.timeoutId),t&&B&&B.dataset.undoToken===ne.tokenId&&(typeof B.replaceChildren=="function"?B.replaceChildren():B.textContent="",delete B.dataset.undoToken,delete B.dataset.statusKind),ne=null))}function Fi(e){if(!B)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>$o(e.tokenId)),e.button=i,typeof B.replaceChildren=="function"?B.replaceChildren(t,n,i):(B.textContent="",B.append(t,n,i)),B.dataset.statusKind="undo",B.dataset.undoToken=e.tokenId}function qe(e){if(!ut)return;let t=!!e;if(ut.dataset.state=t?"active":"empty",ut.dataset.selectedId=t&&e?.id?e.id:"",zt&&(zt.classList.toggle("hidden",t),zt.setAttribute("aria-hidden",t?"true":"false")),Jt&&(Jt.classList.toggle("hidden",!t),Jt.setAttribute("aria-hidden",t?"false":"true")),!t){ft&&(ft.textContent=""),pt&&(pt.textContent=""),mt&&(mt.textContent=""),ht&&(ht.textContent=""),he&&(he.textContent=Mn,he.dataset.empty="true");return}if(ft&&(ft.textContent=e.title||"Untitled reminder"),pt&&(pt.textContent=ai(e)),mt&&(mt.textContent=e.priority||"Medium"),ht&&(ht.textContent=e.category||j),he){let n=typeof e.notes=="string"?e.notes.trim():"";n?(he.textContent=n,he.dataset.empty="false"):(he.textContent=Mn,he.dataset.empty="true")}}function On(){bt=null,qe(null)}function Bi(e){bt=e?.id||null,qe(e||null)}function Mi(){if(!ut)return;if(!bt){qe(null);return}let e=c.find(t=>t?.id===bt);if(e){qe(e);return}On()}qe(null);function Qt(e,t){if(!U)return;let n=["online","offline","error"];n.forEach(a=>U.classList.remove(a)),n.includes(e)&&U.classList.add(e),U.dataset.state=e;let i=typeof t=="string"?t:Ni[e]||"";e==="online"||e==="offline"?(U.textContent="",U.dataset.compact="true",i?(U.setAttribute("aria-label",i),U.setAttribute("title",i)):(U.removeAttribute("aria-label"),U.removeAttribute("title"))):(U.textContent=i,U.removeAttribute("data-compact"),i?(U.setAttribute("aria-label",i),U.setAttribute("title",i)):(U.removeAttribute("aria-label"),U.removeAttribute("title")))}let z=r(d.notesSel),Oi=r(d.saveNotesBtnSel),Pi=r(d.loadNotesBtnSel),Pn=r(d.countTotalSel),vt=r(d.googleUserNameSel),Le=r(d.dateFeedbackSel),Q=r(d.voiceBtnSel),_i=r(d.notifBtnSel),je=r(d.moreBtnSel),Ve=r(d.moreMenuSel),Hi=r(d.copyMtlBtnSel),Zt=r(d.importFileSel),$i=r(d.exportBtnSel),Ui=r(d.syncAllBtnSel),Fe=r(d.syncUrlInputSel),qi=r(d.saveSettingsSel),ji=r(d.testSyncSel),Vi=y(d.openSettingsSel),wt=r(d.settingsSectionSel),Be=r(d.emptyStateSel),_n=r(d.listWrapperSel),en=r(d.categoryOptionsSel),J=r(d.plannerContextSel),H=r(d.plannerLessonInputSel),Z=d.variant||"mobile",Yi=typeof d.autoWireAuthButtons=="boolean"?d.autoWireAuthButtons:Z!=="desktop",Ye="all",tn=[],nn="";function Wi(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function Me(){if(Z!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=Wi(),n;Ye==="today"?n=`Today\u2019s reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,nn&&(n+=` \u2022 ${nn}`),e.textContent=n}function Gi(){Z==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(o=>{if(!o.ok)throw new Error("Weather request failed");return o.json()}).then(o=>{o&&o.current_weather&&typeof o.current_weather.temperature=="number"&&(nn=`${Math.round(o.current_weather.temperature)}\xB0C`,Me())}).catch(o=>{console.warn("Failed to fetch current temperature",o)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let Hn="mc:lastDefaults",on=()=>{J&&(J.classList.add("hidden"),J.setAttribute("aria-hidden","true"),typeof J.replaceChildren=="function"?J.replaceChildren():J.textContent=""),H&&(H.value="",H.dataset&&(delete H.dataset.lessonDayLabel,delete H.dataset.lessonTitle,delete H.dataset.lessonSummary))},Ki=(e={})=>{if(!J)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",o=document.createElement("p");o.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",o.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let s=i?document.createElement("p"):null;s&&(s.className="text-sm text-base-content/70",s.textContent=i),typeof J.replaceChildren=="function"?J.replaceChildren(...[o,a,s].filter(Boolean)):(J.textContent="",J.append(o,a),s&&J.append(s)),J.classList.remove("hidden"),J.removeAttribute("aria-hidden")},Xi=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";w&&typeof e.reminderTitle=="string"&&(w.value=e.reminderTitle),W&&typeof e.reminderNotes=="string"&&(W.value=e.reminderNotes),F&&typeof e.dueDate=="string"&&(F.value=e.dueDate),H&&(H.value=t,H.dataset&&(H.dataset.lessonDayLabel=dayLabel,H.dataset.lessonTitle=lessonTitle,H.dataset.lessonSummary=summary)),Ki(e)};function rn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Hn)||"{}")||{}}catch{return{}}}function zi(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Hn,JSON.stringify(e))}catch{}}function $n(e){let t=rn(),n={category:Y(e?.category||t.category||j),priority:e?.priority||t.priority||"Medium"};zi(n)}let Un='fieldset#priorityChips input[name="priority"]';function an(){try{let e=document.querySelector(`${Un}:checked`);if(e&&e.value)return e.value}catch{}return me&&typeof me.value=="string"&&me.value?me.value:"Medium"}function Et(e){let t=e||"Medium";me&&typeof me.value<"u"&&(me.value=t);try{let n=Array.from(document.querySelectorAll(Un));if(!n.length)return;let i=!1;if(n.forEach(o=>{let a=o.value===t;o.checked=a,i=i||a}),!i){let o=n.find(a=>a.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function qn(){let e=rn();e.category&&P&&(P.value=e.category),e.priority&&Et(e.priority)}qn();let G=typeof document<"u"?document.getElementById("quickAddInput"):null,Ji=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ee=typeof document<"u"?document.getElementById("quickAddVoice"):null,Ee=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,sn=null;function Qi(e,t){let n=Date.now(),i=rn(),o=typeof t=="string"&&t?t:null;return{id:Ht(),title:(e||"").trim(),priority:i.priority||an(),category:Y(i.category||P?.value||j),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!K,pinToToday:!1}}async function St(e={}){if(!G)return null;if(typeof sn=="function")try{sn()}catch{}let n=((typeof e.text=="string"?e.text:(G.value||"").trim())||"").trim();if(!n)return null;let o=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,a=null;if(o)a=new Date(o).toISOString();else try{let f=qt(n);f&&f.time&&(a=new Date(`${f.date}T${f.time}:00`).toISOString())}catch{a=null}let s=Qi(n,a);if(e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{s.notifyAt=new Date(e.notifyAt).toISOString()}catch{s.notifyAt=null}pn(s,{position:"start"}),c.unshift(s),ie(c);let l=Ze(c);Ce=!0,_(),V(),l?c.forEach(f=>X(f)):X(s),tt(s),Ne(s),Ae(),$n(s),Oe();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:c}}))}catch{}if(se({action:"created",label:`Reminder added \xB7 ${s.title}`}),G.value="",typeof document<"u")try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:s}}))}catch{}return s}typeof window<"u"&&(window.memoryCueQuickAddNow=St),Ji?.addEventListener("click",()=>{St()}),G?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),St())});function Zi(){if(typeof HTMLElement>"u"||!(ee instanceof HTMLElement)||!(G instanceof HTMLInputElement)||ee.dataset.voiceBound==="true")return;if(ee.dataset.voiceBound="true",typeof window>"u"){ee.setAttribute("disabled","true"),ee.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ee.setAttribute("disabled","true"),ee.setAttribute("aria-disabled","true"),ee.getAttribute("title")||(ee.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=s=>{n=s,ee.setAttribute("aria-pressed",s?"true":"false"),ee.dataset.listening=s?"true":"false",ee.classList.toggle("is-listening",s)},o=()=>{if(t)return t;t=new e;let s=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=s,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",f=>{let u=f?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){G.value=u;try{G.focus({preventScroll:!0})}catch{G.focus()}try{let g=G.value.length;typeof G.setSelectionRange=="function"&&G.setSelectionRange(g,g)}catch{}}});let l=()=>{i(!1)};return t.addEventListener("end",l),t.addEventListener("error",l),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};sn=a,ee.addEventListener("click",()=>{let s=o();if(s){if(n){a();return}try{s.start(),i(!0)}catch(l){console.warn("Quick add voice error:",l),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}Zi();let jn=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,re=null,Vn=!!jn;Vn&&(re=new jn,re.lang="en-AU",re.interimResults=!1,re.maxAlternatives=1);function eo(){try{if(typeof E=="function"){E("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}Ee&&(Vn&&re?Ee.addEventListener("click",()=>{try{re.start(),Ee.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):Ee.addEventListener("click",()=>{eo()})),re&&(re.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();io(t)}),re.addEventListener("end",()=>{Ee&&Ee.classList.remove("is-recording")}),re.addEventListener("error",()=>{Ee&&Ee.classList.remove("is-recording")}));function to(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function no(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,o=new Date(i);if(n.includes("tomorrow"))o.setDate(o.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let s=parseInt(a[1],10),l=a[2]?parseInt(a[2],10):0,f=a[3];f||(/\b(p\.?m\.?|p m)\b/.test(n)?f="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(f="am")),f==="pm"&&s<12&&(s+=12),f==="am"&&s===12&&(s=0),o.setHours(s,l,0,0);let u=new Date(o),g=new Date(u.getTime()-10*60*1e3);return t.dueDate=u,t.notifyAt=g,t}function io(e){if(!e||!G)return;let t=to(e),{dueDate:n,notifyAt:i}=no(e);G.value=t,St({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&G&&(e.preventDefault(),G.focus())})));try{Z==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let oo=d.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Yn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,ro=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Tt=d.reminderLandingPath||(Z==="desktop"?"index.html#reminders":"mobile.html"),ae=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Wn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Oe(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:c}}))}catch{}}P&&!P.value&&(P.value=j),we()&&Ie();function se(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Ti,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Ti,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function ao(){if(typeof HTMLElement>"u"||!(Q instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&w instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&w instanceof HTMLTextAreaElement;if(!e&&!t||Q.dataset.voiceBound==="true")return;if(Q.dataset.voiceBound="true",typeof window>"u"){Q.setAttribute("disabled","true"),Q.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){Q.setAttribute("disabled","true"),Q.setAttribute("aria-disabled","true"),Q.getAttribute("title")||(Q.title="Voice input is not supported in this browser.");return}let i=null,o=!1,a=u=>{o=u,Q.setAttribute("aria-pressed",u?"true":"false"),Q.dataset.listening=u?"true":"false",Q.classList.toggle("is-listening",u)},s=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",g=>{let I=g.results?.[0]?.[0]?.transcript?.trim()||"";if(I){w.value=I;try{w.focus({preventScroll:!0})}catch{try{w.focus()}catch{}}try{let T=w.value.length;typeof w.setSelectionRange=="function"&&w.setSelectionRange(T,T)}catch{}se({action:"dictated",label:`Voice input captured \xB7 ${I}`})}});let u=()=>{a(!1)};return i.addEventListener("end",u),i.addEventListener("error",u),i},l=()=>{if(!(!o||!i)){try{i.stop()}catch{}a(!1)}};Q.addEventListener("click",()=>{let u=s();if(u){if(o){l();return}try{u.start(),a(!0)}catch(g){console.warn("Speech recognition error:",g),a(!1)}}});let f=()=>{l()};typeof document<"u"&&(document.addEventListener("cue:close",f),document.addEventListener("reminders:updated",f)),a(!1)}ir(),ao();let At,It,Lt,Ct,Pe,kt,Dt,xt,Nt,Rt,Ft,We,Ge,Bt,Mt,dn,ln,Ot,cn,Gn=d.firebaseDeps,un=typeof d.importModule=="function"?d.importModule:e=>import(e),Ke=Rn(),Xe=!1,de=!1,fn=null,ye=null,ze=null,c=[],Ce=!1,K=null,Je=null,_e=null,ke={},De={},q={};function ie(e=c){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?Zn(t||{},n||{}):o-i})}function so(e=c){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function Qe(e=c){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),ie(n);else{n=e.slice().sort(Zn);let i=n.length;n.forEach((o,a)=>{o.orderIndex=(i-a)*fe})}return e===c&&(c=n),n}function pn(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=so();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-fe||fe}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+fe||fe}}function Ze(e=c){if(!Array.isArray(e)||e.length<2)return!1;ie(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,s=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(a==null||s==null||a<=s||a-s<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*fe;return e===c&&ie(c),!0}let k={draggingId:null,dropTargetId:null,dropBefore:!0},Kn=!1,m={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function lo(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function et(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Se(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function mn(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Se(),k.draggingId=null,k.dropTargetId=null,k.dropBefore=!0}function Xn(e,t,n){if(!e||e===t)return;let i=c.findIndex(T=>T?.id===e);if(i<0)return;let[o]=c.splice(i,1),a;if(!t)a=c.length;else{let T=c.findIndex($=>$?.id===t);if(T<0){c.splice(i,0,o);return}a=n?T:T+1}c.splice(a,0,o);let s=c[a-1],l=c[a+1],f=Number.isFinite(s?.orderIndex)?s.orderIndex:null,u=Number.isFinite(l?.orderIndex)?l.orderIndex:null,g;f!=null&&u!=null?g=(f+u)/2:f!=null?g=f-fe:u!=null?g=u+fe:g=fe,Number.isFinite(g)||(g=fe*(c.length+1)),o.orderIndex=g,ie(c);let I=Ze(c);Ce=!0,_(),V(),I?c.forEach(T=>X(T)):X(o),Oe(),ae("memoryCue:remindersUpdated",{items:c}),se({action:"reordered",label:"Reminders reordered"})}function co(e){let t=et(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(k.draggingId=i,k.dropTargetId=null,k.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function uo(e){if(!k.draggingId)return;let t=et(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),k.dropTargetId=null,k.dropBefore=!1,Se(),S?.classList.add("drag-over-list");return}if(t.dataset.id===k.draggingId){e.preventDefault(),Se();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(k.dropTargetId!==t.dataset.id||k.dropBefore!==o)&&(Se(),t.classList.add(o?"drag-over-before":"drag-over-after"),k.dropTargetId=t.dataset.id,k.dropBefore=o)}function fo(e){let t=et(e.target);if(!t){S?.contains(e.relatedTarget)||Se();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function po(e){if(!k.draggingId)return;e.preventDefault();let t=et(e.target),n=t?.dataset.id||null,i=k.dropBefore;if(t){let o=t.getBoundingClientRect(),a=o.top+o.height/2;i=e.clientY<a}else n=null,i=!1;Xn(k.draggingId,n,i),mn()}function mo(){mn()}function ho(){!S||Kn||(Kn=!0,S.addEventListener("dragstart",co),S.addEventListener("dragover",uo),S.addEventListener("drop",po),S.addEventListener("dragend",mo),S.addEventListener("dragleave",fo),Pt())}function Pt(){if(!S||Pt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Pt._bound=!0;return}let t=6,n=160;function i(){m.longPressTimer&&(clearTimeout(m.longPressTimer),m.longPressTimer=null)}function o(){S&&(m.initialTouchAction!=null?S.style.touchAction=m.initialTouchAction:S.style.removeProperty("touch-action"))}function a({keepHighlights:v=!1}={}){if(i(),m.item&&m.pointerId!=null)try{m.item.hasPointerCapture?.(m.pointerId)&&m.item.releasePointerCapture(m.pointerId)}catch{}if(m.placeholder?.parentNode)try{m.placeholder.parentNode.removeChild(m.placeholder)}catch{}m.item&&(m.item.classList.remove("is-dragging"),m.originalStyles?m.item.setAttribute("style",m.originalStyles):m.item.removeAttribute("style")),o(),v||Se(),Object.assign(m,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function s(v){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(h=>h!==v):[]}function l(v){let h=m.item;if(!h||m.ready)return;let L=h.getBoundingClientRect(),R=window.getComputedStyle(h);m.ready=!0,k.draggingId=h.dataset.id||null,m.offsetY=v.clientY-L.top,m.fixedX=L.left;let D=document.createElement("div");D.className="touch-drag-placeholder",D.setAttribute("aria-hidden","true"),D.style.height=`${L.height}px`,D.style.boxSizing="border-box",D.style.marginTop=R.marginTop,D.style.marginBottom=R.marginBottom,D.style.marginLeft=R.marginLeft,D.style.marginRight=R.marginRight,D.style.borderRadius=R.borderRadius,D.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",D.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",D.style.pointerEvents="none",D.style.display="block",D.style.width="100%",h.parentNode?.insertBefore(D,h),m.placeholder=D,m.longPressTimer=null,m.originalStyles=h.getAttribute("style")||"",h.classList.add("is-dragging"),h.style.position="fixed",h.style.left=`${L.left}px`,h.style.top=`${L.top}px`,h.style.width=`${L.width}px`,h.style.zIndex="999",h.style.pointerEvents="none",h.style.touchAction="none",m.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function f(v){let h=m.item;if(!h||!m.ready)return;let L=v-m.offsetY;h.style.top=`${L}px`,h.style.left=`${m.fixedX}px`}function u(v){if(!m.ready||!S)return;let h=m.item,L=s(h);if(Se(),!L.length){k.dropTargetId=null,k.dropBefore=!1;return}let R=null,D=!1;for(let p of L){let b=p.getBoundingClientRect(),N=b.top+b.height/2;if(v<N){R=p,D=!0;break}}if(!R){R=L[L.length-1];let p=R.getBoundingClientRect(),b=p.top+p.height/2;D=v<b,D||(D=!1)}if(!R){k.dropTargetId=null,k.dropBefore=!1;return}let ce=R.getBoundingClientRect(),Tn=ce.top+ce.height/2,ot=v<Tn;R.classList.add(ot?"drag-over-before":"drag-over-after"),k.dropTargetId=R.dataset.id||null,k.dropBefore=ot}function g(v){let h=k.draggingId,L=m.moved;if(!m.ready){a();return}a(),!v&&L&&h&&Xn(h,k.dropTargetId,k.dropBefore),mn()}function I(v){let h=v.pointerType||"";if(h&&h!=="touch"&&h!=="pen"||m.active)return;let L=et(v.target);if(!L)return;let R=lo(v.target);if(!(R&&R!==L)){m.active=!0,m.pointerId=v.pointerId,m.item=L,m.startX=v.clientX,m.startY=v.clientY,m.lastClientX=v.clientX,m.lastClientY=v.clientY,m.moved=!1,m.ready=!1,m.originalStyles=L.getAttribute("style")||"",m.startTime=v.timeStamp||Date.now(),k.dropTargetId=null,k.dropBefore=!0,k.draggingId=null,i(),m.longPressTimer=setTimeout(()=>{l({clientY:m.lastClientY})},n);try{L.setPointerCapture(v.pointerId)}catch{}}}function T(v){if(!m.active||v.pointerId!==m.pointerId)return;let h=v.pointerType||"";if(!(h&&h!=="touch"&&h!=="pen")){if(m.lastClientX=v.clientX,m.lastClientY=v.clientY,!m.ready){let L=Math.abs(v.clientX-m.startX),R=Math.abs(v.clientY-m.startY);if(L>t||R>t){let D=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(D-m.startTime)>=n?(i(),l({clientY:m.lastClientY})):a()}return}v.preventDefault(),m.moved=!0,f(v.clientY),u(v.clientY)}}function $(v){!m.active||v.pointerId!==m.pointerId||g(!1)}function oe(v){!m.active||v.pointerId!==m.pointerId||g(!0)}S.addEventListener("pointerdown",I),window.addEventListener("pointermove",T),window.addEventListener("pointerup",$),window.addEventListener("pointercancel",oe),Pt._bound=!0}function zn(){K=null,Qt("offline"),yt.forEach(e=>e.classList.remove("hidden")),gt.forEach(e=>e.classList.add("hidden")),vt&&(vt.textContent=""),Je?.(),Je=null,yn(),_(),V(),Ae()}function hn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Dn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:Ht(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:Y(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function yo(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Dn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:Y(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(Dn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function V(){ie(c),yo(c)}function yn(){c=Qe(hn())}yn();async function go(){if(!K){c=hn();return}let e=Qe(hn());if(!e.length){c=[],V();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await X(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}c=Qe(e.map(n=>({...n,pendingSync:!1}))),V(),_(),Ae()}try{q=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{q={}}if(q&&typeof q=="object"&&Object.values(q).forEach(e=>{e&&typeof e=="object"&&(e.category=Y(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:nt(e),e.urlPath=e.urlPath||Tt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!we()){let e=ri();typeof Notification<"u"&&Notification.permission==="granted"?(Kt(),e.length&&xn(e,{requestCheck:!0})):e.length&&xn(e)}let _t=e=>{if(!Ke)return;let t=[Ke];Ke.window&&!t.includes(Ke.window)&&t.push(Ke.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function bo(){if(!z)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in z?z.value:z.innerHTML,s=g=>{if("value"in z){z.value=g;return}if(typeof g!="string"||g.length===0){z.innerHTML="";return}let I=g.trim();if(/<\/?[a-z][\s\S]*>/i.test(I)){z.innerHTML=g;return}let $=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");z.innerHTML=$},l=g=>{g?z.classList.add("notes-editor--columns"):z.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!g))},f="";try{f=localStorage.getItem(n)||""}catch{E("Unable to access saved notes")}s(f);let u=!1;try{u=localStorage.getItem(i)==="1"}catch{u=!1}l(u),z.addEventListener("input",()=>{f=a();try{localStorage.setItem(n,f)}catch{E("Notes saved for this session only")}}),Oi?.addEventListener("click",()=>{f=a();try{localStorage.setItem(n,f),E("Notes saved")}catch{E("Notes saved for this session only")}}),Pi?.addEventListener("click",()=>{let g=f;try{g=localStorage.getItem(n)||f}catch{E("Unable to load saved notes")}f=g,s(f)}),e?.addEventListener("click",g=>{let I=g.target;if(!(I instanceof Element))return;let T=I.closest("button[data-action]");if(!T)return;let $=T.getAttribute("data-action");if($==="columns"){let oe=!z.classList.contains("notes-editor--columns");l(oe);try{localStorage.setItem(i,oe?"1":"0")}catch{E("Column preference saved for this session only")}return}if(!o){E("Formatting controls are not supported in this browser");return}z.focus(),$==="bullets"?document.execCommand("insertUnorderedList"):$==="numbers"&&document.execCommand("insertOrderedList")})}if(bo(),Ue?.addEventListener("click",ci),Gn)({initializeApp:At,getFirestore:It,enableMultiTabIndexedDbPersistence:Lt,enableIndexedDbPersistence:Ct,doc:Pe,setDoc:kt,deleteDoc:Dt,onSnapshot:xt,collection:Nt,query:Rt,orderBy:Ft,serverTimestamp:We,getAuth:Ge,onAuthStateChanged:Bt,GoogleAuthProvider:Mt,signInWithPopup:dn,signInWithRedirect:ln,getRedirectResult:Ot,signOut:cn}=Gn),Xe=!0;else try{({initializeApp:At}=await un("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:It,enableMultiTabIndexedDbPersistence:Lt,enableIndexedDbPersistence:Ct,doc:Pe,setDoc:kt,deleteDoc:Dt,onSnapshot:xt,collection:Nt,query:Rt,orderBy:Ft,serverTimestamp:We}=await un("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ge,onAuthStateChanged:Bt,GoogleAuthProvider:Mt,signInWithPopup:dn,signInWithRedirect:ln,getRedirectResult:Ot,signOut:cn}=await un("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Xe=!0}catch(e){Xe=!1,console.warn("Firebase modules failed to load:",e),E("Firebase failed to load; notes available offline"),_t(!1)}if(Xe&&typeof At=="function"&&typeof It=="function"&&typeof Ge=="function")try{let e=tr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),fn=At(e),ye=It(fn),de=!0,console.info("[Firebase] Firestore initialised",e.projectId),_t(!0)}catch(e){de=!1,console.warn("Firebase initialization failed:",e),E("Firebase failed to load; notes available offline"),_t(!1)}else Xe?(de=!1,_t(!1)):de=!1;de&&typeof Lt=="function"&&typeof Ct=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Lt(ye),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Ct(ye),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),de&&typeof Ge=="function"&&(ze=Ge(fn));function vo(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let wo=typeof navigator<"u"&&navigator.language?navigator.language:"",Jn=vo(wo),He=Jn||"en-US",ge="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(ge=e.timeZone),!Jn&&e.locale&&(He=e.locale)}catch{}let Eo=new Intl.DateTimeFormat(He,{timeZone:ge,hour:"2-digit",minute:"2-digit"}),So=new Intl.DateTimeFormat(He,{timeZone:ge,weekday:"long",day:"numeric",month:"long"}),To=new Intl.DateTimeFormat("en-CA",{timeZone:ge,year:"numeric",month:"2-digit",day:"2-digit"}),Ao=new Intl.DateTimeFormat(He,{timeZone:ge,weekday:"long"}),Io=new Intl.DateTimeFormat(He,{timeZone:ge,month:"short",day:"numeric"});function Te(e){let t=To.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,o=t.find(a=>a.type==="day").value;return`${n}-${i}-${o}`}function Qn(e,t){let[n,i,o]=e.split("-").map(f=>parseInt(f,10)),[a,s]=t.split(":").map(f=>parseInt(f,10)),l=new Date;return l.setFullYear(n,(i||1)-1,o||1),l.setHours(a||0,s||0,0,0),l.toISOString()}let Lo=new Intl.DateTimeFormat("en-CA",{timeZone:ge,year:"numeric",month:"2-digit",day:"2-digit"}),Co=new Intl.DateTimeFormat("en-CA",{timeZone:ge,hour:"2-digit",minute:"2-digit",hour12:!1});function ko(e){try{let t=new Date(e),n=Lo.formatToParts(t),i=n.find(s=>s.type==="year")?.value||"0000",o=n.find(s=>s.type==="month")?.value||"00",a=n.find(s=>s.type==="day")?.value||"00";return`${i}-${o}-${a}`}catch{return""}}function Do(e){try{let t=new Date(e),n=Co.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function Ht(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function $t(){return Te(new Date)}function xo(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function dr(e){let t=xo(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Ut(e){return e==="High"?3:e==="Medium"?2:1}function Zn(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(o!==a)return o-a;let s=Ut(t?.priority)-Ut(e?.priority);return s||(t?.updatedAt||0)-(e?.updatedAt||0)}function lr(e,t){let n=Ut(t.priority)-Ut(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function ei(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return So.format(t)}catch{return e}}function gn(e){return Eo.format(e)}function No(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function cr(e){return e?No(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function E(e){B&&(Re(),B.dataset.statusKind="toast",B.textContent=e,clearTimeout(E._t),E._t=setTimeout(()=>{B&&B.dataset.statusKind==="toast"&&(B.textContent="",delete B.dataset.statusKind)},2500))}function Ro(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function qt(e){e=String(e||"").toLowerCase();let t={date:$t(),time:""},n=l=>{let f=new Date,u=f.getDay(),g=(l-u+7)%7,I=new Date(f);return I.setDate(f.getDate()+(g===0?7:g)),I},i=l=>{let f=new Date,u=f.getDay(),g=(l-u+7)%7,I=new Date(f);return I.setDate(f.getDate()+g),I},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let l=new Date;l.setDate(l.getDate()+1),t.date=Te(l)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[l[1]],u=n(f);t.date=Te(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[l[1]],u=i(f);t.date=Te(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[l[1]],u=n(f);t.date=Te(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let l=e.match(/\bin\s+(\d+)\s+days?\b/),f=parseInt(l[1],10),u=new Date;u.setDate(u.getDate()+f),t.date=Te(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let l=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),f=parseInt(l[1],10),u=parseInt(l[2],10)-1,g=l[3]?parseInt(l[3],10):new Date().getFullYear(),I=new Date(g,u,f);t.date=Te(I)}else for(let[l,f]of Object.entries(a)){let u=new RegExp(`\\b${l}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let g=e.match(u),I=parseInt(g[1],10),T=new Date().getFullYear(),$=new Date(T,f,I);t.date=Te($);break}}let s=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(s){let l=parseInt(s[1],10),f=s[2]?parseInt(s[2],10):0,u=s[3];u&&(u==="pm"&&l<12&&(l+=12),u==="am"&&l===12&&(l=0)),t.time=`${String(l).padStart(2,"0")}:${String(f).padStart(2,"0")}`}return t}let bn=de&&ze&&typeof Mt=="function";yi({authReady:bn,auth:ze,GoogleAuthProvider:Mt,signInWithPopup:dn,signInWithRedirect:ln,signOut:cn,toast:E});let ti=Yi,ni=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};ti&&yt.length&&yt.forEach(e=>ni(e,gi)),bn&&typeof Ot=="function"&&Ot(ze).catch(()=>{}),ti&&gt.length&&gt.forEach(e=>ni(e,bi)),bn&&typeof Bt=="function"?Bt(ze,async e=>{e?(K=e.uid,Qt("online"),yt.forEach(t=>t.classList.add("hidden")),gt.forEach(t=>t.classList.remove("hidden")),vt&&(vt.textContent=e.displayName||e.email||""),Fo(),await go()):zn()}):zn();function Fo(){if(!de||!ye||typeof Nt!="function"||typeof Rt!="function"||typeof Ft!="function"||typeof xt!="function")return;if(!K){yn(),_(),Me(),V(),Ae();return}Je&&Je();let e=Nt(ye,"users",K,"reminders"),t=Rt(e,Ft("updatedAt","desc"));Je=xt(t,n=>{let i=[];n.forEach(o=>{let a=o.data(),s=Number(a.orderIndex),l=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,f=a.pinToToday===!0;i.push({id:o.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:Y(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(s)?s:null,plannerLessonId:l,pinToToday:f})}),c=Qe(i),_(),Me(),V(),Ae()},n=>{console.error("Firestore sync error:",n),U&&Qt("error","Sync Error")})}async function X(e){if(!(!de||!K||!ye||typeof Pe!="function"||typeof kt!="function"||typeof We!="function"))try{await kt(Pe(ye,"users",K,"reminders",e.id),{ownerUid:K,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||j,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):We(),updatedAt:We()},{merge:!0})}catch(t){console.error("Save failed:",t),E("Save queued (offline)")}}async function Bo(e){if(!(!de||!K||!ye||typeof Pe!="function"||typeof Dt!="function"))try{await Dt(Pe(ye,"users",K,"reminders",e))}catch{E("Delete queued (offline)")}}async function tt(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||j,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function xe({preserveDetail:e=!1}={}){w&&(w.value=""),F&&(F.value=""),O&&(O.value=""),W&&(W.value=""),Et("Medium"),P&&(P.value=j),qn(),_e=null,Ue&&(Ue.textContent="Save"),Xt?.classList.add("hidden"),on(),e||On()}function Mo(e){let t=c.find(n=>n.id===e);t&&(w&&(w.value=t.title||""),F&&O&&(t.due?(F.value=ko(t.due),O.value=Do(t.due)):(F.value="",O.value="")),Et(t?.priority||"Medium"),P&&(P.value=Y(t.category)),W&&(W.value=typeof t.notes=="string"?t.notes:""),H&&(H.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),on(),Bi(t),_e=e,Ue&&(Ue.textContent="Update"),Xt?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),w?.focus(),ae("cue:open",{mode:"edit"}))}function Oo(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=Y(e.category??(P?P.value:"")),o={id:Ht(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!K,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday};pn(o,{position:"start"}),c=[o,...c],ie(c);let a=Ze(c);return Ce=!0,_(),V(),$n(o),a?c.forEach(s=>X(s)):X(o),tt(o),Ne(o),Oe(),ae("memoryCue:remindersUpdated",{items:c}),Wn(),se({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Po(e,t){if(!K)return E("Sign in to add notes"),null;if(!e)return null;let n=c.find(s=>s.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${o}`:o,n.updatedAt=Date.now(),X(n),_(),V(),se({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function _o(e){let t=c.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),X(t),tt(t),_(),V(),t.done?(Vt(e),se({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ne(t),se({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Ho(e,t){let n=c.find(o=>o?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),X(n),_(),V(),Oe(),ae("memoryCue:remindersUpdated",{items:c}))}function $o(e){if(!ne||ne.tokenId!==e)return;let{item:t,index:n}=ne;if(!t){Re(e);return}Re(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),c.length):c.length;t.pendingSync=!K,t.updatedAt=Date.now(),c.splice(i,0,t),ie(c);let o=Ze(c);Ce=!0,_(),V(),Ne(t),o?c.forEach(a=>X(a)):X(t),tt(t),Oe(),ae("memoryCue:remindersUpdated",{items:c}),se({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),E("Reminder restored")}function ii(e){let t=c.findIndex(o=>o.id===e),n=t>=0?c.splice(t,1)[0]:null;n&&_e===e&&xe(),_(),V(),Bo(e),Vt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(se({action:"deleted",label:i}),n&&B){Re();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ne={tokenId:o,item:n,index:t,timeoutId:null},Fi(ne),ne.timeoutId=setTimeout(()=>{Re(o)},Ri)}else n&&Re()}function Uo(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,o=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',s=null,l=!1,f=0,u=0,g=0,I=()=>{if(l){if(l=!1,s!=null&&e.hasPointerCapture?.(s))try{e.releasePointerCapture(s)}catch{}s=null,e.removeEventListener("pointermove",$),e.removeEventListener("pointerup",oe),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",oe),window.removeEventListener("pointercancel",v)}},T=h=>{if(h.pointerType==="mouse"&&h.button!==0)return;l&&I();let L=h.target;L instanceof Element&&L.closest(a)||(s=h.pointerId,f=h.clientX,u=h.clientY,g=typeof h.timeStamp=="number"?h.timeStamp:Date.now(),l=!0,e.addEventListener("pointermove",$),e.addEventListener("pointerup",oe),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",oe),window.addEventListener("pointercancel",v))},$=h=>{if(!l||h.pointerId!==s)return;Math.abs(h.clientY-u)>i&&I()},oe=h=>{if(!l||h.pointerId!==s)return;let L=h.clientX-f,R=Math.abs(h.clientY-u),D=(typeof h.timeStamp=="number"?h.timeStamp:Date.now())-g;if(I(),L<=-n&&R<=i&&D<=o){h.preventDefault(),h.stopPropagation();try{t()}catch(ce){console.warn("Swipe delete handler failed",ce)}}},v=h=>{l&&(typeof h.pointerId=="number"&&h.pointerId!==s||I())};e.addEventListener("pointerdown",T)}function nt(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=gn(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=gn(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function oi(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}E("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function ri(){return Object.values(q||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||j,notes:typeof e.notes=="string"?e.notes:"",body:nt(e),urlPath:e.urlPath||Tt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function vn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(q))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=ri(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Kt(),xn(e,{requestCheck:t})}function jt(e,{closeNotification:t=!0}={}){if(t){let n=ve.get(e);if(n){try{n.close()}catch{}ve.delete(e)}}ke[e]&&(clearTimeout(ke[e]),delete ke[e]),De[e]&&(clearTimeout(De[e]),delete De[e]),Nn(e),q[e]&&(delete q[e],vn())}function Vt(e){jt(e)}function wn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ve.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:nt(e),tag:e.id});ve.set(e.id,n);let i=()=>{ve.get(e.id)===n&&ve.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function qo(e){if(!we())return!1;let t=Ci();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Ie();if(!i)return!1;await Nn(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||j,body:a,urlPath:Tt},a=nt(e),s={body:a,tag:e.id,data:o,renotify:!0};n>Date.now()&&(s.showTrigger=new t(n));try{return await i.showNotification(e.title,s),!0}catch(l){return console.warn("Failed to schedule persistent notification",l),!1}}function Ne(e){if(!e||!e.id)return;if(e.category=Y(e.category),!e.due||e.done){Vt(e.id);return}let t=q[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||j,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:nt(e),urlPath:Tt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let l=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return l===e.due?f:null})()};if(q[e.id]=n,vn(),ke[e.id]&&(clearTimeout(ke[e.id]),delete ke[e.id]),De[e.id]&&(clearTimeout(De[e.id]),delete De[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(q[e.id]?.viaTrigger){jt(e.id,{closeNotification:!1});return}wn(e),jt(e.id,{closeNotification:!1});return}let s=we();if(Number.isFinite(o)&&o>Date.now()&&o<i){let l=o-Date.now();De[e.id]=setTimeout(()=>{wn({...e,due:e.due||n.due})},l)}s&&(n.viaTrigger=!1,qo(e).then(l=>{l&&q[e.id]&&(q[e.id]={...q[e.id],viaTrigger:!0},vn())})),ke[e.id]=setTimeout(()=>{s&&Nn(e.id),wn(e),jt(e.id,{closeNotification:!1})},a)}function Ae(){Object.values(q).forEach(e=>Ne({...e,category:Y(e?.category)}))}function ai(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Ao.format(t),i=Io.format(t),o=gn(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}let si="__mcPinToggleHandler";var En=!1;function it(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Bn,t),e.classList.toggle(Di,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function di(e){if(!(e instanceof HTMLElement)||e[si])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let o=i.currentTarget;if(!(o instanceof HTMLElement))return;let s=(typeof o.closest=="function"?o.closest("[data-reminder-item]"):null)?.dataset?.id;if(!s){it(o,!1);return}let l=!o.classList.contains(Bn);await Promise.resolve(Ho(s,l)),it(o,l)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[si]={click:t,keydown:n}}function jo(){if(!S)return;let e=S.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){it(t,!1),di(t);return}let a=!!c.find(s=>s?.id===i)?.pinToToday;it(t,a),di(t)})}function li(){if(!S||En)return;En=!0;let e=()=>{En=!1,jo()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function Vo(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function Yo(e,t,n){return t!=="today"?e:Array.isArray(e)?e.filter(i=>Vo(i,n)):[]}function Sn(){if(Z!=="mobile"||typeof document>"u"||Sn._wired)return;let e=document.querySelectorAll("#view-reminders [data-reminders-tab]");if(!e.length)return;Sn._wired=!0;let t=()=>{e.forEach(n=>{let o=n.getAttribute("data-reminders-tab")===Ye;n.setAttribute("aria-pressed",o?"true":"false"),o?n.classList.add("reminders-tab-active"):n.classList.remove("reminders-tab-active")})};t(),Me(),e.forEach(n=>{n.addEventListener("click",()=>{let i=n.getAttribute("data-reminders-tab");!i||i===Ye||(Ye=i,t(),Array.isArray(tn)&&_(),Me())})})}function _(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let o={start:n,end:i};if(Se(),ie(c),Pn)try{Pn.textContent=String(c.length)}catch{}c.forEach(p=>{p&&typeof p=="object"&&(p.category=Y(p.category))});let a=new Set(Zo.map(p=>Y(p)));c.forEach(p=>{p&&typeof p=="object"&&a.add(Y(p.category))});let s=Array.from(a).sort((p,b)=>p.localeCompare(b,void 0,{sensitivity:"base"}));if(en){let p=new Set;Array.from(en.querySelectorAll("option")).forEach(b=>{p.add(b.value.trim().toLowerCase())}),s.forEach(b=>{let N=b.toLowerCase();if(!p.has(N)){let x=document.createElement("option");x.value=b,en.appendChild(x),p.add(N)}})}if(Ce)Ce=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let p=c.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:p}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:p}),document.dispatchEvent(b))}}catch{}}let l=c.slice();ie(l),Z==="mobile"&&(tn=l.slice(),l=Yo(tn,Ye,o),Me());let f=!0,u=c.length>0,g=l.length>0,I=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let p=Object.values(q||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(p.map(b=>b.id))})();if(Be)if(g)Be.classList.add("hidden");else{let p=u?"No reminders to show right now.":oo;Yn?Yn(Be,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:p,action:u?void 0:`<button type="button" class="${ro}" data-trigger="open-cue">Create reminder</button>`}):Be.textContent=p,Be.classList.remove("hidden")}if(_n&&_n.classList.toggle("has-items",g),!S)return;if(!g){Be?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden")),li();return}S.classList.remove("hidden"),S.replaceChildren();let T=document.createDocumentFragment(),$=S.tagName==="UL"||S.tagName==="OL",oe=!0,v=["priority-high","priority-medium","priority-low"],h=(p,b)=>{if(!(p instanceof HTMLElement))return;p.classList.remove(...v);let N=typeof b=="string"?b.trim().toLowerCase():"";N.startsWith("h")?p.classList.add("priority-high"):N.startsWith("m")?p.classList.add("priority-medium"):N.startsWith("l")&&p.classList.add("priority-low")},L=(p,b="neutral")=>{let N=document.createElement("span");N.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",N.title=p,N.dataset.tone=b;let x=document.createElement("span");x.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?x.classList.add("bg-error"):b==="priority-medium"?x.classList.add("bg-warning"):b==="priority-low"?x.classList.add("bg-secondary"):b==="category"?x.classList.add("bg-primary"):x.classList.add("bg-base-content","opacity-40");let C=document.createElement("span");return C.className="truncate",C.textContent=p,N.append(x,C),N},R=(p,b,{elementTag:N,isMobile:x})=>{let C={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:b,done:!!p.done,pinToToday:p.pinToToday===!0},rt="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Ko="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",A=document.createElement(N);A.className=x?Ko:rt,A.dataset.id=C.id,A.dataset.category=C.category,A.dataset.title=C.title;let ui=C.priority&&String(C.priority).trim();ui?A.dataset.priority=ui:delete A.dataset.priority,A.dataset.done=String(C.done),C.dueIso?A.dataset.due=C.dueIso:delete A.dataset.due,C.pinToToday?A.dataset.pinToToday="true":delete A.dataset.pinToToday,A.dataset.reminder=JSON.stringify(C),A.dataset.orderIndex=Number.isFinite(p.orderIndex)?String(p.orderIndex):"",A.dataset.reminderItem="true",A.dataset.compact="true",A.classList.add("reminder-draggable"),A.setAttribute("draggable","true"),A.setAttribute("role","button"),A.tabIndex=0,A.setAttribute("aria-label",`Edit reminder: ${p.title}`),h(A,C.priority),I.has(C.id)?A.dataset.notificationActive="true":delete A.dataset.notificationActive;let An=C.dueIso?new Date(C.dueIso):null;f&&An&&An>=n&&An<=i?(A.classList.add("is-today"),A.dataset.today="true"):(A.classList.remove("is-today"),delete A.dataset.today);let at=document.createElement("div");at.className="flex min-w-0 flex-1 flex-col gap-2",x&&at.classList.add("text-sm","text-base-content");let ue=document.createElement("p");if(ue.className=x?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",ue.classList.add("desktop-reminder-title"),x||ue.classList.add("sm:text-[0.95rem]"),C.done&&ue.classList.add("line-through","text-base-content/60"),x){ue.dataset.reminderTitle="true",ue.textContent="";let M=document.createElement("span");M.dataset.role="reminder-today-toggle",M.className="reminder-title-toggle cursor-pointer",M.setAttribute("role","button"),M.tabIndex=0,M.textContent=p.title,it(M,C.pinToToday),ue.appendChild(M)}else ue.textContent=p.title;let Yt=ue;x&&(Yt=document.createElement("div"),Yt.className="reminder-title-slot",Yt.appendChild(ue)),at.appendChild(Yt);let st=document.createElement("div");st.className=x?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let In=ai(p),fi=In&&In!=="No due date"?In:"";fi&&st.appendChild(L(fi,"due")),!!(b&&b!==j)&&st.appendChild(L(b,"category")),st.children.length&&at.appendChild(st),A.appendChild(at);let $e=document.createElement("div");$e.className="task-toolbar flex items-start gap-1",$e.setAttribute("role","toolbar"),$e.setAttribute("aria-label","Reminder actions"),x&&$e.classList.add("flex-shrink-0");let te=document.createElement("button");te.type="button",te.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",te.classList.toggle("reminder-complete-toggle--active",C.done);let Xo=C.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";te.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${Xo}"
          />
        </svg>`,C.done?(te.classList.add("text-base-content/60"),te.setAttribute("aria-label",`Mark reminder as active: ${p.title}`)):(te.classList.add("text-success"),te.setAttribute("aria-label",`Mark reminder as done: ${p.title}`)),te.setAttribute("aria-pressed",C.done?"true":"false"),te.setAttribute("data-reminder-control","toggle"),te.setAttribute("data-no-swipe","true"),te.addEventListener("click",M=>{M.preventDefault(),M.stopPropagation(),_o(C.id)});let be=document.createElement("button");be.type="button",be.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",be.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,be.setAttribute("aria-label",`Delete reminder: ${p.title}`),be.setAttribute("data-action","delete"),be.setAttribute("data-reminder-control","delete"),be.setAttribute("data-no-swipe","true"),be.addEventListener("click",M=>{M.preventDefault(),M.stopPropagation();try{ii(C.id)}catch(dt){console.warn("Delete handler failed",dt)}}),$e.append(te,be),A.appendChild($e);let pi=()=>Mo(C.id);return A.addEventListener("click",M=>{if(M.defaultPrevented)return;let dt=M.target;dt&&typeof dt.closest=="function"&&dt.closest("[data-reminder-control]")||pi()}),A.addEventListener("keydown",M=>{M.defaultPrevented||M.target===A&&(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),pi())}),x&&Uo(A,()=>ii(C.id)),A},D=(p,b)=>R(p,b,{elementTag:"div",isMobile:!0});if(Z!=="desktop"&&!oe){l.forEach(p=>{let b=p.category||j;T.appendChild(D(p,b))}),S.appendChild(T);return}let ce=new Map;l.forEach(p=>{let b=p.category||j;ce.has(b)||ce.set(b,[]),ce.get(b).push(p)});let Tn=Array.from(ce.entries()).sort((p,b)=>p[0].localeCompare(b[0],void 0,{sensitivity:"base"})),ot=!0;Tn.forEach(([p,b])=>{if(p!==j){let N=document.createElement($?"li":"div");N.dataset.categoryHeading=p,$&&(N.setAttribute("role","presentation"),N.style.listStyle="none"),N.className=Z==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",ot||(N.style.marginTop=Z==="desktop"?"1.25rem":"1rem");let x=document.createElement("div");x.setAttribute("role","heading"),x.setAttribute("aria-level","3"),x.className=Z==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let C=document.createElement("span");C.textContent=p;let rt=document.createElement("span");rt.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",rt.textContent=`${b.length} ${b.length===1?"item":"items"}`,x.append(C,rt),N.appendChild(x),T.appendChild(N)}b.forEach(N=>{if(Z==="desktop"){let x=R(N,p,{elementTag:$?"li":"div",isMobile:!1});T.appendChild(x);return}T.appendChild(D(N,p))}),ot=!1}),S.appendChild(T),Mi(),li()}function le(){je?.setAttribute("aria-expanded","false"),Ve?.classList.add("hidden")}function Wo(){je?.setAttribute("aria-expanded","true"),Ve?.classList.remove("hidden")}je?.addEventListener("click",e=>{e.stopPropagation(),je.getAttribute("aria-expanded")==="true"?le():Wo()}),document.addEventListener("click",e=>{Ve&&!Ve.classList.contains("hidden")&&!Ve.contains(e.target)&&e.target!==je&&le()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&le()}),Vi.forEach(e=>{e.addEventListener("click",()=>{let t=wt?.classList.contains("hidden");wt?.classList.toggle("hidden"),t&&wt?.scrollIntoView({behavior:"smooth",block:"start"}),le()})}),document.addEventListener("DOMContentLoaded",()=>{wt?.classList.add("hidden")});function ci(){try{console.log("handleSaveAction invoked",{editingId:_e,title:w?.value})}catch{}let t=(typeof w?.value=="string"?w.value:"").trim(),n=typeof F?.value=="string"?F.value:"",i=typeof O?.value=="string"?O.value:"",o=typeof H?.value=="string"?H.value.trim():"";if(_e){let u=c.find(T=>T.id===_e);if(!u){xe();return}if(!t){E("Add a reminder title");return}let g=null;if(n||i){let T=n||$t();g=Qn(T,i||"09:00")}else{let T=qt(t);T.time&&(g=new Date(`${T.date}T${T.time}:00`).toISOString())}u.title=t;let I=an();u.priority=I,Et(I),P&&(u.category=Y(P.value)),u.due=g,W&&(u.notes=W.value.trim()),u.plannerLessonId=o||null,u.updatedAt=Date.now(),X(u),tt(u),Ce=!0,_(),Ne(u),V(),Oe(),ae("memoryCue:remindersUpdated",{items:c}),Wn(),se({action:"updated",label:`Reminder updated \xB7 ${u.title}`}),xe(),E("Reminder updated"),ae("cue:close",{reason:"updated"});return}if(!t){E("Add a reminder title");return}let a=W?W.value.trim():"",s=null;if(n||i){let u=n||$t();s=Qn(u,i||"09:00")}else{let u=qt(t);u.time&&(s=new Date(`${u.date}T${u.time}:00`).toISOString())}let l=o?{lessonId:o,dayLabel:H?.dataset?.lessonDayLabel||"",lessonTitle:H?.dataset?.lessonTitle||"",summary:H?.dataset?.lessonSummary||""}:null,f=Oo({title:t,priority:an(),category:P?P.value:"",due:s,notes:a,plannerLessonId:o||null});f&&(l?(E("Planner reminder created"),ae("planner:reminderCreated",{lessonId:l.lessonId,dayLabel:l.dayLabel,lessonTitle:l.lessonTitle,summary:l.summary,reminderId:f.id,reminderTitle:f.title,reminderDue:f.due||null})):E("Reminder created")),w&&(w.value=""),O&&(O.value=""),W&&(W.value=""),on(),ae("cue:close",{reason:"created"})}w?.addEventListener("keydown",e=>{e.key==="Enter"&&ci()});function Go(){if(!w||!Le)return;let e=w.value.trim();if(!e){Le.style.display="none";return}try{let t=qt(e),n=$t();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${ei(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Le.textContent=`Parsed: ${i}`,Le.style.display="block"):Le.style.display="none"}else Le.style.display="none"}catch{Le.style.display="none"}}if(w?.addEventListener("input",Ro(Go,300)),Xt?.addEventListener("click",()=>{xe(),E("Edit cancelled"),ae("cue:close",{reason:"edit-cancelled"})}),xi?.addEventListener("click",()=>{xe()}),document.addEventListener("cue:cancelled",()=>{xe()}),document.addEventListener("cue:prepare",()=>{xe()}),document.addEventListener("planner:prefillReminder",e=>{Xi(e?.detail||{})}),window.addEventListener("load",()=>w?.focus()),Hi?.addEventListener("click",()=>{let e=c.filter(t=>!t.done).map(t=>{let n=t.due?ei(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(He,{hour:"2-digit",minute:"2-digit",timeZone:ge}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){E("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>E("Copied for Master Task List")).catch(()=>E("Copy failed")),le()}),Zt?.addEventListener("change",()=>{let e=Zt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let s={...a,id:Ht(),category:Y(a.category),pendingSync:!K,orderIndex:null};pn(s,{position:"start"}),c=[s,...c],i.push(s)}),ie(c);let o=Ze(c);_(),V(),o?c.forEach(a=>X(a)):i.forEach(a=>X(a)),E("Import successful")}catch{E("Invalid JSON")}},t.readAsText(e),Zt.value="",le()}),$i?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),le()}),Ui?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){E("Add your Apps Script URL in Settings first"),le();return}if(!c.length){E("No tasks to sync"),le();return}E("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<c.length;i+=t){let o=c.slice(i,i+t),a=await Promise.allSettled(o.map(s=>{let l={id:s.id,title:s.title,dueIso:s.due||null,priority:s.priority||"Medium",category:s.category||j,done:!!s.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}));n+=a.filter(s=>s.status==="rejected").length,await new Promise(s=>setTimeout(s,400))}E(`Sync complete: ${c.length-n} ok${n?`, ${n} failed`:""}`),le()}),Fe&&(Fe.value=localStorage.getItem("syncUrl")||""),qi?.addEventListener("click",()=>{Fe&&(localStorage.setItem("syncUrl",Fe.value.trim()),E("Settings saved"))}),ji?.addEventListener("click",async()=>{if(!Fe)return;let e=Fe.value.trim();if(!e){E("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});E(t.ok?"Test ok":"Test failed")}catch{E("Test failed")}}),_i?.addEventListener("click",async()=>{if(!("Notification"in window)){E("Notifications not supported");return}if(Notification.permission==="granted"){E("Notifications enabled"),we()?Ie():(Kt(),oi()),Ae(),_();return}try{await Notification.requestPermission()==="granted"?(E("Notifications enabled"),we()?Ie():(Kt(),oi()),Ae(),_()):E("Notifications blocked")}catch{E("Notifications blocked")}}),Sn(),Z==="mobile"){let e=()=>{try{Gi()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return ho(),Ae(),_(),V(),{cancelReminder:Vt,scheduleReminder:Ne,closeActiveNotifications:ki,getActiveNotifications:()=>ve,addNoteToReminder:Po,__testing:{setItems(e=[]){c=Array.isArray(e)?e.map(t=>({...t,category:Y(t?.category)})):[],c=Qe(c),ie(c),_()},render:_,getItems:()=>c.map(e=>({...e}))}}}var Ti,ve,Ai,Ln,Cn,Ii,Gt,ct,kn,j,Zo,Dn,fe,er,pe,or=hi(()=>{Jo();Ti="memoryCue:activity",ve=new Map,Ai=!1,Ln="service-worker.js",Cn="memory-cue-reminder-sync",Ii=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Gt=null,ct=null,kn=!1,j="General",Zo=Object.freeze([j,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Dn="memoryCue:offlineReminders",fe=1024,er=Object.freeze({}),pe=null});function br(d){return new Fn(d)}var rr,ar,Fn,sr=hi(()=>{rr=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),ar={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Fn=class d{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...ar,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let y=this.getFocusableElements();if(y.length===0){r.preventDefault(),this.modal.focus();return}let w=y[0],F=y[y.length-1],O=document.activeElement;r.shiftKey&&O===w?(r.preventDefault(),F.focus()):!r.shiftKey&&O===F&&(r.preventDefault(),w.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(rr)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let y=r?.detail?.mode==="edit";this.setEditMode(y),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let y=r.detail?.reason||"external-close";this.hide({reason:y})}dispatchEvent(r,y={}){let w=this.events[r];if(!w||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let F=new CustomEvent(w,{detail:y,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(F)}requestClose(r){let y={reason:r,controller:this};this.dispatchEvent("cancelled",y),this.dispatchEvent("closeRequest",{...y,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let y=this.animationHooks?.[r];typeof y=="function"&&await y(this)}addToStack(){let r=d.activeStack,y=r.indexOf(this);y!==-1&&r.splice(y,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=d.activeStack,y=r.indexOf(this);y!==-1&&r.splice(y,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{hr as a,or as b,Fn as c,br as d,sr as e};
