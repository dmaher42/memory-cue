import{b as Sn,c as ts}from"./chunk-QHE5AMPX.js";import{a as sr,b as ni,c as es}from"./chunk-GUVSRPRW.js";function dr(s={}){try{Object.assign(V,s||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function cr(s={}){try{if(V&&typeof V.signInWithPopup=="function"&&V.auth&&typeof V.GoogleAuthProvider=="function")return V.signInWithPopup(V.auth,new V.GoogleAuthProvider);if(V&&typeof V.signInWithRedirect=="function"&&V.auth&&typeof V.GoogleAuthProvider=="function")return V.signInWithRedirect(V.auth,new V.GoogleAuthProvider);let r=Sn();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...s});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{V?.toast?.("Sign-in failed")}catch(l){console.warn("[supabase-auth] toast handler failed",l)}throw r}return Promise.resolve(null)}async function lr(){try{if(V&&typeof V.signOut=="function")return V.signOut(V.auth);let s=Sn();if(s&&s.auth&&typeof s.auth.signOut=="function")return s.auth.signOut()}catch(s){throw console.error("[supabase-auth] startSignOutFlow error",s),s}return Promise.resolve(null)}function is(s){return s?Array.isArray(s)?s:[s]:[]}function Rt(s){return Array.from(new Set(s.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function he(s,r){let l=is(r).filter(Boolean);if(!l.length)return[];let g=l.flatMap(L=>Array.from(s.querySelectorAll(L)));return Rt(g)}function rs(s,r=document){let l=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:he(l,s.authForm),emailInputs:he(l,s.emailInput),signInButtons:he(l,s.signInButtons),signOutButtons:he(l,s.signOutButtons),userBadges:he(l,s.userBadge),userBadgeEmails:he(l,s.userBadgeEmail),userBadgeInitials:he(l,s.userBadgeInitial),userNameEls:he(l,s.userName),syncStatusEls:he(l,s.syncStatus),syncStatusTextEls:he(l,s.syncStatusText),statusIndicatorEls:he(l,s.statusIndicator),feedbackEls:he(l,s.feedback)}}function Dt(s,r){Rt(Array.isArray(s)?s:[s]).forEach(l=>{l instanceof HTMLElement&&(l.classList.toggle("hidden",!r),r?l.removeAttribute("hidden"):l.setAttribute("hidden",""))})}function je(s,r){Rt(Array.isArray(s)?s:[s]).forEach(l=>{l instanceof HTMLElement&&(l.textContent=r||"")})}function os(s,r){Rt(s).forEach(l=>{l instanceof HTMLElement&&(l.dataset.state=r,l.classList.toggle("online",r==="online"),l.classList.toggle("offline",r!=="online"))})}function Nt(s,r){Rt(s).forEach(l=>{if(!(l instanceof HTMLElement))return;l.textContent=r||"";let g=!!r;l.classList.toggle("hidden",!g),g?l.removeAttribute("hidden"):l.setAttribute("hidden","")})}function ur(s={}){let r={...ar.syncStatusText,...s.syncStatusText||{}};return{...ar,...s,syncStatusText:r}}function xt(s,{user:r,messages:l}={}){let g=ur(l),L=!!r;Dt(s.signInButtons,!L),Dt(s.authForms,!L),Dt(s.signOutButtons,L),Dt(s.userBadges,L);let B=typeof r?.email=="string"?r.email:"",H=B?B.charAt(0).toUpperCase():"U";L?(je(s.userBadgeEmails,B),je(s.userBadgeInitials,H),je(s.userNameEls,B)):(je(s.userBadgeEmails,""),je(s.userBadgeInitials,""),je(s.userNameEls,""));let j=typeof g.signedIn=="function"?g.signedIn(r):g.signedIn,_=typeof g.signedOut=="function"?g.signedOut(r):g.signedOut,le=L?j:_,me=!L;s.syncStatusEls.length&&(je(s.syncStatusEls,le),s.syncStatusEls.forEach(Le=>{Le instanceof HTMLElement&&(Le.classList.toggle("online",L),Le.dataset.state=L?"online":"offline")}),Dt(s.syncStatusEls,me));let x=L?g.syncStatusText?.signedIn:g.syncStatusText?.signedOut;je(s.syncStatusTextEls,x||""),os(s.statusIndicatorEls,L?"online":"offline"),Nt(s.feedbackEls,"")}function ss(s,r){r.authForms.forEach(l=>{!(l instanceof HTMLFormElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("submit",async g=>{g.preventDefault();let L=r.emailInputs.find(H=>l.contains(H))||l.querySelector('input[type="email"]'),B=typeof L?.value=="string"?L.value.trim():"";if(!B){Nt(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:H}=await s.auth.signInWithOtp({email:B});H?Nt(r.feedbackEls,H.message||"Unable to send magic link."):Nt(r.feedbackEls,"Magic link sent. Check your email.")}catch(H){Nt(r.feedbackEls,H?.message||"Unable to send magic link.")}}))})}function as(s,r){r.signOutButtons.forEach(l=>{!(l instanceof HTMLElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("click",async()=>{try{await s.auth.signOut()}catch(g){console.error("[supabase] Sign-out failed.",g)}}))})}function Is(s={}){let{supabase:r,scope:l=document,selectors:g={},messages:L={},disableButtonBinding:B=!1,onSessionChange:H}=s,j={...ns,...g},_=rs(j,l),le=ur(L);xt(_,{user:null,messages:le});let me=r||Sn()||(typeof window<"u"?window.supabase:null);if(!me)return{supabase:null,elements:_,applyAuthState:pe=>xt(_,{...pe,messages:le}),destroy(){}};ss(me,_),B||as(me,_);let x=[],{data:Le}=me.auth.onAuthStateChange((pe,we)=>{if(xt(_,{user:we?.user??null,messages:le}),typeof H=="function")try{H(we?.user??null,we)}catch(lt){console.error("[supabase] onSessionChange handler failed.",lt)}});return Le?.subscription&&x.push(()=>{try{Le.subscription.unsubscribe()}catch{}}),me.auth.getSession().then(({data:pe,error:we})=>{we||xt(_,{user:pe?.session?.user??null,messages:le})}).catch(pe=>{console.error("[supabase] getSession failed.",pe)}),{supabase:me,elements:_,applyAuthState:pe=>xt(_,{...pe,messages:le}),destroy(){x.forEach(pe=>{try{pe()}catch{}})}}}var V,ns,ar,fr=ni(()=>{ts();V={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};ns={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},ar={signedOut:"",signedIn:s=>`Reminders syncing for ${s?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var gr=es((Cs,Mt)=>{var Tn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function mr(s){if(!s||typeof s!="object")return null;let r=Object.entries(s).filter(([l,g])=>typeof g=="string"&&g.trim()!=="");return r.length?Object.fromEntries(r):null}function ds(){let s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=mr(s?.__FIREBASE_CONFIG);if(r)return r;let l=mr(s?.__ENV?.FIREBASE_CONFIG);if(l)return l;let L=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((B,[H,j])=>{let _=s?.__ENV?.[H]??s?.[H];return typeof _=="string"&&_.trim()!==""&&(B[j]=_),B},{});return Object.keys(L).length?L:null}function yr(){let s=ds();return s?{...Tn,...s}:{...Tn}}var pr={DEFAULT_FIREBASE_CONFIG:Tn,getFirebaseConfig:yr};if(typeof globalThis<"u"){let s=globalThis;s.memoryCueFirebase=s.memoryCueFirebase||{},s.memoryCueFirebase.getFirebaseConfig=yr,s.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Tn}typeof Mt<"u"&&Mt.exports&&(Mt.exports=pr,Mt.exports.default=pr)});function ee(s){if(!Array.isArray(s))return null;let r=s.map(l=>Number(l)).filter(l=>Number.isFinite(l));return r.length?r:null}async function Sr(s){return typeof s=="string"?s.trim():"",null}function ls(s,r){let l=ee(s),g=ee(r);if(!l||!g||l.length!==g.length)return 0;let L=0,B=0,H=0;for(let j=0;j<l.length;j+=1)L+=l[j]*g[j],B+=l[j]*l[j],H+=g[j]*g[j];return!B||!H?0:L/(Math.sqrt(B)*Math.sqrt(H))}async function Er(s){if(!s||typeof s!="object")return s;let r=ee(s.semanticEmbedding);if(r)return s.semanticEmbedding=r,s;let l=[s.title,s.bodyText,s.body,s.notes].filter(L=>typeof L=="string"&&L.trim()).join(`
`).trim();if(!l)return s;let g=ee(await Sr(l));return g&&(s.semanticEmbedding=g),s}function fs(){if(Ie)return{...Ie};let r=ci()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return Ie=r.getFirebaseConfig(),{...Ie};if(typeof sr=="function")try{let l=gr();if(l){let g=typeof l.getFirebaseConfig=="function"?l.getFirebaseConfig:typeof l.default?.getFirebaseConfig=="function"?l.default.getFirebaseConfig:null;if(g)return Ie=g(),{...Ie}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(Ie={...r.DEFAULT_FIREBASE_CONFIG},{...Ie}):(Ie={...us},{...Ie})}function ci(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Tr(){let s=ci(),r=s&&s.TimestampTrigger;return typeof r=="function"?r:null}function Be(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Tr()}function ms(){if(typeof window>"u"||!window.location)return ii;try{return new URL(ii,window.location.href).href}catch{return ii}}async function We(){return An||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(An=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(ms()),await navigator.serviceWorker.ready}catch(s){return console.warn("Service worker registration failed",s),null}})(),An))}async function vr(s){if(!s||typeof s!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await We();if(!r)return!1;let l=new Set;navigator.serviceWorker.controller&&l.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(L=>{let B=r[L];B&&l.add(B)});let g=!1;return l.forEach(L=>{try{L.postMessage(s),g=!0}catch(B){console.warn("Failed posting message to service worker",B)}}),g}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function In(){if(Be())return!1;if(oi)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Ft)try{return await Ft}catch{}Ft=(async()=>{let s=await We();if(!s)return!1;let r=!1;if("periodicSync"in s)try{let l=await s.periodicSync.getTags();(!Array.isArray(l)||!l.includes(ri))&&await s.periodicSync.register(ri,{minInterval:15*60*1e3}),r=!0}catch(l){console.warn("Periodic background sync unavailable",l)}if(!r&&"sync"in s)try{await s.sync.register(ri),r=!0}catch(l){console.warn("Background sync unavailable",l)}return r})();try{let s=await Ft;return s&&(oi=!0),s}catch(s){return console.warn("Background reminder sync setup failed",s),oi=!1,!1}finally{Ft=null}}async function ai(s=[],{requestCheck:r=!1}={}){if(!Be()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let l=await We();if(!l)return;let g=await vr({type:wr.updateScheduledReminders,reminders:Array.isArray(s)?s:[]});if(r&&await vr({type:wr.checkScheduledReminders}),!g&&typeof l.update=="function")try{await l.update()}catch{}}catch(l){console.warn("Failed syncing reminders with service worker",l)}}async function di(s,r){if(Be())try{let l=r||await We();if(!l)return;let g=[];try{g=await l.getNotifications({tag:s,includeTriggered:!0})}catch{g=await l.getNotifications({tag:s})}for(let L of g)try{L.close()}catch{}}catch{}}function Ar(){for(let s of Array.from(Fe.values()))try{s.close()}catch{}Fe.clear()}function ps(){if(br||typeof window>"u"||typeof window.addEventListener!="function")return;let s=()=>Ar();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,s)}catch{}}),br=!0}function te(s){if(typeof s=="string"){let r=s.replace(/\s+/g," ").trim();if(r)return r}return K}async function Ds(s={}){let r=e=>e?document.querySelector(e):null,l=e=>e?Array.from(document.querySelectorAll(e)):[],g=r(s.titleSel),L=r(s.dateSel),B=r(s.timeSel),H=r(s.detailsSel),j=r(s.prioritySel),_=r(s.categorySel),le=r(s.saveBtnSel),me=r(s.cancelEditBtnSel),x=r(s.listSel),Le="reminder-title-pinned",pe="reminder-title-unpinned",we=r(s.detailPanelSel),lt=r(s.detailEmptySel),Ln=r(s.detailContentSel),Bt=r(s.detailTitleSel),Ot=r(s.detailDueSel),Pt=r(s.detailPrioritySel),_t=r(s.detailCategorySel),Ce=r(s.detailNotesSel),ui=Ce?.dataset?.placeholder||"No notes added yet.",Ir=r(s.detailClearSel),Ht=l(s.googleSignInBtnSel),$t=l(s.googleSignOutBtnSel),W=r(s.statusSel),X=r(s.syncStatusSel),Lr={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Cr=6e3,ye=null,Ut=null;function Je(e,{clearMessage:t=!0}={}){ye&&(e&&ye.tokenId!==e||(ye.timeoutId&&clearTimeout(ye.timeoutId),t&&W&&W.dataset.undoToken===ye.tokenId&&(typeof W.replaceChildren=="function"?W.replaceChildren():W.textContent="",delete W.dataset.undoToken,delete W.dataset.statusKind),ye=null))}function kr(e){if(!W)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Go(e.tokenId)),e.button=i,typeof W.replaceChildren=="function"?W.replaceChildren(t,n,i):(W.textContent="",W.append(t,n,i)),W.dataset.statusKind="undo",W.dataset.undoToken=e.tokenId}function ut(e){if(!we)return;let t=!!e;if(we.dataset.state=t?"active":"empty",we.dataset.selectedId=t&&e?.id?e.id:"",lt&&(lt.classList.toggle("hidden",t),lt.setAttribute("aria-hidden",t?"true":"false")),Ln&&(Ln.classList.toggle("hidden",!t),Ln.setAttribute("aria-hidden",t?"false":"true")),!t){Bt&&(Bt.textContent=""),Ot&&(Ot.textContent=""),Pt&&(Pt.textContent=""),_t&&(_t.textContent=""),Ce&&(Ce.textContent=ui,Ce.dataset.empty="true");return}if(Bt&&(Bt.textContent=e.title||"Untitled reminder"),Ot&&(Ot.textContent=Qi(e)),Pt&&(Pt.textContent=e.priority||"Medium"),_t&&(_t.textContent=e.category||K),Ce){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Ce.textContent=n,Ce.dataset.empty="false"):(Ce.textContent=ui,Ce.dataset.empty="true")}}function fi(){Ut=null,ut(null)}function Dr(e){Ut=e?.id||null,ut(e||null)}function xr(){if(!we)return;if(!Ut){ut(null);return}let e=y.find(t=>t?.id===Ut);if(e){ut(e);return}fi()}ut(null);function Cn(e,t){if(!X)return;let n=["online","offline","error"];n.forEach(a=>X.classList.remove(a)),n.includes(e)&&X.classList.add(e),X.dataset.state=e;let i=typeof t=="string"?t:Lr[e]||"";e==="online"||e==="offline"?(X.textContent="",X.dataset.compact="true",i?(X.setAttribute("aria-label",i),X.setAttribute("title",i)):(X.removeAttribute("aria-label"),X.removeAttribute("title"))):(X.textContent=i,X.removeAttribute("data-compact"),i?(X.setAttribute("aria-label",i),X.setAttribute("title",i)):(X.removeAttribute("aria-label"),X.removeAttribute("title")))}let oe=r(s.notesSel),Nr=r(s.saveNotesBtnSel),Rr=r(s.loadNotesBtnSel),mi=r(s.countTotalSel),qt=r(s.googleUserNameSel),Ye=r(s.dateFeedbackSel),ue=r(s.voiceBtnSel),Mr=r(s.notifBtnSel),ft=r(s.moreBtnSel),mt=r(s.moreMenuSel),Fr=r(s.copyMtlBtnSel),kn=r(s.importFileSel),Br=r(s.exportBtnSel),Or=r(s.syncAllBtnSel),Ze=r(s.syncUrlInputSel),Pr=r(s.saveSettingsSel),_r=r(s.testSyncSel),Hr=l(s.openSettingsSel),jt=r(s.settingsSectionSel),Oe=r(s.emptyStateSel),pi=r(s.listWrapperSel),Dn=r(s.categoryOptionsSel),se=r(s.plannerContextSel),G=r(s.plannerLessonInputSel),ne=s.variant||"mobile",$r=typeof s.autoWireAuthButtons=="boolean"?s.autoWireAuthButtons:ne!=="desktop",Pe="all",xn=[],Nn="";function Ur(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function et(){if(ne!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=Ur(),n;Pe==="today"?n=`Today\u2019s reminders \u2022 ${t}`:Pe==="completed"?n=`Completed reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,Nn&&(n+=` \u2022 ${Nn}`),e.textContent=n}function qr(){ne==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(o=>{if(!o.ok)throw new Error("Weather request failed");return o.json()}).then(o=>{o&&o.current_weather&&typeof o.current_weather.temperature=="number"&&(Nn=`${Math.round(o.current_weather.temperature)}\xB0C`,et())}).catch(o=>{console.warn("Failed to fetch current temperature",o)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let yi="mc:lastDefaults",Rn=()=>{se&&(se.classList.add("hidden"),se.setAttribute("aria-hidden","true"),typeof se.replaceChildren=="function"?se.replaceChildren():se.textContent=""),G&&(G.value="",G.dataset&&(delete G.dataset.lessonDayLabel,delete G.dataset.lessonTitle,delete G.dataset.lessonSummary))},jr=(e={})=>{if(!se)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",o=document.createElement("p");o.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",o.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let d=i?document.createElement("p"):null;d&&(d.className="text-sm text-base-content/70",d.textContent=i),typeof se.replaceChildren=="function"?se.replaceChildren(...[o,a,d].filter(Boolean)):(se.textContent="",se.append(o,a),d&&se.append(d)),se.classList.remove("hidden"),se.removeAttribute("aria-hidden")},Wr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";g&&typeof e.reminderTitle=="string"&&(g.value=e.reminderTitle),H&&typeof e.reminderNotes=="string"&&(H.value=e.reminderNotes),L&&typeof e.dueDate=="string"&&(L.value=e.dueDate),G&&(G.value=t,G.dataset&&(G.dataset.lessonDayLabel=dayLabel,G.dataset.lessonTitle=lessonTitle,G.dataset.lessonSummary=summary)),jr(e)};function Mn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(yi)||"{}")||{}}catch{return{}}}function Yr(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(yi,JSON.stringify(e))}catch{}}function Vr(e){let t=Mn(),n={category:te(e?.category||t.category||K),priority:e?.priority||t.priority||"Medium"};Yr(n)}let gi='fieldset#priorityChips input[name="priority"]';function Wt(){try{let e=document.querySelector(`${gi}:checked`);if(e&&e.value)return e.value}catch{}return j&&typeof j.value=="string"&&j.value?j.value:"Medium"}function Yt(e){let t=e||"Medium";j&&typeof j.value<"u"&&(j.value=t);try{let n=Array.from(document.querySelectorAll(gi));if(!n.length)return;let i=!1;if(n.forEach(o=>{let a=o.value===t;o.checked=a,i=i||a}),!i){let o=n.find(a=>a.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function hi(){let e=Mn();e.category&&_&&(_.value=e.category),e.priority&&Yt(e.priority)}hi();let Gr=typeof document<"u"?document.getElementById("quickAddForm"):null,U=typeof document<"u"?document.getElementById("quickAddInput"):null,Ve=typeof document<"u"?document.getElementById("quickAddSubmit")||document.querySelector("[data-quick-add-submit]"):null,ae=typeof document<"u"?document.getElementById("quickAddVoice")||document.getElementById("voiceBtn"):null,Vt=typeof document<"u"?document.getElementById("quickAddParsingIndicator"):null,Fn=typeof document<"u"?document.getElementById("quickAddSuccessIndicator"):null,_e=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,Ge=null,Bn=!1,On=null,ke="memoryCueNotes",bi="memoryCueFolders",wi="Lesson \u2013 Reflections",zr=["u14","pressure","transition","year7","year9","netball","footy","voting","preferential","drill","lesson"];function Kr(e){let t=typeof e=="string"?e:"",n=[{kind:"footy-drill",pattern:/^\s*footy\s+drill\s*:\s*/i},{kind:"reflection",pattern:/^\s*reflection\s*:\s*/i},{kind:"task",pattern:/^\s*task\s*:\s*/i}];for(let i of n)if(i.pattern.test(t))return{kind:i.kind,text:t.replace(i.pattern,"").trim()};return{kind:"default",text:t.trim()}}function pt(e,t=[]){if(typeof localStorage>"u")return Array.isArray(t)?[...t]:[];try{let n=localStorage.getItem(e);if(!n)return Array.isArray(t)?[...t]:[];let i=JSON.parse(n);return Array.isArray(i)?i:Array.isArray(t)?[...t]:[]}catch{return Array.isArray(t)?[...t]:[]}}function Xr(){let t=pt(bi,[{id:"unsorted",name:"Unsorted",order:0}]).filter(d=>d&&typeof d=="object"&&typeof d.id=="string"),n=t.find(d=>d.name===wi);if(n?.id)return n.id;let i=new Set(t.map(d=>d.id)),o="lesson-reflections",a=1;for(;i.has(o);)a+=1,o=`lesson-reflections-${a}`;t.push({id:o,name:wi,order:t.length});try{localStorage.setItem(bi,JSON.stringify(t))}catch{}return o}function Qr(e){let t=typeof e=="string"?e.trim():"";if(!t||typeof localStorage>"u")return null;let n=Xr(),i=pt(ke,[]),o=new Date().toISOString(),a={id:fn(),title:t,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:o,folderId:n,semanticEmbedding:null};i.unshift(a);try{localStorage.setItem(ke,JSON.stringify(i))}catch{return null}return a}function Jr(e){let t=typeof e=="string"?e.toLowerCase():"";return t.includes("footy")?"footy_drill":t.includes("netball")?"netball_note":t.includes("reflection")?"reflection":t.includes("remind")?"reminder":t.includes("lesson")?"teaching_note":"general_note"}function Zr(e){let t=typeof e=="string"?e.replace(/\s+/g," ").trim():"";if(!t)return"Untitled note";let i=t.split(" ").filter(Boolean).slice(0,6).join(" ");return i.length>60?`${i.slice(0,60).trimEnd()}`:i}function eo(e){let t=typeof e=="string"?e.toLowerCase():"",n=zr.filter(i=>t.includes(i));return/\byear\s*7\b/.test(t)&&n.push("year7"),/\byear\s*9\b/.test(t)&&n.push("year9"),/\bvote\b/.test(t)&&n.push("voting"),[...new Set(n)]}function Pn(e){if(!Array.isArray(e))return[];let t=e.map(n=>typeof n=="string"?n.trim().toLowerCase():"").filter(Boolean).slice(0,8);return[...new Set(t)]}async function Ei(e){if(typeof fetch!="function")throw new Error("fetch is unavailable");let t=typeof AbortController<"u"?new AbortController:null,n=t?setTimeout(()=>t.abort(),8e3):null,i="https://memory-cue-api.vercel.app/api/parse-entry";try{let o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e}),signal:t?.signal});if(!o.ok){let d="";try{d=await o.text()}catch(c){d=`[unavailable: ${c?.message||"failed to read response body"}]`}throw console.error("AI parse request failed",{url:i,status:o.status,body:d}),new Error(`AI parse failed (${o.status})`)}let a=await o.json();return{type:a?.type,title:typeof a?.title=="string"?a.title.trim():"",tags:Pn(a?.tags),reminderDate:typeof a?.reminderDate=="string"?a.reminderDate:null}}finally{n&&clearTimeout(n)}}function vi(e){return{type:Jr(e),title:Zr(e),tags:eo(e),reminderDate:null}}async function ws(e){let t=typeof e=="string"?e.trim():"";if(!t)return null;let n=vi(t),i=n.type,o=n.title,a=Pn(n.tags),d=null,c=new Date().toISOString(),u={id:Date.now().toString(),type:i,title:o||n.title,content:t,tags:a,reminderDate:d,dateCreated:c,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:c,folderId:"unsorted",semanticEmbedding:null},f=pt(ke,[]);f.unshift(u);try{localStorage.setItem(ke,JSON.stringify(f))}catch(m){return console.error("Failed to save smart entry",m),null}try{typeof document<"u"&&typeof CustomEvent=="function"&&document.dispatchEvent(new CustomEvent("memoryCue:notesUpdated",{detail:{entry:u}}))}catch(m){console.error("Failed to dispatch notes refresh event",m)}return Ei(t).then(m=>{if(!m||typeof localStorage>"u")return;let E=pt(ke,[]),I=E.findIndex(h=>h?.id===u.id);if(I<0)return;let M=E[I]||{},O={...M,type:typeof m.type=="string"&&m.type.trim()?m.type.trim():M.type,title:typeof m.title=="string"&&m.title.trim()?m.title.trim().slice(0,60):M.title,tags:Pn(m?.tags?.length?m.tags:M.tags),reminderDate:typeof m.reminderDate=="string"&&m.reminderDate.trim()?m.reminderDate:M.reminderDate||null,updatedAt:new Date().toISOString()};E[I]=O,localStorage.setItem(ke,JSON.stringify(E));try{typeof document<"u"&&typeof CustomEvent=="function"&&document.dispatchEvent(new CustomEvent("memoryCue:notesUpdated",{detail:{entry:O}}))}catch(h){console.error("Failed to dispatch notes refresh event after AI enrichment",h)}}).catch(m=>{console.warn("AI smart capture failed, using fallback classifier",m)}),u}function to(e,t){let n=Mn(),i=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||Wt(),category:te(n.category||_?.value||K),notes:"",due:i,pinToToday:!1,semanticEmbedding:null}}function _n(e,t=null){let n=typeof e=="string"?e.trim():"";if(!n)return{keywordQuery:"",timeRange:null};let i=t instanceof Date&&!Number.isNaN(t.getTime())?new Date(t):new Date,o=n.toLowerCase(),a=/\b(monday|mon|tuesday|tue|tues|wednesday|wed|thursday|thu|thur|thurs|friday|fri|saturday|sat|sunday|sun)\b/i,d=/\b(\d{1,2})(?::(\d{2}))?\s*(am|pm)?\b/i,c=/\btoday\b/i,u=/\byesterday\b/i,f=o.match(a),m=o.match(d),E=o.match(c),I=o.match(u),M=()=>{if(!m)return null;let S=Number.parseInt(m[1],10),N=Number.parseInt(m[2]||"0",10),T=m[3]?m[3].toLowerCase():null;return!Number.isFinite(S)||!Number.isFinite(N)||N>59||(T==="pm"&&S<12?S+=12:T==="am"&&S===12&&(S=0),S>23)?null:{hours:S,minutes:N}},O=S=>String(S).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=()=>{let S=n;return f&&(S=S.replace(new RegExp(`\\b${O(f[0])}\\b`,"i")," ")),E&&(S=S.replace(new RegExp(`\\b${O(E[0])}\\b`,"i")," ")),I&&(S=S.replace(new RegExp(`\\b${O(I[0])}\\b`,"i")," ")),m&&(S=S.replace(new RegExp(O(m[0]),"i")," ")),S.replace(/\s+/g," ").trim()},b=(S=0)=>{let N=new Date(i);N.setHours(0,0,0,0),N.setDate(N.getDate()+S);let T=new Date(N);return T.setHours(23,59,59,999),{start:N.getTime(),end:T.getTime()}},D=M();if(f&&D){let S=f[1].slice(0,3).toLowerCase(),T={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[S];if(typeof T=="number"){let F=new Date(i),q=(T-F.getDay()+7)%7;return F.setDate(F.getDate()+q),F.setHours(D.hours,D.minutes,0,0),{keywordQuery:h(),timeRange:{start:F.getTime()-60*60*1e3,end:F.getTime()+60*60*1e3}}}}if(E||I){if(D){let S=new Date(i);return I&&S.setDate(S.getDate()-1),S.setHours(D.hours,D.minutes,0,0),{keywordQuery:h(),timeRange:{start:S.getTime()-60*60*1e3,end:S.getTime()+60*60*1e3}}}return{keywordQuery:h(),timeRange:b(I?-1:0)}}return{keywordQuery:n,timeRange:null}}function no(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(ke),t=e?JSON.parse(e):[];return Array.isArray(t)?t:[]}catch{return[]}}function Si(){let e=(Array.isArray(y)?y:[]).map(n=>({type:"Reminder",title:n?.title||"",body:n?.notes||"",timestamp:Number.isFinite(n?.createdAt)?n.createdAt:null,semanticEmbedding:ee(n?.semanticEmbedding)})),t=no().map(n=>{let i=typeof n?.updatedAt=="string"?Date.parse(n.updatedAt):Number.NaN,o=typeof n?.createdAt=="string"?Date.parse(n.createdAt):Number.NaN;return{type:"Note",title:n?.title||"",body:n?.bodyText||n?.body||"",timestamp:Number.isFinite(i)?i:Number.isFinite(o)?o:null,semanticEmbedding:ee(n?.semanticEmbedding)}});return[...e,...t]}async function Ti(e,t,n=[]){let i=ee(await Sr(e));if(!i)return[];let o=.72,a=new Set(n);return t.filter(c=>!a.has(c)).map(c=>({entry:c,score:ls(i,c.semanticEmbedding)})).filter(c=>c.score>=o).sort((c,u)=>u.score-c.score).map(c=>({...c.entry,isSemanticMatch:!0}))}function io(e,t){let n=_n(e),i=(n.keywordQuery||"").toLowerCase().split(/\s+/).map(a=>a.trim()).filter(Boolean),o=t.filter(a=>{let d=`${a.title} ${a.body}`.toLowerCase();return!i.length||i.every(u=>d.includes(u))?n.timeRange?Number.isFinite(a.timestamp)?a.timestamp>=n.timeRange.start&&a.timestamp<=n.timeRange.end:!1:!0:!1});return o.sort((a,d)=>(d.timestamp||0)-(a.timestamp||0)),o}function Ai(e){let t=["=== MEMORY CONTEXT START ==="];return e.forEach((n,i)=>{let o=Number.isFinite(n.timestamp)?new Date(n.timestamp).toISOString().slice(0,10):"No date";t.push(`[${i+1}] Type: ${n.type||"Unknown"}`),t.push(`    Title: ${n.title||"(untitled)"}`),t.push(`    Date: ${o}`),t.push(`    Notes: ${n.body||""}`),t.push("")}),t.push("=== MEMORY CONTEXT END ==="),t.join(`
`)}async function Hn(e,t=8){let n=typeof e=="string"?e.trim():"",i=Number.isFinite(t)?Math.max(1,Math.min(50,Math.floor(t))):8;if(!n)return Ai([]);let o=Si(),a=await Ti(n,o),d=a.length?a.slice(0,i):io(n,o).slice(0,i);return Ai(d)}async function Ii(e){let n=`You are an assistant that must answer ONLY using the provided MEMORY CONTEXT.
Do not invent new information.
If answer not in context, say: "I do not have enough information."

MEMORY CONTEXT:
${await Hn(e)}

USER QUESTION:
${e}`;return console.log(`[RAG assistant] Prompt:
`,n),"Assistant response placeholder."}function ro(){let e=typeof document<"u"?document.getElementById("inboxSearchInput"):null,t=typeof document<"u"?document.getElementById("inboxSearchResults"):null,n=typeof document<"u"?document.getElementById("inboxSearchClear"):null;if(!e||!t)return;e.addEventListener("focus",()=>{Ge="search"});let i=T=>{if(!Number.isFinite(T))return"No date";try{return new Date(T).toLocaleString()}catch{return"No date"}},o=T=>String(T||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),a=(T,F)=>{let q=String(T||"");if(!F)return o(q);let p=q.toLowerCase(),v=F.toLowerCase(),C=p.indexOf(v);if(C<0)return o(q);let P=o(q.slice(0,C)),A=o(q.slice(C,C+F.length)),ie=o(q.slice(C+F.length));return`${P}<mark class="inbox-search-match">${A}</mark>${ie}`},d=()=>Si(),c=[],u=-1,f=null,m=null,E=()=>{c=[],u=-1,f=null,t.innerHTML="",t.dataset.mode=""},I=(T,F={})=>{let q=Number.isFinite(F.limit)?F.limit:20,p=F.query||"",v=Number.isInteger(F.selectedIndex)?F.selectedIndex:-1,C=F.mode||"";if(t.innerHTML="",t.dataset.mode=C,!T.length){if(C==="autocomplete"){let A=document.createElement("div");A.className="inbox-search-empty text-xs opacity-70 py-2 px-2",A.textContent="No matches",t.appendChild(A)}return}let P=document.createDocumentFragment();T.slice(0,q).forEach((A,ie)=>{let Z=document.createElement("li");Z.className="inbox-search-result-item text-xs py-1 border-b border-base-300/60",C==="autocomplete"&&(Z.classList.add("inbox-search-result-item--autocomplete"),Z.setAttribute("role","option"),Z.tabIndex=-1,ie===v&&Z.classList.add("is-active"));let k=document.createElement("span");k.className="badge badge-outline badge-xs mr-2",k.textContent=A.type;let Xe=document.createElement("span");Xe.className="inbox-search-result-title",C==="autocomplete"?Xe.innerHTML=a(A.title||"(untitled)",p):Xe.textContent=A.title||"(untitled)";let Re=document.createElement("div");Re.className="opacity-70",Re.textContent=i(A.timestamp);let bn=document.createElement("div");bn.className="opacity-60 italic",bn.textContent="Related results",C==="autocomplete"&&Z.addEventListener("mousedown",Ct=>{Ct.preventDefault(),e.value=A.title||"",O(),E()}),Z.appendChild(k),Z.appendChild(Xe),Z.appendChild(Re),A.isSemanticMatch&&C!=="autocomplete"&&Z.appendChild(bn),P.appendChild(Z)}),t.appendChild(P)};async function M(T,F,q=[]){return Ti(T,F,q)}let O=async()=>{if(Ge!=="search"&&document.activeElement!==e)return;let F=(e.value||"").trim();if(n&&(n.hidden=!F),!F){t.innerHTML="";return}let q=_n(F),p=(q.keywordQuery||"").toLowerCase().split(/\s+/).map(A=>A.trim()).filter(Boolean),v=d(),C=v.filter(A=>{let ie=`${A.title} ${A.body}`.toLowerCase();return!p.length||p.every(k=>ie.includes(k))?q.timeRange?Number.isFinite(A.timestamp)?A.timestamp>=q.timeRange.start&&A.timestamp<=q.timeRange.end:!1:!0:!1});C.sort((A,ie)=>(ie.timestamp||0)-(A.timestamp||0));let P=[...C];if(C.length<5){let A=await M(q.keywordQuery||F,v,C);P.push(...A)}I(P)},h=T=>{let F=T.toLowerCase(),q=d().filter(p=>{let v=String(p.title||"").toLowerCase(),C=String(p.body||"").toLowerCase();return v.includes(F)||C.includes(F)});return q.sort((p,v)=>{let C=String(p.title||"").toLowerCase(),P=String(v.title||"").toLowerCase(),A=String(p.body||"").toLowerCase(),ie=String(v.body||"").toLowerCase(),Z=C.startsWith(F)||A.startsWith(F),k=P.startsWith(F)||ie.startsWith(F);return Z!==k?Z?-1:1:(v.timestamp||0)-(p.timestamp||0)}),q.slice(0,8)},b=T=>{c=h(T),u=c.length?0:-1,I(c,{limit:8,query:T,selectedIndex:u,mode:"autocomplete"})},D=()=>{I(c,{limit:8,query:e.value.trim(),selectedIndex:u,mode:"autocomplete"})},S=()=>{if(Ge!=="search"&&document.activeElement!==e)return;let T=(e.value||"").trim();T!==f&&(m&&clearTimeout(m),m=setTimeout(()=>{if(f=T,!T){E();return}b(T)},120))},N=()=>{if(u<0||u>=c.length)return;let T=c[u];e.value=T.title||"",O(),E()};e.addEventListener("input",S),e.addEventListener("keydown",T=>{if(T.key==="Enter"||T.key==="NumpadEnter"){T.preventDefault(),t.dataset.mode==="autocomplete"&&u>=0&&N();return}if(t.dataset.mode==="autocomplete")if(T.key==="ArrowDown"){if(T.preventDefault(),!c.length)return;u=Math.min(u+1,c.length-1),D()}else if(T.key==="ArrowUp"){if(T.preventDefault(),!c.length)return;u=Math.max(u-1,0),D()}else T.key==="Enter"?u>=0&&(T.preventDefault(),N()):T.key==="Escape"&&(T.preventDefault(),E())}),document.addEventListener("click",T=>{T.target instanceof Node&&(T.target===e||t.contains(T.target)||E())}),n&&n.addEventListener("click",()=>{e.value="",E(),n.hidden=!0,e.focus()}),document.addEventListener("memoryCue:remindersUpdated",O)}async function yt(e={}){if(!U||Bn)return null;if(typeof On=="function")try{On()}catch{}let t=typeof e.text=="string"?e.text:(U.value||"").trim(),n=typeof t=="string"?t.trim():"";if(!n)return null;Bn=!0,U&&typeof U.disabled<"u"&&(U.disabled=!0,U.setAttribute("aria-busy","true")),Vt instanceof HTMLElement&&(Vt.hidden=!1),Ve&&typeof Ve.disabled<"u"&&(Ve.disabled=!0);let i=null,o=d=>{let c=vi(d);return{type:typeof c?.type=="string"?c.type:"general_note",title:typeof c?.title=="string"?c.title:"",reminderDate:typeof c?.reminderDate=="string"&&c.reminderDate.trim()?c.reminderDate:null}},a=d=>{switch(d){case"footy_drill":return"Footy \u2013 Drills";case"netball_note":return"Netball";case"teaching_note":return"Teaching";case"task":return"Tasks";default:return null}};try{let d=Kr(n),c=d.text||n;if(d.kind==="reflection")i=Qr(c);else{let u=pn(c),f=null;u?.time&&(f=new Date(`${u.date}T${u.time}:00`).toISOString());let m=o(c),E=to(c,f),I=e?.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate.toISOString():typeof e?.dueDate=="string"&&e.dueDate.trim()?e.dueDate.trim():null;I&&(E.due=I),e?.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime())?E.notifyAt=e.notifyAt.toISOString():typeof e?.notifyAt=="string"&&e.notifyAt.trim()&&(E.notifyAt=e.notifyAt.trim());let M=a(m.type);M&&(E.category=M),d.kind==="task"?E.category="Tasks":d.kind==="footy-drill"&&(E.category="Footy \u2013 Drills"),i=Gi(E),i&&i.id&&(async()=>{try{let O=await Ei(c);if(!O||!i?.id)return;let h=y.find(N=>N?.id===i.id);if(!h)return;let b=a(O.type),D=typeof O.reminderDate=="string"&&O.reminderDate.trim()?O.reminderDate.trim():null,S=!1;b&&b!==h.category&&(h.category=b,S=!0),D&&D!==h.due&&(h.due=D,S=!0),S&&(h.updatedAt=Date.now(),Y(),J(),ce(h),tt(),fe("memoryCue:remindersUpdated",{items:y}))}catch(O){console.warn("AI smart capture failed, using fallback classifier",O)}})()}if(i&&typeof document<"u"){U.value="";try{U.focus({preventScroll:!0})}catch{U.focus()}try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:i}}))}catch{}Fn instanceof HTMLElement&&(Fn.hidden=!1,setTimeout(()=>{Fn.hidden=!0},1200))}}finally{U&&typeof U.disabled<"u"&&(U.disabled=!1,U.setAttribute("aria-busy","false")),Vt instanceof HTMLElement&&(Vt.hidden=!0),Ve&&typeof Ve.disabled<"u"&&(Ve.disabled=!1),Bn=!1}return i||null}typeof window<"u"&&(window.memoryCueQuickAddNow=yt),Ve?.addEventListener("click",()=>{Ge="quick-add",yt()}),U?.addEventListener("focus",()=>{Ge="quick-add";let e=document.getElementById("inboxSearchResults");e&&(e.innerHTML="",e.dataset.mode="")}),U?.addEventListener("keydown",e=>{if(e.key==="Enter"||e.key==="NumpadEnter"){if(Ge!=="quick-add"&&document.activeElement!==U)return;e.preventDefault(),e.stopPropagation(),yt()}}),Gr?.addEventListener("submit",e=>{if(Ge!=="quick-add"&&document.activeElement!==U){e.preventDefault(),e.stopPropagation();return}e.preventDefault(),e.stopPropagation(),yt()}),ro();function oo(){if(typeof HTMLElement>"u"||!(ae instanceof HTMLElement)||!(U instanceof HTMLInputElement)||ae.dataset.voiceBound==="true")return;if(ae.dataset.voiceBound="true",typeof window>"u"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true"),ae.getAttribute("title")||(ae.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=a=>{n=a,ae.setAttribute("aria-pressed",a?"true":"false"),ae.dataset.listening=a?"true":"false",ae.classList.toggle("is-listening",a),ae.classList.toggle("mic-active",a)};t=new e,t.lang="en-AU",t.interimResults=!1,t.continuous=!1,t.addEventListener("result",a=>{let d=a?.results?.[0]?.[0]?.transcript?.trim()||"";if(d){U.value=U.value.trim().length>0?`${U.value} ${d}`:d;try{U.focus({preventScroll:!0})}catch{U.focus()}}}),t.addEventListener("end",()=>{i(!1)}),t.addEventListener("error",a=>{console.error("Mic error:",a?.error),i(!1)});let o=()=>{if(!(!n||!t)){try{t.stop()}catch(a){console.error("Mic stop error:",a)}i(!1)}};On=o,ae.addEventListener("click",()=>{if(t){if(n){o();return}try{t.start(),i(!0)}catch(a){console.error("Mic start error:",a),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",o),i(!1)}oo();let Li=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,Ee=null,Ci=!!Li;Ci&&(Ee=new Li,Ee.lang="en-AU",Ee.interimResults=!1,Ee.maxAlternatives=1);function so(){try{if(typeof R=="function"){R("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}_e&&(Ci&&Ee?_e.addEventListener("click",()=>{try{Ee.start(),_e.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):_e.addEventListener("click",()=>{so()})),Ee&&(Ee.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();lo(t)}),Ee.addEventListener("end",()=>{_e&&_e.classList.remove("is-recording")}),Ee.addEventListener("error",()=>{_e&&_e.classList.remove("is-recording")}));function ao(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function co(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,o=new Date(i);if(n.includes("tomorrow"))o.setDate(o.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let d=parseInt(a[1],10),c=a[2]?parseInt(a[2],10):0,u=a[3];u||(/\b(p\.?m\.?|p m)\b/.test(n)?u="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(u="am")),u==="pm"&&d<12&&(d+=12),u==="am"&&d===12&&(d=0),o.setHours(d,c,0,0);let f=new Date(o),m=new Date(f.getTime()-10*60*1e3);return t.dueDate=f,t.notifyAt=m,t}function lo(e){if(!e||!U)return;let t=ao(e),{dueDate:n,notifyAt:i}=co(e);U.value=t,yt({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&U&&(e.preventDefault(),U.focus())})));try{ne==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let uo=s.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",ki=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,fo=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Gt=s.reminderLandingPath||(ne==="desktop"?"index.html#reminders":"mobile.html"),fe=(e,t={})=>{let n=null;try{n=typeof CustomEvent<"u"?CustomEvent:null}catch{n=null}!n&&typeof window<"u"&&typeof window.CustomEvent<"u"&&(n=window.CustomEvent),n||(n=function(i,o){o=o||{bubbles:!1,cancelable:!1,detail:null};let a=new Event(i,o);return a.detail=o.detail,a}),document.dispatchEvent(new n(e,{detail:t}))};function Di(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function tt(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:y}}))}catch{}}_&&!_.value&&(_.value=K),Be()&&We();function De(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(hr,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(hr,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function mo(){if(typeof HTMLElement>"u"||!(ue instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&g instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&g instanceof HTMLTextAreaElement;if(!e&&!t||ue.dataset.voiceBound==="true")return;if(ue.dataset.voiceBound="true",typeof window>"u"){ue.setAttribute("disabled","true"),ue.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ue.setAttribute("disabled","true"),ue.setAttribute("aria-disabled","true"),ue.getAttribute("title")||(ue.title="Voice input is not supported in this browser.");return}let i=null,o=!1,a=f=>{o=f,ue.setAttribute("aria-pressed",f?"true":"false"),ue.dataset.listening=f?"true":"false",ue.classList.toggle("is-listening",f)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",m=>{let E=m.results?.[0]?.[0]?.transcript?.trim()||"";if(E){g.value=E;try{g.focus({preventScroll:!0})}catch{try{g.focus()}catch{}}try{let I=g.value.length;typeof g.setSelectionRange=="function"&&g.setSelectionRange(I,I)}catch{}De({action:"dictated",label:`Voice input captured \xB7 ${E}`})}});let f=()=>{a(!1)};return i.addEventListener("end",f),i.addEventListener("error",f),i},c=()=>{if(!(!o||!i)){try{i.stop()}catch{}a(!1)}};ue.addEventListener("click",()=>{let f=d();if(f){if(o){c();return}try{f.start(),a(!0)}catch(m){console.warn("Speech recognition error:",m),a(!1)}}});let u=()=>{c()};typeof document<"u"&&(document.addEventListener("cue:close",u),document.addEventListener("reminders:updated",u)),a(!1)}ps(),mo();let zt,Kt,Xt,Qt,nt,Jt,Zt,en,tn,nn,rn,gt,ht,on,sn,$n,Un,an,qn,xi=s.firebaseDeps,jn=typeof s.importModule=="function"?s.importModule:e=>import(e),bt=ci(),wt=!1,ve=!1,Wn=null,xe=null,Et=null,y=[],it=!1,de=null,vt=null,rt=null,St=null,dn=null,ze={},Ke={},Q={},Ni=typeof document<"u"?document.getElementById("createSheetTitle"):null,Ri=()=>{g instanceof HTMLElement&&setTimeout(()=>{try{g.focus()}catch{}},0)},ot=(e,t=null)=>{St=e||null,dn=t||null,rt=St==="edit"?dn:null,Ni instanceof HTMLElement&&(Ni.textContent=St==="edit"?"Edit reminder":"New reminder")};function be(e=y){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?Ui(t||{},n||{}):o-i})}function po(e=y){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function Tt(e=y){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),be(n);else{n=e.slice().sort(Ui);let i=n.length;n.forEach((o,a)=>{o.orderIndex=(i-a)*Ae})}return e===y&&(y=n),n}function Mi(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=po();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-Ae||Ae}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+Ae||Ae}}function cn(e=y){if(!Array.isArray(e)||e.length<2)return!1;be(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(a==null||d==null||a<=d||a-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Ae;return e===y&&be(y),!0}let $={draggingId:null,dropTargetId:null,dropBefore:!0},Fi=!1,w={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function yo(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function At(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function He(){x&&(x.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),x.classList.remove("drag-over-list"))}function Yn(){if(!x)return;let e=x.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),He(),$.draggingId=null,$.dropTargetId=null,$.dropBefore=!0}function Bi(e,t,n){if(!e||e===t)return;let i=y.findIndex(I=>I?.id===e);if(i<0)return;let[o]=y.splice(i,1),a;if(!t)a=y.length;else{let I=y.findIndex(M=>M?.id===t);if(I<0){y.splice(i,0,o);return}a=n?I:I+1}y.splice(a,0,o);let d=y[a-1],c=y[a+1],u=Number.isFinite(d?.orderIndex)?d.orderIndex:null,f=Number.isFinite(c?.orderIndex)?c.orderIndex:null,m;u!=null&&f!=null?m=(u+f)/2:u!=null?m=u-Ae:f!=null?m=f+Ae:m=Ae,Number.isFinite(m)||(m=Ae*(y.length+1)),o.orderIndex=m,be(y);let E=cn(y);it=!0,Y(),J(),E?y.forEach(I=>ce(I)):ce(o),tt(),fe("memoryCue:remindersUpdated",{items:y}),De({action:"reordered",label:"Reminders reordered"})}function go(e){let t=At(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&($.draggingId=i,$.dropTargetId=null,$.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function ho(e){if(!$.draggingId)return;let t=At(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),$.dropTargetId=null,$.dropBefore=!1,He(),x?.classList.add("drag-over-list");return}if(t.dataset.id===$.draggingId){e.preventDefault(),He();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;($.dropTargetId!==t.dataset.id||$.dropBefore!==o)&&(He(),t.classList.add(o?"drag-over-before":"drag-over-after"),$.dropTargetId=t.dataset.id,$.dropBefore=o)}function bo(e){let t=At(e.target);if(!t){x?.contains(e.relatedTarget)||He();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),x?.contains(e.relatedTarget)||x?.classList.remove("drag-over-list"))}function wo(e){if(!$.draggingId)return;e.preventDefault();let t=At(e.target),n=t?.dataset.id||null,i=$.dropBefore;if(t){let o=t.getBoundingClientRect(),a=o.top+o.height/2;i=e.clientY<a}else n=null,i=!1;Bi($.draggingId,n,i),Yn()}function Eo(){Yn()}function vo(){!x||Fi||(Fi=!0,x.addEventListener("dragstart",go),x.addEventListener("dragover",ho),x.addEventListener("drop",wo),x.addEventListener("dragend",Eo),x.addEventListener("dragleave",bo),ln())}function ln(){if(!x||ln._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){ln._bound=!0;return}let t=6,n=160;function i(){w.longPressTimer&&(clearTimeout(w.longPressTimer),w.longPressTimer=null)}function o(){x&&(w.initialTouchAction!=null?x.style.touchAction=w.initialTouchAction:x.style.removeProperty("touch-action"))}function a({keepHighlights:h=!1}={}){if(i(),w.item&&w.pointerId!=null)try{w.item.hasPointerCapture?.(w.pointerId)&&w.item.releasePointerCapture(w.pointerId)}catch{}if(w.placeholder?.parentNode)try{w.placeholder.parentNode.removeChild(w.placeholder)}catch{}w.item&&(w.item.classList.remove("is-dragging"),w.originalStyles?w.item.setAttribute("style",w.originalStyles):w.item.removeAttribute("style")),o(),h||He(),Object.assign(w,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(h){return x?Array.from(x.querySelectorAll("[data-reminder-item]")).filter(b=>b!==h):[]}function c(h){let b=w.item;if(!b||w.ready)return;let D=b.getBoundingClientRect(),S=window.getComputedStyle(b);w.ready=!0,$.draggingId=b.dataset.id||null,w.offsetY=h.clientY-D.top,w.fixedX=D.left;let N=document.createElement("div");N.className="touch-drag-placeholder",N.setAttribute("aria-hidden","true"),N.style.height=`${D.height}px`,N.style.boxSizing="border-box",N.style.marginTop=S.marginTop,N.style.marginBottom=S.marginBottom,N.style.marginLeft=S.marginLeft,N.style.marginRight=S.marginRight,N.style.borderRadius=S.borderRadius,N.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",N.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",N.style.pointerEvents="none",N.style.display="block",N.style.width="100%",b.parentNode?.insertBefore(N,b),w.placeholder=N,w.longPressTimer=null,w.originalStyles=b.getAttribute("style")||"",b.classList.add("is-dragging"),b.style.position="fixed",b.style.left=`${D.left}px`,b.style.top=`${D.top}px`,b.style.width=`${D.width}px`,b.style.zIndex="999",b.style.pointerEvents="none",b.style.touchAction="none",w.initialTouchAction=x.style.touchAction||"",x.style.touchAction="none"}function u(h){let b=w.item;if(!b||!w.ready)return;let D=h-w.offsetY;b.style.top=`${D}px`,b.style.left=`${w.fixedX}px`}function f(h){if(!w.ready||!x)return;let b=w.item,D=d(b);if(He(),!D.length){$.dropTargetId=null,$.dropBefore=!1;return}let S=null,N=!1;for(let p of D){let v=p.getBoundingClientRect(),C=v.top+v.height/2;if(h<C){S=p,N=!0;break}}if(!S){S=D[D.length-1];let p=S.getBoundingClientRect(),v=p.top+p.height/2;N=h<v,N||(N=!1)}if(!S){$.dropTargetId=null,$.dropBefore=!1;return}let T=S.getBoundingClientRect(),F=T.top+T.height/2,q=h<F;S.classList.add(q?"drag-over-before":"drag-over-after"),$.dropTargetId=S.dataset.id||null,$.dropBefore=q}function m(h){let b=$.draggingId,D=w.moved;if(!w.ready){a();return}a(),!h&&D&&b&&Bi(b,$.dropTargetId,$.dropBefore),Yn()}function E(h){let b=h.pointerType||"";if(b&&b!=="touch"&&b!=="pen"||w.active)return;let D=At(h.target);if(!D)return;let S=yo(h.target);if(!(S&&S!==D)){w.active=!0,w.pointerId=h.pointerId,w.item=D,w.startX=h.clientX,w.startY=h.clientY,w.lastClientX=h.clientX,w.lastClientY=h.clientY,w.moved=!1,w.ready=!1,w.originalStyles=D.getAttribute("style")||"",w.startTime=h.timeStamp||Date.now(),$.dropTargetId=null,$.dropBefore=!0,$.draggingId=null,i(),w.longPressTimer=setTimeout(()=>{c({clientY:w.lastClientY})},n);try{D.setPointerCapture(h.pointerId)}catch{}}}function I(h){if(!w.active||h.pointerId!==w.pointerId)return;let b=h.pointerType||"";if(!(b&&b!=="touch"&&b!=="pen")){if(w.lastClientX=h.clientX,w.lastClientY=h.clientY,!w.ready){let D=Math.abs(h.clientX-w.startX),S=Math.abs(h.clientY-w.startY);if(D>t||S>t){let N=typeof h.timeStamp=="number"?h.timeStamp:Date.now();Math.abs(N-w.startTime)>=n?(i(),c({clientY:w.lastClientY})):a()}return}h.preventDefault(),w.moved=!0,u(h.clientY),f(h.clientY)}}function M(h){!w.active||h.pointerId!==w.pointerId||m(!1)}function O(h){!w.active||h.pointerId!==w.pointerId||m(!0)}x.addEventListener("pointerdown",E),window.addEventListener("pointermove",I),window.addEventListener("pointerup",M),window.addEventListener("pointercancel",O),ln._bound=!0}function Oi(){de=null,Cn("offline"),Ht.forEach(e=>e.classList.remove("hidden")),$t.forEach(e=>e.classList.add("hidden")),qt&&(qt.textContent=""),vt?.(),vt=null,Gn(),Y(),J(),qe()}function Vn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(si);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:fn(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:te(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0,semanticEmbedding:ee(n.semanticEmbedding)}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function So(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(si);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:te(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday,semanticEmbedding:ee(n.semanticEmbedding)}));localStorage.setItem(si,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function J(){be(y),So(y)}function Gn(){y=Tt(Vn())}Gn();async function To(){let e=!1;for(let i of y){let o=ee(i?.semanticEmbedding);await Er(i);let a=ee(i?.semanticEmbedding);!o&&a&&(e=!0)}e&&J();let t=pt(ke,[]),n=!1;for(let i of t){let o=ee(i?.semanticEmbedding);await Er(i);let a=ee(i?.semanticEmbedding);!o&&a&&(n=!0)}if(n&&typeof localStorage<"u")try{localStorage.setItem(ke,JSON.stringify(t))}catch(i){console.warn("Failed to persist note embeddings",i)}}To();async function Ao(){if(!de){y=Vn();return}let e=Tt(Vn());if(!e.length){y=[],J();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await ce(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}y=Tt(e.map(n=>({...n,pendingSync:!1}))),J(),Y(),qe()}try{Q=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{Q={}}if(Q&&typeof Q=="object"&&Object.values(Q).forEach(e=>{e&&typeof e=="object"&&(e.category=te(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:It(e),e.urlPath=e.urlPath||Gt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null),e.semanticEmbedding=ee(e.semanticEmbedding))}),!Be()){let e=Xi();typeof Notification<"u"&&Notification.permission==="granted"?(In(),e.length&&ai(e,{requestCheck:!0})):e.length&&ai(e)}let un=e=>{if(!bt)return;let t=[bt];bt.window&&!t.includes(bt.window)&&t.push(bt.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Io(){if(!oe)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in oe?oe.value:oe.innerHTML,d=m=>{if("value"in oe){oe.value=m;return}if(typeof m!="string"||m.length===0){oe.innerHTML="";return}let E=m.trim();if(/<\/?[a-z][\s\S]*>/i.test(E)){oe.innerHTML=m;return}let M=m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");oe.innerHTML=M},c=m=>{m?oe.classList.add("notes-editor--columns"):oe.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!m))},u="";try{u=localStorage.getItem(n)||""}catch{R("Unable to access saved notes")}d(u);let f=!1;try{f=localStorage.getItem(i)==="1"}catch{f=!1}c(f),oe.addEventListener("input",()=>{u=a();try{localStorage.setItem(n,u)}catch{R("Notes saved for this session only")}}),Nr?.addEventListener("click",()=>{u=a();try{localStorage.setItem(n,u),R("Notes saved")}catch{R("Notes saved for this session only")}}),Rr?.addEventListener("click",()=>{let m=u;try{m=localStorage.getItem(n)||u}catch{R("Unable to load saved notes")}u=m,d(u)}),e?.addEventListener("click",m=>{let E=m.target;if(!(E instanceof Element))return;let I=E.closest("button[data-action]");if(!I)return;let M=I.getAttribute("data-action");if(M==="columns"){let O=!oe.classList.contains("notes-editor--columns");c(O);try{localStorage.setItem(i,O?"1":"0")}catch{R("Column preference saved for this session only")}return}if(!o){R("Formatting controls are not supported in this browser");return}oe.focus(),M==="bullets"?document.execCommand("insertUnorderedList"):M==="numbers"&&document.execCommand("insertOrderedList")})}if(Io(),le?.addEventListener("click",rr),xi)({initializeApp:zt,getFirestore:Kt,enableMultiTabIndexedDbPersistence:Xt,enableIndexedDbPersistence:Qt,doc:nt,setDoc:Jt,deleteDoc:Zt,onSnapshot:en,collection:tn,query:nn,orderBy:rn,serverTimestamp:gt,getAuth:ht,onAuthStateChanged:on,GoogleAuthProvider:sn,signInWithPopup:$n,signInWithRedirect:Un,getRedirectResult:an,signOut:qn}=xi),wt=!0;else try{({initializeApp:zt}=await jn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Kt,enableMultiTabIndexedDbPersistence:Xt,enableIndexedDbPersistence:Qt,doc:nt,setDoc:Jt,deleteDoc:Zt,onSnapshot:en,collection:tn,query:nn,orderBy:rn,serverTimestamp:gt}=await jn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:ht,onAuthStateChanged:on,GoogleAuthProvider:sn,signInWithPopup:$n,signInWithRedirect:Un,getRedirectResult:an,signOut:qn}=await jn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),wt=!0}catch(e){wt=!1,console.warn("Firebase modules failed to load:",e),R("Firebase failed to load; notes available offline"),un(!1)}if(wt&&typeof zt=="function"&&typeof Kt=="function"&&typeof ht=="function")try{let e=fs();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Wn=zt(e),xe=Kt(Wn),ve=!0,console.info("[Firebase] Firestore initialised",e.projectId),un(!0)}catch(e){ve=!1,console.warn("Firebase initialization failed:",e),R("Firebase failed to load; notes available offline"),un(!1)}else wt?(ve=!1,un(!1)):ve=!1;ve&&typeof Xt=="function"&&typeof Qt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Xt(xe),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Qt(xe),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ve&&typeof ht=="function"&&(Et=ht(Wn));function Lo(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Co=typeof navigator<"u"&&navigator.language?navigator.language:"",Pi=Lo(Co),st=Pi||"en-US",Ne="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Ne=e.timeZone),!Pi&&e.locale&&(st=e.locale)}catch{}let ko=new Intl.DateTimeFormat(st,{timeZone:Ne,hour:"2-digit",minute:"2-digit"}),Do=new Intl.DateTimeFormat(st,{timeZone:Ne,weekday:"long",day:"numeric",month:"long"}),xo=new Intl.DateTimeFormat("en-CA",{timeZone:Ne,year:"numeric",month:"2-digit",day:"2-digit"}),No=new Intl.DateTimeFormat(st,{timeZone:Ne,weekday:"long"}),Ro=new Intl.DateTimeFormat(st,{timeZone:Ne,month:"short",day:"numeric"});function $e(e){let t=xo.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,o=t.find(a=>a.type==="day").value;return`${n}-${i}-${o}`}function _i(e,t){let[n,i,o]=e.split("-").map(u=>parseInt(u,10)),[a,d]=t.split(":").map(u=>parseInt(u,10)),c=new Date;return c.setFullYear(n,(i||1)-1,o||1),c.setHours(a||0,d||0,0,0),c.toISOString()}function Hi(e,t){let n=typeof e=="string"?e.trim():"",i=typeof t=="string"?t.trim():"";if(!n&&!i)return null;let o=/^\d{4}-\d{2}-\d{2}$/,a=/^\d{2}:\d{2}(?::\d{2})?$/;if(/^\d{4}-\d{2}-\d{2}[T\s]\d{2}:\d{2}(?::\d{2})?$/.test(n)){let u=new Date(n.replace(" ","T"));return Number.isNaN(u.getTime())?null:u.toISOString()}if(o.test(n)&&a.test(i||"09:00")){let u=(i||"09:00").slice(0,5);return _i(n,u)}if(o.test(n)&&!i)return _i(n,"09:00");let c=new Date([n,i].filter(Boolean).join(" "));return Number.isNaN(c.getTime())?null:c.toISOString()}let Mo=new Intl.DateTimeFormat("en-CA",{timeZone:Ne,year:"numeric",month:"2-digit",day:"2-digit"}),Fo=new Intl.DateTimeFormat("en-CA",{timeZone:Ne,hour:"2-digit",minute:"2-digit",hour12:!1});function Bo(e){try{let t=new Date(e),n=Mo.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",o=n.find(d=>d.type==="month")?.value||"00",a=n.find(d=>d.type==="day")?.value||"00";return`${i}-${o}-${a}`}catch{return""}}function Oo(e){try{let t=new Date(e),n=Fo.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function fn(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function $i(){return $e(new Date)}function Po(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Es(e){let t=Po(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function mn(e){return e==="High"?3:e==="Medium"?2:1}function Ui(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(o!==a)return o-a;let d=mn(t?.priority)-mn(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function vs(e,t){let n=mn(t.priority)-mn(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function qi(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Do.format(t)}catch{return e}}function zn(e){return ko.format(e)}function _o(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Ss(e){return e?_o(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function R(e){W&&(Je(),W.dataset.statusKind="toast",W.textContent=e,clearTimeout(R._t),R._t=setTimeout(()=>{W&&W.dataset.statusKind==="toast"&&(W.textContent="",delete W.dataset.statusKind)},2500))}function Ho(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function pn(e){e=String(e||"").toLowerCase();let t={date:$i(),time:""},n=c=>{let u=new Date,f=u.getDay(),m=(c-f+7)%7,E=new Date(u);return E.setDate(u.getDate()+(m===0?7:m)),E},i=c=>{let u=new Date,f=u.getDay(),m=(c-f+7)%7,E=new Date(u);return E.setDate(u.getDate()+m),E},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let c=new Date;c.setDate(c.getDate()+1),t.date=$e(c)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=o[c[1]],f=n(u);t.date=$e(f)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=o[c[1]],f=i(u);t.date=$e(f)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=o[c[1]],f=n(u);t.date=$e(f)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let c=e.match(/\bin\s+(\d+)\s+days?\b/),u=parseInt(c[1],10),f=new Date;f.setDate(f.getDate()+u),t.date=$e(f)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let c=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),u=parseInt(c[1],10),f=parseInt(c[2],10)-1,m=c[3]?parseInt(c[3],10):new Date().getFullYear(),E=new Date(m,f,u);t.date=$e(E)}else for(let[c,u]of Object.entries(a)){let f=new RegExp(`\\b${c}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(f.test(e)){let m=e.match(f),E=parseInt(m[1],10),I=new Date().getFullYear(),M=new Date(I,u,E);t.date=$e(M);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let c=parseInt(d[1],10),u=d[2]?parseInt(d[2],10):0,f=d[3];f&&(f==="pm"&&c<12&&(c+=12),f==="am"&&c===12&&(c=0)),t.time=`${String(c).padStart(2,"0")}:${String(u).padStart(2,"0")}`}return t}let Kn=ve&&Et&&typeof sn=="function";dr({authReady:Kn,auth:Et,GoogleAuthProvider:sn,signInWithPopup:$n,signInWithRedirect:Un,signOut:qn,toast:R});let ji=$r,Wi=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};ji&&Ht.length&&Ht.forEach(e=>Wi(e,cr)),Kn&&typeof an=="function"&&an(Et).catch(()=>{}),ji&&$t.length&&$t.forEach(e=>Wi(e,lr)),Kn&&typeof on=="function"?on(Et,async e=>{e?(de=e.uid,Cn("online"),Ht.forEach(t=>t.classList.add("hidden")),$t.forEach(t=>t.classList.remove("hidden")),qt&&(qt.textContent=e.displayName||e.email||""),$o(),await Ao()):Oi()}):Oi();function $o(){if(!ve||!xe||typeof tn!="function"||typeof nn!="function"||typeof rn!="function"||typeof en!="function")return;if(!de){Gn(),Y(),et(),J(),qe();return}vt&&vt();let e=tn(xe,"users",de,"reminders"),t=nn(e,rn("updatedAt","desc"));vt=en(t,n=>{let i=[];n.forEach(o=>{let a=o.data(),d=Number(a.orderIndex),c=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,u=a.pinToToday===!0;i.push({id:o.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:te(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:c,pinToToday:u})}),y=Tt(i),Y(),et(),J(),qe()},n=>{console.error("Firestore sync error:",n),X&&Cn("error","Sync Error")})}async function ce(e){if(!(!ve||!de||!xe||typeof nt!="function"||typeof Jt!="function"||typeof gt!="function"))try{await Jt(nt(xe,"users",de,"reminders",e.id),{ownerUid:de,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||K,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):gt(),updatedAt:gt()},{merge:!0})}catch(t){console.error("Save failed:",t),R("Save queued (offline)")}}async function Uo(e){if(!(!ve||!de||!xe||typeof nt!="function"||typeof Zt!="function"))try{await Zt(nt(xe,"users",de,"reminders",e))}catch{R("Delete queued (offline)")}}async function yn(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||K,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ue({preserveDetail:e=!1,resetMode:t=!0}={}){g&&(g.value=""),L&&(L.value=""),B&&(B.value=""),H&&(H.value=""),Yt("Medium"),_&&(_.value=K),hi(),t?ot(null):rt=St==="edit"?dn:null,le&&(le.textContent="Save"),me?.classList.add("hidden"),Rn(),e||fi()}function qo(e){let t=y.find(n=>n.id===e);t&&(ot("edit",e),g&&(g.value=t.title||""),L&&B&&(t.due?(L.value=Bo(t.due),B.value=Oo(t.due)):(L.value="",B.value="")),Yt(t?.priority||"Medium"),_&&(_.value=te(t.category)),H&&(H.value=typeof t.notes=="string"?t.notes:""),G&&(G.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),Rn(),Dr(t),le&&(le.textContent="Update"),me?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),Ri(),fe("cue:open",{mode:"edit"}))}function Yi(e){let t=e?.id||e;t&&(ot("edit",t),qo(t))}function Vi(e=null){Ue({resetMode:!1}),ot("new");let t={mode:"create",trigger:e};fe("cue:prepare",t),fe("cue:open",t),Ri()}typeof window<"u"&&(window.openNewReminderSheet=Vi,window.openEditReminderSheet=Yi),Oe instanceof HTMLElement&&Oe.addEventListener("click",e=>{let t=e.target instanceof Element?e.target.closest("#emptyStateCreateBtn"):null;t instanceof HTMLElement&&(e.preventDefault(),e.stopPropagation(),Vi(t))});function jo(e={},t={}){let{closeSheet:n=!0,activityAction:i="created",activityLabelPrefix:o="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let d=Date.now(),c=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),u=te(e.category??(_?_.value:K)),f=null;e.due instanceof Date?f=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(f=e.due);let m=null;e.notifyAt instanceof Date?m=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(m=e.notifyAt);let E={id:fn(),title:a,priority:e.priority||Wt(),category:u,notes:c,done:!1,createdAt:d,updatedAt:d,due:f,pendingSync:!de,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:m,semanticEmbedding:ee(e.semanticEmbedding)};if(Mi(E,{position:"start"}),y=[E,...y],be(y),ne==="mobile"&&Pe==="today"){let M=new Date;M.setHours(0,0,0,0);let O=new Date;O.setHours(23,59,59,999),tr(E,{start:M,end:O})||(Pe="all",ei())}let I=cn(y);return it=!0,Y(),J(),Vr(E),I?y.forEach(M=>ce(M)):ce(E),yn(E),at(E),qe(),tt(),fe("memoryCue:remindersUpdated",{items:y}),n&&Di(),De({action:i,label:`${o} \xB7 ${E.title}`}),E}function Gi(e){return jo(e,{closeSheet:!0})}function Wo(e,t){if(!de)return R("Sign in to add notes"),null;if(!e)return null;let n=y.find(d=>d.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${o}`:o,n.updatedAt=Date.now(),ce(n),Y(),J(),De({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Yo(e){let t=y.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),ce(t),yn(t),Y(),J(),t.done?(hn(e),De({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(at(t),De({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Vo(e,t){let n=y.find(o=>o?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),ce(n),Y(),J(),tt(),fe("memoryCue:remindersUpdated",{items:y}))}function Go(e){if(!ye||ye.tokenId!==e)return;let{item:t,index:n}=ye;if(!t){Je(e);return}Je(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),y.length):y.length;t.pendingSync=!de,t.updatedAt=Date.now(),y.splice(i,0,t),be(y);let o=cn(y);it=!0,Y(),J(),at(t),o?y.forEach(a=>ce(a)):ce(t),yn(t),tt(),fe("memoryCue:remindersUpdated",{items:y}),De({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),R("Reminder restored")}function Xn(e){let t=y.findIndex(o=>o.id===e),n=t>=0?y.splice(t,1)[0]:null;n&&rt===e&&Ue(),Y(),J(),Uo(e),hn(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(De({action:"deleted",label:i}),n&&W){Je();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ye={tokenId:o,item:n,index:t,timeoutId:null},kr(ye),ye.timeoutId=setTimeout(()=>{Je(o)},Cr)}else n&&Je()}function zi(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,o=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,c=!1,u=0,f=0,m=0,E=()=>{if(c){if(c=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",M),e.removeEventListener("pointerup",O),e.removeEventListener("pointercancel",h),e.removeEventListener("pointerleave",h),window.removeEventListener("pointerup",O),window.removeEventListener("pointercancel",h)}},I=b=>{if(b.pointerType==="mouse"&&b.button!==0)return;c&&E();let D=b.target;D instanceof Element&&D.closest(a)||(d=b.pointerId,u=b.clientX,f=b.clientY,m=typeof b.timeStamp=="number"?b.timeStamp:Date.now(),c=!0,e.addEventListener("pointermove",M),e.addEventListener("pointerup",O),e.addEventListener("pointercancel",h),e.addEventListener("pointerleave",h),window.addEventListener("pointerup",O),window.addEventListener("pointercancel",h))},M=b=>{if(!c||b.pointerId!==d)return;Math.abs(b.clientY-f)>i&&E()},O=b=>{if(!c||b.pointerId!==d)return;let D=b.clientX-u,S=Math.abs(b.clientY-f),N=(typeof b.timeStamp=="number"?b.timeStamp:Date.now())-m;if(E(),D<=-n&&S<=i&&N<=o){b.preventDefault(),b.stopPropagation();try{t()}catch(T){console.warn("Swipe delete handler failed",T)}}},h=b=>{c&&(typeof b.pointerId=="number"&&b.pointerId!==d||E())};e.addEventListener("pointerdown",I)}function It(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=zn(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=zn(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function Ki(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}R("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Xi(){return Object.values(Q||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||K,notes:typeof e.notes=="string"?e.notes:"",body:It(e),urlPath:e.urlPath||Gt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null,semanticEmbedding:ee(e.semanticEmbedding)}))}function Qn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(Q))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Xi(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&In(),ai(e,{requestCheck:t})}function gn(e,{closeNotification:t=!0}={}){if(t){let n=Fe.get(e);if(n){try{n.close()}catch{}Fe.delete(e)}}ze[e]&&(clearTimeout(ze[e]),delete ze[e]),Ke[e]&&(clearTimeout(Ke[e]),delete Ke[e]),di(e),Q[e]&&(delete Q[e],Qn())}function hn(e){gn(e)}function Jn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Fe.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:It(e),tag:e.id});Fe.set(e.id,n);let i=()=>{Fe.get(e.id)===n&&Fe.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function zo(e){if(!Be())return!1;let t=Tr();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await We();if(!i)return!1;await di(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||K,body:a,urlPath:Gt},a=It(e),d={body:a,tag:e.id,data:o,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(c){return console.warn("Failed to schedule persistent notification",c),!1}}function at(e){if(!e||!e.id)return;if(e.category=te(e.category),!e.due||e.done){hn(e.id);return}let t=Q[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||K,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:It(e),urlPath:Gt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,semanticEmbedding:ee(e.semanticEmbedding),notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,u=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?u:null})()};if(Q[e.id]=n,Qn(),ze[e.id]&&(clearTimeout(ze[e.id]),delete ze[e.id]),Ke[e.id]&&(clearTimeout(Ke[e.id]),delete Ke[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(Q[e.id]?.viaTrigger){gn(e.id,{closeNotification:!1});return}Jn(e),gn(e.id,{closeNotification:!1});return}let d=Be();if(Number.isFinite(o)&&o>Date.now()&&o<i){let c=o-Date.now();Ke[e.id]=setTimeout(()=>{Jn({...e,due:e.due||n.due})},c)}d&&(n.viaTrigger=!1,zo(e).then(c=>{c&&Q[e.id]&&(Q[e.id]={...Q[e.id],viaTrigger:!0},Qn())})),ze[e.id]=setTimeout(()=>{d&&di(e.id),Jn(e),gn(e.id,{closeNotification:!1})},a)}function qe(){Object.values(Q).forEach(e=>at({...e,category:te(e?.category)}))}function Qi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=No.format(t),i=Ro.format(t),o=zn(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}let Ji="__mcPinToggleHandler";var Zn=!1;function Lt(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Le,t),e.classList.toggle(pe,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Zi(e){if(!(e instanceof HTMLElement)||e[Ji])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let o=i.currentTarget;if(!(o instanceof HTMLElement))return;let d=(typeof o.closest=="function"?o.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){Lt(o,!1);return}let c=!o.classList.contains(Le);await Promise.resolve(Vo(d,c)),Lt(o,c)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Ji]={click:t,keydown:n}}function Ko(){if(!x)return;let e=x.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){Lt(t,!1),Zi(t);return}let a=!!y.find(d=>d?.id===i)?.pinToToday;Lt(t,a),Zi(t)})}function er(){if(!x||Zn)return;Zn=!0;let e=()=>{Zn=!1,Ko()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function tr(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function Xo(e,t,n){if(!Array.isArray(e))return[];let o=t==="completed"?e.filter(a=>!!a?.done):e.filter(a=>!a?.done);return t==="today"?o.filter(a=>tr(a,n)):o}function ei(){let e=document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]");e.length&&e.forEach(t=>{let i=t.getAttribute("data-reminders-tab")===Pe;t.setAttribute("aria-pressed",i?"true":"false"),i?t.classList.add("reminders-tab-active","active"):t.classList.remove("reminders-tab-active","active")})}function nr(e){if(!e||e===Pe)return!1;document.querySelectorAll("#reminders-slim-header [data-reminders-tab], #view-reminders [data-reminders-tab]").length&&(Pe=e,ei(),Array.isArray(xn)&&Y(),et())}function ir(){if(ne!=="mobile"||typeof document>"u"||ir._wired)return;ei(),et(),document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]").forEach(t=>{t.addEventListener("click",()=>{let n=t.getAttribute("data-reminders-tab");nr(n)})})}function Y(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let o={start:n,end:i};if(He(),be(y),mi)try{mi.textContent=String(y.length)}catch{}y.forEach(p=>{p&&typeof p=="object"&&(p.category=te(p.category))});let a=new Set(cs.map(p=>te(p)));y.forEach(p=>{p&&typeof p=="object"&&a.add(te(p.category))});let d=Array.from(a).sort((p,v)=>p.localeCompare(v,void 0,{sensitivity:"base"}));if(Dn){let p=new Set;Array.from(Dn.querySelectorAll("option")).forEach(v=>{p.add(v.value.trim().toLowerCase())}),d.forEach(v=>{let C=v.toLowerCase();if(!p.has(C)){let P=document.createElement("option");P.value=v,Dn.appendChild(P),p.add(C)}})}if(it)it=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let p=y.map(v=>({...v}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:p}}));else if(document.createEvent){let v=document.createEvent("CustomEvent");v&&v.initCustomEvent&&(v.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:p}),document.dispatchEvent(v))}}catch{}}let c=y.slice();be(c),ne==="mobile"&&(xn=c.slice(),c=Xo(xn,Pe,o),et());let u=!0,f=y.length>0,m=c.length>0,E=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let p=Object.values(Q||{}).filter(v=>v&&typeof v=="object"&&v.id);return new Set(p.map(v=>v.id))})();if(Oe)if(m)Oe.classList.add("hidden");else{let p=f?"No reminders to show right now.":uo;ki?ki(Oe,{icon:f?"sparkles":"bell",title:f?"Nothing to display":"Create your first cue",description:p,action:f?void 0:`<button id="emptyStateCreateBtn" type="button" class="${fo}">Create reminder</button>`}):Oe.textContent=p,Oe.classList.remove("hidden")}if(pi&&pi.classList.toggle("has-items",m),!x)return;if(!m){Oe?(x.innerHTML="",x.classList.add("hidden")):(x.innerHTML='<div class="text-muted">No reminders found.</div>',x.classList.remove("hidden")),er();return}x.classList.remove("hidden"),x.replaceChildren();let I=document.createDocumentFragment(),M=x.tagName==="UL"||x.tagName==="OL",O=!0,h=["priority-high","priority-medium","priority-low"],b=(p,v)=>{if(!(p instanceof HTMLElement))return;p.classList.remove(...h);let C=typeof v=="string"?v.trim().toLowerCase():"";C.startsWith("h")?p.classList.add("priority-high"):C.startsWith("m")?p.classList.add("priority-medium"):C.startsWith("l")&&p.classList.add("priority-low")},D=(p,v="neutral")=>{let C=document.createElement("span");C.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",C.title=p,C.dataset.tone=v;let P=document.createElement("span");P.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",v==="priority-high"?P.classList.add("bg-error"):v==="priority-medium"?P.classList.add("bg-warning"):v==="priority-low"?P.classList.add("bg-secondary"):v==="category"?P.classList.add("bg-primary"):P.classList.add("bg-base-content","opacity-40");let A=document.createElement("span");return A.className="truncate",A.textContent=p,C.append(P,A),C},S=(p,v,{elementTag:C,isMobile:P})=>{let A={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:v,done:!!p.done,pinToToday:p.pinToToday===!0},ie="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Z="task-item reminder-row reminder-card w-full text-base-content",k=document.createElement(C);k.className=P?Z:ie,k.dataset.id=A.id,k.dataset.category=A.category,k.dataset.title=A.title;let Xe=A.priority&&String(A.priority).trim();Xe?k.dataset.priority=Xe:delete k.dataset.priority,k.dataset.done=String(A.done),A.dueIso?k.dataset.due=A.dueIso:delete k.dataset.due,A.pinToToday?k.dataset.pinToToday="true":delete k.dataset.pinToToday,k.dataset.reminder=JSON.stringify(A),k.dataset.orderIndex=Number.isFinite(p.orderIndex)?String(p.orderIndex):"",k.dataset.reminderItem="true",k.classList.add("reminder-draggable"),k.setAttribute("draggable","true"),k.setAttribute("role","button"),k.tabIndex=0,k.setAttribute("aria-label",`Edit reminder: ${p.title}`),b(k,A.priority),E.has(A.id)?k.dataset.notificationActive="true":delete k.dataset.notificationActive;let Re=A.dueIso?new Date(A.dueIso):null;u&&Re&&Re>=n&&Re<=i?(k.classList.add("is-today"),k.dataset.today="true"):(k.classList.remove("is-today"),delete k.dataset.today);let Ct=Qi(p),wn=Ct&&Ct!=="No due date"?Ct:"",dt=document.createElement("div");dt.className="task-toolbar flex items-start gap-1",dt.setAttribute("role","toolbar"),dt.setAttribute("aria-label","Reminder actions"),P&&dt.classList.add("flex-shrink-0");let re=document.createElement("button");re.type="button",re.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",re.classList.toggle("reminder-complete-toggle--active",A.done);let Zo=A.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";re.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${Zo}"
          />
        </svg>`,A.done?(re.classList.add("text-base-content/60"),re.setAttribute("aria-label",`Mark reminder as active: ${p.title}`)):(re.classList.add("text-success"),re.setAttribute("aria-label",`Mark reminder as done: ${p.title}`)),re.setAttribute("aria-pressed",A.done?"true":"false"),re.setAttribute("data-reminder-control","toggle"),re.setAttribute("data-no-swipe","true"),re.addEventListener("click",z=>{z.preventDefault(),z.stopPropagation(),Yo(A.id)});let En=()=>Yi(p);if(P){let z=document.createElement("div");z.className="reminder-card-main reminder-row-main";let Te=document.createElement("div");Te.className="reminder-title reminder-row-title",Te.dataset.reminderTitle="true";let Qe=document.createElement("span");if(Qe.dataset.role="reminder-today-toggle",Qe.className="reminder-title-toggle cursor-pointer",Qe.setAttribute("role","button"),Qe.tabIndex=0,Qe.textContent=p.title,Lt(Qe,A.pinToToday),Te.appendChild(Qe),z.appendChild(Te),wn){let ge=document.createElement("div");ge.className="reminder-date reminder-row-meta",ge.textContent=wn,z.appendChild(ge)}return A.done?k.classList.add("reminder-row-completed"):Re&&Re<e&&k.classList.add("reminder-row-overdue"),re.classList.add("reminder-row-complete","reminder-complete-btn"),k.append(re,z),k.addEventListener("click",ge=>{if(ge.defaultPrevented)return;let ti=ge.target;ti&&typeof ti.closest=="function"&&ti.closest("[data-reminder-control]")||En()}),k.addEventListener("keydown",ge=>{ge.defaultPrevented||ge.target===k&&(ge.key==="Enter"||ge.key===" ")&&(ge.preventDefault(),En())}),P&&zi(k,()=>Xn(A.id)),k}let vn=document.createElement("div");vn.className="flex min-w-0 flex-1 flex-col gap-2";let ct=document.createElement("p");ct.className="text-lg font-bold leading-snug text-base-content",ct.classList.add("desktop-reminder-title"),ct.classList.add("sm:text-[0.95rem]"),A.done&&ct.classList.add("line-through","text-base-content/60"),ct.textContent=p.title,vn.appendChild(ct);let kt=document.createElement("div");kt.className="desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70",wn&&kt.appendChild(D(wn,"due")),!!(v&&v!==K)&&kt.appendChild(D(v,"category")),kt.children.length&&vn.appendChild(kt),k.appendChild(vn);let Me=document.createElement("button");return Me.type="button",Me.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Me.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Me.setAttribute("aria-label",`Delete reminder: ${p.title}`),Me.setAttribute("data-action","delete"),Me.setAttribute("data-reminder-control","delete"),Me.setAttribute("data-no-swipe","true"),Me.addEventListener("click",z=>{z.preventDefault(),z.stopPropagation();try{Xn(A.id)}catch(Te){console.warn("Delete handler failed",Te)}}),dt.append(re,Me),k.appendChild(dt),k.addEventListener("click",z=>{if(z.defaultPrevented)return;let Te=z.target;Te&&typeof Te.closest=="function"&&Te.closest("[data-reminder-control]")||En()}),k.addEventListener("keydown",z=>{z.defaultPrevented||z.target===k&&(z.key==="Enter"||z.key===" ")&&(z.preventDefault(),En())}),P&&zi(k,()=>Xn(A.id)),k},N=(p,v)=>S(p,v,{elementTag:"div",isMobile:!0});if(ne!=="desktop"&&!O){c.forEach(p=>{let v=p.category||K;I.appendChild(N(p,v))}),x.appendChild(I);return}let T=new Map;c.forEach(p=>{let v=p.category||K;T.has(v)||T.set(v,[]),T.get(v).push(p)});let F=Array.from(T.entries()).sort((p,v)=>p[0].localeCompare(v[0],void 0,{sensitivity:"base"})),q=!0;F.forEach(([p,v])=>{if(p!==K){let C=document.createElement(M?"li":"div");C.dataset.categoryHeading=p,M&&(C.setAttribute("role","presentation"),C.style.listStyle="none"),C.className=ne==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",q||(C.style.marginTop=ne==="desktop"?"1.25rem":"1rem");let P=document.createElement("div");P.setAttribute("role","heading"),P.setAttribute("aria-level","3"),P.className=ne==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let A=document.createElement("span");A.textContent=p;let ie=document.createElement("span");ie.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",ie.textContent=`${v.length} ${v.length===1?"item":"items"}`,P.append(A,ie),C.appendChild(P),I.appendChild(C)}v.forEach(C=>{if(ne==="desktop"){let P=S(C,p,{elementTag:M?"li":"div",isMobile:!1});I.appendChild(P);return}I.appendChild(N(C,p))}),q=!1}),x.appendChild(I),xr(),er()}function Se(){ft?.setAttribute("aria-expanded","false"),mt?.classList.add("hidden")}function Qo(){ft?.setAttribute("aria-expanded","true"),mt?.classList.remove("hidden")}ft?.addEventListener("click",e=>{e.stopPropagation(),ft.getAttribute("aria-expanded")==="true"?Se():Qo()}),document.addEventListener("click",e=>{mt&&!mt.classList.contains("hidden")&&!mt.contains(e.target)&&e.target!==ft&&Se()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Se()}),Hr.forEach(e=>{e.addEventListener("click",()=>{let t=jt?.classList.contains("hidden");jt?.classList.toggle("hidden"),t&&jt?.scrollIntoView({behavior:"smooth",block:"start"}),Se()})}),document.addEventListener("DOMContentLoaded",()=>{jt?.classList.add("hidden")});function rr(){try{console.log("handleSaveAction invoked",{editingId:rt,title:g?.value})}catch{}let t=(typeof g?.value=="string"?g.value:"").trim(),n=typeof L?.value=="string"?L.value:"",i=typeof B?.value=="string"?B.value:"",o=typeof G?.value=="string"?G.value.trim():"";if(St==="edit"&&rt){let f=y.find(I=>I.id===rt);if(!f){Ue();return}if(!t){R("Add a reminder title");return}let m=Hi(n,i);if(!m){let I=pn(t);I.time&&(m=new Date(`${I.date}T${I.time}:00`).toISOString())}f.title=t;let E=Wt();f.priority=E,Yt(E),_&&(f.category=te(_.value)),f.due=m,H&&(f.notes=H.value.trim()),f.plannerLessonId=o||null,f.updatedAt=Date.now(),ce(f),yn(f),it=!0,Y(),at(f),J(),tt(),fe("memoryCue:remindersUpdated",{items:y}),Di(),De({action:"updated",label:`Reminder updated \xB7 ${f.title}`}),Ue(),R("Reminder updated"),fe("cue:close",{reason:"updated"});return}if(!t){R("Add a reminder title");return}let a=H?H.value.trim():"",d=Hi(n,i);if(!d){let f=pn(t);f.time&&(d=new Date(`${f.date}T${f.time}:00`).toISOString())}let c=o?{lessonId:o,dayLabel:G?.dataset?.lessonDayLabel||"",lessonTitle:G?.dataset?.lessonTitle||"",summary:G?.dataset?.lessonSummary||""}:null,u=Gi({title:t,priority:Wt(),category:_?_.value:"",due:d,notes:a,plannerLessonId:o||null});u&&(c?(R("Planner reminder created"),fe("planner:reminderCreated",{lessonId:c.lessonId,dayLabel:c.dayLabel,lessonTitle:c.lessonTitle,summary:c.summary,reminderId:u.id,reminderTitle:u.title,reminderDue:u.due||null})):R("Reminder created")),g&&(g.value=""),B&&(B.value=""),H&&(H.value=""),Rn(),fe("cue:close",{reason:"created"})}g?.addEventListener("keydown",e=>{e.key==="Enter"&&rr()});let or=(e,t)=>{let n=document.getElementById(e);!(n instanceof HTMLElement)||!(t instanceof HTMLInputElement)||n.addEventListener("click",()=>{if(typeof t.showPicker=="function")try{t.showPicker();return}catch(i){console.warn("Native picker failed to open",i)}t.focus(),t.click()})};or("reminderDatePickerBtn",L),or("reminderTimePickerBtn",B);function Jo(){if(!g||!Ye)return;let e=g.value.trim();if(!e){Ye.style.display="none";return}try{let t=pn(e),n=$i();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${qi(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Ye.textContent=`Parsed: ${i}`,Ye.style.display="block"):Ye.style.display="none"}else Ye.style.display="none"}catch{Ye.style.display="none"}}if(g?.addEventListener("input",Ho(Jo,300)),me?.addEventListener("click",()=>{Ue(),R("Edit cancelled"),fe("cue:close",{reason:"edit-cancelled"})}),Ir?.addEventListener("click",()=>{Ue()}),document.addEventListener("cue:cancelled",()=>{Ue()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";Ue({resetMode:!1}),ot(t,t==="edit"?dn:null)}),document.addEventListener("cue:close",()=>{ot(null)}),document.addEventListener("planner:prefillReminder",e=>{Wr(e?.detail||{})}),window.addEventListener("load",()=>g?.focus()),Fr?.addEventListener("click",()=>{let e=y.filter(t=>!t.done).map(t=>{let n=t.due?qi(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(st,{hour:"2-digit",minute:"2-digit",timeZone:Ne}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){R("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>R("Copied for Master Task List")).catch(()=>R("Copy failed")),Se()}),kn?.addEventListener("change",()=>{let e=kn.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let d={...a,id:fn(),category:te(a.category),pendingSync:!de,orderIndex:null};Mi(d,{position:"start"}),y=[d,...y],i.push(d)}),be(y);let o=cn(y);Y(),J(),o?y.forEach(a=>ce(a)):i.forEach(a=>ce(a)),R("Import successful")}catch{R("Invalid JSON")}},t.readAsText(e),kn.value="",Se()}),Br?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Se()}),Or?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){R("Add your Apps Script URL in Settings first"),Se();return}if(!y.length){R("No tasks to sync"),Se();return}R("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<y.length;i+=t){let o=y.slice(i,i+t),a=await Promise.allSettled(o.map(d=>{let c={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||K,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}));n+=a.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}R(`Sync complete: ${y.length-n} ok${n?`, ${n} failed`:""}`),Se()}),Ze&&(Ze.value=localStorage.getItem("syncUrl")||""),Pr?.addEventListener("click",()=>{Ze&&(localStorage.setItem("syncUrl",Ze.value.trim()),R("Settings saved"))}),_r?.addEventListener("click",async()=>{if(!Ze)return;let e=Ze.value.trim();if(!e){R("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});R(t.ok?"Test ok":"Test failed")}catch{R("Test failed")}}),Mr?.addEventListener("click",async()=>{if(!("Notification"in window)){R("Notifications not supported");return}if(Notification.permission==="granted"){R("Notifications enabled"),Be()?We():(In(),Ki()),qe(),Y();return}try{await Notification.requestPermission()==="granted"?(R("Notifications enabled"),Be()?We():(In(),Ki()),qe(),Y()):R("Notifications blocked")}catch{R("Notifications blocked")}}),ir(),ne==="mobile"){let e=()=>{try{qr()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return vo(),qe(),Y(),J(),ne==="mobile"&&(window.setMobileRemindersFilter=nr),{cancelReminder:hn,scheduleReminder:at,closeActiveNotifications:Ar,getActiveNotifications:()=>Fe,addNoteToReminder:Wo,buildRagContext:Hn,askAssistant:Ii,__testing:{setItems(e=[]){y=Array.isArray(e)?e.map(t=>({...t,category:te(t?.category)})):[],y=Tt(y),be(y),Y()},render:Y,getItems:()=>y.map(e=>({...e})),parseInboxTimeQuery:_n,buildRagContext:Hn,askAssistant:Ii}}}var hr,Fe,br,ii,ri,wr,An,Ft,oi,K,cs,si,Ae,us,Ie,ys=ni(()=>{fr();hr="memoryCue:activity",Fe=new Map,br=!1,ii="service-worker.js",ri="memory-cue-reminder-sync",wr=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),An=null,Ft=null,oi=!1,K="General",cs=Object.freeze([K,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),si="memoryCue:offlineReminders",Ae=1024;us=Object.freeze({}),Ie=null});function Rs(s){return new li(s)}var gs,hs,li,bs=ni(()=>{gs=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),hs={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},li=class s{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...hs,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let l=this.getFocusableElements();if(l.length===0){r.preventDefault(),this.modal.focus();return}let g=l[0],L=l[l.length-1],B=document.activeElement;r.shiftKey&&B===g?(r.preventDefault(),L.focus()):!r.shiftKey&&B===L&&(r.preventDefault(),g.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(gs)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let l=r?.detail?.mode==="edit";this.setEditMode(l),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let l=r.detail?.reason||"external-close";this.hide({reason:l})}dispatchEvent(r,l={}){let g=this.events[r];if(!g||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let L=new CustomEvent(g,{detail:l,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(L)}requestClose(r){let l={reason:r,controller:this};this.dispatchEvent("cancelled",l),this.dispatchEvent("closeRequest",{...l,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let l=this.animationHooks?.[r];typeof l=="function"&&await l(this)}addToStack(){let r=s.activeStack,l=r.indexOf(this);l!==-1&&r.splice(l,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=s.activeStack,l=r.indexOf(this);l!==-1&&r.splice(l,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{Is as a,fr as b,Ds as c,ys as d,li as e,Rs as f,bs as g};
