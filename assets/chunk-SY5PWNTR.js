import{b as je,c as rr}from"./chunk-KX65DZXT.js";import{a as nr,b as Wt,c as Ni}from"./chunk-GUVSRPRW.js";function or(r={}){try{Object.assign(H,r||{})}catch(o){console.warn("[supabase-auth] setAuthContext failed",o)}}async function ar(r={}){try{if(H&&typeof H.signInWithPopup=="function"&&H.auth&&typeof H.GoogleAuthProvider=="function")return H.signInWithPopup(H.auth,new H.GoogleAuthProvider);if(H&&typeof H.signInWithRedirect=="function"&&H.auth&&typeof H.GoogleAuthProvider=="function")return H.signInWithRedirect(H.auth,new H.GoogleAuthProvider);let o=je();if(o&&o.auth){if(typeof o.auth.signInWithOAuth=="function")return o.auth.signInWithOAuth({provider:"google",...r});if(typeof o.auth.signIn=="function")return o.auth.signIn({provider:"google"})}}catch(o){console.error("[supabase-auth] startSignInFlow error",o);try{H?.toast?.("Sign-in failed")}catch(s){console.warn("[supabase-auth] toast handler failed",s)}throw o}return Promise.resolve(null)}async function sr(){try{if(H&&typeof H.signOut=="function")return H.signOut(H.auth);let r=je();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function Fi(r){return r?Array.isArray(r)?r:[r]:[]}function pt(r){return Array.from(new Set(r.filter(o=>o instanceof HTMLElement||typeof SVGElement<"u"&&o instanceof SVGElement)))}function ue(r,o){let s=Fi(o).filter(Boolean);if(!s.length)return[];let c=s.flatMap(S=>Array.from(r.querySelectorAll(S)));return pt(c)}function Ri(r,o=document){let s=o instanceof Document||o instanceof HTMLElement?o:document;return{authForms:ue(s,r.authForm),emailInputs:ue(s,r.emailInput),signInButtons:ue(s,r.signInButtons),signOutButtons:ue(s,r.signOutButtons),userBadges:ue(s,r.userBadge),userBadgeEmails:ue(s,r.userBadgeEmail),userBadgeInitials:ue(s,r.userBadgeInitial),userNameEls:ue(s,r.userName),syncStatusEls:ue(s,r.syncStatus),syncStatusTextEls:ue(s,r.syncStatusText),statusIndicatorEls:ue(s,r.statusIndicator),feedbackEls:ue(s,r.feedback)}}function lt(r,o){pt(Array.isArray(r)?r:[r]).forEach(s=>{s instanceof HTMLElement&&(s.classList.toggle("hidden",!o),o?s.removeAttribute("hidden"):s.setAttribute("hidden",""))})}function Ne(r,o){pt(Array.isArray(r)?r:[r]).forEach(s=>{s instanceof HTMLElement&&(s.textContent=o||"")})}function Bi(r,o){pt(r).forEach(s=>{s instanceof HTMLElement&&(s.dataset.state=o,s.classList.toggle("online",o==="online"),s.classList.toggle("offline",o!=="online"))})}function ft(r,o){pt(r).forEach(s=>{if(!(s instanceof HTMLElement))return;s.textContent=o||"";let c=!!o;s.classList.toggle("hidden",!c),c?s.removeAttribute("hidden"):s.setAttribute("hidden","")})}function dr(r={}){let o={...ir.syncStatusText,...r.syncStatusText||{}};return{...ir,...r,syncStatusText:o}}function ut(r,{user:o,messages:s}={}){let c=dr(s),S=!!o;lt(r.signInButtons,!S),lt(r.authForms,!S),lt(r.signOutButtons,S),lt(r.userBadges,S);let T=typeof o?.email=="string"?o.email:"",L=T?T.charAt(0).toUpperCase():"U";S?(Ne(r.userBadgeEmails,T),Ne(r.userBadgeInitials,L),Ne(r.userNameEls,T)):(Ne(r.userBadgeEmails,""),Ne(r.userBadgeInitials,""),Ne(r.userNameEls,""));let W=typeof c.signedIn=="function"?c.signedIn(o):c.signedIn,C=typeof c.signedOut=="function"?c.signedOut(o):c.signedOut,z=S?W:C,ee=!S;r.syncStatusEls.length&&(Ne(r.syncStatusEls,z),r.syncStatusEls.forEach(te=>{te instanceof HTMLElement&&(te.classList.toggle("online",S),te.dataset.state=S?"online":"offline")}),lt(r.syncStatusEls,ee));let E=S?c.syncStatusText?.signedIn:c.syncStatusText?.signedOut;Ne(r.syncStatusTextEls,E||""),Bi(r.statusIndicatorEls,S?"online":"offline"),ft(r.feedbackEls,"")}function Oi(r,o){o.authForms.forEach(s=>{!(s instanceof HTMLFormElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("submit",async c=>{c.preventDefault();let S=o.emailInputs.find(L=>s.contains(L))||s.querySelector('input[type="email"]'),T=typeof S?.value=="string"?S.value.trim():"";if(!T){ft(o.feedbackEls,"Enter an email address to continue.");return}try{let{error:L}=await r.auth.signInWithOtp({email:T});L?ft(o.feedbackEls,L.message||"Unable to send magic link."):ft(o.feedbackEls,"Magic link sent. Check your email.")}catch(L){ft(o.feedbackEls,L?.message||"Unable to send magic link.")}}))})}function Mi(r,o){o.signOutButtons.forEach(s=>{!(s instanceof HTMLElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(c){console.error("[supabase] Sign-out failed.",c)}}))})}function io(r={}){let{supabase:o,scope:s=document,selectors:c={},messages:S={},disableButtonBinding:T=!1,onSessionChange:L}=r,W={...ki,...c},C=Ri(W,s),z=dr(S);ut(C,{user:null,messages:z});let ee=o||je()||(typeof window<"u"?window.supabase:null);if(!ee)return{supabase:null,elements:C,applyAuthState:X=>ut(C,{...X,messages:z}),destroy(){}};Oi(ee,C),T||Mi(ee,C);let E=[],{data:te}=ee.auth.onAuthStateChange((X,I)=>{if(ut(C,{user:I?.user??null,messages:z}),typeof L=="function")try{L(I?.user??null,I)}catch(F){console.error("[supabase] onSessionChange handler failed.",F)}});return te?.subscription&&E.push(()=>{try{te.subscription.unsubscribe()}catch{}}),ee.auth.getSession().then(({data:X,error:I})=>{I||ut(C,{user:X?.session?.user??null,messages:z})}).catch(X=>{console.error("[supabase] getSession failed.",X)}),{supabase:ee,elements:C,applyAuthState:X=>ut(C,{...X,messages:z}),destroy(){E.forEach(X=>{try{X()}catch{}})}}}var H,ki,ir,cr=Wt(()=>{rr();H={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};ki={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},ir={signedOut:"",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var pr=Ni((ao,mt)=>{var Yt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function lr(r){if(!r||typeof r!="object")return null;let o=Object.entries(r).filter(([s,c])=>typeof c=="string"&&c.trim()!=="");return o.length?Object.fromEntries(o):null}function _i(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},o=lr(r?.__FIREBASE_CONFIG);if(o)return o;let s=lr(r?.__ENV?.FIREBASE_CONFIG);if(s)return s;let S=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((T,[L,W])=>{let C=r?.__ENV?.[L]??r?.[L];return typeof C=="string"&&C.trim()!==""&&(T[W]=C),T},{});return Object.keys(S).length?S:null}function fr(){let r=_i();return r?{...Yt,...r}:{...Yt}}var ur={DEFAULT_FIREBASE_CONFIG:Yt,getFirebaseConfig:fr};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=fr,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Yt}typeof mt<"u"&&mt.exports&&(mt.exports=ur,mt.exports.default=ur)});function $i(){if(he)return{...he};let o=xn()?.memoryCueFirebase;if(o&&typeof o.getFirebaseConfig=="function")return he=o.getFirebaseConfig(),{...he};if(typeof nr=="function")try{let s=pr();if(s){let c=typeof s.getFirebaseConfig=="function"?s.getFirebaseConfig:typeof s.default?.getFirebaseConfig=="function"?s.default.getFirebaseConfig:null;if(c)return he=c(),{...he}}}catch{}return o&&o.DEFAULT_FIREBASE_CONFIG?(he={...o.DEFAULT_FIREBASE_CONFIG},{...he}):(he={...Ui},{...he})}function xn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function br(){let r=xn(),o=r&&r.TimestampTrigger;return typeof o=="function"?o:null}function Ee(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!br()}function Hi(){if(typeof window>"u"||!window.location)return En;try{return new URL(En,window.location.href).href}catch{return En}}async function ke(){return Gt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Gt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Hi()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),Gt))}async function hr(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let o=await ke();if(!o)return!1;let s=new Set;navigator.serviceWorker.controller&&s.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(S=>{let T=o[S];T&&s.add(T)});let c=!1;return s.forEach(S=>{try{S.postMessage(r),c=!0}catch(T){console.warn("Failed posting message to service worker",T)}}),c}catch(o){return console.warn("Unable to reach service worker",o),!1}}async function Vt(){if(Ee())return!1;if(An)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(gt)try{return await gt}catch{}gt=(async()=>{let r=await ke();if(!r)return!1;let o=!1;if("periodicSync"in r)try{let s=await r.periodicSync.getTags();(!Array.isArray(s)||!s.includes(In))&&await r.periodicSync.register(In,{minInterval:15*60*1e3}),o=!0}catch(s){console.warn("Periodic background sync unavailable",s)}if(!o&&"sync"in r)try{await r.sync.register(In),o=!0}catch(s){console.warn("Background sync unavailable",s)}return o})();try{let r=await gt;return r&&(An=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),An=!1,!1}finally{gt=null}}async function Ln(r=[],{requestCheck:o=!1}={}){if(!Ee()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let s=await ke();if(!s)return;let c=await hr({type:yr.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(o&&await hr({type:yr.checkScheduledReminders}),!c&&typeof s.update=="function")try{await s.update()}catch{}}catch(s){console.warn("Failed syncing reminders with service worker",s)}}async function Cn(r,o){if(Ee())try{let s=o||await ke();if(!s)return;let c=[];try{c=await s.getNotifications({tag:r,includeTriggered:!0})}catch{c=await s.getNotifications({tag:r})}for(let S of c)try{S.close()}catch{}}catch{}}function wr(){for(let r of Array.from(ve.values()))try{r.close()}catch{}ve.clear()}function ji(){if(gr||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>wr();["pagehide","beforeunload"].forEach(o=>{try{window.addEventListener(o,r)}catch{}}),gr=!0}function K(r){if(typeof r=="string"){let o=r.replace(/\s+/g," ").trim();if(o)return o}return J}async function co(r={}){let o=e=>e?document.querySelector(e):null,s=e=>e?Array.from(document.querySelectorAll(e)):[],c=o(r.titleSel),S=o(r.dateSel),T=o(r.timeSel),L=o(r.detailsSel),W=o(r.prioritySel),C=o(r.categorySel),z=o(r.saveBtnSel),ee=o(r.cancelEditBtnSel),E=o(r.listSel),te=s(r.googleSignInBtnSel),X=s(r.googleSignOutBtnSel),I=o(r.statusSel),F=o(r.syncStatusSel),We={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Ie=6e3,Y=null;function oe(e,{clearMessage:t=!0}={}){Y&&(e&&Y.tokenId!==e||(Y.timeoutId&&clearTimeout(Y.timeoutId),t&&I&&I.dataset.undoToken===Y.tokenId&&(typeof I.replaceChildren=="function"?I.replaceChildren():I.textContent="",delete I.dataset.undoToken,delete I.dataset.statusKind),Y=null))}function P(e){if(!I)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Ii(e.tokenId)),e.button=i,typeof I.replaceChildren=="function"?I.replaceChildren(t,n,i):(I.textContent="",I.append(t,n,i)),I.dataset.statusKind="undo",I.dataset.undoToken=e.tokenId}function Ye(e,t){if(!F)return;let n=["online","offline","error"];n.forEach(d=>F.classList.remove(d)),n.includes(e)&&F.classList.add(e),F.dataset.state=e;let i=typeof t=="string"?t:We[e]||"";e==="online"||e==="offline"?(F.textContent="",F.dataset.compact="true",i?(F.setAttribute("aria-label",i),F.setAttribute("title",i)):(F.removeAttribute("aria-label"),F.removeAttribute("title"))):(F.textContent=i,F.removeAttribute("data-compact"),i?(F.setAttribute("aria-label",i),F.setAttribute("title",i)):(F.removeAttribute("aria-label"),F.removeAttribute("title")))}let $=o(r.notesSel),Cr=o(r.saveNotesBtnSel),xr=o(r.loadNotesBtnSel),Nn=o(r.countTotalSel),yt=o(r.googleUserNameSel),Fe=o(r.dateFeedbackSel),ae=o(r.voiceBtnSel),Dr=o(r.notifBtnSel),Ge=o(r.moreBtnSel),Ve=o(r.moreMenuSel),Nr=o(r.copyMtlBtnSel),Zt=o(r.importFileSel),kr=o(r.exportBtnSel),Fr=o(r.syncAllBtnSel),_e=o(r.syncUrlInputSel),Rr=o(r.saveSettingsSel),Br=o(r.testSyncSel),Or=s(r.openSettingsSel),ht=o(r.settingsSectionSel),Pe=o(r.emptyStateSel),kn=o(r.listWrapperSel),en=o(r.categoryOptionsSel),ne=o(r.plannerContextSel),j=o(r.plannerLessonInputSel),Ae=r.variant||"mobile",Mr=typeof r.autoWireAuthButtons=="boolean"?r.autoWireAuthButtons:Ae!=="desktop",Fn="mc:lastDefaults",tn=()=>{ne&&(ne.classList.add("hidden"),ne.setAttribute("aria-hidden","true"),typeof ne.replaceChildren=="function"?ne.replaceChildren():ne.textContent=""),j&&(j.value="",j.dataset&&(delete j.dataset.lessonDayLabel,delete j.dataset.lessonTitle,delete j.dataset.lessonSummary))},_r=(e={})=>{if(!ne)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",a=document.createElement("p");a.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",a.textContent=t?`${t} lesson`:"Planner lesson";let d=document.createElement("p");d.className="text-sm font-semibold text-base-content",d.textContent=n||i||"Planner reminder";let l=i?document.createElement("p"):null;l&&(l.className="text-sm text-base-content/70",l.textContent=i),typeof ne.replaceChildren=="function"?ne.replaceChildren(...[a,d,l].filter(Boolean)):(ne.textContent="",ne.append(a,d),l&&ne.append(l)),ne.classList.remove("hidden"),ne.removeAttribute("aria-hidden")},Pr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";c&&typeof e.reminderTitle=="string"&&(c.value=e.reminderTitle),L&&typeof e.reminderNotes=="string"&&(L.value=e.reminderNotes),S&&typeof e.dueDate=="string"&&(S.value=e.dueDate),j&&(j.value=t,j.dataset&&(j.dataset.lessonDayLabel=dayLabel,j.dataset.lessonTitle=lessonTitle,j.dataset.lessonSummary=summary)),_r(e)};function nn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Fn)||"{}")||{}}catch{return{}}}function Ur(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Fn,JSON.stringify(e))}catch{}}function Rn(e){let t=nn(),n={category:K(e?.category||t.category||J),priority:e?.priority||t.priority||"Medium"};Ur(n)}let Bn='fieldset#priorityChips input[name="priority"]';function rn(){try{let e=document.querySelector(`${Bn}:checked`);if(e&&e.value)return e.value}catch{}return W&&typeof W.value=="string"&&W.value?W.value:"Medium"}function bt(e){let t=e||"Medium";W&&typeof W.value<"u"&&(W.value=t);try{let n=Array.from(document.querySelectorAll(Bn));if(!n.length)return;let i=!1;if(n.forEach(a=>{let d=a.value===t;a.checked=d,i=i||d}),!i){let a=n.find(d=>d.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function On(){let e=nn();e.category&&C&&(C.value=e.category),e.priority&&bt(e.priority)}On();let se=typeof document<"u"?document.getElementById("quickAddInput"):null,$r=typeof document<"u"?document.getElementById("quickAddSubmit"):null,de=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,on=null;function Hr(e,t){let n=Date.now(),i=nn(),a=typeof t=="string"&&t?t:null;return{id:Ot(),title:(e||"").trim(),priority:i.priority||rn(),category:K(i.category||C?.value||J),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!Q}}async function an(){if(!se)return;if(typeof on=="function")try{on()}catch{}let e=(se.value||"").trim();if(!e)return;let t=null;try{let a=Pt(e);a&&a.time&&(t=new Date(`${a.date}T${a.time}:00`).toISOString())}catch{t=null}let n=Hr(e,t);fn(n,{position:"start"}),u.unshift(n),le(u);let i=nt(u);Re=!0,G(),Z(),i?u.forEach(a=>re(a)):re(n),it(n),Oe(n),Ce(),Rn(n),qe();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}pe({action:"created",label:`Reminder added \xB7 ${n.title}`}),se.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=an),$r?.addEventListener("click",()=>{an()}),se?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),an())});function jr(){if(typeof HTMLElement>"u"||!(de instanceof HTMLElement)||!(se instanceof HTMLInputElement)||de.dataset.voiceBound==="true")return;if(de.dataset.voiceBound="true",typeof window>"u"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true"),de.getAttribute("title")||(de.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=l=>{n=l,de.setAttribute("aria-pressed",l?"true":"false"),de.dataset.listening=l?"true":"false",de.classList.toggle("is-listening",l)},a=()=>{if(t)return t;t=new e;let l=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=l,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",y=>{let f=y?.results?.[0]?.[0]?.transcript?.trim()||"";if(f){se.value=f;try{se.focus({preventScroll:!0})}catch{se.focus()}try{let w=se.value.length;typeof se.setSelectionRange=="function"&&se.setSelectionRange(w,w)}catch{}}});let p=()=>{i(!1)};return t.addEventListener("end",p),t.addEventListener("error",p),t},d=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};on=d,de.addEventListener("click",()=>{let l=a();if(l){if(n){d();return}try{l.start(),i(!0)}catch(p){console.warn("Quick add voice error:",p),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",d),i(!1)}jr(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&se&&(e.preventDefault(),se.focus())})));try{Ae==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Wr=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Mn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Yr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",wt=r.reminderLandingPath||(Ae==="desktop"?"index.html#reminders":"mobile.html"),be=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function _n(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function qe(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}C&&!C.value&&(C.value=J),Ee()&&ke();function pe(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(mr,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(mr,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function Gr(){if(typeof HTMLElement>"u"||!(ae instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&c instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&c instanceof HTMLTextAreaElement;if(!e&&!t||ae.dataset.voiceBound==="true")return;if(ae.dataset.voiceBound="true",typeof window>"u"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true"),ae.getAttribute("title")||(ae.title="Voice input is not supported in this browser.");return}let i=null,a=!1,d=f=>{a=f,ae.setAttribute("aria-pressed",f?"true":"false"),ae.dataset.listening=f?"true":"false",ae.classList.toggle("is-listening",f)},l=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",w=>{let x=w.results?.[0]?.[0]?.transcript?.trim()||"";if(x){c.value=x;try{c.focus({preventScroll:!0})}catch{try{c.focus()}catch{}}try{let D=c.value.length;typeof c.setSelectionRange=="function"&&c.setSelectionRange(D,D)}catch{}pe({action:"dictated",label:`Voice input captured \xB7 ${x}`})}});let f=()=>{d(!1)};return i.addEventListener("end",f),i.addEventListener("error",f),i},p=()=>{if(!(!a||!i)){try{i.stop()}catch{}d(!1)}};ae.addEventListener("click",()=>{let f=l();if(f){if(a){p();return}try{f.start(),d(!0)}catch(w){console.warn("Speech recognition error:",w),d(!1)}}});let y=()=>{p()};typeof document<"u"&&(document.addEventListener("cue:close",y),document.addEventListener("reminders:updated",y)),d(!1)}ji(),Gr();let St,vt,Et,It,Ue,At,Tt,Lt,Ct,xt,Dt,ze,Xe,Nt,kt,sn,dn,Ft,cn,Pn=r.firebaseDeps,ln=typeof r.importModule=="function"?r.importModule:e=>import(e),Ke=xn(),Je=!1,me=!1,un=null,we=null,Qe=null,u=[],Re=!1,Q=null,Ze=null,et=null,Be={},V={};function le(e=u){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,a=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===a?Yn(t||{},n||{}):a-i})}function Vr(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let a=Number.isFinite(i?.orderIndex)?i.orderIndex:null;a!=null&&(a<t&&(t=a),a>n&&(n=a))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function tt(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),le(n);else{n=e.slice().sort(Yn);let i=n.length;n.forEach((a,d)=>{a.orderIndex=(i-d)*ye})}return e===u&&(u=n),n}function fn(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Vr();if(t==="end"){let a=Number.isFinite(n)?n:0;e.orderIndex=a-ye||ye}else{let a=Number.isFinite(i)?i:0;e.orderIndex=a+ye||ye}}function nt(e=u){if(!Array.isArray(e)||e.length<2)return!1;le(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],a=e[n],d=Number.isFinite(i?.orderIndex)?i.orderIndex:null,l=Number.isFinite(a?.orderIndex)?a.orderIndex:null;if(d==null||l==null||d<=l||d-l<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*ye;return e===u&&le(u),!0}let R={draggingId:null,dropTargetId:null,dropBefore:!0},Un=!1,m={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function qr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function rt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Te(){E&&(E.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),E.classList.remove("drag-over-list"))}function pn(){if(!E)return;let e=E.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Te(),R.draggingId=null,R.dropTargetId=null,R.dropBefore=!0}function $n(e,t,n){if(!e||e===t)return;let i=u.findIndex(D=>D?.id===e);if(i<0)return;let[a]=u.splice(i,1),d;if(!t)d=u.length;else{let D=u.findIndex(q=>q?.id===t);if(D<0){u.splice(i,0,a);return}d=n?D:D+1}u.splice(d,0,a);let l=u[d-1],p=u[d+1],y=Number.isFinite(l?.orderIndex)?l.orderIndex:null,f=Number.isFinite(p?.orderIndex)?p.orderIndex:null,w;y!=null&&f!=null?w=(y+f)/2:y!=null?w=y-ye:f!=null?w=f+ye:w=ye,Number.isFinite(w)||(w=ye*(u.length+1)),a.orderIndex=w,le(u);let x=nt(u);Re=!0,G(),Z(),x?u.forEach(D=>re(D)):re(a),qe(),be("memoryCue:remindersUpdated",{items:u}),pe({action:"reordered",label:"Reminders reordered"})}function zr(e){let t=rt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(R.draggingId=i,R.dropTargetId=null,R.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Xr(e){if(!R.draggingId)return;let t=rt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),R.dropTargetId=null,R.dropBefore=!1,Te(),E?.classList.add("drag-over-list");return}if(t.dataset.id===R.draggingId){e.preventDefault(),Te();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,a=e.clientY<i;(R.dropTargetId!==t.dataset.id||R.dropBefore!==a)&&(Te(),t.classList.add(a?"drag-over-before":"drag-over-after"),R.dropTargetId=t.dataset.id,R.dropBefore=a)}function Kr(e){let t=rt(e.target);if(!t){E?.contains(e.relatedTarget)||Te();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),E?.contains(e.relatedTarget)||E?.classList.remove("drag-over-list"))}function Jr(e){if(!R.draggingId)return;e.preventDefault();let t=rt(e.target),n=t?.dataset.id||null,i=R.dropBefore;if(t){let a=t.getBoundingClientRect(),d=a.top+a.height/2;i=e.clientY<d}else n=null,i=!1;$n(R.draggingId,n,i),pn()}function Qr(){pn()}function Zr(){!E||Un||(Un=!0,E.addEventListener("dragstart",zr),E.addEventListener("dragover",Xr),E.addEventListener("drop",Jr),E.addEventListener("dragend",Qr),E.addEventListener("dragleave",Kr),Rt())}function Rt(){if(!E||Rt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Rt._bound=!0;return}let t=6,n=160;function i(){m.longPressTimer&&(clearTimeout(m.longPressTimer),m.longPressTimer=null)}function a(){E&&(m.initialTouchAction!=null?E.style.touchAction=m.initialTouchAction:E.style.removeProperty("touch-action"))}function d({keepHighlights:v=!1}={}){if(i(),m.item&&m.pointerId!=null)try{m.item.hasPointerCapture?.(m.pointerId)&&m.item.releasePointerCapture(m.pointerId)}catch{}if(m.placeholder?.parentNode)try{m.placeholder.parentNode.removeChild(m.placeholder)}catch{}m.item&&(m.item.classList.remove("is-dragging"),m.originalStyles?m.item.setAttribute("style",m.originalStyles):m.item.removeAttribute("style")),a(),v||Te(),Object.assign(m,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function l(v){return E?Array.from(E.querySelectorAll("[data-reminder-item]")).filter(h=>h!==v):[]}function p(v){let h=m.item;if(!h||m.ready)return;let N=h.getBoundingClientRect(),U=window.getComputedStyle(h);m.ready=!0,R.draggingId=h.dataset.id||null,m.offsetY=v.clientY-N.top,m.fixedX=N.left;let B=document.createElement("div");B.className="touch-drag-placeholder",B.setAttribute("aria-hidden","true"),B.style.height=`${N.height}px`,B.style.boxSizing="border-box",B.style.marginTop=U.marginTop,B.style.marginBottom=U.marginBottom,B.style.marginLeft=U.marginLeft,B.style.marginRight=U.marginRight,B.style.borderRadius=U.borderRadius,B.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",B.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",B.style.pointerEvents="none",B.style.display="block",B.style.width="100%",h.parentNode?.insertBefore(B,h),m.placeholder=B,m.longPressTimer=null,m.originalStyles=h.getAttribute("style")||"",h.classList.add("is-dragging"),h.style.position="fixed",h.style.left=`${N.left}px`,h.style.top=`${N.top}px`,h.style.width=`${N.width}px`,h.style.zIndex="999",h.style.pointerEvents="none",h.style.touchAction="none",m.initialTouchAction=E.style.touchAction||"",E.style.touchAction="none"}function y(v){let h=m.item;if(!h||!m.ready)return;let N=v-m.offsetY;h.style.top=`${N}px`,h.style.left=`${m.fixedX}px`}function f(v){if(!m.ready||!E)return;let h=m.item,N=l(h);if(Te(),!N.length){R.dropTargetId=null,R.dropBefore=!1;return}let U=null,B=!1;for(let b of N){let O=b.getBoundingClientRect(),M=O.top+O.height/2;if(v<M){U=b,B=!0;break}}if(!U){U=N[N.length-1];let b=U.getBoundingClientRect(),O=b.top+b.height/2;B=v<O,B||(B=!1)}if(!U){R.dropTargetId=null,R.dropBefore=!1;return}let Me=U.getBoundingClientRect(),Ht=Me.top+Me.height/2,g=v<Ht;U.classList.add(g?"drag-over-before":"drag-over-after"),R.dropTargetId=U.dataset.id||null,R.dropBefore=g}function w(v){let h=R.draggingId,N=m.moved;if(!m.ready){d();return}d(),!v&&N&&h&&$n(h,R.dropTargetId,R.dropBefore),pn()}function x(v){let h=v.pointerType||"";if(h&&h!=="touch"&&h!=="pen"||m.active)return;let N=rt(v.target);if(!N)return;let U=qr(v.target);if(!(U&&U!==N)){m.active=!0,m.pointerId=v.pointerId,m.item=N,m.startX=v.clientX,m.startY=v.clientY,m.lastClientX=v.clientX,m.lastClientY=v.clientY,m.moved=!1,m.ready=!1,m.originalStyles=N.getAttribute("style")||"",m.startTime=v.timeStamp||Date.now(),R.dropTargetId=null,R.dropBefore=!0,R.draggingId=null,i(),m.longPressTimer=setTimeout(()=>{p({clientY:m.lastClientY})},n);try{N.setPointerCapture(v.pointerId)}catch{}}}function D(v){if(!m.active||v.pointerId!==m.pointerId)return;let h=v.pointerType||"";if(!(h&&h!=="touch"&&h!=="pen")){if(m.lastClientX=v.clientX,m.lastClientY=v.clientY,!m.ready){let N=Math.abs(v.clientX-m.startX),U=Math.abs(v.clientY-m.startY);if(N>t||U>t){let B=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(B-m.startTime)>=n?(i(),p({clientY:m.lastClientY})):d()}return}v.preventDefault(),m.moved=!0,y(v.clientY),f(v.clientY)}}function q(v){!m.active||v.pointerId!==m.pointerId||w(!1)}function fe(v){!m.active||v.pointerId!==m.pointerId||w(!0)}E.addEventListener("pointerdown",x),window.addEventListener("pointermove",D),window.addEventListener("pointerup",q),window.addEventListener("pointercancel",fe),Rt._bound=!0}function Hn(){Q=null,Ye("offline"),te.forEach(e=>e.classList.remove("hidden")),X.forEach(e=>e.classList.add("hidden")),yt&&(yt.textContent=""),Ze?.(),Ze=null,gn(),G(),Z(),Ce()}function mn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Tn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:i,d=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:Ot(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:K(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function ei(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Tn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:K(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null}));localStorage.setItem(Tn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function Z(){le(u),ei(u)}function gn(){u=tt(mn())}gn();async function ti(){if(!Q){u=mn();return}let e=tt(mn());if(!e.length){u=[],Z();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await re(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}u=tt(e.map(n=>({...n,pendingSync:!1}))),Z(),G(),Ce()}try{V=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{V={}}if(V&&typeof V=="object"&&Object.values(V).forEach(e=>{e&&typeof e=="object"&&(e.category=K(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:at(e),e.urlPath=e.urlPath||wt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Ee()){let e=Kn();typeof Notification<"u"&&Notification.permission==="granted"?(Vt(),e.length&&Ln(e,{requestCheck:!0})):e.length&&Ln(e)}let Bt=e=>{if(!Ke)return;let t=[Ke];Ke.window&&!t.includes(Ke.window)&&t.push(Ke.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function ni(){if(!$)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",d=()=>"value"in $?$.value:$.innerHTML,l=w=>{if("value"in $){$.value=w;return}if(typeof w!="string"||w.length===0){$.innerHTML="";return}let x=w.trim();if(/<\/?[a-z][\s\S]*>/i.test(x)){$.innerHTML=w;return}let q=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");$.innerHTML=q},p=w=>{w?$.classList.add("notes-editor--columns"):$.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!w))},y="";try{y=localStorage.getItem(n)||""}catch{A("Unable to access saved notes")}l(y);let f=!1;try{f=localStorage.getItem(i)==="1"}catch{f=!1}p(f),$.addEventListener("input",()=>{y=d();try{localStorage.setItem(n,y)}catch{A("Notes saved for this session only")}}),Cr?.addEventListener("click",()=>{y=d();try{localStorage.setItem(n,y),A("Notes saved")}catch{A("Notes saved for this session only")}}),xr?.addEventListener("click",()=>{let w=y;try{w=localStorage.getItem(n)||y}catch{A("Unable to load saved notes")}y=w,l(y)}),e?.addEventListener("click",w=>{let x=w.target;if(!(x instanceof Element))return;let D=x.closest("button[data-action]");if(!D)return;let q=D.getAttribute("data-action");if(q==="columns"){let fe=!$.classList.contains("notes-editor--columns");p(fe);try{localStorage.setItem(i,fe?"1":"0")}catch{A("Column preference saved for this session only")}return}if(!a){A("Formatting controls are not supported in this browser");return}$.focus(),q==="bullets"?document.execCommand("insertUnorderedList"):q==="numbers"&&document.execCommand("insertOrderedList")})}if(ni(),z?.addEventListener("click",Qn),Pn)({initializeApp:St,getFirestore:vt,enableMultiTabIndexedDbPersistence:Et,enableIndexedDbPersistence:It,doc:Ue,setDoc:At,deleteDoc:Tt,onSnapshot:Lt,collection:Ct,query:xt,orderBy:Dt,serverTimestamp:ze,getAuth:Xe,onAuthStateChanged:Nt,GoogleAuthProvider:kt,signInWithPopup:sn,signInWithRedirect:dn,getRedirectResult:Ft,signOut:cn}=Pn),Je=!0;else try{({initializeApp:St}=await ln("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:vt,enableMultiTabIndexedDbPersistence:Et,enableIndexedDbPersistence:It,doc:Ue,setDoc:At,deleteDoc:Tt,onSnapshot:Lt,collection:Ct,query:xt,orderBy:Dt,serverTimestamp:ze}=await ln("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Xe,onAuthStateChanged:Nt,GoogleAuthProvider:kt,signInWithPopup:sn,signInWithRedirect:dn,getRedirectResult:Ft,signOut:cn}=await ln("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Je=!0}catch(e){Je=!1,console.warn("Firebase modules failed to load:",e),A("Firebase failed to load; notes available offline"),Bt(!1)}if(Je&&typeof St=="function"&&typeof vt=="function"&&typeof Xe=="function")try{let e=$i();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),un=St(e),we=vt(un),me=!0,console.info("[Firebase] Firestore initialised",e.projectId),Bt(!0)}catch(e){me=!1,console.warn("Firebase initialization failed:",e),A("Firebase failed to load; notes available offline"),Bt(!1)}else Je?(me=!1,Bt(!1)):me=!1;me&&typeof Et=="function"&&typeof It=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Et(we),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await It(we),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),me&&typeof Xe=="function"&&(Qe=Xe(un));function ri(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let ii=typeof navigator<"u"&&navigator.language?navigator.language:"",jn=ri(ii),$e=jn||"en-US",Se="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Se=e.timeZone),!jn&&e.locale&&($e=e.locale)}catch{}let oi=new Intl.DateTimeFormat($e,{timeZone:Se,hour:"2-digit",minute:"2-digit"}),ai=new Intl.DateTimeFormat($e,{timeZone:Se,weekday:"long",day:"numeric",month:"long"}),si=new Intl.DateTimeFormat("en-CA",{timeZone:Se,year:"numeric",month:"2-digit",day:"2-digit"}),di=new Intl.DateTimeFormat($e,{timeZone:Se,weekday:"long"}),ci=new Intl.DateTimeFormat($e,{timeZone:Se,month:"short",day:"numeric"});function Le(e){let t=si.formatToParts(e),n=t.find(d=>d.type==="year").value,i=t.find(d=>d.type==="month").value,a=t.find(d=>d.type==="day").value;return`${n}-${i}-${a}`}function Wn(e,t){let[n,i,a]=e.split("-").map(y=>parseInt(y,10)),[d,l]=t.split(":").map(y=>parseInt(y,10)),p=new Date;return p.setFullYear(n,(i||1)-1,a||1),p.setHours(d||0,l||0,0,0),p.toISOString()}let li=new Intl.DateTimeFormat("en-CA",{timeZone:Se,year:"numeric",month:"2-digit",day:"2-digit"}),ui=new Intl.DateTimeFormat("en-CA",{timeZone:Se,hour:"2-digit",minute:"2-digit",hour12:!1});function fi(e){try{let t=new Date(e),n=li.formatToParts(t),i=n.find(l=>l.type==="year")?.value||"0000",a=n.find(l=>l.type==="month")?.value||"00",d=n.find(l=>l.type==="day")?.value||"00";return`${i}-${a}-${d}`}catch{return""}}function pi(e){try{let t=new Date(e),n=ui.formatToParts(t),i=n.find(d=>d.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(d=>d.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${a}`}catch{return""}}function Ot(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Mt(){return Le(new Date)}function mi(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Qi(e){let t=mi(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function _t(e){return e==="High"?3:e==="Medium"?2:1}function Yn(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let a=e?.due?new Date(e.due).getTime():1/0,d=t?.due?new Date(t.due).getTime():1/0;if(a!==d)return a-d;let l=_t(t?.priority)-_t(e?.priority);return l||(t?.updatedAt||0)-(e?.updatedAt||0)}function Zi(e,t){let n=_t(t.priority)-_t(e.priority);if(n)return n;let i=+new Date(e.due||0),a=+new Date(t.due||0);return i!==a?i-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Gn(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return ai.format(t)}catch{return e}}function yn(e){return oi.format(e)}function gi(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function eo(e){return e?gi(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function A(e){I&&(oe(),I.dataset.statusKind="toast",I.textContent=e,clearTimeout(A._t),A._t=setTimeout(()=>{I&&I.dataset.statusKind==="toast"&&(I.textContent="",delete I.dataset.statusKind)},2500))}function yi(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Pt(e){e=String(e||"").toLowerCase();let t={date:Mt(),time:""},n=p=>{let y=new Date,f=y.getDay(),w=(p-f+7)%7,x=new Date(y);return x.setDate(y.getDate()+(w===0?7:w)),x},i=p=>{let y=new Date,f=y.getDay(),w=(p-f+7)%7,x=new Date(y);return x.setDate(y.getDate()+w),x},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},d={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let p=new Date;p.setDate(p.getDate()+1),t.date=Le(p)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[p[1]],f=n(y);t.date=Le(f)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[p[1]],f=i(y);t.date=Le(f)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[p[1]],f=n(y);t.date=Le(f)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let p=e.match(/\bin\s+(\d+)\s+days?\b/),y=parseInt(p[1],10),f=new Date;f.setDate(f.getDate()+y),t.date=Le(f)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let p=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),y=parseInt(p[1],10),f=parseInt(p[2],10)-1,w=p[3]?parseInt(p[3],10):new Date().getFullYear(),x=new Date(w,f,y);t.date=Le(x)}else for(let[p,y]of Object.entries(d)){let f=new RegExp(`\\b${p}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(f.test(e)){let w=e.match(f),x=parseInt(w[1],10),D=new Date().getFullYear(),q=new Date(D,y,x);t.date=Le(q);break}}let l=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(l){let p=parseInt(l[1],10),y=l[2]?parseInt(l[2],10):0,f=l[3];f&&(f==="pm"&&p<12&&(p+=12),f==="am"&&p===12&&(p=0)),t.time=`${String(p).padStart(2,"0")}:${String(y).padStart(2,"0")}`}return t}let hn=me&&Qe&&typeof kt=="function";or({authReady:hn,auth:Qe,GoogleAuthProvider:kt,signInWithPopup:sn,signInWithRedirect:dn,signOut:cn,toast:A});let Vn=Mr,qn=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(a=>{console.error("Auth handler error:",a)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Vn&&te.length&&te.forEach(e=>qn(e,ar)),hn&&typeof Ft=="function"&&Ft(Qe).catch(()=>{}),Vn&&X.length&&X.forEach(e=>qn(e,sr)),hn&&typeof Nt=="function"?Nt(Qe,async e=>{e?(Q=e.uid,Ye("online"),te.forEach(t=>t.classList.add("hidden")),X.forEach(t=>t.classList.remove("hidden")),yt&&(yt.textContent=e.displayName||e.email||""),hi(),await ti()):Hn()}):Hn();function hi(){if(!me||!we||typeof Ct!="function"||typeof xt!="function"||typeof Dt!="function"||typeof Lt!="function")return;if(!Q){gn(),G(),Z(),Ce();return}Ze&&Ze();let e=Ct(we,"users",Q,"reminders"),t=xt(e,Dt("updatedAt","desc"));Ze=Lt(t,n=>{let i=[];n.forEach(a=>{let d=a.data(),l=Number(d.orderIndex),p=typeof d.plannerLessonId=="string"&&d.plannerLessonId?d.plannerLessonId:null;i.push({id:a.id,title:d.title,priority:d.priority,notes:d.notes||"",done:!!d.done,due:d.due||null,category:K(d.category),createdAt:d.createdAt?.toMillis?.()||0,updatedAt:d.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(l)?l:null,plannerLessonId:p})}),u=tt(i),G(),Z(),Ce()},n=>{console.error("Firestore sync error:",n),F&&Ye("error","Sync Error")})}async function re(e){if(!(!me||!Q||!we||typeof Ue!="function"||typeof At!="function"||typeof ze!="function"))try{await At(Ue(we,"users",Q,"reminders",e.id),{ownerUid:Q,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||J,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,createdAt:e.createdAt?new Date(e.createdAt):ze(),updatedAt:ze()},{merge:!0})}catch(t){console.error("Save failed:",t),A("Save queued (offline)")}}async function bi(e){if(!(!me||!Q||!we||typeof Ue!="function"||typeof Tt!="function"))try{await Tt(Ue(we,"users",Q,"reminders",e))}catch{A("Delete queued (offline)")}}async function it(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||J,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function ot(){c&&(c.value=""),S&&(S.value=""),T&&(T.value=""),L&&(L.value=""),bt("Medium"),C&&(C.value=J),On(),et=null,z&&(z.textContent="Save"),ee?.classList.add("hidden"),tn()}function wi(e){let t=u.find(n=>n.id===e);t&&(c&&(c.value=t.title||""),S&&T&&(t.due?(S.value=fi(t.due),T.value=pi(t.due)):(S.value="",T.value="")),bt(t?.priority||"Medium"),C&&(C.value=K(t.category)),L&&(L.value=typeof t.notes=="string"?t.notes:""),j&&(j.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),tn(),et=e,z&&(z.textContent="Update"),ee?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),c?.focus(),be("cue:open",{mode:"edit"}))}function Si(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=K(e.category??(C?C.value:"")),a={id:Ot(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!Q,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null};fn(a,{position:"start"}),u=[a,...u],le(u);let d=nt(u);return Re=!0,G(),Z(),Rn(a),d?u.forEach(l=>re(l)):re(a),it(a),Oe(a),qe(),be("memoryCue:remindersUpdated",{items:u}),_n(),pe({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function vi(e,t){if(!Q)return A("Sign in to add notes"),null;if(!e)return null;let n=u.find(l=>l.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let d=typeof n.notes=="string"?n.notes:"";return n.notes=d?`${d}
${a}`:a,n.updatedAt=Date.now(),re(n),G(),Z(),pe({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Ei(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),re(t),it(t),G(),Z(),t.done?($t(e),pe({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Oe(t),pe({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Ii(e){if(!Y||Y.tokenId!==e)return;let{item:t,index:n}=Y;if(!t){oe(e);return}oe(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!Q,t.updatedAt=Date.now(),u.splice(i,0,t),le(u);let a=nt(u);Re=!0,G(),Z(),Oe(t),a?u.forEach(d=>re(d)):re(t),it(t),qe(),be("memoryCue:remindersUpdated",{items:u}),pe({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),A("Reminder restored")}function zn(e){let t=u.findIndex(a=>a.id===e),n=t>=0?u.splice(t,1)[0]:null;G(),Z(),bi(e),$t(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(pe({action:"deleted",label:i}),n&&I){oe();let a=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;Y={tokenId:a,item:n,index:t,timeoutId:null},P(Y),Y.timeoutId=setTimeout(()=>{oe(a)},Ie)}else n&&oe()}function Ai(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,a=800,d='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',l=null,p=!1,y=0,f=0,w=0,x=()=>{if(p){if(p=!1,l!=null&&e.hasPointerCapture?.(l))try{e.releasePointerCapture(l)}catch{}l=null,e.removeEventListener("pointermove",q),e.removeEventListener("pointerup",fe),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",fe),window.removeEventListener("pointercancel",v)}},D=h=>{if(h.pointerType==="mouse"&&h.button!==0)return;p&&x();let N=h.target;N instanceof Element&&N.closest(d)||(l=h.pointerId,y=h.clientX,f=h.clientY,w=typeof h.timeStamp=="number"?h.timeStamp:Date.now(),p=!0,e.addEventListener("pointermove",q),e.addEventListener("pointerup",fe),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",fe),window.addEventListener("pointercancel",v))},q=h=>{if(!p||h.pointerId!==l)return;Math.abs(h.clientY-f)>i&&x()},fe=h=>{if(!p||h.pointerId!==l)return;let N=h.clientX-y,U=Math.abs(h.clientY-f),B=(typeof h.timeStamp=="number"?h.timeStamp:Date.now())-w;if(x(),N<=-n&&U<=i&&B<=a){h.preventDefault(),h.stopPropagation();try{t()}catch(Me){console.warn("Swipe delete handler failed",Me)}}},v=h=>{p&&(typeof h.pointerId=="number"&&h.pointerId!==l||x())};e.addEventListener("pointerdown",D)}function at(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let a=yn(i);if(a)return`${n} \u2022 ${a}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let a=yn(i);if(a)return`Due ${a}`}}catch{}return"Due now"}function Xn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}A("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Kn(){return Object.values(V||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||J,notes:typeof e.notes=="string"?e.notes:"",body:at(e),urlPath:e.urlPath||wt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function bn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(V))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Kn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Vt(),Ln(e,{requestCheck:t})}function Ut(e,{closeNotification:t=!0}={}){if(t){let n=ve.get(e);if(n){try{n.close()}catch{}ve.delete(e)}}Be[e]&&(clearTimeout(Be[e]),delete Be[e]),Cn(e),V[e]&&(delete V[e],bn())}function $t(e){Ut(e)}function Jn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ve.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:at(e),tag:e.id});ve.set(e.id,n);let i=()=>{ve.get(e.id)===n&&ve.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Ti(e){if(!Ee())return!1;let t=br();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await ke();if(!i)return!1;await Cn(e.id,i);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||J,body:d,urlPath:wt},d=at(e),l={body:d,tag:e.id,data:a,renotify:!0};n>Date.now()&&(l.showTrigger=new t(n));try{return await i.showNotification(e.title,l),!0}catch(p){return console.warn("Failed to schedule persistent notification",p),!1}}function Oe(e){if(!e||!e.id)return;if(e.category=K(e.category),!e.due||e.done){$t(e.id);return}let t=V[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||J,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:at(e),urlPath:wt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let l=typeof t.due=="string"?t.due:null,p=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return l===e.due?p:null})()};if(V[e.id]=n,bn(),Be[e.id]&&(clearTimeout(Be[e.id]),delete Be[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let a=i-Date.now();if(a<=0){if(V[e.id]?.viaTrigger){Ut(e.id,{closeNotification:!1});return}Jn(e),Ut(e.id,{closeNotification:!1});return}let d=Ee();d&&(n.viaTrigger=!1,Ti(e).then(l=>{l&&V[e.id]&&(V[e.id]={...V[e.id],viaTrigger:!0},bn())})),Be[e.id]=setTimeout(()=>{d&&Cn(e.id),Jn(e),Ut(e.id,{closeNotification:!1})},a)}function Ce(){Object.values(V).forEach(e=>Oe({...e,category:K(e?.category)}))}function Li(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=di.format(t),i=ci.format(t),a=yn(t);return`${n}, ${i}${a?` at ${a}`:""}`}catch{return"No due date"}}function G(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),Te(),le(u),Nn)try{Nn.textContent=String(u.length)}catch{}u.forEach(g=>{g&&typeof g=="object"&&(g.category=K(g.category))});let a=new Set(Pi.map(g=>K(g)));u.forEach(g=>{g&&typeof g=="object"&&a.add(K(g.category))});let d=Array.from(a).sort((g,b)=>g.localeCompare(b,void 0,{sensitivity:"base"}));if(en){let g=new Set;Array.from(en.querySelectorAll("option")).forEach(b=>{g.add(b.value.trim().toLowerCase())}),d.forEach(b=>{let O=b.toLowerCase();if(!g.has(O)){let M=document.createElement("option");M.value=b,en.appendChild(M),g.add(O)}})}if(Re)Re=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let g=u.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:g}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:g}),document.dispatchEvent(b))}}catch{}}let l=u.slice();le(l);let p=!0,y=u.length>0,f=l.length>0,w=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let g=Object.values(V||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(g.map(b=>b.id))})();if(Pe)if(f)Pe.classList.add("hidden");else{let g=y?"No reminders to show right now.":Wr;Mn?Mn(Pe,{icon:y?"sparkles":"bell",title:y?"Nothing to display":"Create your first cue",description:g,action:y?void 0:`<button type="button" class="${Yr}" data-trigger="open-cue">Create reminder</button>`}):Pe.textContent=g,Pe.classList.remove("hidden")}if(kn&&kn.classList.toggle("has-items",f),!E)return;if(!f){Pe?(E.innerHTML="",E.classList.add("hidden")):(E.innerHTML='<div class="text-muted">No reminders found.</div>',E.classList.remove("hidden"));return}E.classList.remove("hidden"),E.replaceChildren();let x=document.createDocumentFragment(),D=E.tagName==="UL"||E.tagName==="OL",q=!0,fe=["priority-high","priority-medium","priority-low"],v=(g,b)=>{if(!(g instanceof HTMLElement))return;g.classList.remove(...fe);let O=typeof b=="string"?b.trim().toLowerCase():"";O.startsWith("h")?g.classList.add("priority-high"):O.startsWith("m")?g.classList.add("priority-medium"):O.startsWith("l")&&g.classList.add("priority-low")},h=(g,b="neutral")=>{let O=document.createElement("span");O.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",O.title=g,O.dataset.tone=b;let M=document.createElement("span");M.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?M.classList.add("bg-error"):b==="priority-medium"?M.classList.add("bg-warning"):b==="priority-low"?M.classList.add("bg-secondary"):b==="category"?M.classList.add("bg-primary"):M.classList.add("bg-base-content","opacity-40");let _=document.createElement("span");return _.className="truncate",_.textContent=g,O.append(M,_),O},N=(g,b,{elementTag:O,isMobile:M})=>{let _={id:g.id,title:g.title,dueIso:g.due||null,priority:g.priority||"Medium",category:b,done:!!g.done},st="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Di="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",k=document.createElement(O);k.className=M?Di:st,k.dataset.id=_.id,k.dataset.category=_.category,k.dataset.title=_.title;let Zn=_.priority&&String(_.priority).trim();Zn?k.dataset.priority=Zn:delete k.dataset.priority,k.dataset.done=String(_.done),_.dueIso?k.dataset.due=_.dueIso:delete k.dataset.due,k.dataset.reminder=JSON.stringify(_),k.dataset.orderIndex=Number.isFinite(g.orderIndex)?String(g.orderIndex):"",k.dataset.reminderItem="true",k.dataset.compact="true",k.classList.add("reminder-draggable"),k.setAttribute("draggable","true"),k.setAttribute("role","button"),k.tabIndex=0,k.setAttribute("aria-label",`Edit reminder: ${g.title}`),v(k,_.priority),w.has(_.id)?k.dataset.notificationActive="true":delete k.dataset.notificationActive;let wn=_.dueIso?new Date(_.dueIso):null;p&&wn&&wn>=n&&wn<=i?(k.classList.add("is-today"),k.dataset.today="true"):(k.classList.remove("is-today"),delete k.dataset.today);let dt=document.createElement("div");dt.className="flex min-w-0 flex-1 flex-col gap-2",M&&dt.classList.add("text-sm","text-base-content");let xe=document.createElement("p");xe.className=M?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",xe.classList.add("desktop-reminder-title"),M||xe.classList.add("sm:text-[0.95rem]"),_.done&&xe.classList.add("line-through","text-base-content/60"),M&&(xe.dataset.reminderTitle="true"),xe.textContent=g.title;let jt=xe;M&&(jt=document.createElement("div"),jt.className="reminder-title-slot",jt.appendChild(xe)),dt.appendChild(jt);let ct=document.createElement("div");ct.className=M?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let Sn=Li(g),er=Sn&&Sn!=="No due date"?Sn:"";er&&ct.appendChild(h(er,"due")),!!(b&&b!==J)&&ct.appendChild(h(b,"category")),ct.children.length&&dt.appendChild(ct),k.appendChild(dt);let He=document.createElement("div");He.className="task-toolbar flex items-start gap-1",He.setAttribute("role","toolbar"),He.setAttribute("aria-label","Reminder actions"),M&&He.classList.add("flex-shrink-0");let ce=document.createElement("button");ce.type="button",ce.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn",_.done?(ce.classList.add("text-base-content/60"),ce.innerHTML='<span aria-hidden="true">\u21BA</span>',ce.setAttribute("aria-label",`Mark reminder as active: ${g.title}`)):(ce.classList.add("text-success"),ce.innerHTML='<span aria-hidden="true">\u2713</span>',ce.setAttribute("aria-label",`Mark reminder as done: ${g.title}`)),ce.setAttribute("aria-pressed",_.done?"true":"false"),ce.setAttribute("data-reminder-control","toggle"),ce.setAttribute("data-no-swipe","true"),ce.addEventListener("click",ie=>{ie.preventDefault(),ie.stopPropagation(),Ei(_.id)});let De=document.createElement("button");De.type="button",De.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn",De.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',De.setAttribute("aria-label",`Delete reminder: ${g.title}`),De.setAttribute("data-reminder-control","delete"),De.setAttribute("data-no-swipe","true"),De.addEventListener("click",ie=>{ie.preventDefault(),ie.stopPropagation(),zn(_.id)}),He.append(ce,De),k.appendChild(He);let tr=()=>wi(_.id);return k.addEventListener("click",ie=>{if(ie.defaultPrevented)return;let vn=ie.target;vn&&typeof vn.closest=="function"&&vn.closest("[data-reminder-control]")||tr()}),k.addEventListener("keydown",ie=>{ie.defaultPrevented||ie.target===k&&(ie.key==="Enter"||ie.key===" ")&&(ie.preventDefault(),tr())}),M&&Ai(k,()=>zn(_.id)),k},U=(g,b)=>N(g,b,{elementTag:"div",isMobile:!0});if(Ae!=="desktop"&&!q){l.forEach(g=>{let b=g.category||J;x.appendChild(U(g,b))}),E.appendChild(x);return}let B=new Map;l.forEach(g=>{let b=g.category||J;B.has(b)||B.set(b,[]),B.get(b).push(g)});let Me=Array.from(B.entries()).sort((g,b)=>g[0].localeCompare(b[0],void 0,{sensitivity:"base"})),Ht=!0;Me.forEach(([g,b])=>{if(g!==J){let O=document.createElement(D?"li":"div");O.dataset.categoryHeading=g,D&&(O.setAttribute("role","presentation"),O.style.listStyle="none"),O.className=Ae==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",Ht||(O.style.marginTop=Ae==="desktop"?"1.25rem":"1rem");let M=document.createElement("div");M.setAttribute("role","heading"),M.setAttribute("aria-level","3"),M.className=Ae==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let _=document.createElement("span");_.textContent=g;let st=document.createElement("span");st.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",st.textContent=`${b.length} ${b.length===1?"item":"items"}`,M.append(_,st),O.appendChild(M),x.appendChild(O)}b.forEach(O=>{if(Ae==="desktop"){let M=N(O,g,{elementTag:D?"li":"div",isMobile:!1});x.appendChild(M);return}x.appendChild(U(O,g))}),Ht=!1}),E.appendChild(x)}function ge(){Ge?.setAttribute("aria-expanded","false"),Ve?.classList.add("hidden")}function Ci(){Ge?.setAttribute("aria-expanded","true"),Ve?.classList.remove("hidden")}Ge?.addEventListener("click",e=>{e.stopPropagation(),Ge.getAttribute("aria-expanded")==="true"?ge():Ci()}),document.addEventListener("click",e=>{Ve&&!Ve.classList.contains("hidden")&&!Ve.contains(e.target)&&e.target!==Ge&&ge()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ge()}),Or.forEach(e=>{e.addEventListener("click",()=>{let t=ht?.classList.contains("hidden");ht?.classList.toggle("hidden"),t&&ht?.scrollIntoView({behavior:"smooth",block:"start"}),ge()})}),document.addEventListener("DOMContentLoaded",()=>{ht?.classList.add("hidden")});function Qn(){try{console.log("handleSaveAction invoked",{editingId:et,title:c?.value})}catch{}let t=(typeof c?.value=="string"?c.value:"").trim(),n=typeof S?.value=="string"?S.value:"",i=typeof T?.value=="string"?T.value:"",a=typeof j?.value=="string"?j.value.trim():"";if(et){let f=u.find(D=>D.id===et);if(!f){ot();return}if(!t){A("Add a reminder title");return}let w=null;if(n||i){let D=n||Mt();w=Wn(D,i||"09:00")}else{let D=Pt(t);D.time&&(w=new Date(`${D.date}T${D.time}:00`).toISOString())}f.title=t;let x=rn();f.priority=x,bt(x),C&&(f.category=K(C.value)),f.due=w,L&&(f.notes=L.value.trim()),f.plannerLessonId=a||null,f.updatedAt=Date.now(),re(f),it(f),Re=!0,G(),Oe(f),Z(),qe(),be("memoryCue:remindersUpdated",{items:u}),_n(),pe({action:"updated",label:`Reminder updated \xB7 ${f.title}`}),ot(),A("Reminder updated"),be("cue:close",{reason:"updated"});return}if(!t){A("Add a reminder title");return}let d=L?L.value.trim():"",l=null;if(n||i){let f=n||Mt();l=Wn(f,i||"09:00")}else{let f=Pt(t);f.time&&(l=new Date(`${f.date}T${f.time}:00`).toISOString())}let p=a?{lessonId:a,dayLabel:j?.dataset?.lessonDayLabel||"",lessonTitle:j?.dataset?.lessonTitle||"",summary:j?.dataset?.lessonSummary||""}:null,y=Si({title:t,priority:rn(),category:C?C.value:"",due:l,notes:d,plannerLessonId:a||null});y&&(p?(A("Planner reminder created"),be("planner:reminderCreated",{lessonId:p.lessonId,dayLabel:p.dayLabel,lessonTitle:p.lessonTitle,summary:p.summary,reminderId:y.id,reminderTitle:y.title,reminderDue:y.due||null})):A("Reminder created")),c&&(c.value=""),T&&(T.value=""),L&&(L.value=""),tn(),be("cue:close",{reason:"created"})}c?.addEventListener("keydown",e=>{e.key==="Enter"&&Qn()});function xi(){if(!c||!Fe)return;let e=c.value.trim();if(!e){Fe.style.display="none";return}try{let t=Pt(e),n=Mt();if(t.date!==n||t.time){let i="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Gn(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Fe.textContent=`Parsed: ${i}`,Fe.style.display="block"):Fe.style.display="none"}else Fe.style.display="none"}catch{Fe.style.display="none"}}return c?.addEventListener("input",yi(xi,300)),ee?.addEventListener("click",()=>{ot(),A("Edit cancelled"),be("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{ot()}),document.addEventListener("cue:prepare",()=>{ot()}),document.addEventListener("planner:prefillReminder",e=>{Pr(e?.detail||{})}),window.addEventListener("load",()=>c?.focus()),Nr?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?Gn(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString($e,{hour:"2-digit",minute:"2-digit",timeZone:Se}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){A("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>A("Copied for Master Task List")).catch(()=>A("Copy failed")),ge()}),Zt?.addEventListener("change",()=>{let e=Zt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(d=>{let l={...d,id:Ot(),category:K(d.category),pendingSync:!Q,orderIndex:null};fn(l,{position:"start"}),u=[l,...u],i.push(l)}),le(u);let a=nt(u);G(),Z(),a?u.forEach(d=>re(d)):i.forEach(d=>re(d)),A("Import successful")}catch{A("Invalid JSON")}},t.readAsText(e),Zt.value="",ge()}),kr?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),ge()}),Fr?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){A("Add your Apps Script URL in Settings first"),ge();return}if(!u.length){A("No tasks to sync"),ge();return}A("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<u.length;i+=t){let a=u.slice(i,i+t),d=await Promise.allSettled(a.map(l=>{let p={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:l.category||J,done:!!l.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})}));n+=d.filter(l=>l.status==="rejected").length,await new Promise(l=>setTimeout(l,400))}A(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),ge()}),_e&&(_e.value=localStorage.getItem("syncUrl")||""),Rr?.addEventListener("click",()=>{_e&&(localStorage.setItem("syncUrl",_e.value.trim()),A("Settings saved"))}),Br?.addEventListener("click",async()=>{if(!_e)return;let e=_e.value.trim();if(!e){A("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});A(t.ok?"Test ok":"Test failed")}catch{A("Test failed")}}),Dr?.addEventListener("click",async()=>{if(!("Notification"in window)){A("Notifications not supported");return}if(Notification.permission==="granted"){A("Notifications enabled"),Ee()?ke():(Vt(),Xn()),Ce(),G();return}try{await Notification.requestPermission()==="granted"?(A("Notifications enabled"),Ee()?ke():(Vt(),Xn()),Ce(),G()):A("Notifications blocked")}catch{A("Notifications blocked")}}),Zr(),Ce(),G(),Z(),{cancelReminder:$t,scheduleReminder:Oe,closeActiveNotifications:wr,getActiveNotifications:()=>ve,addNoteToReminder:vi,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:K(t?.category)})):[],u=tt(u),le(u),G()},render:G,getItems:()=>u.map(e=>({...e}))}}}var mr,ve,gr,En,In,yr,Gt,gt,An,J,Pi,Tn,ye,Ui,he,Wi=Wt(()=>{cr();mr="memoryCue:activity",ve=new Map,gr=!1,En="service-worker.js",In="memory-cue-reminder-sync",yr=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Gt=null,gt=null,An=!1,J="General",Pi=Object.freeze([J,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Tn="memoryCue:offlineReminders",ye=1024,Ui=Object.freeze({}),he=null});var vr,Yi,Jt,Dn,Er,Ir,qt,Ar,Xt,zt,Sr,Gi,Tr,Kt,Lr=Wt(()=>{vr="memoryCueNotes",Yi=["mobileNotes"],Jt=()=>typeof localStorage<"u",Dn=null,Er=r=>{Dn=typeof r=="function"?r:null},Ir=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,qt=r=>{if(typeof r!="string")return"";let o=r.trim();if(!o.length)return"";if(!/[<>]/.test(o))return r;try{if(typeof document<"u"){let s=document.createElement("div");return s.innerHTML=o,(typeof s.innerText=="string"&&s.innerText.length?s.innerText:s.textContent||"").replace(/\r?\n/g,`
`)}}catch{}return o.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},Ar=r=>{if(typeof r!="string")return!1;let o=Date.parse(r);return!Number.isNaN(o)},Xt=(r,o,s={})=>{let c=typeof r=="string"?r.trim():"";return{id:s.id&&typeof s.id=="string"?s.id:Ir(),title:c||"Untitled note",body:typeof o=="string"?qt(o):"",updatedAt:s.updatedAt&&Ar(s.updatedAt)?s.updatedAt:new Date().toISOString()}},zt=r=>{if(Array.isArray(r))return r.map(o=>{if(!o||typeof o!="object")return null;let s=typeof o.title=="string"?o.title.trim():"",c=typeof o.body=="string"?qt(o.body):"",S=typeof o.id=="string"&&o.id.trim()?o.id:Ir(),T=Ar(o.updatedAt)?o.updatedAt:new Date().toISOString();return!s&&!c?null:{id:S,title:s||"Untitled note",body:c,updatedAt:T}}).filter(Boolean);if(r&&typeof r=="object"){let o=typeof r.title=="string"?r.title:"",s=typeof r.body=="string"?qt(r.body):"";return!o&&!s?[]:[Xt(o,s,{id:typeof r.id=="string"?r.id:void 0,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:void 0})]}return typeof r=="string"&&r.trim().length?[Xt("Notebook (legacy)",qt(r))]:[]},Sr=r=>{if(!Jt())return null;try{return localStorage.getItem(r)}catch{return null}},Gi=r=>{if(Jt())try{localStorage.removeItem(r)}catch{}},Tr=()=>{if(!Jt())return[];let r=Sr(vr);if(typeof r=="string")try{let o=JSON.parse(r),s=zt(o);if(s.length)return s}catch{let o=zt(r);if(o.length)return Kt(o),o}for(let o of Yi){let s=Sr(o);if(typeof s=="string"&&s.trim().length){let c=zt(s);if(c.length)return Kt(c),Gi(o),c}}return[]},Kt=(r,o={})=>{if(!Jt()||!Array.isArray(r))return!1;let s=r.map(c=>zt([c])[0]).filter(Boolean);try{if(localStorage.setItem(vr,JSON.stringify(s)),!o.skipRemoteSync&&typeof Dn=="function")try{let c=Dn(s);c&&typeof c.then=="function"&&c.catch(S=>{console.error("[notes-storage] Remote sync failed.",S)})}catch(c){console.error("[notes-storage] Remote sync handler threw.",c)}return!0}catch{return!1}}});var Vi,qi,zi,Qt,Xi,Ki,go,Ji=Wt(()=>{rr();Lr();Vi="notes",qi="user_id",zi="updated_at",Qt=r=>{if(typeof r!="string")return 0;let o=Date.parse(r);return Number.isNaN(o)?0:o},Xi=(r=[],o=[])=>{let s=new Map;return o.forEach(c=>{c&&typeof c.id=="string"&&s.set(c.id,c)}),r.forEach(c=>{if(!c||typeof c.id!="string")return;let S=s.get(c.id);if(!S){s.set(c.id,c);return}let T=Qt(c.updatedAt),L=Qt(S.updatedAt);T>L&&s.set(c.id,c)}),Array.from(s.values()).sort((c,S)=>Qt(S?.updatedAt)-Qt(c?.updatedAt))},Ki=r=>o=>{if(!o||typeof o!="object")return null;let s={id:typeof o.id=="string"&&o.id?o.id:void 0,updatedAt:typeof o[r]=="string"?o[r]:void 0};return Xt(o.title,o.body,s)},go=(r={})=>{let{tableName:o=Vi,userColumn:s=qi,updatedAtColumn:c=zi,supabase:S=null}=r,T=S||null,L=null,W=!1,C=new Set,z=()=>T||(T=je(),T),ee=Ki(c),E=async I=>{let F=z();if(!F||!L)return;let Ie=(Array.isArray(I)?I.filter(P=>P&&typeof P.id=="string"):[]).map(P=>({id:P.id,[s]:L,title:P.title,body:P.body,[c]:typeof P.updatedAt=="string"&&P.updatedAt?P.updatedAt:new Date().toISOString()})),Y=new Set(Ie.map(P=>P.id));if(Ie.length){let{error:P}=await F.from(o).upsert(Ie);if(P)throw P}let oe=[...C].filter(P=>P&&!Y.has(P));if(oe.length){let{error:P}=await F.from(o).delete().in("id",oe).eq(s,L);if(P)throw P}C=new Set(Y)},te=async()=>{let I=z();if(!(!I||!L))try{let{data:F,error:We}=await I.from(o).select(`id,title,body,${c}`).eq(s,L);if(We)throw We;let Ie=Array.isArray(F)?F:[];C=new Set(Ie.map($=>typeof $.id=="string"?$.id:null).filter(Boolean));let Y=Ie.map(ee).filter(Boolean),oe=Tr();if(!Y.length){if(oe.length)try{await E(oe)}catch($){console.error("[notes-sync] Failed to upload local notes to Supabase.",$)}return}let P=Xi(oe,Y);W=!0;let Ye=Kt(P,{skipRemoteSync:!0});W=!1,Ye||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await E(P)}catch($){console.error("[notes-sync] Failed to reconcile notes with Supabase.",$)}}catch(F){console.error("[notes-sync] Failed to fetch notes from Supabase.",F)}finally{W=!1}};return Er(async I=>{if(!W)try{await E(I)}catch(F){console.error("[notes-sync] Failed to sync notes to Supabase.",F)}}),{setSupabaseClient(I){I&&(T=I)},handleSessionChange:async I=>{if(L=typeof I?.id=="string"?I.id:null,!L){C=new Set;return}await te()},syncFromRemote:te}}});export{io as a,cr as b,co as c,Wi as d,vr as e,Xt as f,Tr as g,Kt as h,Lr as i,go as j,Ji as k};
