import{a as V,b as J,c as $,d as z,e as U,f as F,g as D,h as R,i as Y,j as G,k as Z}from"./chunk-K4LZ4PFQ.js";import{a as q,b as j}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{c as W}from"./chunk-GUVSRPRW.js";var Q=W(()=>{j();z();J();Y();Z();q();(function(){let t=()=>{let e=document.getElementById("create-sheet"),r=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(r instanceof HTMLElement)){let i=typeof t._retryCount=="number"?t._retryCount:0;i<10&&(t._retryCount=i+1,setTimeout(t,50));return}if(t._initialised)return;t._initialised=!0;let y=e.querySelector("[data-dialog-content]"),l=e.querySelector(".sheet-backdrop"),o=document.getElementById("createReminderForm"),c=document.getElementById("saveReminder"),g=document.getElementById("priority"),T=document.getElementById("priorityChips"),w=T?Array.from(T.querySelectorAll('input[name="priority"]')):[],B=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),s=Array.from(B).filter(i=>i instanceof HTMLElement),I=s[0]||null,k=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};k();let f=null,x=(i,A)=>{try{document.dispatchEvent(new CustomEvent(i,{detail:A}))}catch(v){console.warn(`${i} dispatch failed`,v)}},C=()=>{let i=g?.value||"Medium";w.forEach(A=>{let v=A.value===i;A.checked=v,A.setAttribute("aria-checked",v?"true":"false")})},d=i=>{g&&(g.value!==i&&(g.value=i,g.dispatchEvent(new Event("change",{bubbles:!0}))),C())};w.forEach(i=>{i.addEventListener("change",()=>{i.checked&&d(i.value)})}),g?.addEventListener("change",C),C();let a=()=>{let i=e.querySelector('input, textarea, select, button, [contenteditable="true"]');i instanceof HTMLElement&&setTimeout(()=>{try{i.focus()}catch{}},0)},h=i=>{f=i instanceof HTMLElement?i:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),f&&f.setAttribute("aria-expanded","true"),C(),a(),x("reminder:sheet-opened",{trigger:f})},p=(i="dismissed")=>{let A=!e.classList.contains("hidden");k(),f&&f.setAttribute("aria-expanded","false");let v=f&&document.body.contains(f)&&f||I;if(v&&typeof v.focus=="function")try{v.focus()}catch{}A&&x("reminder:sheet-closed",{reason:i,trigger:f}),f=null};s.forEach(i=>{i.addEventListener("click",A=>{A.preventDefault();let v={mode:"create",trigger:i};x("cue:prepare",v),x("cue:open",v)})}),r.addEventListener("click",i=>{i.preventDefault(),p("close-button")}),l?.addEventListener("click",i=>{i.target===l&&p("backdrop")}),e.addEventListener("keydown",i=>{i.key==="Escape"&&(i.stopPropagation(),p("escape"))}),y?.addEventListener("click",i=>{i.stopPropagation()}),e.addEventListener("click",i=>{i.target instanceof HTMLElement&&i.target.hasAttribute("data-close")&&p("backdrop")}),document.addEventListener("cue:open",i=>{C(),h(i?.detail?.trigger||null)}),document.addEventListener("cue:close",i=>{p(i?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{C()}),document.addEventListener("cue:cancelled",()=>{p("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=p),document.addEventListener("reminder:save",i=>{if(!(c instanceof HTMLElement))return;let A=i?.detail?.trigger;A&&A!==c||c.matches(":disabled")||c.click()}),o instanceof HTMLFormElement&&c instanceof HTMLElement&&o.addEventListener("submit",i=>{i.preventDefault(),!c.matches(":disabled")&&c.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();var H=()=>{H._initialised||(H._initialised=!0,$({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(t=>{console.error("Failed to initialise reminders:",t)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",H,{once:!0}):H();var K=()=>{if(typeof document>"u")return;let t=document.getElementById("noteTitleMobile"),e=document.getElementById("noteBodyMobile"),r=document.getElementById("noteSaveMobile"),y=document.getElementById("noteNewMobile"),l=document.getElementById("notesListMobile");if(!t||!e||!r)return;let o=null,c=d=>{if(!d){o=null,t.value="",e.value="",delete t.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;return}o=d.id,t.value=d.title||"",e.value=d.body||"",t.dataset.noteOriginalTitle=d.title||"",e.dataset.noteOriginalBody=d.body||""},g=()=>{if(!l)return;l.querySelectorAll("button[data-note-id]").forEach(a=>{if(!(a instanceof HTMLElement))return;let h=a.getAttribute("data-note-id")===o;a.classList.toggle("bg-base-200",h),a.classList.toggle("border-base-200",!h),a.classList.toggle("border-primary",h),a.classList.toggle("font-medium",h),a.setAttribute("aria-current",h?"true":"false")})},T=()=>{let d=typeof t.value=="string"?t.value:"",a=typeof e.value=="string"?e.value:"",h=t.dataset.noteOriginalTitle??"",p=e.dataset.noteOriginalBody??"";return d!==h||a!==p},w=()=>{let d=D();return Array.isArray(d)?[...d].sort((a,h)=>{let p=Date.parse(a?.updatedAt||""),i=Date.parse(h?.updatedAt||"");return(Number.isNaN(i)?0:i)-(Number.isNaN(p)?0:p)}):[]},B=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(U)}catch{return null}},s=B(),I=()=>(s=B(),s),k=({preserveDraft:d=!0}={})=>{let a=x(),h=d&&T();if(!a.length)return h||c(null),g(),I(),a;if(o){let p=a.find(i=>i.id===o)||null;p?h||c(p):h?o=null:c(a[0])}else h||c(a[0]);return g(),I(),a},f=d=>{if(!d)return;let a=D();if(!Array.isArray(a))return;let h=a.filter(p=>p.id!==d);h.length!==a.length&&(R(h),I(),o===d&&(o=null),k({preserveDraft:!1}))},x=(d=w())=>{if(!l)return d;if(l.innerHTML="",!d.length){let a=document.createElement("li");return a.className="text-sm italic text-base-content/60",a.textContent="No saved notes yet.",l.appendChild(a),d}return d.forEach(a=>{let h=document.createElement("li");h.className="flex items-center gap-2";let p=document.createElement("button");p.type="button",p.dataset.noteId=a.id,p.className="w-full flex-1 rounded-lg border border-base-200 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",p.textContent=a.title||"Untitled note",p.addEventListener("click",()=>{c(a),g()});let i=document.createElement("button");i.type="button",i.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",i.setAttribute("aria-label",`Delete note "${a.title||"Untitled note"}"`),i.textContent="Delete",i.addEventListener("click",A=>{A.stopPropagation(),f(a.id)}),h.appendChild(p),h.appendChild(i),l.appendChild(h)}),g(),d},C=()=>{k({preserveDraft:!1})};r.addEventListener("click",()=>{let d=D(),a=Array.isArray(d)?[...d]:[],h=typeof t.value=="string"?t.value.trim():"",p=typeof e.value=="string"?e.value:"",i=h||"Untitled note",A=new Date().toISOString();if(o){let v=a.findIndex(M=>M.id===o);if(v>=0)a[v]={...a[v],title:i,body:p,updatedAt:A};else{let M=F(i,p,{updatedAt:A});o=M.id,a.unshift(M)}}else{let v=F(i,p);o=v.id,a.unshift(v)}R(a),I(),k({preserveDraft:!1})}),y&&y.addEventListener("click",()=>{c(null),g(),typeof t.focus=="function"&&t.focus()}),C(),typeof window<"u"&&(window.addEventListener("storage",d=>{d.key===U&&(s=d.newValue??null,k({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let d=B();d!==s&&(s=d,k({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",K,{once:!0}):K();var P=G(),_=V({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:t=>{P?.handleSessionChange(t)}});if(_?.supabase){P?.setSupabaseClient(_.supabase);try{_.supabase.auth.getSession().then(({data:t})=>{P?.handleSessionChange(t?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let t=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let r='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',y=t,l=s=>{if(!(s instanceof HTMLElement)||s.getAttribute("aria-hidden")==="true"||s.hasAttribute("disabled")||s.tabIndex<0)return!1;let I=s.getBoundingClientRect();return I.width>0||I.height>0},o=()=>Array.from(e.querySelectorAll(r)).filter(l),c=()=>{let s=e.classList.contains("hidden");e.setAttribute("aria-hidden",s?"true":"false")};c();let g=s=>{!e.contains(s.target)&&s.target!==t&&B({restoreFocus:!1})},T=()=>{let[s]=o();if(s instanceof HTMLElement)try{s.focus()}catch{}},w=()=>{e.classList.contains("hidden")&&(y=document.activeElement instanceof HTMLElement?document.activeElement:t,e.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),c(),document.addEventListener("focusin",g),!e.contains(document.activeElement)&&T())},B=({restoreFocus:s=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),t.setAttribute("aria-expanded","false"),c(),document.removeEventListener("focusin",g),s&&y instanceof HTMLElement))try{y.focus()}catch{}};t.addEventListener("click",s=>{s.stopPropagation(),e.classList.contains("hidden")?w():B()}),document.addEventListener("click",s=>{s.target===t||e.contains(s.target)||B({restoreFocus:!1})}),document.addEventListener("keydown",s=>{if(s.key==="Escape"){B();return}s.key==="ArrowDown"&&!e.classList.contains("hidden")&&(s.preventDefault(),T())}),e.addEventListener("click",s=>{s.stopPropagation(),s.target instanceof HTMLElement&&s.target.closest("button")&&B({restoreFocus:!1})}),e.addEventListener("keydown",s=>{if(s.key!=="Tab")return;let I=o();if(!I.length)return;let k=I.indexOf(document.activeElement),f=I.length-1,x=k;s.shiftKey?x=k<=0?f:k-1:x=k===f?0:k+1,s.preventDefault();let C=I[x]||I[0];if(C instanceof HTMLElement)try{C.focus()}catch{}})})();(()=>{let t=document.getElementById("voiceAddBtn");if(!(t instanceof HTMLElement))return;let e=()=>{let l=document.getElementById("voiceBtn");return l instanceof HTMLElement?l:null},r=()=>{let l=e();if(!l)return;let o=()=>{l.hasAttribute("disabled")||l.getAttribute("aria-disabled")==="true"?(t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"));let g=l.getAttribute("title");g&&t.setAttribute("title",g)};o(),typeof MutationObserver=="function"&&new MutationObserver(o).observe(l,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r();let y=()=>{let l=e();if(l&&!(l.hasAttribute("disabled")||l.getAttribute("aria-disabled")==="true")){try{l.focus({preventScroll:!0})}catch{try{l.focus()}catch{}}try{l.click()}catch(o){console.warn("Voice add trigger failed",o)}}};t.addEventListener("click",l=>{l.preventDefault();let o=!1,c=null,g=()=>{o||(o=!0,document.removeEventListener("reminder:sheet-opened",T),y())},T=B=>{if(B?.detail?.trigger!==t)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&c&&(window.clearTimeout(c),c=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(g,150)};document.addEventListener("reminder:sheet-opened",T);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:t}}))}catch(B){document.removeEventListener("reminder:sheet-opened",T),typeof window<"u"&&typeof window.clearTimeout=="function"&&c&&(window.clearTimeout(c),c=null),console.warn("Voice add open failed",B);return}let w=document.getElementById("create-sheet");w instanceof HTMLElement&&w.classList.contains("open")&&(c=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(g,120))})})();(()=>{let t=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let r=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],y=()=>{let o=e.hasAttribute("open");t.setAttribute("aria-expanded",String(o)),t.classList.toggle("btn-active",o)},l=()=>{for(let o of r){let c=e.querySelector(o);if(c instanceof HTMLElement&&!c.hasAttribute("disabled")){try{c.focus({preventScroll:!0})}catch{c.focus()}return}}};t.addEventListener("click",()=>{let o=e.hasAttribute("open");e.open=!o,o||l(),y()}),e.addEventListener("toggle",y),y()})();(()=>{let t=document.getElementById("create-sheet");if(!(t instanceof HTMLElement))return;function e(){!t.classList.contains("open")&&t.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",t=>{let e=document.getElementById("totalCount");if(!e)return;let r=Array.isArray(t?.detail?.items)?t.detail.items.length:0;e.textContent=String(r)});document.addEventListener("click",t=>{try{let e=t.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let r=document.createElement("div");r.textContent="Save clicked",r.style.position="fixed",r.style.right="16px",r.style.bottom="16px",r.style.background="rgba(34,197,94,0.95)",r.style.color="#fff",r.style.padding="8px 12px",r.style.borderRadius="8px",r.style.zIndex="99999",document.body.appendChild(r),setTimeout(()=>r.remove(),900)}catch{}}}catch{}});(function(){let t=document.getElementById("reminderList");if(!t)return;let e=Array.from(t.children);if(e.length<=30)return;let r=20;t.innerHTML="";let y=0;function l(){let g=e.slice(y,y+r);g.forEach(T=>t.appendChild(T)),y+=g.length}l();let o=document.createElement("div");o.id="listSentinel",t.appendChild(o);let c=new IntersectionObserver(g=>{g.some(T=>T.isIntersecting)&&y<e.length&&(l(),y>=e.length&&c.disconnect())});c.observe(o)})();(function(){let t=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(o=>o instanceof HTMLElement),e=document.getElementById("settingsModal"),r=document.getElementById("closeSettings");if(!t.length||!e||!r)return;function y(){e.classList.remove("hidden")}function l(){e.classList.add("hidden")}t.forEach(o=>{o.addEventListener("click",y)}),r.addEventListener("click",l),e.addEventListener("click",o=>{o.target instanceof HTMLElement&&o.target.matches("[data-close]")&&l()}),e.addEventListener("keydown",o=>{o.key==="Escape"&&l()})})();(function(){let t=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),r=document.getElementById("mcStatusText"),y=document.getElementById("syncUrl"),l=document.getElementById("saveSyncSettings"),o=document.getElementById("testSync"),c=document.getElementById("syncAll"),g="syncUrl";if(!r)return;let T=["online","offline","error"],w=["online","offline"],B={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},s={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},I=null;function k(n){if(!e)return;w.forEach(S=>e.classList.remove(S));let u=n!=="offline"&&n!=="error";e.classList.add(u?"online":"offline"),e.setAttribute("aria-label",u?"Online":"Offline")}function f(n,u){I=n,T.forEach(b=>r.classList.remove(b)),t&&T.forEach(b=>t.classList.remove(b)),n==="online"?(r.classList.add("online"),t&&t.classList.add("online")):n==="error"?(r.classList.add("error"),t&&t.classList.add("error")):(r.classList.add("offline"),t&&t.classList.add("offline"));let S=typeof u=="string"&&u.trim()?u.trim():B[n]||"",L=typeof u=="string"&&u.trim()?u.trim():s[n]||S,E=S||L||"";r.textContent=E,E?(r.setAttribute("title",E),r.setAttribute("aria-label",E)):(r.removeAttribute("title"),r.removeAttribute("aria-label")),k(n),r.dataset.state=n}function x(){I!=="syncing"&&f(navigator.onLine?"online":"offline")}function C(n){typeof localStorage>"u"||(n?localStorage.setItem(g,n):localStorage.removeItem(g))}function d(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(g)||""}catch{return""}}function a(n){if(!n||typeof n!="object")return null;let u=n.id||n.uid||n.key||n.slug||n.uuid,S=typeof n.title=="string"&&n.title.trim()?n.title.trim():typeof n.name=="string"?n.name.trim():"";if(!S)return null;let L=typeof n.dueIso=="string"&&n.dueIso?n.dueIso:typeof n.due=="string"?n.due:null,E=typeof n.priority=="string"&&n.priority.trim()?n.priority.trim():n.level||n.importance||"Medium",b=typeof n.category=="string"&&n.category.trim()?n.category.trim():n.group||n.bucket||"General",m=typeof n.done=="boolean"?n.done:!!(n.completed||n.isDone||n.status==="done");return{id:u||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:S,dueIso:L&&L.trim()?L.trim():null,priority:E,category:b,done:m}}function h(){let n=Array.from(document.querySelectorAll("[data-reminder]"));return n.length?n.map(u=>{let S=u.dataset||{},L=null;if(S.reminder)try{L=JSON.parse(S.reminder)}catch{L=null}let E=L||{id:S.id||S.reminderId||u.getAttribute("data-id")||null,title:S.title||S.reminderTitle||"",dueIso:S.due||S.reminderDue||u.getAttribute("data-due")||null,priority:S.priority||S.reminderPriority||u.getAttribute("data-priority")||"",category:S.category||S.reminderCategory||u.getAttribute("data-category")||"",done:S.done==="true"||S.reminderDone==="true"||u.getAttribute("data-done")==="true"};if(!E.title){let b=u.querySelector("[data-reminder-title], [data-title], h3, h4, strong");b&&(E.title=b.textContent.trim())}if(!E.dueIso){let b=u.querySelector("[data-due], time");if(b){let m=b.getAttribute("datetime")||b.getAttribute("data-due");E.dueIso=m||b.textContent.trim()}}return a(E)}).filter(Boolean):[]}function p(){if(typeof localStorage>"u")return[];let n=[],u=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(L=>{if(!u.has(L)){u.add(L);try{let E=localStorage.getItem(L);if(!E)return;let b=JSON.parse(E);Array.isArray(b)?b.forEach(m=>n.push(m)):b&&typeof b=="object"&&(Array.isArray(b.items)&&b.items.forEach(m=>n.push(m)),Array.isArray(b.reminders)&&b.reminders.forEach(m=>n.push(m)))}catch{}}}),!n.length)for(let L=0;L<localStorage.length;L+=1){let E=localStorage.key(L);if(!(!E||u.has(E)||!/remind/i.test(E))){u.add(E);try{let b=localStorage.getItem(E);if(!b)continue;let m=JSON.parse(b);Array.isArray(m)?m.forEach(O=>n.push(O)):m&&typeof m=="object"&&(Array.isArray(m.items)&&m.items.forEach(O=>n.push(O)),Array.isArray(m.reminders)&&m.reminders.forEach(O=>n.push(O)))}catch{}}}return n.map(a).filter(Boolean)}function i(){let n=h();return n.length?n:p()}function A(n){n?(c?.setAttribute("aria-busy","true"),c?.setAttribute("disabled","disabled"),o?.setAttribute("aria-busy","true"),o?.setAttribute("disabled","disabled")):(c?.removeAttribute("aria-busy"),o?.removeAttribute("aria-busy"),v())}function v(){!!((y?.value||"").trim()||d())?(c?.removeAttribute("disabled"),o?.removeAttribute("disabled")):(c?.setAttribute("disabled","disabled"),o?.setAttribute("disabled","disabled"))}let M=d();y&&M&&(y.value=M),v(),f(navigator.onLine?"online":"offline"),window.addEventListener("online",x),window.addEventListener("offline",x),y?.addEventListener("input",v),l?.addEventListener("click",()=>{let n=(y?.value||"").trim();if(!n){C(""),f("info","Sync URL cleared. Add one to enable sync."),v();return}try{let u=new URL(n);if(!/^https?:/.test(u.protocol))throw new Error("Invalid protocol")}catch{f("error","Enter a valid sync URL before saving.");return}C(n),f("online","Sync settings saved."),v()}),o?.addEventListener("click",async()=>{let n=(y?.value||d()).trim();if(!n){f("error","Add your sync URL in Settings first.");return}A(!0),f("syncing","Testing connection\u2026");try{(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?f("online","Connection looks good."):f("error","Test failed. Check your Apps Script deployment.")}catch(u){console.error("Test sync failed",u),f("error","Test failed. Check your Apps Script deployment.")}finally{A(!1)}}),c?.addEventListener("click",async()=>{let n=(y?.value||d()).trim();if(!n){f("error","Add your sync URL in Settings first.");return}let u=i();if(!u.length){f("info","Nothing to sync right now.");return}A(!0),f("syncing",`Syncing ${u.length} reminder${u.length===1?"":"s"}\u2026`);let S=20,L=0,E=0,b=m=>({id:m.id,title:m.title,dueIso:m.dueIso||null,priority:m.priority||"Medium",category:m.category||"General",done:!!m.done,source:"memory-cue-mobile"});try{for(let m=0;m<u.length;m+=S){let O=u.slice(m,m+S);(await Promise.allSettled(O.map(N=>fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b(N))})))).forEach(N=>{N.status==="fulfilled"&&N.value?.ok?L+=1:(N.status,E+=1)}),await new Promise(N=>setTimeout(N,300))}E?L?f("error",`Partial sync: ${L} success, ${E} failed.`):f("error","Sync failed. Check your sync URL and retry."):f("online",`Sync complete. ${L} updated.`)}catch(m){console.error("Sync failed",m),f("error","Sync failed. Try again soon.")}finally{A(!1)}})})()});export default Q();
