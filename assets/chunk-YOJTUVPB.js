import{a as Dn,b as kn,c as Xi}from"./chunk-GUVSRPRW.js";function Fn(){return typeof ce.toast=="function"?ce.toast:null}function ze(r){typeof console<"u"&&console.warn&&console.warn(r)}function Rn(r={}){ce={...Nn,...r}}async function Bn(){let r=Fn();if(!ce||typeof ce!="object")throw ze("Authentication context is not configured."),new Error("Authentication context unavailable");let{authReady:s,auth:S,GoogleAuthProvider:b,signInWithPopup:D,signInWithRedirect:k}=ce;if(!s||typeof b!="function"||typeof D!="function"||typeof k!="function"){r?.("Sign-in unavailable offline"),ze("Attempted sign-in before Firebase auth was ready.");return}let R=new b;try{await D(S,R)}catch{try{await k(S,R)}catch{r?.("Google sign-in failed"),ze("Google sign-in failed via popup and redirect.")}}}async function Mn(){let r=Fn();if(!ce||typeof ce!="object")throw ze("Authentication context is not configured."),new Error("Authentication context unavailable");let{authReady:s,auth:S,signOut:b}=ce;if(!s||typeof b!="function"){r?.("Sign-out unavailable offline"),ze("Attempted sign-out before Firebase auth was ready.");return}try{await b(S),r?.("Signed out")}catch(D){r?.("Sign-out failed"),typeof console<"u"&&console.error&&console.error("Sign-out failed:",D)}}function Ki(){if(typeof window>"u")return;let r=window.supabase;if(!r){console.error("Supabase client not found. Check your URL/key config in index.html.");return}let s=document.getElementById("auth-form"),S=document.getElementById("auth-email"),b=document.getElementById("sign-out-btn"),D=document.getElementById("user-badge"),k=document.getElementById("user-badge-email"),R=document.getElementById("user-badge-initial"),H=document.getElementById("auth-feedback"),A=document.getElementById("sync-status"),J=(y,W)=>{y&&(y.classList.toggle("hidden",!W),W?y.removeAttribute("hidden"):y.setAttribute("hidden",""))};if(!s)return;A&&!A.textContent&&(A.textContent="Sign in to sync reminders across devices.",A.classList.remove("online"),A.dataset.state="offline",J(A,!0));let Te=y=>{H&&(H.textContent=y||"",J(H,!!y))};s._wired||(s._wired=!0,s.addEventListener("submit",async y=>{y.preventDefault();let W=S?.value.trim();if(!W)return;let{error:O}=await r.auth.signInWithOtp({email:W});Te(O?O.message:"Magic link sent. Check your email.")})),b&&!b._wired&&(b._wired=!0,b.addEventListener("click",async()=>{await r.auth.signOut()})),r.auth.onAuthStateChange(async(y,W)=>{let O=W?.user||null;J(b,!!O),J(s,!O),J(D,!!O),O?(k&&(k.textContent=O.email||""),R&&(R.textContent=(O.email?.[0]||"U").toUpperCase()),A&&(A.textContent=`Reminders syncing for ${O.email||"your account"}.`,A.classList.add("online"),A.dataset.state="online"),await r.from("profiles").upsert({id:O.id,email:O.email})):A&&(A.textContent="Sign in to sync reminders across devices.",A.classList.remove("online"),A.dataset.state="offline"),A&&J(A,!0),Te("")}),(async()=>{try{let{data:y,error:W}=await r.from("activities").select("*").limit(1);console.log("Supabase DB test:",{data:y,error:W})}catch(y){console.error("Supabase sanity test error:",y)}})()}var Nn,ce,On=kn(()=>{Nn=Object.freeze({authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null}),ce={...Nn};typeof window<"u"&&window.addEventListener("DOMContentLoaded",Ki,{once:!0})});var jn=Xi((so,Xe)=>{var Tt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function _n(r){if(!r||typeof r!="object")return null;let s=Object.entries(r).filter(([S,b])=>typeof b=="string"&&b.trim()!=="");return s.length?Object.fromEntries(s):null}function Ji(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},s=_n(r?.__FIREBASE_CONFIG);if(s)return s;let S=_n(r?.__ENV?.FIREBASE_CONFIG);if(S)return S;let D=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((k,[R,H])=>{let A=r?.__ENV?.[R]??r?.[R];return typeof A=="string"&&A.trim()!==""&&(k[H]=A),k},{});return Object.keys(D).length?D:null}function $n(){let r=Ji();return r?{...Tt,...r}:{...Tt}}var Pn={DEFAULT_FIREBASE_CONFIG:Tt,getFirebaseConfig:$n};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=$n,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Tt}typeof Xe<"u"&&Xe.exports&&(Xe.exports=Pn,Xe.exports.default=Pn)});function eo(){if(ae)return{...ae};let s=Zt()?.memoryCueFirebase;if(s&&typeof s.getFirebaseConfig=="function")return ae=s.getFirebaseConfig(),{...ae};if(typeof Dn=="function")try{let S=jn();if(S){let b=typeof S.getFirebaseConfig=="function"?S.getFirebaseConfig:typeof S.default?.getFirebaseConfig=="function"?S.default.getFirebaseConfig:null;if(b)return ae=b(),{...ae}}}catch{}return s&&s.DEFAULT_FIREBASE_CONFIG?(ae={...s.DEFAULT_FIREBASE_CONFIG},{...ae}):(ae={...Zi},{...ae})}function Zt(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function qn(){let r=Zt(),s=r&&r.TimestampTrigger;return typeof s=="function"?s:null}function ue(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!qn()}function to(){if(typeof window>"u"||!window.location)return Gt;try{return new URL(Gt,window.location.href).href}catch{return Gt}}async function ve(){return Ct||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Ct=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(to()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),Ct))}async function Yn(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let s=await ve();if(!s)return!1;let S=new Set;navigator.serviceWorker.controller&&S.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(D=>{let k=s[D];k&&S.add(k)});let b=!1;return S.forEach(D=>{try{D.postMessage(r),b=!0}catch(k){console.warn("Failed posting message to service worker",k)}}),b}catch(s){return console.warn("Unable to reach service worker",s),!1}}async function Lt(){if(ue())return!1;if(Xt)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Ke)try{return await Ke}catch{}Ke=(async()=>{let r=await ve();if(!r)return!1;let s=!1;if("periodicSync"in r)try{let S=await r.periodicSync.getTags();(!Array.isArray(S)||!S.includes(zt))&&await r.periodicSync.register(zt,{minInterval:15*60*1e3}),s=!0}catch(S){console.warn("Periodic background sync unavailable",S)}if(!s&&"sync"in r)try{await r.sync.register(zt),s=!0}catch(S){console.warn("Background sync unavailable",S)}return s})();try{let r=await Ke;return r&&(Xt=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),Xt=!1,!1}finally{Ke=null}}async function Jt(r=[],{requestCheck:s=!1}={}){if(!ue()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let S=await ve();if(!S)return;let b=await Yn({type:Wn.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(s&&await Yn({type:Wn.checkScheduledReminders}),!b&&typeof S.update=="function")try{await S.update()}catch{}}catch(S){console.warn("Failed syncing reminders with service worker",S)}}async function Qt(r,s){if(ue())try{let S=s||await ve();if(!S)return;let b=[];try{b=await S.getNotifications({tag:r,includeTriggered:!0})}catch{b=await S.getNotifications({tag:r})}for(let D of b)try{D.close()}catch{}}catch{}}function Vn(){for(let r of Array.from(le.values()))try{r.close()}catch{}le.clear()}function no(){if(Hn||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>Vn();["pagehide","beforeunload"].forEach(s=>{try{window.addEventListener(s,r)}catch{}}),Hn=!0}function $(r){if(typeof r=="string"){let s=r.replace(/\s+/g," ").trim();if(s)return s}return j}async function lo(r={}){let s=e=>e?document.querySelector(e):null,S=e=>e?Array.from(document.querySelectorAll(e)):[],b=s(r.titleSel),D=s(r.dateSel),k=s(r.timeSel),R=s(r.detailsSel),H=s(r.prioritySel),A=s(r.categorySel),J=s(r.saveBtnSel),Te=s(r.cancelEditBtnSel),y=s(r.listSel),W=S(r.googleSignInBtnSel),O=S(r.googleSignOutBtnSel),N=s(r.statusSel),_=s(r.syncStatusSel),Gn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},zn=6e3,Q=null;function Ce(e,{clearMessage:t=!0}={}){Q&&(e&&Q.tokenId!==e||(Q.timeoutId&&clearTimeout(Q.timeoutId),t&&N&&N.dataset.undoToken===Q.tokenId&&(typeof N.replaceChildren=="function"?N.replaceChildren():N.textContent="",delete N.dataset.undoToken,delete N.dataset.statusKind),Q=null))}function Xn(e){if(!N)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Ui(e.tokenId)),e.button=i,typeof N.replaceChildren=="function"?N.replaceChildren(t,n,i):(N.textContent="",N.append(t,n,i)),N.dataset.statusKind="undo",N.dataset.undoToken=e.tokenId}function xt(e,t){if(!_)return;let n=["online","offline","error"];n.forEach(a=>_.classList.remove(a)),n.includes(e)&&_.classList.add(e),_.dataset.state=e;let i=typeof t=="string"?t:Gn[e]||"";e==="online"||e==="offline"?(_.textContent="",_.dataset.compact="true",i?(_.setAttribute("aria-label",i),_.setAttribute("title",i)):(_.removeAttribute("aria-label"),_.removeAttribute("title"))):(_.textContent=i,_.removeAttribute("data-compact"),i?(_.setAttribute("aria-label",i),_.setAttribute("title",i)):(_.removeAttribute("aria-label"),_.removeAttribute("title")))}let Y=s(r.notesSel),Kn=s(r.saveNotesBtnSel),Jn=s(r.loadNotesBtnSel),en=s(r.countTotalSel),Je=s(r.googleUserNameSel),we=s(r.dateFeedbackSel),G=s(r.voiceBtnSel),Qn=s(r.notifBtnSel),Fe=s(r.moreBtnSel),Re=s(r.moreMenuSel),Zn=s(r.copyMtlBtnSel),Dt=s(r.importFileSel),ei=s(r.exportBtnSel),ti=s(r.syncAllBtnSel),Le=s(r.syncUrlInputSel),ni=s(r.saveSettingsSel),ii=s(r.testSyncSel),oi=S(r.openSettingsSel),Qe=s(r.settingsSectionSel),xe=s(r.emptyStateSel),tn=s(r.listWrapperSel),kt=s(r.categoryOptionsSel),fe=r.variant||"mobile",nn="mc:lastDefaults";function Nt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(nn)||"{}")||{}}catch{return{}}}function ri(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(nn,JSON.stringify(e))}catch{}}function on(e){let t=Nt(),n={category:$(e?.category||t.category||j),priority:e?.priority||t.priority||"Medium"};ri(n)}let rn='fieldset#priorityChips input[name="priority"]';function Ft(){try{let e=document.querySelector(`${rn}:checked`);if(e&&e.value)return e.value}catch{}return H&&typeof H.value=="string"&&H.value?H.value:"Medium"}function Ze(e){let t=e||"Medium";H&&typeof H.value<"u"&&(H.value=t);try{let n=Array.from(document.querySelectorAll(rn));if(!n.length)return;let i=!1;if(n.forEach(o=>{let a=o.value===t;o.checked=a,i=i||a}),!i){let o=n.find(a=>a.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function an(){let e=Nt();e.category&&A&&(A.value=e.category),e.priority&&Ze(e.priority)}an();let z=typeof document<"u"?document.getElementById("quickAddInput"):null,ai=typeof document<"u"?document.getElementById("quickAddSubmit"):null,X=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,Rt=null;function si(e,t){let n=Date.now(),i=Nt(),o=typeof t=="string"&&t?t:null;return{id:yt(),title:(e||"").trim(),priority:i.priority||Ft(),category:$(i.category||A?.value||j),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!q}}async function Bt(){if(!z)return;if(typeof Rt=="function")try{Rt()}catch{}let e=(z.value||"").trim();if(!e)return;let t=null;try{let o=wt(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=si(e,t);jt(n,{position:"start"}),d.unshift(n),Z(d);let i=We(d);Se=!0,M(),U(),i?d.forEach(o=>V(o)):V(n),qe(n),Ie(n),he(),on(n),Be();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:d}}))}catch{}ne({action:"created",label:`Reminder added \xB7 ${n.title}`}),z.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Bt),ai?.addEventListener("click",()=>{Bt()}),z?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Bt())});function di(){if(typeof HTMLElement>"u"||!(X instanceof HTMLElement)||!(z instanceof HTMLInputElement)||X.dataset.voiceBound==="true")return;if(X.dataset.voiceBound="true",typeof window>"u"){X.setAttribute("disabled","true"),X.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){X.setAttribute("disabled","true"),X.setAttribute("aria-disabled","true"),X.getAttribute("title")||(X.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=c=>{n=c,X.setAttribute("aria-pressed",c?"true":"false"),X.dataset.listening=c?"true":"false",X.classList.toggle("is-listening",c)},o=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",g=>{let h=g?.results?.[0]?.[0]?.transcript?.trim()||"";if(h){z.value=h;try{z.focus({preventScroll:!0})}catch{z.focus()}try{let w=z.value.length;typeof z.setSelectionRange=="function"&&z.setSelectionRange(w,w)}catch{}}});let f=()=>{i(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};Rt=a,X.addEventListener("click",()=>{let c=o();if(c){if(n){a();return}try{c.start(),i(!0)}catch(f){console.warn("Quick add voice error:",f),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}di(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&z&&(e.preventDefault(),z.focus())})));try{fe==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let ci=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",sn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,li=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",et=r.reminderLandingPath||(fe==="desktop"?"index.html#reminders":"mobile.html"),pe=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function dn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Be(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:d}}))}catch{}}A&&!A.value&&(A.value=j),ue()&&ve();function ne(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Un,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Un,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function ui(){if(typeof HTMLElement>"u"||!(G instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&b instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&b instanceof HTMLTextAreaElement;if(!e&&!t||G.dataset.voiceBound==="true")return;if(G.dataset.voiceBound="true",typeof window>"u"){G.setAttribute("disabled","true"),G.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){G.setAttribute("disabled","true"),G.setAttribute("aria-disabled","true"),G.getAttribute("title")||(G.title="Voice input is not supported in this browser.");return}let i=null,o=!1,a=h=>{o=h,G.setAttribute("aria-pressed",h?"true":"false"),G.dataset.listening=h?"true":"false",G.classList.toggle("is-listening",h)},c=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",w=>{let L=w.results?.[0]?.[0]?.transcript?.trim()||"";if(L){b.value=L;try{b.focus({preventScroll:!0})}catch{try{b.focus()}catch{}}try{let F=b.value.length;typeof b.setSelectionRange=="function"&&b.setSelectionRange(F,F)}catch{}ne({action:"dictated",label:`Voice input captured \xB7 ${L}`})}});let h=()=>{a(!1)};return i.addEventListener("end",h),i.addEventListener("error",h),i},f=()=>{if(!(!o||!i)){try{i.stop()}catch{}a(!1)}};G.addEventListener("click",()=>{let h=c();if(h){if(o){f();return}try{h.start(),a(!0)}catch(w){console.warn("Speech recognition error:",w),a(!1)}}});let g=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",g),document.addEventListener("reminders:updated",g)),a(!1)}no(),ui();let tt,nt,it,ot,De,rt,at,st,dt,ct,lt,Me,Oe,ut,ft,Mt,Ot,pt,_t,cn=r.firebaseDeps,Pt=typeof r.importModule=="function"?r.importModule:e=>import(e),_e=Zt(),Pe=!1,ie=!1,$t=null,se=null,$e=null,d=[],Se=!1,q=null,je=null,Ue=null,Ee={},P={};function Z(e=d){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?gn(t||{},n||{}):o-i})}function fi(e=d){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function He(e=d){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),Z(n);else{n=e.slice().sort(gn);let i=n.length;n.forEach((o,a)=>{o.orderIndex=(i-a)*re})}return e===d&&(d=n),n}function jt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=fi();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-re||re}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+re||re}}function We(e=d){if(!Array.isArray(e)||e.length<2)return!1;Z(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,c=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(a==null||c==null||a<=c||a-c<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*re;return e===d&&Z(d),!0}let C={draggingId:null,dropTargetId:null,dropBefore:!0},ln=!1,u={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function pi(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Ye(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function me(){y&&(y.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),y.classList.remove("drag-over-list"))}function Ut(){if(!y)return;let e=y.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),me(),C.draggingId=null,C.dropTargetId=null,C.dropBefore=!0}function un(e,t,n){if(!e||e===t)return;let i=d.findIndex(F=>F?.id===e);if(i<0)return;let[o]=d.splice(i,1),a;if(!t)a=d.length;else{let F=d.findIndex(K=>K?.id===t);if(F<0){d.splice(i,0,o);return}a=n?F:F+1}d.splice(a,0,o);let c=d[a-1],f=d[a+1],g=Number.isFinite(c?.orderIndex)?c.orderIndex:null,h=Number.isFinite(f?.orderIndex)?f.orderIndex:null,w;g!=null&&h!=null?w=(g+h)/2:g!=null?w=g-re:h!=null?w=h+re:w=re,Number.isFinite(w)||(w=re*(d.length+1)),o.orderIndex=w,Z(d);let L=We(d);Se=!0,M(),U(),L?d.forEach(F=>V(F)):V(o),Be(),pe("memoryCue:remindersUpdated",{items:d}),ne({action:"reordered",label:"Reminders reordered"})}function mi(e){let t=Ye(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(C.draggingId=i,C.dropTargetId=null,C.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function gi(e){if(!C.draggingId)return;let t=Ye(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),C.dropTargetId=null,C.dropBefore=!1,me(),y?.classList.add("drag-over-list");return}if(t.dataset.id===C.draggingId){e.preventDefault(),me();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(C.dropTargetId!==t.dataset.id||C.dropBefore!==o)&&(me(),t.classList.add(o?"drag-over-before":"drag-over-after"),C.dropTargetId=t.dataset.id,C.dropBefore=o)}function yi(e){let t=Ye(e.target);if(!t){y?.contains(e.relatedTarget)||me();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),y?.contains(e.relatedTarget)||y?.classList.remove("drag-over-list"))}function hi(e){if(!C.draggingId)return;e.preventDefault();let t=Ye(e.target),n=t?.dataset.id||null,i=C.dropBefore;if(t){let o=t.getBoundingClientRect(),a=o.top+o.height/2;i=e.clientY<a}else n=null,i=!1;un(C.draggingId,n,i),Ut()}function bi(){Ut()}function vi(){!y||ln||(ln=!0,y.addEventListener("dragstart",mi),y.addEventListener("dragover",gi),y.addEventListener("drop",hi),y.addEventListener("dragend",bi),y.addEventListener("dragleave",yi),mt())}function mt(){if(!y||mt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){mt._bound=!0;return}let t=6,n=160;function i(){u.longPressTimer&&(clearTimeout(u.longPressTimer),u.longPressTimer=null)}function o(){y&&(u.initialTouchAction!=null?y.style.touchAction=u.initialTouchAction:y.style.removeProperty("touch-action"))}function a({keepHighlights:v=!1}={}){if(i(),u.item&&u.pointerId!=null)try{u.item.hasPointerCapture?.(u.pointerId)&&u.item.releasePointerCapture(u.pointerId)}catch{}if(u.placeholder?.parentNode)try{u.placeholder.parentNode.removeChild(u.placeholder)}catch{}u.item&&(u.item.classList.remove("is-dragging"),u.originalStyles?u.item.setAttribute("style",u.originalStyles):u.item.removeAttribute("style")),o(),v||me(),Object.assign(u,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function c(v){return y?Array.from(y.querySelectorAll("[data-reminder-item]")).filter(T=>T!==v):[]}function f(v){let T=u.item;if(!T||u.ready)return;let x=T.getBoundingClientRect(),l=window.getComputedStyle(T);u.ready=!0,C.draggingId=T.dataset.id||null,u.offsetY=v.clientY-x.top,u.fixedX=x.left;let p=document.createElement("div");p.className="touch-drag-placeholder",p.setAttribute("aria-hidden","true"),p.style.height=`${x.height}px`,p.style.boxSizing="border-box",p.style.marginTop=l.marginTop,p.style.marginBottom=l.marginBottom,p.style.marginLeft=l.marginLeft,p.style.marginRight=l.marginRight,p.style.borderRadius=l.borderRadius,p.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",p.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",p.style.pointerEvents="none",p.style.display="block",p.style.width="100%",T.parentNode?.insertBefore(p,T),u.placeholder=p,u.longPressTimer=null,u.originalStyles=T.getAttribute("style")||"",T.classList.add("is-dragging"),T.style.position="fixed",T.style.left=`${x.left}px`,T.style.top=`${x.top}px`,T.style.width=`${x.width}px`,T.style.zIndex="999",T.style.pointerEvents="none",T.style.touchAction="none",u.initialTouchAction=y.style.touchAction||"",y.style.touchAction="none"}function g(v){let T=u.item;if(!T||!u.ready)return;let x=v-u.offsetY;T.style.top=`${x}px`,T.style.left=`${u.fixedX}px`}function h(v){if(!u.ready||!y)return;let T=u.item,x=c(T);if(me(),!x.length){C.dropTargetId=null,C.dropBefore=!1;return}let l=null,p=!1;for(let ee of x){let be=ee.getBoundingClientRect(),Ne=be.top+be.height/2;if(v<Ne){l=ee,p=!0;break}}if(!l){l=x[x.length-1];let ee=l.getBoundingClientRect(),be=ee.top+ee.height/2;p=v<be,p||(p=!1)}if(!l){C.dropTargetId=null,C.dropBefore=!1;return}let m=l.getBoundingClientRect(),E=m.top+m.height/2,B=v<E;l.classList.add(B?"drag-over-before":"drag-over-after"),C.dropTargetId=l.dataset.id||null,C.dropBefore=B}function w(v){let T=C.draggingId,x=u.moved;if(!u.ready){a();return}a(),!v&&x&&T&&un(T,C.dropTargetId,C.dropBefore),Ut()}function L(v){let T=v.pointerType||"";if(T&&T!=="touch"&&T!=="pen"||u.active)return;let x=Ye(v.target);if(!x)return;let l=pi(v.target);if(!(l&&l!==x)){u.active=!0,u.pointerId=v.pointerId,u.item=x,u.startX=v.clientX,u.startY=v.clientY,u.lastClientX=v.clientX,u.lastClientY=v.clientY,u.moved=!1,u.ready=!1,u.originalStyles=x.getAttribute("style")||"",u.startTime=v.timeStamp||Date.now(),C.dropTargetId=null,C.dropBefore=!0,C.draggingId=null,i(),u.longPressTimer=setTimeout(()=>{f({clientY:u.lastClientY})},n);try{x.setPointerCapture(v.pointerId)}catch{}}}function F(v){if(!u.active||v.pointerId!==u.pointerId)return;let T=v.pointerType||"";if(!(T&&T!=="touch"&&T!=="pen")){if(u.lastClientX=v.clientX,u.lastClientY=v.clientY,!u.ready){let x=Math.abs(v.clientX-u.startX),l=Math.abs(v.clientY-u.startY);if(x>t||l>t){let p=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(p-u.startTime)>=n?(i(),f({clientY:u.lastClientY})):a()}return}v.preventDefault(),u.moved=!0,g(v.clientY),h(v.clientY)}}function K(v){!u.active||v.pointerId!==u.pointerId||w(!1)}function Ae(v){!u.active||v.pointerId!==u.pointerId||w(!0)}y.addEventListener("pointerdown",L),window.addEventListener("pointermove",F),window.addEventListener("pointerup",K),window.addEventListener("pointercancel",Ae),mt._bound=!0}function fn(){q=null,xt("offline"),W.forEach(e=>e.classList.remove("hidden")),O.forEach(e=>e.classList.add("hidden")),Je&&(Je.textContent=""),je?.(),je=null,Wt(),M(),U(),he()}function Ht(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Kt);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:yt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:$(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function wi(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Kt);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:$(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(Kt,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function U(){Z(d),wi(d)}function Wt(){d=He(Ht())}Wt();async function Si(){if(!q){d=Ht();return}let e=He(Ht());if(!e.length){d=[],U();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await V(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}d=He(e.map(n=>({...n,pendingSync:!1}))),U(),M(),he()}try{P=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{P={}}if(P&&typeof P=="object"&&Object.values(P).forEach(e=>{e&&typeof e=="object"&&(e.category=$(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Ge(e),e.urlPath=e.urlPath||et,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!ue()){let e=En();typeof Notification<"u"&&Notification.permission==="granted"?(Lt(),e.length&&Jt(e,{requestCheck:!0})):e.length&&Jt(e)}let gt=e=>{if(!_e)return;let t=[_e];_e.window&&!t.includes(_e.window)&&t.push(_e.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Ei(){if(!Y)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in Y?Y.value:Y.innerHTML,c=w=>{if("value"in Y){Y.value=w;return}if(typeof w!="string"||w.length===0){Y.innerHTML="";return}let L=w.trim();if(/<\/?[a-z][\s\S]*>/i.test(L)){Y.innerHTML=w;return}let K=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");Y.innerHTML=K},f=w=>{w?Y.classList.add("notes-editor--columns"):Y.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!w))},g="";try{g=localStorage.getItem(n)||""}catch{I("Unable to access saved notes")}c(g);let h=!1;try{h=localStorage.getItem(i)==="1"}catch{h=!1}f(h),Y.addEventListener("input",()=>{g=a();try{localStorage.setItem(n,g)}catch{I("Notes saved for this session only")}}),Kn?.addEventListener("click",()=>{g=a();try{localStorage.setItem(n,g),I("Notes saved")}catch{I("Notes saved for this session only")}}),Jn?.addEventListener("click",()=>{let w=g;try{w=localStorage.getItem(n)||g}catch{I("Unable to load saved notes")}g=w,c(g)}),e?.addEventListener("click",w=>{let L=w.target;if(!(L instanceof Element))return;let F=L.closest("button[data-action]");if(!F)return;let K=F.getAttribute("data-action");if(K==="columns"){let Ae=!Y.classList.contains("notes-editor--columns");f(Ae);try{localStorage.setItem(i,Ae?"1":"0")}catch{I("Column preference saved for this session only")}return}if(!o){I("Formatting controls are not supported in this browser");return}Y.focus(),K==="bullets"?document.execCommand("insertUnorderedList"):K==="numbers"&&document.execCommand("insertOrderedList")})}if(Ei(),J?.addEventListener("click",An),cn)({initializeApp:tt,getFirestore:nt,enableMultiTabIndexedDbPersistence:it,enableIndexedDbPersistence:ot,doc:De,setDoc:rt,deleteDoc:at,onSnapshot:st,collection:dt,query:ct,orderBy:lt,serverTimestamp:Me,getAuth:Oe,onAuthStateChanged:ut,GoogleAuthProvider:ft,signInWithPopup:Mt,signInWithRedirect:Ot,getRedirectResult:pt,signOut:_t}=cn),Pe=!0;else try{({initializeApp:tt}=await Pt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:nt,enableMultiTabIndexedDbPersistence:it,enableIndexedDbPersistence:ot,doc:De,setDoc:rt,deleteDoc:at,onSnapshot:st,collection:dt,query:ct,orderBy:lt,serverTimestamp:Me}=await Pt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Oe,onAuthStateChanged:ut,GoogleAuthProvider:ft,signInWithPopup:Mt,signInWithRedirect:Ot,getRedirectResult:pt,signOut:_t}=await Pt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Pe=!0}catch(e){Pe=!1,console.warn("Firebase modules failed to load:",e),I("Firebase failed to load; notes available offline"),gt(!1)}if(Pe&&typeof tt=="function"&&typeof nt=="function"&&typeof Oe=="function")try{let e=eo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),$t=tt(e),se=nt($t),ie=!0,console.info("[Firebase] Firestore initialised",e.projectId),gt(!0)}catch(e){ie=!1,console.warn("Firebase initialization failed:",e),I("Firebase failed to load; notes available offline"),gt(!1)}else Pe?(ie=!1,gt(!1)):ie=!1;ie&&typeof it=="function"&&typeof ot=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await it(se),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await ot(se),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ie&&typeof Oe=="function"&&($e=Oe($t));function Ii(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Ai=typeof navigator<"u"&&navigator.language?navigator.language:"",pn=Ii(Ai),ke=pn||"en-US",de="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(de=e.timeZone),!pn&&e.locale&&(ke=e.locale)}catch{}let Ti=new Intl.DateTimeFormat(ke,{timeZone:de,hour:"2-digit",minute:"2-digit"}),Ci=new Intl.DateTimeFormat(ke,{timeZone:de,weekday:"long",day:"numeric",month:"long"}),Li=new Intl.DateTimeFormat("en-CA",{timeZone:de,year:"numeric",month:"2-digit",day:"2-digit"}),xi=new Intl.DateTimeFormat(ke,{timeZone:de,weekday:"long"}),Di=new Intl.DateTimeFormat(ke,{timeZone:de,month:"short",day:"numeric"});function ge(e){let t=Li.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,o=t.find(a=>a.type==="day").value;return`${n}-${i}-${o}`}function mn(e,t){let[n,i,o]=e.split("-").map(g=>parseInt(g,10)),[a,c]=t.split(":").map(g=>parseInt(g,10)),f=new Date;return f.setFullYear(n,(i||1)-1,o||1),f.setHours(a||0,c||0,0,0),f.toISOString()}let ki=new Intl.DateTimeFormat("en-CA",{timeZone:de,year:"numeric",month:"2-digit",day:"2-digit"}),Ni=new Intl.DateTimeFormat("en-CA",{timeZone:de,hour:"2-digit",minute:"2-digit",hour12:!1});function Fi(e){try{let t=new Date(e),n=ki.formatToParts(t),i=n.find(c=>c.type==="year")?.value||"0000",o=n.find(c=>c.type==="month")?.value||"00",a=n.find(c=>c.type==="day")?.value||"00";return`${i}-${o}-${a}`}catch{return""}}function Ri(e){try{let t=new Date(e),n=Ni.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function yt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function ht(){return ge(new Date)}function Bi(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function oo(e){let t=Bi(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function bt(e){return e==="High"?3:e==="Medium"?2:1}function gn(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(o!==a)return o-a;let c=bt(t?.priority)-bt(e?.priority);return c||(t?.updatedAt||0)-(e?.updatedAt||0)}function ro(e,t){let n=bt(t.priority)-bt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Yt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Ci.format(t)}catch{return e}}function vt(e){return Ti.format(e)}function ye(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function yn(e){return e?ye(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function I(e){N&&(Ce(),N.dataset.statusKind="toast",N.textContent=e,clearTimeout(I._t),I._t=setTimeout(()=>{N&&N.dataset.statusKind==="toast"&&(N.textContent="",delete N.dataset.statusKind)},2500))}function Mi(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function wt(e){e=String(e||"").toLowerCase();let t={date:ht(),time:""},n=f=>{let g=new Date,h=g.getDay(),w=(f-h+7)%7,L=new Date(g);return L.setDate(g.getDate()+(w===0?7:w)),L},i=f=>{let g=new Date,h=g.getDay(),w=(f-h+7)%7,L=new Date(g);return L.setDate(g.getDate()+w),L},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=ge(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),g=o[f[1]],h=n(g);t.date=ge(h)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),g=o[f[1]],h=i(g);t.date=ge(h)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),g=o[f[1]],h=n(g);t.date=ge(h)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),g=parseInt(f[1],10),h=new Date;h.setDate(h.getDate()+g),t.date=ge(h)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),g=parseInt(f[1],10),h=parseInt(f[2],10)-1,w=f[3]?parseInt(f[3],10):new Date().getFullYear(),L=new Date(w,h,g);t.date=ge(L)}else for(let[f,g]of Object.entries(a)){let h=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(h.test(e)){let w=e.match(h),L=parseInt(w[1],10),F=new Date().getFullYear(),K=new Date(F,g,L);t.date=ge(K);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let f=parseInt(c[1],10),g=c[2]?parseInt(c[2],10):0,h=c[3];h&&(h==="pm"&&f<12&&(f+=12),h==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(g).padStart(2,"0")}`}return t}let qt=ie&&$e&&typeof ft=="function";Rn({authReady:qt,auth:$e,GoogleAuthProvider:ft,signInWithPopup:Mt,signInWithRedirect:Ot,signOut:_t,toast:I});let hn=fe!=="desktop",bn=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};hn&&W.length&&W.forEach(e=>bn(e,Bn)),qt&&typeof pt=="function"&&pt($e).catch(()=>{}),hn&&O.length&&O.forEach(e=>bn(e,Mn)),qt&&typeof ut=="function"?ut($e,async e=>{e?(q=e.uid,xt("online"),W.forEach(t=>t.classList.add("hidden")),O.forEach(t=>t.classList.remove("hidden")),Je&&(Je.textContent=e.displayName||e.email||""),Oi(),await Si()):fn()}):fn();function Oi(){if(!ie||!se||typeof dt!="function"||typeof ct!="function"||typeof lt!="function"||typeof st!="function")return;if(!q){Wt(),M(),U(),he();return}je&&je();let e=dt(se,"users",q,"reminders"),t=ct(e,lt("updatedAt","desc"));je=st(t,n=>{let i=[];n.forEach(o=>{let a=o.data(),c=Number(a.orderIndex);i.push({id:o.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:$(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(c)?c:null})}),d=He(i),M(),U(),he()},n=>{console.error("Firestore sync error:",n),_&&xt("error","Sync Error")})}async function V(e){if(!(!ie||!q||!se||typeof De!="function"||typeof rt!="function"||typeof Me!="function"))try{await rt(De(se,"users",q,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||j,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):Me(),updatedAt:Me()},{merge:!0})}catch(t){console.error("Save failed:",t),I("Save queued (offline)")}}async function _i(e){if(!(!ie||!q||!se||typeof De!="function"||typeof at!="function"))try{await at(De(se,"users",q,"reminders",e))}catch{I("Delete queued (offline)")}}async function qe(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||j,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ve(){b&&(b.value=""),D&&(D.value=""),k&&(k.value=""),R&&(R.value=""),Ze("Medium"),A&&(A.value=j),an(),Ue=null,J&&(J.textContent="Save Cue"),Te?.classList.add("hidden")}function vn(e){let t=d.find(n=>n.id===e);t&&(b&&(b.value=t.title||""),D&&k&&(t.due?(D.value=Fi(t.due),k.value=Ri(t.due)):(D.value="",k.value="")),Ze(t?.priority||"Medium"),A&&(A.value=$(t.category)),R&&(R.value=typeof t.notes=="string"?t.notes:""),Ue=e,J&&(J.textContent="Update Cue"),Te?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),b?.focus(),pe("cue:open",{mode:"edit"}))}function Pi(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=$(e.category??(A?A.value:"")),o={id:yt(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!q};jt(o,{position:"start"}),d=[o,...d],Z(d);let a=We(d);return Se=!0,M(),U(),on(o),a?d.forEach(c=>V(c)):V(o),qe(o),Ie(o),Be(),pe("memoryCue:remindersUpdated",{items:d}),dn(),ne({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function $i(e,t){if(!q)return I("Sign in to add notes"),null;if(!e)return null;let n=d.find(c=>c.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${o}`:o,n.updatedAt=Date.now(),V(n),M(),U(),ne({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function ji(e){let t=d.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),V(t),qe(t),M(),U(),t.done?(Et(e),ne({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ie(t),ne({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Ui(e){if(!Q||Q.tokenId!==e)return;let{item:t,index:n}=Q;if(!t){Ce(e);return}Ce(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),d.length):d.length;t.pendingSync=!q,t.updatedAt=Date.now(),d.splice(i,0,t),Z(d);let o=We(d);Se=!0,M(),U(),Ie(t),o?d.forEach(a=>V(a)):V(t),qe(t),Be(),pe("memoryCue:remindersUpdated",{items:d}),ne({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),I("Reminder restored")}function wn(e){let t=d.findIndex(o=>o.id===e),n=t>=0?d.splice(t,1)[0]:null;M(),U(),_i(e),Et(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(ne({action:"deleted",label:i}),n&&N){Ce();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;Q={tokenId:o,item:n,index:t,timeoutId:null},Xn(Q),Q.timeoutId=setTimeout(()=>{Ce(o)},zn)}else n&&Ce()}function Ge(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=vt(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=vt(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function Sn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}I("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function En(){return Object.values(P||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||j,notes:typeof e.notes=="string"?e.notes:"",body:Ge(e),urlPath:e.urlPath||et,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Vt(){try{localStorage.setItem("scheduledReminders",JSON.stringify(P))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=En(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Lt(),Jt(e,{requestCheck:t})}function St(e,{closeNotification:t=!0}={}){if(t){let n=le.get(e);if(n){try{n.close()}catch{}le.delete(e)}}Ee[e]&&(clearTimeout(Ee[e]),delete Ee[e]),Qt(e),P[e]&&(delete P[e],Vt())}function Et(e){St(e)}function In(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=le.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Ge(e),tag:e.id});le.set(e.id,n);let i=()=>{le.get(e.id)===n&&le.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Hi(e){if(!ue())return!1;let t=qn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await ve();if(!i)return!1;await Qt(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||j,body:a,urlPath:et},a=Ge(e),c={body:a,tag:e.id,data:o,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await i.showNotification(e.title,c),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function Ie(e){if(!e||!e.id)return;if(e.category=$(e.category),!e.due||e.done){Et(e.id);return}let t=P[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||j,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Ge(e),urlPath:et,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?f:null})()};if(P[e.id]=n,Vt(),Ee[e.id]&&(clearTimeout(Ee[e.id]),delete Ee[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(P[e.id]?.viaTrigger){St(e.id,{closeNotification:!1});return}In(e),St(e.id,{closeNotification:!1});return}let a=ue();a&&(n.viaTrigger=!1,Hi(e).then(c=>{c&&P[e.id]&&(P[e.id]={...P[e.id],viaTrigger:!0},Vt())})),Ee[e.id]=setTimeout(()=>{a&&Qt(e.id),In(e),St(e.id,{closeNotification:!1})},o)}function he(){Object.values(P).forEach(e=>Ie({...e,category:$(e?.category)}))}function Wi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=xi.format(t),i=Di.format(t),o=vt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function M(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),me(),Z(d),en)try{en.textContent=String(d.length)}catch{}d.forEach(l=>{l&&typeof l=="object"&&(l.category=$(l.category))});let o=new Set(Qi.map(l=>$(l)));d.forEach(l=>{l&&typeof l=="object"&&o.add($(l.category))});let a=Array.from(o).sort((l,p)=>l.localeCompare(p,void 0,{sensitivity:"base"}));if(kt){let l=new Set;Array.from(kt.querySelectorAll("option")).forEach(p=>{l.add(p.value.trim().toLowerCase())}),a.forEach(p=>{let m=p.toLowerCase();if(!l.has(m)){let E=document.createElement("option");E.value=p,kt.appendChild(E),l.add(m)}})}if(Se)Se=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let l=d.map(p=>({...p}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:l}}));else if(document.createEvent){let p=document.createEvent("CustomEvent");p&&p.initCustomEvent&&(p.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:l}),document.dispatchEvent(p))}}catch{}}let c=d.slice();Z(c);let f=!0,g=d.length>0,h=c.length>0,w=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let l=Object.values(P||{}).filter(p=>p&&typeof p=="object"&&p.id);return new Set(l.map(p=>p.id))})();if(xe)if(h)xe.classList.add("hidden");else{let l=g?"No reminders to show right now.":ci;sn?sn(xe,{icon:g?"sparkles":"bell",title:g?"Nothing to display":"Create your first cue",description:l,action:g?void 0:`<button type="button" class="${li}" data-trigger="open-cue">Create reminder</button>`}):xe.textContent=l,xe.classList.remove("hidden")}if(tn&&tn.classList.toggle("has-items",h),!y)return;if(!h){xe?(y.innerHTML="",y.classList.add("hidden")):(y.innerHTML='<div class="text-muted">No reminders found.</div>',y.classList.remove("hidden"));return}y.classList.remove("hidden"),y.replaceChildren();let L=document.createDocumentFragment(),F=y.tagName==="UL"||y.tagName==="OL",K=!0,Ae=(l,p)=>{let m=document.createElement("div");m.className="task-item";let E={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:p,done:!!l.done};m.dataset.category=p,m.dataset.reminder=JSON.stringify(E),m.dataset.id=E.id,m.dataset.title=E.title,m.dataset.priority=E.priority,m.dataset.done=String(E.done),m.dataset.orderIndex=Number.isFinite(l.orderIndex)?String(l.orderIndex):"",m.dataset.reminderItem="true",m.setAttribute("draggable","true"),m.classList.add("reminder-draggable"),m.setAttribute("role","button"),m.tabIndex=0,m.setAttribute("aria-label",`Edit reminder: ${l.title}`),E.dueIso&&(m.dataset.due=E.dueIso),w.has(E.id)?m.dataset.notificationActive="true":delete m.dataset.notificationActive;let B=E.dueIso?new Date(E.dueIso):null;f&&B&&B>=n&&B<=i&&(m.classList.add("is-today"),m.dataset.today="true");let be=l.due?`${vt(new Date(l.due))} \u2022 ${Yt(l.due.slice(0,10))}`:"No due date",Ne=l.due?ye(be):"",It=!!(p&&p!==j)?ye(p):"",Vi=`<span class="task-chip" data-chip="priority">${ye(E.priority)}</span>`,At=[];Ne&&At.push(Ne),It&&At.push(It);let Gi=At.length?`<div class="task-meta-text">${At.join(" \u2022 ")}</div>`:"",zi=l.notes?`<div class="task-notes">${yn(l.notes)}</div>`:"";m.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${ye(l.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn cue-btn delete" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          ${Gi}
          <div class="task-meta">
            ${Vi}
          </div>
          ${zi}
        </div>`;let Ln=m.querySelector("[data-del]");Ln&&Ln.addEventListener("click",te=>{te.stopPropagation(),wn(l.id)});let xn=()=>vn(l.id);return m.addEventListener("click",te=>{te.defaultPrevented||te.target instanceof HTMLElement&&te.target.closest("[data-del]")||xn()}),m.addEventListener("keydown",te=>{te.defaultPrevented||te.target===m&&(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),xn())}),m};if(fe!=="desktop"&&!K){c.forEach(l=>{let p=l.category||j;L.appendChild(Ae(l,p))}),y.appendChild(L);return}let v=new Map;c.forEach(l=>{let p=l.category||j;v.has(p)||v.set(p,[]),v.get(p).push(l)});let T=Array.from(v.entries()).sort((l,p)=>l[0].localeCompare(p[0],void 0,{sensitivity:"base"})),x=!0;T.forEach(([l,p])=>{if(l!==j){let m=document.createElement(F?"li":"div");m.dataset.categoryHeading=l,F&&(m.setAttribute("role","presentation"),m.style.listStyle="none"),m.className=fe==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",x||(m.style.marginTop=fe==="desktop"?"1.25rem":"1rem");let E=document.createElement("div");E.setAttribute("role","heading"),E.setAttribute("aria-level","3"),E.className=fe==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let B=document.createElement("span");B.textContent=l;let ee=document.createElement("span");ee.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",ee.textContent=`${p.length} ${p.length===1?"item":"items"}`,E.append(B,ee),m.appendChild(E),L.appendChild(m)}p.forEach(m=>{if(fe==="desktop"){let E=document.createElement(F?"li":"div"),B={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:l,done:!!m.done};E.dataset.id=B.id,E.dataset.category=B.category,E.dataset.title=B.title,E.dataset.priority=B.priority,E.dataset.done=String(B.done),B.dueIso&&(E.dataset.due=B.dueIso),E.dataset.reminder=JSON.stringify(B),E.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",E.dataset.reminderItem="true",E.setAttribute("draggable","true"),E.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200",w.has(B.id)?E.dataset.notificationActive="true":delete E.dataset.notificationActive;let ee=Wi(m),be=m.done?"line-through text-base-content/50":"text-base-content",Ne=m.done?"Completed":"Active",Tn=m.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",It=m.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Cn=m.notes?`<p class="text-sm leading-relaxed text-base-content/70">${yn(m.notes)}</p>`:"";E.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${be}">${ye(m.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ye(ee)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ye(l)}
            </span>
            <span class="${Tn} text-[0.7rem] sm:text-xs">${Ne}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Cn}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${It}">${m.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,E.querySelector('[data-action="toggle"]').addEventListener("click",()=>ji(m.id)),E.querySelector('[data-action="edit"]').addEventListener("click",()=>vn(m.id)),E.querySelector('[data-action="delete"]').addEventListener("click",()=>wn(m.id)),L.appendChild(E);return}L.appendChild(Ae(m,l))}),x=!1}),y.appendChild(L)}function oe(){Fe?.setAttribute("aria-expanded","false"),Re?.classList.add("hidden")}function Yi(){Fe?.setAttribute("aria-expanded","true"),Re?.classList.remove("hidden")}Fe?.addEventListener("click",e=>{e.stopPropagation(),Fe.getAttribute("aria-expanded")==="true"?oe():Yi()}),document.addEventListener("click",e=>{Re&&!Re.classList.contains("hidden")&&!Re.contains(e.target)&&e.target!==Fe&&oe()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&oe()}),oi.forEach(e=>{e.addEventListener("click",()=>{let t=Qe?.classList.contains("hidden");Qe?.classList.toggle("hidden"),t&&Qe?.scrollIntoView({behavior:"smooth",block:"start"}),oe()})}),document.addEventListener("DOMContentLoaded",()=>{Qe?.classList.add("hidden")});function An(){try{console.log("handleSaveAction invoked",{editingId:Ue,title:b?.value})}catch{}if(Ue){let i=d.find(f=>f.id===Ue);if(!i){Ve();return}let o=b.value.trim();if(!o){I("Add a reminder title");return}let a=null;if(D.value||k.value){let f=D.value||ht(),g=k.value||"09:00";a=mn(f,g)}else{let f=wt(o);f.time&&(a=new Date(`${f.date}T${f.time}:00`).toISOString())}i.title=o;let c=Ft();i.priority=c,Ze(c),A&&(i.category=$(A.value)),i.due=a,R&&(i.notes=R.value.trim()),i.updatedAt=Date.now(),V(i),qe(i),Se=!0,M(),Ie(i),U(),Be(),pe("memoryCue:remindersUpdated",{items:d}),dn(),ne({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Ve(),I("Reminder updated"),pe("cue:close",{reason:"updated"});return}let e=b.value.trim();if(!e){I("Add a reminder title");return}let t=R?R.value.trim():"",n=null;if(D.value||k.value){let i=D.value||ht(),o=k.value||"09:00";n=mn(i,o)}else{let i=wt(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Pi({title:e,priority:Ft(),category:A?A.value:"",due:n,notes:t}),b.value="",k.value="",R&&(R.value=""),pe("cue:close",{reason:"created"})}b?.addEventListener("keydown",e=>{e.key==="Enter"&&An()});function qi(){if(!b||!we)return;let e=b.value.trim();if(!e){we.style.display="none";return}try{let t=wt(e),n=ht();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Yt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(we.textContent=`Parsed: ${i}`,we.style.display="block"):we.style.display="none"}else we.style.display="none"}catch{we.style.display="none"}}return b?.addEventListener("input",Mi(qi,300)),Te?.addEventListener("click",()=>{Ve(),I("Edit cancelled"),pe("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Ve()}),document.addEventListener("cue:prepare",()=>{Ve()}),window.addEventListener("load",()=>b?.focus()),Zn?.addEventListener("click",()=>{let e=d.filter(t=>!t.done).map(t=>{let n=t.due?Yt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(ke,{hour:"2-digit",minute:"2-digit",timeZone:de}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){I("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>I("Copied for Master Task List")).catch(()=>I("Copy failed")),oe()}),Dt?.addEventListener("change",()=>{let e=Dt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let c={...a,id:yt(),category:$(a.category),pendingSync:!q,orderIndex:null};jt(c,{position:"start"}),d=[c,...d],i.push(c)}),Z(d);let o=We(d);M(),U(),o?d.forEach(a=>V(a)):i.forEach(a=>V(a)),I("Import successful")}catch{I("Invalid JSON")}},t.readAsText(e),Dt.value="",oe()}),ei?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),oe()}),ti?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){I("Add your Apps Script URL in Settings first"),oe();return}if(!d.length){I("No tasks to sync"),oe();return}I("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<d.length;i+=t){let o=d.slice(i,i+t),a=await Promise.allSettled(o.map(c=>{let f={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||j,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=a.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}I(`Sync complete: ${d.length-n} ok${n?`, ${n} failed`:""}`),oe()}),Le&&(Le.value=localStorage.getItem("syncUrl")||""),ni?.addEventListener("click",()=>{Le&&(localStorage.setItem("syncUrl",Le.value.trim()),I("Settings saved"))}),ii?.addEventListener("click",async()=>{if(!Le)return;let e=Le.value.trim();if(!e){I("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});I(t.ok?"Test ok":"Test failed")}catch{I("Test failed")}}),Qn?.addEventListener("click",async()=>{if(!("Notification"in window)){I("Notifications not supported");return}if(Notification.permission==="granted"){I("Notifications enabled"),ue()?ve():(Lt(),Sn()),he(),M();return}try{await Notification.requestPermission()==="granted"?(I("Notifications enabled"),ue()?ve():(Lt(),Sn()),he(),M()):I("Notifications blocked")}catch{I("Notifications blocked")}}),vi(),he(),M(),U(),{cancelReminder:Et,scheduleReminder:Ie,closeActiveNotifications:Vn,getActiveNotifications:()=>le,addNoteToReminder:$i,__testing:{setItems(e=[]){d=Array.isArray(e)?e.map(t=>({...t,category:$(t?.category)})):[],d=He(d),Z(d),M()},render:M,getItems:()=>d.map(e=>({...e}))}}}var Un,le,Hn,Gt,zt,Wn,Ct,Ke,Xt,j,Qi,Kt,re,Zi,ae,io=kn(()=>{On();Un="memoryCue:activity",le=new Map,Hn=!1,Gt="service-worker.js",zt="memory-cue-reminder-sync",Wn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Ct=null,Ke=null,Xt=!1,j="General",Qi=Object.freeze([j,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Kt="memoryCue:offlineReminders",re=1024,Zi=Object.freeze({}),ae=null});export{Bn as a,Mn as b,On as c,lo as d,io as e};
