import{a as H,b as q}from"./chunk-LQUIKUZD.js";import{a as U,b as P}from"./chunk-ERL7JLDU.js";import{b as F}from"./chunk-RCZ4YZVR.js";var N=F(()=>{P();q();U();(function(){let n=()=>{let t=document.getElementById("create-sheet"),o=document.getElementById("closeCreateSheet");if(!(t instanceof HTMLElement)||!(o instanceof HTMLElement)){let i=typeof n._retryCount=="number"?n._retryCount:0;i<10&&(n._retryCount=i+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let a=t.querySelector("[data-dialog-content]"),l=t.querySelector(".sheet-backdrop"),s=document.getElementById("createReminderForm"),c=document.getElementById("saveReminder"),p=document.getElementById("priority"),E=document.getElementById("priorityChips"),A=E?Array.from(E.querySelectorAll('input[name="priority"]')):[],L=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),I=Array.from(L).filter(i=>i instanceof HTMLElement),M=I[0]||null,w=()=>{t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open")};w();let u=null,C=(i,S)=>{try{document.dispatchEvent(new CustomEvent(i,{detail:S}))}catch(h){console.warn(`${i} dispatch failed`,h)}},v=()=>{let i=p?.value||"Medium";A.forEach(S=>{let h=S.value===i;S.checked=h,S.setAttribute("aria-checked",h?"true":"false")})},k=i=>{p&&(p.value!==i&&(p.value=i,p.dispatchEvent(new Event("change",{bubbles:!0}))),v())};A.forEach(i=>{i.addEventListener("change",()=>{i.checked&&k(i.value)})}),p?.addEventListener("change",v),v();let x=()=>{let i=t.querySelector('input, textarea, select, button, [contenteditable="true"]');i instanceof HTMLElement&&setTimeout(()=>{try{i.focus()}catch{}},0)},O=i=>{u=i instanceof HTMLElement?i:null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),u&&u.setAttribute("aria-expanded","true"),v(),x(),C("reminder:sheet-opened",{trigger:u})},b=(i="dismissed")=>{let S=!t.classList.contains("hidden");w(),u&&u.setAttribute("aria-expanded","false");let h=u&&document.body.contains(u)&&u||M;if(h&&typeof h.focus=="function")try{h.focus()}catch{}S&&C("reminder:sheet-closed",{reason:i,trigger:u}),u=null};I.forEach(i=>{i.addEventListener("click",S=>{S.preventDefault(),O(i)})}),o.addEventListener("click",i=>{i.preventDefault(),b("close-button")}),l?.addEventListener("click",i=>{i.target===l&&b("backdrop")}),t.addEventListener("keydown",i=>{i.key==="Escape"&&(i.stopPropagation(),b("escape"))}),a?.addEventListener("click",i=>{i.stopPropagation()}),t.addEventListener("click",i=>{i.target instanceof HTMLElement&&i.target.hasAttribute("data-close")&&b("backdrop")}),document.addEventListener("cue:open",i=>{v(),O(i?.detail?.trigger||null)}),document.addEventListener("cue:close",i=>{b(i?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{v()}),document.addEventListener("cue:cancelled",()=>{b("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=b),document.addEventListener("reminder:save",i=>{if(!(c instanceof HTMLElement))return;let S=i?.detail?.trigger;S&&S!==c||c.matches(":disabled")||c.click()}),s instanceof HTMLFormElement&&c instanceof HTMLElement&&s.addEventListener("submit",i=>{i.preventDefault(),!c.matches(":disabled")&&c.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var D=()=>{D._initialised||(D._initialised=!0,H({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D,{once:!0}):D();(()=>{let n=document.getElementById("overflowMenuBtn"),t=document.getElementById("overflowMenu");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let o=()=>{t.classList.contains("hidden")||(t.classList.add("hidden"),n.setAttribute("aria-expanded","false"))};n.addEventListener("click",a=>{a.stopPropagation(),t.classList.contains("hidden")?(t.classList.remove("hidden"),n.setAttribute("aria-expanded","true")):o()}),document.addEventListener("click",()=>{o()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&o()}),t.addEventListener("click",a=>{a.stopPropagation(),a.target instanceof HTMLElement&&a.target.closest("button")&&o()})})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let t=()=>{let l=document.getElementById("voiceBtn");return l instanceof HTMLElement?l:null},o=()=>{let l=t();if(!l)return;let s=()=>{l.hasAttribute("disabled")||l.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let p=l.getAttribute("title");p&&n.setAttribute("title",p)};s(),typeof MutationObserver=="function"&&new MutationObserver(s).observe(l,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o();let a=()=>{let l=t();if(l&&!(l.hasAttribute("disabled")||l.getAttribute("aria-disabled")==="true")){try{l.focus({preventScroll:!0})}catch{try{l.focus()}catch{}}try{l.click()}catch(s){console.warn("Voice add trigger failed",s)}}};n.addEventListener("click",l=>{l.preventDefault();let s=!1,c=null,p=()=>{s||(s=!0,document.removeEventListener("reminder:sheet-opened",E),a())},E=L=>{if(L?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&c&&(window.clearTimeout(c),c=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,150)};document.addEventListener("reminder:sheet-opened",E);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(L){document.removeEventListener("reminder:sheet-opened",E),typeof window<"u"&&typeof window.clearTimeout=="function"&&c&&(window.clearTimeout(c),c=null),console.warn("Voice add open failed",L);return}let A=document.getElementById("create-sheet");A instanceof HTMLElement&&A.classList.contains("open")&&(c=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),t=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let o=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],a=()=>{let s=t.hasAttribute("open");n.setAttribute("aria-expanded",String(s)),n.classList.toggle("btn-active",s)},l=()=>{for(let s of o){let c=t.querySelector(s);if(c instanceof HTMLElement&&!c.hasAttribute("disabled")){try{c.focus({preventScroll:!0})}catch{c.focus()}return}}};n.addEventListener("click",()=>{let s=t.hasAttribute("open");t.open=!s,s||l(),a()}),t.addEventListener("toggle",a),a()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let o=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(o)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let o=document.createElement("div");o.textContent="Save clicked",o.style.position="fixed",o.style.right="16px",o.style.bottom="16px",o.style.background="rgba(34,197,94,0.95)",o.style.color="#fff",o.style.padding="8px 12px",o.style.borderRadius="8px",o.style.zIndex="99999",document.body.appendChild(o),setTimeout(()=>o.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let o=20;n.innerHTML="";let a=0;function l(){let p=t.slice(a,a+o);p.forEach(E=>n.appendChild(E)),a+=p.length}l();let s=document.createElement("div");s.id="listSentinel",n.appendChild(s);let c=new IntersectionObserver(p=>{p.some(E=>E.isIntersecting)&&a<t.length&&(l(),a>=t.length&&c.disconnect())});c.observe(s)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),o=document.getElementById("closeSettings");if(!n||!t||!o)return;function a(){t.classList.remove("hidden")}function l(){t.classList.add("hidden")}n.addEventListener("click",a),o.addEventListener("click",l),t.addEventListener("click",s=>{s.target instanceof HTMLElement&&s.target.matches("[data-close]")&&l()}),t.addEventListener("keydown",s=>{s.key==="Escape"&&l()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("mcStatus"),o=document.getElementById("mcStatusText"),a=document.getElementById("syncUrl"),l=document.getElementById("saveSyncSettings"),s=document.getElementById("testSync"),c=document.getElementById("syncAll"),p="syncUrl";if(!o)return;let E=["online","offline","error"],A=["online","offline"],L={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},I={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},M=null;function w(e){if(!t)return;A.forEach(m=>t.classList.remove(m));let r=e!=="offline"&&e!=="error";t.classList.add(r?"online":"offline"),t.setAttribute("aria-label",r?"Online":"Offline")}function u(e,r){M=e,E.forEach(f=>o.classList.remove(f)),n&&E.forEach(f=>n.classList.remove(f)),e==="online"?(o.classList.add("online"),n&&n.classList.add("online")):e==="error"?(o.classList.add("error"),n&&n.classList.add("error")):(o.classList.add("offline"),n&&n.classList.add("offline"));let m=typeof r=="string"&&r.trim()?r.trim():L[e]||"",g=typeof r=="string"&&r.trim()?r.trim():I[e]||m,y=m||g||"";o.textContent=y,y?(o.setAttribute("title",y),o.setAttribute("aria-label",y)):(o.removeAttribute("title"),o.removeAttribute("aria-label")),w(e),o.dataset.state=e}function C(){M!=="syncing"&&u(navigator.onLine?"online":"offline")}function v(e){typeof localStorage>"u"||(e?localStorage.setItem(p,e):localStorage.removeItem(p))}function k(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(p)||""}catch{return""}}function x(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,m=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!m)return null;let g=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,y=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",f=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",d=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:m,dueIso:g&&g.trim()?g.trim():null,priority:y,category:f,done:d}}function O(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let m=r.dataset||{},g=null;if(m.reminder)try{g=JSON.parse(m.reminder)}catch{g=null}let y=g||{id:m.id||m.reminderId||r.getAttribute("data-id")||null,title:m.title||m.reminderTitle||"",dueIso:m.due||m.reminderDue||r.getAttribute("data-due")||null,priority:m.priority||m.reminderPriority||r.getAttribute("data-priority")||"",category:m.category||m.reminderCategory||r.getAttribute("data-category")||"",done:m.done==="true"||m.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!y.title){let f=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");f&&(y.title=f.textContent.trim())}if(!y.dueIso){let f=r.querySelector("[data-due], time");if(f){let d=f.getAttribute("datetime")||f.getAttribute("data-due");y.dueIso=d||f.textContent.trim()}}return x(y)}).filter(Boolean):[]}function b(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(g=>{if(!r.has(g)){r.add(g);try{let y=localStorage.getItem(g);if(!y)return;let f=JSON.parse(y);Array.isArray(f)?f.forEach(d=>e.push(d)):f&&typeof f=="object"&&(Array.isArray(f.items)&&f.items.forEach(d=>e.push(d)),Array.isArray(f.reminders)&&f.reminders.forEach(d=>e.push(d)))}catch{}}}),!e.length)for(let g=0;g<localStorage.length;g+=1){let y=localStorage.key(g);if(!(!y||r.has(y)||!/remind/i.test(y))){r.add(y);try{let f=localStorage.getItem(y);if(!f)continue;let d=JSON.parse(f);Array.isArray(d)?d.forEach(T=>e.push(T)):d&&typeof d=="object"&&(Array.isArray(d.items)&&d.items.forEach(T=>e.push(T)),Array.isArray(d.reminders)&&d.reminders.forEach(T=>e.push(T)))}catch{}}}return e.map(x).filter(Boolean)}function i(){let e=O();return e.length?e:b()}function S(e){e?(c?.setAttribute("aria-busy","true"),c?.setAttribute("disabled","disabled"),s?.setAttribute("aria-busy","true"),s?.setAttribute("disabled","disabled")):(c?.removeAttribute("aria-busy"),s?.removeAttribute("aria-busy"),h())}function h(){!!((a?.value||"").trim()||k())?(c?.removeAttribute("disabled"),s?.removeAttribute("disabled")):(c?.setAttribute("disabled","disabled"),s?.setAttribute("disabled","disabled"))}let R=k();a&&R&&(a.value=R),h(),u(navigator.onLine?"online":"offline"),window.addEventListener("online",C),window.addEventListener("offline",C),a?.addEventListener("input",h),l?.addEventListener("click",()=>{let e=(a?.value||"").trim();if(!e){v(""),u("info","Sync URL cleared. Add one to enable sync."),h();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{u("error","Enter a valid sync URL before saving.");return}v(e),u("online","Sync settings saved."),h()}),s?.addEventListener("click",async()=>{let e=(a?.value||k()).trim();if(!e){u("error","Add your sync URL in Settings first.");return}S(!0),u("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?u("online","Connection looks good."):u("error","Test failed. Check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),u("error","Test failed. Check your Apps Script deployment.")}finally{S(!1)}}),c?.addEventListener("click",async()=>{let e=(a?.value||k()).trim();if(!e){u("error","Add your sync URL in Settings first.");return}let r=i();if(!r.length){u("info","Nothing to sync right now.");return}S(!0),u("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let m=20,g=0,y=0,f=d=>({id:d.id,title:d.title,dueIso:d.dueIso||null,priority:d.priority||"Medium",category:d.category||"General",done:!!d.done,source:"memory-cue-mobile"});try{for(let d=0;d<r.length;d+=m){let T=r.slice(d,d+m);(await Promise.allSettled(T.map(B=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f(B))})))).forEach(B=>{B.status==="fulfilled"&&B.value?.ok?g+=1:(B.status,y+=1)}),await new Promise(B=>setTimeout(B,300))}y?g?u("error",`Partial sync: ${g} success, ${y} failed.`):u("error","Sync failed. Check your sync URL and retry."):u("online",`Sync complete. ${g} updated.`)}catch(d){console.error("Sync failed",d),u("error","Sync failed. Try again soon.")}finally{S(!1)}})})()});export default N();
