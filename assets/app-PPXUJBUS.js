import{a as Q,b as Be}from"./chunk-KIEDEXT4.js";import{b as De}from"./chunk-RCZ4YZVR.js";var st=De(()=>{Be();var y=document.getElementById("cue-modal")??document.getElementById("cue_modal"),de=document.getElementById("openCueModal"),xe=document.getElementById("closeCueModal"),Ae=y?.querySelector(".modal-backdrop button"),N=document.getElementById("title"),Fe=document.getElementById("reminderText"),Ie=()=>{N&&window.setTimeout(()=>{try{N.focus({preventScroll:!0})}catch{N.focus()}},50)},Z=()=>{!y||typeof y.showModal!="function"||(y.open||y.showModal(),Ie())},ue=()=>{y&&y.open&&y.close()};de?.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("cue:prepare",{detail:{mode:"create"}})),Z()});xe?.addEventListener("click",()=>{let e={reason:"user-dismissed"};document.dispatchEvent(new CustomEvent("cue:cancelled",{detail:e})),document.dispatchEvent(new CustomEvent("cue:close",{detail:e}))});Ae?.addEventListener("click",()=>{let e={reason:"backdrop"};document.dispatchEvent(new CustomEvent("cue:cancelled",{detail:e})),document.dispatchEvent(new CustomEvent("cue:close",{detail:e}))});y?.addEventListener("cancel",e=>{e.preventDefault();let t={reason:"keyboard"};document.dispatchEvent(new CustomEvent("cue:cancelled",{detail:t})),document.dispatchEvent(new CustomEvent("cue:close",{detail:t}))});document.addEventListener("cue:open",()=>{Z()});document.addEventListener("cue:close",()=>{ue(),de?.focus()});var Me=()=>{let e=!!N,t=!!Fe;return!e&&!t?Promise.resolve():t?Q({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",defaultFilter:"all",countTodaySel:"#todayCount",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge",countCompletedSel:"#completedCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",dateFeedbackSel:"#dateFeedback"}):Q({titleSel:"#title",dateSel:"#date",timeSel:"#time",detailsSel:"#details",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveBtn",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",statusSel:"#status",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",filterBtnsSel:"[data-filter]",sortSel:"#sort",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",defaultFilter:"today",countTodaySel:"#inlineTodayCount",countOverdueSel:"#inlineOverdueCount",countTotalSel:"#inlineTotalCount",countCompletedSel:"#inlineCompletedCount",emptyStateSel:"#emptyState",listWrapperSel:"#remindersWrapper",dateFeedbackSel:"#dateFeedback",variant:"desktop"})};Me().catch(e=>{console.error("Failed to initialise reminders",e)});var b=document.getElementById("cues-list"),k=document.getElementById("cue-form"),u=k?.querySelector("#cue-id-input"),p=document.getElementById("modal-title"),G=p?.textContent?.trim()||"",Re="Edit Cue",q=document.getElementById("tab-cues"),O=document.getElementById("tab-daily"),D=document.getElementById("cues-view"),B=document.getElementById("daily-list-view"),ce=document.getElementById("daily-list-header"),fe=document.getElementById("quick-add-form"),d=document.getElementById("quick-add-input"),f=document.getElementById("daily-voice-btn"),S=document.getElementById("daily-tasks-container"),W=document.getElementById("clear-completed-btn"),U=document.getElementById("daily-list-permission-notice"),He=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],Pe={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},X=He.map(({key:e,ids:t})=>{for(let n of t){let o=n?document.getElementById(n):null;if(o)return{key:e,element:o}}return null}).filter(e=>e&&e.element),Ne={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},R=null;function J(e,t){if(!e||typeof e!="object")return"";let n=Pe[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let i=e[o];return i==null?"":typeof i=="string"?i:String(i)}return""}function Ve(e,t){let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function _e(e){return e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:""}function qe(e){X.forEach(({key:t,element:n})=>{let o=e&&typeof e=="object"?J(e,t):"";Ve(n,o)})}function Oe(){X.forEach(({element:e})=>{e instanceof HTMLInputElement?["checkbox","radio"].includes(e.type)?e.checked=!1:e.value="":(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value="")}),u&&(u.value=""),p&&(p.textContent=G)}function Ue(){let e={};return X.forEach(({key:t,element:n})=>{let o=_e(n);if(typeof o=="boolean"){e[t]=o;return}let i=typeof o=="string"?o.trim():o;e[t]=i??""}),e}function C(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}function $e(e){if(!b)return;if(!Array.isArray(e)||e.length===0){b.innerHTML='<p class="text-sm text-base-content/60">No cues yet.</p>';return}let t=e.map(n=>{let o=C(J(n,"title")||"Untitled Cue"),i=C(J(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${i?`<p>${i}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${C(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${C(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");b.innerHTML=t}async function j(){return R||(R=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:i,collection:r,doc:a,getDoc:l,addDoc:A,updateDoc:F,getDocs:g,query:h,orderBy:I,serverTimestamp:ke,setDoc:Ee,arrayUnion:Te}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),z=t(),Le=z&&z.length?z[0]:e(Ne),M=n(Le);(function(){let K=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;K&&(K.__persistenceInitialized__||(K.__persistenceInitialized__=!0,(async()=>{try{await o(M),console.info("[Firestore] Persistence: multi-tab enabled")}catch(E){if(E&&E.code==="failed-precondition")try{await i(M),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(ae){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",ae?.code||ae)}else E&&E.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",E?.code||E)}})()))})();let Ce=r(M,"cues");return{db:M,cuesCollection:Ce,getCollection:r,doc:a,getDoc:l,addDoc:A,updateDoc:F,getDocs:g,query:h,orderBy:I,serverTimestamp:ke,setDoc:Ee,arrayUnion:Te}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),R)}async function je(){let e=await j(),{getDocs:t,cuesCollection:n,query:o,orderBy:i}=e,r=o&&i?o(n,i("createdAt","desc")):n;return(await t(r)).docs.map(l=>({id:l.id,...l.data()}))}async function ze(e){if(!e)return null;let t=await j(),{db:n,doc:o,getDoc:i}=t,r=o(n,"cues",e),a=await i(r);return a.exists()?{id:a.id,...a.data()}:null}async function me(){if(b)try{let e=await je();$e(e)}catch(e){console.error("Failed to load cues",e)}}function Ke(e){!k||!u||(qe(e),u.value=e?.id||"",p&&(p.textContent=Re),Z())}async function Qe(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await ze(n);if(!o)return;Ke(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function Ye(e){if(e.preventDefault(),!k||!u)return;let t=u.value.trim(),n=Ue();try{let o=await j(),{db:i,doc:r,addDoc:a,updateDoc:l,cuesCollection:A,serverTimestamp:F}=o,g=typeof F=="function"?F():null;if(t){let h=r(i,"cues",t),I={...n};g&&(I.updatedAt=g),await l(h,I)}else{let h={...n};g&&(h.createdAt=g,h.updatedAt=g),await a(A,h)}await me(),Oe(),ue()}catch(o){console.error("Failed to save cue",o)}}async function Ge(){!k||!u||!b||(await me(),b.addEventListener("click",Qe),k.addEventListener("submit",Ye))}k&&u&&(document.addEventListener("cue:prepare",()=>{u&&(u.value=""),p&&(p.textContent=G)}),document.addEventListener("cue:close",()=>{u&&(u.value=""),p&&(p.textContent=G)}));k&&u&&b&&Ge().catch(e=>{console.error("Failed to initialise cue editing",e)});var s=[],H=null,w=!1,ye="dailyTasksByDate",P=null;function ee(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function We(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),i=Number.parseInt(t,10),r=Number.parseInt(n,10),a=Number.parseInt(o,10);if(!Number.isFinite(i)||!Number.isFinite(r)||!Number.isFinite(a))return e;let l=new Date(i,r-1,a);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(l)}function x(e){if(!W)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);W.disabled=!t}function v(e){if(!S)return;if(!Array.isArray(e)||e.length===0){S.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',x([]);return}let t=e.map((n,o)=>{let i=C(n?.text||""),r=!!n?.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return r&&a.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${i}" ${r?"checked":""} />
          <span class="${a.join(" ")}">${i}</span>
        </div>
      `}).join("");S.innerHTML=t,x(e)}function $(){U&&U.classList.remove("hidden")}function Je(){U&&U.classList.add("hidden")}function te(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function L(e){return Array.isArray(e)?e.map(t=>te(t)):[]}function ne(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(ye);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function pe(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(ye,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function le(e){let t=ne(),n=t&&typeof t=="object"?t[e]:[];return L(n)}function V(e,t){let n=ne(),o=L(t);return n[e]=o,pe(n),o}function Y(e,t){let n=ne(),o=L(n[e]);return o.push(te(t)),n[e]=o,pe(n),o}function oe(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function ie(){return P||(P=j().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),P)}function re(e,t){let{doc:n,dailyListsCollection:o,db:i}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(i,"dailyLists",t)}async function ge(){if(!ce||!S)return;let e=ee(),t=We(e);if(ce.textContent=t?`Today's List - ${t}`:"Today's List",w){$();let n=le(e);return s=n,v(n),Promise.resolve(n)}return H||(S.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',x([]),H=(async()=>{try{let n=await ie(),o=re(n,e),i=await n.getDoc(o),r=i.exists()?i.data()?.tasks:[];s=L(r),v(s),V(e,s),w=!1,Je()}catch(n){if(oe(n)){console.warn("Falling back to local daily tasks due to permission issue",n),w=!0,$();let o=le(e);s=o,v(o);return}console.error("Failed to load daily list",n),S.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',s=[],x(s)}})().finally(()=>{H=null})),H}async function Ze(e){let t=ee(),n=te(e);if(w){Y(t,n);return}try{let o=await ie(),i=re(o,t),r=await o.getDoc(i);if(r.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(i,{tasks:o.arrayUnion(n)});else{let a=r.exists()?r.data()?.tasks:[],l=Array.isArray(a)?L(a):[];l.push(n),typeof o.setDoc=="function"?await o.setDoc(i,{tasks:l},{merge:!0}):await o.updateDoc(i,{tasks:l})}Y(t,n)}catch(o){if(oe(o)){console.warn("Saving task locally because cloud sync is unavailable",o),w=!0,$(),Y(t,n);return}throw o}}async function he(e){let t=ee(),n=L(e);if(w){V(t,n);return}try{let o=await ie(),i=re(o,t);typeof o.setDoc=="function"?await o.setDoc(i,{tasks:n},{merge:!0}):await o.updateDoc(i,{tasks:n}),V(t,n)}catch(o){if(oe(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),w=!0,$(),V(t,n);return}throw o}}function be(e){[q,O].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function Xe(){!D||!B||(D.classList.remove("hidden"),B.classList.add("hidden"),be(q))}function et(){!D||!B||(D.classList.add("hidden"),B.classList.remove("hidden"),be(O),ge())}q&&O&&D&&B&&(q.addEventListener("click",e=>{e.preventDefault(),Xe()}),O.addEventListener("click",e=>{e.preventDefault(),et()}));var c=null,m=!1,_=null;function T(e){if(!f)return;f.setAttribute("aria-pressed",e?"true":"false");let t=f.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":f.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function tt(){m&&(window.clearTimeout(_),_=window.setTimeout(()=>{_=null,m&&Se(!0)},400))}function Se(e=!1){if(!c)return!1;if(m&&!e)return!0;try{return c.start(),m=!0,T(!0),!0}catch{return m=!1,T(!1),!1}}function se(){if(c){m=!1,window.clearTimeout(_);try{c.stop()}catch{}T(!1)}}function nt(){if(f)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){f.setAttribute("disabled","true"),f.setAttribute("aria-disabled","true"),f.title="Voice input is not supported in this browser.";return}c=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(c.lang=t,c.interimResults=!1,"continuous"in c)try{c.continuous=!0}catch{}c.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&d){d.value=o.trim();try{d.focus({preventScroll:!0})}catch{d.focus()}try{let i=d.value.length;d.setSelectionRange(i,i)}catch{}}},c.onend=()=>{if(!m){T(!1);return}tt()},c.onerror=()=>{m=!1,T(!1)}}catch{c=null,T(!1),f.setAttribute("disabled","true"),f.setAttribute("aria-disabled","true")}}nt();f?.addEventListener("click",()=>{c&&(m?se():Se())});fe?.addEventListener("submit",()=>{m&&se()});window.addEventListener("pagehide",()=>{m&&se()});fe?.addEventListener("submit",async e=>{if(e.preventDefault(),!d)return;let t=d.value.trim();if(!t){d.focus();return}let n={text:t,completed:!1};d.value="",d.focus();try{await Ze(n),await ge()}catch(o){console.error("Failed to add task to the daily list",o),d.value=t,d.focus()}});S?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(s)||Number.isNaN(n)||!s[n])return;let o=s.map(r=>({...r})),i=o.map((r,a)=>a===n?{...r,completed:t.checked}:r);s=i,v(i);try{await he(i)}catch(r){console.error("Failed to update task completion state",r),s=o,v(o)}});W?.addEventListener("click",async()=>{if(!Array.isArray(s)||s.length===0)return;let e=s.filter(n=>!n.completed);if(e.length===s.length)return;let t=s.map(n=>({...n}));s=e,v(e);try{await he(e)}catch(n){console.error("Failed to clear completed tasks",n),s=t,v(t)}});x(s);var we="theme",ot=document.getElementById("theme-menu");function ve(e){if(typeof e!="string"||!e.trim())return;let t=e.trim();document.documentElement.setAttribute("data-theme",t);let n=new Set(["dark","dracula","synthwave"]);document.documentElement.classList.toggle("dark",n.has(t))}function it(e){if(typeof e!="string"||!e.trim())return;let t=e.trim();try{localStorage.setItem(we,t)}catch(n){console.warn("Unable to save theme preference",n)}}function rt(){let e="";try{e=localStorage.getItem(we)||""}catch(t){console.warn("Unable to load theme preference",t)}e&&ve(e)}ot?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest("[data-theme-name]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-theme-name");n&&(ve(n),it(n))});rt()});export default st();
