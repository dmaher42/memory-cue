import{b as fn,c as ko}from"./chunk-QHE5AMPX.js";import{a as _i,b as qn,c as Co}from"./chunk-GUVSRPRW.js";function Ui(o={}){try{Object.assign(H,o||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function $i(o={}){try{if(H&&typeof H.signInWithPopup=="function"&&H.auth&&typeof H.GoogleAuthProvider=="function")return H.signInWithPopup(H.auth,new H.GoogleAuthProvider);if(H&&typeof H.signInWithRedirect=="function"&&H.auth&&typeof H.GoogleAuthProvider=="function")return H.signInWithRedirect(H.auth,new H.GoogleAuthProvider);let r=fn();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...o});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{H?.toast?.("Sign-in failed")}catch(l){console.warn("[supabase-auth] toast handler failed",l)}throw r}return Promise.resolve(null)}async function qi(){try{if(H&&typeof H.signOut=="function")return H.signOut(H.auth);let o=fn();if(o&&o.auth&&typeof o.auth.signOut=="function")return o.auth.signOut()}catch(o){throw console.error("[supabase-auth] startSignOutFlow error",o),o}return Promise.resolve(null)}function xo(o){return o?Array.isArray(o)?o:[o]:[]}function Tt(o){return Array.from(new Set(o.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function ce(o,r){let l=xo(r).filter(Boolean);if(!l.length)return[];let h=l.flatMap(T=>Array.from(o.querySelectorAll(T)));return Tt(h)}function No(o,r=document){let l=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:ce(l,o.authForm),emailInputs:ce(l,o.emailInput),signInButtons:ce(l,o.signInButtons),signOutButtons:ce(l,o.signOutButtons),userBadges:ce(l,o.userBadge),userBadgeEmails:ce(l,o.userBadgeEmail),userBadgeInitials:ce(l,o.userBadgeInitial),userNameEls:ce(l,o.userName),syncStatusEls:ce(l,o.syncStatus),syncStatusTextEls:ce(l,o.syncStatusText),statusIndicatorEls:ce(l,o.statusIndicator),feedbackEls:ce(l,o.feedback)}}function vt(o,r){Tt(Array.isArray(o)?o:[o]).forEach(l=>{l instanceof HTMLElement&&(l.classList.toggle("hidden",!r),r?l.removeAttribute("hidden"):l.setAttribute("hidden",""))})}function Be(o,r){Tt(Array.isArray(o)?o:[o]).forEach(l=>{l instanceof HTMLElement&&(l.textContent=r||"")})}function Ro(o,r){Tt(o).forEach(l=>{l instanceof HTMLElement&&(l.dataset.state=r,l.classList.toggle("online",r==="online"),l.classList.toggle("offline",r!=="online"))})}function St(o,r){Tt(o).forEach(l=>{if(!(l instanceof HTMLElement))return;l.textContent=r||"";let h=!!r;l.classList.toggle("hidden",!h),h?l.removeAttribute("hidden"):l.setAttribute("hidden","")})}function ji(o={}){let r={...Hi.syncStatusText,...o.syncStatusText||{}};return{...Hi,...o,syncStatusText:r}}function Et(o,{user:r,messages:l}={}){let h=ji(l),T=!!r;vt(o.signInButtons,!T),vt(o.authForms,!T),vt(o.signOutButtons,T),vt(o.userBadges,T);let x=typeof r?.email=="string"?r.email:"",F=x?x.charAt(0).toUpperCase():"U";T?(Be(o.userBadgeEmails,x),Be(o.userBadgeInitials,F),Be(o.userNameEls,x)):(Be(o.userBadgeEmails,""),Be(o.userBadgeInitials,""),Be(o.userNameEls,""));let ee=typeof h.signedIn=="function"?h.signedIn(r):h.signedIn,C=typeof h.signedOut=="function"?h.signedOut(r):h.signedOut,te=T?ee:C,oe=!T;o.syncStatusEls.length&&(Be(o.syncStatusEls,te),o.syncStatusEls.forEach(Ee=>{Ee instanceof HTMLElement&&(Ee.classList.toggle("online",T),Ee.dataset.state=T?"online":"offline")}),vt(o.syncStatusEls,oe));let E=T?h.syncStatusText?.signedIn:h.syncStatusText?.signedOut;Be(o.syncStatusTextEls,E||""),Ro(o.statusIndicatorEls,T?"online":"offline"),St(o.feedbackEls,"")}function Fo(o,r){r.authForms.forEach(l=>{!(l instanceof HTMLFormElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("submit",async h=>{h.preventDefault();let T=r.emailInputs.find(F=>l.contains(F))||l.querySelector('input[type="email"]'),x=typeof T?.value=="string"?T.value.trim():"";if(!x){St(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:F}=await o.auth.signInWithOtp({email:x});F?St(r.feedbackEls,F.message||"Unable to send magic link."):St(r.feedbackEls,"Magic link sent. Check your email.")}catch(F){St(r.feedbackEls,F?.message||"Unable to send magic link.")}}))})}function Bo(o,r){r.signOutButtons.forEach(l=>{!(l instanceof HTMLElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("click",async()=>{try{await o.auth.signOut()}catch(h){console.error("[supabase] Sign-out failed.",h)}}))})}function Jo(o={}){let{supabase:r,scope:l=document,selectors:h={},messages:T={},disableButtonBinding:x=!1,onSessionChange:F}=o,ee={...Do,...h},C=No(ee,l),te=ji(T);Et(C,{user:null,messages:te});let oe=r||fn()||(typeof window<"u"?window.supabase:null);if(!oe)return{supabase:null,elements:C,applyAuthState:se=>Et(C,{...se,messages:te}),destroy(){}};Fo(oe,C),x||Bo(oe,C);let E=[],{data:Ee}=oe.auth.onAuthStateChange((se,pe)=>{if(Et(C,{user:pe?.user??null,messages:te}),typeof F=="function")try{F(pe?.user??null,pe)}catch(Qe){console.error("[supabase] onSessionChange handler failed.",Qe)}});return Ee?.subscription&&E.push(()=>{try{Ee.subscription.unsubscribe()}catch{}}),oe.auth.getSession().then(({data:se,error:pe})=>{pe||Et(C,{user:se?.session?.user??null,messages:te})}).catch(se=>{console.error("[supabase] getSession failed.",se)}),{supabase:oe,elements:C,applyAuthState:se=>Et(C,{...se,messages:te}),destroy(){E.forEach(se=>{try{se()}catch{}})}}}var H,Do,Hi,Vi=qn(()=>{ko();H={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};Do={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},Hi={signedOut:"",signedIn:o=>`Reminders syncing for ${o?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Ki=Co((Zo,At)=>{var pn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Wi(o){if(!o||typeof o!="object")return null;let r=Object.entries(o).filter(([l,h])=>typeof h=="string"&&h.trim()!=="");return r.length?Object.fromEntries(r):null}function Mo(){let o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=Wi(o?.__FIREBASE_CONFIG);if(r)return r;let l=Wi(o?.__ENV?.FIREBASE_CONFIG);if(l)return l;let T=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((x,[F,ee])=>{let C=o?.__ENV?.[F]??o?.[F];return typeof C=="string"&&C.trim()!==""&&(x[ee]=C),x},{});return Object.keys(T).length?T:null}function Gi(){let o=Mo();return o?{...pn,...o}:{...pn}}var Yi={DEFAULT_FIREBASE_CONFIG:pn,getFirebaseConfig:Gi};if(typeof globalThis<"u"){let o=globalThis;o.memoryCueFirebase=o.memoryCueFirebase||{},o.memoryCueFirebase.getFirebaseConfig=Gi,o.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=pn}typeof At<"u"&&At.exports&&(At.exports=Yi,At.exports.default=Yi)});function _o(){if(ve)return{...ve};let r=Xn()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return ve=r.getFirebaseConfig(),{...ve};if(typeof _i=="function")try{let l=Ki();if(l){let h=typeof l.getFirebaseConfig=="function"?l.getFirebaseConfig:typeof l.default?.getFirebaseConfig=="function"?l.default.getFirebaseConfig:null;if(h)return ve=h(),{...ve}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(ve={...r.DEFAULT_FIREBASE_CONFIG},{...ve}):(ve={...Po},{...ve})}function Xn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Zi(){let o=Xn(),r=o&&o.TimestampTrigger;return typeof r=="function"?r:null}function ke(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Zi()}function Ho(){if(typeof window>"u"||!window.location)return jn;try{return new URL(jn,window.location.href).href}catch{return jn}}async function Me(){return mn||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(mn=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Ho()),await navigator.serviceWorker.ready}catch(o){return console.warn("Service worker registration failed",o),null}})(),mn))}async function Qi(o){if(!o||typeof o!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await Me();if(!r)return!1;let l=new Set;navigator.serviceWorker.controller&&l.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(T=>{let x=r[T];x&&l.add(x)});let h=!1;return l.forEach(T=>{try{T.postMessage(o),h=!0}catch(x){console.warn("Failed posting message to service worker",x)}}),h}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function hn(){if(ke())return!1;if(Wn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(It)try{return await It}catch{}It=(async()=>{let o=await Me();if(!o)return!1;let r=!1;if("periodicSync"in o)try{let l=await o.periodicSync.getTags();(!Array.isArray(l)||!l.includes(Vn))&&await o.periodicSync.register(Vn,{minInterval:15*60*1e3}),r=!0}catch(l){console.warn("Periodic background sync unavailable",l)}if(!r&&"sync"in o)try{await o.sync.register(Vn),r=!0}catch(l){console.warn("Background sync unavailable",l)}return r})();try{let o=await It;return o&&(Wn=!0),o}catch(o){return console.warn("Background reminder sync setup failed",o),Wn=!1,!1}finally{It=null}}async function Gn(o=[],{requestCheck:r=!1}={}){if(!ke()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let l=await Me();if(!l)return;let h=await Qi({type:Ji.updateScheduledReminders,reminders:Array.isArray(o)?o:[]});if(r&&await Qi({type:Ji.checkScheduledReminders}),!h&&typeof l.update=="function")try{await l.update()}catch{}}catch(l){console.warn("Failed syncing reminders with service worker",l)}}async function Kn(o,r){if(ke())try{let l=r||await Me();if(!l)return;let h=[];try{h=await l.getNotifications({tag:o,includeTriggered:!0})}catch{h=await l.getNotifications({tag:o})}for(let T of h)try{T.close()}catch{}}catch{}}function er(){for(let o of Array.from(Ce.values()))try{o.close()}catch{}Ce.clear()}function Uo(){if(zi||typeof window>"u"||typeof window.addEventListener!="function")return;let o=()=>er();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,o)}catch{}}),zi=!0}function G(o){if(typeof o=="string"){let r=o.replace(/\s+/g," ").trim();if(r)return r}return j}async function ts(o={}){let r=e=>e?document.querySelector(e):null,l=e=>e?Array.from(document.querySelectorAll(e)):[],h=r(o.titleSel),T=r(o.dateSel),x=r(o.timeSel),F=r(o.detailsSel),ee=r(o.prioritySel),C=r(o.categorySel),te=r(o.saveBtnSel),oe=r(o.cancelEditBtnSel),E=r(o.listSel),Ee="reminder-title-pinned",se="reminder-title-unpinned",pe=r(o.detailPanelSel),Qe=r(o.detailEmptySel),yn=r(o.detailContentSel),Lt=r(o.detailTitleSel),Ct=r(o.detailDueSel),kt=r(o.detailPrioritySel),Dt=r(o.detailCategorySel),Se=r(o.detailNotesSel),Jn=Se?.dataset?.placeholder||"No notes added yet.",tr=r(o.detailClearSel),xt=l(o.googleSignInBtnSel),Nt=l(o.googleSignOutBtnSel),P=r(o.statusSel),V=r(o.syncStatusSel),nr={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},ir=6e3,ae=null,Rt=null;function Ue(e,{clearMessage:t=!0}={}){ae&&(e&&ae.tokenId!==e||(ae.timeoutId&&clearTimeout(ae.timeoutId),t&&P&&P.dataset.undoToken===ae.tokenId&&(typeof P.replaceChildren=="function"?P.replaceChildren():P.textContent="",delete P.dataset.undoToken,delete P.dataset.statusKind),ae=null))}function rr(e){if(!P)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>go(e.tokenId)),e.button=i,typeof P.replaceChildren=="function"?P.replaceChildren(t,n,i):(P.textContent="",P.append(t,n,i)),P.dataset.statusKind="undo",P.dataset.undoToken=e.tokenId}function Ze(e){if(!pe)return;let t=!!e;if(pe.dataset.state=t?"active":"empty",pe.dataset.selectedId=t&&e?.id?e.id:"",Qe&&(Qe.classList.toggle("hidden",t),Qe.setAttribute("aria-hidden",t?"true":"false")),yn&&(yn.classList.toggle("hidden",!t),yn.setAttribute("aria-hidden",t?"false":"true")),!t){Lt&&(Lt.textContent=""),Ct&&(Ct.textContent=""),kt&&(kt.textContent=""),Dt&&(Dt.textContent=""),Se&&(Se.textContent=Jn,Se.dataset.empty="true");return}if(Lt&&(Lt.textContent=e.title||"Untitled reminder"),Ct&&(Ct.textContent=xi(e)),kt&&(kt.textContent=e.priority||"Medium"),Dt&&(Dt.textContent=e.category||j),Se){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Se.textContent=n,Se.dataset.empty="false"):(Se.textContent=Jn,Se.dataset.empty="true")}}function Qn(){Rt=null,Ze(null)}function or(e){Rt=e?.id||null,Ze(e||null)}function sr(){if(!pe)return;if(!Rt){Ze(null);return}let e=f.find(t=>t?.id===Rt);if(e){Ze(e);return}Qn()}Ze(null);function gn(e,t){if(!V)return;let n=["online","offline","error"];n.forEach(a=>V.classList.remove(a)),n.includes(e)&&V.classList.add(e),V.dataset.state=e;let i=typeof t=="string"?t:nr[e]||"";e==="online"||e==="offline"?(V.textContent="",V.dataset.compact="true",i?(V.setAttribute("aria-label",i),V.setAttribute("title",i)):(V.removeAttribute("aria-label"),V.removeAttribute("title"))):(V.textContent=i,V.removeAttribute("data-compact"),i?(V.setAttribute("aria-label",i),V.setAttribute("title",i)):(V.removeAttribute("aria-label"),V.removeAttribute("title")))}let z=r(o.notesSel),ar=r(o.saveNotesBtnSel),dr=r(o.loadNotesBtnSel),Zn=r(o.countTotalSel),Ft=r(o.googleUserNameSel),Oe=r(o.dateFeedbackSel),ne=r(o.voiceBtnSel),lr=r(o.notifBtnSel),et=r(o.moreBtnSel),tt=r(o.moreMenuSel),cr=r(o.copyMtlBtnSel),bn=r(o.importFileSel),ur=r(o.exportBtnSel),fr=r(o.syncAllBtnSel),$e=r(o.syncUrlInputSel),pr=r(o.saveSettingsSel),mr=r(o.testSyncSel),hr=l(o.openSettingsSel),Bt=r(o.settingsSectionSel),qe=r(o.emptyStateSel),ei=r(o.listWrapperSel),wn=r(o.categoryOptionsSel),J=r(o.plannerContextSel),U=r(o.plannerLessonInputSel),Q=o.variant||"mobile",yr=typeof o.autoWireAuthButtons=="boolean"?o.autoWireAuthButtons:Q!=="desktop",nt="all",vn=[],En="";function gr(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function je(){if(Q!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=gr(),n;nt==="today"?n=`Today\u2019s reminders \u2022 ${t}`:nt==="completed"?n=`Completed reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,En&&(n+=` \u2022 ${En}`),e.textContent=n}function br(){Q==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(s=>{if(!s.ok)throw new Error("Weather request failed");return s.json()}).then(s=>{s&&s.current_weather&&typeof s.current_weather.temperature=="number"&&(En=`${Math.round(s.current_weather.temperature)}\xB0C`,je())}).catch(s=>{console.warn("Failed to fetch current temperature",s)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let ti="mc:lastDefaults",Sn=()=>{J&&(J.classList.add("hidden"),J.setAttribute("aria-hidden","true"),typeof J.replaceChildren=="function"?J.replaceChildren():J.textContent=""),U&&(U.value="",U.dataset&&(delete U.dataset.lessonDayLabel,delete U.dataset.lessonTitle,delete U.dataset.lessonSummary))},wr=(e={})=>{if(!J)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",s=document.createElement("p");s.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",s.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let d=i?document.createElement("p"):null;d&&(d.className="text-sm text-base-content/70",d.textContent=i),typeof J.replaceChildren=="function"?J.replaceChildren(...[s,a,d].filter(Boolean)):(J.textContent="",J.append(s,a),d&&J.append(d)),J.classList.remove("hidden"),J.removeAttribute("aria-hidden")},vr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";h&&typeof e.reminderTitle=="string"&&(h.value=e.reminderTitle),F&&typeof e.reminderNotes=="string"&&(F.value=e.reminderNotes),T&&typeof e.dueDate=="string"&&(T.value=e.dueDate),U&&(U.value=t,U.dataset&&(U.dataset.lessonDayLabel=dayLabel,U.dataset.lessonTitle=lessonTitle,U.dataset.lessonSummary=summary)),wr(e)};function Tn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(ti)||"{}")||{}}catch{return{}}}function Er(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(ti,JSON.stringify(e))}catch{}}function Sr(e){let t=Tn(),n={category:G(e?.category||t.category||j),priority:e?.priority||t.priority||"Medium"};Er(n)}let ni='fieldset#priorityChips input[name="priority"]';function Mt(){try{let e=document.querySelector(`${ni}:checked`);if(e&&e.value)return e.value}catch{}return ee&&typeof ee.value=="string"&&ee.value?ee.value:"Medium"}function Ot(e){let t=e||"Medium";ee&&typeof ee.value<"u"&&(ee.value=t);try{let n=Array.from(document.querySelectorAll(ni));if(!n.length)return;let i=!1;if(n.forEach(s=>{let a=s.value===t;s.checked=a,i=i||a}),!i){let s=n.find(a=>a.value==="Medium")||n[0];s&&(s.checked=!0)}}catch{}}function ii(){let e=Tn();e.category&&C&&(C.value=e.category),e.priority&&Ot(e.priority)}ii();let Tr=typeof document<"u"?document.getElementById("quickAddForm"):null,Y=typeof document<"u"?document.getElementById("quickAddInput"):null,Ar=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ie=typeof document<"u"?document.getElementById("quickAddVoice")||document.getElementById("voiceBtn"):null,De=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,An=null,ri="memoryCueNotes",oi="memoryCueFolders",si="Lesson \u2013 Reflections";function Ir(e){let t=typeof e=="string"?e:"",n=[{kind:"footy-drill",pattern:/^\s*footy\s+drill\s*:\s*/i},{kind:"reflection",pattern:/^\s*reflection\s*:\s*/i},{kind:"task",pattern:/^\s*task\s*:\s*/i}];for(let i of n)if(i.pattern.test(t))return{kind:i.kind,text:t.replace(i.pattern,"").trim()};return{kind:"default",text:t.trim()}}function ai(e,t=[]){if(typeof localStorage>"u")return Array.isArray(t)?[...t]:[];try{let n=localStorage.getItem(e);if(!n)return Array.isArray(t)?[...t]:[];let i=JSON.parse(n);return Array.isArray(i)?i:Array.isArray(t)?[...t]:[]}catch{return Array.isArray(t)?[...t]:[]}}function Lr(){let t=ai(oi,[{id:"unsorted",name:"Unsorted",order:0}]).filter(d=>d&&typeof d=="object"&&typeof d.id=="string"),n=t.find(d=>d.name===si);if(n?.id)return n.id;let i=new Set(t.map(d=>d.id)),s="lesson-reflections",a=1;for(;i.has(s);)a+=1,s=`lesson-reflections-${a}`;t.push({id:s,name:si,order:t.length});try{localStorage.setItem(oi,JSON.stringify(t))}catch{}return s}function Cr(e){let t=typeof e=="string"?e.trim():"";if(!t||typeof localStorage>"u")return null;let n=Lr(),i=ai(ri,[]),s=new Date().toISOString(),a={id:tn(),title:t,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:s,folderId:n};i.unshift(a);try{localStorage.setItem(ri,JSON.stringify(i))}catch{return null}return a}function kr(e,t){let n=Tn(),i=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||Mt(),category:G(n.category||C?.value||j),notes:"",due:i,pinToToday:!1}}async function it(e={}){if(!Y)return null;if(typeof An=="function")try{An()}catch{}let t=typeof e.text=="string"?e.text:(Y.value||"").trim(),n=Ir(t),i=n.text;if(!i)return null;if(n.kind==="reflection"){let u=Cr(i);return u?(Y.value="",u):null}let a=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,d=null;if(a)d=new Date(a).toISOString();else try{let u=on(i);u&&u.time&&(d=new Date(`${u.date}T${u.time}:00`).toISOString())}catch{d=null}let c=kr(i,d);if(n.kind==="footy-drill"?c.category="Footy \u2013 Drills":n.kind==="task"&&(c.category="Tasks"),e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{c.notifyAt=new Date(e.notifyAt).toISOString()}catch{c.notifyAt=null}let p=Li(c,{closeSheet:!1});if(p&&typeof document<"u"){Y.value="";try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:p}}))}catch{}}return p||null}typeof window<"u"&&(window.memoryCueQuickAddNow=it),Ar?.addEventListener("click",()=>{it()}),Y?.addEventListener("keydown",e=>{(e.key==="Enter"||e.key==="NumpadEnter")&&(e.preventDefault(),it())}),Tr?.addEventListener("submit",e=>{e.preventDefault(),it()});function Dr(){if(typeof HTMLElement>"u"||!(ie instanceof HTMLElement)||!(Y instanceof HTMLInputElement)||ie.dataset.voiceBound==="true")return;if(ie.dataset.voiceBound="true",typeof window>"u"){ie.setAttribute("disabled","true"),ie.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ie.setAttribute("disabled","true"),ie.setAttribute("aria-disabled","true"),ie.getAttribute("title")||(ie.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,ie.setAttribute("aria-pressed",d?"true":"false"),ie.dataset.listening=d?"true":"false",ie.classList.toggle("is-listening",d)},s=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",p=>{let u=p?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){Y.value=u;try{Y.focus({preventScroll:!0})}catch{Y.focus()}try{let g=Y.value.length;typeof Y.setSelectionRange=="function"&&Y.setSelectionRange(g,g)}catch{}}});let c=()=>{i(!1)};return t.addEventListener("end",c),t.addEventListener("error",c),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};An=a,ie.addEventListener("click",()=>{let d=s();if(d){if(n){a();return}try{d.start(),i(!0)}catch(c){console.warn("Quick add voice error:",c),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}Dr();let di=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,me=null,li=!!di;li&&(me=new di,me.lang="en-AU",me.interimResults=!1,me.maxAlternatives=1);function xr(){try{if(typeof S=="function"){S("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}De&&(li&&me?De.addEventListener("click",()=>{try{me.start(),De.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):De.addEventListener("click",()=>{xr()})),me&&(me.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Fr(t)}),me.addEventListener("end",()=>{De&&De.classList.remove("is-recording")}),me.addEventListener("error",()=>{De&&De.classList.remove("is-recording")}));function Nr(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function Rr(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,s=new Date(i);if(n.includes("tomorrow"))s.setDate(s.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let d=parseInt(a[1],10),c=a[2]?parseInt(a[2],10):0,p=a[3];p||(/\b(p\.?m\.?|p m)\b/.test(n)?p="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(p="am")),p==="pm"&&d<12&&(d+=12),p==="am"&&d===12&&(d=0),s.setHours(d,c,0,0);let u=new Date(s),g=new Date(u.getTime()-10*60*1e3);return t.dueDate=u,t.notifyAt=g,t}function Fr(e){if(!e||!Y)return;let t=Nr(e),{dueDate:n,notifyAt:i}=Rr(e);Y.value=t,it({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&Y&&(e.preventDefault(),Y.focus())})));try{Q==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Br=o.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",ci=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Mr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Pt=o.reminderLandingPath||(Q==="desktop"?"index.html#reminders":"mobile.html"),de=(e,t={})=>{let n=null;try{n=typeof CustomEvent<"u"?CustomEvent:null}catch{n=null}!n&&typeof window<"u"&&typeof window.CustomEvent<"u"&&(n=window.CustomEvent),n||(n=function(i,s){s=s||{bubbles:!1,cancelable:!1,detail:null};let a=new Event(i,s);return a.detail=s.detail,a}),document.dispatchEvent(new n(e,{detail:t}))};function ui(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function rt(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:f}}))}catch{}}C&&!C.value&&(C.value=j),ke()&&Me();function Te(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let s=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(s.push(n);s.length>20;)s.shift();window.memoryCueActivityQueue=s}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Xi,{detail:n}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent(Xi,!1,!1,n),document.dispatchEvent(s))}}catch{}}}function Or(){if(typeof HTMLElement>"u"||!(ne instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&h instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&h instanceof HTMLTextAreaElement;if(!e&&!t||ne.dataset.voiceBound==="true")return;if(ne.dataset.voiceBound="true",typeof window>"u"){ne.setAttribute("disabled","true"),ne.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ne.setAttribute("disabled","true"),ne.setAttribute("aria-disabled","true"),ne.getAttribute("title")||(ne.title="Voice input is not supported in this browser.");return}let i=null,s=!1,a=u=>{s=u,ne.setAttribute("aria-pressed",u?"true":"false"),ne.dataset.listening=u?"true":"false",ne.classList.toggle("is-listening",u)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",g=>{let A=g.results?.[0]?.[0]?.transcript?.trim()||"";if(A){h.value=A;try{h.focus({preventScroll:!0})}catch{try{h.focus()}catch{}}try{let L=h.value.length;typeof h.setSelectionRange=="function"&&h.setSelectionRange(L,L)}catch{}Te({action:"dictated",label:`Voice input captured \xB7 ${A}`})}});let u=()=>{a(!1)};return i.addEventListener("end",u),i.addEventListener("error",u),i},c=()=>{if(!(!s||!i)){try{i.stop()}catch{}a(!1)}};ne.addEventListener("click",()=>{let u=d();if(u){if(s){c();return}try{u.start(),a(!0)}catch(g){console.warn("Speech recognition error:",g),a(!1)}}});let p=()=>{c()};typeof document<"u"&&(document.addEventListener("cue:close",p),document.addEventListener("reminders:updated",p)),a(!1)}Uo(),Or();let _t,Ht,Ut,$t,Ve,qt,jt,Vt,Wt,Yt,Gt,ot,st,Kt,Xt,In,Ln,zt,Cn,fi=o.firebaseDeps,kn=typeof o.importModule=="function"?o.importModule:e=>import(e),at=Xn(),dt=!1,he=!1,Dn=null,Ae=null,lt=null,f=[],We=!1,Z=null,ct=null,Ye=null,ut=null,Jt=null,Pe={},_e={},W={},pi=typeof document<"u"?document.getElementById("createSheetTitle"):null,mi=()=>{h instanceof HTMLElement&&setTimeout(()=>{try{h.focus()}catch{}},0)},Ge=(e,t=null)=>{ut=e||null,Jt=t||null,Ye=ut==="edit"?Jt:null,pi instanceof HTMLElement&&(pi.textContent=ut==="edit"?"Edit reminder":"New reminder")};function ue(e=f){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,s=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===s?Ei(t||{},n||{}):s-i})}function Pr(e=f){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let s=Number.isFinite(i?.orderIndex)?i.orderIndex:null;s!=null&&(s<t&&(t=s),s>n&&(n=s))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function ft(e=f){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),ue(n);else{n=e.slice().sort(Ei);let i=n.length;n.forEach((s,a)=>{s.orderIndex=(i-a)*we})}return e===f&&(f=n),n}function hi(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Pr();if(t==="end"){let s=Number.isFinite(n)?n:0;e.orderIndex=s-we||we}else{let s=Number.isFinite(i)?i:0;e.orderIndex=s+we||we}}function Qt(e=f){if(!Array.isArray(e)||e.length<2)return!1;ue(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],s=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(s?.orderIndex)?s.orderIndex:null;if(a==null||d==null||a<=d||a-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*we;return e===f&&ue(f),!0}let N={draggingId:null,dropTargetId:null,dropBefore:!0},yi=!1,y={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function _r(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function pt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function xe(){E&&(E.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),E.classList.remove("drag-over-list"))}function xn(){if(!E)return;let e=E.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),xe(),N.draggingId=null,N.dropTargetId=null,N.dropBefore=!0}function gi(e,t,n){if(!e||e===t)return;let i=f.findIndex(L=>L?.id===e);if(i<0)return;let[s]=f.splice(i,1),a;if(!t)a=f.length;else{let L=f.findIndex(_=>_?.id===t);if(L<0){f.splice(i,0,s);return}a=n?L:L+1}f.splice(a,0,s);let d=f[a-1],c=f[a+1],p=Number.isFinite(d?.orderIndex)?d.orderIndex:null,u=Number.isFinite(c?.orderIndex)?c.orderIndex:null,g;p!=null&&u!=null?g=(p+u)/2:p!=null?g=p-we:u!=null?g=u+we:g=we,Number.isFinite(g)||(g=we*(f.length+1)),s.orderIndex=g,ue(f);let A=Qt(f);We=!0,$(),K(),A?f.forEach(L=>re(L)):re(s),rt(),de("memoryCue:remindersUpdated",{items:f}),Te({action:"reordered",label:"Reminders reordered"})}function Hr(e){let t=pt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(N.draggingId=i,N.dropTargetId=null,N.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Ur(e){if(!N.draggingId)return;let t=pt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),N.dropTargetId=null,N.dropBefore=!1,xe(),E?.classList.add("drag-over-list");return}if(t.dataset.id===N.draggingId){e.preventDefault(),xe();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,s=e.clientY<i;(N.dropTargetId!==t.dataset.id||N.dropBefore!==s)&&(xe(),t.classList.add(s?"drag-over-before":"drag-over-after"),N.dropTargetId=t.dataset.id,N.dropBefore=s)}function $r(e){let t=pt(e.target);if(!t){E?.contains(e.relatedTarget)||xe();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),E?.contains(e.relatedTarget)||E?.classList.remove("drag-over-list"))}function qr(e){if(!N.draggingId)return;e.preventDefault();let t=pt(e.target),n=t?.dataset.id||null,i=N.dropBefore;if(t){let s=t.getBoundingClientRect(),a=s.top+s.height/2;i=e.clientY<a}else n=null,i=!1;gi(N.draggingId,n,i),xn()}function jr(){xn()}function Vr(){!E||yi||(yi=!0,E.addEventListener("dragstart",Hr),E.addEventListener("dragover",Ur),E.addEventListener("drop",qr),E.addEventListener("dragend",jr),E.addEventListener("dragleave",$r),Zt())}function Zt(){if(!E||Zt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Zt._bound=!0;return}let t=6,n=160;function i(){y.longPressTimer&&(clearTimeout(y.longPressTimer),y.longPressTimer=null)}function s(){E&&(y.initialTouchAction!=null?E.style.touchAction=y.initialTouchAction:E.style.removeProperty("touch-action"))}function a({keepHighlights:v=!1}={}){if(i(),y.item&&y.pointerId!=null)try{y.item.hasPointerCapture?.(y.pointerId)&&y.item.releasePointerCapture(y.pointerId)}catch{}if(y.placeholder?.parentNode)try{y.placeholder.parentNode.removeChild(y.placeholder)}catch{}y.item&&(y.item.classList.remove("is-dragging"),y.originalStyles?y.item.setAttribute("style",y.originalStyles):y.item.removeAttribute("style")),s(),v||xe(),Object.assign(y,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(v){return E?Array.from(E.querySelectorAll("[data-reminder-item]")).filter(b=>b!==v):[]}function c(v){let b=y.item;if(!b||y.ready)return;let k=b.getBoundingClientRect(),M=window.getComputedStyle(b);y.ready=!0,N.draggingId=b.dataset.id||null,y.offsetY=v.clientY-k.top,y.fixedX=k.left;let R=document.createElement("div");R.className="touch-drag-placeholder",R.setAttribute("aria-hidden","true"),R.style.height=`${k.height}px`,R.style.boxSizing="border-box",R.style.marginTop=M.marginTop,R.style.marginBottom=M.marginBottom,R.style.marginLeft=M.marginLeft,R.style.marginRight=M.marginRight,R.style.borderRadius=M.borderRadius,R.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",R.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",R.style.pointerEvents="none",R.style.display="block",R.style.width="100%",b.parentNode?.insertBefore(R,b),y.placeholder=R,y.longPressTimer=null,y.originalStyles=b.getAttribute("style")||"",b.classList.add("is-dragging"),b.style.position="fixed",b.style.left=`${k.left}px`,b.style.top=`${k.top}px`,b.style.width=`${k.width}px`,b.style.zIndex="999",b.style.pointerEvents="none",b.style.touchAction="none",y.initialTouchAction=E.style.touchAction||"",E.style.touchAction="none"}function p(v){let b=y.item;if(!b||!y.ready)return;let k=v-y.offsetY;b.style.top=`${k}px`,b.style.left=`${y.fixedX}px`}function u(v){if(!y.ready||!E)return;let b=y.item,k=d(b);if(xe(),!k.length){N.dropTargetId=null,N.dropBefore=!1;return}let M=null,R=!1;for(let m of k){let w=m.getBoundingClientRect(),B=w.top+w.height/2;if(v<B){M=m,R=!0;break}}if(!M){M=k[k.length-1];let m=M.getBoundingClientRect(),w=m.top+m.height/2;R=v<w,R||(R=!1)}if(!M){N.dropTargetId=null,N.dropBefore=!1;return}let ge=M.getBoundingClientRect(),Hn=ge.top+ge.height/2,yt=v<Hn;M.classList.add(yt?"drag-over-before":"drag-over-after"),N.dropTargetId=M.dataset.id||null,N.dropBefore=yt}function g(v){let b=N.draggingId,k=y.moved;if(!y.ready){a();return}a(),!v&&k&&b&&gi(b,N.dropTargetId,N.dropBefore),xn()}function A(v){let b=v.pointerType||"";if(b&&b!=="touch"&&b!=="pen"||y.active)return;let k=pt(v.target);if(!k)return;let M=_r(v.target);if(!(M&&M!==k)){y.active=!0,y.pointerId=v.pointerId,y.item=k,y.startX=v.clientX,y.startY=v.clientY,y.lastClientX=v.clientX,y.lastClientY=v.clientY,y.moved=!1,y.ready=!1,y.originalStyles=k.getAttribute("style")||"",y.startTime=v.timeStamp||Date.now(),N.dropTargetId=null,N.dropBefore=!0,N.draggingId=null,i(),y.longPressTimer=setTimeout(()=>{c({clientY:y.lastClientY})},n);try{k.setPointerCapture(v.pointerId)}catch{}}}function L(v){if(!y.active||v.pointerId!==y.pointerId)return;let b=v.pointerType||"";if(!(b&&b!=="touch"&&b!=="pen")){if(y.lastClientX=v.clientX,y.lastClientY=v.clientY,!y.ready){let k=Math.abs(v.clientX-y.startX),M=Math.abs(v.clientY-y.startY);if(k>t||M>t){let R=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(R-y.startTime)>=n?(i(),c({clientY:y.lastClientY})):a()}return}v.preventDefault(),y.moved=!0,p(v.clientY),u(v.clientY)}}function _(v){!y.active||v.pointerId!==y.pointerId||g(!1)}function fe(v){!y.active||v.pointerId!==y.pointerId||g(!0)}E.addEventListener("pointerdown",A),window.addEventListener("pointermove",L),window.addEventListener("pointerup",_),window.addEventListener("pointercancel",fe),Zt._bound=!0}function bi(){Z=null,gn("offline"),xt.forEach(e=>e.classList.remove("hidden")),Nt.forEach(e=>e.classList.add("hidden")),Ft&&(Ft.textContent=""),ct?.(),ct=null,Rn(),$(),K(),Fe()}function Nn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Yn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),s=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:tn(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:G(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:s,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Wr(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Yn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:G(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(Yn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function K(){ue(f),Wr(f)}function Rn(){f=ft(Nn())}Rn();async function Yr(){if(!Z){f=Nn();return}let e=ft(Nn());if(!e.length){f=[],K();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await re(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}f=ft(e.map(n=>({...n,pendingSync:!1}))),K(),$(),Fe()}try{W=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{W={}}if(W&&typeof W=="object"&&Object.values(W).forEach(e=>{e&&typeof e=="object"&&(e.category=G(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:mt(e),e.urlPath=e.urlPath||Pt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!ke()){let e=Di();typeof Notification<"u"&&Notification.permission==="granted"?(hn(),e.length&&Gn(e,{requestCheck:!0})):e.length&&Gn(e)}let en=e=>{if(!at)return;let t=[at];at.window&&!t.includes(at.window)&&t.push(at.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Gr(){if(!z)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",s=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in z?z.value:z.innerHTML,d=g=>{if("value"in z){z.value=g;return}if(typeof g!="string"||g.length===0){z.innerHTML="";return}let A=g.trim();if(/<\/?[a-z][\s\S]*>/i.test(A)){z.innerHTML=g;return}let _=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");z.innerHTML=_},c=g=>{g?z.classList.add("notes-editor--columns"):z.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!g))},p="";try{p=localStorage.getItem(n)||""}catch{S("Unable to access saved notes")}d(p);let u=!1;try{u=localStorage.getItem(i)==="1"}catch{u=!1}c(u),z.addEventListener("input",()=>{p=a();try{localStorage.setItem(n,p)}catch{S("Notes saved for this session only")}}),ar?.addEventListener("click",()=>{p=a();try{localStorage.setItem(n,p),S("Notes saved")}catch{S("Notes saved for this session only")}}),dr?.addEventListener("click",()=>{let g=p;try{g=localStorage.getItem(n)||p}catch{S("Unable to load saved notes")}p=g,d(p)}),e?.addEventListener("click",g=>{let A=g.target;if(!(A instanceof Element))return;let L=A.closest("button[data-action]");if(!L)return;let _=L.getAttribute("data-action");if(_==="columns"){let fe=!z.classList.contains("notes-editor--columns");c(fe);try{localStorage.setItem(i,fe?"1":"0")}catch{S("Column preference saved for this session only")}return}if(!s){S("Formatting controls are not supported in this browser");return}z.focus(),_==="bullets"?document.execCommand("insertUnorderedList"):_==="numbers"&&document.execCommand("insertOrderedList")})}if(Gr(),te?.addEventListener("click",Oi),fi)({initializeApp:_t,getFirestore:Ht,enableMultiTabIndexedDbPersistence:Ut,enableIndexedDbPersistence:$t,doc:Ve,setDoc:qt,deleteDoc:jt,onSnapshot:Vt,collection:Wt,query:Yt,orderBy:Gt,serverTimestamp:ot,getAuth:st,onAuthStateChanged:Kt,GoogleAuthProvider:Xt,signInWithPopup:In,signInWithRedirect:Ln,getRedirectResult:zt,signOut:Cn}=fi),dt=!0;else try{({initializeApp:_t}=await kn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Ht,enableMultiTabIndexedDbPersistence:Ut,enableIndexedDbPersistence:$t,doc:Ve,setDoc:qt,deleteDoc:jt,onSnapshot:Vt,collection:Wt,query:Yt,orderBy:Gt,serverTimestamp:ot}=await kn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:st,onAuthStateChanged:Kt,GoogleAuthProvider:Xt,signInWithPopup:In,signInWithRedirect:Ln,getRedirectResult:zt,signOut:Cn}=await kn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),dt=!0}catch(e){dt=!1,console.warn("Firebase modules failed to load:",e),S("Firebase failed to load; notes available offline"),en(!1)}if(dt&&typeof _t=="function"&&typeof Ht=="function"&&typeof st=="function")try{let e=_o();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Dn=_t(e),Ae=Ht(Dn),he=!0,console.info("[Firebase] Firestore initialised",e.projectId),en(!0)}catch(e){he=!1,console.warn("Firebase initialization failed:",e),S("Firebase failed to load; notes available offline"),en(!1)}else dt?(he=!1,en(!1)):he=!1;he&&typeof Ut=="function"&&typeof $t=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ut(Ae),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await $t(Ae),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),he&&typeof st=="function"&&(lt=st(Dn));function Kr(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Xr=typeof navigator<"u"&&navigator.language?navigator.language:"",wi=Kr(Xr),Ke=wi||"en-US",Ie="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Ie=e.timeZone),!wi&&e.locale&&(Ke=e.locale)}catch{}let zr=new Intl.DateTimeFormat(Ke,{timeZone:Ie,hour:"2-digit",minute:"2-digit"}),Jr=new Intl.DateTimeFormat(Ke,{timeZone:Ie,weekday:"long",day:"numeric",month:"long"}),Qr=new Intl.DateTimeFormat("en-CA",{timeZone:Ie,year:"numeric",month:"2-digit",day:"2-digit"}),Zr=new Intl.DateTimeFormat(Ke,{timeZone:Ie,weekday:"long"}),eo=new Intl.DateTimeFormat(Ke,{timeZone:Ie,month:"short",day:"numeric"});function Ne(e){let t=Qr.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,s=t.find(a=>a.type==="day").value;return`${n}-${i}-${s}`}function vi(e,t){let[n,i,s]=e.split("-").map(p=>parseInt(p,10)),[a,d]=t.split(":").map(p=>parseInt(p,10)),c=new Date;return c.setFullYear(n,(i||1)-1,s||1),c.setHours(a||0,d||0,0,0),c.toISOString()}let to=new Intl.DateTimeFormat("en-CA",{timeZone:Ie,year:"numeric",month:"2-digit",day:"2-digit"}),no=new Intl.DateTimeFormat("en-CA",{timeZone:Ie,hour:"2-digit",minute:"2-digit",hour12:!1});function io(e){try{let t=new Date(e),n=to.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",s=n.find(d=>d.type==="month")?.value||"00",a=n.find(d=>d.type==="day")?.value||"00";return`${i}-${s}-${a}`}catch{return""}}function ro(e){try{let t=new Date(e),n=no.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",s=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${s}`}catch{return""}}function tn(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function nn(){return Ne(new Date)}function oo(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Wo(e){let t=oo(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function rn(e){return e==="High"?3:e==="Medium"?2:1}function Ei(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let s=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(s!==a)return s-a;let d=rn(t?.priority)-rn(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function Yo(e,t){let n=rn(t.priority)-rn(e.priority);if(n)return n;let i=+new Date(e.due||0),s=+new Date(t.due||0);return i!==s?i-s:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Si(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Jr.format(t)}catch{return e}}function Fn(e){return zr.format(e)}function so(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Go(e){return e?so(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function S(e){P&&(Ue(),P.dataset.statusKind="toast",P.textContent=e,clearTimeout(S._t),S._t=setTimeout(()=>{P&&P.dataset.statusKind==="toast"&&(P.textContent="",delete P.dataset.statusKind)},2500))}function ao(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function on(e){e=String(e||"").toLowerCase();let t={date:nn(),time:""},n=c=>{let p=new Date,u=p.getDay(),g=(c-u+7)%7,A=new Date(p);return A.setDate(p.getDate()+(g===0?7:g)),A},i=c=>{let p=new Date,u=p.getDay(),g=(c-u+7)%7,A=new Date(p);return A.setDate(p.getDate()+g),A},s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let c=new Date;c.setDate(c.getDate()+1),t.date=Ne(c)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=s[c[1]],u=n(p);t.date=Ne(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=s[c[1]],u=i(p);t.date=Ne(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=s[c[1]],u=n(p);t.date=Ne(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let c=e.match(/\bin\s+(\d+)\s+days?\b/),p=parseInt(c[1],10),u=new Date;u.setDate(u.getDate()+p),t.date=Ne(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let c=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),p=parseInt(c[1],10),u=parseInt(c[2],10)-1,g=c[3]?parseInt(c[3],10):new Date().getFullYear(),A=new Date(g,u,p);t.date=Ne(A)}else for(let[c,p]of Object.entries(a)){let u=new RegExp(`\\b${c}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let g=e.match(u),A=parseInt(g[1],10),L=new Date().getFullYear(),_=new Date(L,p,A);t.date=Ne(_);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let c=parseInt(d[1],10),p=d[2]?parseInt(d[2],10):0,u=d[3];u&&(u==="pm"&&c<12&&(c+=12),u==="am"&&c===12&&(c=0)),t.time=`${String(c).padStart(2,"0")}:${String(p).padStart(2,"0")}`}return t}let Bn=he&&lt&&typeof Xt=="function";Ui({authReady:Bn,auth:lt,GoogleAuthProvider:Xt,signInWithPopup:In,signInWithRedirect:Ln,signOut:Cn,toast:S});let Ti=yr,Ai=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(s=>{console.error("Auth handler error:",s)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Ti&&xt.length&&xt.forEach(e=>Ai(e,$i)),Bn&&typeof zt=="function"&&zt(lt).catch(()=>{}),Ti&&Nt.length&&Nt.forEach(e=>Ai(e,qi)),Bn&&typeof Kt=="function"?Kt(lt,async e=>{e?(Z=e.uid,gn("online"),xt.forEach(t=>t.classList.add("hidden")),Nt.forEach(t=>t.classList.remove("hidden")),Ft&&(Ft.textContent=e.displayName||e.email||""),lo(),await Yr()):bi()}):bi();function lo(){if(!he||!Ae||typeof Wt!="function"||typeof Yt!="function"||typeof Gt!="function"||typeof Vt!="function")return;if(!Z){Rn(),$(),je(),K(),Fe();return}ct&&ct();let e=Wt(Ae,"users",Z,"reminders"),t=Yt(e,Gt("updatedAt","desc"));ct=Vt(t,n=>{let i=[];n.forEach(s=>{let a=s.data(),d=Number(a.orderIndex),c=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,p=a.pinToToday===!0;i.push({id:s.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:G(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:c,pinToToday:p})}),f=ft(i),$(),je(),K(),Fe()},n=>{console.error("Firestore sync error:",n),V&&gn("error","Sync Error")})}async function re(e){if(!(!he||!Z||!Ae||typeof Ve!="function"||typeof qt!="function"||typeof ot!="function"))try{await qt(Ve(Ae,"users",Z,"reminders",e.id),{ownerUid:Z,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||j,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):ot(),updatedAt:ot()},{merge:!0})}catch(t){console.error("Save failed:",t),S("Save queued (offline)")}}async function co(e){if(!(!he||!Z||!Ae||typeof Ve!="function"||typeof jt!="function"))try{await jt(Ve(Ae,"users",Z,"reminders",e))}catch{S("Delete queued (offline)")}}async function sn(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||j,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Re({preserveDetail:e=!1,resetMode:t=!0}={}){h&&(h.value=""),T&&(T.value=""),x&&(x.value=""),F&&(F.value=""),Ot("Medium"),C&&(C.value=j),ii(),t?Ge(null):Ye=ut==="edit"?Jt:null,te&&(te.textContent="Save"),oe?.classList.add("hidden"),Sn(),e||Qn()}function uo(e){let t=f.find(n=>n.id===e);t&&(Ge("edit",e),h&&(h.value=t.title||""),T&&x&&(t.due?(T.value=io(t.due),x.value=ro(t.due)):(T.value="",x.value="")),Ot(t?.priority||"Medium"),C&&(C.value=G(t.category)),F&&(F.value=typeof t.notes=="string"?t.notes:""),U&&(U.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),Sn(),or(t),te&&(te.textContent="Update"),oe?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),mi(),de("cue:open",{mode:"edit"}))}function Ii(e){let t=e?.id||e;t&&(Ge("edit",t),uo(t))}function fo(e=null){Re({resetMode:!1}),Ge("new");let t={mode:"create",trigger:e};de("cue:prepare",t),de("cue:open",t),mi()}typeof window<"u"&&(window.openNewReminderSheet=fo,window.openEditReminderSheet=Ii);function Li(e={},t={}){let{closeSheet:n=!0,activityAction:i="created",activityLabelPrefix:s="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let d=Date.now(),c=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),p=G(e.category??(C?C.value:j)),u=null;e.due instanceof Date?u=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(u=e.due);let g=null;e.notifyAt instanceof Date?g=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(g=e.notifyAt);let A={id:tn(),title:a,priority:e.priority||Mt(),category:p,notes:c,done:!1,createdAt:d,updatedAt:d,due:u,pendingSync:!Z,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:g};hi(A,{position:"start"}),f=[A,...f],ue(f);let L=Qt(f);return We=!0,$(),K(),Sr(A),L?f.forEach(_=>re(_)):re(A),sn(A),Xe(A),Fe(),rt(),de("memoryCue:remindersUpdated",{items:f}),n&&ui(),Te({action:i,label:`${s} \xB7 ${A.title}`}),A}function po(e){return Li(e,{closeSheet:!0})}function mo(e,t){if(!Z)return S("Sign in to add notes"),null;if(!e)return null;let n=f.find(d=>d.id===e);if(!n)return null;let s=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!s)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${s}`:s,n.updatedAt=Date.now(),re(n),$(),K(),Te({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function ho(e){let t=f.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),re(t),sn(t),$(),K(),t.done?(dn(e),Te({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Xe(t),Te({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function yo(e,t){let n=f.find(s=>s?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),re(n),$(),K(),rt(),de("memoryCue:remindersUpdated",{items:f}))}function go(e){if(!ae||ae.tokenId!==e)return;let{item:t,index:n}=ae;if(!t){Ue(e);return}Ue(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),f.length):f.length;t.pendingSync=!Z,t.updatedAt=Date.now(),f.splice(i,0,t),ue(f);let s=Qt(f);We=!0,$(),K(),Xe(t),s?f.forEach(a=>re(a)):re(t),sn(t),rt(),de("memoryCue:remindersUpdated",{items:f}),Te({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),S("Reminder restored")}function Mn(e){let t=f.findIndex(s=>s.id===e),n=t>=0?f.splice(t,1)[0]:null;n&&Ye===e&&Re(),$(),K(),co(e),dn(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Te({action:"deleted",label:i}),n&&P){Ue();let s=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ae={tokenId:s,item:n,index:t,timeoutId:null},rr(ae),ae.timeoutId=setTimeout(()=>{Ue(s)},ir)}else n&&Ue()}function Ci(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,s=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,c=!1,p=0,u=0,g=0,A=()=>{if(c){if(c=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",_),e.removeEventListener("pointerup",fe),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",fe),window.removeEventListener("pointercancel",v)}},L=b=>{if(b.pointerType==="mouse"&&b.button!==0)return;c&&A();let k=b.target;k instanceof Element&&k.closest(a)||(d=b.pointerId,p=b.clientX,u=b.clientY,g=typeof b.timeStamp=="number"?b.timeStamp:Date.now(),c=!0,e.addEventListener("pointermove",_),e.addEventListener("pointerup",fe),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",fe),window.addEventListener("pointercancel",v))},_=b=>{if(!c||b.pointerId!==d)return;Math.abs(b.clientY-u)>i&&A()},fe=b=>{if(!c||b.pointerId!==d)return;let k=b.clientX-p,M=Math.abs(b.clientY-u),R=(typeof b.timeStamp=="number"?b.timeStamp:Date.now())-g;if(A(),k<=-n&&M<=i&&R<=s){b.preventDefault(),b.stopPropagation();try{t()}catch(ge){console.warn("Swipe delete handler failed",ge)}}},v=b=>{c&&(typeof b.pointerId=="number"&&b.pointerId!==d||A())};e.addEventListener("pointerdown",L)}function mt(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=Fn(i);if(s)return`${n} \u2022 ${s}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=Fn(i);if(s)return`Due ${s}`}}catch{}return"Due now"}function ki(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}S("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Di(){return Object.values(W||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||j,notes:typeof e.notes=="string"?e.notes:"",body:mt(e),urlPath:e.urlPath||Pt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function On(){try{localStorage.setItem("scheduledReminders",JSON.stringify(W))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Di(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&hn(),Gn(e,{requestCheck:t})}function an(e,{closeNotification:t=!0}={}){if(t){let n=Ce.get(e);if(n){try{n.close()}catch{}Ce.delete(e)}}Pe[e]&&(clearTimeout(Pe[e]),delete Pe[e]),_e[e]&&(clearTimeout(_e[e]),delete _e[e]),Kn(e),W[e]&&(delete W[e],On())}function dn(e){an(e)}function Pn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Ce.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:mt(e),tag:e.id});Ce.set(e.id,n);let i=()=>{Ce.get(e.id)===n&&Ce.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function bo(e){if(!ke())return!1;let t=Zi();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Me();if(!i)return!1;await Kn(e.id,i);let s={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||j,body:a,urlPath:Pt},a=mt(e),d={body:a,tag:e.id,data:s,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(c){return console.warn("Failed to schedule persistent notification",c),!1}}function Xe(e){if(!e||!e.id)return;if(e.category=G(e.category),!e.due||e.done){dn(e.id);return}let t=W[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||j,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:mt(e),urlPath:Pt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,p=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?p:null})()};if(W[e.id]=n,On(),Pe[e.id]&&(clearTimeout(Pe[e.id]),delete Pe[e.id]),_e[e.id]&&(clearTimeout(_e[e.id]),delete _e[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let s=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(W[e.id]?.viaTrigger){an(e.id,{closeNotification:!1});return}Pn(e),an(e.id,{closeNotification:!1});return}let d=ke();if(Number.isFinite(s)&&s>Date.now()&&s<i){let c=s-Date.now();_e[e.id]=setTimeout(()=>{Pn({...e,due:e.due||n.due})},c)}d&&(n.viaTrigger=!1,bo(e).then(c=>{c&&W[e.id]&&(W[e.id]={...W[e.id],viaTrigger:!0},On())})),Pe[e.id]=setTimeout(()=>{d&&Kn(e.id),Pn(e),an(e.id,{closeNotification:!1})},a)}function Fe(){Object.values(W).forEach(e=>Xe({...e,category:G(e?.category)}))}function xi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Zr.format(t),i=eo.format(t),s=Fn(t);return`${n}, ${i}${s?` at ${s}`:""}`}catch{return"No due date"}}let Ni="__mcPinToggleHandler";var _n=!1;function ht(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Ee,t),e.classList.toggle(se,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Ri(e){if(!(e instanceof HTMLElement)||e[Ni])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let s=i.currentTarget;if(!(s instanceof HTMLElement))return;let d=(typeof s.closest=="function"?s.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){ht(s,!1);return}let c=!s.classList.contains(Ee);await Promise.resolve(yo(d,c)),ht(s,c)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Ni]={click:t,keydown:n}}function wo(){if(!E)return;let e=E.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){ht(t,!1),Ri(t);return}let a=!!f.find(d=>d?.id===i)?.pinToToday;ht(t,a),Ri(t)})}function Fi(){if(!E||_n)return;_n=!0;let e=()=>{_n=!1,wo()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function vo(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function Eo(e,t,n){if(!Array.isArray(e))return[];let s=t==="completed"?e.filter(a=>!!a?.done):e.filter(a=>!a?.done);return t==="today"?s.filter(a=>vo(a,n)):s}function So(){let e=document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]");e.length&&e.forEach(t=>{let i=t.getAttribute("data-reminders-tab")===nt;t.setAttribute("aria-pressed",i?"true":"false"),i?t.classList.add("reminders-tab-active","active"):t.classList.remove("reminders-tab-active","active")})}function Bi(e){if(!e||e===nt)return!1;document.querySelectorAll("#reminders-slim-header [data-reminders-tab], #view-reminders [data-reminders-tab]").length&&(Array.isArray(vn)&&$(),je())}function Mi(){if(Q!=="mobile"||typeof document>"u"||Mi._wired)return;So(),je(),document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]").forEach(t=>{t.addEventListener("click",()=>{let n=t.getAttribute("data-reminders-tab");Bi(n)})})}function $(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let s={start:n,end:i};if(xe(),ue(f),Zn)try{Zn.textContent=String(f.length)}catch{}f.forEach(m=>{m&&typeof m=="object"&&(m.category=G(m.category))});let a=new Set(Oo.map(m=>G(m)));f.forEach(m=>{m&&typeof m=="object"&&a.add(G(m.category))});let d=Array.from(a).sort((m,w)=>m.localeCompare(w,void 0,{sensitivity:"base"}));if(wn){let m=new Set;Array.from(wn.querySelectorAll("option")).forEach(w=>{m.add(w.value.trim().toLowerCase())}),d.forEach(w=>{let B=w.toLowerCase();if(!m.has(B)){let O=document.createElement("option");O.value=w,wn.appendChild(O),m.add(B)}})}if(We)We=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=f.map(w=>({...w}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let w=document.createEvent("CustomEvent");w&&w.initCustomEvent&&(w.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(w))}}catch{}}let c=f.slice();ue(c),Q==="mobile"&&(vn=c.slice(),c=Eo(vn,nt,s),je());let p=!0,u=f.length>0,g=c.length>0,A=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(W||{}).filter(w=>w&&typeof w=="object"&&w.id);return new Set(m.map(w=>w.id))})();if(qe)if(g)qe.classList.add("hidden");else{let m=u?"No reminders to show right now.":Br;ci?ci(qe,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:m,action:u?void 0:`<button type="button" class="${Mr}" data-trigger="open-cue">Create reminder</button>`}):qe.textContent=m,qe.classList.remove("hidden")}if(ei&&ei.classList.toggle("has-items",g),!E)return;if(!g){qe?(E.innerHTML="",E.classList.add("hidden")):(E.innerHTML='<div class="text-muted">No reminders found.</div>',E.classList.remove("hidden")),Fi();return}E.classList.remove("hidden"),E.replaceChildren();let L=document.createDocumentFragment(),_=E.tagName==="UL"||E.tagName==="OL",fe=!0,v=["priority-high","priority-medium","priority-low"],b=(m,w)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...v);let B=typeof w=="string"?w.trim().toLowerCase():"";B.startsWith("h")?m.classList.add("priority-high"):B.startsWith("m")?m.classList.add("priority-medium"):B.startsWith("l")&&m.classList.add("priority-low")},k=(m,w="neutral")=>{let B=document.createElement("span");B.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",B.title=m,B.dataset.tone=w;let O=document.createElement("span");O.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",w==="priority-high"?O.classList.add("bg-error"):w==="priority-medium"?O.classList.add("bg-warning"):w==="priority-low"?O.classList.add("bg-secondary"):w==="category"?O.classList.add("bg-primary"):O.classList.add("bg-base-content","opacity-40");let D=document.createElement("span");return D.className="truncate",D.textContent=m,B.append(O,D),B},M=(m,w,{elementTag:B,isMobile:O})=>{let D={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:w,done:!!m.done,pinToToday:m.pinToToday===!0},gt="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Io="task-item reminder-row reminder-card w-full text-base-content",I=document.createElement(B);I.className=O?Io:gt,I.dataset.id=D.id,I.dataset.category=D.category,I.dataset.title=D.title;let Pi=D.priority&&String(D.priority).trim();Pi?I.dataset.priority=Pi:delete I.dataset.priority,I.dataset.done=String(D.done),D.dueIso?I.dataset.due=D.dueIso:delete I.dataset.due,D.pinToToday?I.dataset.pinToToday="true":delete I.dataset.pinToToday,I.dataset.reminder=JSON.stringify(D),I.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",I.dataset.reminderItem="true",I.classList.add("reminder-draggable"),I.setAttribute("draggable","true"),I.setAttribute("role","button"),I.tabIndex=0,I.setAttribute("aria-label",`Edit reminder: ${m.title}`),b(I,D.priority),A.has(D.id)?I.dataset.notificationActive="true":delete I.dataset.notificationActive;let bt=D.dueIso?new Date(D.dueIso):null;p&&bt&&bt>=n&&bt<=i?(I.classList.add("is-today"),I.dataset.today="true"):(I.classList.remove("is-today"),delete I.dataset.today);let Un=xi(m),ln=Un&&Un!=="No due date"?Un:"",ze=document.createElement("div");ze.className="task-toolbar flex items-start gap-1",ze.setAttribute("role","toolbar"),ze.setAttribute("aria-label","Reminder actions"),O&&ze.classList.add("flex-shrink-0");let X=document.createElement("button");X.type="button",X.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",X.classList.toggle("reminder-complete-toggle--active",D.done);let Lo=D.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";X.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${Lo}"
          />
        </svg>`,D.done?(X.classList.add("text-base-content/60"),X.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(X.classList.add("text-success"),X.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),X.setAttribute("aria-pressed",D.done?"true":"false"),X.setAttribute("data-reminder-control","toggle"),X.setAttribute("data-no-swipe","true"),X.addEventListener("click",q=>{q.preventDefault(),q.stopPropagation(),ho(D.id)});let cn=()=>Ii(m);if(O){let q=document.createElement("div");q.className="reminder-card-main reminder-row-main";let be=document.createElement("div");be.className="reminder-title reminder-row-title",be.dataset.reminderTitle="true";let He=document.createElement("span");if(He.dataset.role="reminder-today-toggle",He.className="reminder-title-toggle cursor-pointer",He.setAttribute("role","button"),He.tabIndex=0,He.textContent=m.title,ht(He,D.pinToToday),be.appendChild(He),q.appendChild(be),ln){let le=document.createElement("div");le.className="reminder-date reminder-row-meta",le.textContent=ln,q.appendChild(le)}return D.done?I.classList.add("reminder-row-completed"):bt&&bt<e&&I.classList.add("reminder-row-overdue"),X.classList.add("reminder-row-complete","reminder-complete-btn"),I.append(X,q),I.addEventListener("click",le=>{if(le.defaultPrevented)return;let $n=le.target;$n&&typeof $n.closest=="function"&&$n.closest("[data-reminder-control]")||cn()}),I.addEventListener("keydown",le=>{le.defaultPrevented||le.target===I&&(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),cn())}),O&&Ci(I,()=>Mn(D.id)),I}let un=document.createElement("div");un.className="flex min-w-0 flex-1 flex-col gap-2";let Je=document.createElement("p");Je.className="text-lg font-bold leading-snug text-base-content",Je.classList.add("desktop-reminder-title"),Je.classList.add("sm:text-[0.95rem]"),D.done&&Je.classList.add("line-through","text-base-content/60"),Je.textContent=m.title,un.appendChild(Je);let wt=document.createElement("div");wt.className="desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70",ln&&wt.appendChild(k(ln,"due")),!!(w&&w!==j)&&wt.appendChild(k(w,"category")),wt.children.length&&un.appendChild(wt),I.appendChild(un);let Le=document.createElement("button");return Le.type="button",Le.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Le.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Le.setAttribute("aria-label",`Delete reminder: ${m.title}`),Le.setAttribute("data-action","delete"),Le.setAttribute("data-reminder-control","delete"),Le.setAttribute("data-no-swipe","true"),Le.addEventListener("click",q=>{q.preventDefault(),q.stopPropagation();try{Mn(D.id)}catch(be){console.warn("Delete handler failed",be)}}),ze.append(X,Le),I.appendChild(ze),I.addEventListener("click",q=>{if(q.defaultPrevented)return;let be=q.target;be&&typeof be.closest=="function"&&be.closest("[data-reminder-control]")||cn()}),I.addEventListener("keydown",q=>{q.defaultPrevented||q.target===I&&(q.key==="Enter"||q.key===" ")&&(q.preventDefault(),cn())}),O&&Ci(I,()=>Mn(D.id)),I},R=(m,w)=>M(m,w,{elementTag:"div",isMobile:!0});if(Q!=="desktop"&&!fe){c.forEach(m=>{let w=m.category||j;L.appendChild(R(m,w))}),E.appendChild(L);return}let ge=new Map;c.forEach(m=>{let w=m.category||j;ge.has(w)||ge.set(w,[]),ge.get(w).push(m)});let Hn=Array.from(ge.entries()).sort((m,w)=>m[0].localeCompare(w[0],void 0,{sensitivity:"base"})),yt=!0;Hn.forEach(([m,w])=>{if(m!==j){let B=document.createElement(_?"li":"div");B.dataset.categoryHeading=m,_&&(B.setAttribute("role","presentation"),B.style.listStyle="none"),B.className=Q==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",yt||(B.style.marginTop=Q==="desktop"?"1.25rem":"1rem");let O=document.createElement("div");O.setAttribute("role","heading"),O.setAttribute("aria-level","3"),O.className=Q==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let D=document.createElement("span");D.textContent=m;let gt=document.createElement("span");gt.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",gt.textContent=`${w.length} ${w.length===1?"item":"items"}`,O.append(D,gt),B.appendChild(O),L.appendChild(B)}w.forEach(B=>{if(Q==="desktop"){let O=M(B,m,{elementTag:_?"li":"div",isMobile:!1});L.appendChild(O);return}L.appendChild(R(B,m))}),yt=!1}),E.appendChild(L),sr(),Fi()}function ye(){et?.setAttribute("aria-expanded","false"),tt?.classList.add("hidden")}function To(){et?.setAttribute("aria-expanded","true"),tt?.classList.remove("hidden")}et?.addEventListener("click",e=>{e.stopPropagation(),et.getAttribute("aria-expanded")==="true"?ye():To()}),document.addEventListener("click",e=>{tt&&!tt.classList.contains("hidden")&&!tt.contains(e.target)&&e.target!==et&&ye()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ye()}),hr.forEach(e=>{e.addEventListener("click",()=>{let t=Bt?.classList.contains("hidden");Bt?.classList.toggle("hidden"),t&&Bt?.scrollIntoView({behavior:"smooth",block:"start"}),ye()})}),document.addEventListener("DOMContentLoaded",()=>{Bt?.classList.add("hidden")});function Oi(){try{console.log("handleSaveAction invoked",{editingId:Ye,title:h?.value})}catch{}let t=(typeof h?.value=="string"?h.value:"").trim(),n=typeof T?.value=="string"?T.value:"",i=typeof x?.value=="string"?x.value:"",s=typeof U?.value=="string"?U.value.trim():"";if(ut==="edit"&&Ye){let u=f.find(L=>L.id===Ye);if(!u){Re();return}if(!t){S("Add a reminder title");return}let g=null;if(n||i){let L=n||nn();g=vi(L,i||"09:00")}else{let L=on(t);L.time&&(g=new Date(`${L.date}T${L.time}:00`).toISOString())}u.title=t;let A=Mt();u.priority=A,Ot(A),C&&(u.category=G(C.value)),u.due=g,F&&(u.notes=F.value.trim()),u.plannerLessonId=s||null,u.updatedAt=Date.now(),re(u),sn(u),We=!0,$(),Xe(u),K(),rt(),de("memoryCue:remindersUpdated",{items:f}),ui(),Te({action:"updated",label:`Reminder updated \xB7 ${u.title}`}),Re(),S("Reminder updated"),de("cue:close",{reason:"updated"});return}if(!t){S("Add a reminder title");return}let a=F?F.value.trim():"",d=null;if(n||i){let u=n||nn();d=vi(u,i||"09:00")}else{let u=on(t);u.time&&(d=new Date(`${u.date}T${u.time}:00`).toISOString())}let c=s?{lessonId:s,dayLabel:U?.dataset?.lessonDayLabel||"",lessonTitle:U?.dataset?.lessonTitle||"",summary:U?.dataset?.lessonSummary||""}:null,p=po({title:t,priority:Mt(),category:C?C.value:"",due:d,notes:a,plannerLessonId:s||null});p&&(c?(S("Planner reminder created"),de("planner:reminderCreated",{lessonId:c.lessonId,dayLabel:c.dayLabel,lessonTitle:c.lessonTitle,summary:c.summary,reminderId:p.id,reminderTitle:p.title,reminderDue:p.due||null})):S("Reminder created")),h&&(h.value=""),x&&(x.value=""),F&&(F.value=""),Sn(),de("cue:close",{reason:"created"})}h?.addEventListener("keydown",e=>{e.key==="Enter"&&Oi()});function Ao(){if(!h||!Oe)return;let e=h.value.trim();if(!e){Oe.style.display="none";return}try{let t=on(e),n=nn();if(t.date!==n||t.time){let i="";if(t.date!==n){let s=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Si(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Oe.textContent=`Parsed: ${i}`,Oe.style.display="block"):Oe.style.display="none"}else Oe.style.display="none"}catch{Oe.style.display="none"}}if(h?.addEventListener("input",ao(Ao,300)),oe?.addEventListener("click",()=>{Re(),S("Edit cancelled"),de("cue:close",{reason:"edit-cancelled"})}),tr?.addEventListener("click",()=>{Re()}),document.addEventListener("cue:cancelled",()=>{Re()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";Re({resetMode:!1}),Ge(t,t==="edit"?Jt:null)}),document.addEventListener("cue:close",()=>{Ge(null)}),document.addEventListener("planner:prefillReminder",e=>{vr(e?.detail||{})}),window.addEventListener("load",()=>h?.focus()),cr?.addEventListener("click",()=>{let e=f.filter(t=>!t.done).map(t=>{let n=t.due?Si(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Ke,{hour:"2-digit",minute:"2-digit",timeZone:Ie}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){S("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>S("Copied for Master Task List")).catch(()=>S("Copy failed")),ye()}),bn?.addEventListener("change",()=>{let e=bn.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let d={...a,id:tn(),category:G(a.category),pendingSync:!Z,orderIndex:null};hi(d,{position:"start"}),f=[d,...f],i.push(d)}),ue(f);let s=Qt(f);$(),K(),s?f.forEach(a=>re(a)):i.forEach(a=>re(a)),S("Import successful")}catch{S("Invalid JSON")}},t.readAsText(e),bn.value="",ye()}),ur?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),ye()}),fr?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){S("Add your Apps Script URL in Settings first"),ye();return}if(!f.length){S("No tasks to sync"),ye();return}S("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<f.length;i+=t){let s=f.slice(i,i+t),a=await Promise.allSettled(s.map(d=>{let c={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||j,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}));n+=a.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}S(`Sync complete: ${f.length-n} ok${n?`, ${n} failed`:""}`),ye()}),$e&&($e.value=localStorage.getItem("syncUrl")||""),pr?.addEventListener("click",()=>{$e&&(localStorage.setItem("syncUrl",$e.value.trim()),S("Settings saved"))}),mr?.addEventListener("click",async()=>{if(!$e)return;let e=$e.value.trim();if(!e){S("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});S(t.ok?"Test ok":"Test failed")}catch{S("Test failed")}}),lr?.addEventListener("click",async()=>{if(!("Notification"in window)){S("Notifications not supported");return}if(Notification.permission==="granted"){S("Notifications enabled"),ke()?Me():(hn(),ki()),Fe(),$();return}try{await Notification.requestPermission()==="granted"?(S("Notifications enabled"),ke()?Me():(hn(),ki()),Fe(),$()):S("Notifications blocked")}catch{S("Notifications blocked")}}),Mi(),Q==="mobile"){let e=()=>{try{br()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return Vr(),Fe(),$(),K(),Q==="mobile"&&(window.setMobileRemindersFilter=Bi),{cancelReminder:dn,scheduleReminder:Xe,closeActiveNotifications:er,getActiveNotifications:()=>Ce,addNoteToReminder:mo,__testing:{setItems(e=[]){f=Array.isArray(e)?e.map(t=>({...t,category:G(t?.category)})):[],f=ft(f),ue(f),$()},render:$,getItems:()=>f.map(e=>({...e}))}}}var Xi,Ce,zi,jn,Vn,Ji,mn,It,Wn,j,Oo,Yn,we,Po,ve,$o=qn(()=>{Vi();Xi="memoryCue:activity",Ce=new Map,zi=!1,jn="service-worker.js",Vn="memory-cue-reminder-sync",Ji=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),mn=null,It=null,Wn=!1,j="General",Oo=Object.freeze([j,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Yn="memoryCue:offlineReminders",we=1024,Po=Object.freeze({}),ve=null});function rs(o){return new zn(o)}var qo,jo,zn,Vo=qn(()=>{qo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),jo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},zn=class o{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...jo,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let l=this.getFocusableElements();if(l.length===0){r.preventDefault(),this.modal.focus();return}let h=l[0],T=l[l.length-1],x=document.activeElement;r.shiftKey&&x===h?(r.preventDefault(),T.focus()):!r.shiftKey&&x===T&&(r.preventDefault(),h.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(qo)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let l=r?.detail?.mode==="edit";this.setEditMode(l),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let l=r.detail?.reason||"external-close";this.hide({reason:l})}dispatchEvent(r,l={}){let h=this.events[r];if(!h||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let T=new CustomEvent(h,{detail:l,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(T)}requestClose(r){let l={reason:r,controller:this};this.dispatchEvent("cancelled",l),this.dispatchEvent("closeRequest",{...l,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let l=this.animationHooks?.[r];typeof l=="function"&&await l(this)}addToStack(){let r=o.activeStack,l=r.indexOf(this);l!==-1&&r.splice(l,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=o.activeStack,l=r.indexOf(this);l!==-1&&r.splice(l,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{Jo as a,Vi as b,ts as c,$o as d,zn as e,rs as f,Vo as g};
