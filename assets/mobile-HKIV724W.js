import{a as T,b as R}from"./chunk-3TNT3436.js";import{b as U}from"./chunk-RCZ4YZVR.js";var M=U(()=>{R();(function(){let n=document.getElementById("fabCreate"),t=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!t||!i)return;t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open");let m=new Set;n&&m.add(n),document.querySelectorAll("[data-open-add-task]").forEach(l=>m.add(l));let y=Array.from(m).filter(l=>l instanceof HTMLElement),f=null,g=document.getElementById("priority"),h=document.getElementById("priorityChips");if(g&&h){let l=Array.from(h.querySelectorAll('input[name="priority"]')),p=g.value||"Medium",B=S=>{l.forEach(E=>{E.checked=E.value===S})},L=()=>{let S=g.value||"Medium";p=S,B(S)};l.forEach(S=>{S.addEventListener("change",()=>{S.checked&&g.value!==S.value&&(g.value=S.value,p=S.value,g.dispatchEvent(new Event("change",{bubbles:!0})))})}),g.addEventListener("change",L),L();let k=setInterval(()=>{if(!document.body.contains(g)){clearInterval(k);return}g.value!==p&&L()},250)}function s(l){f=l??null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open");let p=t.querySelector("input,select,textarea,button");p instanceof HTMLElement?p.focus():t instanceof HTMLElement&&t.focus()}function v(){t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open");let l=f&&document.body.contains(f)&&f||n;l&&typeof l.focus=="function"&&l.focus(),f=null}y.forEach(l=>{l.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),s(l)})}),i.addEventListener("click",l=>{l.preventDefault(),v()}),t.addEventListener("click",l=>{l.target instanceof HTMLElement&&l.target.matches("[data-close]")&&v()}),t.addEventListener("keydown",l=>{l.key==="Escape"&&v()}),document.addEventListener("cue:open",()=>{s()}),document.addEventListener("cue:close",()=>{v()}),typeof window<"u"&&(window.closeAddTask=v)})();T({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",addQuickBtnSel:"#quickAdd",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(n=>{console.error("Failed to initialise reminders:",n)});(()=>{let n=document.getElementById("createReminderForm"),t=document.getElementById("saveReminder");!(n instanceof HTMLFormElement)||!(t instanceof HTMLButtonElement)||n.addEventListener("submit",i=>{i.preventDefault(),!t.matches(":disabled")&&t.click()})})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let i=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(i)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let i=20;n.innerHTML="";let m=0;function y(){let h=t.slice(m,m+i);h.forEach(s=>n.appendChild(s)),m+=h.length}y();let f=document.createElement("div");f.id="listSentinel",n.appendChild(f);let g=new IntersectionObserver(h=>{h.some(s=>s.isIntersecting)&&m<t.length&&(y(),m>=t.length&&g.disconnect())});g.observe(f)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!n||!t||!i)return;function m(){t.classList.remove("hidden")}function y(){t.classList.add("hidden")}n.addEventListener("click",m),i.addEventListener("click",y),t.addEventListener("click",f=>{f.target instanceof HTMLElement&&f.target.matches("[data-close]")&&y()}),t.addEventListener("keydown",f=>{f.key==="Escape"&&y()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),i=document.getElementById("saveSyncSettings"),m=document.getElementById("testSync"),y=document.getElementById("syncAll"),f="syncUrl";if(!n)return;let g=["online","error"],h=null;function s(e,r){h=e,g.forEach(d=>n.classList.remove(d)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let a={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},c=typeof r=="string"&&r.trim()?r:a[e]||"";c&&(n.textContent=c),n.dataset.state=e}function v(){h!=="syncing"&&(navigator.onLine?h!=="online"&&s("online"):s("offline"))}function l(e){typeof localStorage>"u"||(e?localStorage.setItem(f,e):localStorage.removeItem(f))}function p(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(f)||""}catch{return""}}function B(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,a=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!a)return null;let c=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,d=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",u=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",o=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:a,dueIso:c&&c.trim()?c.trim():null,priority:d,category:u,done:o}}function L(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let a=r.dataset||{},c=null;if(a.reminder)try{c=JSON.parse(a.reminder)}catch{c=null}let d=c||{id:a.id||a.reminderId||r.getAttribute("data-id")||null,title:a.title||a.reminderTitle||"",dueIso:a.due||a.reminderDue||r.getAttribute("data-due")||null,priority:a.priority||a.reminderPriority||r.getAttribute("data-priority")||"",category:a.category||a.reminderCategory||r.getAttribute("data-category")||"",done:a.done==="true"||a.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!d.title){let u=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");u&&(d.title=u.textContent.trim())}if(!d.dueIso){let u=r.querySelector("[data-due], time");if(u){let o=u.getAttribute("datetime")||u.getAttribute("data-due");d.dueIso=o||u.textContent.trim()}}return B(d)}).filter(Boolean):[]}function k(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(c=>{if(!r.has(c)){r.add(c);try{let d=localStorage.getItem(c);if(!d)return;let u=JSON.parse(d);Array.isArray(u)?u.forEach(o=>e.push(o)):u&&typeof u=="object"&&(Array.isArray(u.items)&&u.items.forEach(o=>e.push(o)),Array.isArray(u.reminders)&&u.reminders.forEach(o=>e.push(o)))}catch{}}}),!e.length)for(let c=0;c<localStorage.length;c+=1){let d=localStorage.key(c);if(!(!d||r.has(d)||!/remind/i.test(d))){r.add(d);try{let u=localStorage.getItem(d);if(!u)continue;let o=JSON.parse(u);Array.isArray(o)?o.forEach(b=>e.push(b)):o&&typeof o=="object"&&(Array.isArray(o.items)&&o.items.forEach(b=>e.push(b)),Array.isArray(o.reminders)&&o.reminders.forEach(b=>e.push(b)))}catch{}}}return e.map(B).filter(Boolean)}function S(){let e=L();return e.length?e:k()}function E(e){e?(y?.setAttribute("aria-busy","true"),y?.setAttribute("disabled","disabled"),m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled")):(y?.removeAttribute("aria-busy"),m?.removeAttribute("aria-busy"),I())}function I(){!!((t?.value||"").trim()||p())?(y?.removeAttribute("disabled"),m?.removeAttribute("disabled")):(y?.setAttribute("disabled","disabled"),m?.setAttribute("disabled","disabled"))}let C=p();t&&C&&(t.value=C),I(),s(navigator.onLine?"online":"offline"),window.addEventListener("online",v),window.addEventListener("offline",v),t?.addEventListener("input",I),i?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){l(""),s("info","Sync URL cleared. Add a new one to enable syncing."),I();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{s("error","Enter a valid Apps Script URL before saving.");return}l(e),s("online","Sync settings saved."),I()}),m?.addEventListener("click",async()=>{let e=(t?.value||p()).trim();if(!e){s("error","Add your Apps Script URL in Settings first.");return}E(!0),s("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?s("online","Connection looks good."):s("error","Test failed. Please check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),s("error","Test failed. Please check your Apps Script deployment.")}finally{E(!1)}}),y?.addEventListener("click",async()=>{let e=(t?.value||p()).trim();if(!e){s("error","Add your Apps Script URL in Settings first.");return}let r=S();if(!r.length){s("info","No reminders to sync right now.");return}E(!0),s("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let a=20,c=0,d=0,u=o=>({id:o.id,title:o.title,dueIso:o.dueIso||null,priority:o.priority||"Medium",category:o.category||"General",done:!!o.done,source:"memory-cue-mobile"});try{for(let o=0;o<r.length;o+=a){let b=r.slice(o,o+a);(await Promise.allSettled(b.map(A=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u(A))})))).forEach(A=>{A.status==="fulfilled"&&A.value?.ok?c+=1:(A.status,d+=1)}),await new Promise(A=>setTimeout(A,300))}d?c?s("error",`Partial sync: ${c} success, ${d} failed.`):s("error","Sync failed. Please check your Apps Script URL and try again."):s("online",`Sync complete. ${c} reminder${c===1?"":"s"} updated.`)}catch(o){console.error("Sync failed",o),s("error","Sync failed. Please try again in a moment.")}finally{E(!1)}})})()});export default M();
