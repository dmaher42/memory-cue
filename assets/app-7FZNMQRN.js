var Cc=Object.defineProperty,Dc=Object.defineProperties;var kc=Object.getOwnPropertyDescriptors;var Ta=Object.getOwnPropertySymbols;var Nc=Object.prototype.hasOwnProperty,Fc=Object.prototype.propertyIsEnumerable;var Wo=(e,t,n)=>t in e?Cc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,B=(e,t)=>{for(var n in t||(t={}))Nc.call(t,n)&&Wo(e,n,t[n]);if(Ta)for(var n of Ta(t))Fc.call(t,n)&&Wo(e,n,t[n]);return e},ce=(e,t)=>Dc(e,kc(t));var Ia=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(t,n)=>(typeof require!="undefined"?require:t)[n]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var nt=(e,t)=>()=>(e&&(t=e(e=0)),t);var xa=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ca=(e,t,n)=>Wo(e,typeof t!="symbol"?t+"":t,n);function Mc(){if(typeof window=="undefined")return!1;let{CSS:e}=window;if(!e||typeof e.supports!="function")return!1;try{return e.supports("--fake-var","1px")}catch(t){return console.warn("Memory Cue: CSS.supports threw while checking custom property support",t),!1}}function Bc(){if(typeof window=="undefined")return null;let e=window.innerHeight;return typeof e!="number"||Number.isNaN(e)||e<=0?null:`${e*.01}px`}function ka(){if(typeof window=="undefined"||typeof document=="undefined")return()=>{};let e=document.documentElement;if(!e||e.nodeType!==1)return()=>{};if(Yo)return zo||(()=>{});if(!Mc())return e.style.removeProperty(Da),()=>{};let n=null,o=()=>{let v=Bc();v&&e.style.setProperty(Da,v)},i=()=>{n!==null&&window.cancelAnimationFrame(n),n=window.requestAnimationFrame(()=>{n=null,o()})},l=()=>i(),d=()=>i();o(),window.addEventListener("resize",l,{passive:!0}),window.addEventListener("orientationchange",d);let f=window.visualViewport;f&&(f.addEventListener("resize",i,{passive:!0}),f.addEventListener("scroll",i,{passive:!0}));let m=()=>i();window.addEventListener("focus",m,!0),Yo=!0;let g=()=>{n!==null&&(window.cancelAnimationFrame(n),n=null),window.removeEventListener("resize",l),window.removeEventListener("orientationchange",d),window.removeEventListener("focus",m,!0),f&&(f.removeEventListener("resize",i),f.removeEventListener("scroll",i)),Yo=!1,zo=null};return zo=g,g}var Da,Yo,zo,Na=nt(()=>{Da="--vh",Yo=!1,zo=null});var Fa,Ma,Ba,Pa,Ko,Ra=nt(()=>{Ko={SUPABASE_URL:(Ma=(Fa=window==null?void 0:window.__ENV)==null?void 0:Fa.SUPABASE_URL)!=null?Ma:"",SUPABASE_ANON_KEY:(Pa=(Ba=window==null?void 0:window.__ENV)==null?void 0:Ba.SUPABASE_ANON_KEY)!=null?Pa:""}});import{createClient as Pc}from"https://esm.sh/@supabase/supabase-js@2";function Oa(e){return typeof e=="string"?e.trim():""}function Rc(e){return e&&(Mt=e,Go=!0),Mt}function un(){var n,o;if(Mt)return Mt;if(!Go&&typeof window!="undefined"&&window.supabase)return Rc(window.supabase);Go=!0;let e=Oa((n=Ko)==null?void 0:n.SUPABASE_URL),t=Oa((o=Ko)==null?void 0:o.SUPABASE_ANON_KEY);if(!e||!t)return console.error("[supabase] Missing SUPABASE_URL or SUPABASE_ANON_KEY."),null;try{Mt=Pc(e,t),typeof window!="undefined"&&(window.supabase=Mt);try{let i=new URL(e).hostname.split(".")[0];console.info("[supabase] Client initialised for project:",i)}catch(i){console.info("[supabase] Client initialised.")}}catch(i){console.error("[supabase] Failed to initialise client.",i),Mt=null}return Mt}var Mt,Go,Xo=nt(()=>{Ra();Mt=null,Go=!1});function Ha(e={}){try{Object.assign(ye,e||{})}catch(t){console.warn("[supabase-auth] setAuthContext failed",t)}}async function Ua(e={}){var t;try{if(ye&&typeof ye.signInWithPopup=="function"&&ye.auth&&typeof ye.GoogleAuthProvider=="function")return ye.signInWithPopup(ye.auth,new ye.GoogleAuthProvider);if(ye&&typeof ye.signInWithRedirect=="function"&&ye.auth&&typeof ye.GoogleAuthProvider=="function")return ye.signInWithRedirect(ye.auth,new ye.GoogleAuthProvider);let n=un();if(n&&n.auth){if(typeof n.auth.signInWithOAuth=="function")return n.auth.signInWithOAuth(B({provider:"google"},e));if(typeof n.auth.signIn=="function")return n.auth.signIn({provider:"google"})}}catch(n){console.error("[supabase-auth] startSignInFlow error",n);try{(t=ye==null?void 0:ye.toast)==null||t.call(ye,"Sign-in failed")}catch(o){console.warn("[supabase-auth] toast handler failed",o)}throw n}return Promise.resolve(null)}async function $a(){try{if(ye&&typeof ye.signOut=="function")return ye.signOut(ye.auth);let e=un();if(e&&e.auth&&typeof e.auth.signOut=="function")return e.auth.signOut()}catch(e){throw console.error("[supabase-auth] startSignOutFlow error",e),e}return Promise.resolve(null)}function _c(e){return e?Array.isArray(e)?e:[e]:[]}function Yn(e){return Array.from(new Set(e.filter(t=>t instanceof HTMLElement||typeof SVGElement!="undefined"&&t instanceof SVGElement)))}function Ve(e,t){let n=_c(t).filter(Boolean);if(!n.length)return[];let o=n.flatMap(i=>Array.from(e.querySelectorAll(i)));return Yn(o)}function Hc(e,t=document){let n=t instanceof Document||t instanceof HTMLElement?t:document;return{authForms:Ve(n,e.authForm),emailInputs:Ve(n,e.emailInput),signInButtons:Ve(n,e.signInButtons),signOutButtons:Ve(n,e.signOutButtons),userBadges:Ve(n,e.userBadge),userBadgeEmails:Ve(n,e.userBadgeEmail),userBadgeInitials:Ve(n,e.userBadgeInitial),userNameEls:Ve(n,e.userName),syncStatusEls:Ve(n,e.syncStatus),syncStatusTextEls:Ve(n,e.syncStatusText),statusIndicatorEls:Ve(n,e.statusIndicator),feedbackEls:Ve(n,e.feedback)}}function qn(e,t){Yn(Array.isArray(e)?e:[e]).forEach(n=>{n instanceof HTMLElement&&(n.classList.toggle("hidden",!t),t?n.removeAttribute("hidden"):n.setAttribute("hidden",""))})}function Bt(e,t){Yn(Array.isArray(e)?e:[e]).forEach(n=>{n instanceof HTMLElement&&(n.textContent=t||"")})}function Uc(e,t){Yn(e).forEach(n=>{n instanceof HTMLElement&&(n.dataset.state=t,n.classList.toggle("online",t==="online"),n.classList.toggle("offline",t!=="online"))})}function Wn(e,t){Yn(e).forEach(n=>{if(!(n instanceof HTMLElement))return;n.textContent=t||"";let o=!!t;n.classList.toggle("hidden",!o),o?n.removeAttribute("hidden"):n.setAttribute("hidden","")})}function ja(e={}){let t=B(B({},_a.syncStatusText),e.syncStatusText||{});return ce(B(B({},_a),e),{syncStatusText:t})}function Vn(e,{user:t,messages:n}={}){var k,N;let o=ja(n),i=!!t;qn(e.signInButtons,!i),qn(e.authForms,!i),qn(e.signOutButtons,i),qn(e.userBadges,i);let l=typeof(t==null?void 0:t.email)=="string"?t.email:"",d=l?l.charAt(0).toUpperCase():"U";i?(Bt(e.userBadgeEmails,l),Bt(e.userBadgeInitials,d),Bt(e.userNameEls,l)):(Bt(e.userBadgeEmails,""),Bt(e.userBadgeInitials,""),Bt(e.userNameEls,""));let f=typeof o.signedIn=="function"?o.signedIn(t):o.signedIn,m=typeof o.signedOut=="function"?o.signedOut(t):o.signedOut,g=i?f:m,v=!i;e.syncStatusEls.length&&(Bt(e.syncStatusEls,g),e.syncStatusEls.forEach(M=>{M instanceof HTMLElement&&(M.classList.toggle("online",i),M.dataset.state=i?"online":"offline")}),qn(e.syncStatusEls,v));let p=i?(k=o.syncStatusText)==null?void 0:k.signedIn:(N=o.syncStatusText)==null?void 0:N.signedOut;Bt(e.syncStatusTextEls,p||""),Uc(e.statusIndicatorEls,i?"online":"offline"),Wn(e.feedbackEls,"")}function $c(e,t){t.authForms.forEach(n=>{!(n instanceof HTMLFormElement)||n.dataset.supabaseAuthBound==="true"||(n.dataset.supabaseAuthBound="true",n.addEventListener("submit",async o=>{o.preventDefault();let i=t.emailInputs.find(d=>n.contains(d))||n.querySelector('input[type="email"]'),l=typeof(i==null?void 0:i.value)=="string"?i.value.trim():"";if(!l){Wn(t.feedbackEls,"Enter an email address to continue.");return}try{let{error:d}=await e.auth.signInWithOtp({email:l});d?Wn(t.feedbackEls,d.message||"Unable to send magic link."):Wn(t.feedbackEls,"Magic link sent. Check your email.")}catch(d){Wn(t.feedbackEls,(d==null?void 0:d.message)||"Unable to send magic link.")}}))})}function jc(e,t){t.signOutButtons.forEach(n=>{!(n instanceof HTMLElement)||n.dataset.supabaseAuthBound==="true"||(n.dataset.supabaseAuthBound="true",n.addEventListener("click",async()=>{try{await e.auth.signOut()}catch(o){console.error("[supabase] Sign-out failed.",o)}}))})}function qa(e={}){let{supabase:t,scope:n=document,selectors:o={},messages:i={},disableButtonBinding:l=!1,onSessionChange:d}=e,f=B(B({},Oc),o),m=Hc(f,n),g=ja(i);Vn(m,{user:null,messages:g});let v=t||un()||(typeof window!="undefined"?window.supabase:null);if(!v)return{supabase:null,elements:m,applyAuthState:N=>Vn(m,ce(B({},N),{messages:g})),destroy(){}};$c(v,m),l||jc(v,m);let p=[],{data:k}=v.auth.onAuthStateChange((N,M)=>{var z,Z;if(Vn(m,{user:(z=M==null?void 0:M.user)!=null?z:null,messages:g}),typeof d=="function")try{d((Z=M==null?void 0:M.user)!=null?Z:null,M)}catch(X){console.error("[supabase] onSessionChange handler failed.",X)}});return k!=null&&k.subscription&&p.push(()=>{try{k.subscription.unsubscribe()}catch(N){}}),v.auth.getSession().then(({data:N,error:M})=>{var z,Z;M||Vn(m,{user:(Z=(z=N==null?void 0:N.session)==null?void 0:z.user)!=null?Z:null,messages:g})}).catch(N=>{console.error("[supabase] getSession failed.",N)}),{supabase:v,elements:m,applyAuthState:N=>Vn(m,ce(B({},N),{messages:g})),destroy(){p.forEach(N=>{try{N()}catch(M){}})}}}var ye,Oc,_a,Jo=nt(()=>{Xo();ye={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};Oc={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},_a={signedOut:"",signedIn:e=>`Reminders syncing for ${(e==null?void 0:e.email)||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var za=xa((lf,zn)=>{var Hr=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Va(e){if(!e||typeof e!="object")return null;let t=Object.entries(e).filter(([n,o])=>typeof o=="string"&&o.trim()!=="");return t.length?Object.fromEntries(t):null}function qc(){var l;let e=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{},t=Va(e==null?void 0:e.__FIREBASE_CONFIG);if(t)return t;let n=Va((l=e==null?void 0:e.__ENV)==null?void 0:l.FIREBASE_CONFIG);if(n)return n;let i=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((d,[f,m])=>{var v,p;let g=(p=(v=e==null?void 0:e.__ENV)==null?void 0:v[f])!=null?p:e==null?void 0:e[f];return typeof g=="string"&&g.trim()!==""&&(d[m]=g),d},{});return Object.keys(i).length?i:null}function Ya(){let e=qc();return e?B(B({},Hr),e):B({},Hr)}var Wa={DEFAULT_FIREBASE_CONFIG:Hr,getFirebaseConfig:Ya};if(typeof globalThis!="undefined"){let e=globalThis;e.memoryCueFirebase=e.memoryCueFirebase||{},e.memoryCueFirebase.getFirebaseConfig=Ya,e.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Hr}typeof zn!="undefined"&&zn.exports&&(zn.exports=Wa,zn.exports.default=Wa)});function Yc(){var n;if(ot)return B({},ot);let e=oi(),t=e==null?void 0:e.memoryCueFirebase;if(t&&typeof t.getFirebaseConfig=="function")return ot=t.getFirebaseConfig(),B({},ot);if(typeof Ia=="function")try{let o=za();if(o){let i=typeof o.getFirebaseConfig=="function"?o.getFirebaseConfig:typeof((n=o.default)==null?void 0:n.getFirebaseConfig)=="function"?o.default.getFirebaseConfig:null;if(i)return ot=i(),B({},ot)}}catch(o){}return t&&t.DEFAULT_FIREBASE_CONFIG?(ot=B({},t.DEFAULT_FIREBASE_CONFIG),B({},ot)):(ot=B({},Wc),B({},ot))}function oi(){return typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:{}}function Qa(){let e=oi(),t=e&&e.TimestampTrigger;return typeof t=="function"?t:null}function ht(){var e;return typeof window=="undefined"||!("Notification"in window)||typeof navigator=="undefined"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration=="undefined"||typeof((e=ServiceWorkerRegistration.prototype)==null?void 0:e.showNotification)!="function"?!1:!!Qa()}function zc(){if(typeof window=="undefined"||!window.location)return Qo;try{return new URL(Qo,window.location.href).href}catch(e){return Qo}}async function Pt(){return Ur||(typeof navigator=="undefined"||!("serviceWorker"in navigator)?null:(Ur=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(zc()),await navigator.serviceWorker.ready}catch(e){return console.warn("Service worker registration failed",e),null}})(),Ur))}async function Ja(e){if(!e||typeof e!="object"||typeof navigator=="undefined"||!navigator.serviceWorker)return!1;try{let t=await Pt();if(!t)return!1;let n=new Set;navigator.serviceWorker.controller&&n.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(i=>{let l=t[i];l&&n.add(l)});let o=!1;return n.forEach(i=>{try{i.postMessage(e),o=!0}catch(l){console.warn("Failed posting message to service worker",l)}}),o}catch(t){return console.warn("Unable to reach service worker",t),!1}}async function $r(){if(ht())return!1;if(ei)return!0;if(typeof navigator=="undefined"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Kn)try{return await Kn}catch(e){}Kn=(async()=>{let e=await Pt();if(!e)return!1;let t=!1;if("periodicSync"in e)try{let n=await e.periodicSync.getTags();(!Array.isArray(n)||!n.includes(Zo))&&await e.periodicSync.register(Zo,{minInterval:15*60*1e3}),t=!0}catch(n){console.warn("Periodic background sync unavailable",n)}if(!t&&"sync"in e)try{await e.sync.register(Zo),t=!0}catch(n){console.warn("Background sync unavailable",n)}return t})();try{let e=await Kn;return e&&(ei=!0),e}catch(e){return console.warn("Background reminder sync setup failed",e),ei=!1,!1}finally{Kn=null}}async function ni(e=[],{requestCheck:t=!1}={}){if(!ht()&&!(typeof navigator=="undefined"||!navigator.serviceWorker))try{let n=await Pt();if(!n)return;let o=await Ja({type:Xa.updateScheduledReminders,reminders:Array.isArray(e)?e:[]});if(t&&await Ja({type:Xa.checkScheduledReminders}),!o&&typeof n.update=="function")try{await n.update()}catch(i){}}catch(n){console.warn("Failed syncing reminders with service worker",n)}}async function ri(e,t){if(ht())try{let n=t||await Pt();if(!n)return;let o=[];try{o=await n.getNotifications({tag:e,includeTriggered:!0})}catch(i){o=await n.getNotifications({tag:e})}for(let i of o)try{i.close()}catch(l){}}catch(n){}}function Za(){for(let e of Array.from(gt.values()))try{e.close()}catch(t){}gt.clear()}function Kc(){if(Ga||typeof window=="undefined"||typeof window.addEventListener!="function")return;let e=()=>Za();["pagehide","beforeunload"].forEach(t=>{try{window.addEventListener(t,e)}catch(n){}}),Ga=!0}function Te(e){if(typeof e=="string"){let t=e.replace(/\s+/g," ").trim();if(t)return t}return Ae}async function jr(e={}){var Sa;let t=r=>r?document.querySelector(r):null,n=r=>r?Array.from(document.querySelectorAll(r)):[],o=t(e.titleSel),i=t(e.dateSel),l=t(e.timeSel),d=t(e.detailsSel),f=t(e.prioritySel),m=t(e.categorySel),g=t(e.saveBtnSel),v=t(e.cancelEditBtnSel),p=t(e.listSel),k=t(e.detailPanelSel),N=t(e.detailEmptySel),M=t(e.detailContentSel),z=t(e.detailTitleSel),Z=t(e.detailDueSel),X=t(e.detailPrioritySel),V=t(e.detailCategorySel),I=t(e.detailNotesSel),w=((Sa=I==null?void 0:I.dataset)==null?void 0:Sa.placeholder)||"No notes added yet.",j=t(e.detailClearSel),$=n(e.googleSignInBtnSel),K=n(e.googleSignOutBtnSel),O=t(e.statusSel),de=t(e.syncStatusSel),lt={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},x=6e3,P=null,pe=null;function me(r,{clearMessage:a=!0}={}){P&&(r&&P.tokenId!==r||(P.timeoutId&&clearTimeout(P.timeoutId),a&&O&&O.dataset.undoToken===P.tokenId&&(typeof O.replaceChildren=="function"?O.replaceChildren():O.textContent="",delete O.dataset.undoToken,delete O.dataset.statusKind),P=null))}function $e(r){if(!O)return;let a=document.createElement("span");a.textContent="Reminder deleted.";let s=document.createTextNode(" "),c=document.createElement("button");c.type="button",c.textContent="Undo",c.className="status-undo",c.addEventListener("click",()=>vc(r.tokenId)),r.button=c,typeof O.replaceChildren=="function"?O.replaceChildren(a,s,c):(O.textContent="",O.append(a,s,c)),O.dataset.statusKind="undo",O.dataset.undoToken=r.tokenId}function $t(r){if(!k)return;let a=!!r;if(k.dataset.state=a?"active":"empty",k.dataset.selectedId=a&&(r!=null&&r.id)?r.id:"",N&&(N.classList.toggle("hidden",a),N.setAttribute("aria-hidden",a?"true":"false")),M&&(M.classList.toggle("hidden",!a),M.setAttribute("aria-hidden",a?"false":"true")),!a){z&&(z.textContent=""),Z&&(Z.textContent=""),X&&(X.textContent=""),V&&(V.textContent=""),I&&(I.textContent=w,I.dataset.empty="true");return}if(z&&(z.textContent=r.title||"Untitled reminder"),Z&&(Z.textContent=Ea(r)),X&&(X.textContent=r.priority||"Medium"),V&&(V.textContent=r.category||Ae),I){let s=typeof r.notes=="string"?r.notes.trim():"";s?(I.textContent=s,I.dataset.empty="false"):(I.textContent=w,I.dataset.empty="true")}}function Tn(){pe=null,$t(null)}function mr(r){pe=(r==null?void 0:r.id)||null,$t(r||null)}function Je(){if(!k)return;if(!pe){$t(null);return}let r=S.find(a=>(a==null?void 0:a.id)===pe);if(r){$t(r);return}Tn()}$t(null);function on(r,a){if(!de)return;let s=["online","offline","error"];s.forEach(y=>de.classList.remove(y)),s.includes(r)&&de.classList.add(r),de.dataset.state=r;let c=typeof a=="string"?a:lt[r]||"";r==="online"||r==="offline"?(de.textContent="",de.dataset.compact="true",c?(de.setAttribute("aria-label",c),de.setAttribute("title",c)):(de.removeAttribute("aria-label"),de.removeAttribute("title"))):(de.textContent=c,de.removeAttribute("data-compact"),c?(de.setAttribute("aria-label",c),de.setAttribute("title",c)):(de.removeAttribute("aria-label"),de.removeAttribute("title")))}let te=t(e.notesSel),Tt=t(e.saveNotesBtnSel),ct=t(e.loadNotesBtnSel),jt=t(e.countTotalSel),dt=t(e.googleUserNameSel),ve=t(e.dateFeedbackSel),Ie=t(e.voiceBtnSel),In=t(e.notifBtnSel),Re=t(e.moreBtnSel),We=t(e.moreMenuSel),xn=t(e.copyMtlBtnSel),b=t(e.importFileSel),U=t(e.exportBtnSel),ne=t(e.syncAllBtnSel),je=t(e.syncUrlInputSel),an=t(e.saveSettingsSel),ut=t(e.testSyncSel),Cn=n(e.openSettingsSel),xe=t(e.settingsSectionSel),ft=t(e.emptyStateSel),It=t(e.listWrapperSel),we=t(e.categoryOptionsSel),he=t(e.plannerContextSel),J=t(e.plannerLessonInputSel),xt=e.variant||"mobile",Rl=typeof e.autoWireAuthButtons=="boolean"?e.autoWireAuthButtons:xt!=="desktop",Zi="mc:lastDefaults",Ao=()=>{he&&(he.classList.add("hidden"),he.setAttribute("aria-hidden","true"),typeof he.replaceChildren=="function"?he.replaceChildren():he.textContent=""),J&&(J.value="",J.dataset&&(delete J.dataset.lessonDayLabel,delete J.dataset.lessonTitle,delete J.dataset.lessonSummary))},Ol=(r={})=>{if(!he)return;let a=typeof r.dayLabel=="string"?r.dayLabel.trim():"",s=typeof r.lessonTitle=="string"?r.lessonTitle.trim():"",c=typeof r.summary=="string"?r.summary.trim():"",u=document.createElement("p");u.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",u.textContent=a?`${a} lesson`:"Planner lesson";let y=document.createElement("p");y.className="text-sm font-semibold text-base-content",y.textContent=s||c||"Planner reminder";let h=c?document.createElement("p"):null;h&&(h.className="text-sm text-base-content/70",h.textContent=c),typeof he.replaceChildren=="function"?he.replaceChildren(...[u,y,h].filter(Boolean)):(he.textContent="",he.append(u,y),h&&he.append(h)),he.classList.remove("hidden"),he.removeAttribute("aria-hidden")},_l=(r={})=>{if(!r||typeof r!="object")return;let a=typeof r.plannerLessonId=="string"?r.plannerLessonId:"";o&&typeof r.reminderTitle=="string"&&(o.value=r.reminderTitle),d&&typeof r.reminderNotes=="string"&&(d.value=r.reminderNotes),i&&typeof r.dueDate=="string"&&(i.value=r.dueDate),J&&(J.value=a,J.dataset&&(J.dataset.lessonDayLabel=dayLabel,J.dataset.lessonTitle=lessonTitle,J.dataset.lessonSummary=summary)),Ol(r)};function To(){if(typeof localStorage=="undefined")return{};try{return JSON.parse(localStorage.getItem(Zi)||"{}")||{}}catch(r){return{}}}function Hl(r={}){if(typeof localStorage!="undefined")try{localStorage.setItem(Zi,JSON.stringify(r))}catch(a){}}function ea(r){let a=To(),s={category:Te((r==null?void 0:r.category)||a.category||Ae),priority:(r==null?void 0:r.priority)||a.priority||"Medium"};Hl(s)}let ta='fieldset#priorityChips input[name="priority"]';function Io(){try{let r=document.querySelector(`${ta}:checked`);if(r&&r.value)return r.value}catch(r){}return f&&typeof f.value=="string"&&f.value?f.value:"Medium"}function pr(r){let a=r||"Medium";f&&typeof f.value!="undefined"&&(f.value=a);try{let s=Array.from(document.querySelectorAll(ta));if(!s.length)return;let c=!1;if(s.forEach(u=>{let y=u.value===a;u.checked=y,c=c||y}),!c){let u=s.find(y=>y.value==="Medium")||s[0];u&&(u.checked=!0)}}catch(s){}}function na(){let r=To();r.category&&m&&(m.value=r.category),r.priority&&pr(r.priority)}na();let Ce=typeof document!="undefined"?document.getElementById("quickAddInput"):null,xo=typeof document!="undefined"?document.getElementById("quickAddSubmit"):null,Oe=typeof document!="undefined"?document.getElementById("quickAddVoiceBtn"):null,Co=null;function Ul(r,a){let s=Date.now(),c=To(),u=typeof a=="string"&&a?a:null;return{id:Nr(),title:(r||"").trim(),priority:c.priority||Io(),category:Te(c.category||(m==null?void 0:m.value)||Ae),notes:"",done:!1,createdAt:s,updatedAt:s,due:u,pendingSync:!De}}async function Do(){if(!Ce)return;if(typeof Co=="function")try{Co()}catch(u){}let r=(Ce.value||"").trim();if(!r)return;let a=null;try{let u=Br(r);u&&u.time&&(a=new Date(`${u.date}T${u.time}:00`).toISOString())}catch(u){a=null}let s=Ul(r,a);Po(s,{position:"start"}),S.unshift(s),qe(S);let c=Rn(S);qt=!0,Se(),ke(),c?S.forEach(u=>Fe(u)):Fe(s),_n(s),zt(s),kt(),ea(s),Dn();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:S}}))}catch(u){}Qe({action:"created",label:`Reminder added \xB7 ${s.title}`}),Ce.value=""}typeof window!="undefined"&&(window.memoryCueQuickAddNow=Do),xo==null||xo.addEventListener("click",()=>{Do()}),Ce==null||Ce.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),Do())});function $l(){if(typeof HTMLElement=="undefined"||!(Oe instanceof HTMLElement)||!(Ce instanceof HTMLInputElement)||Oe.dataset.voiceBound==="true")return;if(Oe.dataset.voiceBound="true",typeof window=="undefined"){Oe.setAttribute("disabled","true"),Oe.setAttribute("aria-disabled","true");return}let r=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof r!="function"){Oe.setAttribute("disabled","true"),Oe.setAttribute("aria-disabled","true"),Oe.getAttribute("title")||(Oe.title="Voice input is not supported in this browser.");return}let a=null,s=!1,c=h=>{s=h,Oe.setAttribute("aria-pressed",h?"true":"false"),Oe.dataset.listening=h?"true":"false",Oe.classList.toggle("is-listening",h)},u=()=>{if(a)return a;a=new r;let h=typeof document!="undefined"&&document.documentElement&&document.documentElement.lang||typeof navigator!="undefined"&&navigator.language||"en-US";a.lang=h,a.interimResults=!1,a.maxAlternatives=1,a.addEventListener("result",L=>{var R,q,H,le;let A=((le=(H=(q=(R=L==null?void 0:L.results)==null?void 0:R[0])==null?void 0:q[0])==null?void 0:H.transcript)==null?void 0:le.trim())||"";if(A){Ce.value=A;try{Ce.focus({preventScroll:!0})}catch(be){Ce.focus()}try{let be=Ce.value.length;typeof Ce.setSelectionRange=="function"&&Ce.setSelectionRange(be,be)}catch(be){}}});let E=()=>{c(!1)};return a.addEventListener("end",E),a.addEventListener("error",E),a},y=()=>{if(!(!s||!a)){try{a.stop()}catch(h){}c(!1)}};Co=y,Oe.addEventListener("click",()=>{let h=u();if(h){if(s){y();return}try{h.start(),c(!0)}catch(E){console.warn("Quick add voice error:",E),c(!1)}}}),typeof window!="undefined"&&window.addEventListener("pagehide",y),c(!1)}$l(),typeof window!="undefined"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",r=>{r.target&&(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)||(r.key==="/"||r.key==="q"||r.key==="Q")&&Ce&&(r.preventDefault(),Ce.focus())})));try{xt==="mobile"&&typeof document!="undefined"&&document.body.classList.add("show-full")}catch(r){}let jl=e.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",ra=typeof window!="undefined"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,ql=typeof window!="undefined"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",yr=e.reminderLandingPath||(xt==="desktop"?"index.html#reminders":"mobile.html"),mt=(r,a={})=>{document.dispatchEvent(new CustomEvent(r,{detail:a}))};function oa(){var s,c;if(typeof document=="undefined")return;let r=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!r)return;(s=r.classList)==null||s.remove("open"),(c=r.classList)==null||c.add("hidden"),r.setAttribute("hidden",""),r.setAttribute("aria-hidden","true"),r.removeAttribute("open");let a=r.querySelector(".sheet-backdrop, .backdrop");a instanceof HTMLElement&&(a.classList.add("hidden"),a.setAttribute("hidden",""),a.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch(u){}}function Dn(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:S}}))}catch(r){}}m&&!m.value&&(m.value=Ae),ht()&&Pt();function Qe(r={}){if(!(typeof r.label=="string"?r.label.trim():""))return;let s=B({type:"reminder",target:{view:"reminders"}},r);s.target?typeof s.target=="string"?s.target={view:s.target}:typeof s.target=="object"&&s.target.view==null&&(s.target.view="reminders"):s.target={view:"reminders"},s.timestamp||(s.timestamp=new Date().toISOString());let c=!1;try{typeof window!="undefined"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(s),c=!0)}catch(u){c=!1}if(!c){if(typeof window!="undefined"){let u=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(u.push(s);u.length>20;)u.shift();window.memoryCueActivityQueue=u}if(typeof document!="undefined"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Ka,{detail:s}));else if(document.createEvent){let u=document.createEvent("CustomEvent");u&&u.initCustomEvent&&(u.initCustomEvent(Ka,!1,!1,s),document.dispatchEvent(u))}}catch(u){}}}function Vl(){if(typeof HTMLElement=="undefined"||!(Ie instanceof HTMLElement))return;let r=typeof HTMLInputElement!="undefined"&&o instanceof HTMLInputElement,a=typeof HTMLTextAreaElement!="undefined"&&o instanceof HTMLTextAreaElement;if(!r&&!a||Ie.dataset.voiceBound==="true")return;if(Ie.dataset.voiceBound="true",typeof window=="undefined"){Ie.setAttribute("disabled","true"),Ie.setAttribute("aria-disabled","true");return}let s=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof s!="function"){Ie.setAttribute("disabled","true"),Ie.setAttribute("aria-disabled","true"),Ie.getAttribute("title")||(Ie.title="Voice input is not supported in this browser.");return}let c=null,u=!1,y=A=>{u=A,Ie.setAttribute("aria-pressed",A?"true":"false"),Ie.dataset.listening=A?"true":"false",Ie.classList.toggle("is-listening",A)},h=()=>{if(c)return c;c=new s,c.lang="en-US",c.interimResults=!1,c.maxAlternatives=1,c.addEventListener("result",R=>{var H,le,be,F;let q=((F=(be=(le=(H=R.results)==null?void 0:H[0])==null?void 0:le[0])==null?void 0:be.transcript)==null?void 0:F.trim())||"";if(q){o.value=q;try{o.focus({preventScroll:!0})}catch(T){try{o.focus()}catch(G){}}try{let T=o.value.length;typeof o.setSelectionRange=="function"&&o.setSelectionRange(T,T)}catch(T){}Qe({action:"dictated",label:`Voice input captured \xB7 ${q}`})}});let A=()=>{y(!1)};return c.addEventListener("end",A),c.addEventListener("error",A),c},E=()=>{if(!(!u||!c)){try{c.stop()}catch(A){}y(!1)}};Ie.addEventListener("click",()=>{let A=h();if(A){if(u){E();return}try{A.start(),y(!0)}catch(R){console.warn("Speech recognition error:",R),y(!1)}}});let L=()=>{E()};typeof document!="undefined"&&(document.addEventListener("cue:close",L),document.addEventListener("reminders:updated",L)),y(!1)}Kc(),Vl();let gr,hr,br,Er,sn,wr,Sr,vr,Lr,Ar,Tr,kn,Nn,Ir,xr,ko,No,Cr,Fo,ia=e.firebaseDeps,Mo=typeof e.importModule=="function"?e.importModule:r=>import(r),Fn=oi(),Mn=!1,Ze=!1,Bo=null,pt=null,Bn=null,S=[],qt=!1,De=null,Vt=null,ln=null,Wt={},Le={};function qe(r=S){Array.isArray(r)&&r.sort((a,s)=>{let c=Number.isFinite(a==null?void 0:a.orderIndex)?a.orderIndex:-1/0,u=Number.isFinite(s==null?void 0:s.orderIndex)?s.orderIndex:-1/0;return c===u?ua(a||{},s||{}):u-c})}function Wl(r=S){if(!Array.isArray(r)||r.length===0)return{min:0,max:0};let a=1/0,s=-1/0;return r.forEach(c=>{let u=Number.isFinite(c==null?void 0:c.orderIndex)?c.orderIndex:null;u!=null&&(u<a&&(a=u),u>s&&(s=u))}),a===1/0&&(a=0),s===-1/0&&(s=0),{min:a,max:s}}function Pn(r=S){if(!Array.isArray(r)||r.length===0)return Array.isArray(r)?r:[];let a=r.every(c=>Number.isFinite(c==null?void 0:c.orderIndex)),s;if(a)s=r.slice(),qe(s);else{s=r.slice().sort(ua);let c=s.length;s.forEach((u,y)=>{u.orderIndex=(c-y)*rt})}return r===S&&(S=s),s}function Po(r,{position:a="start"}={}){if(!r||typeof r!="object")return;let{min:s,max:c}=Wl();if(a==="end"){let u=Number.isFinite(s)?s:0;r.orderIndex=u-rt||rt}else{let u=Number.isFinite(c)?c:0;r.orderIndex=u+rt||rt}}function Rn(r=S){if(!Array.isArray(r)||r.length<2)return!1;qe(r);let a=!1;for(let s=1;s<r.length;s+=1){let c=r[s-1],u=r[s],y=Number.isFinite(c==null?void 0:c.orderIndex)?c.orderIndex:null,h=Number.isFinite(u==null?void 0:u.orderIndex)?u.orderIndex:null;if(y==null||h==null||y<=h||y-h<1){a=!0;break}}if(!a)return!1;for(let s=0;s<r.length;s+=1)r[s].orderIndex=(r.length-s)*rt;return r===S&&qe(S),!0}let re={draggingId:null,dropTargetId:null,dropBefore:!0},aa=!1,D={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Yl(r){return!r||typeof r.closest!="function"?null:r.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function On(r){return!r||typeof r.closest!="function"?null:r.closest("[data-reminder-item]")}function Ct(){p&&(p.querySelectorAll(".drag-over-before, .drag-over-after").forEach(r=>{r.classList.remove("drag-over-before","drag-over-after")}),p.classList.remove("drag-over-list"))}function Ro(){if(!p)return;let r=p.querySelector(".is-dragging");r&&r.classList.remove("is-dragging"),Ct(),re.draggingId=null,re.dropTargetId=null,re.dropBefore=!0}function sa(r,a,s){if(!r||r===a)return;let c=S.findIndex(H=>(H==null?void 0:H.id)===r);if(c<0)return;let[u]=S.splice(c,1),y;if(!a)y=S.length;else{let H=S.findIndex(le=>(le==null?void 0:le.id)===a);if(H<0){S.splice(c,0,u);return}y=s?H:H+1}S.splice(y,0,u);let h=S[y-1],E=S[y+1],L=Number.isFinite(h==null?void 0:h.orderIndex)?h.orderIndex:null,A=Number.isFinite(E==null?void 0:E.orderIndex)?E.orderIndex:null,R;L!=null&&A!=null?R=(L+A)/2:L!=null?R=L-rt:A!=null?R=A+rt:R=rt,Number.isFinite(R)||(R=rt*(S.length+1)),u.orderIndex=R,qe(S);let q=Rn(S);qt=!0,Se(),ke(),q?S.forEach(H=>Fe(H)):Fe(u),Dn(),mt("memoryCue:remindersUpdated",{items:S}),Qe({action:"reordered",label:"Reminders reordered"})}function zl(r){var u;let a=On(r.target);if(!a)return;let s=(u=r.target)==null?void 0:u.closest("button, a, input, textarea, label");if(s&&s!==a){r.preventDefault();return}let c=a.dataset.id;if(c&&(re.draggingId=c,re.dropTargetId=null,re.dropBefore=!0,a.classList.add("is-dragging"),r.dataTransfer))try{r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",c)}catch(y){}}function Kl(r){if(!re.draggingId)return;let a=On(r.target);if(r.dataTransfer&&(r.dataTransfer.dropEffect="move"),!a){r.preventDefault(),re.dropTargetId=null,re.dropBefore=!1,Ct(),p==null||p.classList.add("drag-over-list");return}if(a.dataset.id===re.draggingId){r.preventDefault(),Ct();return}r.preventDefault();let s=a.getBoundingClientRect(),c=s.top+s.height/2,u=r.clientY<c;(re.dropTargetId!==a.dataset.id||re.dropBefore!==u)&&(Ct(),a.classList.add(u?"drag-over-before":"drag-over-after"),re.dropTargetId=a.dataset.id,re.dropBefore=u)}function Gl(r){let a=On(r.target);if(!a){p!=null&&p.contains(r.relatedTarget)||Ct();return}r.relatedTarget&&a.contains(r.relatedTarget)||(a.classList.remove("drag-over-before","drag-over-after"),p!=null&&p.contains(r.relatedTarget)||p==null||p.classList.remove("drag-over-list"))}function Xl(r){if(!re.draggingId)return;r.preventDefault();let a=On(r.target),s=(a==null?void 0:a.dataset.id)||null,c=re.dropBefore;if(a){let u=a.getBoundingClientRect(),y=u.top+u.height/2;c=r.clientY<y}else s=null,c=!1;sa(re.draggingId,s,c),Ro()}function Jl(){Ro()}function Ql(){!p||aa||(aa=!0,p.addEventListener("dragstart",zl),p.addEventListener("dragover",Kl),p.addEventListener("drop",Xl),p.addEventListener("dragend",Jl),p.addEventListener("dragleave",Gl),Dr())}function Dr(){if(!p||Dr._bound)return;if(!(()=>{if(typeof window=="undefined")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch(F){return!1}})()){Dr._bound=!0;return}let a=6,s=160;function c(){D.longPressTimer&&(clearTimeout(D.longPressTimer),D.longPressTimer=null)}function u(){p&&(D.initialTouchAction!=null?p.style.touchAction=D.initialTouchAction:p.style.removeProperty("touch-action"))}function y({keepHighlights:F=!1}={}){var T,G,ue;if(c(),D.item&&D.pointerId!=null)try{(G=(T=D.item).hasPointerCapture)!=null&&G.call(T,D.pointerId)&&D.item.releasePointerCapture(D.pointerId)}catch(Q){}if((ue=D.placeholder)!=null&&ue.parentNode)try{D.placeholder.parentNode.removeChild(D.placeholder)}catch(Q){}D.item&&(D.item.classList.remove("is-dragging"),D.originalStyles?D.item.setAttribute("style",D.originalStyles):D.item.removeAttribute("style")),u(),F||Ct(),Object.assign(D,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function h(F){return p?Array.from(p.querySelectorAll("[data-reminder-item]")).filter(T=>T!==F):[]}function E(F){var tt;let T=D.item;if(!T||D.ready)return;let G=T.getBoundingClientRect(),ue=window.getComputedStyle(T);D.ready=!0,re.draggingId=T.dataset.id||null,D.offsetY=F.clientY-G.top,D.fixedX=G.left;let Q=document.createElement("div");Q.className="touch-drag-placeholder",Q.setAttribute("aria-hidden","true"),Q.style.height=`${G.height}px`,Q.style.boxSizing="border-box",Q.style.marginTop=ue.marginTop,Q.style.marginBottom=ue.marginBottom,Q.style.marginLeft=ue.marginLeft,Q.style.marginRight=ue.marginRight,Q.style.borderRadius=ue.borderRadius,Q.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",Q.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",Q.style.pointerEvents="none",Q.style.display="block",Q.style.width="100%",(tt=T.parentNode)==null||tt.insertBefore(Q,T),D.placeholder=Q,D.longPressTimer=null,D.originalStyles=T.getAttribute("style")||"",T.classList.add("is-dragging"),T.style.position="fixed",T.style.left=`${G.left}px`,T.style.top=`${G.top}px`,T.style.width=`${G.width}px`,T.style.zIndex="999",T.style.pointerEvents="none",T.style.touchAction="none",D.initialTouchAction=p.style.touchAction||"",p.style.touchAction="none"}function L(F){let T=D.item;if(!T||!D.ready)return;let G=F-D.offsetY;T.style.top=`${G}px`,T.style.left=`${D.fixedX}px`}function A(F){if(!D.ready||!p)return;let T=D.item,G=h(T);if(Ct(),!G.length){re.dropTargetId=null,re.dropBefore=!1;return}let ue=null,Q=!1;for(let _ of G){let oe=_.getBoundingClientRect(),ie=oe.top+oe.height/2;if(F<ie){ue=_,Q=!0;break}}if(!ue){ue=G[G.length-1];let _=ue.getBoundingClientRect(),oe=_.top+_.height/2;Q=F<oe,Q||(Q=!1)}if(!ue){re.dropTargetId=null,re.dropBefore=!1;return}let tt=ue.getBoundingClientRect(),Or=tt.top+tt.height/2,C=F<Or;ue.classList.add(C?"drag-over-before":"drag-over-after"),re.dropTargetId=ue.dataset.id||null,re.dropBefore=C}function R(F){let T=re.draggingId,G=D.moved;if(!D.ready){y();return}y(),!F&&G&&T&&sa(T,re.dropTargetId,re.dropBefore),Ro()}function q(F){let T=F.pointerType||"";if(T&&T!=="touch"&&T!=="pen"||D.active)return;let G=On(F.target);if(!G)return;let ue=Yl(F.target);if(!(ue&&ue!==G)){D.active=!0,D.pointerId=F.pointerId,D.item=G,D.startX=F.clientX,D.startY=F.clientY,D.lastClientX=F.clientX,D.lastClientY=F.clientY,D.moved=!1,D.ready=!1,D.originalStyles=G.getAttribute("style")||"",D.startTime=F.timeStamp||Date.now(),re.dropTargetId=null,re.dropBefore=!0,re.draggingId=null,c(),D.longPressTimer=setTimeout(()=>{E({clientY:D.lastClientY})},s);try{G.setPointerCapture(F.pointerId)}catch(Q){}}}function H(F){if(!D.active||F.pointerId!==D.pointerId)return;let T=F.pointerType||"";if(!(T&&T!=="touch"&&T!=="pen")){if(D.lastClientX=F.clientX,D.lastClientY=F.clientY,!D.ready){let G=Math.abs(F.clientX-D.startX),ue=Math.abs(F.clientY-D.startY);if(G>a||ue>a){let Q=typeof F.timeStamp=="number"?F.timeStamp:Date.now();Math.abs(Q-D.startTime)>=s?(c(),E({clientY:D.lastClientY})):y()}return}F.preventDefault(),D.moved=!0,L(F.clientY),A(F.clientY)}}function le(F){!D.active||F.pointerId!==D.pointerId||R(!1)}function be(F){!D.active||F.pointerId!==D.pointerId||R(!0)}p.addEventListener("pointerdown",q),window.addEventListener("pointermove",H),window.addEventListener("pointerup",le),window.addEventListener("pointercancel",be),Dr._bound=!0}function la(){De=null,on("offline"),$.forEach(r=>r.classList.remove("hidden")),K.forEach(r=>r.classList.add("hidden")),dt&&(dt.textContent=""),Vt==null||Vt(),Vt=null,_o(),Se(),ke(),kt()}function Oo(){if(typeof localStorage=="undefined")return[];try{let r=localStorage.getItem(ti);if(!r)return[];let a=JSON.parse(r);return Array.isArray(a)?a.map(s=>{if(!s||typeof s!="object")return null;let c=Number.isFinite(s.createdAt)?s.createdAt:Date.now(),u=Number.isFinite(s.updatedAt)?s.updatedAt:c,y=Number(s.orderIndex);return{id:typeof s.id=="string"&&s.id?s.id:Nr(),title:typeof s.title=="string"?s.title:"",priority:s.priority||"Medium",category:Te(s.category),notes:typeof s.notes=="string"?s.notes:"",done:!!s.done,createdAt:c,updatedAt:u,due:typeof s.due=="string"&&s.due?s.due:null,pendingSync:!!s.pendingSync,orderIndex:Number.isFinite(y)?y:null,plannerLessonId:typeof s.plannerLessonId=="string"&&s.plannerLessonId.trim()?s.plannerLessonId.trim():null}}).filter(Boolean):[]}catch(r){return console.warn("Failed to load offline reminders",r),[]}}function Zl(r=[]){if(typeof localStorage!="undefined")try{if(!Array.isArray(r)||r.length===0){localStorage.removeItem(ti);return}let a=r.filter(s=>s&&typeof s=="object").map(s=>({id:s.id,title:s.title,priority:s.priority||"Medium",category:Te(s.category),notes:typeof s.notes=="string"?s.notes:"",done:!!s.done,createdAt:Number.isFinite(s.createdAt)?s.createdAt:Date.now(),updatedAt:Number.isFinite(s.updatedAt)?s.updatedAt:Date.now(),due:typeof s.due=="string"&&s.due?s.due:null,pendingSync:!!s.pendingSync,orderIndex:Number.isFinite(s.orderIndex)?s.orderIndex:null,plannerLessonId:typeof s.plannerLessonId=="string"&&s.plannerLessonId.trim()?s.plannerLessonId.trim():null}));localStorage.setItem(ti,JSON.stringify(a))}catch(a){console.warn("Failed to persist offline reminders",a)}}function ke(){qe(S),Zl(S)}function _o(){S=Pn(Oo())}_o();async function ec(){if(!De){S=Oo();return}let r=Pn(Oo());if(!r.length){S=[],ke();return}let a=r.filter(s=>s==null?void 0:s.pendingSync);if(a.length)for(let s of a)try{await Fe(s),s.pendingSync=!1}catch(c){console.warn("Failed to sync offline reminder",c)}S=Pn(r.map(s=>ce(B({},s),{pendingSync:!1}))),ke(),Se(),kt()}try{Le=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch(r){Le={}}if(Le&&typeof Le=="object"&&Object.values(Le).forEach(r=>{r&&typeof r=="object"&&(r.category=Te(r.category),r.priority=r.priority||"Medium",r.notes=typeof r.notes=="string"?r.notes:"",r.body=typeof r.body=="string"&&r.body?r.body:Hn(r),r.urlPath=r.urlPath||yr,Number.isFinite(r.updatedAt)||(r.updatedAt=Date.now()),Number.isFinite(r.notifiedAt)||(r.notifiedAt=null))}),!ht()){let r=ha();typeof Notification!="undefined"&&Notification.permission==="granted"?($r(),r.length&&ni(r,{requestCheck:!0})):r.length&&ni(r)}let kr=r=>{if(!Fn)return;let a=[Fn];Fn.window&&!a.includes(Fn.window)&&a.push(Fn.window);let s=!r;a.forEach(c=>{try{c.__memoryCueFirebaseUnavailable__=s}catch(u){}})};function tc(){if(!te)return;let r=document.getElementById("notesToolbar"),a=r==null?void 0:r.querySelector('[data-action="columns"]'),s="mobileNotes",c="mobileNotesColumns",u=typeof document!="undefined"&&typeof document.execCommand=="function",y=()=>"value"in te?te.value:te.innerHTML,h=R=>{if("value"in te){te.value=R;return}if(typeof R!="string"||R.length===0){te.innerHTML="";return}let q=R.trim();if(/<\/?[a-z][\s\S]*>/i.test(q)){te.innerHTML=R;return}let le=R.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");te.innerHTML=le},E=R=>{R?te.classList.add("notes-editor--columns"):te.classList.remove("notes-editor--columns"),a&&a.setAttribute("aria-pressed",String(!!R))},L="";try{L=localStorage.getItem(s)||""}catch(R){W("Unable to access saved notes")}h(L);let A=!1;try{A=localStorage.getItem(c)==="1"}catch(R){A=!1}E(A),te.addEventListener("input",()=>{L=y();try{localStorage.setItem(s,L)}catch(R){W("Notes saved for this session only")}}),Tt==null||Tt.addEventListener("click",()=>{L=y();try{localStorage.setItem(s,L),W("Notes saved")}catch(R){W("Notes saved for this session only")}}),ct==null||ct.addEventListener("click",()=>{let R=L;try{R=localStorage.getItem(s)||L}catch(q){W("Unable to load saved notes")}L=R,h(L)}),r==null||r.addEventListener("click",R=>{let q=R.target;if(!(q instanceof Element))return;let H=q.closest("button[data-action]");if(!H)return;let le=H.getAttribute("data-action");if(le==="columns"){let be=!te.classList.contains("notes-editor--columns");E(be);try{localStorage.setItem(c,be?"1":"0")}catch(F){W("Column preference saved for this session only")}return}if(!u){W("Formatting controls are not supported in this browser");return}te.focus(),le==="bullets"?document.execCommand("insertUnorderedList"):le==="numbers"&&document.execCommand("insertOrderedList")})}if(tc(),g==null||g.addEventListener("click",wa),ia)({initializeApp:gr,getFirestore:hr,enableMultiTabIndexedDbPersistence:br,enableIndexedDbPersistence:Er,doc:sn,setDoc:wr,deleteDoc:Sr,onSnapshot:vr,collection:Lr,query:Ar,orderBy:Tr,serverTimestamp:kn,getAuth:Nn,onAuthStateChanged:Ir,GoogleAuthProvider:xr,signInWithPopup:ko,signInWithRedirect:No,getRedirectResult:Cr,signOut:Fo}=ia),Mn=!0;else try{({initializeApp:gr}=await Mo("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:hr,enableMultiTabIndexedDbPersistence:br,enableIndexedDbPersistence:Er,doc:sn,setDoc:wr,deleteDoc:Sr,onSnapshot:vr,collection:Lr,query:Ar,orderBy:Tr,serverTimestamp:kn}=await Mo("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Nn,onAuthStateChanged:Ir,GoogleAuthProvider:xr,signInWithPopup:ko,signInWithRedirect:No,getRedirectResult:Cr,signOut:Fo}=await Mo("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Mn=!0}catch(r){Mn=!1,console.warn("Firebase modules failed to load:",r),W("Firebase failed to load; notes available offline"),kr(!1)}if(Mn&&typeof gr=="function"&&typeof hr=="function"&&typeof Nn=="function")try{let r=Yc();if(!r||typeof r!="object")throw new Error("Firebase config unavailable");if(!r.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",r.projectId),Bo=gr(r),pt=hr(Bo),Ze=!0,console.info("[Firebase] Firestore initialised",r.projectId),kr(!0)}catch(r){Ze=!1,console.warn("Firebase initialization failed:",r),W("Firebase failed to load; notes available offline"),kr(!1)}else Mn?(Ze=!1,kr(!1)):Ze=!1;Ze&&typeof br=="function"&&typeof Er=="function"&&function(){let a=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:null;a&&(a.__persistenceInitialized__||(a.__persistenceInitialized__=!0,(async()=>{try{await br(pt),console.info("[Firestore] Persistence: multi-tab enabled")}catch(s){if(s&&s.code==="failed-precondition")try{await Er(pt),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(c){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",(c==null?void 0:c.code)||c)}else s&&s.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",(s==null?void 0:s.code)||s)}})()))}(),Ze&&typeof Nn=="function"&&(Bn=Nn(Bo));function nc(r){if(typeof r!="string")return"";let a=r.trim();if(!a)return"";let s=a.indexOf("@");s>=0&&(a=a.slice(0,s)),a=a.replace(/_/g,"-");try{return new Intl.DateTimeFormat(a),a}catch(c){return""}}let rc=typeof navigator!="undefined"&&navigator.language?navigator.language:"",ca=nc(rc),cn=ca||"en-US",yt="UTC";try{let r=new Intl.DateTimeFormat().resolvedOptions();r.timeZone&&(yt=r.timeZone),!ca&&r.locale&&(cn=r.locale)}catch(r){}let oc=new Intl.DateTimeFormat(cn,{timeZone:yt,hour:"2-digit",minute:"2-digit"}),ic=new Intl.DateTimeFormat(cn,{timeZone:yt,weekday:"long",day:"numeric",month:"long"}),ac=new Intl.DateTimeFormat("en-CA",{timeZone:yt,year:"numeric",month:"2-digit",day:"2-digit"}),sc=new Intl.DateTimeFormat(cn,{timeZone:yt,weekday:"long"}),lc=new Intl.DateTimeFormat(cn,{timeZone:yt,month:"short",day:"numeric"});function Dt(r){let a=ac.formatToParts(r),s=a.find(y=>y.type==="year").value,c=a.find(y=>y.type==="month").value,u=a.find(y=>y.type==="day").value;return`${s}-${c}-${u}`}function da(r,a){let[s,c,u]=r.split("-").map(L=>parseInt(L,10)),[y,h]=a.split(":").map(L=>parseInt(L,10)),E=new Date;return E.setFullYear(s,(c||1)-1,u||1),E.setHours(y||0,h||0,0,0),E.toISOString()}let cc=new Intl.DateTimeFormat("en-CA",{timeZone:yt,year:"numeric",month:"2-digit",day:"2-digit"}),dc=new Intl.DateTimeFormat("en-CA",{timeZone:yt,hour:"2-digit",minute:"2-digit",hour12:!1});function uc(r){var a,s,c;try{let u=new Date(r),y=cc.formatToParts(u),h=((a=y.find(A=>A.type==="year"))==null?void 0:a.value)||"0000",E=((s=y.find(A=>A.type==="month"))==null?void 0:s.value)||"00",L=((c=y.find(A=>A.type==="day"))==null?void 0:c.value)||"00";return`${h}-${E}-${L}`}catch(u){return""}}function fc(r){var a,s,c,u;try{let y=new Date(r),h=dc.formatToParts(y),E=((s=(a=h.find(A=>A.type==="hour"))==null?void 0:a.value)==null?void 0:s.padStart(2,"0"))||"00",L=((u=(c=h.find(A=>A.type==="minute"))==null?void 0:c.value)==null?void 0:u.padStart(2,"0"))||"00";return`${E}:${L}`}catch(y){return""}}function Nr(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Fr(){return Dt(new Date)}function mc(r){let a=new Date(r),s=(a.getDay()+6)%7;return a.setDate(a.getDate()-s),a.setHours(0,0,0,0),a}function zu(r){let a=mc(r),s=new Date(a);return s.setDate(s.getDate()+6),s.setHours(23,59,59,999),s}function Mr(r){return r==="High"?3:r==="Medium"?2:1}function ua(r,a){let s=r!=null&&r.done?1:0,c=a!=null&&a.done?1:0;if(s!==c)return s-c;let u=r!=null&&r.due?new Date(r.due).getTime():1/0,y=a!=null&&a.due?new Date(a.due).getTime():1/0;if(u!==y)return u-y;let h=Mr(a==null?void 0:a.priority)-Mr(r==null?void 0:r.priority);return h||((a==null?void 0:a.updatedAt)||0)-((r==null?void 0:r.updatedAt)||0)}function Ku(r,a){let s=Mr(a.priority)-Mr(r.priority);if(s)return s;let c=+new Date(r.due||0),u=+new Date(a.due||0);return c!==u?c-u:(r.updatedAt||0)>(a.updatedAt||0)?-1:1}function fa(r){if(!r)return"\u2014";try{let a=new Date(r+"T00:00:00");return ic.format(a)}catch(a){return r}}function Ho(r){return oc.format(r)}function pc(r){return String(r).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}function Gu(r){return r?pc(r).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function W(r){O&&(me(),O.dataset.statusKind="toast",O.textContent=r,clearTimeout(W._t),W._t=setTimeout(()=>{O&&O.dataset.statusKind==="toast"&&(O.textContent="",delete O.dataset.statusKind)},2500))}function yc(r,a){let s;return(...c)=>{clearTimeout(s),s=setTimeout(()=>r(...c),a)}}function Br(r){r=String(r||"").toLowerCase();let a={date:Fr(),time:""},s=E=>{let L=new Date,A=L.getDay(),R=(E-A+7)%7,q=new Date(L);return q.setDate(L.getDate()+(R===0?7:R)),q},c=E=>{let L=new Date,A=L.getDay(),R=(E-A+7)%7,q=new Date(L);return q.setDate(L.getDate()+R),q},u={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},y={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(r)){let E=new Date;E.setDate(E.getDate()+1),a.date=Dt(E)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(r)){let E=r.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),L=u[E[1]],A=s(L);a.date=Dt(A)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(r)){let E=r.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),L=u[E[1]],A=c(L);a.date=Dt(A)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(r)){let E=r.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),L=u[E[1]],A=s(L);a.date=Dt(A)}else if(/\bin\s+(\d+)\s+days?\b/.test(r)){let E=r.match(/\bin\s+(\d+)\s+days?\b/),L=parseInt(E[1],10),A=new Date;A.setDate(A.getDate()+L),a.date=Dt(A)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(r)){let E=r.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),L=parseInt(E[1],10),A=parseInt(E[2],10)-1,R=E[3]?parseInt(E[3],10):new Date().getFullYear(),q=new Date(R,A,L);a.date=Dt(q)}else for(let[E,L]of Object.entries(y)){let A=new RegExp(`\\b${E}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(A.test(r)){let R=r.match(A),q=parseInt(R[1],10),H=new Date().getFullYear(),le=new Date(H,L,q);a.date=Dt(le);break}}let h=r.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(h){let E=parseInt(h[1],10),L=h[2]?parseInt(h[2],10):0,A=h[3];A&&(A==="pm"&&E<12&&(E+=12),A==="am"&&E===12&&(E=0)),a.time=`${String(E).padStart(2,"0")}:${String(L).padStart(2,"0")}`}return a}let Uo=Ze&&Bn&&typeof xr=="function";Ha({authReady:Uo,auth:Bn,GoogleAuthProvider:xr,signInWithPopup:ko,signInWithRedirect:No,signOut:Fo,toast:W});let ma=Rl,pa=(r,a)=>{!(r instanceof HTMLElement)||r._authWired||(r.addEventListener("click",s=>{try{let c=a(s);c&&typeof c.then=="function"&&c.catch(u=>{console.error("Auth handler error:",u)})}catch(c){console.error("Auth handler error:",c)}}),r._authWired=!0)};ma&&$.length&&$.forEach(r=>pa(r,Ua)),Uo&&typeof Cr=="function"&&Cr(Bn).catch(()=>{}),ma&&K.length&&K.forEach(r=>pa(r,$a)),Uo&&typeof Ir=="function"?Ir(Bn,async r=>{r?(De=r.uid,on("online"),$.forEach(a=>a.classList.add("hidden")),K.forEach(a=>a.classList.remove("hidden")),dt&&(dt.textContent=r.displayName||r.email||""),gc(),await ec()):la()}):la();function gc(){if(!Ze||!pt||typeof Lr!="function"||typeof Ar!="function"||typeof Tr!="function"||typeof vr!="function")return;if(!De){_o(),Se(),ke(),kt();return}Vt&&Vt();let r=Lr(pt,"users",De,"reminders"),a=Ar(r,Tr("updatedAt","desc"));Vt=vr(a,s=>{let c=[];s.forEach(u=>{var L,A,R,q;let y=u.data(),h=Number(y.orderIndex),E=typeof y.plannerLessonId=="string"&&y.plannerLessonId?y.plannerLessonId:null;c.push({id:u.id,title:y.title,priority:y.priority,notes:y.notes||"",done:!!y.done,due:y.due||null,category:Te(y.category),createdAt:((A=(L=y.createdAt)==null?void 0:L.toMillis)==null?void 0:A.call(L))||0,updatedAt:((q=(R=y.updatedAt)==null?void 0:R.toMillis)==null?void 0:q.call(R))||0,pendingSync:!1,orderIndex:Number.isFinite(h)?h:null,plannerLessonId:E})}),S=Pn(c),Se(),ke(),kt()},s=>{console.error("Firestore sync error:",s),de&&on("error","Sync Error")})}async function Fe(r){if(!(!Ze||!De||!pt||typeof sn!="function"||typeof wr!="function"||typeof kn!="function"))try{await wr(sn(pt,"users",De,"reminders",r.id),{ownerUid:De,title:r.title,priority:r.priority,notes:r.notes||"",done:!!r.done,due:r.due||null,category:r.category||Ae,orderIndex:Number.isFinite(r.orderIndex)?r.orderIndex:null,plannerLessonId:typeof r.plannerLessonId=="string"&&r.plannerLessonId?r.plannerLessonId:null,createdAt:r.createdAt?new Date(r.createdAt):kn(),updatedAt:kn()},{merge:!0})}catch(a){console.error("Save failed:",a),W("Save queued (offline)")}}async function hc(r){if(!(!Ze||!De||!pt||typeof sn!="function"||typeof Sr!="function"))try{await Sr(sn(pt,"users",De,"reminders",r))}catch(a){W("Delete queued (offline)")}}async function _n(r){let a=(localStorage.getItem("syncUrl")||"").trim();if(!a)return;let s={id:r.id,title:r.title,dueIso:r.due||null,priority:r.priority||"Medium",category:r.category||Ae,done:!!r.done,source:"memory-cue-mobile"};try{await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}catch(c){}}function Yt({preserveDetail:r=!1}={}){o&&(o.value=""),i&&(i.value=""),l&&(l.value=""),d&&(d.value=""),pr("Medium"),m&&(m.value=Ae),na(),ln=null,g&&(g.textContent="Save"),v==null||v.classList.add("hidden"),Ao(),r||Tn()}function bc(r){let a=S.find(s=>s.id===r);a&&(o&&(o.value=a.title||""),i&&l&&(a.due?(i.value=uc(a.due),l.value=fc(a.due)):(i.value="",l.value="")),pr((a==null?void 0:a.priority)||"Medium"),m&&(m.value=Te(a.category)),d&&(d.value=typeof a.notes=="string"?a.notes:""),J&&(J.value=typeof a.plannerLessonId=="string"?a.plannerLessonId:""),Ao(),mr(a),ln=r,g&&(g.textContent="Update"),v==null||v.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),o==null||o.focus(),mt("cue:open",{mode:"edit"}))}function Ec(r){var h;let a=Date.now(),s=r.notes==null?"":typeof r.notes=="string"?r.notes.trim():String(r.notes).trim(),c=Te((h=r.category)!=null?h:m?m.value:""),u={id:Nr(),title:r.title.trim(),priority:r.priority||"Medium",category:c,notes:s,done:!1,createdAt:a,updatedAt:a,due:r.due||null,pendingSync:!De,plannerLessonId:typeof r.plannerLessonId=="string"&&r.plannerLessonId.trim()?r.plannerLessonId.trim():null};Po(u,{position:"start"}),S=[u,...S],qe(S);let y=Rn(S);return qt=!0,Se(),ke(),ea(u),y?S.forEach(E=>Fe(E)):Fe(u),_n(u),zt(u),Dn(),mt("memoryCue:remindersUpdated",{items:S}),oa(),Qe({action:"created",label:`Reminder added \xB7 ${u.title}`}),u}function wc(r,a){if(!De)return W("Sign in to add notes"),null;if(!r)return null;let s=S.find(h=>h.id===r);if(!s)return null;let u=(a==null?"":typeof a=="string"?a:String(a)).trim();if(!u)return s;let y=typeof s.notes=="string"?s.notes:"";return s.notes=y?`${y}
${u}`:u,s.updatedAt=Date.now(),Fe(s),Se(),ke(),Qe({action:"updated",label:`Reminder notes updated \xB7 ${s.title}`}),s}function Sc(r){let a=S.find(s=>s.id===r);a&&(a.done=!a.done,a.updatedAt=Date.now(),Fe(a),_n(a),Se(),ke(),a.done?(Rr(r),Qe({action:"completed",label:`Reminder completed \xB7 ${a.title}`})):(zt(a),Qe({action:"reopened",label:`Reminder reopened \xB7 ${a.title}`})))}function vc(r){if(!P||P.tokenId!==r)return;let{item:a,index:s}=P;if(!a){me(r);return}me(r);let c=Number.isInteger(s)?Math.min(Math.max(s,0),S.length):S.length;a.pendingSync=!De,a.updatedAt=Date.now(),S.splice(c,0,a),qe(S);let u=Rn(S);qt=!0,Se(),ke(),zt(a),u?S.forEach(y=>Fe(y)):Fe(a),_n(a),Dn(),mt("memoryCue:remindersUpdated",{items:S}),Qe({action:"restored",label:`Reminder restored \xB7 ${a.title}`}),W("Reminder restored")}function ya(r){let a=S.findIndex(u=>u.id===r),s=a>=0?S.splice(a,1)[0]:null;s&&ln===r&&Yt(),Se(),ke(),hc(r),Rr(r);let c=s?`Reminder removed \xB7 ${s.title}`:"Reminder removed";if(Qe({action:"deleted",label:c}),s&&O){me();let u=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;P={tokenId:u,item:s,index:a,timeoutId:null},$e(P),P.timeoutId=setTimeout(()=>{me(u)},x)}else s&&me()}function Lc(r,a){if(!r||typeof r.addEventListener!="function"||typeof a!="function")return;let s=80,c=48,u=800,y='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',h=null,E=!1,L=0,A=0,R=0,q=()=>{var T;if(E){if(E=!1,h!=null&&((T=r.hasPointerCapture)!=null&&T.call(r,h)))try{r.releasePointerCapture(h)}catch(G){}h=null,r.removeEventListener("pointermove",le),r.removeEventListener("pointerup",be),r.removeEventListener("pointercancel",F),r.removeEventListener("pointerleave",F),window.removeEventListener("pointerup",be),window.removeEventListener("pointercancel",F)}},H=T=>{if(T.pointerType==="mouse"&&T.button!==0)return;E&&q();let G=T.target;G instanceof Element&&G.closest(y)||(h=T.pointerId,L=T.clientX,A=T.clientY,R=typeof T.timeStamp=="number"?T.timeStamp:Date.now(),E=!0,r.addEventListener("pointermove",le),r.addEventListener("pointerup",be),r.addEventListener("pointercancel",F),r.addEventListener("pointerleave",F),window.addEventListener("pointerup",be),window.addEventListener("pointercancel",F))},le=T=>{if(!E||T.pointerId!==h)return;Math.abs(T.clientY-A)>c&&q()},be=T=>{if(!E||T.pointerId!==h)return;let G=T.clientX-L,ue=Math.abs(T.clientY-A),Q=(typeof T.timeStamp=="number"?T.timeStamp:Date.now())-R;if(q(),G<=-s&&ue<=c&&Q<=u){T.preventDefault(),T.stopPropagation();try{a()}catch(tt){console.warn("Swipe delete handler failed",tt)}}},F=T=>{E&&(typeof T.pointerId=="number"&&T.pointerId!==h||q())};r.addEventListener("pointerdown",H)}function Hn(r){if(!r)return"Due now";let s=(typeof r.notes=="string"?r.notes:"").split(/\r?\n/).map(c=>c.trim()).find(Boolean);if(s){if(r.due)try{let c=new Date(r.due);if(!Number.isNaN(c.getTime())){let u=Ho(c);if(u)return`${s} \u2022 ${u}`}}catch(c){}return s}if(r.due)try{let c=new Date(r.due);if(!Number.isNaN(c.getTime())){let u=Ho(c);if(u)return`Due ${u}`}}catch(c){}return"Due now"}function ga(){try{if(typeof window!="undefined"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator!="undefined"&&navigator.standalone)return}catch(r){}W("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function ha(){return Object.values(Le||{}).filter(r=>r&&typeof r=="object"&&r.id).map(r=>({id:r.id,title:typeof r.title=="string"?r.title:"",due:typeof r.due=="string"?r.due:null,priority:r.priority||"Medium",category:r.category||Ae,notes:typeof r.notes=="string"?r.notes:"",body:Hn(r),urlPath:r.urlPath||yr,updatedAt:Number.isFinite(r.updatedAt)?r.updatedAt:Date.now(),notifiedAt:Number.isFinite(r.notifiedAt)?r.notifiedAt:null}))}function $o(){try{localStorage.setItem("scheduledReminders",JSON.stringify(Le))}catch(s){console.warn("Failed to persist scheduled reminders",s)}let r=ha(),a=typeof Notification!="undefined"&&Notification.permission==="granted";a&&$r(),ni(r,{requestCheck:a})}function Pr(r,{closeNotification:a=!0}={}){if(a){let s=gt.get(r);if(s){try{s.close()}catch(c){}gt.delete(r)}}Wt[r]&&(clearTimeout(Wt[r]),delete Wt[r]),ri(r),Le[r]&&(delete Le[r],$o())}function Rr(r){Pr(r)}function ba(r){if(!(!r||!r.id||!("Notification"in window)))try{let a=gt.get(r.id);if(a&&typeof a.close=="function")try{a.close()}catch(u){}let s=new Notification(r.title,{body:Hn(r),tag:r.id});gt.set(r.id,s);let c=()=>{gt.get(r.id)===s&&gt.delete(r.id)};typeof s.addEventListener=="function"&&(s.addEventListener("close",c),s.addEventListener("click",c)),s.onclose=c,s.onclick=c}catch(a){}}async function Ac(r){if(!ht())return!1;let a=Qa();if(!a||!(r!=null&&r.due))return!1;let s=new Date(r.due).getTime();if(!Number.isFinite(s))return!1;let c=await Pt();if(!c)return!1;await ri(r.id,c);let u={id:r.id,title:r.title,due:r.due,priority:r.priority||"Medium",category:r.category||Ae,body:y,urlPath:yr},y=Hn(r),h={body:y,tag:r.id,data:u,renotify:!0};s>Date.now()&&(h.showTrigger=new a(s));try{return await c.showNotification(r.title,h),!0}catch(E){return console.warn("Failed to schedule persistent notification",E),!1}}function zt(r){var h;if(!r||!r.id)return;if(r.category=Te(r.category),!r.due||r.done){Rr(r.id);return}let a=Le[r.id]||{},s={id:r.id,title:r.title,due:r.due,category:r.category||Ae,priority:r.priority||"Medium",notes:typeof r.notes=="string"?r.notes:"",body:Hn(r),urlPath:yr,updatedAt:Date.now(),viaTrigger:!!a.viaTrigger,notifiedAt:(()=>{let E=typeof a.due=="string"?a.due:null,L=Number.isFinite(a.notifiedAt)?a.notifiedAt:null;return E===r.due?L:null})()};if(Le[r.id]=s,$o(),Wt[r.id]&&(clearTimeout(Wt[r.id]),delete Wt[r.id]),!("Notification"in window)||Notification.permission!=="granted")return;let c=new Date(r.due).getTime();if(!Number.isFinite(c))return;let u=c-Date.now();if(u<=0){if((h=Le[r.id])!=null&&h.viaTrigger){Pr(r.id,{closeNotification:!1});return}ba(r),Pr(r.id,{closeNotification:!1});return}let y=ht();y&&(s.viaTrigger=!1,Ac(r).then(E=>{E&&Le[r.id]&&(Le[r.id]=ce(B({},Le[r.id]),{viaTrigger:!0}),$o())})),Wt[r.id]=setTimeout(()=>{y&&ri(r.id),ba(r),Pr(r.id,{closeNotification:!1})},u)}function kt(){Object.values(Le).forEach(r=>zt(ce(B({},r),{category:Te(r==null?void 0:r.category)})))}function Ea(r){if(!(r!=null&&r.due))return"No due date";try{let a=new Date(r.due),s=sc.format(a),c=lc.format(a),u=Ho(a);return`${s}, ${c}${u?` at ${u}`:""}`}catch(a){return"No due date"}}function Se(){let r=new Date,a=new Date(r),s=new Date(a);s.setHours(0,0,0,0);let c=new Date(a);if(c.setHours(23,59,59,999),Ct(),qe(S),jt)try{jt.textContent=String(S.length)}catch(C){}S.forEach(C=>{C&&typeof C=="object"&&(C.category=Te(C.category))});let u=new Set(Vc.map(C=>Te(C)));S.forEach(C=>{C&&typeof C=="object"&&u.add(Te(C.category))});let y=Array.from(u).sort((C,_)=>C.localeCompare(_,void 0,{sensitivity:"base"}));if(we){let C=new Set;Array.from(we.querySelectorAll("option")).forEach(_=>{C.add(_.value.trim().toLowerCase())}),y.forEach(_=>{let oe=_.toLowerCase();if(!C.has(oe)){let ie=document.createElement("option");ie.value=_,we.appendChild(ie),C.add(oe)}})}if(qt)qt=!1;else if(typeof document!="undefined"&&typeof document.dispatchEvent=="function"){let C=S.map(_=>B({},_));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:C}}));else if(document.createEvent){let _=document.createEvent("CustomEvent");_&&_.initCustomEvent&&(_.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:C}),document.dispatchEvent(_))}}catch(_){}}let h=S.slice();qe(h);let E=!0,L=S.length>0,A=h.length>0,R=(()=>{if(typeof Notification=="undefined"||Notification.permission!=="granted")return new Set;let C=Object.values(Le||{}).filter(_=>_&&typeof _=="object"&&_.id);return new Set(C.map(_=>_.id))})();if(ft)if(A)ft.classList.add("hidden");else{let C=L?"No reminders to show right now.":jl;ra?ra(ft,{icon:L?"sparkles":"bell",title:L?"Nothing to display":"Create your first cue",description:C,action:L?void 0:`<button type="button" class="${ql}" data-trigger="open-cue">Create reminder</button>`}):ft.textContent=C,ft.classList.remove("hidden")}if(It&&It.classList.toggle("has-items",A),!p)return;if(!A){ft?(p.innerHTML="",p.classList.add("hidden")):(p.innerHTML='<div class="text-muted">No reminders found.</div>',p.classList.remove("hidden"));return}p.classList.remove("hidden"),p.replaceChildren();let q=document.createDocumentFragment(),H=p.tagName==="UL"||p.tagName==="OL",le=!0,be=["priority-high","priority-medium","priority-low"],F=(C,_)=>{if(!(C instanceof HTMLElement))return;C.classList.remove(...be);let oe=typeof _=="string"?_.trim().toLowerCase():"";oe.startsWith("h")?C.classList.add("priority-high"):oe.startsWith("m")?C.classList.add("priority-medium"):oe.startsWith("l")&&C.classList.add("priority-low")},T=(C,_="neutral")=>{let oe=document.createElement("span");oe.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",oe.title=C,oe.dataset.tone=_;let ie=document.createElement("span");ie.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",_==="priority-high"?ie.classList.add("bg-error"):_==="priority-medium"?ie.classList.add("bg-warning"):_==="priority-low"?ie.classList.add("bg-secondary"):_==="category"?ie.classList.add("bg-primary"):ie.classList.add("bg-base-content","opacity-40");let fe=document.createElement("span");return fe.className="truncate",fe.textContent=C,oe.append(ie,fe),oe},G=(C,_,{elementTag:oe,isMobile:ie})=>{let fe={id:C.id,title:C.title,dueIso:C.due||null,priority:C.priority||"Medium",category:_,done:!!C.done},Un="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",xc="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",ee=document.createElement(oe);ee.className=ie?xc:Un,ee.dataset.id=fe.id,ee.dataset.category=fe.category,ee.dataset.title=fe.title;let va=fe.priority&&String(fe.priority).trim();va?ee.dataset.priority=va:delete ee.dataset.priority,ee.dataset.done=String(fe.done),fe.dueIso?ee.dataset.due=fe.dueIso:delete ee.dataset.due,ee.dataset.reminder=JSON.stringify(fe),ee.dataset.orderIndex=Number.isFinite(C.orderIndex)?String(C.orderIndex):"",ee.dataset.reminderItem="true",ee.dataset.compact="true",ee.classList.add("reminder-draggable"),ee.setAttribute("draggable","true"),ee.setAttribute("role","button"),ee.tabIndex=0,ee.setAttribute("aria-label",`Edit reminder: ${C.title}`),F(ee,fe.priority),R.has(fe.id)?ee.dataset.notificationActive="true":delete ee.dataset.notificationActive;let jo=fe.dueIso?new Date(fe.dueIso):null;E&&jo&&jo>=s&&jo<=c?(ee.classList.add("is-today"),ee.dataset.today="true"):(ee.classList.remove("is-today"),delete ee.dataset.today);let $n=document.createElement("div");$n.className="flex min-w-0 flex-1 flex-col gap-2",ie&&$n.classList.add("text-sm","text-base-content");let Nt=document.createElement("p");Nt.className=ie?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",Nt.classList.add("desktop-reminder-title"),ie||Nt.classList.add("sm:text-[0.95rem]"),fe.done&&Nt.classList.add("line-through","text-base-content/60"),ie&&(Nt.dataset.reminderTitle="true"),Nt.textContent=C.title;let _r=Nt;ie&&(_r=document.createElement("div"),_r.className="reminder-title-slot",_r.appendChild(Nt)),$n.appendChild(_r);let jn=document.createElement("div");jn.className=ie?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let qo=Ea(C),La=qo&&qo!=="No due date"?qo:"";La&&jn.appendChild(T(La,"due")),!!(_&&_!==Ae)&&jn.appendChild(T(_,"category")),jn.children.length&&$n.appendChild(jn),ee.appendChild($n);let dn=document.createElement("div");dn.className="task-toolbar flex items-start gap-1",dn.setAttribute("role","toolbar"),dn.setAttribute("aria-label","Reminder actions"),ie&&dn.classList.add("flex-shrink-0");let _e=document.createElement("button");_e.type="button",_e.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn",fe.done?(_e.classList.add("text-base-content/60"),_e.innerHTML='<span aria-hidden="true">\u21BA</span>',_e.setAttribute("aria-label",`Mark reminder as active: ${C.title}`)):(_e.classList.add("text-success"),_e.innerHTML='<span aria-hidden="true">\u2713</span>',_e.setAttribute("aria-label",`Mark reminder as done: ${C.title}`)),_e.setAttribute("aria-pressed",fe.done?"true":"false"),_e.setAttribute("data-reminder-control","toggle"),_e.setAttribute("data-no-swipe","true"),_e.addEventListener("click",Me=>{Me.preventDefault(),Me.stopPropagation(),Sc(fe.id)});let Ft=document.createElement("button");Ft.type="button",Ft.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn",Ft.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',Ft.setAttribute("aria-label",`Delete reminder: ${C.title}`),Ft.setAttribute("data-reminder-control","delete"),Ft.setAttribute("data-no-swipe","true"),Ft.addEventListener("click",Me=>{Me.preventDefault(),Me.stopPropagation(),ya(fe.id)}),dn.append(_e,Ft),ee.appendChild(dn);let Aa=()=>bc(fe.id);return ee.addEventListener("click",Me=>{if(Me.defaultPrevented)return;let Vo=Me.target;Vo&&typeof Vo.closest=="function"&&Vo.closest("[data-reminder-control]")||Aa()}),ee.addEventListener("keydown",Me=>{Me.defaultPrevented||Me.target===ee&&(Me.key==="Enter"||Me.key===" ")&&(Me.preventDefault(),Aa())}),ie&&Lc(ee,()=>ya(fe.id)),ee},ue=(C,_)=>G(C,_,{elementTag:"div",isMobile:!0});if(xt!=="desktop"&&!le){h.forEach(C=>{let _=C.category||Ae;q.appendChild(ue(C,_))}),p.appendChild(q);return}let Q=new Map;h.forEach(C=>{let _=C.category||Ae;Q.has(_)||Q.set(_,[]),Q.get(_).push(C)});let tt=Array.from(Q.entries()).sort((C,_)=>C[0].localeCompare(_[0],void 0,{sensitivity:"base"})),Or=!0;tt.forEach(([C,_])=>{if(C!==Ae){let oe=document.createElement(H?"li":"div");oe.dataset.categoryHeading=C,H&&(oe.setAttribute("role","presentation"),oe.style.listStyle="none"),oe.className=xt==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",Or||(oe.style.marginTop=xt==="desktop"?"1.25rem":"1rem");let ie=document.createElement("div");ie.setAttribute("role","heading"),ie.setAttribute("aria-level","3"),ie.className=xt==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let fe=document.createElement("span");fe.textContent=C;let Un=document.createElement("span");Un.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",Un.textContent=`${_.length} ${_.length===1?"item":"items"}`,ie.append(fe,Un),oe.appendChild(ie),q.appendChild(oe)}_.forEach(oe=>{if(xt==="desktop"){let ie=G(oe,C,{elementTag:H?"li":"div",isMobile:!1});q.appendChild(ie);return}q.appendChild(ue(oe,C))}),Or=!1}),p.appendChild(q),Je()}function et(){Re==null||Re.setAttribute("aria-expanded","false"),We==null||We.classList.add("hidden")}function Tc(){Re==null||Re.setAttribute("aria-expanded","true"),We==null||We.classList.remove("hidden")}Re==null||Re.addEventListener("click",r=>{r.stopPropagation(),Re.getAttribute("aria-expanded")==="true"?et():Tc()}),document.addEventListener("click",r=>{We&&!We.classList.contains("hidden")&&!We.contains(r.target)&&r.target!==Re&&et()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&et()}),Cn.forEach(r=>{r.addEventListener("click",()=>{let a=xe==null?void 0:xe.classList.contains("hidden");xe==null||xe.classList.toggle("hidden"),a&&(xe==null||xe.scrollIntoView({behavior:"smooth",block:"start"})),et()})}),document.addEventListener("DOMContentLoaded",()=>{xe==null||xe.classList.add("hidden")});function wa(){var A,R,q;try{console.log("handleSaveAction invoked",{editingId:ln,title:o==null?void 0:o.value})}catch(H){}let a=(typeof(o==null?void 0:o.value)=="string"?o.value:"").trim(),s=typeof(i==null?void 0:i.value)=="string"?i.value:"",c=typeof(l==null?void 0:l.value)=="string"?l.value:"",u=typeof(J==null?void 0:J.value)=="string"?J.value.trim():"";if(ln){let H=S.find(F=>F.id===ln);if(!H){Yt();return}if(!a){W("Add a reminder title");return}let le=null;if(s||c){let F=s||Fr();le=da(F,c||"09:00")}else{let F=Br(a);F.time&&(le=new Date(`${F.date}T${F.time}:00`).toISOString())}H.title=a;let be=Io();H.priority=be,pr(be),m&&(H.category=Te(m.value)),H.due=le,d&&(H.notes=d.value.trim()),H.plannerLessonId=u||null,H.updatedAt=Date.now(),Fe(H),_n(H),qt=!0,Se(),zt(H),ke(),Dn(),mt("memoryCue:remindersUpdated",{items:S}),oa(),Qe({action:"updated",label:`Reminder updated \xB7 ${H.title}`}),Yt(),W("Reminder updated"),mt("cue:close",{reason:"updated"});return}if(!a){W("Add a reminder title");return}let y=d?d.value.trim():"",h=null;if(s||c){let H=s||Fr();h=da(H,c||"09:00")}else{let H=Br(a);H.time&&(h=new Date(`${H.date}T${H.time}:00`).toISOString())}let E=u?{lessonId:u,dayLabel:((A=J==null?void 0:J.dataset)==null?void 0:A.lessonDayLabel)||"",lessonTitle:((R=J==null?void 0:J.dataset)==null?void 0:R.lessonTitle)||"",summary:((q=J==null?void 0:J.dataset)==null?void 0:q.lessonSummary)||""}:null,L=Ec({title:a,priority:Io(),category:m?m.value:"",due:h,notes:y,plannerLessonId:u||null});L&&(E?(W("Planner reminder created"),mt("planner:reminderCreated",{lessonId:E.lessonId,dayLabel:E.dayLabel,lessonTitle:E.lessonTitle,summary:E.summary,reminderId:L.id,reminderTitle:L.title,reminderDue:L.due||null})):W("Reminder created")),o&&(o.value=""),l&&(l.value=""),d&&(d.value=""),Ao(),mt("cue:close",{reason:"created"})}o==null||o.addEventListener("keydown",r=>{r.key==="Enter"&&wa()});function Ic(){if(!o||!ve)return;let r=o.value.trim();if(!r){ve.style.display="none";return}try{let a=Br(r),s=Fr();if(a.date!==s||a.time){let c="";if(a.date!==s){let u=new Date(a.date+"T00:00:00");c+=`\u{1F4C5} ${fa(a.date)}`}a.time&&(c+=`${c?" ":""}\u{1F550} ${a.time}`),c?(ve.textContent=`Parsed: ${c}`,ve.style.display="block"):ve.style.display="none"}else ve.style.display="none"}catch(a){ve.style.display="none"}}return o==null||o.addEventListener("input",yc(Ic,300)),v==null||v.addEventListener("click",()=>{Yt(),W("Edit cancelled"),mt("cue:close",{reason:"edit-cancelled"})}),j==null||j.addEventListener("click",()=>{Yt()}),document.addEventListener("cue:cancelled",()=>{Yt()}),document.addEventListener("cue:prepare",()=>{Yt()}),document.addEventListener("planner:prefillReminder",r=>{_l((r==null?void 0:r.detail)||{})}),window.addEventListener("load",()=>o==null?void 0:o.focus()),xn==null||xn.addEventListener("click",()=>{let r=S.filter(a=>!a.done).map(a=>{let s=a.due?fa(a.due.slice(0,10)):"",c=a.due?new Date(a.due).toLocaleTimeString(cn,{hour:"2-digit",minute:"2-digit",timeZone:yt}):"";return["mtl "+a.title,a.due?`Due Date: ${s}`:"",a.due?`Time: ${c}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(r.length===0){W("No active tasks to copy");return}navigator.clipboard.writeText(r.join(`

`)).then(()=>W("Copied for Master Task List")).catch(()=>W("Copy failed")),et()}),b==null||b.addEventListener("change",()=>{let r=b.files[0];if(!r)return;let a=new FileReader;a.onload=()=>{try{let s=JSON.parse(String(a.result)||"[]").slice(0,500),c=[];s.forEach(y=>{let h=ce(B({},y),{id:Nr(),category:Te(y.category),pendingSync:!De,orderIndex:null});Po(h,{position:"start"}),S=[h,...S],c.push(h)}),qe(S);let u=Rn(S);Se(),ke(),u?S.forEach(y=>Fe(y)):c.forEach(y=>Fe(y)),W("Import successful")}catch(s){W("Invalid JSON")}},a.readAsText(r),b.value="",et()}),U==null||U.addEventListener("click",()=>{let r=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download="memory-cue-mobile.json",s.click(),URL.revokeObjectURL(a),et()}),ne==null||ne.addEventListener("click",async()=>{let r=(localStorage.getItem("syncUrl")||"").trim();if(!r){W("Add your Apps Script URL in Settings first"),et();return}if(!S.length){W("No tasks to sync"),et();return}W("Syncing all tasks\u2026");let a=20,s=0;for(let c=0;c<S.length;c+=a){let u=S.slice(c,c+a),y=await Promise.allSettled(u.map(h=>{let E={id:h.id,title:h.title,dueIso:h.due||null,priority:h.priority||"Medium",category:h.category||Ae,done:!!h.done,source:"memory-cue-mobile"};return fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}));s+=y.filter(h=>h.status==="rejected").length,await new Promise(h=>setTimeout(h,400))}W(`Sync complete: ${S.length-s} ok${s?`, ${s} failed`:""}`),et()}),je&&(je.value=localStorage.getItem("syncUrl")||""),an==null||an.addEventListener("click",()=>{je&&(localStorage.setItem("syncUrl",je.value.trim()),W("Settings saved"))}),ut==null||ut.addEventListener("click",async()=>{if(!je)return;let r=je.value.trim();if(!r){W("Enter URL first");return}try{let a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});W(a.ok?"Test ok":"Test failed")}catch(a){W("Test failed")}}),In==null||In.addEventListener("click",async()=>{if(!("Notification"in window)){W("Notifications not supported");return}if(Notification.permission==="granted"){W("Notifications enabled"),ht()?Pt():($r(),ga()),kt(),Se();return}try{await Notification.requestPermission()==="granted"?(W("Notifications enabled"),ht()?Pt():($r(),ga()),kt(),Se()):W("Notifications blocked")}catch(r){W("Notifications blocked")}}),Ql(),kt(),Se(),ke(),{cancelReminder:Rr,scheduleReminder:zt,closeActiveNotifications:Za,getActiveNotifications:()=>gt,addNoteToReminder:wc,__testing:{setItems(r=[]){S=Array.isArray(r)?r.map(a=>ce(B({},a),{category:Te(a==null?void 0:a.category)})):[],S=Pn(S),qe(S),Se()},render:Se,getItems:()=>S.map(r=>B({},r))}}}var Ka,gt,Ga,Qo,Zo,Xa,Ur,Kn,ei,Ae,Vc,ti,rt,Wc,ot,es=nt(()=>{Jo();Ka="memoryCue:activity",gt=new Map,Ga=!1,Qo="service-worker.js",Zo="memory-cue-reminder-sync",Xa=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Ur=null,Kn=null,ei=!1,Ae="General",Vc=Object.freeze([Ae,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),ti="memoryCue:offlineReminders",rt=1024,Wc=Object.freeze({}),ot=null});function ns(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let i of o){if(typeof i!="string"||!i)continue;let l=t.getElementById(i);if(l)return{key:n,element:l}}return null}).filter(n=>!!(n&&n.element))}function fn(e,t){if(!e||typeof e!="object")return"";let n=Gc[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let i=e[o];return i==null?"":typeof i=="string"?i:String(i)}return""}function Xc(e,t){if(!e)return;let n=t==null?"":t;if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function Jc(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function rs(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let i=e&&typeof e=="object"?fn(e,n):"";Xc(o,i)})}function os(e,t,n,o){Array.isArray(e)&&e.forEach(({element:i})=>{i instanceof HTMLInputElement?["checkbox","radio"].includes(i.type)?i.checked=!1:i.value="":(i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function is(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let i=Jc(o);if(typeof i=="boolean"){t[n]=i;return}let l=typeof i=="string"?i.trim():i;t[n]=l==null?"":l}),t}function ge(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var ts,Gc,ii,ai,as=nt(()=>{ts=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],Gc={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},ii="Create Cue",ai="Edit Cue"});function ss(e){return new si(e)}var Qc,Zc,Gn,si,ls=nt(()=>{Qc=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Zc={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Gn=class Gn{constructor(t={}){var n,o,i,l,d,f,m,g,v,p,k;this.modal=(n=t.modalElement)!=null?n:null,this.openButton=(o=t.openButton)!=null?o:null,this.closeButton=(i=t.closeButton)!=null?i:null,this.backdropButton=(l=t.backdropButton)!=null?l:null,this.titleInput=(d=t.titleInput)!=null?d:null,this.modalTitle=(f=t.modalTitle)!=null?f:null,this.defaultTitle=(m=t.defaultTitle)!=null?m:"",this.editTitle=(v=(g=t.editTitle)!=null?g:t.defaultTitle)!=null?v:"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=(p=t.eventTarget)!=null?p:document,this.events=B(B({},Zc),t.events||{}),this.animationHooks=(k=t.animationHooks)!=null?k:{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{var t;(t=this.modal)==null||t.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{var t;(t=this.modal)==null||t.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",B({controller:this},t)),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",B({controller:this},t)),await this.runHook("onAfterHide"))}focusTitleInput(){var n;let t=this.titleInput||((n=this.modal)==null?void 0:n.querySelector("[autofocus]"));!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch(o){t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch(n){t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let o=n[0],i=n[n.length-1],l=document.activeElement;t.shiftKey&&l===o?(t.preventDefault(),i.focus()):!t.shiftKey&&l===i&&(t.preventDefault(),o.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Qc)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){var o,i,l;if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=((o=t==null?void 0:t.detail)==null?void 0:o.mode)==="edit";this.setEditMode(n),this.show({reason:((i=t==null?void 0:t.detail)==null?void 0:i.reason)||"external-open",mode:(l=t==null?void 0:t.detail)==null?void 0:l.mode})}handleDocumentCloseRequest(t){var o,i,l;if(!t||(o=t.detail)!=null&&o.controller&&t.detail.controller!==this||((i=t.detail)==null?void 0:i.initiatedBy)==="controller")return;let n=((l=t.detail)==null?void 0:l.reason)||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let o=this.events[t];if(!o||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let i=new CustomEvent(o,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(i)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",ce(B({},n),{initiatedBy:"controller"})),this.hide({reason:t})}async runHook(t){var o;let n=(o=this.animationHooks)==null?void 0:o[t];typeof n=="function"&&await n(this)}addToStack(){var o;let t=Gn.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,(o=this.modal)==null||o.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=Gn.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}};Ca(Gn,"activeStack",[]);si=Gn});var ds,ed,Wr,li,us,fs,qr,ms,Kt,Vr,cs,td,mn,Gt,ci=nt(()=>{ds="memoryCueNotes",ed=["mobileNotes"],Wr=()=>typeof localStorage!="undefined",li=null,us=e=>{li=typeof e=="function"?e:null},fs=()=>typeof crypto!="undefined"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,qr=e=>{if(typeof e!="string")return"";let t=e.trim();if(!t.length)return"";if(!/[<>]/.test(t))return e;try{if(typeof document!="undefined"){let n=document.createElement("div");return n.innerHTML=t,(typeof n.innerText=="string"&&n.innerText.length?n.innerText:n.textContent||"").replace(/\r?\n/g,`
`)}}catch(n){}return t.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},ms=e=>{if(typeof e!="string")return!1;let t=Date.parse(e);return!Number.isNaN(t)},Kt=(e,t,n={})=>{let o=typeof e=="string"?e.trim():"";return{id:n.id&&typeof n.id=="string"?n.id:fs(),title:o||"Untitled note",body:typeof t=="string"?qr(t):"",updatedAt:n.updatedAt&&ms(n.updatedAt)?n.updatedAt:new Date().toISOString()}},Vr=e=>{if(Array.isArray(e))return e.map(t=>{if(!t||typeof t!="object")return null;let n=typeof t.title=="string"?t.title.trim():"",o=typeof t.body=="string"?qr(t.body):"",i=typeof t.id=="string"&&t.id.trim()?t.id:fs(),l=ms(t.updatedAt)?t.updatedAt:new Date().toISOString();return!n&&!o?null:{id:i,title:n||"Untitled note",body:o,updatedAt:l}}).filter(Boolean);if(e&&typeof e=="object"){let t=typeof e.title=="string"?e.title:"",n=typeof e.body=="string"?qr(e.body):"";return!t&&!n?[]:[Kt(t,n,{id:typeof e.id=="string"?e.id:void 0,updatedAt:typeof e.updatedAt=="string"?e.updatedAt:void 0})]}return typeof e=="string"&&e.trim().length?[Kt("Notebook (legacy)",qr(e))]:[]},cs=e=>{if(!Wr())return null;try{return localStorage.getItem(e)}catch(t){return null}},td=e=>{if(Wr())try{localStorage.removeItem(e)}catch(t){}},mn=()=>{if(!Wr())return[];let e=cs(ds);if(typeof e=="string")try{let t=JSON.parse(e),n=Vr(t);if(n.length)return n}catch(t){let n=Vr(e);if(n.length)return Gt(n),n}for(let t of ed){let n=cs(t);if(typeof n=="string"&&n.trim().length){let o=Vr(n);if(o.length)return Gt(o),td(t),o}}return[]},Gt=(e,t={})=>{if(!Wr()||!Array.isArray(e))return!1;let n=e.map(o=>Vr([o])[0]).filter(Boolean);try{if(localStorage.setItem(ds,JSON.stringify(n)),!t.skipRemoteSync&&typeof li=="function")try{let o=li(n);o&&typeof o.then=="function"&&o.catch(i=>{console.error("[notes-storage] Remote sync failed.",i)})}catch(o){console.error("[notes-storage] Remote sync handler threw.",o)}return!0}catch(o){return!1}}});var nd,rd,od,Yr,id,ad,ps,ys=nt(()=>{Xo();ci();nd="notes",rd="user_id",od="updated_at",Yr=e=>{if(typeof e!="string")return 0;let t=Date.parse(e);return Number.isNaN(t)?0:t},id=(e=[],t=[])=>{let n=new Map;return t.forEach(o=>{o&&typeof o.id=="string"&&n.set(o.id,o)}),e.forEach(o=>{if(!o||typeof o.id!="string")return;let i=n.get(o.id);if(!i){n.set(o.id,o);return}let l=Yr(o.updatedAt),d=Yr(i.updatedAt);l>d&&n.set(o.id,o)}),Array.from(n.values()).sort((o,i)=>Yr(i==null?void 0:i.updatedAt)-Yr(o==null?void 0:o.updatedAt))},ad=e=>t=>{if(!t||typeof t!="object")return null;let n={id:typeof t.id=="string"&&t.id?t.id:void 0,updatedAt:typeof t[e]=="string"?t[e]:void 0};return Kt(t.title,t.body,n)},ps=(e={})=>{let{tableName:t=nd,userColumn:n=rd,updatedAtColumn:o=od,supabase:i=null}=e,l=i||null,d=null,f=!1,m=new Set,g=()=>l||(l=un(),l),v=ad(o),p=async M=>{let z=g();if(!z||!d)return;let X=(Array.isArray(M)?M.filter(w=>w&&typeof w.id=="string"):[]).map(w=>({id:w.id,[n]:d,title:w.title,body:w.body,[o]:typeof w.updatedAt=="string"&&w.updatedAt?w.updatedAt:new Date().toISOString()})),V=new Set(X.map(w=>w.id));if(X.length){let{error:w}=await z.from(t).upsert(X);if(w)throw w}let I=[...m].filter(w=>w&&!V.has(w));if(I.length){let{error:w}=await z.from(t).delete().in("id",I).eq(n,d);if(w)throw w}m=new Set(V)},k=async()=>{let M=g();if(!(!M||!d))try{let{data:z,error:Z}=await M.from(t).select(`id,title,body,${o}`).eq(n,d);if(Z)throw Z;let X=Array.isArray(z)?z:[];m=new Set(X.map($=>typeof $.id=="string"?$.id:null).filter(Boolean));let V=X.map(v).filter(Boolean),I=mn();if(!V.length){if(I.length)try{await p(I)}catch($){console.error("[notes-sync] Failed to upload local notes to Supabase.",$)}return}let w=id(I,V);f=!0;let j=Gt(w,{skipRemoteSync:!0});f=!1,j||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await p(w)}catch($){console.error("[notes-sync] Failed to reconcile notes with Supabase.",$)}}catch(z){console.error("[notes-sync] Failed to fetch notes from Supabase.",z)}finally{f=!1}};return us(async M=>{if(!f)try{await p(M)}catch(z){console.error("[notes-sync] Failed to sync notes to Supabase.",z)}}),{setSupabaseClient(M){M&&(l=M)},handleSessionChange:async M=>{if(d=typeof(M==null?void 0:M.id)=="string"?M.id:null,!d){m=new Set;return}await k()},syncFromRemote:k}}});var gs,hs,bs,ui,di,sd,yn,fi,ld,Es,ws,mi,cd,Ss,Xr,vs,Ls,pi,Xt,dd,As,gn,Ts,ud,fd,md,Is,yi,Kr,Qn,zr,pn,Jn,pd,xs,Rt,Cs,Jt,Ds,ks,Gr,yd,Xn,Qt,Ns,bt,Jr,Fs,gi,Ms,Ye,hi,bi,Bs,Ps,Ei,Rs,Os,hn,_s,Qr,wi,Hs=nt(()=>{gs="memoryCue:plannerPlans",hs="memoryCue:plannerTemplates",bs="memoryCue:lastPlannerTemplate",ui="memoryCue:plannerUpdated",di=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],sd=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],yn=()=>{try{return typeof window!="undefined"&&typeof window.localStorage!="undefined"}catch(e){return!1}},fi=e=>{if(!yn()||!e)return null;try{return window.localStorage.getItem(e)}catch(t){return null}},ld=(e,t)=>{if(!(!yn()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch(n){}},Es=e=>{try{return JSON.parse(e)}catch(t){return null}},ws=()=>typeof crypto!="undefined"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,mi=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,cd=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),o=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t},Ss=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`},Xr=e=>{if(typeof e!="string")return null;let[t,n,o]=e.split("-"),i=Number.parseInt(t,10),l=Number.parseInt(n,10),d=Number.parseInt(o,10);if(!Number.isFinite(i)||!Number.isFinite(l)||!Number.isFinite(d))return null;let f=new Date(i,l-1,d);return Number.isNaN(f.getTime())?null:(f.setHours(0,0,0,0),f)},vs=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=di.findIndex(o=>o.toLowerCase()===t);return n>=0?n:0},Ls=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:ws(),badge:n,text:t}},pi=(e,t={})=>{let n=typeof t=="object"&&t?t:{},o=Number.isFinite(e==null?void 0:e.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:vs((e==null?void 0:e.dayName)||n.dayName||n.dayLabel),i=mi(o),l=typeof(e==null?void 0:e.title)=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():di[i],d=typeof(e==null?void 0:e.summary)=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",m=(Array.isArray(e==null?void 0:e.details)?e.details:Array.isArray(n.details)?n.details:[]).map(N=>Ls(N)).filter(Boolean),g=typeof(e==null?void 0:e.id)=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:ws(),v=Number.isFinite(e==null?void 0:e.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,p=typeof(e==null?void 0:e.notes)=="string"?e.notes:typeof n.notes=="string"?n.notes:"",k=typeof(e==null?void 0:e.subject)=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"";return{id:g,dayIndex:i,dayLabel:di[i]||"Lesson",title:l,summary:d,details:m,notes:p,subject:k,position:Number.isFinite(v)?v:null}},Xt=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let o=Number.isFinite(t.position),i=Number.isFinite(n.position);return o&&i&&t.position!==n.position?t.position-n.position:o&&!i?-1:!o&&i?1:t.title.localeCompare(n.title)}),dd=e=>{let t=new Map;return e.forEach(n=>{var l;let o=String(n.dayIndex),i=(l=t.get(o))!=null?l:0;Number.isFinite(n.position)?t.set(o,Math.max(i,n.position+1)):(n.position=i,t.set(o,i+1))}),e},As=(e,t,n)=>{let o=e.filter(i=>!(i.dayIndex!==t||n&&i.id===n));return o.length?o.reduce((i,l)=>Number.isFinite(l.position)?Math.max(i,l.position):i,-1)+1:0},gn=(e,t)=>{let n=typeof(e==null?void 0:e.weekId)=="string"&&e.weekId?e.weekId:t,o=Xr(n),i=Array.isArray(e==null?void 0:e.lessons)?dd(e.lessons.map(d=>pi(d)).filter(Boolean)):[],l=typeof(e==null?void 0:e.templateId)=="string"?e.templateId.trim():"";return{weekId:n,startDate:o?o.toISOString():"",lessons:Xt(i),updatedAt:typeof(e==null?void 0:e.updatedAt)=="string"?e.updatedAt:new Date().toISOString(),templateId:l}},Ts=()=>{if(!yn())return{};try{let e=fi(gs);if(typeof e!="string"||!e.length)return{};let t=Es(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},ud=e=>{if(yn())try{window.localStorage.setItem(gs,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},fd=()=>{if(!yn())return{};try{let e=fi(hs);if(typeof e!="string"||!e.length)return{};let t=Es(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},md=e=>{if(yn())try{window.localStorage.setItem(hs,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},Is=e=>{if(!e)return null;let n=Ts()[e];return n?gn(n,e):null},yi=(e,t)=>{if(!e||!t)return t;let n=Ts();return n[e]=t,ud(n),t},Kr=new Map,Qn=null,zr=null,pn=!1,Jn=null,pd=()=>{if(typeof Jn=="string")return Jn;let e=fi(bs);return Jn=typeof e=="string"?e:"",Jn},xs=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();Jn=t,ld(bs,t)},Rt=e=>{e!=null&&e.templateId&&xs(e.templateId)},Cs=e=>{let t=typeof(e==null?void 0:e.code)=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof(e==null?void 0:e.message)=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},Jt=e=>{if(typeof document!="undefined")try{let t=new CustomEvent(ui,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},Ds=async()=>Qn?zr||(zr=Qn().then(e=>{let{db:t,getCollection:n}=e||{},o=typeof n=="function"&&t?n(t,"plannerPlans"):null;return ce(B({},e),{plannerCollection:o})}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),zr):null,ks=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:o,db:i}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(i,"plannerPlans",t)},Gr=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Kr.set(e.weekId,e),e),yd=e=>{let t=bt();return gn({weekId:e,lessons:e===t?sd:[]},e)},Xn=e=>{let t=Is(e);if(t)return Gr(t),t;let n=yd(e);return yi(e,n),Gr(n),n},Qt=async e=>{if(!(e!=null&&e.weekId))return e;let t=gn(e,e.weekId);if(yi(t.weekId,t),Gr(t),Rt(t),pn||!Qn)return t;try{let n=await Ds();if(!n)return t;let o=ks(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(o,t,{merge:!0}):await n.updateDoc(o,t),t}catch(n){return Cs(n)?(console.warn("Persisting planner data locally due to permission issue",n),pn=!0,t):(console.error("Failed to persist planner plan",n),t)}},Ns=(e={})=>{typeof e.ensureFirestore=="function"&&(Qn=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(pn=e.forceLocal)},bt=(e=new Date)=>{let t=cd(e);return Ss(t)},Jr=(e,t=0)=>{let n=Xr(e);if(!n||!Number.isFinite(t))return e;let o=new Date(n);return o.setDate(n.getDate()+t*7),Ss(o)},Fs=(e=bt(),t=0)=>{let n=Xr(e);if(!n)return null;let o=Number.isFinite(t)?t:0,i=mi(o),l=new Date(n);return l.setDate(n.getDate()+i),l},gi=(e,{short:t=!1}={})=>{let n=Xr(e);if(!n)return"";let o=new Date(n);o.setDate(n.getDate()+6);let i=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),l=i.format(n),d=i.format(o),f=n.getFullYear()===o.getFullYear();if(t)return`Week of ${l}`;let m=f?n.getFullYear():`${n.getFullYear()} \u2013 ${o.getFullYear()}`;return`${l} \u2013 ${d}, ${m}`},Ms=(e=bt())=>{if(!e)return[];let t=Kr.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=Is(e);return Array.isArray(n==null?void 0:n.lessons)?[...n.lessons]:[]},Ye=async(e=bt())=>{if(!e)return null;if(Kr.has(e)){let t=Kr.get(e);return Rt(t),t}if(pn||!Qn){let t=Xn(e);return Rt(t),t}try{let t=await Ds();if(!t){let l=Xn(e);return Rt(l),l}let n=ks(t,e),o=await t.getDoc(n);if(o.exists()){let l=o.data(),d=gn(ce(B({},l),{weekId:e}),e);return yi(e,d),Gr(d),pn=!1,Rt(d),d}let i=Xn(e);return typeof t.setDoc=="function"&&await t.setDoc(n,i,{merge:!0}),Rt(i),i}catch(t){if(Cs(t)){console.warn("Falling back to local planner data due to permission issue",t),pn=!0;let o=Xn(e);return Rt(o),o}console.error("Failed to load planner data",t);let n=Xn(e);return Rt(n),n}},hi=async(e,t)=>{if(!e)return null;let n=await Ye(e),o=pi(t);o.position=As((n==null?void 0:n.lessons)||[],o.dayIndex);let i=ce(B({},n),{lessons:Xt([...(n==null?void 0:n.lessons)||[],o]),updatedAt:new Date().toISOString()}),l=await Qt(i);return Jt(l),l},bi=async(e,t,n={})=>{if(!e||!t)return null;let o=await Ye(e),i=[...(o==null?void 0:o.lessons)||[]],l=i.findIndex(v=>v.id===t);if(l===-1)return o;let d=i[l],f=pi(ce(B(B({},d),n),{id:t}),d);if(f.dayIndex!==d.dayIndex){let v=i.filter((p,k)=>k!==l);f.position=As(v,f.dayIndex)}i[l]=f;let m=ce(B({},o),{lessons:Xt(i),updatedAt:new Date().toISOString()}),g=await Qt(m);return Jt(g),g},Bs=async(e,t)=>{if(!e||!t)return null;let n=await Ye(e),o=((n==null?void 0:n.lessons)||[]).filter(d=>d.id!==t),i=ce(B({},n),{lessons:Xt(o),updatedAt:new Date().toISOString()}),l=await Qt(i);return Jt(l),l},Ps=async(e,t,n)=>{if(!e||!t||!n)return null;let o=n==="up"?-1:n==="down"?1:0;if(!o)return Ye(e);let i=await Ye(e),l=[...(i==null?void 0:i.lessons)||[]],d=l.findIndex(V=>V.id===t);if(d===-1)return i;let f=l[d],m=l.filter(V=>V.dayIndex===f.dayIndex);if(m.length<=1)return i;let v=Xt(m).map(V=>V.id),p=v.indexOf(t);if(p===-1)return i;let k=p+o;if(k<0||k>=v.length)return i;let[N]=v.splice(p,1);v.splice(k,0,N);let M=new Map(v.map((V,I)=>[V,I])),z=l.map(V=>{if(V.dayIndex!==f.dayIndex)return V;let I=M.get(V.id);return typeof I=="number"?ce(B({},V),{position:I}):V}),Z=ce(B({},i),{lessons:Xt(z),updatedAt:new Date().toISOString()}),X=await Qt(Z);return Jt(X),X},Ei=async(e,t,n)=>{if(!e||!t)return null;let o=await Ye(e),i=[...(o==null?void 0:o.lessons)||[]],l=i.findIndex(p=>p.id===t);if(l===-1)return o;let d=Ls(n);if(!d)return o;let f=i[l],m=ce(B({},f),{details:[...f.details||[],d]});i[l]=m;let g=ce(B({},o),{lessons:Xt(i),updatedAt:new Date().toISOString()}),v=await Qt(g);return Jt(v),v},Rs=async(e,t)=>{if(!e||!t)return null;let n=await Ye(e),o=((n==null?void 0:n.lessons)||[]).map(d=>({title:d.title,summary:d.summary,dayIndex:d.dayIndex,notes:typeof d.notes=="string"?d.notes:"",subject:typeof d.subject=="string"?d.subject:"",details:(d.details||[]).map(f=>({badge:f.badge,text:f.text}))})),i=gn({weekId:t,lessons:o,templateId:typeof(n==null?void 0:n.templateId)=="string"?n.templateId:""},t);i.updatedAt=new Date().toISOString();let l=await Qt(i);return Jt(l),l},Os=e=>{if(!e||typeof e!="object")return null;let t=mi(Number.isFinite(e.dayIndex)?e.dayIndex:vs(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",o=typeof e.summary=="string"?e.summary:"",i=typeof e.notes=="string"?e.notes:"",l=typeof e.subject=="string"?e.subject.trim():"",d=Array.isArray(e.details)?e.details.map(f=>{if(!f||typeof f!="object")return null;let m=typeof f.badge=="string"?f.badge:"",g=typeof f.text=="string"?f.text:"";return g.trim()?{badge:m,text:g}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:o,details:d,notes:i,subject:l}},hn=()=>{let e=fd(),t={};return Object.keys(e).forEach(n=>{let o=e[n];if(!o||typeof o!="object")return;let i=typeof o.name=="string"&&o.name.trim()?o.name.trim():n,l=Array.isArray(o.lessons)?o.lessons.map(d=>Os(d)).filter(Boolean):[];t[i]={name:i,lessons:l,updatedAt:typeof o.updatedAt=="string"?o.updatedAt:""}}),t},_s=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let o=hn(),i=Array.isArray(t.lessons)?t.lessons.map(l=>Os(l)).filter(Boolean):[];return o[n]={name:n,lessons:i,updatedAt:new Date().toISOString()},md(o),o[n]},Qr=()=>pd(),wi=async(e,t)=>{if(!e||!t)return null;let o=hn()[t];if(!o)return Ye(e);xs(t);let i=Array.isArray(o.lessons)?o.lessons.map(f=>({dayIndex:f.dayIndex,title:f.title,summary:f.summary,notes:typeof f.notes=="string"?f.notes:"",subject:typeof f.subject=="string"?f.subject:"",details:Array.isArray(f.details)?f.details.map(m=>({badge:m.badge,text:m.text})):[]})):[],l=gn({weekId:e,lessons:i,templateId:t},e);l.updatedAt=new Date().toISOString();let d=await Qt(l);return Jt(d),d}});var Yu=xa(()=>{Na();es();as();ls();Jo();ci();ys();Hs();ka();function gd(){var O,de,lt;if(typeof document=="undefined")return;let e=(O=document.getElementById("add-reminder-modal"))!=null?O:document.getElementById("reminder-modal"),t=(de=document.getElementById("add-reminder-form"))!=null?de:document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let o=document.querySelectorAll("[data-open-reminder-modal]");if(!o.length)return;if(!e){let x=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch(P){n.focus()}};o.forEach(P=>{P.addEventListener("click",pe=>{if(pe.preventDefault(),typeof window!="undefined"){let me="#reminders";window.location.hash!==me&&(window.location.hash=me),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{x()})})});return}let i=e.querySelector("[data-reminder-modal-backdrop]"),l=e.querySelectorAll("[data-close-modal]"),d=document.getElementById("mainContent"),f=document.querySelector('nav[aria-label="Primary"]'),m=[d,f],g=(lt=e.querySelector('[role="dialog"]'))!=null?lt:e,v=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],p=null,k=()=>{if(!(g instanceof HTMLElement))return[];let x=g.querySelectorAll(v.join(","));return Array.from(x).filter(P=>{let pe=P instanceof HTMLElement,me=typeof SVGElement!="undefined"&&P instanceof SVGElement;if(!pe&&!me||P.getAttribute("aria-hidden")==="true"||"disabled"in P&&P.disabled||P.hidden||P.closest("[hidden]"))return!1;let $e=P.getBoundingClientRect();return $e.width>0&&$e.height>0})},N=()=>{let x=k(),P=x.find(pe=>pe.hasAttribute("data-autofocus")||pe.hasAttribute("autofocus"))||(n&&x.includes(n)?n:null)||x[0];if(P&&typeof P.focus=="function"){P.focus({preventScroll:!0});return}g instanceof HTMLElement&&typeof g.focus=="function"&&g.focus({preventScroll:!0})},M=x=>{g instanceof HTMLElement&&(!(x.target instanceof Node)||!g.contains(x.target))&&(x.stopPropagation(),N())},z=x=>{if(x.key!=="Tab")return;let P=k();if(!P.length){x.preventDefault(),g instanceof HTMLElement&&g.focus({preventScroll:!0});return}let pe=P[0],me=P[P.length-1],$e=document.activeElement;if(x.shiftKey){(!g.contains($e)||$e===pe)&&(x.preventDefault(),me.focus());return}(!g.contains($e)||$e===me)&&(x.preventDefault(),pe.focus())},Z=x=>{m.forEach(P=>{P&&(x?P.setAttribute("inert",""):P.removeAttribute("inert"))})},X=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),Z(!1),document.removeEventListener("keydown",V,!0),e.removeEventListener("keydown",z,!0),e.removeEventListener("focusin",M,!0),p&&typeof p.focus=="function"&&p.focus(),p=null},V=x=>{x.key==="Escape"&&(x.preventDefault(),X())},I=({triggerElement:x}={})=>{x&&typeof x.focus=="function"?p=x:p=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),Z(!0),document.addEventListener("keydown",V,!0),e.addEventListener("keydown",z,!0),e.addEventListener("focusin",M,!0),window.requestAnimationFrame(()=>{N()})},w=(x,P={})=>{try{document.dispatchEvent(new CustomEvent(x,{detail:P}))}catch(pe){if(typeof document!="undefined"&&typeof document.createEvent=="function"){let me=document.createEvent("CustomEvent");me.initCustomEvent(x,!0,!0,P),document.dispatchEvent(me)}}},j=(x={})=>{w("cue:cancelled",x)};o.forEach(x=>{x.addEventListener("click",P=>{P.preventDefault();let me={trigger:P.currentTarget instanceof HTMLElement?P.currentTarget:null,mode:"create"};w("cue:prepare",me),w("cue:open",me)})}),l.forEach(x=>{x.addEventListener("click",P=>{P.preventDefault(),j({trigger:x,reason:"button"})})}),e.addEventListener("click",x=>{x.target===e&&j({reason:"backdrop"})}),i==null||i.addEventListener("click",x=>{x.target===i&&j({reason:"backdrop"})}),document.addEventListener("cue:open",x=>{var me;let P=(me=x==null?void 0:x.detail)==null?void 0:me.trigger,pe=P instanceof HTMLElement?P:null;I({triggerElement:pe})});let $=()=>{X()};document.addEventListener("cue:close",$),document.addEventListener("cue:cancelled",$);let K=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&K instanceof HTMLElement&&t.addEventListener("submit",x=>{x.preventDefault(),!K.matches(":disabled")&&K.click()}),K instanceof HTMLElement&&document.addEventListener("reminder:save",x=>{var pe;let P=(pe=x==null?void 0:x.detail)==null?void 0:pe.trigger;P&&P!==K||K.matches(":disabled")||K.click()})}gd();function Si(e,t={}){if(!(typeof document=="undefined"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch(n){if(typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent(e,!0,!0,t),document.dispatchEvent(o)}}}var Us=null,hd=new Set(["reminders","planner","notes"]);function bd(e){var t;if(!e||typeof document=="undefined")return null;if(hd.has(e)){let n=document.querySelector('[data-route="workspace"]');return n?(t=n.querySelector(`[data-workspace-panel="${e}"]`))!=null?t:n:null}return document.querySelector(`[data-route="${e}"]`)}function al(){if(typeof window=="undefined")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Ed(e){typeof document=="undefined"||!e||(window.clearTimeout(Us),Us=window.setTimeout(()=>{let t=bd(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch(o){n.focus()}},0))}function rr(e){let t=e||al();t&&Ed(t)}function wd(){if(typeof document=="undefined"||typeof window=="undefined")return;let e=()=>{rr()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{if(!(o.currentTarget instanceof HTMLAnchorElement))return;let i=o.currentTarget.getAttribute("href")||"";if(!i.startsWith("#"))return;o.preventDefault();let l=i||"#dashboard",d=l.replace("#","")||"dashboard";window.location.hash!==l&&(window.location.hash=l),typeof window.renderRoute=="function"&&window.renderRoute(),rr(d)})}),typeof window.renderRoute=="function"&&window.renderRoute(),rr()}wd();var sl="memoryCue:accountPanelCollapsed";function Sd(){if(typeof window=="undefined"||typeof window.localStorage=="undefined")return null;try{let e=window.localStorage.getItem(sl);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function vd(e){if(!(typeof window=="undefined"||typeof window.localStorage=="undefined"))try{window.localStorage.setItem(sl,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function Ld(){if(typeof document=="undefined")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let o=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",i=(t.getAttribute("data-expanded-label")||"").trim()||o,l=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",d=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",f=t.querySelector("[data-account-toggle-label]"),m=t.querySelector("[data-account-toggle-a11y]"),g=Sd();typeof g!="boolean"&&(g=!0);let v=(p,{persist:k=!0}={})=>{g=!!p,e.setAttribute("data-account-collapsed",g?"true":"false"),t.setAttribute("aria-expanded",g?"false":"true");let N=g?o:i,M=g?l:d;f?f.textContent=N:t.textContent=N,t.setAttribute("aria-label",M),m&&(m.textContent=M),g?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),g||n.removeAttribute("hidden"),k&&vd(g)};v(g,{persist:!1}),t.addEventListener("click",p=>{p.preventDefault(),v(!g)})}Ld();var $s=document.getElementById("settings-save-button"),Zr=document.getElementById("settings-save-confirmation"),_t=document.getElementById("live-status"),vi=null,Zt=document.getElementById("resourcePlannerStatus"),Li=null;document.addEventListener("planner:reminderCreated",e=>{if(!_t)return;let t=(e==null?void 0:e.detail)||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",o=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",i=o?`Reminder saved for ${o}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";_t.textContent=i});$s&&Zr&&$s.addEventListener("click",e=>{e.preventDefault(),Zr.classList.remove("hidden"),Zr.textContent="Settings saved!",_t&&(_t.textContent="Settings saved!"),vi&&window.clearTimeout(vi),vi=window.setTimeout(()=>{Zr.classList.add("hidden")},3e3)});function Ad(e){if(typeof window=="undefined")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),rr(t),_t&&(_t.textContent="Opening planner to add a new lesson."),vo(),window.requestAnimationFrame(()=>{let o=Il();o&&typeof o.catch=="function"&&o.catch(i=>{console.error("Planner quick action failed to start new lesson flow",i)})})}function Td(){if(typeof document=="undefined")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Ad)})}Td();function Ai(e,{tone:t="success"}={}){Zt&&(Zt.textContent=e,Zt.classList.remove("hidden"),Zt.classList.remove("text-success","text-error"),Zt.classList.add(t==="error"?"text-error":"text-success"),typeof window!="undefined"&&(Li&&window.clearTimeout(Li),Li=window.setTimeout(()=>{Zt.classList.add("hidden"),Zt.textContent=""},4e3))),_t&&(_t.textContent=e)}function Id(e="resource"){return typeof crypto!="undefined"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function xd(e){var g,v,p,k;if(typeof document=="undefined"||typeof window=="undefined")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let o=(g=n.getAttribute("data-resource-title"))==null?void 0:g.trim(),i=(v=n.getAttribute("data-resource-link"))==null?void 0:v.trim();if(!o||!i)return;let l="#planner";window.location.hash!==l&&(window.location.hash=l),typeof window.renderRoute=="function"&&window.renderRoute(),rr("planner"),vo(),await Tl();let d=`${o} \u2014 ${i}`,f=yu(),m=null;try{if(f)m=await Ei(ae,f,{badge:"Resource",text:d});else{let N=Id("lesson"),M=((k=(p=Y==null?void 0:Y.lessons)==null?void 0:p[0])==null?void 0:k.dayLabel)||"Monday";m=await hi(ae,{id:N,dayName:M,title:o,summary:`Resource link: ${i}`,details:[{badge:"Resource",text:d}]}),m&&(Ne=N)}if(m){Y=m,Ge(m),Ke(m,ae),at(m);let N=f?`Added "${o}" to your selected lesson.`:`Created a lesson for "${o}" in this week's planner.`;Ai(N);return}Ai("Unable to save that resource to the planner right now.",{tone:"error"})}catch(N){console.error("Failed to save resource to planner",N),Ai("Unable to save that resource to the planner right now.",{tone:"error"})}}function Cd(){if(typeof document=="undefined")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",xd)})}Cd();var ll=document.getElementById("reminder-title"),Dd=document.getElementById("reminderText"),se=(()=>{var l;let e=(l=document.getElementById("cue-modal"))!=null?l:document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),o=e.querySelector(".modal-backdrop button"),i=document.getElementById("modal-title");return ss({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:o instanceof HTMLElement?o:null,titleInput:ll,modalTitle:i instanceof HTMLElement?i:null,defaultTitle:ii,editTitle:ai})})();se==null||se.setEditMode(!1);var kd=()=>{let e=!!ll;if(!!Dd)return jr({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?jr(n):jr(ce(B({},n),{listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null}))};kd().catch(e=>{console.error("Failed to initialise reminders",e)});var Et=ps(),Zn=qa({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{Et==null||Et.handleSessionChange(e)}});if(Zn!=null&&Zn.supabase){Et==null||Et.setSupabaseClient(Zn.supabase);try{Zn.supabase.auth.getSession().then(({data:e})=>{var t,n;Et==null||Et.handleSessionChange((n=(t=e==null?void 0:e.session)==null?void 0:t.user)!=null?n:null)}).catch(()=>{})}catch(e){}}var At=document.getElementById("cues-list"),Ti=document.getElementById("pinnedNotesCard"),En=document.getElementById("pinnedNotesList"),vt=document.getElementById("cue-form"),st=vt==null?void 0:vt.querySelector("#cue-id-input"),ol,il,Nd=(se==null?void 0:se.defaultTitle)||((il=(ol=se==null?void 0:se.modalTitle)==null?void 0:ol.textContent)==null?void 0:il.trim())||ii,kf=(se==null?void 0:se.editTitle)||ai,uo=document.getElementById("tab-cues"),fo=document.getElementById("tab-daily"),sr=document.getElementById("cues-view"),lr=document.getElementById("daily-list-view"),js=document.getElementById("daily-list-header"),wn=document.getElementById("quick-add-form"),He=document.getElementById("quick-add-input"),Ue=document.getElementById("daily-voice-btn"),Lt=document.getElementById("daily-tasks-container"),or=document.getElementById("clear-completed-btn"),mo=document.getElementById("daily-list-permission-notice"),Pe=document.getElementById("plannerCards")||document.getElementById("planner-grid"),qs=document.getElementById("planner-week"),Ii=document.getElementById("planner-prev"),xi=document.getElementById("planner-next"),Ci=document.getElementById("planner-today"),Di=document.getElementById("planner-duplicate-btn"),ki=document.getElementById("planner-new-lesson-btn"),it=document.getElementById("planner-template-select"),ao=document.getElementById("planner-template-save-btn"),Sn=document.querySelector("[data-planner-text-size]"),en=document.getElementById("planner-subject-filter"),Ni=document.querySelector(".desktop-panel--planner"),eo=document.querySelector("[data-mobile-notes-text-size]"),Fi=document.querySelector(".mobile-panel--notes"),cl="plannerTextSizePreference",po="default",Eo=new Set(["small","default","large"]),Fd=["planner-text-small","planner-text-default","planner-text-large"],dl="mobileNotesTextSizePreference",yo="default",wo=new Set(["small","default","large"]),Md=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function Pi(e){return typeof HTMLSelectElement!="undefined"&&e instanceof HTMLSelectElement}function Bd(){if(typeof localStorage=="undefined")return po;let e=localStorage.getItem(cl);return e&&Eo.has(e)?e:po}function Pd(e){typeof localStorage=="undefined"||!Eo.has(e)||localStorage.setItem(cl,e)}function ul(e){if(!Ni)return;let t=Eo.has(e)?e:po;Fd.forEach(n=>Ni.classList.remove(n)),Ni.classList.add(`planner-text-${t}`)}var fl=Bd();ul(fl);Pi(Sn)&&(Sn.value=fl);function ml(){if(typeof localStorage=="undefined")return yo;let e=localStorage.getItem(dl);return e&&wo.has(e)?e:yo}function Rd(e){typeof localStorage=="undefined"||!wo.has(e)||localStorage.setItem(dl,e)}function pl(e){if(!Fi)return;let t=wo.has(e)?e:yo;Md.forEach(n=>Fi.classList.remove(n)),Fi.classList.add(`mobile-panel--notes-size-${t}`)}var yl=ml();pl(yl);eo instanceof HTMLSelectElement&&(eo.value=yl,eo.addEventListener("change",e=>{var n;let t=typeof((n=e.target)==null?void 0:n.value)=="string"?e.target.value:yo;if(!wo.has(t)){eo.value=ml();return}Rd(t),pl(t)}));var Od=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function _d(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof(e==null?void 0:e.dayLabel)=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof(e==null?void 0:e.dayName)=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=Od.findIndex(o=>o.toLowerCase()===t.toLowerCase());return n>=0?n:0}function Hd(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function Ud(){if(typeof document=="undefined")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),o=document.getElementById("planner-modal-description"),i=document.getElementById("planner-modal-error"),l=document.getElementById("planner-modal-submit"),d=document.getElementById("planner-lesson-day"),f=document.getElementById("planner-lesson-title"),m=document.getElementById("planner-lesson-summary"),g=document.getElementById("planner-lesson-subject"),v=document.getElementById("planner-detail-badge"),p=document.getElementById("planner-detail-text"),k=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(l instanceof HTMLElement)||!(d instanceof HTMLSelectElement)||!(f instanceof HTMLInputElement)||!(m instanceof HTMLTextAreaElement))return null;let N=t.querySelector("[data-planner-lesson-section]"),M=t.querySelector("[data-planner-summary-section]"),z=t.querySelector("[data-planner-detail-section]"),Z=t.querySelector("[data-planner-duplicate-section]"),X=e.querySelector("[data-planner-modal-dialog]"),V=e.querySelector("[data-planner-modal-backdrop]"),I=e.querySelectorAll("[data-planner-modal-close]"),w=document.getElementById("mainContent"),j=document.querySelector('nav[aria-label="Primary"]'),$=(()=>{let b=[],U=e.parentElement;return j instanceof HTMLElement&&b.push(j),U instanceof HTMLElement?b.push(...Array.from(U.children).filter(ne=>ne instanceof HTMLElement&&ne!==e)):w instanceof HTMLElement&&(w.contains(e)?b.push(...Array.from(w.children).filter(ne=>ne instanceof HTMLElement&&!ne.contains(e))):b.push(w)),b})(),K=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],O={mode:"add",lessonId:null,trigger:null},de=null,lt=null,x=b=>{de=b instanceof HTMLElement?b:null},P=b=>{$.forEach(U=>{U&&(b?U.setAttribute("inert",""):U.removeAttribute("inert"))})},pe=()=>{if(!(X instanceof HTMLElement))return[];let b=X.querySelectorAll(K.join(","));return Array.from(b).filter(U=>{if(U.closest('[aria-hidden="true"]')||"disabled"in U&&U.disabled)return!1;let ne=U.getBoundingClientRect();return ne.width>0&&ne.height>0})},me=()=>{let b=pe(),U=(de&&b.includes(de)?de:null)||b[0]||X;U&&typeof U.focus=="function"&&U.focus({preventScroll:!0})},$e=b=>{X instanceof HTMLElement&&(X.contains(b.target)||me())},$t=b=>{if(b.key!=="Tab")return;let U=pe();if(!U.length){b.preventDefault();return}let ne=U[0],je=U[U.length-1];if(b.shiftKey&&document.activeElement===ne){b.preventDefault(),je.focus();return}!b.shiftKey&&document.activeElement===je&&(b.preventDefault(),ne.focus())},Tn=b=>{if(b.key==="Escape"){b.preventDefault(),ve();return}$t(b)},mr=()=>{i&&(i.textContent="",i.classList.add("hidden"),i.setAttribute("aria-hidden","true"))},Je=b=>{i&&(i.textContent=b,i.classList.remove("hidden"),i.removeAttribute("aria-hidden"))},on=b=>{l.disabled=!!b,l.classList.toggle("loading",!!b)},te=(b,U)=>{b instanceof HTMLElement&&(b.classList.toggle("hidden",!U),U?b.removeAttribute("aria-hidden"):b.setAttribute("aria-hidden","true"))},Tt=b=>{[d,f,m,g].forEach(U=>{U instanceof HTMLElement&&(U.disabled=!!b,U.classList.toggle("opacity-60",!!b),U.classList.toggle("cursor-not-allowed",!!b))})},ct=()=>{t.reset(),mr(),x(null),Tt(!1),g instanceof HTMLInputElement&&(g.value=""),v instanceof HTMLInputElement&&(v.value=""),(p instanceof HTMLTextAreaElement||p instanceof HTMLInputElement)&&(p.value=""),k instanceof HTMLInputElement&&(k.value="")},jt=({title:b,description:U,action:ne})=>{n&&(n.textContent=b||"Plan lesson"),o&&(o.textContent=U||""),l.textContent=ne||"Save lesson"},dt=({trigger:b}={})=>{O.trigger=b instanceof HTMLElement?b:null,lt=O.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),P(!0),document.addEventListener("keydown",Tn,!0),e.addEventListener("focusin",$e,!0),window.requestAnimationFrame(()=>{me()})},ve=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),P(!1),document.removeEventListener("keydown",Tn,!0),e.removeEventListener("focusin",$e,!0);let b=O.trigger||lt;O.mode="add",O.lessonId=null,O.trigger=null,x(null),ct(),b&&typeof b.focus=="function"&&b.focus({preventScroll:!0})},Ie=({defaultDay:b="Monday",trigger:U}={})=>{O.mode="add",O.lessonId=null,ct(),te(N,!0),te(M,!0),te(z,!1),te(Z,!1),Tt(!1);let ne=typeof b=="string"&&b.trim()?b.trim():"Monday";d.value=ne,d.value!==ne&&(d.value="Monday"),f.value=ne?`${ne} lesson`:"",m.value="",g instanceof HTMLInputElement&&(g.value=""),jt({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),x(f),dt({trigger:U})},In=({lesson:b,trigger:U}={})=>{if(!b)return;O.mode="edit",O.lessonId=b.id,ct(),te(N,!0),te(M,!0),te(z,!1),te(Z,!1),Tt(!1);let ne=b.dayLabel||b.dayName||"Monday";d.value=ne,d.value!==ne&&(d.value="Monday"),f.value=b.title||"",m.value=b.summary||"",g instanceof HTMLInputElement&&(g.value=b.subject||""),jt({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),x(f),dt({trigger:U})},Re=({lesson:b,trigger:U}={})=>{if(!b)return;O.mode="detail",O.lessonId=b.id,ct(),te(N,!0),te(M,!0),te(z,!0),te(Z,!1),Tt(!0);let ne=b.dayLabel||b.dayName||"Monday";d.value=ne,d.value!==ne&&(d.value="Monday"),f.value=b.title||"",m.value=b.summary||"",g instanceof HTMLInputElement&&(g.value=b.subject||""),v instanceof HTMLInputElement&&(v.value=""),(p instanceof HTMLTextAreaElement||p instanceof HTMLInputElement)&&(p.value=""),jt({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),x(p instanceof HTMLElement?p:null),dt({trigger:U})},We=({suggestedWeekId:b="",trigger:U}={})=>{O.mode="duplicate",O.lessonId=null,ct(),te(N,!1),te(M,!1),te(z,!1),te(Z,!0),k instanceof HTMLInputElement&&(k.value=b),jt({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),x(k instanceof HTMLElement?k:null),dt({trigger:U})},xn=async b=>{var U,ne,je,an;b.preventDefault(),mr(),on(!0);try{if(O.mode==="duplicate"){let we=(U=k==null?void 0:k.value)==null?void 0:U.trim();if(!we){Je("Enter the Monday date for the destination week.");return}if(we===ae){Je("Choose a different week to duplicate into.");return}let he=await Rs(ae,we);he&&(ae=we,Y=he,Ge(he),Vi(we),Ke(he,we),at(he),ve());return}if(O.mode==="detail"){if(!O.lessonId){Je("Select a lesson before adding details.");return}let we=(ne=p==null?void 0:p.value)==null?void 0:ne.trim();if(!we){Je("Add text for this detail.");return}let he=((je=v==null?void 0:v.value)==null?void 0:je.trim())||"",J=await Ei(ae,O.lessonId,{badge:he,text:we});J&&(Y=J,Ge(J),Ke(J,ae),at(J),ve());return}let ut=d.value.trim(),Cn=f.value.trim(),xe=m.value.trim(),ft=((an=g==null?void 0:g.value)==null?void 0:an.trim())||"";if(!ut){Je("Choose a day for this lesson.");return}if(!Cn){Je("Enter a lesson title.");return}if(O.mode==="edit"){if(!O.lessonId){Je("Select a lesson to edit.");return}let we=await bi(ae,O.lessonId,{dayName:ut,title:Cn,summary:xe,subject:ft});we&&(Y=we,Ge(we),Ke(we,ae),at(we),ve());return}let It=await hi(ae,{dayName:ut,title:Cn,summary:xe,subject:ft});It&&(Y=It,Ge(It),Ke(It,ae),at(It),ve())}catch(ut){console.error("Failed to save planner change",ut),Je("Unable to save changes right now. Please try again.")}finally{on(!1)}};return t.addEventListener("submit",xn),I.forEach(b=>{b.addEventListener("click",U=>{U.preventDefault(),ve()})}),e.addEventListener("click",b=>{b.target===e&&ve()}),V==null||V.addEventListener("click",b=>{b.target===V&&ve()}),{openAddLesson:Ie,openEditLesson:In,openAddDetail:Re,openDuplicatePlan:We,close:ve}}var Vs=document.getElementById("remindersCount"),Ht=typeof document!="undefined"?Ud():null,Ws=document.getElementById("plannerCount"),Ys=document.getElementById("plannerSubtitle"),tn="all",Ot=tn,Nf=document.getElementById("resourcesCount"),Ff=document.getElementById("templatesCount"),to=document.getElementById("dailySnapshotList"),no=document.getElementById("todaysFocusList"),wt=document.getElementById("weekAtAGlanceList"),St=null;wt&&(St=document.createElement("li"),St.dataset.emptyState="week",St.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",St.textContent="No upcoming events this week.");var zs=()=>{if(!wt||!St)return;wt.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?wt.contains(St)||wt.appendChild(St):wt.contains(St)&&wt.removeChild(St)};wt&&(zs(),new MutationObserver(zs).observe(wt,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var Mi=e=>{Ti&&(e?Ti.classList.remove("hidden"):Ti.classList.add("hidden"))},cr={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Ks=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch(e){return null}})(),Gs=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch(e){return null}})(),so=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",qi=e=>{if(!(e!=null&&e.due))return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch(t){return null}},$d=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),gl=e=>{if(!e)return"";if(Ks)try{return Ks.format(e)}catch(o){}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},jd=e=>{if(!e)return"";if(Gs)try{return Gs.format(e)}catch(t){}return e.toLocaleDateString()},hl=e=>{let t=typeof(e==null?void 0:e.priority)=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(cr,t)?t:"medium"},Xs=e=>{var n,o;let t=hl(e);return(o=(n=cr[t])==null?void 0:n.rank)!=null?o:cr.medium.rank},qd=e=>{var n;let t=hl(e);return(n=cr[t])!=null?n:cr.medium},Js=e=>{let t=qi(e);return t?t.getTime():Number.POSITIVE_INFINITY};function bl(e=[]){if(!to)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(o=>({reminder:o,date:qi(o)})).filter(({date:o})=>o&&$d(o,t)).sort((o,i)=>o.date.getTime()-i.date.getTime());if(!n.length){to.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}to.innerHTML="",n.forEach(({reminder:o,date:i})=>{let l=document.createElement("li");l.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let d=document.createElement("p");d.className="font-semibold text-base-content",d.textContent=so(o),l.appendChild(d);let f=gl(i),m=document.createElement("p");m.className="text-xs text-base-content/70",m.textContent=f?`Due ${f}`:"Due today",l.appendChild(m),to.appendChild(l)})}function El(e=[]){if(!no)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,o)=>{let i=Xs(n)-Xs(o);if(i!==0)return i;let l=Js(n)-Js(o);return l!==0?l:so(n).localeCompare(so(o),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){no.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}no.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let i=document.createElement("div");i.className="flex items-center justify-between gap-3";let l=document.createElement("p");l.className="font-semibold text-base-content",l.textContent=so(n),i.appendChild(l);let d=qd(n),f=document.createElement("span");f.className=d.badgeClass,f.textContent=d.badgeLabel,i.appendChild(f),o.appendChild(i);let m=qi(n),g=document.createElement("p");if(g.className="text-xs text-base-content/70",m){let v=gl(m),p=jd(m),k=[];v&&k.push(`Due ${v}`),p&&k.push(p),g.textContent=k.length?k.join(" \u2022 "):"Due soon"}else g.textContent="No due date";o.appendChild(g),no.appendChild(o)})}var Vd=e=>{if(!Vs)return;let t=Array.isArray(e)?e.length:0;Vs.textContent=String(t)},Wd=e=>{var n;let t=Array.isArray((n=e==null?void 0:e.detail)==null?void 0:n.items)?e.detail.items:[];Vd(t),bl(t),El(t)};document.addEventListener("memoryCue:remindersUpdated",Wd);bl();El();var Ri=ns(ts),Yd={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},ro=null,zd=3,Qs=120;function Kd(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Qs?t:`${t.slice(0,Qs-1)}\u2026`:""}function Gd(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let o=n.trim().toLowerCase();return o==="true"||o==="1"||o==="yes"}return!1})}function Zs(e){if(!En)return;let t=Array.isArray(e)?e:[];if(!t.length){En.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Mi(!1);return}let n=t.filter(l=>Gd(l));if(!n.length){En.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Mi(!1);return}Mi(!0);let i=n.slice(0,zd).map(l=>{let d=ge(fn(l,"title")||"Untitled Cue"),f=fn(l,"details"),m=ge(Kd(f)),g=m?`<p class="mt-1 text-sm text-base-content/70">${m}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${d}</p>
          ${g}
        </li>
      `}).join("");En.innerHTML=i}function Oi(e,{tone:t="muted"}={}){if(!At)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),At.innerHTML=`<p class="${n.join(" ")}">${ge(e)}</p>`}function Xd(e){if(!At)return;if(!Array.isArray(e)||e.length===0){Oi("No cues yet.");return}let t=e.map(n=>{let o=ge(fn(n,"title")||"Untitled Cue"),i=ge(fn(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${i?`<p>${i}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${ge(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${ge(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");At.innerHTML=t}async function fr(){return ro||(ro=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:i,collection:l,doc:d,getDoc:f,addDoc:m,updateDoc:g,getDocs:v,query:p,orderBy:k,serverTimestamp:N,setDoc:M,arrayUnion:z}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),Z=t(),X=Z&&Z.length?Z[0]:e(Yd),V=n(X);(function(){let j=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:null;j&&(j.__persistenceInitialized__||(j.__persistenceInitialized__=!0,(async()=>{try{await o(V),console.info("[Firestore] Persistence: multi-tab enabled")}catch($){if($&&$.code==="failed-precondition")try{await i(V),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(K){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",(K==null?void 0:K.code)||K)}else $&&$.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",($==null?void 0:$.code)||$)}})()))})();let I=l(V,"cues");return{db:V,cuesCollection:I,getCollection:l,doc:d,getDoc:f,addDoc:m,updateDoc:g,getDocs:v,query:p,orderBy:k,serverTimestamp:N,setDoc:M,arrayUnion:z}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),ro)}async function Jd(){let e=await fr(),{getDocs:t,cuesCollection:n,query:o,orderBy:i}=e,l=o&&i?o(n,i("createdAt","desc")):n;return(await t(l)).docs.map(f=>B({id:f.id},f.data()))}async function Qd(e){if(!e)return null;let t=await fr(),{db:n,doc:o,getDoc:i}=t,l=o(n,"cues",e),d=await i(l);return d.exists()?B({id:d.id},d.data()):null}async function wl(){if(!(!At&&!En))try{let e=await Jd();Xd(e),Zs(e)}catch(e){console.error("Failed to load cues",e),Lo(e)?Oi("Sign in to view your cues.",{tone:"muted"}):Oi("Unable to load cues right now.",{tone:"error"}),Zs([])}}function Zd(e){!vt||!st||(rs(e,Ri),st.value=(e==null?void 0:e.id)||"",se==null||se.setEditMode(!0),se==null||se.show({mode:"edit"}))}async function eu(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await Qd(n);if(!o)return;Zd(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function tu(e){var o;if(e.preventDefault(),!vt||!st)return;let t=st.value.trim(),n=is(Ri);try{let i=await fr(),{db:l,doc:d,addDoc:f,updateDoc:m,cuesCollection:g,serverTimestamp:v}=i,p=typeof v=="function"?v():null;if(t){let k=d(l,"cues",t),N=B({},n);p&&(N.updatedAt=p),await m(k,N)}else{let k=B({},n);p&&(k.createdAt=p,k.updatedAt=p),await f(g,k)}await wl(),os(Ri,st,(o=se==null?void 0:se.modalTitle)!=null?o:null,Nd),await(se==null?void 0:se.hide({reason:"form-submit"}))}catch(i){console.error("Failed to save cue",i)}}async function nu(){!vt||!st||!At||(At.addEventListener("click",eu),vt.addEventListener("submit",tu))}vt&&st&&(document.addEventListener("cue:prepare",()=>{st.value="",se==null||se.setEditMode(!1)}),document.addEventListener("cue:close",()=>{st.value="",se==null||se.setEditMode(!1)}));vt&&st&&At&&nu().catch(e=>{console.error("Failed to initialise cue editing",e)});(At||En)&&wl();var Ee=[],oo=null,nn=!1,dr=bt(),ir=!1,ae=dr,Y=null,nr=null,Ne=null,vn=hn(),go=new Map,ru=800,ou=1500,_i={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},Sl=new Set(["saving","saved","error"]),vl="plannerNotesOpenState",ze=iu();function iu(){if(typeof localStorage=="undefined")return{};try{let e=localStorage.getItem(vl);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function au(){if(typeof localStorage!="undefined")try{localStorage.setItem(vl,JSON.stringify(ze))}catch(e){console.warn("Unable to persist planner notes state",e)}}function su(e){return e?!!(ze!=null&&ze[e]):!1}function lu(e,t){if(e){if(t)ze=ce(B({},ze),{[e]:!0});else if(ze!=null&&ze[e]){let n=B({},ze);delete n[e],ze=n}au()}}var cu=e=>{if(!Ws)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=Ms(dr),Ws.textContent=String(t.length)};function Ke(e,t){if(cu(e),Ys){let n=gi((e==null?void 0:e.weekId)||t,{short:!0});Ys.textContent=n||""}}function ho(e,{tone:t="muted"}={}){if(!Pe)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),Pe.innerHTML=`<p class="${n.join(" ")}">${ge(e)}</p>`}function Vi(e){if(!qs)return;let t=gi(e);qs.textContent=t||""}function So(e){if(!it)return;vn=hn();let t=Object.values(vn).sort((l,d)=>l.name.localeCompare(d.name)),n=t.length>0,i=[`<option value="">${ge(n?"Select template":"No templates saved")}</option>`];t.forEach(l=>{let d=l.name;i.push(`<option value="${ge(d)}">${ge(d)}</option>`)}),it.innerHTML=i.join(""),it.disabled=!n,e&&vn[e]?it.value=e:it.value=""}function at(e){let t=(e==null?void 0:e.templateId)||Qr();So(t)}function Wi(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function du(e){let t=Wi(e);return t?t.toLowerCase():""}function uu(e){if(!en)return;let t=new Map;e.forEach(o=>{let i=Wi(o);if(!i)return;let l=i.toLowerCase();t.has(l)||t.set(l,i)}),(t.size===0||Ot!==tn&&!t.has(Ot))&&(Ot=tn);let n=[`<option value="${tn}">All subjects</option>`];t.forEach((o,i)=>{n.push(`<option value="${ge(i)}">${ge(o)}</option>`)}),en.innerHTML=n.join(""),en.value=Ot,en.disabled=t.size===0}function fu(e){return Array.isArray(e)?Ot===tn?e:e.filter(t=>du(t)===Ot):[]}function mu(e){var n;Ot=typeof((n=e==null?void 0:e.target)==null?void 0:n.value)=="string"?e.target.value:tn,Ge(Y)}async function pu(e,t){let o=(Array.isArray(e==null?void 0:e.lessons)?e.lessons:[]).length>0,i=typeof(e==null?void 0:e.templateId)=="string"&&e.templateId.trim().length>0;if(o||i)return e;let l=Qr();if(!l||(vn[l]||(vn=hn()),!vn[l]))return e;try{return await wi(t,l)||e}catch(d){return console.error("Failed to auto apply preferred planner template",d),e}}function Ge(e){if(!Pe)return;let t=Array.isArray(e==null?void 0:e.lessons)?e.lessons:[];if(uu(t),!t.length){ho("No lessons saved for this week yet."),Ne=null;return}let n=fu(t);if(!n.length){ho("No lessons saved for this subject yet."),Ne=null;return}let o=n.map(l=>typeof l.id=="string"&&l.id?l.id:"").filter(l=>!!l);Ne&&!o.includes(Ne)&&(Ne=null);let i=n.map(l=>{let d=Array.isArray(l.details)?l.details.map(I=>`
                <li class="flex items-center gap-2">
                  ${I.badge?`<span class="badge badge-outline badge-sm text-secondary">${ge(I.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${ge(I.text)}</span>
                </li>
              `).join(""):"",f=d?`<ul class="space-y-2 text-sm text-base-content/70">${d}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',m=typeof l.id=="string"?l.id:"",g=!!(Ne&&m&&Ne===m),v=["data-planner-lesson",m?`data-lesson-id="${m}"`:"",g?'data-planner-selected="true"':""].filter(Boolean).join(" "),p=l.summary?`<p class="text-sm text-base-content/70">${ge(l.summary)}</p>`:"",k=Wi(l),N=k?`<span class="badge badge-outline badge-sm text-base-content/70">${ge(k)}</span>`:"",M=N?`<div class="mt-2 flex flex-wrap gap-1">${N}</div>`:"",z=typeof l.notes=="string"?l.notes:"",Z=su(m),X=m?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${m}"
              ${Z?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${m}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${ge(z)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${ge(_i.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",V=m?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${m}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${m}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${v}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${ge(l.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${ge(l.title||l.dayLabel||"Lesson")}</h2>
                ${p}
                ${M}
              </div>
              <div class="flex flex-wrap items-center justify-end gap-1">
                ${V}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${m}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${m}"
                >
                  Delete
                </button>
            </div>
          </div>
          ${f}
          ${X}
          <div class="flex flex-wrap gap-2">
            <button
              type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${m}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${m}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");Pe.innerHTML=i,Hi(Ne||null)}function Hi(e){if(Ne=e||null,!Pe)return;Pe.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function yu(){return Ne&&(Array.isArray(Y==null?void 0:Y.lessons)?Y.lessons:[]).some(t=>t.id===Ne)?Ne:null}function gu(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===Ne||Hi(n)}function hu(e){let t=Pi(e==null?void 0:e.currentTarget)?e.currentTarget:Sn;if(!Pi(t))return;let n=t.value,o=Eo.has(n)?n:po;ul(o),Pd(o),t.value!==o&&(t.value=o)}function Ll(){return typeof window!="undefined"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function bu(){return typeof window!="undefined"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function Al(e){if(!e)return;let t=go.get(e);if(!t)return;let n=bu();n&&n(t),go.delete(e)}function er(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&Sl.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function tr(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&Sl.has(t)?t:null,o=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(o instanceof HTMLElement){let i=n||"idle",l=_i[i]||_i.idle;o.textContent=l,o.setAttribute("data-status",i)}}async function Ui(e,t,n){if(!e||!ae)return;let o=n instanceof HTMLTextAreaElement?n:null;o&&(er(o,"saving"),tr(o,"saving"));try{let i=await bi(ae,e,{notes:t});if(i&&(Y=i),o){er(o,"saved"),tr(o,"saved");let l=Ll();l?l(()=>{o.getAttribute("data-notes-status")==="saved"&&(er(o,null),tr(o,null))},ou):(er(o,null),tr(o,null))}}catch(i){console.error("Failed to save planner notes",i),o&&(er(o,"error"),tr(o,"error"))}}function Eu(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;Al(n);let o=Ll();if(!o){Ui(n,t.value,t);return}let i=o(()=>{go.delete(n),Ui(n,t.value,t)},ru);go.set(n,i)}function wu(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(Al(n),Ui(n,t.value,t))}function Su(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let o=t.hasAttribute("open");lu(n,o)}function bn(e){if(!Pe)return nr=null,Promise.resolve();let t=e||bt();ae=t,Vi(t),ho("Loading plan\u2026");let n=(async()=>{try{let o=await Ye(t);o=await pu(o,t),Y=o,Ge(o),Ke(o,t),at(o)}catch(o){console.error("Failed to load planner week",o),ho("Unable to load this week's planner.",{tone:"error"})}})();return nr=n,n.finally(()=>{nr===n&&(nr=null)})}async function Tl(){if(!Pe)return;ir||vo();let e=nr;if(!e&&(!Y||Y.weekId!==ae)&&(e=bn(ae)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function vu(e,t){if(!e)return;await Tl();let n=Array.isArray(Y==null?void 0:Y.lessons)?Y.lessons:[];if(!n.length)return;let o=n.find(N=>(N==null?void 0:N.id)===e);if(!o)return;let i=typeof o.dayLabel=="string"&&o.dayLabel.trim()?o.dayLabel.trim():typeof o.dayName=="string"&&o.dayName.trim()?o.dayName.trim():"",l=typeof o.title=="string"&&o.title.trim()?o.title.trim():i||"Lesson",d=typeof o.summary=="string"&&o.summary.trim()?o.summary.trim():"",f=d||l,m=i?`${i} \xB7 ${f}`:f,g=d||"",v=_d(o),p=Hd(Fs(ae,v)),k={reminderTitle:m,reminderNotes:g,dueDate:p,dayLabel:i,lessonTitle:l,summary:d,plannerLessonId:e};Si("cue:prepare",{trigger:t,source:"planner"}),Si("planner:prefillReminder",k),Si("cue:open",{trigger:t,source:"planner"})}async function Lu(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),o=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":xu(o,t);break;case"edit":Cu(o,t);break;case"delete":Du(o);break;case"move-up":el(o,"up",t);break;case"move-down":el(o,"down",t);break;case"create-reminder":await vu(o,t);break;default:break}}async function Il(e){var o,i,l;if(typeof document=="undefined"||!Ht)return;(o=e==null?void 0:e.preventDefault)==null||o.call(e);let t=(e==null?void 0:e.currentTarget)instanceof HTMLElement?e.currentTarget:null,n=((l=(i=Y==null?void 0:Y.lessons)==null?void 0:i[0])==null?void 0:l.dayLabel)||"Monday";Ht.openAddLesson({defaultDay:n,trigger:t})}async function Au(e){var o;if(!Ht)return;(o=e==null?void 0:e.preventDefault)==null||o.call(e);let t=(e==null?void 0:e.currentTarget)instanceof HTMLElement?e.currentTarget:null,n=Jr(ae,1);Ht.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function Tu(e){var o;if(!it)return;let t=(e==null?void 0:e.currentTarget)instanceof HTMLSelectElement?e.currentTarget:it,n=(o=t.value)==null?void 0:o.trim();if(n){t.disabled=!0;try{let i=await wi(ae,n);i&&(Y=i,Ge(i),Ke(i,ae),at(i))}catch(i){console.error("Failed to apply planner template",i),window.alert("Unable to apply that template right now.")}finally{So(n)}}}async function Iu(e){var l;if((l=e==null?void 0:e.preventDefault)==null||l.call(e),!ao)return;let t=Y||await Ye(ae),n=Array.isArray(t==null?void 0:t.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let o=typeof window!="undefined"?window.prompt("Name this template:",(t==null?void 0:t.templateId)||""):null,i=typeof o=="string"?o.trim():"";if(i)try{_s(i,{lessons:n}),So(i)}catch(d){console.error("Failed to save planner template",d),window.alert("Unable to save that template right now.")}}async function xu(e,t){var i;if(!e||!Ht)return;let n=(i=Y==null?void 0:Y.lessons)==null?void 0:i.find(l=>l.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;Ht.openAddDetail({lesson:n,trigger:o})}async function Cu(e,t){var i;if(!e||!Ht)return;let n=(i=Y==null?void 0:Y.lessons)==null?void 0:i.find(l=>l.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;Ht.openEditLesson({lesson:n,trigger:o})}async function el(e,t,n){if(!e||!t)return;let o=ae||bt();if(!o)return;let i=n instanceof HTMLElement?n:null;i&&i.setAttribute("disabled","true");try{let l=await Ps(o,e,t);l&&(Y=l,Ge(l),Ke(l,o),at(l))}catch(l){console.error("Failed to move planner lesson",l),typeof window!="undefined"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{i&&i.removeAttribute("disabled")}}async function Du(e){var o;if(!e||typeof window=="undefined")return;let t=(o=Y==null?void 0:Y.lessons)==null?void 0:o.find(i=>i.id===e);if(window.confirm(t!=null&&t.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let i=await Bs(ae,e);i&&(Y=i,Ge(i),Ke(i,ae),at(i))}catch(i){console.error("Failed to delete planner lesson",i),window.alert("Unable to delete that lesson right now.")}}function vo(){if(ir||!Pe){ir&&bn(ae);return}ir=!0,Ns({ensureFirestore:fr}),Pe.addEventListener("click",gu),Pe.addEventListener("click",Lu),Pe.addEventListener("input",Eu),Pe.addEventListener("focusout",wu),Pe.addEventListener("toggle",Su),ki==null||ki.addEventListener("click",Il),Di==null||Di.addEventListener("click",Au),it==null||it.addEventListener("change",Tu),en==null||en.addEventListener("change",mu),Sn==null||Sn.addEventListener("change",hu),ao==null||ao.addEventListener("click",Iu),Ii==null||Ii.addEventListener("click",()=>{let e=Jr(ae,-1);bn(e)}),xi==null||xi.addEventListener("click",()=>{let e=Jr(ae,1);bn(e)}),Ci==null||Ci.addEventListener("click",()=>{bn(bt())}),So(Qr()),bn(ae)}function tl(){typeof window!="undefined"&&al()==="planner"&&vo()}function ku(e){var n;let t=(n=e==null?void 0:e.detail)==null?void 0:n.plan;t&&(ir&&t.weekId===ae&&(Y=t,Ge(t),Vi(t.weekId),at(t)),t.weekId===dr&&Ke(t,dr))}Ke(null,dr);typeof document!="undefined"&&document.addEventListener(ui,ku);typeof window!="undefined"&&(window.addEventListener("hashchange",tl),window.addEventListener("DOMContentLoaded",tl));var xl="dailyTasksByDate",io=null;function Yi(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function Nu(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),i=Number.parseInt(t,10),l=Number.parseInt(n,10),d=Number.parseInt(o,10);if(!Number.isFinite(i)||!Number.isFinite(l)||!Number.isFinite(d))return e;let f=new Date(i,l-1,d);return Number.isNaN(f.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(f)}function ur(e){if(!or)return;let t=Array.isArray(e)&&e.some(n=>!!(n!=null&&n.completed));or.disabled=!t}function rn(e){if(!Lt)return;if(!Array.isArray(e)||e.length===0){Lt.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',ur([]);return}let t=e.map((n,o)=>{let i=ge((n==null?void 0:n.text)||""),l=!!(n!=null&&n.completed),d=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return l&&d.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${i}" ${l?"checked":""} />
          <span class="${d.join(" ")}">${i}</span>
        </div>
      `}).join("");Lt.innerHTML=t,ur(e)}function bo(){mo&&mo.classList.remove("hidden")}function Fu(){mo&&mo.classList.add("hidden")}function zi(e){return{text:typeof(e==null?void 0:e.text)=="string"?e.text:"",completed:!!(e!=null&&e.completed)}}function An(e){return Array.isArray(e)?e.map(t=>zi(t)):[]}function Ki(){if(typeof localStorage=="undefined")return{};try{let e=localStorage.getItem(xl);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function Cl(e){if(typeof localStorage!="undefined")try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(xl,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function nl(e){let t=Ki(),n=t&&typeof t=="object"?t[e]:[];return An(n)}function lo(e,t){let n=Ki(),o=An(t);return n[e]=o,Cl(n),o}function Bi(e,t){let n=Ki(),o=An(n[e]);return o.push(zi(t)),n[e]=o,Cl(n),o}function Lo(e){let t=typeof(e==null?void 0:e.code)=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof(e==null?void 0:e.message)=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Gi(){return io||(io=fr().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return ce(B({},e),{dailyListsCollection:o})}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),io)}function Xi(e,t){let{doc:n,dailyListsCollection:o,db:i}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(i,"dailyLists",t)}async function Ji(){if(!js||!Lt)return;let e=Yi(),t=Nu(e);if(js.textContent=t?`Today's List - ${t}`:"Today's List",nn){bo();let n=nl(e);return Ee=n,rn(n),Promise.resolve(n)}return oo||(Lt.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',ur([]),oo=(async()=>{var n;try{let o=await Gi(),i=Xi(o,e),l=await o.getDoc(i),d=l.exists()?(n=l.data())==null?void 0:n.tasks:[];return Ee=An(d),rn(Ee),lo(e,Ee),nn=!1,Fu(),Ee}catch(o){if(Lo(o)){console.warn("Falling back to local daily tasks due to permission issue",o),nn=!0,bo();let i=nl(e);return Ee=i,rn(i),i}return console.error("Failed to load daily list",o),Lt.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',Ee=[],ur(Ee),Ee}})().finally(()=>{oo=null})),oo}async function Mu(e){var o;let t=Yi(),n=zi(e);if(nn){Bi(t,n);return}try{let i=await Gi(),l=Xi(i,t),d=await i.getDoc(l);if(d.exists()&&typeof i.arrayUnion=="function")await i.updateDoc(l,{tasks:i.arrayUnion(n)});else{let f=d.exists()?(o=d.data())==null?void 0:o.tasks:[],m=Array.isArray(f)?An(f):[];m.push(n),typeof i.setDoc=="function"?await i.setDoc(l,{tasks:m},{merge:!0}):await i.updateDoc(l,{tasks:m})}Bi(t,n)}catch(i){if(Lo(i)){console.warn("Saving task locally because cloud sync is unavailable",i),nn=!0,bo(),Bi(t,n);return}throw i}}async function Dl(e){let t=Yi(),n=An(e);if(nn){lo(t,n);return}try{let o=await Gi(),i=Xi(o,t);typeof o.setDoc=="function"?await o.setDoc(i,{tasks:n},{merge:!0}):await o.updateDoc(i,{tasks:n}),lo(t,n)}catch(o){if(Lo(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),nn=!0,bo(),lo(t,n);return}throw o}}function kl(e){[uo,fo].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function Bu(){!sr||!lr||(sr.classList.remove("hidden"),lr.classList.add("hidden"),kl(uo))}function Pu(){!sr||!lr||(sr.classList.add("hidden"),lr.classList.remove("hidden"),kl(fo),Ji())}function Ru(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),o=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!o.length)return;let i=f=>{n.forEach(m=>{if(!m)return;let g=m.getAttribute("data-dashboard-tab")===f;m.classList.toggle("tab-active",g),m.setAttribute("aria-selected",g?"true":"false")}),o.forEach(m=>{if(!m)return;let g=m.getAttribute("data-dashboard-panel")===f;m.classList.toggle("hidden",!g),m.setAttribute("aria-hidden",g?"false":"true")})},l=n.find(f=>f.classList.contains("tab-active"))||n[0],d=l==null?void 0:l.getAttribute("data-dashboard-tab");d&&i(d),n.forEach(f=>{f.addEventListener("click",()=>{let m=f.getAttribute("data-dashboard-tab");m&&i(m)})})})}window.addEventListener("DOMContentLoaded",Ru);uo&&fo&&sr&&lr&&(uo.addEventListener("click",e=>{e.preventDefault(),Bu()}),fo.addEventListener("click",e=>{e.preventDefault(),Pu()}));var Be=null,Xe=!1,co=null;function Ln(e){if(!Ue)return;Ue.setAttribute("aria-pressed",e?"true":"false");let t=Ue.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":Ue.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function Ou(){Xe&&(window.clearTimeout(co),co=window.setTimeout(()=>{co=null,Xe&&Nl(!0)},400))}function Nl(e=!1){if(!Be)return!1;if(Xe&&!e)return!0;try{return Be.start(),Xe=!0,Ln(!0),!0}catch(t){return Xe=!1,Ln(!1),!1}}function Qi(){if(Be){Xe=!1,window.clearTimeout(co);try{Be.stop()}catch(e){}Ln(!1)}}function _u(){var e;if(Ue)try{let t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){Ue.setAttribute("disabled","true"),Ue.setAttribute("aria-disabled","true"),Ue.title="Voice input is not supported in this browser.";return}Be=new t;let n=((e=document.documentElement)==null?void 0:e.lang)||(navigator==null?void 0:navigator.language)||"en-AU";if(Be.lang=n,Be.interimResults=!1,"continuous"in Be)try{Be.continuous=!0}catch(o){}Be.onresult=o=>{var l,d,f;let i=((f=(d=(l=o==null?void 0:o.results)==null?void 0:l[0])==null?void 0:d[0])==null?void 0:f.transcript)||"";if(i&&He){He.value=i.trim();try{He.focus({preventScroll:!0})}catch(m){He.focus()}try{let m=He.value.length;He.setSelectionRange(m,m)}catch(m){}}},Be.onend=()=>{if(!Xe){Ln(!1);return}Ou()},Be.onerror=()=>{Xe=!1,Ln(!1)}}catch(t){Be=null,Ln(!1),Ue.setAttribute("disabled","true"),Ue.setAttribute("aria-disabled","true")}}_u();Ue==null||Ue.addEventListener("click",()=>{Be&&(Xe?Qi():Nl())});wn==null||wn.addEventListener("submit",()=>{Xe&&Qi()});window.addEventListener("pagehide",()=>{Xe&&Qi()});wn==null||wn.addEventListener("submit",async e=>{if(e.preventDefault(),!He)return;let t=He.value.trim();if(!t){He.focus();return}let n={text:t,completed:!1};He.value="",He.focus();try{await Mu(n),await Ji()}catch(o){console.error("Failed to add task to the daily list",o),He.value=t,He.focus()}});Lt==null||Lt.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(Ee)||Number.isNaN(n)||!Ee[n])return;let o=Ee.map(l=>B({},l)),i=o.map((l,d)=>d===n?ce(B({},l),{completed:t.checked}):l);Ee=i,rn(i);try{await Dl(i)}catch(l){console.error("Failed to update task completion state",l),Ee=o,rn(o)}});or==null||or.addEventListener("click",async()=>{if(!Array.isArray(Ee)||Ee.length===0)return;let e=Ee.filter(n=>!n.completed);if(e.length===Ee.length)return;let t=Ee.map(n=>B({},n));Ee=e,rn(e);try{await Dl(e)}catch(n){console.error("Failed to clear completed tasks",n),Ee=t,rn(t)}});ur(Ee);Ji();function Hu(){if(typeof document=="undefined")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),o=document.getElementById("noteNewBtn"),i=document.getElementById("notesList"),l=document.querySelector("[data-notes-layout]"),d=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!o)return;let f=null,m=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch(I){e.focus()}},g=()=>l&&l.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",v=I=>{let w=I==="collapsed";d.forEach(j=>{if(!(j instanceof HTMLElement))return;j.setAttribute("aria-expanded",w?"false":"true");let $=j.dataset.notesShelfToggleVariant;$==="primary"?j.textContent=w?"Show saved notes":"Hide saved notes":$==="close"&&(j.textContent=w?"Show":"Close")})},p=I=>{l&&(l.dataset.notesShelfState=I==="collapsed"?"collapsed":"expanded"),v(g())},k=()=>{let I=g()==="collapsed"?"expanded":"collapsed";p(I),I==="collapsed"&&m()};d.length&&(d.forEach(I=>{I.addEventListener("click",w=>{w.preventDefault(),k()})}),p(g()));let N=I=>{if(!I){f=null,e.value="",t.value="";return}f=I.id,e.value=I.title||"",t.value=I.body||""},M=()=>{if(!i)return;i.querySelectorAll("button[data-note-id]").forEach(w=>{if(!(w instanceof HTMLElement))return;let j=w.getAttribute("data-note-id")===f;w.classList.toggle("bg-base-200/80",j),w.classList.toggle("border-base-300",!j),w.classList.toggle("border-primary",j),w.classList.toggle("font-medium",j),w.setAttribute("aria-current",j?"true":"false")})},z=()=>{let I=mn();return Array.isArray(I)?[...I].sort((w,j)=>{let $=Date.parse((w==null?void 0:w.updatedAt)||""),K=Date.parse((j==null?void 0:j.updatedAt)||"");return(Number.isNaN(K)?0:K)-(Number.isNaN($)?0:$)}):[]},Z=I=>{if(!I)return;let w=mn();if(!Array.isArray(w))return;let j=w.filter(K=>K.id!==I);if(j.length===w.length)return;Gt(j),f===I&&(f=null);let $=X();if(f){let K=$.find(O=>O.id===f)||null;N(K)}else $.length?N($[0]):N(null);M()},X=(I=z())=>{if(!i)return I;if(i.innerHTML="",!I.length){let w=document.createElement("li");return w.className="text-sm italic text-base-content/60",w.textContent="No saved notes yet.",i.appendChild(w),I}return I.forEach(w=>{let j=document.createElement("li");j.className="flex items-center gap-2";let $=document.createElement("button");$.type="button",$.dataset.noteId=w.id,$.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",$.textContent=w.title||"Untitled note",$.addEventListener("click",()=>{N(w),M(),m()});let K=document.createElement("button");K.type="button",K.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",K.setAttribute("aria-label",`Delete note "${w.title||"Untitled note"}"`),K.textContent="Delete",K.addEventListener("click",O=>{O.stopPropagation(),Z(w.id)}),j.appendChild($),j.appendChild(K),i.appendChild(j)}),M(),I},V=()=>{let I=X();if(!I.length){N(null),M();return}let w=f?I.find(j=>j.id===f):null;N(w||I[0]),M()};n.addEventListener("click",()=>{let I=mn(),w=Array.isArray(I)?[...I]:[],j=typeof e.value=="string"?e.value.trim():"",$=typeof t.value=="string"?t.value:"",K=j||"Untitled note",O=new Date().toISOString();if(f){let x=w.findIndex(P=>P.id===f);if(x>=0)w[x]=ce(B({},w[x]),{title:K,body:$,updatedAt:O});else{let P=Kt(K,$,{updatedAt:O});f=P.id,w.unshift(P)}}else{let x=Kt(K,$);f=x.id,w.unshift(x)}Gt(w);let de=X(),lt=f?de.find(x=>x.id===f):null;N(lt||null),M()}),o.addEventListener("click",()=>{f=null,e.value="",t.value="",M(),m()}),V()}Hu();var Fl="theme",Uu="professional",$i="memoryCue:theme-change",$u="professional",ar=document.getElementById("theme-menu"),Ml="[data-theme-name],[data-theme-option]",ju=new Set(["dark","dracula","synthwave"]);function Ut(e){return typeof e=="string"?e.trim():""}function Bl(e){return e instanceof HTMLElement?Ut(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function qu(e){let t=Ut(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",ju.has(t)))}function rl(e){let t=Ut(e);if(t)try{localStorage.setItem(Fl,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Pl(e){if(!ar)return;let t=Ut(e);ar.querySelectorAll(Ml).forEach(o=>{if(!(o instanceof HTMLElement))return;let i=Bl(o),l=t&&i===t;o.setAttribute("aria-checked",l?"true":"false"),o.classList.toggle("active",l)})}function Vu(e){let t=Ut(e);if(!(typeof window=="undefined"||!t))try{window.dispatchEvent(new CustomEvent($i,{detail:{theme:t}}))}catch(n){if(typeof document!="undefined"&&typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent($i,!0,!0,{theme:t}),window.dispatchEvent(o)}}}function ji(e,{persist:t=!0,notify:n=!0}={}){let o=Ut(e);if(!o)return;Ut(document.documentElement.getAttribute("data-theme"))!==o&&qu(o),t&&rl(o),Pl(o),n&&Vu(o)}function Wu(){if(typeof document!="undefined"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){ji($u,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Fl)||""}catch(o){console.warn("Unable to load theme preference",o)}let n=t||document.documentElement.getAttribute("data-theme")||Uu;n&&ji(n,{persist:!1,notify:!0})}ar==null||ar.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(Ml):null;if(!t)return;e.preventDefault();let n=Bl(t);n&&ji(n,{persist:!0,notify:!0})});typeof window!="undefined"&&window.addEventListener($i,e=>{var n;let t=Ut((n=e==null?void 0:e.detail)==null?void 0:n.theme);t&&Pl(t)});Wu()});export default Yu();
