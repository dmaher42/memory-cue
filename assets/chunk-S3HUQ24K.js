import{a as Co}from"./chunk-RCZ4YZVR.js";function vn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function wn(){let s=vn(),l=s&&s.TimestampTrigger;return typeof l=="function"?l:null}function ve(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!wn()}function Do(){if(typeof window>"u"||!window.location)return $t;try{return new URL($t,window.location.href).href}catch{return $t}}async function Ne(){return ut||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(ut=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Do()),await navigator.serviceWorker.ready}catch(s){return console.warn("Service worker registration failed",s),null}})(),ut))}async function Bt(s,l){if(ve())try{let we=l||await Ne();if(!we)return;let le=[];try{le=await we.getNotifications({tag:s,includeTriggered:!0})}catch{le=await we.getNotifications({tag:s})}for(let b of le)try{b.close()}catch{}}catch{}}function bn(){for(let s of Array.from(Z.values()))try{s.close()}catch{}Z.clear()}function To(){if(hn||typeof window>"u"||typeof window.addEventListener!="function")return;let s=()=>bn();["pagehide","beforeunload"].forEach(l=>{try{window.addEventListener(l,s)}catch{}}),hn=!0}function L(s){if(typeof s=="string"){let l=s.replace(/\s+/g," ").trim();if(l)return l}return $}async function Mo(s={}){let l=e=>e?document.querySelector(e):null,we=e=>e?Array.from(document.querySelectorAll(e)):[],le=l(s.qSel),b=l(s.titleSel),V=l(s.dateSel),j=l(s.timeSel),H=l(s.detailsSel),ee=l(s.prioritySel),k=l(s.categorySel),be=l(s.saveBtnSel),ft=l(s.cancelEditBtnSel),P=l(s.listSel),pt=l(s.googleSignInBtnSel),mt=l(s.googleSignOutBtnSel),yt=l(s.statusSel),C=l(s.syncStatusSel),Sn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."};function gt(e,t){if(!C)return;let n=["online","offline","error"];n.forEach(c=>C.classList.remove(c)),n.includes(e)&&C.classList.add(e),C.dataset.state=e;let o=typeof t=="string"?t:Sn[e]||"";e==="online"||e==="offline"?(C.textContent="",C.dataset.compact="true",o?(C.setAttribute("aria-label",o),C.setAttribute("title",o)):(C.removeAttribute("aria-label"),C.removeAttribute("title"))):(C.textContent=o,C.removeAttribute("data-compact"),o?(C.setAttribute("aria-label",o),C.setAttribute("title",o)):(C.removeAttribute("aria-label"),C.removeAttribute("title")))}let T=l(s.notesSel),En=l(s.saveNotesBtnSel),Ln=l(s.loadNotesBtnSel),Me=l(s.sortSel),ht=we(s.filterBtnsSel),Pt=e=>typeof e=="string"?e.trim().toLowerCase():"",Re=new Map;ht.forEach(e=>{let t=e?.getAttribute("data-filter"),n=Pt(t);n&&!Re.has(n)&&Re.set(n,t)});let Fe=Pt(s.defaultFilter),An=Fe&&Re.get(Fe)||(Fe&&!Re.size?Fe:null),jt=l(s.countTodaySel),Ht=l(s.countWeekSel),Ut=l(s.countOverdueSel),_t=l(s.countTotalSel),qt=l(s.countCompletedSel),$e=l(s.googleUserNameSel),te=l(s.dateFeedbackSel),x=l(s.voiceBtnSel),Cn=l(s.notifBtnSel),Se=l(s.moreBtnSel),Ee=l(s.moreMenuSel),kn=l(s.copyMtlBtnSel),vt=l(s.importFileSel),Dn=l(s.exportBtnSel),Tn=l(s.syncAllBtnSel),ue=l(s.syncUrlInputSel),In=l(s.saveSettingsSel),xn=l(s.testSyncSel),Nn=l(s.openSettingsSel),Oe=l(s.settingsSectionSel),J=l(s.emptyStateSel),Wt=l(s.listWrapperSel),Y=l(s.categoryFilterSel),wt=l(s.categoryOptionsSel),ne=s.variant||"mobile",Vt="mc:lastDefaults";function bt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Vt)||"{}")||{}}catch{return{}}}function Mn(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Vt,JSON.stringify(e))}catch{}}function Jt(e){let t=bt(),n={category:L(e?.category||t.category||$),priority:e?.priority||t.priority||"Medium"};Mn(n)}let zt='fieldset#priorityChips input[name="priority"]';function St(){try{let e=document.querySelector(`${zt}:checked`);if(e&&e.value)return e.value}catch{}return ee&&typeof ee.value=="string"&&ee.value?ee.value:"Medium"}function Be(e){let t=e||"Medium";ee&&typeof ee.value<"u"&&(ee.value=t);try{let n=Array.from(document.querySelectorAll(zt));if(!n.length)return;let o=!1;if(n.forEach(r=>{let c=r.value===t;r.checked=c,o=o||c}),!o){let r=n.find(c=>c.value==="Medium")||n[0];r&&(r.checked=!0)}}catch{}}function Gt(){let e=bt();e.category&&k&&(k.value=e.category),e.priority&&Be(e.priority)}Gt();let N=typeof document<"u"?document.getElementById("quickAddInput"):null,Rn=typeof document<"u"?document.getElementById("quickAddSubmit"):null,M=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,Et=null;function Fn(e,t){let n=Date.now(),o=bt(),r=typeof t=="string"&&t?t:null;return{id:ot(),title:(e||"").trim(),priority:o.priority||St(),category:L(o.category||k?.value||$),notes:"",done:!1,createdAt:n,updatedAt:n,due:r,pendingSync:!R}}async function Lt(){if(!N)return;if(typeof Et=="function")try{Et()}catch{}let e=(N.value||"").trim();if(!e)return;let t=null;try{let o=rt(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=Fn(e,t);y.unshift(n),De=!0,A(),F(),se(n),st(n),ge(n),X(),Jt(n),At();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:y}}))}catch{}z({action:"created",label:`Reminder added \xB7 ${n.title}`}),N.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Lt),Rn?.addEventListener("click",()=>{Lt()}),N?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Lt())});function $n(){if(typeof HTMLElement>"u"||!(M instanceof HTMLElement)||!(N instanceof HTMLInputElement)||M.dataset.voiceBound==="true")return;if(M.dataset.voiceBound="true",typeof window>"u"){M.setAttribute("disabled","true"),M.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){M.setAttribute("disabled","true"),M.setAttribute("aria-disabled","true"),M.getAttribute("title")||(M.title="Voice input is not supported in this browser.");return}let t=null,n=!1,o=f=>{n=f,M.setAttribute("aria-pressed",f?"true":"false"),M.dataset.listening=f?"true":"false",M.classList.toggle("is-listening",f)},r=()=>{if(t)return t;t=new e;let f=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=f,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",u=>{let p=u?.results?.[0]?.[0]?.transcript?.trim()||"";if(p){N.value=p;try{N.focus({preventScroll:!0})}catch{N.focus()}try{let h=N.value.length;typeof N.setSelectionRange=="function"&&N.setSelectionRange(h,h)}catch{}}});let d=()=>{o(!1)};return t.addEventListener("end",d),t.addEventListener("error",d),t},c=()=>{if(!(!n||!t)){try{t.stop()}catch{}o(!1)}};Et=c,M.addEventListener("click",()=>{let f=r();if(f){if(n){c();return}try{f.start(),o(!0)}catch(d){console.warn("Quick add voice error:",d),o(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",c),o(!1)}$n(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&N&&(e.preventDefault(),N.focus())})));try{ne==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Qt=s.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Zt=s.emptyStateFilteredText||"No reminders match the current filter. Adjust your filters or add a new cue.",Pe=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,On=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Bn=s.reminderLandingPath||(ne==="desktop"?"index.html#reminders":"mobile.html"),fe=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Yt(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function At(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:y}}))}catch{}}k&&!k.value&&(k.value=$),ve()&&Ne();function z(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let o=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),o=!0)}catch{o=!1}if(!o){if(typeof window<"u"){let r=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(r.push(n);r.length>20;)r.shift();window.memoryCueActivityQueue=r}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(gn,{detail:n}));else if(document.createEvent){let r=document.createEvent("CustomEvent");r&&r.initCustomEvent&&(r.initCustomEvent(gn,!1,!1,n),document.dispatchEvent(r))}}catch{}}}function Pn(){if(typeof HTMLElement>"u"||!(x instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&b instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&b instanceof HTMLTextAreaElement;if(!e&&!t||x.dataset.voiceBound==="true")return;if(x.dataset.voiceBound="true",typeof window>"u"){x.setAttribute("disabled","true"),x.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){x.setAttribute("disabled","true"),x.setAttribute("aria-disabled","true"),x.getAttribute("title")||(x.title="Voice input is not supported in this browser.");return}let o=null,r=!1,c=p=>{r=p,x.setAttribute("aria-pressed",p?"true":"false"),x.dataset.listening=p?"true":"false",x.classList.toggle("is-listening",p)},f=()=>{if(o)return o;o=new n,o.lang="en-US",o.interimResults=!1,o.maxAlternatives=1,o.addEventListener("result",h=>{let S=h.results?.[0]?.[0]?.transcript?.trim()||"";if(S){b.value=S;try{b.focus({preventScroll:!0})}catch{try{b.focus()}catch{}}try{let E=b.value.length;typeof b.setSelectionRange=="function"&&b.setSelectionRange(E,E)}catch{}z({action:"dictated",label:`Voice input captured \xB7 ${S}`})}});let p=()=>{c(!1)};return o.addEventListener("end",p),o.addEventListener("error",p),o},d=()=>{if(!(!r||!o)){try{o.stop()}catch{}c(!1)}};x.addEventListener("click",()=>{let p=f();if(p){if(r){d();return}try{p.start(),c(!0)}catch(h){console.warn("Speech recognition error:",h),c(!1)}}});let u=()=>{d()};typeof document<"u"&&(document.addEventListener("cue:close",u),document.addEventListener("reminders:updated",u)),c(!1)}To(),Pn();let je,He,Ue,_e,pe,qe,We,Ve,Je,ze,Ge,Le,Ae,Qe,Ze,Ye,Ke,Xe,et,Kt=s.firebaseDeps,Ct=typeof s.importModule=="function"?s.importModule:e=>import(e),Ce=vn(),ke=!1,U=!1,kt=null,G=null,oe=null,y=[],tt=An||"all",ie=Y?.value||"all",Xt="memoryCue:sortPreference",Dt=new Set(["dueDate","priority","category","recent"]),en=new Map([["due","dueDate"]]),_="dueDate",De=!1,R=null,Te=null,Ie=null,re={},I={};if(typeof localStorage<"u")try{let e=localStorage.getItem(Xt),t=en.get(e)||e;t&&Dt.has(t)&&(_=t)}catch{}if(Me&&_)try{Me.value=Dt.has(_)?_:"dueDate"}catch{}function tn(){R=null,gt("offline"),pt?.classList.remove("hidden"),mt?.classList.add("hidden"),$e&&($e.textContent=""),Te?.(),Te=null,It(),A(),F(),X()}function Tt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Ot);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let o=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),r=Number.isFinite(n.updatedAt)?n.updatedAt:o;return{id:typeof n.id=="string"&&n.id?n.id:ot(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:L(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:o,updatedAt:r,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function jn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Ot);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:L(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem(Ot,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function F(){jn(y)}function It(){y=Tt()}It();async function Hn(){if(!R){y=Tt();return}let e=Tt();if(!e.length){y=[],F();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await se(n),n.pendingSync=!1}catch(o){console.warn("Failed to sync offline reminder",o)}y=e.map(n=>({...n,pendingSync:!1})),F(),A(),X()}try{I=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{I={}}I&&typeof I=="object"&&Object.values(I).forEach(e=>{e&&typeof e=="object"&&(e.category=L(e.category))});let nt=e=>{if(!Ce)return;let t=[Ce];Ce.window&&!t.includes(Ce.window)&&t.push(Ce.window);let n=!e;t.forEach(o=>{try{o.__memoryCueFirebaseUnavailable__=n}catch{}})};function Un(){if(!T)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",o="mobileNotesColumns",r=typeof document<"u"&&typeof document.execCommand=="function",c=()=>"value"in T?T.value:T.innerHTML,f=h=>{if("value"in T){T.value=h;return}if(typeof h!="string"||h.length===0){T.innerHTML="";return}let S=h.trim();if(/<\/?[a-z][\s\S]*>/i.test(S)){T.innerHTML=h;return}let O=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");T.innerHTML=O},d=h=>{h?T.classList.add("notes-editor--columns"):T.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!h))},u="";try{u=localStorage.getItem(n)||""}catch{m("Unable to access saved notes")}f(u);let p=!1;try{p=localStorage.getItem(o)==="1"}catch{p=!1}d(p),T.addEventListener("input",()=>{u=c();try{localStorage.setItem(n,u)}catch{m("Notes saved for this session only")}}),En?.addEventListener("click",()=>{u=c();try{localStorage.setItem(n,u),m("Notes saved")}catch{m("Notes saved for this session only")}}),Ln?.addEventListener("click",()=>{let h=u;try{h=localStorage.getItem(n)||u}catch{m("Unable to load saved notes")}u=h,f(u)}),e?.addEventListener("click",h=>{let S=h.target;if(!(S instanceof Element))return;let E=S.closest("button[data-action]");if(!E)return;let O=E.getAttribute("data-action");if(O==="columns"){let ce=!T.classList.contains("notes-editor--columns");d(ce);try{localStorage.setItem(o,ce?"1":"0")}catch{m("Column preference saved for this session only")}return}if(!r){m("Formatting controls are not supported in this browser");return}T.focus(),O==="bullets"?document.execCommand("insertUnorderedList"):O==="numbers"&&document.execCommand("insertOrderedList")})}if(Un(),be?.addEventListener("click",pn),Kt)({initializeApp:je,getFirestore:He,enableMultiTabIndexedDbPersistence:Ue,enableIndexedDbPersistence:_e,doc:pe,setDoc:qe,deleteDoc:We,onSnapshot:Ve,collection:Je,query:ze,orderBy:Ge,serverTimestamp:Le,getAuth:Ae,onAuthStateChanged:Qe,GoogleAuthProvider:Ze,signInWithPopup:Ye,signInWithRedirect:Ke,getRedirectResult:Xe,signOut:et}=Kt),ke=!0;else try{({initializeApp:je}=await Ct("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:He,enableMultiTabIndexedDbPersistence:Ue,enableIndexedDbPersistence:_e,doc:pe,setDoc:qe,deleteDoc:We,onSnapshot:Ve,collection:Je,query:ze,orderBy:Ge,serverTimestamp:Le}=await Ct("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ae,onAuthStateChanged:Qe,GoogleAuthProvider:Ze,signInWithPopup:Ye,signInWithRedirect:Ke,getRedirectResult:Xe,signOut:et}=await Ct("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),ke=!0}catch(e){ke=!1,console.warn("Firebase modules failed to load:",e),m("Firebase failed to load; notes available offline"),nt(!1)}if(ke&&typeof je=="function"&&typeof He=="function"&&typeof Ae=="function")try{kt=je({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),G=He(kt),U=!0,nt(!0)}catch(e){U=!1,console.warn("Firebase initialization failed:",e),m("Firebase failed to load; notes available offline"),nt(!1)}else ke?(U=!1,nt(!1)):U=!1;U&&typeof Ue=="function"&&typeof _e=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ue(G),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await _e(G),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(o){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",o?.code||o)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),U&&typeof Ae=="function"&&(oe=Ae(kt));function _n(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let qn=typeof navigator<"u"&&navigator.language?navigator.language:"",nn=_n(qn),me=nn||"en-US",Q="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Q=e.timeZone),!nn&&e.locale&&(me=e.locale)}catch{}let Wn=new Intl.DateTimeFormat(me,{timeZone:Q,hour:"2-digit",minute:"2-digit"}),Vn=new Intl.DateTimeFormat(me,{timeZone:Q,weekday:"long",day:"numeric",month:"long"}),Jn=new Intl.DateTimeFormat("en-CA",{timeZone:Q,year:"numeric",month:"2-digit",day:"2-digit"}),zn=new Intl.DateTimeFormat(me,{timeZone:Q,weekday:"long"}),Gn=new Intl.DateTimeFormat(me,{timeZone:Q,month:"short",day:"numeric"});function K(e){let t=Jn.formatToParts(e),n=t.find(c=>c.type==="year").value,o=t.find(c=>c.type==="month").value,r=t.find(c=>c.type==="day").value;return`${n}-${o}-${r}`}function on(e,t){let[n,o,r]=e.split("-").map(u=>parseInt(u,10)),[c,f]=t.split(":").map(u=>parseInt(u,10)),d=new Date;return d.setFullYear(n,(o||1)-1,r||1),d.setHours(c||0,f||0,0,0),d.toISOString()}let Qn=new Intl.DateTimeFormat("en-CA",{timeZone:Q,year:"numeric",month:"2-digit",day:"2-digit"}),Zn=new Intl.DateTimeFormat("en-CA",{timeZone:Q,hour:"2-digit",minute:"2-digit",hour12:!1});function Yn(e){try{let t=new Date(e),n=Qn.formatToParts(t),o=n.find(f=>f.type==="year")?.value||"0000",r=n.find(f=>f.type==="month")?.value||"00",c=n.find(f=>f.type==="day")?.value||"00";return`${o}-${r}-${c}`}catch{return""}}function Kn(e){try{let t=new Date(e),n=Zn.formatToParts(t),o=n.find(c=>c.type==="hour")?.value?.padStart(2,"0")||"00",r=n.find(c=>c.type==="minute")?.value?.padStart(2,"0")||"00";return`${o}:${r}`}catch{return""}}function ot(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function it(){return K(new Date)}function rn(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Xn(e){let t=rn(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function ye(e){return e==="High"?3:e==="Medium"?2:1}function xo(e,t){let n=ye(t.priority)-ye(e.priority);if(n)return n;let o=+new Date(e.due||0),r=+new Date(t.due||0);return o!==r?o-r:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function xt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Vn.format(t)}catch{return e}}function Nt(e){return Wn.format(e)}function ae(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function an(e){return e?ae(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function m(e){yt&&(yt.textContent=e,clearTimeout(m._t),m._t=setTimeout(()=>yt.textContent="",2500))}function sn(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}function rt(e){e=String(e||"").toLowerCase();let t={date:it(),time:""},n=d=>{let u=new Date,p=u.getDay(),h=(d-p+7)%7,S=new Date(u);return S.setDate(u.getDate()+(h===0?7:h)),S},o=d=>{let u=new Date,p=u.getDay(),h=(d-p+7)%7,S=new Date(u);return S.setDate(u.getDate()+h),S},r={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},c={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let d=new Date;d.setDate(d.getDate()+1),t.date=K(d)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let d=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[d[1]],p=n(u);t.date=K(p)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let d=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[d[1]],p=o(u);t.date=K(p)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let d=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[d[1]],p=n(u);t.date=K(p)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let d=e.match(/\bin\s+(\d+)\s+days?\b/),u=parseInt(d[1],10),p=new Date;p.setDate(p.getDate()+u),t.date=K(p)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let d=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),u=parseInt(d[1],10),p=parseInt(d[2],10)-1,h=d[3]?parseInt(d[3],10):new Date().getFullYear(),S=new Date(h,p,u);t.date=K(S)}else for(let[d,u]of Object.entries(c)){let p=new RegExp(`\\b${d}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(p.test(e)){let h=e.match(p),S=parseInt(h[1],10),E=new Date().getFullYear(),O=new Date(E,u,S);t.date=K(O);break}}let f=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(f){let d=parseInt(f[1],10),u=f[2]?parseInt(f[2],10):0,p=f[3];p&&(p==="pm"&&d<12&&(d+=12),p==="am"&&d===12&&(d=0)),t.time=`${String(d).padStart(2,"0")}:${String(u).padStart(2,"0")}`}return t}let at=U&&oe&&typeof Ze=="function";pt?.addEventListener("click",async()=>{if(!at||typeof Ye!="function"||typeof Ke!="function"){m("Sign-in unavailable offline");return}let e=new Ze;try{await Ye(oe,e)}catch{try{await Ke(oe,e)}catch{m("Google sign-in failed")}}}),at&&typeof Xe=="function"&&Xe(oe).catch(()=>{}),mt?.addEventListener("click",async()=>{if(!at||typeof et!="function"){m("Sign-out unavailable offline");return}try{await et(oe),m("Signed out")}catch{m("Sign-out failed")}}),at&&typeof Qe=="function"?Qe(oe,async e=>{e?(R=e.uid,gt("online"),pt?.classList.add("hidden"),mt?.classList.remove("hidden"),$e&&($e.textContent=e.displayName||e.email||""),eo(),await Hn()):tn()}):tn();function eo(){if(!U||!G||typeof Je!="function"||typeof ze!="function"||typeof Ge!="function"||typeof Ve!="function")return;if(!R){It(),A(),F(),X();return}Te&&Te();let e=Je(G,"users",R,"reminders"),t=ze(e,Ge("updatedAt","desc"));Te=Ve(t,n=>{let o=[];n.forEach(r=>{let c=r.data();o.push({id:r.id,title:c.title,priority:c.priority,notes:c.notes||"",done:!!c.done,due:c.due||null,category:L(c.category),createdAt:c.createdAt?.toMillis?.()||0,updatedAt:c.updatedAt?.toMillis?.()||0,pendingSync:!1})}),y=o,A(),F(),X()},n=>{console.error("Firestore sync error:",n),C&&gt("error","Sync Error")})}async function se(e){if(!(!U||!R||!G||typeof pe!="function"||typeof qe!="function"||typeof Le!="function"))try{await qe(pe(G,"users",R,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||$,createdAt:e.createdAt?new Date(e.createdAt):Le(),updatedAt:Le()},{merge:!0})}catch(t){console.error("Save failed:",t),m("Save queued (offline)")}}async function to(e){if(!(!U||!R||!G||typeof pe!="function"||typeof We!="function"))try{await We(pe(G,"users",R,"reminders",e))}catch{m("Delete queued (offline)")}}async function st(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||$,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function xe(){b&&(b.value=""),V&&(V.value=""),j&&(j.value=""),H&&(H.value=""),Be("Medium"),k&&(k.value=$),Gt(),Ie=null,be&&(be.textContent="Save Cue"),ft?.classList.add("hidden")}function cn(e){let t=y.find(n=>n.id===e);t&&(b&&(b.value=t.title||""),V&&j&&(t.due?(V.value=Yn(t.due),j.value=Kn(t.due)):(V.value="",j.value="")),Be(t?.priority||"Medium"),k&&(k.value=L(t.category)),H&&(H.value=typeof t.notes=="string"?t.notes:""),Ie=e,be&&(be.textContent="Update Cue"),ft?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),b?.focus(),fe("cue:open",{mode:"edit"}))}function no(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),o=L(e.category??(k?k.value:"")),r={id:ot(),title:e.title.trim(),priority:e.priority||"Medium",category:o,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!R};return y=[r,...y],De=!0,A(),F(),Jt(r),se(r),st(r),ge(r),At(),fe("memoryCue:remindersUpdated",{items:y}),Yt(),z({action:"created",label:`Reminder added \xB7 ${r.title}`}),r}function oo(e,t){if(!R)return m("Sign in to add notes"),null;if(!e)return null;let n=y.find(f=>f.id===e);if(!n)return null;let r=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!r)return n;let c=typeof n.notes=="string"?n.notes:"";return n.notes=c?`${c}
${r}`:r,n.updatedAt=Date.now(),se(n),A(),F(),z({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function dn(e){let t=y.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),se(t),st(t),A(),F(),t.done?(dt(e),z({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(ge(t),z({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function ln(e){let t=y.find(n=>n.id===e);y=y.filter(n=>n.id!==e),A(),F(),to(e),dt(e),z(t?{action:"deleted",label:`Reminder removed \xB7 ${t.title}`}:{action:"deleted",label:"Reminder removed"})}function Mt(){localStorage.setItem("scheduledReminders",JSON.stringify(I))}function ct(e,{closeNotification:t=!0}={}){if(t){let n=Z.get(e);if(n){try{n.close()}catch{}Z.delete(e)}}re[e]&&(clearTimeout(re[e]),delete re[e]),Bt(e),I[e]&&(delete I[e],Mt())}function dt(e){ct(e)}function un(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Z.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:"Due now",tag:e.id});Z.set(e.id,n);let o=()=>{Z.get(e.id)===n&&Z.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",o),n.addEventListener("click",o)),n.onclose=o,n.onclick=o}catch{}}async function io(e){if(!ve())return!1;let t=wn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let o=await Ne();if(!o)return!1;await Bt(e.id,o);let r={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||$,urlPath:Bn},c=typeof e.notes=="string"&&e.notes.split(/\r?\n/).find(u=>u.trim())||"",f=c||"Due now";try{let u=new Date(e.due);if(!Number.isNaN(u.getTime())){let p=Nt(u);p&&(f=c?`${c} \u2022 ${p}`:`Due ${p}`)}}catch{}let d={body:f,tag:e.id,data:r,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await o.showNotification(e.title,d),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function ge(e){if(!e||!e.id)return;if(e.category=L(e.category),!e.due||e.done){dt(e.id);return}let t={id:e.id,title:e.title,due:e.due,category:e.category||$};if(I[e.id]=t,Mt(),re[e.id]&&(clearTimeout(re[e.id]),delete re[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return;let o=n-Date.now();if(o<=0){if(I[e.id]?.viaTrigger){ct(e.id,{closeNotification:!1});return}un(e),ct(e.id,{closeNotification:!1});return}let r=ve();r&&(t.viaTrigger=!1,io(e).then(c=>{c&&I[e.id]&&(I[e.id]={...I[e.id],viaTrigger:!0},Mt())})),re[e.id]=setTimeout(()=>{r&&Bt(e.id),un(e),ct(e.id,{closeNotification:!1})},o)}function X(){Object.values(I).forEach(e=>ge({...e,category:L(e?.category)}))}let fn={High:"bg-rose-400/80 dark:bg-rose-300/80",Medium:"bg-amber-400/80 dark:bg-amber-300/80",Low:"bg-emerald-400/80 dark:bg-emerald-300/80"};function ro(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=zn.format(t),o=Gn.format(t),r=Nt(t);return`${n}, ${o}${r?` at ${r}`:""}`}catch{return"No due date"}}function A(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let o=new Date(t);o.setHours(23,59,59,999);let r=rn(t),c=Xn(t),f=y.filter(i=>{if(!i.due||i.done)return!1;let a=new Date(i.due);return a>=n&&a<=o}),d=y.filter(i=>{if(!i.due||i.done)return!1;let a=new Date(i.due);return a>=r&&a<=c}),u=y.filter(i=>i.done||!i.due?!1:new Date(i.due)<t).length,p=y.filter(i=>i.done).length;jt&&(jt.textContent=String(f.length)),Ht&&(Ht.textContent=String(d.length)),Ut&&(Ut.textContent=String(u)),_t&&(_t.textContent=String(y.length)),qt&&(qt.textContent=String(p)),y.forEach(i=>{i&&typeof i=="object"&&(i.category=L(i.category))});let h=new Set(ko.map(i=>L(i)));y.forEach(i=>{i&&typeof i=="object"&&h.add(L(i.category))});let S=Array.from(h).sort((i,a)=>i.localeCompare(a,void 0,{sensitivity:"base"}));if(Y){let i=ie;Y.replaceChildren();let a=document.createElement("option");a.value="all",a.textContent="All categories",Y.appendChild(a),S.forEach(g=>{let v=document.createElement("option");v.value=g,v.textContent=g,Y.appendChild(v)}),i!=="all"&&!S.includes(i)&&(ie="all"),Y.value=ie}if(wt){let i=new Set;Array.from(wt.querySelectorAll("option")).forEach(a=>{i.add(a.value.trim().toLowerCase())}),S.forEach(a=>{let g=a.toLowerCase();if(!i.has(g)){let v=document.createElement("option");v.value=a,wt.appendChild(v),i.add(g)}})}if(De)De=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let i=y.map(a=>({...a}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:i}}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:i}),document.dispatchEvent(a))}}catch{}}let E=y.slice(),O=le?.value.trim().toLowerCase()||"";O&&(E=E.filter(i=>i.title.toLowerCase().includes(O)||(i.notes||"").toLowerCase().includes(O)||(i.category||"").toLowerCase().includes(O))),ie&&ie!=="all"&&(E=E.filter(i=>L(i.category)===ie)),E=E.filter(i=>tt==="done"?i.done:tt==="overdue"?!i.done&&i.due&&new Date(i.due)<t:!0);let ce=(i,a)=>{let g=i.done?1:0,v=a.done?1:0;if(g!==v)return g-v;let B=i.due?new Date(i.due).getTime():1/0,de=a.due?new Date(a.due).getTime():1/0;if(B!==de)return B-de;let w=ye(a.priority)-ye(i.priority);return w||(a.updatedAt||0)-(i.updatedAt||0)},co=(i,a)=>{let g=ye(a.priority)-ye(i.priority);return g||ce(i,a)},lo=(i,a)=>{let g=L(i.category||""),v=L(a.category||""),B=g.localeCompare(v,void 0,{sensitivity:"base"});return B||ce(i,a)},uo=(i,a)=>{let g=(a.createdAt||0)-(i.createdAt||0);return g||(a.updatedAt||0)-(i.updatedAt||0)},fo=_==="dueDate",po={dueDate:ce,priority:co,category:lo,recent:uo}[_]||ce;E.sort(po),ht.forEach(i=>{let a=i.getAttribute("data-filter")===tt;i.classList.toggle("active",a),i.setAttribute("aria-pressed",String(a)),i.classList.contains("btn-ghost")||(i.classList.toggle("bg-gray-900",a),i.classList.toggle("text-white",a),i.classList.toggle("border-gray-900",a),i.classList.toggle("dark:bg-gray-100",a),i.classList.toggle("dark:text-gray-900",a),i.classList.toggle("dark:border-gray-100",a),i.classList.toggle("bg-white",!a),i.classList.toggle("text-gray-600",!a),i.classList.toggle("border-gray-200",!a),i.classList.toggle("dark:bg-gray-800",!a),i.classList.toggle("dark:text-gray-400",!a),i.classList.toggle("dark:border-gray-700",!a))});let mo=y.length>0,Rt=E.length>0;if(J&&(mo?Rt?J.classList.add("hidden"):(Pe?Pe(J,{icon:"sparkles",title:"No reminders match this view",description:Zt}):J.textContent=Zt,J.classList.remove("hidden")):(Pe?Pe(J,{icon:"bell",title:"Create your first cue",description:Qt,action:`<button type="button" class="${On}" data-trigger="open-cue">Create reminder</button>`}):J.textContent=Qt,J.classList.remove("hidden"))),Wt&&Wt.classList.toggle("has-items",Rt),!P)return;if(!Rt){J?(P.innerHTML="",P.classList.add("hidden")):(P.innerHTML='<div class="text-muted">No reminders found.</div>',P.classList.remove("hidden"));return}P.classList.remove("hidden"),P.replaceChildren();let he=document.createDocumentFragment(),Ft=P.tagName==="UL"||P.tagName==="OL",yo=!0,mn=(i,a)=>{let g=document.createElement("div");g.className="task-item"+(i.done?" completed":"");let v={id:i.id,title:i.title,dueIso:i.due||null,priority:i.priority||"Medium",category:a,done:!!i.done};g.dataset.category=a,g.dataset.reminder=JSON.stringify(v),g.dataset.id=v.id,g.dataset.title=v.title,g.dataset.priority=v.priority,g.dataset.done=String(v.done),v.dueIso&&(g.dataset.due=v.dueIso);let B=v.dueIso?new Date(v.dueIso):null;fo&&B&&B>=n&&B<=o&&(g.classList.add("is-today"),g.dataset.today="true");let w=i.due?`${Nt(new Date(i.due))} \u2022 ${xt(i.due.slice(0,10))}`:"No due date",D=`priority-${(i.priority||"Medium").toLowerCase()}`,W=i.notes?`<div class="task-notes">${an(i.notes)}</div>`:"";return g.innerHTML=`
        <input type="checkbox" ${i.done?"checked":""} aria-label="Mark complete" />
        <div class="task-content">
          <div class="task-title"><strong>${ae(i.title)}</strong></div>
          <div class="task-meta">
            <div class="task-meta-row" style="gap:8px; flex-wrap:wrap;">
              <span>${w}</span>
              <span class="priority-badge ${D}">${i.priority}</span>
              <span class="priority-badge" style="background:rgba(56,189,248,.14);color:#0284c7;border-color:rgba(56,189,248,.26);">${ae(a)}</span>
            </div>
          </div>
          ${W}
        </div>
        <div class="task-actions">
          <button class="btn-ghost" data-edit type="button">Edit</button>
          <button class="btn-ghost" data-del type="button">Del</button>
        </div>`,g.querySelector("input").addEventListener("change",()=>dn(i.id)),g.querySelector("[data-edit]").addEventListener("click",()=>cn(i.id)),g.querySelector("[data-del]").addEventListener("click",()=>ln(i.id)),g};if(ne!=="desktop"&&!yo){E.forEach(i=>{let a=i.category||$;he.appendChild(mn(i,a))}),P.appendChild(he);return}let lt=new Map;E.forEach(i=>{let a=i.category||$;lt.has(a)||lt.set(a,[]),lt.get(a).push(i)});let go=Array.from(lt.entries()).sort((i,a)=>i[0].localeCompare(a[0],void 0,{sensitivity:"base"})),yn=!0;go.forEach(([i,a])=>{let g=document.createElement(Ft?"li":"div");g.dataset.categoryHeading=i,Ft&&(g.setAttribute("role","presentation"),g.style.listStyle="none"),g.className=ne==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",yn||(g.style.marginTop=ne==="desktop"?"1.25rem":"1rem");let v=document.createElement("div");v.setAttribute("role","heading"),v.setAttribute("aria-level","3"),v.className=ne==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let B=document.createElement("span");B.textContent=i;let de=document.createElement("span");de.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",de.textContent=`${a.length} ${a.length===1?"item":"items"}`,v.append(B,de),g.appendChild(v),he.appendChild(g),a.forEach(w=>{if(ne==="desktop"){let D=document.createElement(Ft?"li":"div"),W={id:w.id,title:w.title,dueIso:w.due||null,priority:w.priority||"Medium",category:i,done:!!w.done};D.dataset.id=W.id,D.dataset.category=W.category,D.dataset.title=W.title,D.dataset.priority=W.priority,D.dataset.done=String(W.done),W.dueIso&&(D.dataset.due=W.dueIso),D.dataset.reminder=JSON.stringify(W),D.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let ho=ro(w),vo=fn[w.priority]||fn.Medium,wo=w.done?"line-through text-base-content/50":"text-base-content",bo=w.done?"Completed":"Active",So=w.priority==="High"?"badge badge-outline border-error text-error":w.priority==="Medium"?"badge badge-outline border-warning text-warning":"badge badge-outline border-success text-success",Eo=w.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Lo=w.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Ao=w.notes?`<p class="text-sm leading-relaxed text-base-content/70">${an(w.notes)}</p>`:"";D.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${wo}">${ae(w.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ae(ho)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ae(i)}
            </span>
            <span class="${So} gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full ${vo}"></span>
              ${ae(w.priority)} priority
            </span>
            <span class="${Eo} text-[0.7rem] sm:text-xs">${bo}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Ao}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Lo}">${w.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,D.querySelector('[data-action="toggle"]').addEventListener("click",()=>dn(w.id)),D.querySelector('[data-action="edit"]').addEventListener("click",()=>cn(w.id)),D.querySelector('[data-action="delete"]').addEventListener("click",()=>ln(w.id)),he.appendChild(D);return}he.appendChild(mn(w,i))}),yn=!1}),P.appendChild(he)}function q(){Se?.setAttribute("aria-expanded","false"),Ee?.classList.add("hidden")}function ao(){Se?.setAttribute("aria-expanded","true"),Ee?.classList.remove("hidden")}Se?.addEventListener("click",e=>{e.stopPropagation(),Se.getAttribute("aria-expanded")==="true"?q():ao()}),document.addEventListener("click",e=>{Ee&&!Ee.classList.contains("hidden")&&!Ee.contains(e.target)&&e.target!==Se&&q()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&q()}),Nn?.addEventListener("click",()=>{let e=Oe?.classList.contains("hidden");Oe?.classList.toggle("hidden"),e&&Oe?.scrollIntoView({behavior:"smooth",block:"start"}),q()}),document.addEventListener("DOMContentLoaded",()=>{Oe?.classList.add("hidden")});function pn(){try{console.log("handleSaveAction invoked",{editingId:Ie,title:b?.value})}catch{}if(Ie){let o=y.find(d=>d.id===Ie);if(!o){xe();return}let r=b.value.trim();if(!r){m("Add a reminder title");return}let c=null;if(V.value||j.value){let d=V.value||it(),u=j.value||"09:00";c=on(d,u)}else{let d=rt(r);d.time&&(c=new Date(`${d.date}T${d.time}:00`).toISOString())}o.title=r;let f=St();o.priority=f,Be(f),k&&(o.category=L(k.value)),o.due=c,H&&(o.notes=H.value.trim()),o.updatedAt=Date.now(),se(o),st(o),De=!0,A(),ge(o),F(),At(),fe("memoryCue:remindersUpdated",{items:y}),Yt(),z({action:"updated",label:`Reminder updated \xB7 ${o.title}`}),xe(),m("Reminder updated"),fe("cue:close",{reason:"updated"});return}let e=b.value.trim();if(!e){m("Add a reminder title");return}let t=H?H.value.trim():"",n=null;if(V.value||j.value){let o=V.value||it(),r=j.value||"09:00";n=on(o,r)}else{let o=rt(e);o.time&&(n=new Date(`${o.date}T${o.time}:00`).toISOString())}no({title:e,priority:St(),category:k?k.value:"",due:n,notes:t}),b.value="",j.value="",H&&(H.value=""),fe("cue:close",{reason:"created"})}b?.addEventListener("keydown",e=>{e.key==="Enter"&&pn()});function so(){if(!b||!te)return;let e=b.value.trim();if(!e){te.style.display="none";return}try{let t=rt(e),n=it();if(t.date!==n||t.time){let o="";if(t.date!==n){let r=new Date(t.date+"T00:00:00");o+=`\u{1F4C5} ${xt(t.date)}`}t.time&&(o+=`${o?" ":""}\u{1F550} ${t.time}`),o?(te.textContent=`Parsed: ${o}`,te.style.display="block"):te.style.display="none"}else te.style.display="none"}catch{te.style.display="none"}}return b?.addEventListener("input",sn(so,300)),ft?.addEventListener("click",()=>{xe(),m("Edit cancelled"),fe("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{xe()}),document.addEventListener("cue:prepare",()=>{xe()}),window.addEventListener("load",()=>b?.focus()),le?.addEventListener("input",sn(A,150)),Me?.addEventListener("change",()=>{let e=Me.value;if(_=en.get(e)||e||"dueDate",Dt.has(_)||(_="dueDate"),typeof localStorage<"u")try{localStorage.setItem(Xt,_)}catch{}A()}),Y?.addEventListener("change",()=>{ie=Y.value||"all",A()}),ht.forEach(e=>e.addEventListener("click",()=>{tt=e.getAttribute("data-filter"),A()})),kn?.addEventListener("click",()=>{let e=y.filter(t=>!t.done).map(t=>{let n=t.due?xt(t.due.slice(0,10)):"",o=t.due?new Date(t.due).toLocaleTimeString(me,{hour:"2-digit",minute:"2-digit",timeZone:Q}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${o}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){m("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>m("Copied for Master Task List")).catch(()=>m("Copy failed")),q()}),vt?.addEventListener("change",()=>{let e=vt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(o=>{o.id=ot(),o.category=L(o.category),o.pendingSync=!R,y=[o,...y],se(o)}),A(),F(),m("Import successful")}catch{m("Invalid JSON")}},t.readAsText(e),vt.value="",q()}),Dn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),q()}),Tn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){m("Add your Apps Script URL in Settings first"),q();return}if(!y.length){m("No tasks to sync"),q();return}m("Syncing all tasks\u2026");let t=20,n=0;for(let o=0;o<y.length;o+=t){let r=y.slice(o,o+t),c=await Promise.allSettled(r.map(f=>{let d={id:f.id,title:f.title,dueIso:f.due||null,priority:f.priority||"Medium",category:f.category||$,done:!!f.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})}));n+=c.filter(f=>f.status==="rejected").length,await new Promise(f=>setTimeout(f,400))}m(`Sync complete: ${y.length-n} ok${n?`, ${n} failed`:""}`),q()}),ue&&(ue.value=localStorage.getItem("syncUrl")||""),In?.addEventListener("click",()=>{ue&&(localStorage.setItem("syncUrl",ue.value.trim()),m("Settings saved"))}),xn?.addEventListener("click",async()=>{if(!ue)return;let e=ue.value.trim();if(!e){m("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});m(t.ok?"Test ok":"Test failed")}catch{m("Test failed")}}),Cn?.addEventListener("click",async()=>{if(!("Notification"in window)){m("Notifications not supported");return}if(Notification.permission==="granted"){m("Notifications enabled"),ve()&&Ne(),X();return}try{await Notification.requestPermission()==="granted"?(m("Notifications enabled"),ve()&&Ne(),X()):m("Notifications blocked")}catch{m("Notifications blocked")}}),X(),A(),F(),{cancelReminder:dt,scheduleReminder:ge,closeActiveNotifications:bn,getActiveNotifications:()=>Z,addNoteToReminder:oo,__testing:{setItems(e=[]){y=Array.isArray(e)?e.map(t=>({...t,category:L(t?.category)})):[],A()},render:A,getItems:()=>y.map(e=>({...e}))}}}var gn,Z,hn,$t,ut,$,ko,Ot,Io=Co(()=>{gn="memoryCue:activity",Z=new Map,hn=!1,$t="service-worker.js",ut=null,$="General",ko=Object.freeze([$,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Ot="memoryCue:offlineReminders"});export{Mo as a,Io as b};
