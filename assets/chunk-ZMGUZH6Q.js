import{b as kt,c as nr}from"./chunk-KX65DZXT.js";import{a as Rn,b as On,c as tr}from"./chunk-GUVSRPRW.js";function _n(r={}){try{Object.assign(R,r||{})}catch(a){console.warn("[supabase-auth] setAuthContext failed",a)}}async function Pn(r={}){try{if(R&&typeof R.signInWithPopup=="function"&&R.auth&&typeof R.GoogleAuthProvider=="function")return R.signInWithPopup(R.auth,new R.GoogleAuthProvider);if(R&&typeof R.signInWithRedirect=="function"&&R.auth&&typeof R.GoogleAuthProvider=="function")return R.signInWithRedirect(R.auth,new R.GoogleAuthProvider);let a=kt();if(a&&a.auth){if(typeof a.auth.signInWithOAuth=="function")return a.auth.signInWithOAuth({provider:"google",...r});if(typeof a.auth.signIn=="function")return a.auth.signIn({provider:"google"})}}catch(a){console.error("[supabase-auth] startSignInFlow error",a);try{R?.toast?.("Sign-in failed")}catch(d){console.warn("[supabase-auth] toast handler failed",d)}throw a}return Promise.resolve(null)}async function $n(){try{if(R&&typeof R.signOut=="function")return R.signOut(R.auth);let r=kt();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function rr(r){return r?Array.isArray(r)?r:[r]:[]}function Ze(r){return Array.from(new Set(r.filter(a=>a instanceof HTMLElement||typeof SVGElement<"u"&&a instanceof SVGElement)))}function ne(r,a){let d=rr(a).filter(Boolean);if(!d.length)return[];let y=d.flatMap(A=>Array.from(r.querySelectorAll(A)));return Ze(y)}function or(r,a=document){let d=a instanceof Document||a instanceof HTMLElement?a:document;return{authForms:ne(d,r.authForm),emailInputs:ne(d,r.emailInput),signInButtons:ne(d,r.signInButtons),signOutButtons:ne(d,r.signOutButtons),userBadges:ne(d,r.userBadge),userBadgeEmails:ne(d,r.userBadgeEmail),userBadgeInitials:ne(d,r.userBadgeInitial),userNameEls:ne(d,r.userName),syncStatusEls:ne(d,r.syncStatus),syncStatusTextEls:ne(d,r.syncStatusText),statusIndicatorEls:ne(d,r.statusIndicator),feedbackEls:ne(d,r.feedback)}}function Xe(r,a){Ze(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.classList.toggle("hidden",!a),a?d.removeAttribute("hidden"):d.setAttribute("hidden",""))})}function we(r,a){Ze(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.textContent=a||"")})}function ar(r,a){Ze(r).forEach(d=>{d instanceof HTMLElement&&(d.dataset.state=a,d.classList.toggle("online",a==="online"),d.classList.toggle("offline",a!=="online"))})}function Qe(r,a){Ze(r).forEach(d=>{if(!(d instanceof HTMLElement))return;d.textContent=a||"";let y=!!a;d.classList.toggle("hidden",!y),y?d.removeAttribute("hidden"):d.setAttribute("hidden","")})}function Un(r={}){let a={...Mn.syncStatusText,...r.syncStatusText||{}};return{...Mn,...r,syncStatusText:a}}function Je(r,{user:a,messages:d}={}){let y=Un(d),A=!!a;Xe(r.signInButtons,!A),Xe(r.authForms,!A),Xe(r.signOutButtons,A),Xe(r.userBadges,A);let D=typeof a?.email=="string"?a.email:"",N=D?D.charAt(0).toUpperCase():"U";A?(we(r.userBadgeEmails,D),we(r.userBadgeInitials,N),we(r.userNameEls,D)):(we(r.userBadgeEmails,""),we(r.userBadgeInitials,""),we(r.userNameEls,""));let G=typeof y.signedIn=="function"?y.signedIn(a):y.signedIn,C=typeof y.signedOut=="function"?y.signedOut(a):y.signedOut,V=A?G:C;r.syncStatusEls.length&&(Xe(r.syncStatusEls,!0),we(r.syncStatusEls,V),r.syncStatusEls.forEach(S=>{S instanceof HTMLElement&&(S.classList.toggle("online",A),S.dataset.state=A?"online":"offline")}));let Q=A?y.syncStatusText?.signedIn:y.syncStatusText?.signedOut;we(r.syncStatusTextEls,Q||""),ar(r.statusIndicatorEls,A?"online":"offline"),Qe(r.feedbackEls,"")}function sr(r,a){a.authForms.forEach(d=>{!(d instanceof HTMLFormElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("submit",async y=>{y.preventDefault();let A=a.emailInputs.find(N=>d.contains(N))||d.querySelector('input[type="email"]'),D=typeof A?.value=="string"?A.value.trim():"";if(!D){Qe(a.feedbackEls,"Enter an email address to continue.");return}try{let{error:N}=await r.auth.signInWithOtp({email:D});N?Qe(a.feedbackEls,N.message||"Unable to send magic link."):Qe(a.feedbackEls,"Magic link sent. Check your email.")}catch(N){Qe(a.feedbackEls,N?.message||"Unable to send magic link.")}}))})}function dr(r,a){a.signOutButtons.forEach(d=>{!(d instanceof HTMLElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(y){console.error("[supabase] Sign-out failed.",y)}}))})}function vr(r={}){let{supabase:a,scope:d=document,selectors:y={},messages:A={},disableButtonBinding:D=!1,onSessionChange:N}=r,G={...ir,...y},C=or(G,d),V=Un(A);Je(C,{user:null,messages:V});let Q=a||kt()||(typeof window<"u"?window.supabase:null);if(!Q)return{supabase:null,elements:C,applyAuthState:j=>Je(C,{...j,messages:V}),destroy(){}};sr(Q,C),D||dr(Q,C);let S=[],{data:Ee}=Q.auth.onAuthStateChange((j,k)=>{if(Je(C,{user:k?.user??null,messages:V}),typeof N=="function")try{N(k?.user??null,k)}catch(O){console.error("[supabase] onSessionChange handler failed.",O)}});return Ee?.subscription&&S.push(()=>{try{Ee.subscription.unsubscribe()}catch{}}),Q.auth.getSession().then(({data:j,error:k})=>{k||Je(C,{user:j?.session?.user??null,messages:V})}).catch(j=>{console.error("[supabase] getSession failed.",j)}),{supabase:Q,elements:C,applyAuthState:j=>Je(C,{...j,messages:V}),destroy(){S.forEach(j=>{try{j()}catch{}})}}}var R,ir,Mn,jn=On(()=>{nr();R={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};ir={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},Mn={signedOut:"Sign in to sync reminders across devices.",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Yn=tr((Sr,et)=>{var Ft=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Hn(r){if(!r||typeof r!="object")return null;let a=Object.entries(r).filter(([d,y])=>typeof y=="string"&&y.trim()!=="");return a.length?Object.fromEntries(a):null}function cr(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},a=Hn(r?.__FIREBASE_CONFIG);if(a)return a;let d=Hn(r?.__ENV?.FIREBASE_CONFIG);if(d)return d;let A=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((D,[N,G])=>{let C=r?.__ENV?.[N]??r?.[N];return typeof C=="string"&&C.trim()!==""&&(D[G]=C),D},{});return Object.keys(A).length?A:null}function qn(){let r=cr();return r?{...Ft,...r}:{...Ft}}var Wn={DEFAULT_FIREBASE_CONFIG:Ft,getFirebaseConfig:qn};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=qn,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Ft}typeof et<"u"&&et.exports&&(et.exports=Wn,et.exports.default=Wn)});function fr(){if(de)return{...de};let a=an()?.memoryCueFirebase;if(a&&typeof a.getFirebaseConfig=="function")return de=a.getFirebaseConfig(),{...de};if(typeof Rn=="function")try{let d=Yn();if(d){let y=typeof d.getFirebaseConfig=="function"?d.getFirebaseConfig:typeof d.default?.getFirebaseConfig=="function"?d.default.getFirebaseConfig:null;if(y)return de=y(),{...de}}}catch{}return a&&a.DEFAULT_FIREBASE_CONFIG?(de={...a.DEFAULT_FIREBASE_CONFIG},{...de}):(de={...lr},{...de})}function an(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Xn(){let r=an(),a=r&&r.TimestampTrigger;return typeof a=="function"?a:null}function fe(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Xn()}function pr(){if(typeof window>"u"||!window.location)return Zt;try{return new URL(Zt,window.location.href).href}catch{return Zt}}async function Se(){return Nt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Nt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(pr()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),Nt))}async function Kn(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let a=await Se();if(!a)return!1;let d=new Set;navigator.serviceWorker.controller&&d.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(A=>{let D=a[A];D&&d.add(D)});let y=!1;return d.forEach(A=>{try{A.postMessage(r),y=!0}catch(D){console.warn("Failed posting message to service worker",D)}}),y}catch(a){return console.warn("Unable to reach service worker",a),!1}}async function Bt(){if(fe())return!1;if(tn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(tt)try{return await tt}catch{}tt=(async()=>{let r=await Se();if(!r)return!1;let a=!1;if("periodicSync"in r)try{let d=await r.periodicSync.getTags();(!Array.isArray(d)||!d.includes(en))&&await r.periodicSync.register(en,{minInterval:15*60*1e3}),a=!0}catch(d){console.warn("Periodic background sync unavailable",d)}if(!a&&"sync"in r)try{await r.sync.register(en),a=!0}catch(d){console.warn("Background sync unavailable",d)}return a})();try{let r=await tt;return r&&(tn=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),tn=!1,!1}finally{tt=null}}async function rn(r=[],{requestCheck:a=!1}={}){if(!fe()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let d=await Se();if(!d)return;let y=await Kn({type:zn.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(a&&await Kn({type:zn.checkScheduledReminders}),!y&&typeof d.update=="function")try{await d.update()}catch{}}catch(d){console.warn("Failed syncing reminders with service worker",d)}}async function on(r,a){if(fe())try{let d=a||await Se();if(!d)return;let y=[];try{y=await d.getNotifications({tag:r,includeTriggered:!0})}catch{y=await d.getNotifications({tag:r})}for(let A of y)try{A.close()}catch{}}catch{}}function Jn(){for(let r of Array.from(le.values()))try{r.close()}catch{}le.clear()}function gr(){if(Vn||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>Jn();["pagehide","beforeunload"].forEach(a=>{try{window.addEventListener(a,r)}catch{}}),Vn=!0}function $(r){if(typeof r=="string"){let a=r.replace(/\s+/g," ").trim();if(a)return a}return U}async function Ir(r={}){let a=e=>e?document.querySelector(e):null,d=e=>e?Array.from(document.querySelectorAll(e)):[],y=a(r.titleSel),A=a(r.dateSel),D=a(r.timeSel),N=a(r.detailsSel),G=a(r.prioritySel),C=a(r.categorySel),V=a(r.saveBtnSel),Q=a(r.cancelEditBtnSel),S=a(r.listSel),Ee=d(r.googleSignInBtnSel),j=d(r.googleSignOutBtnSel),k=a(r.statusSel),O=a(r.syncStatusSel),Qn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Zn=6e3,Z=null;function xe(e,{clearMessage:t=!0}={}){Z&&(e&&Z.tokenId!==e||(Z.timeoutId&&clearTimeout(Z.timeoutId),t&&k&&k.dataset.undoToken===Z.tokenId&&(typeof k.replaceChildren=="function"?k.replaceChildren():k.textContent="",delete k.dataset.undoToken,delete k.dataset.statusKind),Z=null))}function ei(e){if(!k)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Vi(e.tokenId)),e.button=i,typeof k.replaceChildren=="function"?k.replaceChildren(t,n,i):(k.textContent="",k.append(t,n,i)),k.dataset.statusKind="undo",k.dataset.undoToken=e.tokenId}function Rt(e,t){if(!O)return;let n=["online","offline","error"];n.forEach(s=>O.classList.remove(s)),n.includes(e)&&O.classList.add(e),O.dataset.state=e;let i=typeof t=="string"?t:Qn[e]||"";e==="online"||e==="offline"?(O.textContent="",O.dataset.compact="true",i?(O.setAttribute("aria-label",i),O.setAttribute("title",i)):(O.removeAttribute("aria-label"),O.removeAttribute("title"))):(O.textContent=i,O.removeAttribute("data-compact"),i?(O.setAttribute("aria-label",i),O.setAttribute("title",i)):(O.removeAttribute("aria-label"),O.removeAttribute("title")))}let W=a(r.notesSel),ti=a(r.saveNotesBtnSel),ni=a(r.loadNotesBtnSel),sn=a(r.countTotalSel),nt=a(r.googleUserNameSel),Ie=a(r.dateFeedbackSel),z=a(r.voiceBtnSel),ii=a(r.notifBtnSel),Re=a(r.moreBtnSel),Oe=a(r.moreMenuSel),ri=a(r.copyMtlBtnSel),Ot=a(r.importFileSel),oi=a(r.exportBtnSel),ai=a(r.syncAllBtnSel),De=a(r.syncUrlInputSel),si=a(r.saveSettingsSel),di=a(r.testSyncSel),ci=d(r.openSettingsSel),it=a(r.settingsSectionSel),ke=a(r.emptyStateSel),dn=a(r.listWrapperSel),Mt=a(r.categoryOptionsSel),pe=r.variant||"mobile",cn="mc:lastDefaults";function _t(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(cn)||"{}")||{}}catch{return{}}}function ui(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(cn,JSON.stringify(e))}catch{}}function un(e){let t=_t(),n={category:$(e?.category||t.category||U),priority:e?.priority||t.priority||"Medium"};ui(n)}let ln='fieldset#priorityChips input[name="priority"]';function Pt(){try{let e=document.querySelector(`${ln}:checked`);if(e&&e.value)return e.value}catch{}return G&&typeof G.value=="string"&&G.value?G.value:"Medium"}function rt(e){let t=e||"Medium";G&&typeof G.value<"u"&&(G.value=t);try{let n=Array.from(document.querySelectorAll(ln));if(!n.length)return;let i=!1;if(n.forEach(o=>{let s=o.value===t;o.checked=s,i=i||s}),!i){let o=n.find(s=>s.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function fn(){let e=_t();e.category&&C&&(C.value=e.category),e.priority&&rt(e.priority)}fn();let K=typeof document<"u"?document.getElementById("quickAddInput"):null,li=typeof document<"u"?document.getElementById("quickAddSubmit"):null,X=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,$t=null;function fi(e,t){let n=Date.now(),i=_t(),o=typeof t=="string"&&t?t:null;return{id:St(),title:(e||"").trim(),priority:i.priority||Pt(),category:$(i.category||C?.value||U),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!q}}async function Ut(){if(!K)return;if(typeof $t=="function")try{$t()}catch{}let e=(K.value||"").trim();if(!e)return;let t=null;try{let o=Tt(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=fi(e,t);Gt(n,{position:"start"}),c.unshift(n),ee(c);let i=Ye(c);Ae=!0,_(),H(),i?c.forEach(o=>Y(o)):Y(n),Ve(n),Ce(n),be(),un(n),Me();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:c}}))}catch{}re({action:"created",label:`Reminder added \xB7 ${n.title}`}),K.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Ut),li?.addEventListener("click",()=>{Ut()}),K?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Ut())});function pi(){if(typeof HTMLElement>"u"||!(X instanceof HTMLElement)||!(K instanceof HTMLInputElement)||X.dataset.voiceBound==="true")return;if(X.dataset.voiceBound="true",typeof window>"u"){X.setAttribute("disabled","true"),X.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){X.setAttribute("disabled","true"),X.setAttribute("aria-disabled","true"),X.getAttribute("title")||(X.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=u=>{n=u,X.setAttribute("aria-pressed",u?"true":"false"),X.dataset.listening=u?"true":"false",X.classList.toggle("is-listening",u)},o=()=>{if(t)return t;t=new e;let u=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=u,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",h=>{let b=h?.results?.[0]?.[0]?.transcript?.trim()||"";if(b){K.value=b;try{K.focus({preventScroll:!0})}catch{K.focus()}try{let w=K.value.length;typeof K.setSelectionRange=="function"&&K.setSelectionRange(w,w)}catch{}}});let p=()=>{i(!1)};return t.addEventListener("end",p),t.addEventListener("error",p),t},s=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};$t=s,X.addEventListener("click",()=>{let u=o();if(u){if(n){s();return}try{u.start(),i(!0)}catch(p){console.warn("Quick add voice error:",p),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",s),i(!1)}pi(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&K&&(e.preventDefault(),K.focus())})));try{pe==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let gi=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",pn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,mi=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",ot=r.reminderLandingPath||(pe==="desktop"?"index.html#reminders":"mobile.html"),ge=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function gn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Me(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:c}}))}catch{}}C&&!C.value&&(C.value=U),fe()&&Se();function re(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Gn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Gn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function yi(){if(typeof HTMLElement>"u"||!(z instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&y instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&y instanceof HTMLTextAreaElement;if(!e&&!t||z.dataset.voiceBound==="true")return;if(z.dataset.voiceBound="true",typeof window>"u"){z.setAttribute("disabled","true"),z.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){z.setAttribute("disabled","true"),z.setAttribute("aria-disabled","true"),z.getAttribute("title")||(z.title="Voice input is not supported in this browser.");return}let i=null,o=!1,s=b=>{o=b,z.setAttribute("aria-pressed",b?"true":"false"),z.dataset.listening=b?"true":"false",z.classList.toggle("is-listening",b)},u=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",w=>{let x=w.results?.[0]?.[0]?.transcript?.trim()||"";if(x){y.value=x;try{y.focus({preventScroll:!0})}catch{try{y.focus()}catch{}}try{let B=y.value.length;typeof y.setSelectionRange=="function"&&y.setSelectionRange(B,B)}catch{}re({action:"dictated",label:`Voice input captured \xB7 ${x}`})}});let b=()=>{s(!1)};return i.addEventListener("end",b),i.addEventListener("error",b),i},p=()=>{if(!(!o||!i)){try{i.stop()}catch{}s(!1)}};z.addEventListener("click",()=>{let b=u();if(b){if(o){p();return}try{b.start(),s(!0)}catch(w){console.warn("Speech recognition error:",w),s(!1)}}});let h=()=>{p()};typeof document<"u"&&(document.addEventListener("cue:close",h),document.addEventListener("reminders:updated",h)),s(!1)}gr(),yi();let at,st,dt,ct,Fe,ut,lt,ft,pt,gt,mt,_e,Pe,yt,ht,jt,Ht,bt,Wt,mn=r.firebaseDeps,qt=typeof r.importModule=="function"?r.importModule:e=>import(e),$e=an(),Ue=!1,oe=!1,Yt=null,ce=null,je=null,c=[],Ae=!1,q=null,He=null,We=null,Te={},P={};function ee(e=c){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?Sn(t||{},n||{}):o-i})}function hi(e=c){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function qe(e=c){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),ee(n);else{n=e.slice().sort(Sn);let i=n.length;n.forEach((o,s)=>{o.orderIndex=(i-s)*se})}return e===c&&(c=n),n}function Gt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=hi();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-se||se}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+se||se}}function Ye(e=c){if(!Array.isArray(e)||e.length<2)return!1;ee(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],s=Number.isFinite(i?.orderIndex)?i.orderIndex:null,u=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(s==null||u==null||s<=u||s-u<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*se;return e===c&&ee(c),!0}let L={draggingId:null,dropTargetId:null,dropBefore:!0},yn=!1,f={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function bi(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Ge(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function me(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function Vt(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),me(),L.draggingId=null,L.dropTargetId=null,L.dropBefore=!0}function hn(e,t,n){if(!e||e===t)return;let i=c.findIndex(B=>B?.id===e);if(i<0)return;let[o]=c.splice(i,1),s;if(!t)s=c.length;else{let B=c.findIndex(J=>J?.id===t);if(B<0){c.splice(i,0,o);return}s=n?B:B+1}c.splice(s,0,o);let u=c[s-1],p=c[s+1],h=Number.isFinite(u?.orderIndex)?u.orderIndex:null,b=Number.isFinite(p?.orderIndex)?p.orderIndex:null,w;h!=null&&b!=null?w=(h+b)/2:h!=null?w=h-se:b!=null?w=b+se:w=se,Number.isFinite(w)||(w=se*(c.length+1)),o.orderIndex=w,ee(c);let x=Ye(c);Ae=!0,_(),H(),x?c.forEach(B=>Y(B)):Y(o),Me(),ge("memoryCue:remindersUpdated",{items:c}),re({action:"reordered",label:"Reminders reordered"})}function vi(e){let t=Ge(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(L.draggingId=i,L.dropTargetId=null,L.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function wi(e){if(!L.draggingId)return;let t=Ge(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),L.dropTargetId=null,L.dropBefore=!1,me(),S?.classList.add("drag-over-list");return}if(t.dataset.id===L.draggingId){e.preventDefault(),me();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(L.dropTargetId!==t.dataset.id||L.dropBefore!==o)&&(me(),t.classList.add(o?"drag-over-before":"drag-over-after"),L.dropTargetId=t.dataset.id,L.dropBefore=o)}function Si(e){let t=Ge(e.target);if(!t){S?.contains(e.relatedTarget)||me();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function Ei(e){if(!L.draggingId)return;e.preventDefault();let t=Ge(e.target),n=t?.dataset.id||null,i=L.dropBefore;if(t){let o=t.getBoundingClientRect(),s=o.top+o.height/2;i=e.clientY<s}else n=null,i=!1;hn(L.draggingId,n,i),Vt()}function Ii(){Vt()}function Ai(){!S||yn||(yn=!0,S.addEventListener("dragstart",vi),S.addEventListener("dragover",wi),S.addEventListener("drop",Ei),S.addEventListener("dragend",Ii),S.addEventListener("dragleave",Si),vt())}function vt(){if(!S||vt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){vt._bound=!0;return}let t=6,n=160;function i(){f.longPressTimer&&(clearTimeout(f.longPressTimer),f.longPressTimer=null)}function o(){S&&(f.initialTouchAction!=null?S.style.touchAction=f.initialTouchAction:S.style.removeProperty("touch-action"))}function s({keepHighlights:v=!1}={}){if(i(),f.item&&f.pointerId!=null)try{f.item.hasPointerCapture?.(f.pointerId)&&f.item.releasePointerCapture(f.pointerId)}catch{}if(f.placeholder?.parentNode)try{f.placeholder.parentNode.removeChild(f.placeholder)}catch{}f.item&&(f.item.classList.remove("is-dragging"),f.originalStyles?f.item.setAttribute("style",f.originalStyles):f.item.removeAttribute("style")),o(),v||me(),Object.assign(f,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function u(v){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(T=>T!==v):[]}function p(v){let T=f.item;if(!T||f.ready)return;let F=T.getBoundingClientRect(),l=window.getComputedStyle(T);f.ready=!0,L.draggingId=T.dataset.id||null,f.offsetY=v.clientY-F.top,f.fixedX=F.left;let g=document.createElement("div");g.className="touch-drag-placeholder",g.setAttribute("aria-hidden","true"),g.style.height=`${F.height}px`,g.style.boxSizing="border-box",g.style.marginTop=l.marginTop,g.style.marginBottom=l.marginBottom,g.style.marginLeft=l.marginLeft,g.style.marginRight=l.marginRight,g.style.borderRadius=l.borderRadius,g.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",g.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",g.style.pointerEvents="none",g.style.display="block",g.style.width="100%",T.parentNode?.insertBefore(g,T),f.placeholder=g,f.longPressTimer=null,f.originalStyles=T.getAttribute("style")||"",T.classList.add("is-dragging"),T.style.position="fixed",T.style.left=`${F.left}px`,T.style.top=`${F.top}px`,T.style.width=`${F.width}px`,T.style.zIndex="999",T.style.pointerEvents="none",T.style.touchAction="none",f.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function h(v){let T=f.item;if(!T||!f.ready)return;let F=v-f.offsetY;T.style.top=`${F}px`,T.style.left=`${f.fixedX}px`}function b(v){if(!f.ready||!S)return;let T=f.item,F=u(T);if(me(),!F.length){L.dropTargetId=null,L.dropBefore=!1;return}let l=null,g=!1;for(let te of F){let ve=te.getBoundingClientRect(),Be=ve.top+ve.height/2;if(v<Be){l=te,g=!0;break}}if(!l){l=F[F.length-1];let te=l.getBoundingClientRect(),ve=te.top+te.height/2;g=v<ve,g||(g=!1)}if(!l){L.dropTargetId=null,L.dropBefore=!1;return}let m=l.getBoundingClientRect(),E=m.top+m.height/2,M=v<E;l.classList.add(M?"drag-over-before":"drag-over-after"),L.dropTargetId=l.dataset.id||null,L.dropBefore=M}function w(v){let T=L.draggingId,F=f.moved;if(!f.ready){s();return}s(),!v&&F&&T&&hn(T,L.dropTargetId,L.dropBefore),Vt()}function x(v){let T=v.pointerType||"";if(T&&T!=="touch"&&T!=="pen"||f.active)return;let F=Ge(v.target);if(!F)return;let l=bi(v.target);if(!(l&&l!==F)){f.active=!0,f.pointerId=v.pointerId,f.item=F,f.startX=v.clientX,f.startY=v.clientY,f.lastClientX=v.clientX,f.lastClientY=v.clientY,f.moved=!1,f.ready=!1,f.originalStyles=F.getAttribute("style")||"",f.startTime=v.timeStamp||Date.now(),L.dropTargetId=null,L.dropBefore=!0,L.draggingId=null,i(),f.longPressTimer=setTimeout(()=>{p({clientY:f.lastClientY})},n);try{F.setPointerCapture(v.pointerId)}catch{}}}function B(v){if(!f.active||v.pointerId!==f.pointerId)return;let T=v.pointerType||"";if(!(T&&T!=="touch"&&T!=="pen")){if(f.lastClientX=v.clientX,f.lastClientY=v.clientY,!f.ready){let F=Math.abs(v.clientX-f.startX),l=Math.abs(v.clientY-f.startY);if(F>t||l>t){let g=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(g-f.startTime)>=n?(i(),p({clientY:f.lastClientY})):s()}return}v.preventDefault(),f.moved=!0,h(v.clientY),b(v.clientY)}}function J(v){!f.active||v.pointerId!==f.pointerId||w(!1)}function Le(v){!f.active||v.pointerId!==f.pointerId||w(!0)}S.addEventListener("pointerdown",x),window.addEventListener("pointermove",B),window.addEventListener("pointerup",J),window.addEventListener("pointercancel",Le),vt._bound=!0}function bn(){q=null,Rt("offline"),Ee.forEach(e=>e.classList.remove("hidden")),j.forEach(e=>e.classList.add("hidden")),nt&&(nt.textContent=""),He?.(),He=null,Kt(),_(),H(),be()}function zt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(nn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,s=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:St(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:$(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(s)?s:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Ti(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(nn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:$(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(nn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function H(){ee(c),Ti(c)}function Kt(){c=qe(zt())}Kt();async function Ci(){if(!q){c=zt();return}let e=qe(zt());if(!e.length){c=[],H();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await Y(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}c=qe(e.map(n=>({...n,pendingSync:!1}))),H(),_(),be()}try{P=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{P={}}if(P&&typeof P=="object"&&Object.values(P).forEach(e=>{e&&typeof e=="object"&&(e.category=$(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Ke(e),e.urlPath=e.urlPath||ot,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!fe()){let e=Ln();typeof Notification<"u"&&Notification.permission==="granted"?(Bt(),e.length&&rn(e,{requestCheck:!0})):e.length&&rn(e)}let wt=e=>{if(!$e)return;let t=[$e];$e.window&&!t.includes($e.window)&&t.push($e.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Li(){if(!W)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",s=()=>"value"in W?W.value:W.innerHTML,u=w=>{if("value"in W){W.value=w;return}if(typeof w!="string"||w.length===0){W.innerHTML="";return}let x=w.trim();if(/<\/?[a-z][\s\S]*>/i.test(x)){W.innerHTML=w;return}let J=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");W.innerHTML=J},p=w=>{w?W.classList.add("notes-editor--columns"):W.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!w))},h="";try{h=localStorage.getItem(n)||""}catch{I("Unable to access saved notes")}u(h);let b=!1;try{b=localStorage.getItem(i)==="1"}catch{b=!1}p(b),W.addEventListener("input",()=>{h=s();try{localStorage.setItem(n,h)}catch{I("Notes saved for this session only")}}),ti?.addEventListener("click",()=>{h=s();try{localStorage.setItem(n,h),I("Notes saved")}catch{I("Notes saved for this session only")}}),ni?.addEventListener("click",()=>{let w=h;try{w=localStorage.getItem(n)||h}catch{I("Unable to load saved notes")}h=w,u(h)}),e?.addEventListener("click",w=>{let x=w.target;if(!(x instanceof Element))return;let B=x.closest("button[data-action]");if(!B)return;let J=B.getAttribute("data-action");if(J==="columns"){let Le=!W.classList.contains("notes-editor--columns");p(Le);try{localStorage.setItem(i,Le?"1":"0")}catch{I("Column preference saved for this session only")}return}if(!o){I("Formatting controls are not supported in this browser");return}W.focus(),J==="bullets"?document.execCommand("insertUnorderedList"):J==="numbers"&&document.execCommand("insertOrderedList")})}if(Li(),V?.addEventListener("click",Dn),mn)({initializeApp:at,getFirestore:st,enableMultiTabIndexedDbPersistence:dt,enableIndexedDbPersistence:ct,doc:Fe,setDoc:ut,deleteDoc:lt,onSnapshot:ft,collection:pt,query:gt,orderBy:mt,serverTimestamp:_e,getAuth:Pe,onAuthStateChanged:yt,GoogleAuthProvider:ht,signInWithPopup:jt,signInWithRedirect:Ht,getRedirectResult:bt,signOut:Wt}=mn),Ue=!0;else try{({initializeApp:at}=await qt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:st,enableMultiTabIndexedDbPersistence:dt,enableIndexedDbPersistence:ct,doc:Fe,setDoc:ut,deleteDoc:lt,onSnapshot:ft,collection:pt,query:gt,orderBy:mt,serverTimestamp:_e}=await qt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Pe,onAuthStateChanged:yt,GoogleAuthProvider:ht,signInWithPopup:jt,signInWithRedirect:Ht,getRedirectResult:bt,signOut:Wt}=await qt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Ue=!0}catch(e){Ue=!1,console.warn("Firebase modules failed to load:",e),I("Firebase failed to load; notes available offline"),wt(!1)}if(Ue&&typeof at=="function"&&typeof st=="function"&&typeof Pe=="function")try{let e=fr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Yt=at(e),ce=st(Yt),oe=!0,console.info("[Firebase] Firestore initialised",e.projectId),wt(!0)}catch(e){oe=!1,console.warn("Firebase initialization failed:",e),I("Firebase failed to load; notes available offline"),wt(!1)}else Ue?(oe=!1,wt(!1)):oe=!1;oe&&typeof dt=="function"&&typeof ct=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await dt(ce),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await ct(ce),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),oe&&typeof Pe=="function"&&(je=Pe(Yt));function xi(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Di=typeof navigator<"u"&&navigator.language?navigator.language:"",vn=xi(Di),Ne=vn||"en-US",ue="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(ue=e.timeZone),!vn&&e.locale&&(Ne=e.locale)}catch{}let ki=new Intl.DateTimeFormat(Ne,{timeZone:ue,hour:"2-digit",minute:"2-digit"}),Fi=new Intl.DateTimeFormat(Ne,{timeZone:ue,weekday:"long",day:"numeric",month:"long"}),Ni=new Intl.DateTimeFormat("en-CA",{timeZone:ue,year:"numeric",month:"2-digit",day:"2-digit"}),Bi=new Intl.DateTimeFormat(Ne,{timeZone:ue,weekday:"long"}),Ri=new Intl.DateTimeFormat(Ne,{timeZone:ue,month:"short",day:"numeric"});function ye(e){let t=Ni.formatToParts(e),n=t.find(s=>s.type==="year").value,i=t.find(s=>s.type==="month").value,o=t.find(s=>s.type==="day").value;return`${n}-${i}-${o}`}function wn(e,t){let[n,i,o]=e.split("-").map(h=>parseInt(h,10)),[s,u]=t.split(":").map(h=>parseInt(h,10)),p=new Date;return p.setFullYear(n,(i||1)-1,o||1),p.setHours(s||0,u||0,0,0),p.toISOString()}let Oi=new Intl.DateTimeFormat("en-CA",{timeZone:ue,year:"numeric",month:"2-digit",day:"2-digit"}),Mi=new Intl.DateTimeFormat("en-CA",{timeZone:ue,hour:"2-digit",minute:"2-digit",hour12:!1});function _i(e){try{let t=new Date(e),n=Oi.formatToParts(t),i=n.find(u=>u.type==="year")?.value||"0000",o=n.find(u=>u.type==="month")?.value||"00",s=n.find(u=>u.type==="day")?.value||"00";return`${i}-${o}-${s}`}catch{return""}}function Pi(e){try{let t=new Date(e),n=Mi.formatToParts(t),i=n.find(s=>s.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(s=>s.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function St(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Et(){return ye(new Date)}function $i(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function yr(e){let t=$i(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function It(e){return e==="High"?3:e==="Medium"?2:1}function Sn(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,s=t?.due?new Date(t.due).getTime():1/0;if(o!==s)return o-s;let u=It(t?.priority)-It(e?.priority);return u||(t?.updatedAt||0)-(e?.updatedAt||0)}function hr(e,t){let n=It(t.priority)-It(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Xt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Fi.format(t)}catch{return e}}function At(e){return ki.format(e)}function he(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Ui(e){return e?he(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function I(e){k&&(xe(),k.dataset.statusKind="toast",k.textContent=e,clearTimeout(I._t),I._t=setTimeout(()=>{k&&k.dataset.statusKind==="toast"&&(k.textContent="",delete k.dataset.statusKind)},2500))}function ji(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Tt(e){e=String(e||"").toLowerCase();let t={date:Et(),time:""},n=p=>{let h=new Date,b=h.getDay(),w=(p-b+7)%7,x=new Date(h);return x.setDate(h.getDate()+(w===0?7:w)),x},i=p=>{let h=new Date,b=h.getDay(),w=(p-b+7)%7,x=new Date(h);return x.setDate(h.getDate()+w),x},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},s={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let p=new Date;p.setDate(p.getDate()+1),t.date=ye(p)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=o[p[1]],b=n(h);t.date=ye(b)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=o[p[1]],b=i(h);t.date=ye(b)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=o[p[1]],b=n(h);t.date=ye(b)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let p=e.match(/\bin\s+(\d+)\s+days?\b/),h=parseInt(p[1],10),b=new Date;b.setDate(b.getDate()+h),t.date=ye(b)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let p=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),h=parseInt(p[1],10),b=parseInt(p[2],10)-1,w=p[3]?parseInt(p[3],10):new Date().getFullYear(),x=new Date(w,b,h);t.date=ye(x)}else for(let[p,h]of Object.entries(s)){let b=new RegExp(`\\b${p}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(b.test(e)){let w=e.match(b),x=parseInt(w[1],10),B=new Date().getFullYear(),J=new Date(B,h,x);t.date=ye(J);break}}let u=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(u){let p=parseInt(u[1],10),h=u[2]?parseInt(u[2],10):0,b=u[3];b&&(b==="pm"&&p<12&&(p+=12),b==="am"&&p===12&&(p=0)),t.time=`${String(p).padStart(2,"0")}:${String(h).padStart(2,"0")}`}return t}let Jt=oe&&je&&typeof ht=="function";_n({authReady:Jt,auth:je,GoogleAuthProvider:ht,signInWithPopup:jt,signInWithRedirect:Ht,signOut:Wt,toast:I});let En=pe!=="desktop",In=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};En&&Ee.length&&Ee.forEach(e=>In(e,Pn)),Jt&&typeof bt=="function"&&bt(je).catch(()=>{}),En&&j.length&&j.forEach(e=>In(e,$n)),Jt&&typeof yt=="function"?yt(je,async e=>{e?(q=e.uid,Rt("online"),Ee.forEach(t=>t.classList.add("hidden")),j.forEach(t=>t.classList.remove("hidden")),nt&&(nt.textContent=e.displayName||e.email||""),Hi(),await Ci()):bn()}):bn();function Hi(){if(!oe||!ce||typeof pt!="function"||typeof gt!="function"||typeof mt!="function"||typeof ft!="function")return;if(!q){Kt(),_(),H(),be();return}He&&He();let e=pt(ce,"users",q,"reminders"),t=gt(e,mt("updatedAt","desc"));He=ft(t,n=>{let i=[];n.forEach(o=>{let s=o.data(),u=Number(s.orderIndex);i.push({id:o.id,title:s.title,priority:s.priority,notes:s.notes||"",done:!!s.done,due:s.due||null,category:$(s.category),createdAt:s.createdAt?.toMillis?.()||0,updatedAt:s.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(u)?u:null})}),c=qe(i),_(),H(),be()},n=>{console.error("Firestore sync error:",n),O&&Rt("error","Sync Error")})}async function Y(e){if(!(!oe||!q||!ce||typeof Fe!="function"||typeof ut!="function"||typeof _e!="function"))try{await ut(Fe(ce,"users",q,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||U,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):_e(),updatedAt:_e()},{merge:!0})}catch(t){console.error("Save failed:",t),I("Save queued (offline)")}}async function Wi(e){if(!(!oe||!q||!ce||typeof Fe!="function"||typeof lt!="function"))try{await lt(Fe(ce,"users",q,"reminders",e))}catch{I("Delete queued (offline)")}}async function Ve(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||U,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function ze(){y&&(y.value=""),A&&(A.value=""),D&&(D.value=""),N&&(N.value=""),rt("Medium"),C&&(C.value=U),fn(),We=null,V&&(V.textContent="Save Cue"),Q?.classList.add("hidden")}function An(e){let t=c.find(n=>n.id===e);t&&(y&&(y.value=t.title||""),A&&D&&(t.due?(A.value=_i(t.due),D.value=Pi(t.due)):(A.value="",D.value="")),rt(t?.priority||"Medium"),C&&(C.value=$(t.category)),N&&(N.value=typeof t.notes=="string"?t.notes:""),We=e,V&&(V.textContent="Update Cue"),Q?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),y?.focus(),ge("cue:open",{mode:"edit"}))}function qi(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=$(e.category??(C?C.value:"")),o={id:St(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!q};Gt(o,{position:"start"}),c=[o,...c],ee(c);let s=Ye(c);return Ae=!0,_(),H(),un(o),s?c.forEach(u=>Y(u)):Y(o),Ve(o),Ce(o),Me(),ge("memoryCue:remindersUpdated",{items:c}),gn(),re({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Yi(e,t){if(!q)return I("Sign in to add notes"),null;if(!e)return null;let n=c.find(u=>u.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let s=typeof n.notes=="string"?n.notes:"";return n.notes=s?`${s}
${o}`:o,n.updatedAt=Date.now(),Y(n),_(),H(),re({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Gi(e){let t=c.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),Y(t),Ve(t),_(),H(),t.done?(Lt(e),re({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ce(t),re({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Vi(e){if(!Z||Z.tokenId!==e)return;let{item:t,index:n}=Z;if(!t){xe(e);return}xe(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),c.length):c.length;t.pendingSync=!q,t.updatedAt=Date.now(),c.splice(i,0,t),ee(c);let o=Ye(c);Ae=!0,_(),H(),Ce(t),o?c.forEach(s=>Y(s)):Y(t),Ve(t),Me(),ge("memoryCue:remindersUpdated",{items:c}),re({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),I("Reminder restored")}function Tn(e){let t=c.findIndex(o=>o.id===e),n=t>=0?c.splice(t,1)[0]:null;_(),H(),Wi(e),Lt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(re({action:"deleted",label:i}),n&&k){xe();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;Z={tokenId:o,item:n,index:t,timeoutId:null},ei(Z),Z.timeoutId=setTimeout(()=>{xe(o)},Zn)}else n&&xe()}function Ke(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=At(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=At(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function Cn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}I("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Ln(){return Object.values(P||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||U,notes:typeof e.notes=="string"?e.notes:"",body:Ke(e),urlPath:e.urlPath||ot,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Qt(){try{localStorage.setItem("scheduledReminders",JSON.stringify(P))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Ln(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Bt(),rn(e,{requestCheck:t})}function Ct(e,{closeNotification:t=!0}={}){if(t){let n=le.get(e);if(n){try{n.close()}catch{}le.delete(e)}}Te[e]&&(clearTimeout(Te[e]),delete Te[e]),on(e),P[e]&&(delete P[e],Qt())}function Lt(e){Ct(e)}function xn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=le.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Ke(e),tag:e.id});le.set(e.id,n);let i=()=>{le.get(e.id)===n&&le.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function zi(e){if(!fe())return!1;let t=Xn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Se();if(!i)return!1;await on(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||U,body:s,urlPath:ot},s=Ke(e),u={body:s,tag:e.id,data:o,renotify:!0};n>Date.now()&&(u.showTrigger=new t(n));try{return await i.showNotification(e.title,u),!0}catch(p){return console.warn("Failed to schedule persistent notification",p),!1}}function Ce(e){if(!e||!e.id)return;if(e.category=$(e.category),!e.due||e.done){Lt(e.id);return}let t=P[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||U,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Ke(e),urlPath:ot,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let u=typeof t.due=="string"?t.due:null,p=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return u===e.due?p:null})()};if(P[e.id]=n,Qt(),Te[e.id]&&(clearTimeout(Te[e.id]),delete Te[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(P[e.id]?.viaTrigger){Ct(e.id,{closeNotification:!1});return}xn(e),Ct(e.id,{closeNotification:!1});return}let s=fe();s&&(n.viaTrigger=!1,zi(e).then(u=>{u&&P[e.id]&&(P[e.id]={...P[e.id],viaTrigger:!0},Qt())})),Te[e.id]=setTimeout(()=>{s&&on(e.id),xn(e),Ct(e.id,{closeNotification:!1})},o)}function be(){Object.values(P).forEach(e=>Ce({...e,category:$(e?.category)}))}function Ki(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Bi.format(t),i=Ri.format(t),o=At(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function _(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),me(),ee(c),sn)try{sn.textContent=String(c.length)}catch{}c.forEach(l=>{l&&typeof l=="object"&&(l.category=$(l.category))});let o=new Set(ur.map(l=>$(l)));c.forEach(l=>{l&&typeof l=="object"&&o.add($(l.category))});let s=Array.from(o).sort((l,g)=>l.localeCompare(g,void 0,{sensitivity:"base"}));if(Mt){let l=new Set;Array.from(Mt.querySelectorAll("option")).forEach(g=>{l.add(g.value.trim().toLowerCase())}),s.forEach(g=>{let m=g.toLowerCase();if(!l.has(m)){let E=document.createElement("option");E.value=g,Mt.appendChild(E),l.add(m)}})}if(Ae)Ae=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let l=c.map(g=>({...g}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:l}}));else if(document.createEvent){let g=document.createEvent("CustomEvent");g&&g.initCustomEvent&&(g.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:l}),document.dispatchEvent(g))}}catch{}}let u=c.slice();ee(u);let p=!0,h=c.length>0,b=u.length>0,w=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let l=Object.values(P||{}).filter(g=>g&&typeof g=="object"&&g.id);return new Set(l.map(g=>g.id))})();if(ke)if(b)ke.classList.add("hidden");else{let l=h?"No reminders to show right now.":gi;pn?pn(ke,{icon:h?"sparkles":"bell",title:h?"Nothing to display":"Create your first cue",description:l,action:h?void 0:`<button type="button" class="${mi}" data-trigger="open-cue">Create reminder</button>`}):ke.textContent=l,ke.classList.remove("hidden")}if(dn&&dn.classList.toggle("has-items",b),!S)return;if(!b){ke?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden"));return}S.classList.remove("hidden"),S.replaceChildren();let x=document.createDocumentFragment(),B=S.tagName==="UL"||S.tagName==="OL",J=!0,Le=(l,g)=>{let m=document.createElement("div");m.className="task-item";let E={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:g,done:!!l.done};m.dataset.category=g,m.dataset.reminder=JSON.stringify(E),m.dataset.id=E.id,m.dataset.title=E.title,m.dataset.priority=E.priority,m.dataset.done=String(E.done),m.dataset.orderIndex=Number.isFinite(l.orderIndex)?String(l.orderIndex):"",m.dataset.reminderItem="true",m.setAttribute("draggable","true"),m.classList.add("reminder-draggable"),m.setAttribute("role","button"),m.tabIndex=0,m.setAttribute("aria-label",`Edit reminder: ${l.title}`),E.dueIso&&(m.dataset.due=E.dueIso),w.has(E.id)?m.dataset.notificationActive="true":delete m.dataset.notificationActive;let M=E.dueIso?new Date(E.dueIso):null;p&&M&&M>=n&&M<=i&&(m.classList.add("is-today"),m.dataset.today="true");let ve=l.due?`${At(new Date(l.due))} \u2022 ${Xt(l.due.slice(0,10))}`:"No due date",Be=l.due?he(ve):"",xt=!!(g&&g!==U)?he(g):"",Qi=`<span class="task-chip" data-chip="priority">${he(E.priority)}</span>`,Dt=[];Be&&Dt.push(Be),xt&&Dt.push(xt);let Zi=Dt.length?`<div class="task-meta-text">${Dt.join(" \u2022 ")}</div>`:"",er="";m.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${he(l.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn cue-btn delete" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          ${Zi}
          <div class="task-meta">
            ${Qi}
          </div>
          ${er}
        </div>`;let Nn=m.querySelector("[data-del]");Nn&&Nn.addEventListener("click",ie=>{ie.stopPropagation(),Tn(l.id)});let Bn=()=>An(l.id);return m.addEventListener("click",ie=>{ie.defaultPrevented||ie.target instanceof HTMLElement&&ie.target.closest("[data-del]")||Bn()}),m.addEventListener("keydown",ie=>{ie.defaultPrevented||ie.target===m&&(ie.key==="Enter"||ie.key===" ")&&(ie.preventDefault(),Bn())}),m};if(pe!=="desktop"&&!J){u.forEach(l=>{let g=l.category||U;x.appendChild(Le(l,g))}),S.appendChild(x);return}let v=new Map;u.forEach(l=>{let g=l.category||U;v.has(g)||v.set(g,[]),v.get(g).push(l)});let T=Array.from(v.entries()).sort((l,g)=>l[0].localeCompare(g[0],void 0,{sensitivity:"base"})),F=!0;T.forEach(([l,g])=>{if(l!==U){let m=document.createElement(B?"li":"div");m.dataset.categoryHeading=l,B&&(m.setAttribute("role","presentation"),m.style.listStyle="none"),m.className=pe==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",F||(m.style.marginTop=pe==="desktop"?"1.25rem":"1rem");let E=document.createElement("div");E.setAttribute("role","heading"),E.setAttribute("aria-level","3"),E.className=pe==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let M=document.createElement("span");M.textContent=l;let te=document.createElement("span");te.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",te.textContent=`${g.length} ${g.length===1?"item":"items"}`,E.append(M,te),m.appendChild(E),x.appendChild(m)}g.forEach(m=>{if(pe==="desktop"){let E=document.createElement(B?"li":"div"),M={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:l,done:!!m.done};E.dataset.id=M.id,E.dataset.category=M.category,E.dataset.title=M.title,E.dataset.priority=M.priority,E.dataset.done=String(M.done),M.dueIso&&(E.dataset.due=M.dueIso),E.dataset.reminder=JSON.stringify(M),E.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",E.dataset.reminderItem="true",E.setAttribute("draggable","true"),E.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200",w.has(M.id)?E.dataset.notificationActive="true":delete E.dataset.notificationActive;let te=Ki(m),ve=m.done?"line-through text-base-content/50":"text-base-content",Be=m.done?"Completed":"Active",kn=m.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",xt=m.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Fn=m.notes?`<p class="text-sm leading-relaxed text-base-content/70">${Ui(m.notes)}</p>`:"";E.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${ve}">${he(m.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${he(te)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${he(l)}
            </span>
            <span class="${kn} text-[0.7rem] sm:text-xs">${Be}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Fn}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${xt}">${m.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,E.querySelector('[data-action="toggle"]').addEventListener("click",()=>Gi(m.id)),E.querySelector('[data-action="edit"]').addEventListener("click",()=>An(m.id)),E.querySelector('[data-action="delete"]').addEventListener("click",()=>Tn(m.id)),x.appendChild(E);return}x.appendChild(Le(m,l))}),F=!1}),S.appendChild(x)}function ae(){Re?.setAttribute("aria-expanded","false"),Oe?.classList.add("hidden")}function Xi(){Re?.setAttribute("aria-expanded","true"),Oe?.classList.remove("hidden")}Re?.addEventListener("click",e=>{e.stopPropagation(),Re.getAttribute("aria-expanded")==="true"?ae():Xi()}),document.addEventListener("click",e=>{Oe&&!Oe.classList.contains("hidden")&&!Oe.contains(e.target)&&e.target!==Re&&ae()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ae()}),ci.forEach(e=>{e.addEventListener("click",()=>{let t=it?.classList.contains("hidden");it?.classList.toggle("hidden"),t&&it?.scrollIntoView({behavior:"smooth",block:"start"}),ae()})}),document.addEventListener("DOMContentLoaded",()=>{it?.classList.add("hidden")});function Dn(){try{console.log("handleSaveAction invoked",{editingId:We,title:y?.value})}catch{}if(We){let i=c.find(p=>p.id===We);if(!i){ze();return}let o=y.value.trim();if(!o){I("Add a reminder title");return}let s=null;if(A.value||D.value){let p=A.value||Et(),h=D.value||"09:00";s=wn(p,h)}else{let p=Tt(o);p.time&&(s=new Date(`${p.date}T${p.time}:00`).toISOString())}i.title=o;let u=Pt();i.priority=u,rt(u),C&&(i.category=$(C.value)),i.due=s,N&&(i.notes=N.value.trim()),i.updatedAt=Date.now(),Y(i),Ve(i),Ae=!0,_(),Ce(i),H(),Me(),ge("memoryCue:remindersUpdated",{items:c}),gn(),re({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),ze(),I("Reminder updated"),ge("cue:close",{reason:"updated"});return}let e=y.value.trim();if(!e){I("Add a reminder title");return}let t=N?N.value.trim():"",n=null;if(A.value||D.value){let i=A.value||Et(),o=D.value||"09:00";n=wn(i,o)}else{let i=Tt(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}qi({title:e,priority:Pt(),category:C?C.value:"",due:n,notes:t}),y.value="",D.value="",N&&(N.value=""),ge("cue:close",{reason:"created"})}y?.addEventListener("keydown",e=>{e.key==="Enter"&&Dn()});function Ji(){if(!y||!Ie)return;let e=y.value.trim();if(!e){Ie.style.display="none";return}try{let t=Tt(e),n=Et();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Xt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Ie.textContent=`Parsed: ${i}`,Ie.style.display="block"):Ie.style.display="none"}else Ie.style.display="none"}catch{Ie.style.display="none"}}return y?.addEventListener("input",ji(Ji,300)),Q?.addEventListener("click",()=>{ze(),I("Edit cancelled"),ge("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{ze()}),document.addEventListener("cue:prepare",()=>{ze()}),window.addEventListener("load",()=>y?.focus()),ri?.addEventListener("click",()=>{let e=c.filter(t=>!t.done).map(t=>{let n=t.due?Xt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Ne,{hour:"2-digit",minute:"2-digit",timeZone:ue}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){I("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>I("Copied for Master Task List")).catch(()=>I("Copy failed")),ae()}),Ot?.addEventListener("change",()=>{let e=Ot.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(s=>{let u={...s,id:St(),category:$(s.category),pendingSync:!q,orderIndex:null};Gt(u,{position:"start"}),c=[u,...c],i.push(u)}),ee(c);let o=Ye(c);_(),H(),o?c.forEach(s=>Y(s)):i.forEach(s=>Y(s)),I("Import successful")}catch{I("Invalid JSON")}},t.readAsText(e),Ot.value="",ae()}),oi?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),ae()}),ai?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){I("Add your Apps Script URL in Settings first"),ae();return}if(!c.length){I("No tasks to sync"),ae();return}I("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<c.length;i+=t){let o=c.slice(i,i+t),s=await Promise.allSettled(o.map(u=>{let p={id:u.id,title:u.title,dueIso:u.due||null,priority:u.priority||"Medium",category:u.category||U,done:!!u.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})}));n+=s.filter(u=>u.status==="rejected").length,await new Promise(u=>setTimeout(u,400))}I(`Sync complete: ${c.length-n} ok${n?`, ${n} failed`:""}`),ae()}),De&&(De.value=localStorage.getItem("syncUrl")||""),si?.addEventListener("click",()=>{De&&(localStorage.setItem("syncUrl",De.value.trim()),I("Settings saved"))}),di?.addEventListener("click",async()=>{if(!De)return;let e=De.value.trim();if(!e){I("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});I(t.ok?"Test ok":"Test failed")}catch{I("Test failed")}}),ii?.addEventListener("click",async()=>{if(!("Notification"in window)){I("Notifications not supported");return}if(Notification.permission==="granted"){I("Notifications enabled"),fe()?Se():(Bt(),Cn()),be(),_();return}try{await Notification.requestPermission()==="granted"?(I("Notifications enabled"),fe()?Se():(Bt(),Cn()),be(),_()):I("Notifications blocked")}catch{I("Notifications blocked")}}),Ai(),be(),_(),H(),{cancelReminder:Lt,scheduleReminder:Ce,closeActiveNotifications:Jn,getActiveNotifications:()=>le,addNoteToReminder:Yi,__testing:{setItems(e=[]){c=Array.isArray(e)?e.map(t=>({...t,category:$(t?.category)})):[],c=qe(c),ee(c),_()},render:_,getItems:()=>c.map(e=>({...e}))}}}var Gn,le,Vn,Zt,en,zn,Nt,tt,tn,U,ur,nn,se,lr,de,mr=On(()=>{jn();Gn="memoryCue:activity",le=new Map,Vn=!1,Zt="service-worker.js",en="memory-cue-reminder-sync",zn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Nt=null,tt=null,tn=!1,U="General",ur=Object.freeze([U,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),nn="memoryCue:offlineReminders",se=1024,lr=Object.freeze({}),de=null});export{Pn as a,$n as b,vr as c,jn as d,Ir as e,mr as f};
