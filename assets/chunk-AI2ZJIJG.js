import{a as zn}from"./chunk-RCZ4YZVR.js";function Jt(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function zt(){let c=Jt(),f=c&&c.TimestampTrigger;return typeof f=="function"?f:null}function ue(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!zt()}function Qn(){if(typeof window>"u"||!window.location)return St;try{return new URL(St,window.location.href).href}catch{return St}}async function Ae(){return tt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(tt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Qn()),await navigator.serviceWorker.ready}catch(c){return console.warn("Service worker registration failed",c),null}})(),tt))}async function Lt(c,f){if(ue())try{let ke=f||await Ae();if(!ke)return;let v=[];try{v=await ke.getNotifications({tag:c,includeTriggered:!0})}catch{v=await ke.getNotifications({tag:c})}for(let O of v)try{O.close()}catch{}}catch{}}function Gt(){for(let c of Array.from(G.values()))try{c.close()}catch{}G.clear()}function Zn(){if(Vt||typeof window>"u"||typeof window.addEventListener!="function")return;let c=()=>Gt();["pagehide","beforeunload"].forEach(f=>{try{window.addEventListener(f,c)}catch{}}),Vt=!0}function A(c){if(typeof c=="string"){let f=c.replace(/\s+/g," ").trim();if(f)return f}return R}async function ei(c={}){let f=e=>e?document.querySelector(e):null,ke=e=>e?Array.from(document.querySelectorAll(e)):[],v=f(c.titleSel),O=f(c.dateSel),P=f(c.timeSel),H=f(c.detailsSel),Y=f(c.prioritySel),L=f(c.categorySel),fe=f(c.saveBtnSel),nt=f(c.cancelEditBtnSel),B=f(c.listSel),it=f(c.googleSignInBtnSel),ot=f(c.googleSignOutBtnSel),rt=f(c.statusSel),E=f(c.syncStatusSel),Qt={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."};function at(e,t){if(!E)return;let n=["online","offline","error"];n.forEach(r=>E.classList.remove(r)),n.includes(e)&&E.classList.add(e),E.dataset.state=e;let i=typeof t=="string"?t:Qt[e]||"";e==="online"||e==="offline"?(E.textContent="",E.dataset.compact="true",i?(E.setAttribute("aria-label",i),E.setAttribute("title",i)):(E.removeAttribute("aria-label"),E.removeAttribute("title"))):(E.textContent=i,E.removeAttribute("data-compact"),i?(E.setAttribute("aria-label",i),E.setAttribute("title",i)):(E.removeAttribute("aria-label"),E.removeAttribute("title")))}let C=f(c.notesSel),Zt=f(c.saveNotesBtnSel),Yt=f(c.loadNotesBtnSel),At=f(c.countTotalSel),Ce=f(c.googleUserNameSel),K=f(c.dateFeedbackSel),I=f(c.voiceBtnSel),Kt=f(c.notifBtnSel),pe=f(c.moreBtnSel),me=f(c.moreMenuSel),Xt=f(c.copyMtlBtnSel),st=f(c.importFileSel),en=f(c.exportBtnSel),tn=f(c.syncAllBtnSel),re=f(c.syncUrlInputSel),nn=f(c.saveSettingsSel),on=f(c.testSyncSel),rn=f(c.openSettingsSel),De=f(c.settingsSectionSel),ae=f(c.emptyStateSel),kt=f(c.listWrapperSel),ct=f(c.categoryOptionsSel),X=c.variant||"mobile",Ct="mc:lastDefaults";function dt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Ct)||"{}")||{}}catch{return{}}}function an(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Ct,JSON.stringify(e))}catch{}}function Dt(e){let t=dt(),n={category:A(e?.category||t.category||R),priority:e?.priority||t.priority||"Medium"};an(n)}let Tt='fieldset#priorityChips input[name="priority"]';function lt(){try{let e=document.querySelector(`${Tt}:checked`);if(e&&e.value)return e.value}catch{}return Y&&typeof Y.value=="string"&&Y.value?Y.value:"Medium"}function Te(e){let t=e||"Medium";Y&&typeof Y.value<"u"&&(Y.value=t);try{let n=Array.from(document.querySelectorAll(Tt));if(!n.length)return;let i=!1;if(n.forEach(o=>{let r=o.value===t;o.checked=r,i=i||r}),!i){let o=n.find(r=>r.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function It(){let e=dt();e.category&&L&&(L.value=e.category),e.priority&&Te(e.priority)}It();let x=typeof document<"u"?document.getElementById("quickAddInput"):null,sn=typeof document<"u"?document.getElementById("quickAddSubmit"):null,N=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,ut=null;function cn(e,t){let n=Date.now(),i=dt(),o=typeof t=="string"&&t?t:null;return{id:Je(),title:(e||"").trim(),priority:i.priority||lt(),category:A(i.category||L?.value||R),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!M}}async function ft(){if(!x)return;if(typeof ut=="function")try{ut()}catch{}let e=(x.value||"").trim();if(!e)return;let t=null;try{let i=Qe(e);i&&i.time&&(t=new Date(`${i.date}T${i.time}:00`).toISOString())}catch{t=null}let n=cn(e,t);m.unshift(n),ve=!0,T(),$(),ie(n),Ye(n),le(n),Z(),Dt(n),pt();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}))}catch{}_({action:"created",label:`Reminder added \xB7 ${n.title}`}),x.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=ft),sn?.addEventListener("click",()=>{ft()}),x?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),ft())});function dn(){if(typeof HTMLElement>"u"||!(N instanceof HTMLElement)||!(x instanceof HTMLInputElement)||N.dataset.voiceBound==="true")return;if(N.dataset.voiceBound="true",typeof window>"u"){N.setAttribute("disabled","true"),N.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){N.setAttribute("disabled","true"),N.setAttribute("aria-disabled","true"),N.getAttribute("title")||(N.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,N.setAttribute("aria-pressed",d?"true":"false"),N.dataset.listening=d?"true":"false",N.classList.toggle("is-listening",d)},o=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",l=>{let u=l?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){x.value=u;try{x.focus({preventScroll:!0})}catch{x.focus()}try{let g=x.value.length;typeof x.setSelectionRange=="function"&&x.setSelectionRange(g,g)}catch{}}});let s=()=>{i(!1)};return t.addEventListener("end",s),t.addEventListener("error",s),t},r=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};ut=r,N.addEventListener("click",()=>{let d=o();if(d){if(n){r();return}try{d.start(),i(!0)}catch(s){console.warn("Quick add voice error:",s),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",r),i(!1)}dn(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&x&&(e.preventDefault(),x.focus())})));try{X==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let ln=c.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",xt=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,un=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",fn=c.reminderLandingPath||(X==="desktop"?"index.html#reminders":"mobile.html"),se=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Nt(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function pt(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:m}}))}catch{}}L&&!L.value&&(L.value=R),ue()&&Ae();function _(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Wt,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Wt,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function pn(){if(typeof HTMLElement>"u"||!(I instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&v instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&v instanceof HTMLTextAreaElement;if(!e&&!t||I.dataset.voiceBound==="true")return;if(I.dataset.voiceBound="true",typeof window>"u"){I.setAttribute("disabled","true"),I.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){I.setAttribute("disabled","true"),I.setAttribute("aria-disabled","true"),I.getAttribute("title")||(I.title="Voice input is not supported in this browser.");return}let i=null,o=!1,r=u=>{o=u,I.setAttribute("aria-pressed",u?"true":"false"),I.dataset.listening=u?"true":"false",I.classList.toggle("is-listening",u)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",g=>{let w=g.results?.[0]?.[0]?.transcript?.trim()||"";if(w){v.value=w;try{v.focus({preventScroll:!0})}catch{try{v.focus()}catch{}}try{let F=v.value.length;typeof v.setSelectionRange=="function"&&v.setSelectionRange(F,F)}catch{}_({action:"dictated",label:`Voice input captured \xB7 ${w}`})}});let u=()=>{r(!1)};return i.addEventListener("end",u),i.addEventListener("error",u),i},s=()=>{if(!(!o||!i)){try{i.stop()}catch{}r(!1)}};I.addEventListener("click",()=>{let u=d();if(u){if(o){s();return}try{u.start(),r(!0)}catch(g){console.warn("Speech recognition error:",g),r(!1)}}});let l=()=>{s()};typeof document<"u"&&(document.addEventListener("cue:close",l),document.addEventListener("reminders:updated",l)),r(!1)}Zn(),pn();let Ie,xe,Ne,Me,ce,$e,Re,Fe,Oe,Be,Pe,ye,ge,He,je,Ue,qe,_e,We,Mt=c.firebaseDeps,mt=typeof c.importModule=="function"?c.importModule:e=>import(e),he=Jt(),be=!1,j=!1,yt=null,W=null,ee=null,m=[],ve=!1,M=null,we=null,Se=null,te={},D={};function $t(){M=null,at("offline"),it?.classList.remove("hidden"),ot?.classList.add("hidden"),Ce&&(Ce.textContent=""),we?.(),we=null,ht(),T(),$(),Z()}function gt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Et);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i;return{id:typeof n.id=="string"&&n.id?n.id:Je(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:A(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function mn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Et);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:A(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem(Et,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function $(){mn(m)}function ht(){m=gt()}ht();async function yn(){if(!M){m=gt();return}let e=gt();if(!e.length){m=[],$();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await ie(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}m=e.map(n=>({...n,pendingSync:!1})),$(),T(),Z()}try{D=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{D={}}D&&typeof D=="object"&&Object.values(D).forEach(e=>{e&&typeof e=="object"&&(e.category=A(e.category))});let Ve=e=>{if(!he)return;let t=[he];he.window&&!t.includes(he.window)&&t.push(he.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function gn(){if(!C)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",r=()=>"value"in C?C.value:C.innerHTML,d=g=>{if("value"in C){C.value=g;return}if(typeof g!="string"||g.length===0){C.innerHTML="";return}let w=g.trim();if(/<\/?[a-z][\s\S]*>/i.test(w)){C.innerHTML=g;return}let J=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");C.innerHTML=J},s=g=>{g?C.classList.add("notes-editor--columns"):C.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!g))},l="";try{l=localStorage.getItem(n)||""}catch{p("Unable to access saved notes")}d(l);let u=!1;try{u=localStorage.getItem(i)==="1"}catch{u=!1}s(u),C.addEventListener("input",()=>{l=r();try{localStorage.setItem(n,l)}catch{p("Notes saved for this session only")}}),Zt?.addEventListener("click",()=>{l=r();try{localStorage.setItem(n,l),p("Notes saved")}catch{p("Notes saved for this session only")}}),Yt?.addEventListener("click",()=>{let g=l;try{g=localStorage.getItem(n)||l}catch{p("Unable to load saved notes")}l=g,d(l)}),e?.addEventListener("click",g=>{let w=g.target;if(!(w instanceof Element))return;let F=w.closest("button[data-action]");if(!F)return;let J=F.getAttribute("data-action");if(J==="columns"){let Le=!C.classList.contains("notes-editor--columns");s(Le);try{localStorage.setItem(i,Le?"1":"0")}catch{p("Column preference saved for this session only")}return}if(!o){p("Formatting controls are not supported in this browser");return}C.focus(),J==="bullets"?document.execCommand("insertUnorderedList"):J==="numbers"&&document.execCommand("insertOrderedList")})}if(gn(),fe?.addEventListener("click",qt),Mt)({initializeApp:Ie,getFirestore:xe,enableMultiTabIndexedDbPersistence:Ne,enableIndexedDbPersistence:Me,doc:ce,setDoc:$e,deleteDoc:Re,onSnapshot:Fe,collection:Oe,query:Be,orderBy:Pe,serverTimestamp:ye,getAuth:ge,onAuthStateChanged:He,GoogleAuthProvider:je,signInWithPopup:Ue,signInWithRedirect:qe,getRedirectResult:_e,signOut:We}=Mt),be=!0;else try{({initializeApp:Ie}=await mt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:xe,enableMultiTabIndexedDbPersistence:Ne,enableIndexedDbPersistence:Me,doc:ce,setDoc:$e,deleteDoc:Re,onSnapshot:Fe,collection:Oe,query:Be,orderBy:Pe,serverTimestamp:ye}=await mt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:ge,onAuthStateChanged:He,GoogleAuthProvider:je,signInWithPopup:Ue,signInWithRedirect:qe,getRedirectResult:_e,signOut:We}=await mt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),be=!0}catch(e){be=!1,console.warn("Firebase modules failed to load:",e),p("Firebase failed to load; notes available offline"),Ve(!1)}if(be&&typeof Ie=="function"&&typeof xe=="function"&&typeof ge=="function")try{yt=Ie({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),W=xe(yt),j=!0,Ve(!0)}catch(e){j=!1,console.warn("Firebase initialization failed:",e),p("Firebase failed to load; notes available offline"),Ve(!1)}else be?(j=!1,Ve(!1)):j=!1;j&&typeof Ne=="function"&&typeof Me=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ne(W),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Me(W),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),j&&typeof ge=="function"&&(ee=ge(yt));function hn(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let bn=typeof navigator<"u"&&navigator.language?navigator.language:"",Rt=hn(bn),de=Rt||"en-US",V="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(V=e.timeZone),!Rt&&e.locale&&(de=e.locale)}catch{}let vn=new Intl.DateTimeFormat(de,{timeZone:V,hour:"2-digit",minute:"2-digit"}),wn=new Intl.DateTimeFormat(de,{timeZone:V,weekday:"long",day:"numeric",month:"long"}),Sn=new Intl.DateTimeFormat("en-CA",{timeZone:V,year:"numeric",month:"2-digit",day:"2-digit"}),En=new Intl.DateTimeFormat(de,{timeZone:V,weekday:"long"}),Ln=new Intl.DateTimeFormat(de,{timeZone:V,month:"short",day:"numeric"});function Q(e){let t=Sn.formatToParts(e),n=t.find(r=>r.type==="year").value,i=t.find(r=>r.type==="month").value,o=t.find(r=>r.type==="day").value;return`${n}-${i}-${o}`}function Ft(e,t){let[n,i,o]=e.split("-").map(l=>parseInt(l,10)),[r,d]=t.split(":").map(l=>parseInt(l,10)),s=new Date;return s.setFullYear(n,(i||1)-1,o||1),s.setHours(r||0,d||0,0,0),s.toISOString()}let An=new Intl.DateTimeFormat("en-CA",{timeZone:V,year:"numeric",month:"2-digit",day:"2-digit"}),kn=new Intl.DateTimeFormat("en-CA",{timeZone:V,hour:"2-digit",minute:"2-digit",hour12:!1});function Cn(e){try{let t=new Date(e),n=An.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",o=n.find(d=>d.type==="month")?.value||"00",r=n.find(d=>d.type==="day")?.value||"00";return`${i}-${o}-${r}`}catch{return""}}function Dn(e){try{let t=new Date(e),n=kn.formatToParts(t),i=n.find(r=>r.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(r=>r.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function Je(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function ze(){return Q(new Date)}function Tn(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Kn(e){let t=Tn(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Ge(e){return e==="High"?3:e==="Medium"?2:1}function Xn(e,t){let n=Ge(t.priority)-Ge(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function bt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return wn.format(t)}catch{return e}}function vt(e){return vn.format(e)}function ne(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Ot(e){return e?ne(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function p(e){rt&&(rt.textContent=e,clearTimeout(p._t),p._t=setTimeout(()=>rt.textContent="",2500))}function In(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Qe(e){e=String(e||"").toLowerCase();let t={date:ze(),time:""},n=s=>{let l=new Date,u=l.getDay(),g=(s-u+7)%7,w=new Date(l);return w.setDate(l.getDate()+(g===0?7:g)),w},i=s=>{let l=new Date,u=l.getDay(),g=(s-u+7)%7,w=new Date(l);return w.setDate(l.getDate()+g),w},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},r={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let s=new Date;s.setDate(s.getDate()+1),t.date=Q(s)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let s=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),l=o[s[1]],u=n(l);t.date=Q(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let s=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),l=o[s[1]],u=i(l);t.date=Q(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let s=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),l=o[s[1]],u=n(l);t.date=Q(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let s=e.match(/\bin\s+(\d+)\s+days?\b/),l=parseInt(s[1],10),u=new Date;u.setDate(u.getDate()+l),t.date=Q(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let s=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),l=parseInt(s[1],10),u=parseInt(s[2],10)-1,g=s[3]?parseInt(s[3],10):new Date().getFullYear(),w=new Date(g,u,l);t.date=Q(w)}else for(let[s,l]of Object.entries(r)){let u=new RegExp(`\\b${s}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let g=e.match(u),w=parseInt(g[1],10),F=new Date().getFullYear(),J=new Date(F,l,w);t.date=Q(J);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let s=parseInt(d[1],10),l=d[2]?parseInt(d[2],10):0,u=d[3];u&&(u==="pm"&&s<12&&(s+=12),u==="am"&&s===12&&(s=0)),t.time=`${String(s).padStart(2,"0")}:${String(l).padStart(2,"0")}`}return t}let Ze=j&&ee&&typeof je=="function";it?.addEventListener("click",async()=>{if(!Ze||typeof Ue!="function"||typeof qe!="function"){p("Sign-in unavailable offline");return}let e=new je;try{await Ue(ee,e)}catch{try{await qe(ee,e)}catch{p("Google sign-in failed")}}}),Ze&&typeof _e=="function"&&_e(ee).catch(()=>{}),ot?.addEventListener("click",async()=>{if(!Ze||typeof We!="function"){p("Sign-out unavailable offline");return}try{await We(ee),p("Signed out")}catch{p("Sign-out failed")}}),Ze&&typeof He=="function"?He(ee,async e=>{e?(M=e.uid,at("online"),it?.classList.add("hidden"),ot?.classList.remove("hidden"),Ce&&(Ce.textContent=e.displayName||e.email||""),xn(),await yn()):$t()}):$t();function xn(){if(!j||!W||typeof Oe!="function"||typeof Be!="function"||typeof Pe!="function"||typeof Fe!="function")return;if(!M){ht(),T(),$(),Z();return}we&&we();let e=Oe(W,"users",M,"reminders"),t=Be(e,Pe("updatedAt","desc"));we=Fe(t,n=>{let i=[];n.forEach(o=>{let r=o.data();i.push({id:o.id,title:r.title,priority:r.priority,notes:r.notes||"",done:!!r.done,due:r.due||null,category:A(r.category),createdAt:r.createdAt?.toMillis?.()||0,updatedAt:r.updatedAt?.toMillis?.()||0,pendingSync:!1})}),m=i,T(),$(),Z()},n=>{console.error("Firestore sync error:",n),E&&at("error","Sync Error")})}async function ie(e){if(!(!j||!M||!W||typeof ce!="function"||typeof $e!="function"||typeof ye!="function"))try{await $e(ce(W,"users",M,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||R,createdAt:e.createdAt?new Date(e.createdAt):ye(),updatedAt:ye()},{merge:!0})}catch(t){console.error("Save failed:",t),p("Save queued (offline)")}}async function Nn(e){if(!(!j||!M||!W||typeof ce!="function"||typeof Re!="function"))try{await Re(ce(W,"users",M,"reminders",e))}catch{p("Delete queued (offline)")}}async function Ye(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||R,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ee(){v&&(v.value=""),O&&(O.value=""),P&&(P.value=""),H&&(H.value=""),Te("Medium"),L&&(L.value=R),It(),Se=null,fe&&(fe.textContent="Save Cue"),nt?.classList.add("hidden")}function Bt(e){let t=m.find(n=>n.id===e);t&&(v&&(v.value=t.title||""),O&&P&&(t.due?(O.value=Cn(t.due),P.value=Dn(t.due)):(O.value="",P.value="")),Te(t?.priority||"Medium"),L&&(L.value=A(t.category)),H&&(H.value=typeof t.notes=="string"?t.notes:""),Se=e,fe&&(fe.textContent="Update Cue"),nt?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),v?.focus(),se("cue:open",{mode:"edit"}))}function Mn(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=A(e.category??(L?L.value:"")),o={id:Je(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!M};return m=[o,...m],ve=!0,T(),$(),Dt(o),ie(o),Ye(o),le(o),pt(),se("memoryCue:remindersUpdated",{items:m}),Nt(),_({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function $n(e,t){if(!M)return p("Sign in to add notes"),null;if(!e)return null;let n=m.find(d=>d.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let r=typeof n.notes=="string"?n.notes:"";return n.notes=r?`${r}
${o}`:o,n.updatedAt=Date.now(),ie(n),T(),$(),_({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Pt(e){let t=m.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),ie(t),Ye(t),T(),$(),t.done?(Xe(e),_({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(le(t),_({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Ht(e){let t=m.find(n=>n.id===e);m=m.filter(n=>n.id!==e),T(),$(),Nn(e),Xe(e),_(t?{action:"deleted",label:`Reminder removed \xB7 ${t.title}`}:{action:"deleted",label:"Reminder removed"})}function wt(){localStorage.setItem("scheduledReminders",JSON.stringify(D))}function Ke(e,{closeNotification:t=!0}={}){if(t){let n=G.get(e);if(n){try{n.close()}catch{}G.delete(e)}}te[e]&&(clearTimeout(te[e]),delete te[e]),Lt(e),D[e]&&(delete D[e],wt())}function Xe(e){Ke(e)}function jt(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=G.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:"Due now",tag:e.id});G.set(e.id,n);let i=()=>{G.get(e.id)===n&&G.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Rn(e){if(!ue())return!1;let t=zt();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Ae();if(!i)return!1;await Lt(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||R,urlPath:fn},r=typeof e.notes=="string"&&e.notes.split(/\r?\n/).find(l=>l.trim())||"",d=r||"Due now";try{let l=new Date(e.due);if(!Number.isNaN(l.getTime())){let u=vt(l);u&&(d=r?`${r} \u2022 ${u}`:`Due ${u}`)}}catch{}let s={body:d,tag:e.id,data:o,renotify:!0};n>Date.now()&&(s.showTrigger=new t(n));try{return await i.showNotification(e.title,s),!0}catch(l){return console.warn("Failed to schedule persistent notification",l),!1}}function le(e){if(!e||!e.id)return;if(e.category=A(e.category),!e.due||e.done){Xe(e.id);return}let t={id:e.id,title:e.title,due:e.due,category:e.category||R};if(D[e.id]=t,wt(),te[e.id]&&(clearTimeout(te[e.id]),delete te[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return;let i=n-Date.now();if(i<=0){if(D[e.id]?.viaTrigger){Ke(e.id,{closeNotification:!1});return}jt(e),Ke(e.id,{closeNotification:!1});return}let o=ue();o&&(t.viaTrigger=!1,Rn(e).then(r=>{r&&D[e.id]&&(D[e.id]={...D[e.id],viaTrigger:!0},wt())})),te[e.id]=setTimeout(()=>{o&&Lt(e.id),jt(e),Ke(e.id,{closeNotification:!1})},i)}function Z(){Object.values(D).forEach(e=>le({...e,category:A(e?.category)}))}let Ut={High:"bg-rose-400/80 dark:bg-rose-300/80",Medium:"bg-amber-400/80 dark:bg-amber-300/80",Low:"bg-emerald-400/80 dark:bg-emerald-300/80"};function Fn(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=En.format(t),i=Ln.format(t),o=vt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function T(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),At)try{At.textContent=String(m.length)}catch{}m.forEach(a=>{a&&typeof a=="object"&&(a.category=A(a.category))});let o=new Set(Gn.map(a=>A(a)));m.forEach(a=>{a&&typeof a=="object"&&o.add(A(a.category))});let r=Array.from(o).sort((a,y)=>a.localeCompare(y,void 0,{sensitivity:"base"}));if(ct){let a=new Set;Array.from(ct.querySelectorAll("option")).forEach(y=>{a.add(y.value.trim().toLowerCase())}),r.forEach(y=>{let h=y.toLowerCase();if(!a.has(h)){let S=document.createElement("option");S.value=y,ct.appendChild(S),a.add(h)}})}if(ve)ve=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let a=m.map(y=>({...y}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:a}}));else if(document.createEvent){let y=document.createEvent("CustomEvent");y&&y.initCustomEvent&&(y.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:a}),document.dispatchEvent(y))}}catch{}}let d=m.slice(),s=(a,y)=>{let h=a.done?1:0,S=y.done?1:0;if(h!==S)return h-S;let z=a.due?new Date(a.due).getTime():1/0,oe=y.due?new Date(y.due).getTime():1/0;if(z!==oe)return z-oe;let b=Ge(y.priority)-Ge(a.priority);return b||(y.updatedAt||0)-(a.updatedAt||0)},l=!0;d.sort(s);let u=m.length>0,g=d.length>0;if(ae)if(g)ae.classList.add("hidden");else{let a=u?"No reminders to show right now.":ln;xt?xt(ae,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:a,action:u?void 0:`<button type="button" class="${un}" data-trigger="open-cue">Create reminder</button>`}):ae.textContent=a,ae.classList.remove("hidden")}if(kt&&kt.classList.toggle("has-items",g),!B)return;if(!g){ae?(B.innerHTML="",B.classList.add("hidden")):(B.innerHTML='<div class="text-muted">No reminders found.</div>',B.classList.remove("hidden"));return}B.classList.remove("hidden"),B.replaceChildren();let w=document.createDocumentFragment(),F=B.tagName==="UL"||B.tagName==="OL",J=!0,Le=(a,y)=>{let h=document.createElement("div");h.className="task-item"+(a.done?" completed":"");let S={id:a.id,title:a.title,dueIso:a.due||null,priority:a.priority||"Medium",category:y,done:!!a.done};h.dataset.category=y,h.dataset.reminder=JSON.stringify(S),h.dataset.id=S.id,h.dataset.title=S.title,h.dataset.priority=S.priority,h.dataset.done=String(S.done),S.dueIso&&(h.dataset.due=S.dueIso);let z=S.dueIso?new Date(S.dueIso):null;l&&z&&z>=n&&z<=i&&(h.classList.add("is-today"),h.dataset.today="true");let b=a.due?`${vt(new Date(a.due))} \u2022 ${bt(a.due.slice(0,10))}`:"No due date",k=`priority-${(a.priority||"Medium").toLowerCase()}`,q=a.notes?`<div class="task-notes">${Ot(a.notes)}</div>`:"";return h.innerHTML=`
        <input type="checkbox" ${a.done?"checked":""} aria-label="Mark complete" />
        <div class="task-content">
          <div class="task-title"><strong>${ne(a.title)}</strong></div>
          <div class="task-meta">
            <div class="task-meta-row" style="gap:8px; flex-wrap:wrap;">
              <span>${b}</span>
              <span class="priority-badge ${k}">${a.priority}</span>
              <span class="priority-badge" style="background:rgba(56,189,248,.14);color:#0284c7;border-color:rgba(56,189,248,.26);">${ne(y)}</span>
            </div>
          </div>
          ${q}
        </div>
        <div class="task-actions">
          <button class="btn-ghost" data-edit type="button">Edit</button>
          <button class="btn-ghost" data-del type="button">Del</button>
        </div>`,h.querySelector("input").addEventListener("change",()=>Pt(a.id)),h.querySelector("[data-edit]").addEventListener("click",()=>Bt(a.id)),h.querySelector("[data-del]").addEventListener("click",()=>Ht(a.id)),h};if(X!=="desktop"&&!J){d.forEach(a=>{let y=a.category||R;w.appendChild(Le(a,y))}),B.appendChild(w);return}let et=new Map;d.forEach(a=>{let y=a.category||R;et.has(y)||et.set(y,[]),et.get(y).push(a)});let Pn=Array.from(et.entries()).sort((a,y)=>a[0].localeCompare(y[0],void 0,{sensitivity:"base"})),_t=!0;Pn.forEach(([a,y])=>{let h=document.createElement(F?"li":"div");h.dataset.categoryHeading=a,F&&(h.setAttribute("role","presentation"),h.style.listStyle="none"),h.className=X==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",_t||(h.style.marginTop=X==="desktop"?"1.25rem":"1rem");let S=document.createElement("div");S.setAttribute("role","heading"),S.setAttribute("aria-level","3"),S.className=X==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let z=document.createElement("span");z.textContent=a;let oe=document.createElement("span");oe.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",oe.textContent=`${y.length} ${y.length===1?"item":"items"}`,S.append(z,oe),h.appendChild(S),w.appendChild(h),y.forEach(b=>{if(X==="desktop"){let k=document.createElement(F?"li":"div"),q={id:b.id,title:b.title,dueIso:b.due||null,priority:b.priority||"Medium",category:a,done:!!b.done};k.dataset.id=q.id,k.dataset.category=q.category,k.dataset.title=q.title,k.dataset.priority=q.priority,k.dataset.done=String(q.done),q.dueIso&&(k.dataset.due=q.dueIso),k.dataset.reminder=JSON.stringify(q),k.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let Hn=Fn(b),jn=Ut[b.priority]||Ut.Medium,Un=b.done?"line-through text-base-content/50":"text-base-content",qn=b.done?"Completed":"Active",_n=b.priority==="High"?"badge badge-outline border-error text-error":b.priority==="Medium"?"badge badge-outline border-warning text-warning":"badge badge-outline border-success text-success",Wn=b.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Vn=b.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Jn=b.notes?`<p class="text-sm leading-relaxed text-base-content/70">${Ot(b.notes)}</p>`:"";k.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${Un}">${ne(b.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ne(Hn)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ne(a)}
            </span>
            <span class="${_n} gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full ${jn}"></span>
              ${ne(b.priority)} priority
            </span>
            <span class="${Wn} text-[0.7rem] sm:text-xs">${qn}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Jn}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Vn}">${b.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,k.querySelector('[data-action="toggle"]').addEventListener("click",()=>Pt(b.id)),k.querySelector('[data-action="edit"]').addEventListener("click",()=>Bt(b.id)),k.querySelector('[data-action="delete"]').addEventListener("click",()=>Ht(b.id)),w.appendChild(k);return}w.appendChild(Le(b,a))}),_t=!1}),B.appendChild(w)}function U(){pe?.setAttribute("aria-expanded","false"),me?.classList.add("hidden")}function On(){pe?.setAttribute("aria-expanded","true"),me?.classList.remove("hidden")}pe?.addEventListener("click",e=>{e.stopPropagation(),pe.getAttribute("aria-expanded")==="true"?U():On()}),document.addEventListener("click",e=>{me&&!me.classList.contains("hidden")&&!me.contains(e.target)&&e.target!==pe&&U()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&U()}),rn?.addEventListener("click",()=>{let e=De?.classList.contains("hidden");De?.classList.toggle("hidden"),e&&De?.scrollIntoView({behavior:"smooth",block:"start"}),U()}),document.addEventListener("DOMContentLoaded",()=>{De?.classList.add("hidden")});function qt(){try{console.log("handleSaveAction invoked",{editingId:Se,title:v?.value})}catch{}if(Se){let i=m.find(s=>s.id===Se);if(!i){Ee();return}let o=v.value.trim();if(!o){p("Add a reminder title");return}let r=null;if(O.value||P.value){let s=O.value||ze(),l=P.value||"09:00";r=Ft(s,l)}else{let s=Qe(o);s.time&&(r=new Date(`${s.date}T${s.time}:00`).toISOString())}i.title=o;let d=lt();i.priority=d,Te(d),L&&(i.category=A(L.value)),i.due=r,H&&(i.notes=H.value.trim()),i.updatedAt=Date.now(),ie(i),Ye(i),ve=!0,T(),le(i),$(),pt(),se("memoryCue:remindersUpdated",{items:m}),Nt(),_({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Ee(),p("Reminder updated"),se("cue:close",{reason:"updated"});return}let e=v.value.trim();if(!e){p("Add a reminder title");return}let t=H?H.value.trim():"",n=null;if(O.value||P.value){let i=O.value||ze(),o=P.value||"09:00";n=Ft(i,o)}else{let i=Qe(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Mn({title:e,priority:lt(),category:L?L.value:"",due:n,notes:t}),v.value="",P.value="",H&&(H.value=""),se("cue:close",{reason:"created"})}v?.addEventListener("keydown",e=>{e.key==="Enter"&&qt()});function Bn(){if(!v||!K)return;let e=v.value.trim();if(!e){K.style.display="none";return}try{let t=Qe(e),n=ze();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${bt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(K.textContent=`Parsed: ${i}`,K.style.display="block"):K.style.display="none"}else K.style.display="none"}catch{K.style.display="none"}}return v?.addEventListener("input",In(Bn,300)),nt?.addEventListener("click",()=>{Ee(),p("Edit cancelled"),se("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Ee()}),document.addEventListener("cue:prepare",()=>{Ee()}),window.addEventListener("load",()=>v?.focus()),Xt?.addEventListener("click",()=>{let e=m.filter(t=>!t.done).map(t=>{let n=t.due?bt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(de,{hour:"2-digit",minute:"2-digit",timeZone:V}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){p("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>p("Copied for Master Task List")).catch(()=>p("Copy failed")),U()}),st?.addEventListener("change",()=>{let e=st.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(i=>{i.id=Je(),i.category=A(i.category),i.pendingSync=!M,m=[i,...m],ie(i)}),T(),$(),p("Import successful")}catch{p("Invalid JSON")}},t.readAsText(e),st.value="",U()}),en?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),U()}),tn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){p("Add your Apps Script URL in Settings first"),U();return}if(!m.length){p("No tasks to sync"),U();return}p("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<m.length;i+=t){let o=m.slice(i,i+t),r=await Promise.allSettled(o.map(d=>{let s={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||R,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}));n+=r.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}p(`Sync complete: ${m.length-n} ok${n?`, ${n} failed`:""}`),U()}),re&&(re.value=localStorage.getItem("syncUrl")||""),nn?.addEventListener("click",()=>{re&&(localStorage.setItem("syncUrl",re.value.trim()),p("Settings saved"))}),on?.addEventListener("click",async()=>{if(!re)return;let e=re.value.trim();if(!e){p("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});p(t.ok?"Test ok":"Test failed")}catch{p("Test failed")}}),Kt?.addEventListener("click",async()=>{if(!("Notification"in window)){p("Notifications not supported");return}if(Notification.permission==="granted"){p("Notifications enabled"),ue()&&Ae(),Z();return}try{await Notification.requestPermission()==="granted"?(p("Notifications enabled"),ue()&&Ae(),Z()):p("Notifications blocked")}catch{p("Notifications blocked")}}),Z(),T(),$(),{cancelReminder:Xe,scheduleReminder:le,closeActiveNotifications:Gt,getActiveNotifications:()=>G,addNoteToReminder:$n,__testing:{setItems(e=[]){m=Array.isArray(e)?e.map(t=>({...t,category:A(t?.category)})):[],T()},render:T,getItems:()=>m.map(e=>({...e}))}}}var Wt,G,Vt,St,tt,R,Gn,Et,Yn=zn(()=>{Wt="memoryCue:activity",G=new Map,Vt=!1,St="service-worker.js",tt=null,R="General",Gn=Object.freeze([R,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Et="memoryCue:offlineReminders"});export{ei as a,Yn as b};
