import{a as T,b as M}from"./chunk-HD4L4OQI.js";import{b as U}from"./chunk-RCZ4YZVR.js";var D=U(()=>{M();(function(){let n=document.getElementById("fabCreate"),t=document.getElementById("create-sheet"),p=document.getElementById("closeCreateSheet");if(!t||!p)return;t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open");let m=new Set;n&&m.add(n),document.querySelectorAll("[data-open-add-task]").forEach(s=>m.add(s));let g=Array.from(m).filter(s=>s instanceof HTMLElement),l=null,f=document.getElementById("priority"),y=document.getElementById("priorityChips");if(f&&y){let s=Array.from(y.querySelectorAll('input[name="priority"]')),S=f.value||"Medium",B=h=>{s.forEach(v=>{v.checked=v.value===h})},L=()=>{let h=f.value||"Medium";S=h,B(h)};s.forEach(h=>{h.addEventListener("change",()=>{h.checked&&f.value!==h.value&&(f.value=h.value,S=h.value,f.dispatchEvent(new Event("change",{bubbles:!0})))})}),f.addEventListener("change",L),L();let C=setInterval(()=>{if(!document.body.contains(f)){clearInterval(C);return}f.value!==S&&L()},250)}function i(s){l=s??null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open");let S=t.querySelector("input,select,textarea,button");S instanceof HTMLElement?S.focus():t instanceof HTMLElement&&t.focus()}function E(){t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open");let s=l&&document.body.contains(l)&&l||n;s&&typeof s.focus=="function"&&s.focus(),l=null}g.forEach(s=>{s.addEventListener("click",S=>{S.preventDefault(),S.stopPropagation(),i(s)})}),p.addEventListener("click",s=>{s.preventDefault(),E()}),t.addEventListener("click",s=>{s.target instanceof HTMLElement&&s.target.matches("[data-close]")&&E()}),t.addEventListener("keydown",s=>{s.key==="Escape"&&E()}),document.addEventListener("cue:open",()=>{i()}),document.addEventListener("cue:close",()=>{E()}),typeof window<"u"&&(window.closeAddTask=E)})();T({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",addQuickBtnSel:"#quickAdd",filterBtnsSel:"[data-filter]",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countTodaySel:"#todayCount",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(n=>{console.error("Failed to initialise reminders:",n)});(()=>{let n=document.getElementById("createReminderForm"),t=document.getElementById("saveReminder");!(n instanceof HTMLFormElement)||!(t instanceof HTMLButtonElement)||n.addEventListener("submit",p=>{p.preventDefault(),!t.matches(":disabled")&&t.click()})})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let p=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(p)});(function(){let n=document.querySelector('[data-view="today"]'),t=document.getElementById("reminderList");if(!n||!t)return;function p(g){let l=new Date(g);if(Number.isNaN(l.getTime()))return!1;let f=new Date;return l.getFullYear()===f.getFullYear()&&l.getMonth()===f.getMonth()&&l.getDate()===f.getDate()}function m(){let l=Array.from(t.querySelectorAll("[data-reminder]")).filter(y=>{let i=y.getAttribute("data-due"),E=y.querySelector("[data-due]"),s=i||(E?E.textContent:"")||"";return p(s.trim())});n.innerHTML="";let f=document.createElement("h2");if(f.textContent="Today",n.appendChild(f),l.forEach(y=>{n.appendChild(y.cloneNode(!0))}),!l.length){let y=document.createElement("p");y.textContent="No reminders due today.",n.appendChild(y)}}document.addEventListener("DOMContentLoaded",m),document.addEventListener("reminders:updated",m)})();(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let p=20;n.innerHTML="";let m=0;function g(){let y=t.slice(m,m+p);y.forEach(i=>n.appendChild(i)),m+=y.length}g();let l=document.createElement("div");l.id="listSentinel",n.appendChild(l);let f=new IntersectionObserver(y=>{y.some(i=>i.isIntersecting)&&m<t.length&&(g(),m>=t.length&&f.disconnect())});f.observe(l)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),p=document.getElementById("closeSettings");if(!n||!t||!p)return;function m(){t.classList.remove("hidden")}function g(){t.classList.add("hidden")}n.addEventListener("click",m),p.addEventListener("click",g),t.addEventListener("click",l=>{l.target instanceof HTMLElement&&l.target.matches("[data-close]")&&g()}),t.addEventListener("keydown",l=>{l.key==="Escape"&&g()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),p=document.getElementById("saveSyncSettings"),m=document.getElementById("testSync"),g=document.getElementById("syncAll"),l="syncUrl";if(!n)return;let f=["online","error"],y=null;function i(e,r){y=e,f.forEach(c=>n.classList.remove(c)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let a={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},d=typeof r=="string"&&r.trim()?r:a[e]||"";d&&(n.textContent=d),n.dataset.state=e}function E(){y!=="syncing"&&(navigator.onLine?y!=="online"&&i("online"):i("offline"))}function s(e){typeof localStorage>"u"||(e?localStorage.setItem(l,e):localStorage.removeItem(l))}function S(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(l)||""}catch{return""}}function B(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,a=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!a)return null;let d=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,c=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",u=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",o=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:a,dueIso:d&&d.trim()?d.trim():null,priority:c,category:u,done:o}}function L(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let a=r.dataset||{},d=null;if(a.reminder)try{d=JSON.parse(a.reminder)}catch{d=null}let c=d||{id:a.id||a.reminderId||r.getAttribute("data-id")||null,title:a.title||a.reminderTitle||"",dueIso:a.due||a.reminderDue||r.getAttribute("data-due")||null,priority:a.priority||a.reminderPriority||r.getAttribute("data-priority")||"",category:a.category||a.reminderCategory||r.getAttribute("data-category")||"",done:a.done==="true"||a.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!c.title){let u=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");u&&(c.title=u.textContent.trim())}if(!c.dueIso){let u=r.querySelector("[data-due], time");if(u){let o=u.getAttribute("datetime")||u.getAttribute("data-due");c.dueIso=o||u.textContent.trim()}}return B(c)}).filter(Boolean):[]}function C(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(d=>{if(!r.has(d)){r.add(d);try{let c=localStorage.getItem(d);if(!c)return;let u=JSON.parse(c);Array.isArray(u)?u.forEach(o=>e.push(o)):u&&typeof u=="object"&&(Array.isArray(u.items)&&u.items.forEach(o=>e.push(o)),Array.isArray(u.reminders)&&u.reminders.forEach(o=>e.push(o)))}catch{}}}),!e.length)for(let d=0;d<localStorage.length;d+=1){let c=localStorage.key(d);if(!(!c||r.has(c)||!/remind/i.test(c))){r.add(c);try{let u=localStorage.getItem(c);if(!u)continue;let o=JSON.parse(u);Array.isArray(o)?o.forEach(A=>e.push(A)):o&&typeof o=="object"&&(Array.isArray(o.items)&&o.items.forEach(A=>e.push(A)),Array.isArray(o.reminders)&&o.reminders.forEach(A=>e.push(A)))}catch{}}}return e.map(B).filter(Boolean)}function h(){let e=L();return e.length?e:C()}function v(e){e?(g?.setAttribute("aria-busy","true"),g?.setAttribute("disabled","disabled"),m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled")):(g?.removeAttribute("aria-busy"),m?.removeAttribute("aria-busy"),I())}function I(){!!((t?.value||"").trim()||S())?(g?.removeAttribute("disabled"),m?.removeAttribute("disabled")):(g?.setAttribute("disabled","disabled"),m?.setAttribute("disabled","disabled"))}let k=S();t&&k&&(t.value=k),I(),i(navigator.onLine?"online":"offline"),window.addEventListener("online",E),window.addEventListener("offline",E),t?.addEventListener("input",I),p?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){s(""),i("info","Sync URL cleared. Add a new one to enable syncing."),I();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{i("error","Enter a valid Apps Script URL before saving.");return}s(e),i("online","Sync settings saved."),I()}),m?.addEventListener("click",async()=>{let e=(t?.value||S()).trim();if(!e){i("error","Add your Apps Script URL in Settings first.");return}v(!0),i("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?i("online","Connection looks good."):i("error","Test failed. Please check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),i("error","Test failed. Please check your Apps Script deployment.")}finally{v(!1)}}),g?.addEventListener("click",async()=>{let e=(t?.value||S()).trim();if(!e){i("error","Add your Apps Script URL in Settings first.");return}let r=h();if(!r.length){i("info","No reminders to sync right now.");return}v(!0),i("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let a=20,d=0,c=0,u=o=>({id:o.id,title:o.title,dueIso:o.dueIso||null,priority:o.priority||"Medium",category:o.category||"General",done:!!o.done,source:"memory-cue-mobile"});try{for(let o=0;o<r.length;o+=a){let A=r.slice(o,o+a);(await Promise.allSettled(A.map(b=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u(b))})))).forEach(b=>{b.status==="fulfilled"&&b.value?.ok?d+=1:(b.status,c+=1)}),await new Promise(b=>setTimeout(b,300))}c?d?i("error",`Partial sync: ${d} success, ${c} failed.`):i("error","Sync failed. Please check your Apps Script URL and try again."):i("online",`Sync complete. ${d} reminder${d===1?"":"s"} updated.`)}catch(o){console.error("Sync failed",o),i("error","Sync failed. Please try again in a moment.")}finally{v(!1)}})})()});export default D();
