import{b as Bt,c as ir}from"./chunk-KX65DZXT.js";import{a as Mn,b as Pn,c as nr}from"./chunk-GUVSRPRW.js";function $n(r={}){try{Object.assign(R,r||{})}catch(a){console.warn("[supabase-auth] setAuthContext failed",a)}}async function Un(r={}){try{if(R&&typeof R.signInWithPopup=="function"&&R.auth&&typeof R.GoogleAuthProvider=="function")return R.signInWithPopup(R.auth,new R.GoogleAuthProvider);if(R&&typeof R.signInWithRedirect=="function"&&R.auth&&typeof R.GoogleAuthProvider=="function")return R.signInWithRedirect(R.auth,new R.GoogleAuthProvider);let a=Bt();if(a&&a.auth){if(typeof a.auth.signInWithOAuth=="function")return a.auth.signInWithOAuth({provider:"google",...r});if(typeof a.auth.signIn=="function")return a.auth.signIn({provider:"google"})}}catch(a){console.error("[supabase-auth] startSignInFlow error",a);try{R?.toast?.("Sign-in failed")}catch(d){console.warn("[supabase-auth] toast handler failed",d)}throw a}return Promise.resolve(null)}async function jn(){try{if(R&&typeof R.signOut=="function")return R.signOut(R.auth);let r=Bt();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function or(r){return r?Array.isArray(r)?r:[r]:[]}function tt(r){return Array.from(new Set(r.filter(a=>a instanceof HTMLElement||typeof SVGElement<"u"&&a instanceof SVGElement)))}function re(r,a){let d=or(a).filter(Boolean);if(!d.length)return[];let h=d.flatMap(T=>Array.from(r.querySelectorAll(T)));return tt(h)}function ar(r,a=document){let d=a instanceof Document||a instanceof HTMLElement?a:document;return{authForms:re(d,r.authForm),emailInputs:re(d,r.emailInput),signInButtons:re(d,r.signInButtons),signOutButtons:re(d,r.signOutButtons),userBadges:re(d,r.userBadge),userBadgeEmails:re(d,r.userBadgeEmail),userBadgeInitials:re(d,r.userBadgeInitial),userNameEls:re(d,r.userName),syncStatusEls:re(d,r.syncStatus),syncStatusTextEls:re(d,r.syncStatusText),statusIndicatorEls:re(d,r.statusIndicator),feedbackEls:re(d,r.feedback)}}function Qe(r,a){tt(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.classList.toggle("hidden",!a),a?d.removeAttribute("hidden"):d.setAttribute("hidden",""))})}function Ee(r,a){tt(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.textContent=a||"")})}function sr(r,a){tt(r).forEach(d=>{d instanceof HTMLElement&&(d.dataset.state=a,d.classList.toggle("online",a==="online"),d.classList.toggle("offline",a!=="online"))})}function et(r,a){tt(r).forEach(d=>{if(!(d instanceof HTMLElement))return;d.textContent=a||"";let h=!!a;d.classList.toggle("hidden",!h),h?d.removeAttribute("hidden"):d.setAttribute("hidden","")})}function Hn(r={}){let a={..._n.syncStatusText,...r.syncStatusText||{}};return{..._n,...r,syncStatusText:a}}function Ze(r,{user:a,messages:d}={}){let h=Hn(d),T=!!a;Qe(r.signInButtons,!T),Qe(r.authForms,!T),Qe(r.signOutButtons,T),Qe(r.userBadges,T);let k=typeof a?.email=="string"?a.email:"",F=k?k.charAt(0).toUpperCase():"U";T?(Ee(r.userBadgeEmails,k),Ee(r.userBadgeInitials,F),Ee(r.userNameEls,k)):(Ee(r.userBadgeEmails,""),Ee(r.userBadgeInitials,""),Ee(r.userNameEls,""));let X=typeof h.signedIn=="function"?h.signedIn(a):h.signedIn,C=typeof h.signedOut=="function"?h.signedOut(a):h.signedOut,z=T?X:C,Z=!T;r.syncStatusEls.length&&(Ee(r.syncStatusEls,z),r.syncStatusEls.forEach(oe=>{oe instanceof HTMLElement&&(oe.classList.toggle("online",T),oe.dataset.state=T?"online":"offline")}),Qe(r.syncStatusEls,Z));let I=T?h.syncStatusText?.signedIn:h.syncStatusText?.signedOut;Ee(r.syncStatusTextEls,I||""),sr(r.statusIndicatorEls,T?"online":"offline"),et(r.feedbackEls,"")}function dr(r,a){a.authForms.forEach(d=>{!(d instanceof HTMLFormElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("submit",async h=>{h.preventDefault();let T=a.emailInputs.find(F=>d.contains(F))||d.querySelector('input[type="email"]'),k=typeof T?.value=="string"?T.value.trim():"";if(!k){et(a.feedbackEls,"Enter an email address to continue.");return}try{let{error:F}=await r.auth.signInWithOtp({email:k});F?et(a.feedbackEls,F.message||"Unable to send magic link."):et(a.feedbackEls,"Magic link sent. Check your email.")}catch(F){et(a.feedbackEls,F?.message||"Unable to send magic link.")}}))})}function cr(r,a){a.signOutButtons.forEach(d=>{!(d instanceof HTMLElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(h){console.error("[supabase] Sign-out failed.",h)}}))})}function wr(r={}){let{supabase:a,scope:d=document,selectors:h={},messages:T={},disableButtonBinding:k=!1,onSessionChange:F}=r,X={...rr,...h},C=ar(X,d),z=Hn(T);Ze(C,{user:null,messages:z});let Z=a||Bt()||(typeof window<"u"?window.supabase:null);if(!Z)return{supabase:null,elements:C,applyAuthState:H=>Ze(C,{...H,messages:z}),destroy(){}};dr(Z,C),k||cr(Z,C);let I=[],{data:oe}=Z.auth.onAuthStateChange((H,N)=>{if(Ze(C,{user:N?.user??null,messages:z}),typeof F=="function")try{F(N?.user??null,N)}catch(O){console.error("[supabase] onSessionChange handler failed.",O)}});return oe?.subscription&&I.push(()=>{try{oe.subscription.unsubscribe()}catch{}}),Z.auth.getSession().then(({data:H,error:N})=>{N||Ze(C,{user:H?.session?.user??null,messages:z})}).catch(H=>{console.error("[supabase] getSession failed.",H)}),{supabase:Z,elements:C,applyAuthState:H=>Ze(C,{...H,messages:z}),destroy(){I.forEach(H=>{try{H()}catch{}})}}}var R,rr,_n,Wn=Pn(()=>{ir();R={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};rr={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},_n={signedOut:"Sign in to sync reminders across devices.",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Vn=nr((Er,nt)=>{var Rt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Yn(r){if(!r||typeof r!="object")return null;let a=Object.entries(r).filter(([d,h])=>typeof h=="string"&&h.trim()!=="");return a.length?Object.fromEntries(a):null}function ur(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},a=Yn(r?.__FIREBASE_CONFIG);if(a)return a;let d=Yn(r?.__ENV?.FIREBASE_CONFIG);if(d)return d;let T=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((k,[F,X])=>{let C=r?.__ENV?.[F]??r?.[F];return typeof C=="string"&&C.trim()!==""&&(k[X]=C),k},{});return Object.keys(T).length?T:null}function qn(){let r=ur();return r?{...Rt,...r}:{...Rt}}var Gn={DEFAULT_FIREBASE_CONFIG:Rt,getFirebaseConfig:qn};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=qn,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Rt}typeof nt<"u"&&nt.exports&&(nt.exports=Gn,nt.exports.default=Gn)});function pr(){if(ue)return{...ue};let a=cn()?.memoryCueFirebase;if(a&&typeof a.getFirebaseConfig=="function")return ue=a.getFirebaseConfig(),{...ue};if(typeof Mn=="function")try{let d=Vn();if(d){let h=typeof d.getFirebaseConfig=="function"?d.getFirebaseConfig:typeof d.default?.getFirebaseConfig=="function"?d.default.getFirebaseConfig:null;if(h)return ue=h(),{...ue}}}catch{}return a&&a.DEFAULT_FIREBASE_CONFIG?(ue={...a.DEFAULT_FIREBASE_CONFIG},{...ue}):(ue={...fr},{...ue})}function cn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Qn(){let r=cn(),a=r&&r.TimestampTrigger;return typeof a=="function"?a:null}function ge(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Qn()}function gr(){if(typeof window>"u"||!window.location)return nn;try{return new URL(nn,window.location.href).href}catch{return nn}}async function Ie(){return Ot||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Ot=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(gr()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),Ot))}async function Jn(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let a=await Ie();if(!a)return!1;let d=new Set;navigator.serviceWorker.controller&&d.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(T=>{let k=a[T];k&&d.add(k)});let h=!1;return d.forEach(T=>{try{T.postMessage(r),h=!0}catch(k){console.warn("Failed posting message to service worker",k)}}),h}catch(a){return console.warn("Unable to reach service worker",a),!1}}async function Mt(){if(ge())return!1;if(on)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(it)try{return await it}catch{}it=(async()=>{let r=await Ie();if(!r)return!1;let a=!1;if("periodicSync"in r)try{let d=await r.periodicSync.getTags();(!Array.isArray(d)||!d.includes(rn))&&await r.periodicSync.register(rn,{minInterval:15*60*1e3}),a=!0}catch(d){console.warn("Periodic background sync unavailable",d)}if(!a&&"sync"in r)try{await r.sync.register(rn),a=!0}catch(d){console.warn("Background sync unavailable",d)}return a})();try{let r=await it;return r&&(on=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),on=!1,!1}finally{it=null}}async function sn(r=[],{requestCheck:a=!1}={}){if(!ge()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let d=await Ie();if(!d)return;let h=await Jn({type:Kn.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(a&&await Jn({type:Kn.checkScheduledReminders}),!h&&typeof d.update=="function")try{await d.update()}catch{}}catch(d){console.warn("Failed syncing reminders with service worker",d)}}async function dn(r,a){if(ge())try{let d=a||await Ie();if(!d)return;let h=[];try{h=await d.getNotifications({tag:r,includeTriggered:!0})}catch{h=await d.getNotifications({tag:r})}for(let T of h)try{T.close()}catch{}}catch{}}function Zn(){for(let r of Array.from(pe.values()))try{r.close()}catch{}pe.clear()}function mr(){if(zn||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>Zn();["pagehide","beforeunload"].forEach(a=>{try{window.addEventListener(a,r)}catch{}}),zn=!0}function U(r){if(typeof r=="string"){let a=r.replace(/\s+/g," ").trim();if(a)return a}return j}async function Ar(r={}){let a=e=>e?document.querySelector(e):null,d=e=>e?Array.from(document.querySelectorAll(e)):[],h=a(r.titleSel),T=a(r.dateSel),k=a(r.timeSel),F=a(r.detailsSel),X=a(r.prioritySel),C=a(r.categorySel),z=a(r.saveBtnSel),Z=a(r.cancelEditBtnSel),I=a(r.listSel),oe=d(r.googleSignInBtnSel),H=d(r.googleSignOutBtnSel),N=a(r.statusSel),O=a(r.syncStatusSel),ei={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},ti=6e3,ee=null;function ke(e,{clearMessage:t=!0}={}){ee&&(e&&ee.tokenId!==e||(ee.timeoutId&&clearTimeout(ee.timeoutId),t&&N&&N.dataset.undoToken===ee.tokenId&&(typeof N.replaceChildren=="function"?N.replaceChildren():N.textContent="",delete N.dataset.undoToken,delete N.dataset.statusKind),ee=null))}function ni(e){if(!N)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Ki(e.tokenId)),e.button=i,typeof N.replaceChildren=="function"?N.replaceChildren(t,n,i):(N.textContent="",N.append(t,n,i)),N.dataset.statusKind="undo",N.dataset.undoToken=e.tokenId}function Pt(e,t){if(!O)return;let n=["online","offline","error"];n.forEach(s=>O.classList.remove(s)),n.includes(e)&&O.classList.add(e),O.dataset.state=e;let i=typeof t=="string"?t:ei[e]||"";e==="online"||e==="offline"?(O.textContent="",O.dataset.compact="true",i?(O.setAttribute("aria-label",i),O.setAttribute("title",i)):(O.removeAttribute("aria-label"),O.removeAttribute("title"))):(O.textContent=i,O.removeAttribute("data-compact"),i?(O.setAttribute("aria-label",i),O.setAttribute("title",i)):(O.removeAttribute("aria-label"),O.removeAttribute("title")))}let G=a(r.notesSel),ii=a(r.saveNotesBtnSel),ri=a(r.loadNotesBtnSel),un=a(r.countTotalSel),rt=a(r.googleUserNameSel),Ae=a(r.dateFeedbackSel),K=a(r.voiceBtnSel),oi=a(r.notifBtnSel),Me=a(r.moreBtnSel),Pe=a(r.moreMenuSel),ai=a(r.copyMtlBtnSel),_t=a(r.importFileSel),si=a(r.exportBtnSel),di=a(r.syncAllBtnSel),Ne=a(r.syncUrlInputSel),ci=a(r.saveSettingsSel),ui=a(r.testSyncSel),li=d(r.openSettingsSel),ot=a(r.settingsSectionSel),Fe=a(r.emptyStateSel),ln=a(r.listWrapperSel),$t=a(r.categoryOptionsSel),me=r.variant||"mobile",fi=typeof r.autoWireAuthButtons=="boolean"?r.autoWireAuthButtons:me!=="desktop",fn="mc:lastDefaults";function Ut(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(fn)||"{}")||{}}catch{return{}}}function pi(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(fn,JSON.stringify(e))}catch{}}function pn(e){let t=Ut(),n={category:U(e?.category||t.category||j),priority:e?.priority||t.priority||"Medium"};pi(n)}let gn='fieldset#priorityChips input[name="priority"]';function jt(){try{let e=document.querySelector(`${gn}:checked`);if(e&&e.value)return e.value}catch{}return X&&typeof X.value=="string"&&X.value?X.value:"Medium"}function at(e){let t=e||"Medium";X&&typeof X.value<"u"&&(X.value=t);try{let n=Array.from(document.querySelectorAll(gn));if(!n.length)return;let i=!1;if(n.forEach(o=>{let s=o.value===t;o.checked=s,i=i||s}),!i){let o=n.find(s=>s.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function mn(){let e=Ut();e.category&&C&&(C.value=e.category),e.priority&&at(e.priority)}mn();let J=typeof document<"u"?document.getElementById("quickAddInput"):null,gi=typeof document<"u"?document.getElementById("quickAddSubmit"):null,Q=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,Ht=null;function mi(e,t){let n=Date.now(),i=Ut(),o=typeof t=="string"&&t?t:null;return{id:It(),title:(e||"").trim(),priority:i.priority||jt(),category:U(i.category||C?.value||j),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!W}}async function Wt(){if(!J)return;if(typeof Ht=="function")try{Ht()}catch{}let e=(J.value||"").trim();if(!e)return;let t=null;try{let o=Ct(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=mi(e,t);zt(n,{position:"start"}),u.unshift(n),te(u);let i=Ve(u);Te=!0,P(),Y(),i?u.forEach(o=>q(o)):q(n),ze(n),Ce(n),we(),pn(n),_e();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}ae({action:"created",label:`Reminder added \xB7 ${n.title}`}),J.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Wt),gi?.addEventListener("click",()=>{Wt()}),J?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Wt())});function yi(){if(typeof HTMLElement>"u"||!(Q instanceof HTMLElement)||!(J instanceof HTMLInputElement)||Q.dataset.voiceBound==="true")return;if(Q.dataset.voiceBound="true",typeof window>"u"){Q.setAttribute("disabled","true"),Q.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){Q.setAttribute("disabled","true"),Q.setAttribute("aria-disabled","true"),Q.getAttribute("title")||(Q.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=c=>{n=c,Q.setAttribute("aria-pressed",c?"true":"false"),Q.dataset.listening=c?"true":"false",Q.classList.toggle("is-listening",c)},o=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",b=>{let v=b?.results?.[0]?.[0]?.transcript?.trim()||"";if(v){J.value=v;try{J.focus({preventScroll:!0})}catch{J.focus()}try{let S=J.value.length;typeof J.setSelectionRange=="function"&&J.setSelectionRange(S,S)}catch{}}});let f=()=>{i(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},s=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};Ht=s,Q.addEventListener("click",()=>{let c=o();if(c){if(n){s();return}try{c.start(),i(!0)}catch(f){console.warn("Quick add voice error:",f),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",s),i(!1)}yi(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&J&&(e.preventDefault(),J.focus())})));try{me==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let hi=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",yn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,bi=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",st=r.reminderLandingPath||(me==="desktop"?"index.html#reminders":"mobile.html"),ye=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function hn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function _e(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}C&&!C.value&&(C.value=j),ge()&&Ie();function ae(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Xn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Xn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function vi(){if(typeof HTMLElement>"u"||!(K instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&h instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&h instanceof HTMLTextAreaElement;if(!e&&!t||K.dataset.voiceBound==="true")return;if(K.dataset.voiceBound="true",typeof window>"u"){K.setAttribute("disabled","true"),K.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){K.setAttribute("disabled","true"),K.setAttribute("aria-disabled","true"),K.getAttribute("title")||(K.title="Voice input is not supported in this browser.");return}let i=null,o=!1,s=v=>{o=v,K.setAttribute("aria-pressed",v?"true":"false"),K.dataset.listening=v?"true":"false",K.classList.toggle("is-listening",v)},c=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",S=>{let L=S.results?.[0]?.[0]?.transcript?.trim()||"";if(L){h.value=L;try{h.focus({preventScroll:!0})}catch{try{h.focus()}catch{}}try{let B=h.value.length;typeof h.setSelectionRange=="function"&&h.setSelectionRange(B,B)}catch{}ae({action:"dictated",label:`Voice input captured \xB7 ${L}`})}});let v=()=>{s(!1)};return i.addEventListener("end",v),i.addEventListener("error",v),i},f=()=>{if(!(!o||!i)){try{i.stop()}catch{}s(!1)}};K.addEventListener("click",()=>{let v=c();if(v){if(o){f();return}try{v.start(),s(!0)}catch(S){console.warn("Speech recognition error:",S),s(!1)}}});let b=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",b),document.addEventListener("reminders:updated",b)),s(!1)}mr(),vi();let dt,ct,ut,lt,Be,ft,pt,gt,mt,yt,ht,$e,Ue,bt,vt,Yt,Gt,wt,qt,bn=r.firebaseDeps,Vt=typeof r.importModule=="function"?r.importModule:e=>import(e),je=cn(),He=!1,se=!1,Xt=null,le=null,We=null,u=[],Te=!1,W=null,Ye=null,Ge=null,Le={},_={};function te(e=u){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?An(t||{},n||{}):o-i})}function wi(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function qe(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),te(n);else{n=e.slice().sort(An);let i=n.length;n.forEach((o,s)=>{o.orderIndex=(i-s)*ce})}return e===u&&(u=n),n}function zt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=wi();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-ce||ce}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+ce||ce}}function Ve(e=u){if(!Array.isArray(e)||e.length<2)return!1;te(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],s=Number.isFinite(i?.orderIndex)?i.orderIndex:null,c=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(s==null||c==null||s<=c||s-c<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*ce;return e===u&&te(u),!0}let D={draggingId:null,dropTargetId:null,dropBefore:!0},vn=!1,p={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Si(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Xe(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function he(){I&&(I.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),I.classList.remove("drag-over-list"))}function Kt(){if(!I)return;let e=I.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),he(),D.draggingId=null,D.dropTargetId=null,D.dropBefore=!0}function wn(e,t,n){if(!e||e===t)return;let i=u.findIndex(B=>B?.id===e);if(i<0)return;let[o]=u.splice(i,1),s;if(!t)s=u.length;else{let B=u.findIndex($=>$?.id===t);if(B<0){u.splice(i,0,o);return}s=n?B:B+1}u.splice(s,0,o);let c=u[s-1],f=u[s+1],b=Number.isFinite(c?.orderIndex)?c.orderIndex:null,v=Number.isFinite(f?.orderIndex)?f.orderIndex:null,S;b!=null&&v!=null?S=(b+v)/2:b!=null?S=b-ce:v!=null?S=v+ce:S=ce,Number.isFinite(S)||(S=ce*(u.length+1)),o.orderIndex=S,te(u);let L=Ve(u);Te=!0,P(),Y(),L?u.forEach(B=>q(B)):q(o),_e(),ye("memoryCue:remindersUpdated",{items:u}),ae({action:"reordered",label:"Reminders reordered"})}function Ei(e){let t=Xe(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(D.draggingId=i,D.dropTargetId=null,D.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Ii(e){if(!D.draggingId)return;let t=Xe(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),D.dropTargetId=null,D.dropBefore=!1,he(),I?.classList.add("drag-over-list");return}if(t.dataset.id===D.draggingId){e.preventDefault(),he();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(D.dropTargetId!==t.dataset.id||D.dropBefore!==o)&&(he(),t.classList.add(o?"drag-over-before":"drag-over-after"),D.dropTargetId=t.dataset.id,D.dropBefore=o)}function Ai(e){let t=Xe(e.target);if(!t){I?.contains(e.relatedTarget)||he();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),I?.contains(e.relatedTarget)||I?.classList.remove("drag-over-list"))}function Ti(e){if(!D.draggingId)return;e.preventDefault();let t=Xe(e.target),n=t?.dataset.id||null,i=D.dropBefore;if(t){let o=t.getBoundingClientRect(),s=o.top+o.height/2;i=e.clientY<s}else n=null,i=!1;wn(D.draggingId,n,i),Kt()}function Li(){Kt()}function Ci(){!I||vn||(vn=!0,I.addEventListener("dragstart",Ei),I.addEventListener("dragover",Ii),I.addEventListener("drop",Ti),I.addEventListener("dragend",Li),I.addEventListener("dragleave",Ai),St())}function St(){if(!I||St._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){St._bound=!0;return}let t=6,n=160;function i(){p.longPressTimer&&(clearTimeout(p.longPressTimer),p.longPressTimer=null)}function o(){I&&(p.initialTouchAction!=null?I.style.touchAction=p.initialTouchAction:I.style.removeProperty("touch-action"))}function s({keepHighlights:w=!1}={}){if(i(),p.item&&p.pointerId!=null)try{p.item.hasPointerCapture?.(p.pointerId)&&p.item.releasePointerCapture(p.pointerId)}catch{}if(p.placeholder?.parentNode)try{p.placeholder.parentNode.removeChild(p.placeholder)}catch{}p.item&&(p.item.classList.remove("is-dragging"),p.originalStyles?p.item.setAttribute("style",p.originalStyles):p.item.removeAttribute("style")),o(),w||he(),Object.assign(p,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function c(w){return I?Array.from(I.querySelectorAll("[data-reminder-item]")).filter(y=>y!==w):[]}function f(w){let y=p.item;if(!y||p.ready)return;let x=y.getBoundingClientRect(),l=window.getComputedStyle(y);p.ready=!0,D.draggingId=y.dataset.id||null,p.offsetY=w.clientY-x.top,p.fixedX=x.left;let m=document.createElement("div");m.className="touch-drag-placeholder",m.setAttribute("aria-hidden","true"),m.style.height=`${x.height}px`,m.style.boxSizing="border-box",m.style.marginTop=l.marginTop,m.style.marginBottom=l.marginBottom,m.style.marginLeft=l.marginLeft,m.style.marginRight=l.marginRight,m.style.borderRadius=l.borderRadius,m.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",m.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",m.style.pointerEvents="none",m.style.display="block",m.style.width="100%",y.parentNode?.insertBefore(m,y),p.placeholder=m,p.longPressTimer=null,p.originalStyles=y.getAttribute("style")||"",y.classList.add("is-dragging"),y.style.position="fixed",y.style.left=`${x.left}px`,y.style.top=`${x.top}px`,y.style.width=`${x.width}px`,y.style.zIndex="999",y.style.pointerEvents="none",y.style.touchAction="none",p.initialTouchAction=I.style.touchAction||"",I.style.touchAction="none"}function b(w){let y=p.item;if(!y||!p.ready)return;let x=w-p.offsetY;y.style.top=`${x}px`,y.style.left=`${p.fixedX}px`}function v(w){if(!p.ready||!I)return;let y=p.item,x=c(y);if(he(),!x.length){D.dropTargetId=null,D.dropBefore=!1;return}let l=null,m=!1;for(let ie of x){let Se=ie.getBoundingClientRect(),Oe=Se.top+Se.height/2;if(w<Oe){l=ie,m=!0;break}}if(!l){l=x[x.length-1];let ie=l.getBoundingClientRect(),Se=ie.top+ie.height/2;m=w<Se,m||(m=!1)}if(!l){D.dropTargetId=null,D.dropBefore=!1;return}let g=l.getBoundingClientRect(),E=g.top+g.height/2,M=w<E;l.classList.add(M?"drag-over-before":"drag-over-after"),D.dropTargetId=l.dataset.id||null,D.dropBefore=M}function S(w){let y=D.draggingId,x=p.moved;if(!p.ready){s();return}s(),!w&&x&&y&&wn(y,D.dropTargetId,D.dropBefore),Kt()}function L(w){let y=w.pointerType||"";if(y&&y!=="touch"&&y!=="pen"||p.active)return;let x=Xe(w.target);if(!x)return;let l=Si(w.target);if(!(l&&l!==x)){p.active=!0,p.pointerId=w.pointerId,p.item=x,p.startX=w.clientX,p.startY=w.clientY,p.lastClientX=w.clientX,p.lastClientY=w.clientY,p.moved=!1,p.ready=!1,p.originalStyles=x.getAttribute("style")||"",p.startTime=w.timeStamp||Date.now(),D.dropTargetId=null,D.dropBefore=!0,D.draggingId=null,i(),p.longPressTimer=setTimeout(()=>{f({clientY:p.lastClientY})},n);try{x.setPointerCapture(w.pointerId)}catch{}}}function B(w){if(!p.active||w.pointerId!==p.pointerId)return;let y=w.pointerType||"";if(!(y&&y!=="touch"&&y!=="pen")){if(p.lastClientX=w.clientX,p.lastClientY=w.clientY,!p.ready){let x=Math.abs(w.clientX-p.startX),l=Math.abs(w.clientY-p.startY);if(x>t||l>t){let m=typeof w.timeStamp=="number"?w.timeStamp:Date.now();Math.abs(m-p.startTime)>=n?(i(),f({clientY:p.lastClientY})):s()}return}w.preventDefault(),p.moved=!0,b(w.clientY),v(w.clientY)}}function $(w){!p.active||w.pointerId!==p.pointerId||S(!1)}function ne(w){!p.active||w.pointerId!==p.pointerId||S(!0)}I.addEventListener("pointerdown",L),window.addEventListener("pointermove",B),window.addEventListener("pointerup",$),window.addEventListener("pointercancel",ne),St._bound=!0}function Sn(){W=null,Pt("offline"),oe.forEach(e=>e.classList.remove("hidden")),H.forEach(e=>e.classList.add("hidden")),rt&&(rt.textContent=""),Ye?.(),Ye=null,Qt(),P(),Y(),we()}function Jt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(an);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,s=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:It(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:U(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(s)?s:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function xi(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(an);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:U(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(an,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function Y(){te(u),xi(u)}function Qt(){u=qe(Jt())}Qt();async function Di(){if(!W){u=Jt();return}let e=qe(Jt());if(!e.length){u=[],Y();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await q(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}u=qe(e.map(n=>({...n,pendingSync:!1}))),Y(),P(),we()}try{_=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{_={}}if(_&&typeof _=="object"&&Object.values(_).forEach(e=>{e&&typeof e=="object"&&(e.category=U(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Je(e),e.urlPath=e.urlPath||st,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!ge()){let e=kn();typeof Notification<"u"&&Notification.permission==="granted"?(Mt(),e.length&&sn(e,{requestCheck:!0})):e.length&&sn(e)}let Et=e=>{if(!je)return;let t=[je];je.window&&!t.includes(je.window)&&t.push(je.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function ki(){if(!G)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",s=()=>"value"in G?G.value:G.innerHTML,c=S=>{if("value"in G){G.value=S;return}if(typeof S!="string"||S.length===0){G.innerHTML="";return}let L=S.trim();if(/<\/?[a-z][\s\S]*>/i.test(L)){G.innerHTML=S;return}let $=S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");G.innerHTML=$},f=S=>{S?G.classList.add("notes-editor--columns"):G.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!S))},b="";try{b=localStorage.getItem(n)||""}catch{A("Unable to access saved notes")}c(b);let v=!1;try{v=localStorage.getItem(i)==="1"}catch{v=!1}f(v),G.addEventListener("input",()=>{b=s();try{localStorage.setItem(n,b)}catch{A("Notes saved for this session only")}}),ii?.addEventListener("click",()=>{b=s();try{localStorage.setItem(n,b),A("Notes saved")}catch{A("Notes saved for this session only")}}),ri?.addEventListener("click",()=>{let S=b;try{S=localStorage.getItem(n)||b}catch{A("Unable to load saved notes")}b=S,c(b)}),e?.addEventListener("click",S=>{let L=S.target;if(!(L instanceof Element))return;let B=L.closest("button[data-action]");if(!B)return;let $=B.getAttribute("data-action");if($==="columns"){let ne=!G.classList.contains("notes-editor--columns");f(ne);try{localStorage.setItem(i,ne?"1":"0")}catch{A("Column preference saved for this session only")}return}if(!o){A("Formatting controls are not supported in this browser");return}G.focus(),$==="bullets"?document.execCommand("insertUnorderedList"):$==="numbers"&&document.execCommand("insertOrderedList")})}if(ki(),z?.addEventListener("click",Fn),bn)({initializeApp:dt,getFirestore:ct,enableMultiTabIndexedDbPersistence:ut,enableIndexedDbPersistence:lt,doc:Be,setDoc:ft,deleteDoc:pt,onSnapshot:gt,collection:mt,query:yt,orderBy:ht,serverTimestamp:$e,getAuth:Ue,onAuthStateChanged:bt,GoogleAuthProvider:vt,signInWithPopup:Yt,signInWithRedirect:Gt,getRedirectResult:wt,signOut:qt}=bn),He=!0;else try{({initializeApp:dt}=await Vt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:ct,enableMultiTabIndexedDbPersistence:ut,enableIndexedDbPersistence:lt,doc:Be,setDoc:ft,deleteDoc:pt,onSnapshot:gt,collection:mt,query:yt,orderBy:ht,serverTimestamp:$e}=await Vt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ue,onAuthStateChanged:bt,GoogleAuthProvider:vt,signInWithPopup:Yt,signInWithRedirect:Gt,getRedirectResult:wt,signOut:qt}=await Vt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),He=!0}catch(e){He=!1,console.warn("Firebase modules failed to load:",e),A("Firebase failed to load; notes available offline"),Et(!1)}if(He&&typeof dt=="function"&&typeof ct=="function"&&typeof Ue=="function")try{let e=pr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Xt=dt(e),le=ct(Xt),se=!0,console.info("[Firebase] Firestore initialised",e.projectId),Et(!0)}catch(e){se=!1,console.warn("Firebase initialization failed:",e),A("Firebase failed to load; notes available offline"),Et(!1)}else He?(se=!1,Et(!1)):se=!1;se&&typeof ut=="function"&&typeof lt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await ut(le),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await lt(le),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),se&&typeof Ue=="function"&&(We=Ue(Xt));function Ni(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Fi=typeof navigator<"u"&&navigator.language?navigator.language:"",En=Ni(Fi),Re=En||"en-US",fe="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(fe=e.timeZone),!En&&e.locale&&(Re=e.locale)}catch{}let Bi=new Intl.DateTimeFormat(Re,{timeZone:fe,hour:"2-digit",minute:"2-digit"}),Ri=new Intl.DateTimeFormat(Re,{timeZone:fe,weekday:"long",day:"numeric",month:"long"}),Oi=new Intl.DateTimeFormat("en-CA",{timeZone:fe,year:"numeric",month:"2-digit",day:"2-digit"}),Mi=new Intl.DateTimeFormat(Re,{timeZone:fe,weekday:"long"}),Pi=new Intl.DateTimeFormat(Re,{timeZone:fe,month:"short",day:"numeric"});function be(e){let t=Oi.formatToParts(e),n=t.find(s=>s.type==="year").value,i=t.find(s=>s.type==="month").value,o=t.find(s=>s.type==="day").value;return`${n}-${i}-${o}`}function In(e,t){let[n,i,o]=e.split("-").map(b=>parseInt(b,10)),[s,c]=t.split(":").map(b=>parseInt(b,10)),f=new Date;return f.setFullYear(n,(i||1)-1,o||1),f.setHours(s||0,c||0,0,0),f.toISOString()}let _i=new Intl.DateTimeFormat("en-CA",{timeZone:fe,year:"numeric",month:"2-digit",day:"2-digit"}),$i=new Intl.DateTimeFormat("en-CA",{timeZone:fe,hour:"2-digit",minute:"2-digit",hour12:!1});function Ui(e){try{let t=new Date(e),n=_i.formatToParts(t),i=n.find(c=>c.type==="year")?.value||"0000",o=n.find(c=>c.type==="month")?.value||"00",s=n.find(c=>c.type==="day")?.value||"00";return`${i}-${o}-${s}`}catch{return""}}function ji(e){try{let t=new Date(e),n=$i.formatToParts(t),i=n.find(s=>s.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(s=>s.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function It(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function At(){return be(new Date)}function Hi(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function hr(e){let t=Hi(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Tt(e){return e==="High"?3:e==="Medium"?2:1}function An(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,s=t?.due?new Date(t.due).getTime():1/0;if(o!==s)return o-s;let c=Tt(t?.priority)-Tt(e?.priority);return c||(t?.updatedAt||0)-(e?.updatedAt||0)}function br(e,t){let n=Tt(t.priority)-Tt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Zt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Ri.format(t)}catch{return e}}function Lt(e){return Bi.format(e)}function ve(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Wi(e){return e?ve(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function A(e){N&&(ke(),N.dataset.statusKind="toast",N.textContent=e,clearTimeout(A._t),A._t=setTimeout(()=>{N&&N.dataset.statusKind==="toast"&&(N.textContent="",delete N.dataset.statusKind)},2500))}function Yi(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Ct(e){e=String(e||"").toLowerCase();let t={date:At(),time:""},n=f=>{let b=new Date,v=b.getDay(),S=(f-v+7)%7,L=new Date(b);return L.setDate(b.getDate()+(S===0?7:S)),L},i=f=>{let b=new Date,v=b.getDay(),S=(f-v+7)%7,L=new Date(b);return L.setDate(b.getDate()+S),L},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},s={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=be(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),b=o[f[1]],v=n(b);t.date=be(v)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),b=o[f[1]],v=i(b);t.date=be(v)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),b=o[f[1]],v=n(b);t.date=be(v)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),b=parseInt(f[1],10),v=new Date;v.setDate(v.getDate()+b),t.date=be(v)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),b=parseInt(f[1],10),v=parseInt(f[2],10)-1,S=f[3]?parseInt(f[3],10):new Date().getFullYear(),L=new Date(S,v,b);t.date=be(L)}else for(let[f,b]of Object.entries(s)){let v=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(v.test(e)){let S=e.match(v),L=parseInt(S[1],10),B=new Date().getFullYear(),$=new Date(B,b,L);t.date=be($);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let f=parseInt(c[1],10),b=c[2]?parseInt(c[2],10):0,v=c[3];v&&(v==="pm"&&f<12&&(f+=12),v==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(b).padStart(2,"0")}`}return t}let en=se&&We&&typeof vt=="function";$n({authReady:en,auth:We,GoogleAuthProvider:vt,signInWithPopup:Yt,signInWithRedirect:Gt,signOut:qt,toast:A});let Tn=fi,Ln=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Tn&&oe.length&&oe.forEach(e=>Ln(e,Un)),en&&typeof wt=="function"&&wt(We).catch(()=>{}),Tn&&H.length&&H.forEach(e=>Ln(e,jn)),en&&typeof bt=="function"?bt(We,async e=>{e?(W=e.uid,Pt("online"),oe.forEach(t=>t.classList.add("hidden")),H.forEach(t=>t.classList.remove("hidden")),rt&&(rt.textContent=e.displayName||e.email||""),Gi(),await Di()):Sn()}):Sn();function Gi(){if(!se||!le||typeof mt!="function"||typeof yt!="function"||typeof ht!="function"||typeof gt!="function")return;if(!W){Qt(),P(),Y(),we();return}Ye&&Ye();let e=mt(le,"users",W,"reminders"),t=yt(e,ht("updatedAt","desc"));Ye=gt(t,n=>{let i=[];n.forEach(o=>{let s=o.data(),c=Number(s.orderIndex);i.push({id:o.id,title:s.title,priority:s.priority,notes:s.notes||"",done:!!s.done,due:s.due||null,category:U(s.category),createdAt:s.createdAt?.toMillis?.()||0,updatedAt:s.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(c)?c:null})}),u=qe(i),P(),Y(),we()},n=>{console.error("Firestore sync error:",n),O&&Pt("error","Sync Error")})}async function q(e){if(!(!se||!W||!le||typeof Be!="function"||typeof ft!="function"||typeof $e!="function"))try{await ft(Be(le,"users",W,"reminders",e.id),{ownerUid:W,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||j,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):$e(),updatedAt:$e()},{merge:!0})}catch(t){console.error("Save failed:",t),A("Save queued (offline)")}}async function qi(e){if(!(!se||!W||!le||typeof Be!="function"||typeof pt!="function"))try{await pt(Be(le,"users",W,"reminders",e))}catch{A("Delete queued (offline)")}}async function ze(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||j,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ke(){h&&(h.value=""),T&&(T.value=""),k&&(k.value=""),F&&(F.value=""),at("Medium"),C&&(C.value=j),mn(),Ge=null,z&&(z.textContent="Save Cue"),Z?.classList.add("hidden")}function Cn(e){let t=u.find(n=>n.id===e);t&&(h&&(h.value=t.title||""),T&&k&&(t.due?(T.value=Ui(t.due),k.value=ji(t.due)):(T.value="",k.value="")),at(t?.priority||"Medium"),C&&(C.value=U(t.category)),F&&(F.value=typeof t.notes=="string"?t.notes:""),Ge=e,z&&(z.textContent="Update Cue"),Z?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),h?.focus(),ye("cue:open",{mode:"edit"}))}function Vi(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=U(e.category??(C?C.value:"")),o={id:It(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!W};zt(o,{position:"start"}),u=[o,...u],te(u);let s=Ve(u);return Te=!0,P(),Y(),pn(o),s?u.forEach(c=>q(c)):q(o),ze(o),Ce(o),_e(),ye("memoryCue:remindersUpdated",{items:u}),hn(),ae({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Xi(e,t){if(!W)return A("Sign in to add notes"),null;if(!e)return null;let n=u.find(c=>c.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let s=typeof n.notes=="string"?n.notes:"";return n.notes=s?`${s}
${o}`:o,n.updatedAt=Date.now(),q(n),P(),Y(),ae({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function zi(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),q(t),ze(t),P(),Y(),t.done?(Dt(e),ae({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ce(t),ae({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Ki(e){if(!ee||ee.tokenId!==e)return;let{item:t,index:n}=ee;if(!t){ke(e);return}ke(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!W,t.updatedAt=Date.now(),u.splice(i,0,t),te(u);let o=Ve(u);Te=!0,P(),Y(),Ce(t),o?u.forEach(s=>q(s)):q(t),ze(t),_e(),ye("memoryCue:remindersUpdated",{items:u}),ae({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),A("Reminder restored")}function xn(e){let t=u.findIndex(o=>o.id===e),n=t>=0?u.splice(t,1)[0]:null;P(),Y(),qi(e),Dt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(ae({action:"deleted",label:i}),n&&N){ke();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ee={tokenId:o,item:n,index:t,timeoutId:null},ni(ee),ee.timeoutId=setTimeout(()=>{ke(o)},ti)}else n&&ke()}function Ji(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,o=800,s='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',c=null,f=!1,b=0,v=0,S=0,L=()=>{if(f){if(f=!1,c!=null&&e.hasPointerCapture?.(c))try{e.releasePointerCapture(c)}catch{}c=null,e.removeEventListener("pointermove",$),e.removeEventListener("pointerup",ne),e.removeEventListener("pointercancel",w),e.removeEventListener("pointerleave",w),window.removeEventListener("pointerup",ne),window.removeEventListener("pointercancel",w)}},B=y=>{if(y.pointerType==="mouse"&&y.button!==0)return;f&&L();let x=y.target;x instanceof Element&&x.closest(s)||(c=y.pointerId,b=y.clientX,v=y.clientY,S=typeof y.timeStamp=="number"?y.timeStamp:Date.now(),f=!0,e.addEventListener("pointermove",$),e.addEventListener("pointerup",ne),e.addEventListener("pointercancel",w),e.addEventListener("pointerleave",w),window.addEventListener("pointerup",ne),window.addEventListener("pointercancel",w))},$=y=>{if(!f||y.pointerId!==c)return;Math.abs(y.clientY-v)>i&&L()},ne=y=>{if(!f||y.pointerId!==c)return;let x=y.clientX-b,l=Math.abs(y.clientY-v),m=(typeof y.timeStamp=="number"?y.timeStamp:Date.now())-S;if(L(),x<=-n&&l<=i&&m<=o){y.preventDefault(),y.stopPropagation();try{t()}catch(g){console.warn("Swipe delete handler failed",g)}}},w=y=>{f&&(typeof y.pointerId=="number"&&y.pointerId!==c||L())};e.addEventListener("pointerdown",B)}function Je(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=Lt(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=Lt(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function Dn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}A("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function kn(){return Object.values(_||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||j,notes:typeof e.notes=="string"?e.notes:"",body:Je(e),urlPath:e.urlPath||st,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function tn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(_))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=kn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Mt(),sn(e,{requestCheck:t})}function xt(e,{closeNotification:t=!0}={}){if(t){let n=pe.get(e);if(n){try{n.close()}catch{}pe.delete(e)}}Le[e]&&(clearTimeout(Le[e]),delete Le[e]),dn(e),_[e]&&(delete _[e],tn())}function Dt(e){xt(e)}function Nn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=pe.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Je(e),tag:e.id});pe.set(e.id,n);let i=()=>{pe.get(e.id)===n&&pe.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Qi(e){if(!ge())return!1;let t=Qn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Ie();if(!i)return!1;await dn(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||j,body:s,urlPath:st},s=Je(e),c={body:s,tag:e.id,data:o,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await i.showNotification(e.title,c),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function Ce(e){if(!e||!e.id)return;if(e.category=U(e.category),!e.due||e.done){Dt(e.id);return}let t=_[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||j,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Je(e),urlPath:st,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?f:null})()};if(_[e.id]=n,tn(),Le[e.id]&&(clearTimeout(Le[e.id]),delete Le[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(_[e.id]?.viaTrigger){xt(e.id,{closeNotification:!1});return}Nn(e),xt(e.id,{closeNotification:!1});return}let s=ge();s&&(n.viaTrigger=!1,Qi(e).then(c=>{c&&_[e.id]&&(_[e.id]={..._[e.id],viaTrigger:!0},tn())})),Le[e.id]=setTimeout(()=>{s&&dn(e.id),Nn(e),xt(e.id,{closeNotification:!1})},o)}function we(){Object.values(_).forEach(e=>Ce({...e,category:U(e?.category)}))}function Zi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Mi.format(t),i=Pi.format(t),o=Lt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function P(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),he(),te(u),un)try{un.textContent=String(u.length)}catch{}u.forEach(l=>{l&&typeof l=="object"&&(l.category=U(l.category))});let o=new Set(lr.map(l=>U(l)));u.forEach(l=>{l&&typeof l=="object"&&o.add(U(l.category))});let s=Array.from(o).sort((l,m)=>l.localeCompare(m,void 0,{sensitivity:"base"}));if($t){let l=new Set;Array.from($t.querySelectorAll("option")).forEach(m=>{l.add(m.value.trim().toLowerCase())}),s.forEach(m=>{let g=m.toLowerCase();if(!l.has(g)){let E=document.createElement("option");E.value=m,$t.appendChild(E),l.add(g)}})}if(Te)Te=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let l=u.map(m=>({...m}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:l}}));else if(document.createEvent){let m=document.createEvent("CustomEvent");m&&m.initCustomEvent&&(m.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:l}),document.dispatchEvent(m))}}catch{}}let c=u.slice();te(c);let f=!0,b=u.length>0,v=c.length>0,S=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let l=Object.values(_||{}).filter(m=>m&&typeof m=="object"&&m.id);return new Set(l.map(m=>m.id))})();if(Fe)if(v)Fe.classList.add("hidden");else{let l=b?"No reminders to show right now.":hi;yn?yn(Fe,{icon:b?"sparkles":"bell",title:b?"Nothing to display":"Create your first cue",description:l,action:b?void 0:`<button type="button" class="${bi}" data-trigger="open-cue">Create reminder</button>`}):Fe.textContent=l,Fe.classList.remove("hidden")}if(ln&&ln.classList.toggle("has-items",v),!I)return;if(!v){Fe?(I.innerHTML="",I.classList.add("hidden")):(I.innerHTML='<div class="text-muted">No reminders found.</div>',I.classList.remove("hidden"));return}I.classList.remove("hidden"),I.replaceChildren();let L=document.createDocumentFragment(),B=I.tagName==="UL"||I.tagName==="OL",$=!0,ne=(l,m)=>{let g=document.createElement("div");g.className="task-item";let E={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:m,done:!!l.done};g.dataset.category=m,g.dataset.reminder=JSON.stringify(E),g.dataset.id=E.id,g.dataset.title=E.title,g.dataset.priority=E.priority,g.dataset.done=String(E.done),g.dataset.orderIndex=Number.isFinite(l.orderIndex)?String(l.orderIndex):"",g.dataset.reminderItem="true",g.setAttribute("draggable","true"),g.classList.add("reminder-draggable"),g.setAttribute("role","button"),g.tabIndex=0,g.setAttribute("aria-label",`Edit reminder: ${l.title}`),E.dueIso&&(g.dataset.due=E.dueIso),S.has(E.id)?g.dataset.notificationActive="true":delete g.dataset.notificationActive;let M=E.dueIso?new Date(E.dueIso):null;f&&M&&M>=n&&M<=i&&(g.classList.add("is-today"),g.dataset.today="true");let Se=l.due?`${Lt(new Date(l.due))} \u2022 ${Zt(l.due.slice(0,10))}`:"No due date",Oe=l.due?ve(Se):"",kt=!!(m&&m!==j)?ve(m):"",Nt=`<span class="task-chip" data-chip="priority">${ve(E.priority)}</span>`,xe=[];Oe&&xe.push(Oe),kt&&xe.push(kt);let Ft=xe.length?`<div class="task-meta-text">${xe.join(" \u2022 ")}</div>`:"",V="";g.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${ve(l.title)}</strong></div>
          </div>
          ${Ft}
          <div class="task-meta">
            ${Nt}
          </div>
          ${V}
        </div>`,Ji(g,()=>xn(l.id));let On=()=>Cn(l.id);return g.addEventListener("click",De=>{De.defaultPrevented||On()}),g.addEventListener("keydown",De=>{De.defaultPrevented||De.target===g&&(De.key==="Enter"||De.key===" ")&&(De.preventDefault(),On())}),g};if(me!=="desktop"&&!$){c.forEach(l=>{let m=l.category||j;L.appendChild(ne(l,m))}),I.appendChild(L);return}let w=new Map;c.forEach(l=>{let m=l.category||j;w.has(m)||w.set(m,[]),w.get(m).push(l)});let y=Array.from(w.entries()).sort((l,m)=>l[0].localeCompare(m[0],void 0,{sensitivity:"base"})),x=!0;y.forEach(([l,m])=>{if(l!==j){let g=document.createElement(B?"li":"div");g.dataset.categoryHeading=l,B&&(g.setAttribute("role","presentation"),g.style.listStyle="none"),g.className=me==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",x||(g.style.marginTop=me==="desktop"?"1.25rem":"1rem");let E=document.createElement("div");E.setAttribute("role","heading"),E.setAttribute("aria-level","3"),E.className=me==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let M=document.createElement("span");M.textContent=l;let ie=document.createElement("span");ie.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",ie.textContent=`${m.length} ${m.length===1?"item":"items"}`,E.append(M,ie),g.appendChild(E),L.appendChild(g)}m.forEach(g=>{if(me==="desktop"){let E=document.createElement(B?"li":"div"),M={id:g.id,title:g.title,dueIso:g.due||null,priority:g.priority||"Medium",category:l,done:!!g.done};E.dataset.id=M.id,E.dataset.category=M.category,E.dataset.title=M.title,E.dataset.priority=M.priority,E.dataset.done=String(M.done),M.dueIso&&(E.dataset.due=M.dueIso),E.dataset.reminder=JSON.stringify(M),E.dataset.orderIndex=Number.isFinite(g.orderIndex)?String(g.orderIndex):"",E.dataset.reminderItem="true",E.dataset.compact="true",E.setAttribute("draggable","true"),E.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200 task-item",S.has(M.id)?E.dataset.notificationActive="true":delete E.dataset.notificationActive;let ie=Zi(g),Se=g.done?"line-through text-base-content/50":"text-base-content",Oe=g.done?"Completed":"Active",Bn=g.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",kt=g.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Rn=g.notes?`<p class="text-sm leading-relaxed text-base-content/70">${Wi(g.notes)}</p>`:"";E.innerHTML=`
    <div class="card-body gap-4 task-content">
      <div class="flex items-start justify-between gap-3 task-header">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold task-title ${Se}">${ve(g.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70 task-meta">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ve(ie)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ve(l)}
            </span>
            <span class="${Bn} text-[0.7rem] sm:text-xs">${Oe}</span>
          </div>
        </div>
        <button type="button" data-action="delete" class="btn btn-ghost btn-circle btn-sm text-error" aria-label="Delete reminder">
          <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
        </button>
      </div>
      ${Rn}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${kt}">${g.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,E.setAttribute("role","button"),E.tabIndex=0,E.setAttribute("aria-label",`Edit reminder: ${g.title}`);let Nt=E.querySelector('[data-action="delete"]');Nt&&Nt.addEventListener("click",V=>{V.stopPropagation(),xn(g.id)});let xe=E.querySelector('[data-action="toggle"]');xe&&xe.addEventListener("click",V=>{V.stopPropagation(),zi(g.id)});let Ft=()=>Cn(g.id);E.addEventListener("click",V=>{V.defaultPrevented||V.target.closest('[data-action="delete"], [data-action="toggle"]')||Ft()}),E.addEventListener("keydown",V=>{V.defaultPrevented||V.target===E&&(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),Ft())}),L.appendChild(E);return}L.appendChild(ne(g,l))}),x=!1}),I.appendChild(L)}function de(){Me?.setAttribute("aria-expanded","false"),Pe?.classList.add("hidden")}function er(){Me?.setAttribute("aria-expanded","true"),Pe?.classList.remove("hidden")}Me?.addEventListener("click",e=>{e.stopPropagation(),Me.getAttribute("aria-expanded")==="true"?de():er()}),document.addEventListener("click",e=>{Pe&&!Pe.classList.contains("hidden")&&!Pe.contains(e.target)&&e.target!==Me&&de()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&de()}),li.forEach(e=>{e.addEventListener("click",()=>{let t=ot?.classList.contains("hidden");ot?.classList.toggle("hidden"),t&&ot?.scrollIntoView({behavior:"smooth",block:"start"}),de()})}),document.addEventListener("DOMContentLoaded",()=>{ot?.classList.add("hidden")});function Fn(){try{console.log("handleSaveAction invoked",{editingId:Ge,title:h?.value})}catch{}if(Ge){let i=u.find(f=>f.id===Ge);if(!i){Ke();return}let o=h.value.trim();if(!o){A("Add a reminder title");return}let s=null;if(T.value||k.value){let f=T.value||At(),b=k.value||"09:00";s=In(f,b)}else{let f=Ct(o);f.time&&(s=new Date(`${f.date}T${f.time}:00`).toISOString())}i.title=o;let c=jt();i.priority=c,at(c),C&&(i.category=U(C.value)),i.due=s,F&&(i.notes=F.value.trim()),i.updatedAt=Date.now(),q(i),ze(i),Te=!0,P(),Ce(i),Y(),_e(),ye("memoryCue:remindersUpdated",{items:u}),hn(),ae({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Ke(),A("Reminder updated"),ye("cue:close",{reason:"updated"});return}let e=h.value.trim();if(!e){A("Add a reminder title");return}let t=F?F.value.trim():"",n=null;if(T.value||k.value){let i=T.value||At(),o=k.value||"09:00";n=In(i,o)}else{let i=Ct(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Vi({title:e,priority:jt(),category:C?C.value:"",due:n,notes:t}),h.value="",k.value="",F&&(F.value=""),ye("cue:close",{reason:"created"})}h?.addEventListener("keydown",e=>{e.key==="Enter"&&Fn()});function tr(){if(!h||!Ae)return;let e=h.value.trim();if(!e){Ae.style.display="none";return}try{let t=Ct(e),n=At();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Zt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Ae.textContent=`Parsed: ${i}`,Ae.style.display="block"):Ae.style.display="none"}else Ae.style.display="none"}catch{Ae.style.display="none"}}return h?.addEventListener("input",Yi(tr,300)),Z?.addEventListener("click",()=>{Ke(),A("Edit cancelled"),ye("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Ke()}),document.addEventListener("cue:prepare",()=>{Ke()}),window.addEventListener("load",()=>h?.focus()),ai?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?Zt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Re,{hour:"2-digit",minute:"2-digit",timeZone:fe}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){A("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>A("Copied for Master Task List")).catch(()=>A("Copy failed")),de()}),_t?.addEventListener("change",()=>{let e=_t.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(s=>{let c={...s,id:It(),category:U(s.category),pendingSync:!W,orderIndex:null};zt(c,{position:"start"}),u=[c,...u],i.push(c)}),te(u);let o=Ve(u);P(),Y(),o?u.forEach(s=>q(s)):i.forEach(s=>q(s)),A("Import successful")}catch{A("Invalid JSON")}},t.readAsText(e),_t.value="",de()}),si?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),de()}),di?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){A("Add your Apps Script URL in Settings first"),de();return}if(!u.length){A("No tasks to sync"),de();return}A("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<u.length;i+=t){let o=u.slice(i,i+t),s=await Promise.allSettled(o.map(c=>{let f={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||j,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=s.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}A(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),de()}),Ne&&(Ne.value=localStorage.getItem("syncUrl")||""),ci?.addEventListener("click",()=>{Ne&&(localStorage.setItem("syncUrl",Ne.value.trim()),A("Settings saved"))}),ui?.addEventListener("click",async()=>{if(!Ne)return;let e=Ne.value.trim();if(!e){A("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});A(t.ok?"Test ok":"Test failed")}catch{A("Test failed")}}),oi?.addEventListener("click",async()=>{if(!("Notification"in window)){A("Notifications not supported");return}if(Notification.permission==="granted"){A("Notifications enabled"),ge()?Ie():(Mt(),Dn()),we(),P();return}try{await Notification.requestPermission()==="granted"?(A("Notifications enabled"),ge()?Ie():(Mt(),Dn()),we(),P()):A("Notifications blocked")}catch{A("Notifications blocked")}}),Ci(),we(),P(),Y(),{cancelReminder:Dt,scheduleReminder:Ce,closeActiveNotifications:Zn,getActiveNotifications:()=>pe,addNoteToReminder:Xi,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:U(t?.category)})):[],u=qe(u),te(u),P()},render:P,getItems:()=>u.map(e=>({...e}))}}}var Xn,pe,zn,nn,rn,Kn,Ot,it,on,j,lr,an,ce,fr,ue,yr=Pn(()=>{Wn();Xn="memoryCue:activity",pe=new Map,zn=!1,nn="service-worker.js",rn="memory-cue-reminder-sync",Kn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Ot=null,it=null,on=!1,j="General",lr=Object.freeze([j,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),an="memoryCue:offlineReminders",ce=1024,fr=Object.freeze({}),ue=null});export{wr as a,Wn as b,Ar as c,yr as d};
