import{b as I,c as M}from"./chunk-CTK42JWW.js";import{b as w}from"./chunk-GUVSRPRW.js";function x(t){if(s?.toast&&typeof s.toast=="function")try{s.toast(t);return}catch{}if(!(typeof document>"u"))try{let n=document.createElement("div");n.textContent=t,n.setAttribute("role","alert"),n.setAttribute("aria-live","polite"),n.style.cssText=`
      position: fixed;
      bottom: ${k};
      left: 50%;
      transform: translateX(-50%);
      background: rgba(30, 30, 30, 0.95);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: ${C};
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 90%;
      text-align: center;
    `,document.body.appendChild(n),setTimeout(()=>{try{n.remove()}catch{}},F)}catch{}}function W(t={}){try{Object.assign(s,t||{})}catch(n){console.warn("[supabase-auth] setAuthContext failed",n)}}async function D(t={}){try{if(s&&typeof s.signInWithPopup=="function"&&s.auth&&typeof s.GoogleAuthProvider=="function")return s.signInWithPopup(s.auth,new s.GoogleAuthProvider);if(s&&typeof s.signInWithRedirect=="function"&&s.auth&&typeof s.GoogleAuthProvider=="function")return s.signInWithRedirect(s.auth,new s.GoogleAuthProvider);let n=I();if(n&&n.auth){if(typeof n.auth.signInWithOAuth=="function")return n.auth.signInWithOAuth({provider:"google",...t});if(typeof n.auth.signIn=="function")return n.auth.signIn({provider:"google"})}console.warn("[supabase-auth] No auth provider configured. Sign-in unavailable."),x("Sign-in is not available. Authentication service may be offline or not configured.")}catch(n){throw console.error("[supabase-auth] startSignInFlow error",n),x("Sign-in failed. Please try again."),n}return Promise.resolve(null)}async function R(){try{if(s&&typeof s.signOut=="function")return s.signOut(s.auth);let t=I();if(t&&t.auth&&typeof t.auth.signOut=="function")return t.auth.signOut()}catch(t){throw console.error("[supabase-auth] startSignOutFlow error",t),t}return Promise.resolve(null)}function _(t){return t?Array.isArray(t)?t:[t]:[]}function b(t){return Array.from(new Set(t.filter(n=>n instanceof HTMLElement||typeof SVGElement<"u"&&n instanceof SVGElement)))}function u(t,n){let e=_(n).filter(Boolean);if(!e.length)return[];let a=e.flatMap(i=>Array.from(t.querySelectorAll(i)));return b(a)}function B(t,n=document){let e=n instanceof Document||n instanceof HTMLElement?n:document;return{authForms:u(e,t.authForm),emailInputs:u(e,t.emailInput),signInButtons:u(e,t.signInButtons),signOutButtons:u(e,t.signOutButtons),userBadges:u(e,t.userBadge),userBadgeEmails:u(e,t.userBadgeEmail),userBadgeInitials:u(e,t.userBadgeInitial),userNameEls:u(e,t.userName),syncStatusEls:u(e,t.syncStatus),syncStatusTextEls:u(e,t.syncStatusText),statusIndicatorEls:u(e,t.statusIndicator),feedbackEls:u(e,t.feedback)}}function y(t,n){b(Array.isArray(t)?t:[t]).forEach(e=>{e instanceof HTMLElement&&(e.classList.toggle("hidden",!n),n?e.removeAttribute("hidden"):e.setAttribute("hidden",""))})}function f(t,n){b(Array.isArray(t)?t:[t]).forEach(e=>{e instanceof HTMLElement&&(e.textContent=n||"")})}function U(t,n){b(t).forEach(e=>{e instanceof HTMLElement&&(e.dataset.state=n,e.classList.toggle("online",n==="online"),e.classList.toggle("offline",n!=="online"))})}function E(t,n){b(t).forEach(e=>{if(!(e instanceof HTMLElement))return;e.textContent=n||"";let a=!!n;e.classList.toggle("hidden",!a),a?e.removeAttribute("hidden"):e.setAttribute("hidden","")})}function v(t={}){let n={...O.syncStatusText,...t.syncStatusText||{}};return{...O,...t,syncStatusText:n}}function S(t,{user:n,messages:e}={}){let a=v(e),i=!!n;y(t.signInButtons,!i),y(t.authForms,!i),y(t.signOutButtons,i),y(t.userBadges,i);let l=typeof n?.email=="string"?n.email:"",o=l?l.charAt(0).toUpperCase():"U";i?(f(t.userBadgeEmails,l),f(t.userBadgeInitials,o),f(t.userNameEls,l)):(f(t.userBadgeEmails,""),f(t.userBadgeInitials,""),f(t.userNameEls,""));let T=typeof a.signedIn=="function"?a.signedIn(n):a.signedIn,r=typeof a.signedOut=="function"?a.signedOut(n):a.signedOut,g=i?T:r,d=!i;t.syncStatusEls.length&&(f(t.syncStatusEls,g),t.syncStatusEls.forEach(h=>{h instanceof HTMLElement&&(h.classList.toggle("online",i),h.dataset.state=i?"online":"offline")}),y(t.syncStatusEls,d));let A=i?a.syncStatusText?.signedIn:a.syncStatusText?.signedOut;f(t.syncStatusTextEls,A||""),U(t.statusIndicatorEls,i?"online":"offline"),E(t.feedbackEls,"")}function P(t,n){n.authForms.forEach(e=>{!(e instanceof HTMLFormElement)||e.dataset.supabaseAuthBound==="true"||(e.dataset.supabaseAuthBound="true",e.addEventListener("submit",async a=>{a.preventDefault();let i=n.emailInputs.find(o=>e.contains(o))||e.querySelector('input[type="email"]'),l=typeof i?.value=="string"?i.value.trim():"";if(!l){E(n.feedbackEls,"Enter an email address to continue.");return}try{let{error:o}=await t.auth.signInWithOtp({email:l});o?E(n.feedbackEls,o.message||"Unable to send magic link."):E(n.feedbackEls,"Magic link sent. Check your email.")}catch(o){E(n.feedbackEls,o?.message||"Unable to send magic link.")}}))})}function H(t,n){n.signOutButtons.forEach(e=>{!(e instanceof HTMLElement)||e.dataset.supabaseAuthBound==="true"||(e.dataset.supabaseAuthBound="true",e.addEventListener("click",async()=>{try{await t.auth.signOut()}catch(a){console.error("[supabase] Sign-out failed.",a)}}))})}function q(t={}){let{supabase:n,scope:e=document,selectors:a={},messages:i={},disableButtonBinding:l=!1,onSessionChange:o}=t,T={...m,...a},r=B(T,e),g=v(i);S(r,{user:null,messages:g});let d=n||I()||(typeof window<"u"?window.supabase:null);if(!d)return{supabase:null,elements:r,applyAuthState:c=>S(r,{...c,messages:g}),destroy(){}};P(d,r),l||H(d,r);let A=[],{data:h}=d.auth.onAuthStateChange((c,p)=>{if(S(r,{user:p?.user??null,messages:g}),typeof o=="function")try{o(p?.user??null,p)}catch(L){console.error("[supabase] onSessionChange handler failed.",L)}});return h?.subscription&&A.push(()=>{try{h.subscription.unsubscribe()}catch{}}),d.auth.getSession().then(({data:c,error:p})=>{p||S(r,{user:c?.session?.user??null,messages:g})}).catch(c=>{console.error("[supabase] getSession failed.",c)}),{supabase:d,elements:r,applyAuthState:c=>S(r,{...c,messages:g}),destroy(){A.forEach(c=>{try{c()}catch{}})}}}function $(t={},n=document){return B({...m,...t},n)}var s,F,k,C,m,O,G=w(()=>{M();s={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null},F=4e3,k="80px",C=1e4;m={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},O={signedOut:"",signedIn:t=>`Reminders syncing for ${t?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});export{W as a,D as b,R as c,m as d,O as e,S as f,q as g,$ as h,G as i};
