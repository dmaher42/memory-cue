import{a as ho}from"./chunk-RCZ4YZVR.js";function gn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function hn(){let a=gn(),c=a&&a.TimestampTrigger;return typeof c=="function"?c:null}function Le(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!hn()}function wo(){if(typeof window>"u"||!window.location)return Rt;try{return new URL(Rt,window.location.href).href}catch{return Rt}}async function Be(){return gt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(gt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(wo()),await navigator.serviceWorker.ready}catch(a){return console.warn("Service worker registration failed",a),null}})(),gt))}async function Bt(a,c){if(Le())try{let A=c||await Be();if(!A)return;let _=[];try{_=await A.getNotifications({tag:a,includeTriggered:!0})}catch{_=await A.getNotifications({tag:a})}for(let b of _)try{b.close()}catch{}}catch{}}function vn(){for(let a of Array.from(Y.values()))try{a.close()}catch{}Y.clear()}function bo(){if(mn||typeof window>"u"||typeof window.addEventListener!="function")return;let a=()=>vn();["pagehide","beforeunload"].forEach(c=>{try{window.addEventListener(c,a)}catch{}}),mn=!0}function So(){if(yn||(yn=!0,typeof document>"u"))return;let a=document.getElementById("sheetVoiceBtn"),c=document.getElementById("quickAddMic"),A=document.getElementById("sheetVoiceStatus"),_=document.getElementById("quickAddInput"),b=document.getElementById("reminderText"),k=b||_,I=E=>!!E&&typeof E=="object"&&typeof E.addEventListener=="function",x=[a,c].filter(I);if(!x.length||!k)return;if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){A&&(A.textContent="Speech not supported",A.hidden=!1);return}let J=window.SpeechRecognition||window.webkitSpeechRecognition,S=new J;S.lang="en-US",S.interimResults=!1,S.maxAlternatives=1;let X=k,H=null;function P(E){if(!E)return k;let j=E.getAttribute?.("data-voice-target");if(j){let L=document.getElementById(j);if(L)return L}return E===c&&_?_:E===a&&b?b:k}function ke(E){let j=P(E);if(j){X=j,H=I(E)?E:null,H&&H.setAttribute("aria-pressed","true");try{A&&(A.hidden=!1,A.textContent="Listening\u2026"),S.start()}catch(L){console.warn("Speech recognition error:",L)}}}x.forEach(E=>{E.addEventListener("click",()=>ke(E))}),S.addEventListener("result",E=>{let j=E.results?.[0]?.[0]?.transcript?.trim()||"";if(!j){A&&(A.hidden=!0);return}let L=X||k;if(L&&(L.value=j,A&&(A.textContent="Added: "+j,A.hidden=!0),L&&L.id==="quickAddInput"))try{(typeof window<"u"?window.memoryCueQuickAddNow:null)?.()}catch{}}),S.addEventListener("end",()=>{H&&(H.setAttribute("aria-pressed","false"),H=null),A&&(A.hidden=!0)})}function C(a){if(typeof a=="string"){let c=a.replace(/\s+/g," ").trim();if(c)return c}return B}async function Io(a={}){let c=e=>e?document.querySelector(e):null,A=e=>e?Array.from(document.querySelectorAll(e)):[],_=c(a.qSel),b=c(a.titleSel),k=c(a.dateSel),I=c(a.timeSel),x=c(a.detailsSel),J=c(a.prioritySel),S=c(a.categorySel),X=c(a.saveBtnSel),H=c(a.cancelEditBtnSel),P=c(a.listSel),ke=c(a.googleSignInBtnSel),E=c(a.googleSignOutBtnSel),j=c(a.statusSel),L=c(a.syncStatusSel),F=c(a.notesSel),wn=c(a.saveNotesBtnSel),bn=c(a.loadNotesBtnSel),Pe=c(a.sortSel),ht=A(a.filterBtnsSel),Pt=e=>typeof e=="string"?e.trim().toLowerCase():"",je=new Map;ht.forEach(e=>{let t=e?.getAttribute("data-filter"),n=Pt(t);n&&!je.has(n)&&je.set(n,t)});let qe=Pt(a.defaultFilter),Sn=qe&&je.get(qe)||(qe&&!je.size?qe:null),jt=c(a.countTodaySel),qt=c(a.countWeekSel),Ut=c(a.countOverdueSel),_t=c(a.countTotalSel),Ht=c(a.countCompletedSel),ee=c(a.googleAvatarSel),Ue=c(a.googleUserNameSel),se=c(a.dateFeedbackSel),Wt=c(a.addQuickBtnSel),En=c(a.notifBtnSel),Ce=c(a.moreBtnSel),Ae=c(a.moreMenuSel),Ln=c(a.copyMtlBtnSel),vt=c(a.importFileSel),kn=c(a.exportBtnSel),Cn=c(a.syncAllBtnSel),ge=c(a.syncUrlInputSel),An=c(a.saveSettingsSel),Dn=c(a.testSyncSel),In=c(a.openSettingsSel),_e=c(a.settingsSectionSel),G=c(a.emptyStateSel),Vt=c(a.listWrapperSel),te=c(a.categoryFilterSel),wt=c(a.categoryOptionsSel),ce=a.variant||"mobile",zt="mc:lastDefaults";function bt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(zt)||"{}")||{}}catch{return{}}}function Tn(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(zt,JSON.stringify(e))}catch{}}function St(e){let t=bt(),n={category:C(e?.category||t.category||B),priority:e?.priority||t.priority||"Medium"};Tn(n)}let Jt='fieldset#priorityChips input[name="priority"]';function He(){try{let e=document.querySelector(`${Jt}:checked`);if(e&&e.value)return e.value}catch{}return J&&typeof J.value=="string"&&J.value?J.value:"Medium"}function We(e){let t=e||"Medium";J&&typeof J.value<"u"&&(J.value=t);try{let n=Array.from(document.querySelectorAll(Jt));if(!n.length)return;let i=!1;if(n.forEach(r=>{let d=r.value===t;r.checked=d,i=i||d}),!i){let r=n.find(d=>d.value==="Medium")||n[0];r&&(r.checked=!0)}}catch{}}function Gt(){let e=bt();e.category&&S&&(S.value=e.category),e.priority&&We(e.priority)}Gt();let he=typeof document<"u"?document.getElementById("quickAddInput"):null,xn=typeof document<"u"?document.getElementById("quickAddMic"):null,Nn=typeof document<"u"?document.getElementById("quickAddSubmit"):null;function Fn(e){let t=Date.now(),n=bt();return{id:Me(),title:(e||"").trim(),priority:n.priority||He(),category:C(n.category||S?.value||B),notes:"",done:!1,createdAt:t,updatedAt:t,due:null,pendingSync:!$}}async function Et(){if(!he)return;let e=(he.value||"").trim();if(!e)return;let t=Fn(e);f.unshift(t),we=!0,D(),O(),re(t),Re(t),pe(t),ae(),St(t),ze();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:f}}))}catch{}oe({action:"created",label:`Reminder added \xB7 ${t.title}`}),he.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Et),Nn?.addEventListener("click",()=>{Et()}),he?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Et())}),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q"?he&&(e.preventDefault(),he.focus()):(e.key==="m"||e.key==="M")&&e.altKey&&(e.preventDefault(),xn?.click()))})));try{ce==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Qt=a.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Zt=a.emptyStateFilteredText||"No reminders match the current filter. Adjust your filters or add a new cue.",Ve=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Mn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",$n=a.reminderLandingPath||(ce==="desktop"?"index.html#reminders":"mobile.html"),ne=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Lt(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function ze(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:f}}))}catch{}}Wt&&b&&Wt.addEventListener("click",()=>{let e=(b.value||"").trim();if(!e){try{b.focus()}catch{}return}let t=Date.now(),n=typeof k?.value=="string"&&k.value,i=typeof I?.value=="string"&&I.value,r=null;if(n||i)r=Tt(n?k.value:$e(),i?I.value:"09:00");else try{let m=ut(e);m?.time&&(r=new Date(`${m.date}T${m.time}:00`).toISOString())}catch{}let d={id:Me(),title:e,notes:typeof x?.value=="string"?x.value.trim():"",priority:He(),category:C(S?.value||B),done:!1,createdAt:t,updatedAt:t,due:r,pendingSync:!$};f.unshift(d),we=!0,D(),O(),St(d),re(d),Re(d),pe(d),ze(),ne("memoryCue:remindersUpdated",{items:f}),Lt(),ne("cue:close",{reason:"created"}),b.value="",typeof x?.value<"u"&&(x.value=""),typeof k?.value<"u"&&(k.value=""),typeof I?.value<"u"&&(I.value="")}),S&&!S.value&&(S.value=B),Le()&&Be();function oe(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let r=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(r.push(n);r.length>20;)r.shift();window.memoryCueActivityQueue=r}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(pn,{detail:n}));else if(document.createEvent){let r=document.createEvent("CustomEvent");r&&r.initCustomEvent&&(r.initCustomEvent(pn,!1,!1,n),document.dispatchEvent(r))}}catch{}}}bo(),So();let Je,Ge,Qe,Ze,ve,Ke,Ye,Xe,et,tt,nt,De,Ie,ot,it,rt,at,st,ct,Kt=a.firebaseDeps,kt=typeof a.importModule=="function"?a.importModule:e=>import(e),Te=gn(),xe=!1,W=!1,Ct=null,Q=null,de=null,f=[],dt=Sn||"all",le=te?.value||"all",Yt="memoryCue:sortPreference",At=new Set(["due","priority","category","recent"]),Z="due",we=!1,$=null,Ne=null,Fe=null,ue={},R={};if(typeof localStorage<"u")try{let e=localStorage.getItem(Yt);e&&At.has(e)&&(Z=e)}catch{}if(Pe&&Z)try{Pe.value=At.has(Z)?Z:"due"}catch{}function Xt(){$=null,L?.classList.remove("online","error"),L&&(L.classList.add("offline"),L.textContent="Offline"),ke?.classList.remove("hidden"),E?.classList.add("hidden"),ee&&(ee.classList.add("hidden"),ee.src=""),Ue&&(Ue.textContent=""),Ne?.(),Ne=null,It(),D(),O(),ae()}function Dt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Ot);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),r=Number.isFinite(n.updatedAt)?n.updatedAt:i;return{id:typeof n.id=="string"&&n.id?n.id:Me(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:C(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:r,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Rn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Ot);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:C(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem(Ot,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function O(){Rn(f)}function It(){f=Dt()}It();async function On(){if(!$){f=Dt();return}let e=Dt();if(!e.length){f=[],O();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await re(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}f=e.map(n=>({...n,pendingSync:!1})),O(),D(),ae()}try{R=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{R={}}R&&typeof R=="object"&&Object.values(R).forEach(e=>{e&&typeof e=="object"&&(e.category=C(e.category))});let lt=e=>{if(!Te)return;let t=[Te];Te.window&&!t.includes(Te.window)&&t.push(Te.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Bn(){if(!F)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",r=typeof document<"u"&&typeof document.execCommand=="function",d=()=>"value"in F?F.value:F.innerHTML,m=w=>{if("value"in F){F.value=w;return}if(typeof w!="string"||w.length===0){F.innerHTML="";return}let T=w.trim();if(/<\/?[a-z][\s\S]*>/i.test(T)){F.innerHTML=w;return}let q=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");F.innerHTML=q},l=w=>{w?F.classList.add("notes-editor--columns"):F.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!w))},u="";try{u=localStorage.getItem(n)||""}catch{p("Unable to access saved notes")}m(u);let g=!1;try{g=localStorage.getItem(i)==="1"}catch{g=!1}l(g),F.addEventListener("input",()=>{u=d();try{localStorage.setItem(n,u)}catch{p("Notes saved for this session only")}}),wn?.addEventListener("click",()=>{u=d();try{localStorage.setItem(n,u),p("Notes saved")}catch{p("Notes saved for this session only")}}),bn?.addEventListener("click",()=>{let w=u;try{w=localStorage.getItem(n)||u}catch{p("Unable to load saved notes")}u=w,m(u)}),e?.addEventListener("click",w=>{let T=w.target;if(!(T instanceof Element))return;let N=T.closest("button[data-action]");if(!N)return;let q=N.getAttribute("data-action");if(q==="columns"){let me=!F.classList.contains("notes-editor--columns");l(me);try{localStorage.setItem(i,me?"1":"0")}catch{p("Column preference saved for this session only")}return}if(!r){p("Formatting controls are not supported in this browser");return}F.focus(),q==="bullets"?document.execCommand("insertUnorderedList"):q==="numbers"&&document.execCommand("insertOrderedList")})}if(Bn(),X?.addEventListener("click",ln),Kt)({initializeApp:Je,getFirestore:Ge,enableMultiTabIndexedDbPersistence:Qe,enableIndexedDbPersistence:Ze,doc:ve,setDoc:Ke,deleteDoc:Ye,onSnapshot:Xe,collection:et,query:tt,orderBy:nt,serverTimestamp:De,getAuth:Ie,onAuthStateChanged:ot,GoogleAuthProvider:it,signInWithPopup:rt,signInWithRedirect:at,getRedirectResult:st,signOut:ct}=Kt),xe=!0;else try{({initializeApp:Je}=await kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Ge,enableMultiTabIndexedDbPersistence:Qe,enableIndexedDbPersistence:Ze,doc:ve,setDoc:Ke,deleteDoc:Ye,onSnapshot:Xe,collection:et,query:tt,orderBy:nt,serverTimestamp:De}=await kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ie,onAuthStateChanged:ot,GoogleAuthProvider:it,signInWithPopup:rt,signInWithRedirect:at,getRedirectResult:st,signOut:ct}=await kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),xe=!0}catch(e){xe=!1,console.warn("Firebase modules failed to load:",e),p("Firebase failed to load; notes available offline"),lt(!1)}if(xe&&typeof Je=="function"&&typeof Ge=="function"&&typeof Ie=="function")try{Ct=Je({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),Q=Ge(Ct),W=!0,lt(!0)}catch(e){W=!1,console.warn("Firebase initialization failed:",e),p("Firebase failed to load; notes available offline"),lt(!1)}else xe?(W=!1,lt(!1)):W=!1;W&&typeof Qe=="function"&&typeof Ze=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Qe(Q),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Ze(Q),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),W&&typeof Ie=="function"&&(de=Ie(Ct));function Pn(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let jn=typeof navigator<"u"&&navigator.language?navigator.language:"",en=Pn(jn),be=en||"en-US",K="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(K=e.timeZone),!en&&e.locale&&(be=e.locale)}catch{}let qn=new Intl.DateTimeFormat(be,{timeZone:K,hour:"2-digit",minute:"2-digit"}),Un=new Intl.DateTimeFormat(be,{timeZone:K,weekday:"long",day:"numeric",month:"long"}),_n=new Intl.DateTimeFormat("en-CA",{timeZone:K,year:"numeric",month:"2-digit",day:"2-digit"}),Hn=new Intl.DateTimeFormat(be,{timeZone:K,weekday:"long"}),Wn=new Intl.DateTimeFormat(be,{timeZone:K,month:"short",day:"numeric"});function ie(e){let t=_n.formatToParts(e),n=t.find(d=>d.type==="year").value,i=t.find(d=>d.type==="month").value,r=t.find(d=>d.type==="day").value;return`${n}-${i}-${r}`}function Tt(e,t){let[n,i,r]=e.split("-").map(u=>parseInt(u,10)),[d,m]=t.split(":").map(u=>parseInt(u,10)),l=new Date;return l.setFullYear(n,(i||1)-1,r||1),l.setHours(d||0,m||0,0,0),l.toISOString()}let Vn=new Intl.DateTimeFormat("en-CA",{timeZone:K,year:"numeric",month:"2-digit",day:"2-digit"}),zn=new Intl.DateTimeFormat("en-CA",{timeZone:K,hour:"2-digit",minute:"2-digit",hour12:!1});function Jn(e){try{let t=new Date(e),n=Vn.formatToParts(t),i=n.find(m=>m.type==="year")?.value||"0000",r=n.find(m=>m.type==="month")?.value||"00",d=n.find(m=>m.type==="day")?.value||"00";return`${i}-${r}-${d}`}catch{return""}}function Gn(e){try{let t=new Date(e),n=zn.formatToParts(t),i=n.find(d=>d.type==="hour")?.value?.padStart(2,"0")||"00",r=n.find(d=>d.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${r}`}catch{return""}}function Me(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function $e(){return ie(new Date)}function tn(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Qn(e){let t=tn(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Se(e){return e==="High"?3:e==="Medium"?2:1}function Lo(e,t){let n=Se(t.priority)-Se(e.priority);if(n)return n;let i=+new Date(e.due||0),r=+new Date(t.due||0);return i!==r?i-r:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function xt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Un.format(t)}catch{return e}}function Nt(e){return qn.format(e)}function fe(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function nn(e){return e?fe(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function p(e){j&&(j.textContent=e,clearTimeout(p._t),p._t=setTimeout(()=>j.textContent="",2500))}function on(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function ut(e){e=String(e||"").toLowerCase();let t={date:$e(),time:""},n=l=>{let u=new Date,g=u.getDay(),w=(l-g+7)%7,T=new Date(u);return T.setDate(u.getDate()+(w===0?7:w)),T},i=l=>{let u=new Date,g=u.getDay(),w=(l-g+7)%7,T=new Date(u);return T.setDate(u.getDate()+w),T},r={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},d={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let l=new Date;l.setDate(l.getDate()+1),t.date=ie(l)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[l[1]],g=n(u);t.date=ie(g)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[l[1]],g=i(u);t.date=ie(g)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[l[1]],g=n(u);t.date=ie(g)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let l=e.match(/\bin\s+(\d+)\s+days?\b/),u=parseInt(l[1],10),g=new Date;g.setDate(g.getDate()+u),t.date=ie(g)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let l=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),u=parseInt(l[1],10),g=parseInt(l[2],10)-1,w=l[3]?parseInt(l[3],10):new Date().getFullYear(),T=new Date(w,g,u);t.date=ie(T)}else for(let[l,u]of Object.entries(d)){let g=new RegExp(`\\b${l}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(g.test(e)){let w=e.match(g),T=parseInt(w[1],10),N=new Date().getFullYear(),q=new Date(N,u,T);t.date=ie(q);break}}let m=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(m){let l=parseInt(m[1],10),u=m[2]?parseInt(m[2],10):0,g=m[3];g&&(g==="pm"&&l<12&&(l+=12),g==="am"&&l===12&&(l=0)),t.time=`${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`}return t}let ft=W&&de&&typeof it=="function";ke?.addEventListener("click",async()=>{if(!ft||typeof rt!="function"||typeof at!="function"){p("Sign-in unavailable offline");return}let e=new it;try{await rt(de,e)}catch{try{await at(de,e)}catch{p("Google sign-in failed")}}}),ft&&typeof st=="function"&&st(de).catch(()=>{}),E?.addEventListener("click",async()=>{if(!ft||typeof ct!="function"){p("Sign-out unavailable offline");return}try{await ct(de),p("Signed out")}catch{p("Sign-out failed")}}),ft&&typeof ot=="function"?ot(de,async e=>{e?($=e.uid,L?.classList.remove("offline","error"),L?.classList.add("online"),L&&(L.textContent="Online"),ke?.classList.add("hidden"),E?.classList.remove("hidden"),ee&&(e.photoURL?(ee.classList.remove("hidden"),ee.src=e.photoURL):(ee.classList.add("hidden"),ee.src="")),Ue&&(Ue.textContent=e.displayName||e.email||""),Zn(),await On()):Xt()}):Xt();function Zn(){if(!W||!Q||typeof et!="function"||typeof tt!="function"||typeof nt!="function"||typeof Xe!="function")return;if(!$){It(),D(),O(),ae();return}Ne&&Ne();let e=et(Q,"users",$,"reminders"),t=tt(e,nt("updatedAt","desc"));Ne=Xe(t,n=>{let i=[];n.forEach(r=>{let d=r.data();i.push({id:r.id,title:d.title,priority:d.priority,notes:d.notes||"",done:!!d.done,due:d.due||null,category:C(d.category),createdAt:d.createdAt?.toMillis?.()||0,updatedAt:d.updatedAt?.toMillis?.()||0,pendingSync:!1})}),f=i,D(),O(),ae()},n=>{console.error("Firestore sync error:",n),L&&(L.textContent="Sync Error",L.className="sync-status error")})}async function re(e){if(!(!W||!$||!Q||typeof ve!="function"||typeof Ke!="function"||typeof De!="function"))try{await Ke(ve(Q,"users",$,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||B,createdAt:e.createdAt?new Date(e.createdAt):De(),updatedAt:De()},{merge:!0})}catch(t){console.error("Save failed:",t),p("Save queued (offline)")}}async function Kn(e){if(!(!W||!$||!Q||typeof ve!="function"||typeof Ye!="function"))try{await Ye(ve(Q,"users",$,"reminders",e))}catch{p("Delete queued (offline)")}}async function Re(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||B,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Oe(){b&&(b.value=""),k&&(k.value=""),I&&(I.value=""),x&&(x.value=""),We("Medium"),S&&(S.value=B),Gt(),Fe=null,X&&(X.textContent="Save Cue"),H?.classList.add("hidden")}function rn(e){let t=f.find(n=>n.id===e);t&&(b&&(b.value=t.title||""),k&&I&&(t.due?(k.value=Jn(t.due),I.value=Gn(t.due)):(k.value="",I.value="")),We(t?.priority||"Medium"),S&&(S.value=C(t.category)),x&&(x.value=typeof t.notes=="string"?t.notes:""),Fe=e,X&&(X.textContent="Update Cue"),H?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),b?.focus(),ne("cue:open",{mode:"edit"}))}function Yn(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=C(e.category??(S?S.value:"")),r={id:Me(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!$};return f=[r,...f],we=!0,D(),O(),St(r),re(r),Re(r),pe(r),ze(),ne("memoryCue:remindersUpdated",{items:f}),Lt(),oe({action:"created",label:`Reminder added \xB7 ${r.title}`}),r}function Xn(e,t){if(!$)return p("Sign in to add notes"),null;if(!e)return null;let n=f.find(m=>m.id===e);if(!n)return null;let r=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!r)return n;let d=typeof n.notes=="string"?n.notes:"";return n.notes=d?`${d}
${r}`:r,n.updatedAt=Date.now(),re(n),D(),O(),oe({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function an(e){let t=f.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),re(t),Re(t),D(),O(),t.done?(mt(e),oe({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(pe(t),oe({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function sn(e){let t=f.find(n=>n.id===e);f=f.filter(n=>n.id!==e),D(),O(),Kn(e),mt(e),oe(t?{action:"deleted",label:`Reminder removed \xB7 ${t.title}`}:{action:"deleted",label:"Reminder removed"})}function Ft(){localStorage.setItem("scheduledReminders",JSON.stringify(R))}function pt(e,{closeNotification:t=!0}={}){if(t){let n=Y.get(e);if(n){try{n.close()}catch{}Y.delete(e)}}ue[e]&&(clearTimeout(ue[e]),delete ue[e]),Bt(e),R[e]&&(delete R[e],Ft())}function mt(e){pt(e)}function cn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Y.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:"Due now",tag:e.id});Y.set(e.id,n);let i=()=>{Y.get(e.id)===n&&Y.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function eo(e){if(!Le())return!1;let t=hn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Be();if(!i)return!1;await Bt(e.id,i);let r={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||B,urlPath:$n},d=typeof e.notes=="string"&&e.notes.split(/\r?\n/).find(u=>u.trim())||"",m=d||"Due now";try{let u=new Date(e.due);if(!Number.isNaN(u.getTime())){let g=Nt(u);g&&(m=d?`${d} \u2022 ${g}`:`Due ${g}`)}}catch{}let l={body:m,tag:e.id,data:r,renotify:!0};n>Date.now()&&(l.showTrigger=new t(n));try{return await i.showNotification(e.title,l),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function pe(e){if(!e||!e.id)return;if(e.category=C(e.category),!e.due||e.done){mt(e.id);return}let t={id:e.id,title:e.title,due:e.due,category:e.category||B};if(R[e.id]=t,Ft(),ue[e.id]&&(clearTimeout(ue[e.id]),delete ue[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return;let i=n-Date.now();if(i<=0){if(R[e.id]?.viaTrigger){pt(e.id,{closeNotification:!1});return}cn(e),pt(e.id,{closeNotification:!1});return}let r=Le();r&&(t.viaTrigger=!1,eo(e).then(d=>{d&&R[e.id]&&(R[e.id]={...R[e.id],viaTrigger:!0},Ft())})),ue[e.id]=setTimeout(()=>{r&&Bt(e.id),cn(e),pt(e.id,{closeNotification:!1})},i)}function ae(){Object.values(R).forEach(e=>pe({...e,category:C(e?.category)}))}let dn={High:"bg-rose-400/80 dark:bg-rose-300/80",Medium:"bg-amber-400/80 dark:bg-amber-300/80",Low:"bg-emerald-400/80 dark:bg-emerald-300/80"};function to(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Hn.format(t),i=Wn.format(t),r=Nt(t);return`${n}, ${i}${r?` at ${r}`:""}`}catch{return"No due date"}}function D(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let r=tn(t),d=Qn(t),m=f.filter(o=>{if(!o.due||o.done)return!1;let s=new Date(o.due);return s>=n&&s<=i}),l=f.filter(o=>{if(!o.due||o.done)return!1;let s=new Date(o.due);return s>=r&&s<=d}),u=f.filter(o=>o.done||!o.due?!1:new Date(o.due)<t).length,g=f.filter(o=>o.done).length;jt&&(jt.textContent=String(m.length)),qt&&(qt.textContent=String(l.length)),Ut&&(Ut.textContent=String(u)),_t&&(_t.textContent=String(f.length)),Ht&&(Ht.textContent=String(g)),f.forEach(o=>{o&&typeof o=="object"&&(o.category=C(o.category))});let w=new Set(vo.map(o=>C(o)));f.forEach(o=>{o&&typeof o=="object"&&w.add(C(o.category))});let T=Array.from(w).sort((o,s)=>o.localeCompare(s,void 0,{sensitivity:"base"}));if(te){let o=le;te.replaceChildren();let s=document.createElement("option");s.value="all",s.textContent="All categories",te.appendChild(s),T.forEach(y=>{let h=document.createElement("option");h.value=y,h.textContent=y,te.appendChild(h)}),o!=="all"&&!T.includes(o)&&(le="all"),te.value=le}if(wt){let o=new Set;Array.from(wt.querySelectorAll("option")).forEach(s=>{o.add(s.value.trim().toLowerCase())}),T.forEach(s=>{let y=s.toLowerCase();if(!o.has(y)){let h=document.createElement("option");h.value=s,wt.appendChild(h),o.add(y)}})}if(we)we=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let o=f.map(s=>({...s}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:o}}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:o}),document.dispatchEvent(s))}}catch{}}let N=f.slice(),q=_?.value.trim().toLowerCase()||"";q&&(N=N.filter(o=>o.title.toLowerCase().includes(q)||(o.notes||"").toLowerCase().includes(q)||(o.category||"").toLowerCase().includes(q))),le&&le!=="all"&&(N=N.filter(o=>C(o.category)===le)),N=N.filter(o=>dt==="done"?o.done:dt==="overdue"?!o.done&&o.due&&new Date(o.due)<t:!0);let me=(o,s)=>{let y=o.done?1:0,h=s.done?1:0;if(y!==h)return y-h;let U=o.due?new Date(o.due).getTime():1/0,ye=s.due?new Date(s.due).getTime():1/0;if(U!==ye)return U-ye;let v=Se(s.priority)-Se(o.priority);return v||(s.updatedAt||0)-(o.updatedAt||0)},io={due:me,priority:(o,s)=>{let y=Se(s.priority)-Se(o.priority);return y||me(o,s)},category:(o,s)=>{let y=C(o.category||""),h=C(s.category||""),U=y.localeCompare(h,void 0,{sensitivity:"base"});return U||me(o,s)},recent:(o,s)=>{let y=(s.createdAt||0)-(o.createdAt||0);return y||(s.updatedAt||0)-(o.updatedAt||0)}}[Z]||me;N.sort(io),ht.forEach(o=>{let s=o.getAttribute("data-filter")===dt;o.classList.toggle("active",s),o.setAttribute("aria-pressed",String(s)),o.classList.contains("btn-ghost")||(o.classList.toggle("bg-gray-900",s),o.classList.toggle("text-white",s),o.classList.toggle("border-gray-900",s),o.classList.toggle("dark:bg-gray-100",s),o.classList.toggle("dark:text-gray-900",s),o.classList.toggle("dark:border-gray-100",s),o.classList.toggle("bg-white",!s),o.classList.toggle("text-gray-600",!s),o.classList.toggle("border-gray-200",!s),o.classList.toggle("dark:bg-gray-800",!s),o.classList.toggle("dark:text-gray-400",!s),o.classList.toggle("dark:border-gray-700",!s))});let ro=f.length>0,Mt=N.length>0;if(G&&(ro?Mt?G.classList.add("hidden"):(Ve?Ve(G,{icon:"sparkles",title:"No reminders match this view",description:Zt}):G.textContent=Zt,G.classList.remove("hidden")):(Ve?Ve(G,{icon:"bell",title:"Create your first cue",description:Qt,action:`<button type="button" class="${Mn}" data-trigger="open-cue">Create reminder</button>`}):G.textContent=Qt,G.classList.remove("hidden"))),Vt&&Vt.classList.toggle("has-items",Mt),!P)return;if(!Mt){G?(P.innerHTML="",P.classList.add("hidden")):(P.innerHTML='<div class="text-muted">No reminders found.</div>',P.classList.remove("hidden"));return}P.classList.remove("hidden"),P.replaceChildren();let Ee=document.createDocumentFragment(),$t=P.tagName==="UL"||P.tagName==="OL",ao=!0,un=(o,s)=>{let y=document.createElement("div");y.className="task-item"+(o.done?" completed":"");let h={id:o.id,title:o.title,dueIso:o.due||null,priority:o.priority||"Medium",category:s,done:!!o.done};y.dataset.category=s,y.dataset.reminder=JSON.stringify(h),y.dataset.id=h.id,y.dataset.title=h.title,y.dataset.priority=h.priority,y.dataset.done=String(h.done),h.dueIso&&(y.dataset.due=h.dueIso);let U=h.dueIso?new Date(h.dueIso):null;highlightToday&&U&&U>=n&&U<=i&&y.classList.add("is-today");let v=o.due?`${Nt(new Date(o.due))} \u2022 ${xt(o.due.slice(0,10))}`:"No due date",M=`priority-${(o.priority||"Medium").toLowerCase()}`,z=o.notes?`<div class="task-notes">${nn(o.notes)}</div>`:"";return y.innerHTML=`
        <input type="checkbox" ${o.done?"checked":""} aria-label="Mark complete" />
        <div class="task-content">
          <div class="task-title">${fe(o.title)}</div>
          <div class="task-meta">
            <div class="task-meta-row" style="gap:8px; flex-wrap:wrap;">
              <span>${v}</span>
              <span class="priority-badge ${M}">${o.priority}</span>
              <span class="priority-badge" style="background:rgba(56,189,248,.14);color:#0284c7;border-color:rgba(56,189,248,.26);">${fe(s)}</span>
            </div>
          </div>
          ${z}
        </div>
        <div class="task-actions">
          <button class="btn-ghost" data-edit type="button">Edit</button>
          <button class="btn-ghost" data-del type="button">Del</button>
        </div>`,y.querySelector("input").addEventListener("change",()=>an(o.id)),y.querySelector("[data-edit]").addEventListener("click",()=>rn(o.id)),y.querySelector("[data-del]").addEventListener("click",()=>sn(o.id)),y};if(ce!=="desktop"&&!ao){N.forEach(o=>{let s=o.category||B;Ee.appendChild(un(o,s))}),P.appendChild(Ee);return}let yt=new Map;N.forEach(o=>{let s=o.category||B;yt.has(s)||yt.set(s,[]),yt.get(s).push(o)});let so=Array.from(yt.entries()).sort((o,s)=>o[0].localeCompare(s[0],void 0,{sensitivity:"base"})),fn=!0;so.forEach(([o,s])=>{let y=document.createElement($t?"li":"div");y.dataset.categoryHeading=o,$t&&(y.setAttribute("role","presentation"),y.style.listStyle="none"),y.className=ce==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",fn||(y.style.marginTop=ce==="desktop"?"1.25rem":"1rem");let h=document.createElement("div");h.setAttribute("role","heading"),h.setAttribute("aria-level","3"),h.className=ce==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let U=document.createElement("span");U.textContent=o;let ye=document.createElement("span");ye.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",ye.textContent=`${s.length} ${s.length===1?"item":"items"}`,h.append(U,ye),y.appendChild(h),Ee.appendChild(y),s.forEach(v=>{if(ce==="desktop"){let M=document.createElement($t?"li":"div"),z={id:v.id,title:v.title,dueIso:v.due||null,priority:v.priority||"Medium",category:o,done:!!v.done};M.dataset.id=z.id,M.dataset.category=z.category,M.dataset.title=z.title,M.dataset.priority=z.priority,M.dataset.done=String(z.done),z.dueIso&&(M.dataset.due=z.dueIso),M.dataset.reminder=JSON.stringify(z),M.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let co=to(v),lo=dn[v.priority]||dn.Medium,uo=v.done?"line-through text-base-content/50":"text-base-content",fo=v.done?"Completed":"Active",po=v.priority==="High"?"badge badge-outline border-error text-error":v.priority==="Medium"?"badge badge-outline border-warning text-warning":"badge badge-outline border-success text-success",mo=v.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",yo=v.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",go=v.notes?`<p class="text-sm leading-relaxed text-base-content/70">${nn(v.notes)}</p>`:"";M.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${uo}">${fe(v.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${fe(co)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${fe(o)}
            </span>
            <span class="${po} gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full ${lo}"></span>
              ${fe(v.priority)} priority
            </span>
            <span class="${mo} text-[0.7rem] sm:text-xs">${fo}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${go}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${yo}">${v.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,M.querySelector('[data-action="toggle"]').addEventListener("click",()=>an(v.id)),M.querySelector('[data-action="edit"]').addEventListener("click",()=>rn(v.id)),M.querySelector('[data-action="delete"]').addEventListener("click",()=>sn(v.id)),Ee.appendChild(M);return}Ee.appendChild(un(v,o))}),fn=!1}),P.appendChild(Ee)}function V(){Ce?.setAttribute("aria-expanded","false"),Ae?.classList.add("hidden")}function no(){Ce?.setAttribute("aria-expanded","true"),Ae?.classList.remove("hidden")}Ce?.addEventListener("click",e=>{e.stopPropagation(),Ce.getAttribute("aria-expanded")==="true"?V():no()}),document.addEventListener("click",e=>{Ae&&!Ae.classList.contains("hidden")&&!Ae.contains(e.target)&&e.target!==Ce&&V()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&V()}),In?.addEventListener("click",()=>{let e=_e?.classList.contains("hidden");_e?.classList.toggle("hidden"),e&&_e?.scrollIntoView({behavior:"smooth",block:"start"}),V()}),document.addEventListener("DOMContentLoaded",()=>{_e?.classList.add("hidden")});function ln(){try{console.log("handleSaveAction invoked",{editingId:Fe,title:b?.value})}catch{}if(Fe){let i=f.find(l=>l.id===Fe);if(!i){Oe();return}let r=b.value.trim();if(!r){p("Add a reminder title");return}let d=null;if(k.value||I.value){let l=k.value||$e(),u=I.value||"09:00";d=Tt(l,u)}else{let l=ut(r);l.time&&(d=new Date(`${l.date}T${l.time}:00`).toISOString())}i.title=r;let m=He();i.priority=m,We(m),S&&(i.category=C(S.value)),i.due=d,x&&(i.notes=x.value.trim()),i.updatedAt=Date.now(),re(i),Re(i),we=!0,D(),pe(i),O(),ze(),ne("memoryCue:remindersUpdated",{items:f}),Lt(),oe({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Oe(),p("Reminder updated"),ne("cue:close",{reason:"updated"});return}let e=b.value.trim();if(!e){p("Add a reminder title");return}let t=x?x.value.trim():"",n=null;if(k.value||I.value){let i=k.value||$e(),r=I.value||"09:00";n=Tt(i,r)}else{let i=ut(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Yn({title:e,priority:He(),category:S?S.value:"",due:n,notes:t}),b.value="",I.value="",x&&(x.value=""),ne("cue:close",{reason:"created"})}b?.addEventListener("keydown",e=>{e.key==="Enter"&&ln()});function oo(){if(!b||!se)return;let e=b.value.trim();if(!e){se.style.display="none";return}try{let t=ut(e),n=$e();if(t.date!==n||t.time){let i="";if(t.date!==n){let r=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${xt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(se.textContent=`Parsed: ${i}`,se.style.display="block"):se.style.display="none"}else se.style.display="none"}catch{se.style.display="none"}}return b?.addEventListener("input",on(oo,300)),H?.addEventListener("click",()=>{Oe(),p("Edit cancelled"),ne("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Oe()}),document.addEventListener("cue:prepare",()=>{Oe()}),window.addEventListener("load",()=>b?.focus()),_?.addEventListener("input",on(D,150)),Pe?.addEventListener("change",()=>{if(Z=Pe.value||"due",At.has(Z)||(Z="due"),typeof localStorage<"u")try{localStorage.setItem(Yt,Z)}catch{}D()}),te?.addEventListener("change",()=>{le=te.value||"all",D()}),ht.forEach(e=>e.addEventListener("click",()=>{dt=e.getAttribute("data-filter"),D()})),Ln?.addEventListener("click",()=>{let e=f.filter(t=>!t.done).map(t=>{let n=t.due?xt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(be,{hour:"2-digit",minute:"2-digit",timeZone:K}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){p("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>p("Copied for Master Task List")).catch(()=>p("Copy failed")),V()}),vt?.addEventListener("change",()=>{let e=vt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(i=>{i.id=Me(),i.category=C(i.category),i.pendingSync=!$,f=[i,...f],re(i)}),D(),O(),p("Import successful")}catch{p("Invalid JSON")}},t.readAsText(e),vt.value="",V()}),kn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),V()}),Cn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){p("Add your Apps Script URL in Settings first"),V();return}if(!f.length){p("No tasks to sync"),V();return}p("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<f.length;i+=t){let r=f.slice(i,i+t),d=await Promise.allSettled(r.map(m=>{let l={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:m.category||B,done:!!m.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}));n+=d.filter(m=>m.status==="rejected").length,await new Promise(m=>setTimeout(m,400))}p(`Sync complete: ${f.length-n} ok${n?`, ${n} failed`:""}`),V()}),ge&&(ge.value=localStorage.getItem("syncUrl")||""),An?.addEventListener("click",()=>{ge&&(localStorage.setItem("syncUrl",ge.value.trim()),p("Settings saved"))}),Dn?.addEventListener("click",async()=>{if(!ge)return;let e=ge.value.trim();if(!e){p("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});p(t.ok?"Test ok":"Test failed")}catch{p("Test failed")}}),En?.addEventListener("click",async()=>{if(!("Notification"in window)){p("Notifications not supported");return}if(Notification.permission==="granted"){p("Notifications enabled"),Le()&&Be(),ae();return}try{await Notification.requestPermission()==="granted"?(p("Notifications enabled"),Le()&&Be(),ae()):p("Notifications blocked")}catch{p("Notifications blocked")}}),ae(),D(),O(),{cancelReminder:mt,scheduleReminder:pe,closeActiveNotifications:vn,getActiveNotifications:()=>Y,addNoteToReminder:Xn,__testing:{setItems(e=[]){f=Array.isArray(e)?e.map(t=>({...t,category:C(t?.category)})):[],D()},render:D,getItems:()=>f.map(e=>({...e}))}}}var pn,Y,mn,Rt,gt,B,vo,Ot,yn,Eo=ho(()=>{pn="memoryCue:activity",Y=new Map,mn=!1,Rt="service-worker.js",gt=null,B="General",vo=Object.freeze([B,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Ot="memoryCue:offlineReminders";yn=!1});export{Io as a,Eo as b};
