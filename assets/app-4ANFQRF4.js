import{a as De,b as fs,d as Yt,e as ms}from"./chunk-GTEPT5TN.js";import{a as Qt,b as us}from"./chunk-MG4MJA24.js";import"./chunk-ZCWHDNFC.js";import"./chunk-CTK42JWW.js";import{b as zt,c as ds}from"./chunk-GUVSRPRW.js";function Kt(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:s})=>{if(!Array.isArray(s))return null;for(let i of s){if(typeof i!="string"||!i)continue;let o=t.getElementById(i);if(o)return{key:n,element:o}}return null}).filter(n=>!!(n&&n.element))}function oe(e,t){if(!e||typeof e!="object")return"";let n=ps[t]||[t];for(let s of n)if(Object.prototype.hasOwnProperty.call(e,s)){let i=e[s];return i==null?"":typeof i=="string"?i:String(i)}return""}function ys(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function hs(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Xt(e,t){Array.isArray(t)&&t.forEach(({key:n,element:s})=>{let i=e&&typeof e=="object"?oe(e,n):"";ys(s,i)})}function Zt(e,t,n,s){Array.isArray(e)&&e.forEach(({element:i})=>{i instanceof HTMLInputElement?["checkbox","radio"].includes(i.type)?i.checked=!1:i.value="":(i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value="")}),t&&(t.value=""),n&&(n.textContent=s)}function Jt(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:s})=>{let i=hs(s);if(typeof i=="boolean"){t[n]=i;return}let o=typeof i=="string"?i.trim():i;t[n]=o??""}),t}function L(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Gt,ps,Ze,Je,et=zt(()=>{Gt=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],ps={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Ze="Create Cue",Je="Edit Cue"});function tt(e=0){let t=Number.isFinite(e)?e:0;if(t<=0)return"0m";let n=Math.floor(t/1e3),s=Math.floor(n/3600),i=Math.floor(n%3600/60),o=n%60,a=[];return s&&a.push(`${s}h`),i&&a.push(`${i}m`),!s&&!i&&a.push(`${o}s`),a.join(" ")}function nt(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function bs(e){if(typeof e!="string")return"";let[t,n,s]=e.split("-"),i=Number.parseInt(t,10),o=Number.parseInt(n,10),a=Number.parseInt(s,10);if(!Number.isFinite(i)||!Number.isFinite(o)||!Number.isFinite(a))return e;let l=new Date(i,o-1,a);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(l)}function nn(e={}){let t=typeof e?.text=="string"?e.text.trim():"",n=typeof e?.priority=="string"?e.priority.toLowerCase():"",s=ae.includes(n)?n:"medium",i=typeof e?.category=="string"&&e.category.trim()?e.category.trim():tn,o=Date.now(),a=Number.isFinite(e?.createdAt)?Number(e.createdAt):o,l=Number.isFinite(e?.completedAt)?Number(e.completedAt):null,c=Number.isFinite(e?.timeTrackedMs)?Number(e.timeTrackedMs):0,d=Number.isFinite(e?.estimateMs)?Number(e.estimateMs):null,p=!!e?.completed;return{id:typeof e?.id=="string"&&e.id?e.id:typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${a}-${Math.random().toString(16).slice(2)}`,text:t,completed:p,priority:s,category:i,createdAt:a,completedAt:p?l??o:null,timeTrackedMs:p?c||Math.max(0,(l??o)-a):c,estimateMs:d}}function fe(e){return Array.isArray(e)?e.map(t=>nn(t)):[]}function Es(e){let t={text:e,priority:"medium",category:tn,estimateMs:null};if(typeof e!="string")return t.text="",t;let n=e,s=e.match(/!(high|medium|low)/i);s&&(t.priority=s[1].toLowerCase(),n=n.replace(s[0],"").trim());let i=e.match(/#([a-z0-9_-]+)/i);i&&(t.category=i[1].toLowerCase(),n=n.replace(i[0],"").trim());let o=e.match(/@([0-9]+)(h|m)?/i);if(o){let a=Number.parseInt(o[1],10);if(Number.isFinite(a)){let c=(o[2]||"m").toLowerCase()==="h"?60:1;t.estimateMs=a*c*6e4}n=n.replace(o[0],"").trim()}return t.text=n.trim(),t.text||(t.text=e.trim()),t}function sn(e){return new st(e)}var en,ae,gs,tn,st,on=zt(()=>{et();en="dailyTasksByDate",ae=["high","medium","low"],gs={high:"High",medium:"Medium",low:"Low"},tn="general";st=class{constructor(t={}){this.dailyTab=t.dailyTab??null,this.dailyView=t.dailyView??null,this.dailyListHeader=t.dailyListHeader??null,this.quickAddForm=t.quickAddForm??null,this.quickAddInput=t.quickAddInput??null,this.quickAddVoiceButton=t.quickAddVoiceButton??null,this.dailyTasksContainer=t.dailyTasksContainer??null,this.clearCompletedButton=t.clearCompletedButton??null,this.dailyListPermissionNotice=t.dailyListPermissionNotice??null,this.cuesTab=t.cuesTab??null,this.cuesView=t.cuesView??null,this.ensureCueFirestore=typeof t.ensureCueFirestore=="function"?t.ensureCueFirestore:null,this.storage=t.storage??(typeof window<"u"?window.localStorage:void 0),this.window=t.window??window,this.document=t.document??document,this.forceLocalMode=!!t.forceLocalMode,this.tasks=[],this.dailyListLoadPromise=null,this.shouldUseLocalDailyList=this.forceLocalMode,this.firestoreDailyListContextPromise=null,this.activeTimers=new Map,this.undoStack=[],this.quickAddVoiceRecognition=null,this.quickAddVoiceListening=!1,this.quickAddVoiceRestartTimer=null,this.todayId=nt(),this.statsElement=null,this.undoButton=null,this.boundDailyTabClick=n=>{n.preventDefault(),this.switchToDailyView()},this.boundCuesTabClick=n=>{n.preventDefault(),this.switchToCuesView()},this.boundClearCompletedClick=()=>{this.clearCompleted()},this.boundQuickAddSubmit=n=>{n.preventDefault();let s=this.quickAddInput?.value?.trim()??"";if(!s){this.quickAddInput?.focus();return}this.quickAddInput.value="",this.handleQuickAdd(s)},this.boundQuickAddFormStopVoice=()=>{this.quickAddVoiceListening&&this.stopQuickAddVoiceRecognition()},this.boundVoiceButtonClick=()=>{this.quickAddVoiceRecognition&&(this.quickAddVoiceListening?this.stopQuickAddVoiceRecognition():this.startQuickAddVoiceRecognition())},this.boundPageHide=()=>{this.quickAddVoiceListening&&this.stopQuickAddVoiceRecognition()},this.boundTaskContainerChange=n=>{let s=n.target;if(!(s instanceof this.window.HTMLInputElement)||s.type!=="checkbox")return;let i=s.getAttribute("data-task-id");i&&this.completeTask(i,s.checked)},this.boundTaskContainerClick=n=>{let s=n.target instanceof this.window.HTMLElement?n.target:null;if(!s)return;let i=s.closest("[data-task-id]");if(!i)return;let o=i.getAttribute("data-task-id");if(!o)return;let a=s.getAttribute("data-action");if(a==="cycle-priority"){this.cycleTaskPriority(o);return}if(a==="delete-task"){this.deleteTask(o);return}},this.boundUndoClick=()=>{this.undoLastAction()},this.init()}init(){this.setupStatsElement(),this.setupUndoButton(),this.setupEventListeners(),this.initialiseQuickAddVoiceRecognition(),this.loadDailyTasks()}setupStatsElement(){if(!this.dailyTasksContainer||!this.document||this.statsElement)return;let t=this.document.createElement("div");t.className="text-sm text-base-content/70 mb-2 flex items-center gap-3",t.dataset.role="daily-task-stats",t.textContent="No tasks yet",this.dailyTasksContainer.insertAdjacentElement("beforebegin",t),this.statsElement=t}setupUndoButton(){if(!this.clearCompletedButton||!this.document||this.undoButton)return;let t=this.document.createElement("button");t.type="button",t.className="btn btn-ghost btn-sm ml-2 hidden",t.textContent="Undo",t.setAttribute("aria-label","Undo last daily task action"),this.clearCompletedButton.insertAdjacentElement("afterend",t),this.undoButton=t,this.undoButton.addEventListener("click",this.boundUndoClick)}setupEventListeners(){this.dailyTab?.addEventListener("click",this.boundDailyTabClick),this.cuesTab?.addEventListener("click",this.boundCuesTabClick),this.clearCompletedButton?.addEventListener("click",this.boundClearCompletedClick),this.quickAddForm?.addEventListener("submit",this.boundQuickAddSubmit),this.quickAddForm?.addEventListener("submit",this.boundQuickAddFormStopVoice),this.quickAddVoiceButton?.addEventListener("click",this.boundVoiceButtonClick),this.window?.addEventListener?.("pagehide",this.boundPageHide),this.dailyTasksContainer?.addEventListener("change",this.boundTaskContainerChange),this.dailyTasksContainer?.addEventListener("click",this.boundTaskContainerClick)}cleanup(){this.dailyTab?.removeEventListener("click",this.boundDailyTabClick),this.cuesTab?.removeEventListener("click",this.boundCuesTabClick),this.clearCompletedButton?.removeEventListener("click",this.boundClearCompletedClick),this.quickAddForm?.removeEventListener("submit",this.boundQuickAddSubmit),this.quickAddForm?.removeEventListener("submit",this.boundQuickAddFormStopVoice),this.quickAddVoiceButton?.removeEventListener("click",this.boundVoiceButtonClick),this.window?.removeEventListener?.("pagehide",this.boundPageHide),this.dailyTasksContainer?.removeEventListener("change",this.boundTaskContainerChange),this.dailyTasksContainer?.removeEventListener("click",this.boundTaskContainerClick),this.undoButton?.removeEventListener("click",this.boundUndoClick),this.stopQuickAddVoiceRecognition(),this.window?.clearTimeout?.(this.quickAddVoiceRestartTimer)}activateTab(t){[this.cuesTab,this.dailyTab].filter(Boolean).forEach(s=>{let i=s;if(!i)return;let o=s===t;i.classList.toggle("tab-active",o),i.setAttribute("aria-selected",o?"true":"false")})}switchToDailyView(){this.dailyView&&(this.cuesView?.classList.add("hidden"),this.dailyView.classList.remove("hidden"),this.activateTab(this.dailyTab??null),this.loadDailyTasks())}switchToCuesView(){!this.cuesView||!this.dailyView||(this.cuesView.classList.remove("hidden"),this.dailyView.classList.add("hidden"),this.activateTab(this.cuesTab??null))}setQuickAddVoiceButtonActive(t){let n=this.quickAddVoiceButton;if(!n)return;n.setAttribute("aria-pressed",t?"true":"false");let s=n.querySelector('[aria-hidden="true"]');if(s){s.textContent=t?"\u{1F442}":"\u{1F399}\uFE0F";return}n.textContent=t?"\u{1F442}":"\u{1F399}\uFE0F"}scheduleQuickAddVoiceRestart(){this.quickAddVoiceListening&&(this.window?.clearTimeout?.(this.quickAddVoiceRestartTimer),this.quickAddVoiceRestartTimer=this.window?.setTimeout?.(()=>{this.quickAddVoiceRestartTimer=null,this.quickAddVoiceListening&&this.startQuickAddVoiceRecognition(!0)},400))}startQuickAddVoiceRecognition(t=!1){if(!this.quickAddVoiceRecognition)return!1;if(this.quickAddVoiceListening&&!t)return!0;try{return this.quickAddVoiceRecognition.start(),this.quickAddVoiceListening=!0,this.setQuickAddVoiceButtonActive(!0),!0}catch{return this.quickAddVoiceListening=!1,this.setQuickAddVoiceButtonActive(!1),!1}}stopQuickAddVoiceRecognition(){if(this.quickAddVoiceRecognition){this.quickAddVoiceListening=!1,this.window?.clearTimeout?.(this.quickAddVoiceRestartTimer);try{this.quickAddVoiceRecognition.stop()}catch{}this.setQuickAddVoiceButtonActive(!1)}}initialiseQuickAddVoiceRecognition(){let t=this.quickAddVoiceButton;if(!(!t||!this.window))try{let n=this.window.SpeechRecognition||this.window.webkitSpeechRecognition||this.window.mozSpeechRecognition||this.window.msSpeechRecognition;if(!n){t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true"),t.title="Voice input is not supported in this browser.";return}this.quickAddVoiceRecognition=new n;let s=this.document?.documentElement?.lang||this.window.navigator?.language||"en-AU";if(this.quickAddVoiceRecognition.lang=s,this.quickAddVoiceRecognition.interimResults=!1,"continuous"in this.quickAddVoiceRecognition)try{this.quickAddVoiceRecognition.continuous=!0}catch{}this.quickAddVoiceRecognition.onresult=i=>{let o=i?.results?.[0]?.[0]?.transcript||"";if(o&&this.quickAddInput){this.quickAddInput.value=o.trim();try{this.quickAddInput.focus({preventScroll:!0})}catch{this.quickAddInput.focus()}try{let a=this.quickAddInput.value.length;this.quickAddInput.setSelectionRange(a,a)}catch{}}},this.quickAddVoiceRecognition.onend=()=>{if(!this.quickAddVoiceListening){this.setQuickAddVoiceButtonActive(!1);return}this.scheduleQuickAddVoiceRestart()},this.quickAddVoiceRecognition.onerror=()=>{this.quickAddVoiceListening=!1,this.setQuickAddVoiceButtonActive(!1)}}catch{this.quickAddVoiceRecognition=null,this.setQuickAddVoiceButtonActive(!1),t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true")}}showPermissionNotice(){this.dailyListPermissionNotice?.classList.remove("hidden")}hidePermissionNotice(){this.dailyListPermissionNotice?.classList.add("hidden")}updateClearCompletedButtonState(){if(!this.clearCompletedButton)return;let t=this.tasks.some(n=>!!n?.completed);this.clearCompletedButton.disabled=!t}updateStats(){if(!this.statsElement)return;if(!this.tasks.length){this.statsElement.textContent="No tasks yet";return}let t=this.tasks.filter(i=>i.completed).length,n=this.tasks.length-t,s=this.tasks.reduce((i,o)=>i+(o.timeTrackedMs||0),0);this.statsElement.textContent=`Tasks: ${this.tasks.length} \u2022 Completed: ${t} \u2022 Remaining: ${n} \u2022 Tracked: ${tt(s)}`}renderDailyTasks(){if(!this.dailyTasksContainer)return;if(!Array.isArray(this.tasks)||this.tasks.length===0){this.dailyTasksContainer.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',this.updateClearCompletedButtonState(),this.updateStats();return}let n=[...this.tasks].sort((s,i)=>{let o=ae.indexOf(s.priority)-ae.indexOf(i.priority);return o!==0?o:s.createdAt-i.createdAt}).map(s=>{let i=L(s.text||""),o=!!s.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];o&&a.push("line-through","text-opacity-50");let l=gs[s.priority]??"Medium",c=[`Priority: ${l}`,`Category: ${L(s.category)}`];if(s.completedAt){let d=Math.max(0,s.completedAt-s.createdAt);c.push(`Time: ${tt(d)}`)}else s.estimateMs&&c.push(`Estimate: ${tt(s.estimateMs)}`);return`
        <div class="flex flex-col gap-1 p-3 border-b border-base-200" data-task-id="${s.id}">
          <div class="flex items-center gap-3">
            <input type="checkbox" class="checkbox checkbox-sm" data-task-id="${s.id}" ${o?"checked":""} />
            <span class="${a.join(" ")}">${i}</span>
          </div>
          <div class="flex items-center gap-3 text-xs text-base-content/70">
            <span>${c.join(" \u2022 ")}</span>
            <button type="button" class="btn btn-ghost btn-xs" data-action="cycle-priority">Priority: ${l}</button>
            <button type="button" class="btn btn-ghost btn-xs" data-action="delete-task">Delete</button>
          </div>
        </div>
      `}).join("");this.dailyTasksContainer.innerHTML=n,this.updateClearCompletedButtonState(),this.updateStats()}async loadDailyTasks(){if(!this.dailyListHeader||!this.dailyTasksContainer)return[];let t=nt();this.todayId=t;let n=bs(t);if(this.dailyListHeader.textContent=n?`Today's List - ${n}`:"Today's List",this.shouldUseLocalDailyList){this.showPermissionNotice();let s=this.getLocalDailyTasks(t);return this.tasks=s,this.renderDailyTasks(),s}return this.dailyListLoadPromise||(this.dailyTasksContainer.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',this.updateClearCompletedButtonState(),this.dailyListLoadPromise=(async()=>{try{let s=await this.ensureDailyListFirestore();if(!s){this.shouldUseLocalDailyList=!0,this.showPermissionNotice();let l=this.getLocalDailyTasks(t);this.tasks=l,this.renderDailyTasks();return}let i=this.getDailyListDocRef(s,t),o=await s.getDoc(i),a=o.exists()?o.data()?.tasks:[];this.tasks=fe(a),this.renderDailyTasks(),this.setLocalDailyTasks(t,this.tasks),this.shouldUseLocalDailyList=!1,this.hidePermissionNotice()}catch(s){if(this.isPermissionDeniedError(s)){console.warn("Falling back to local daily tasks due to permission issue",s),this.shouldUseLocalDailyList=!0,this.showPermissionNotice();let i=this.getLocalDailyTasks(t);this.tasks=i,this.renderDailyTasks();return}console.error("Failed to load daily list",s),this.dailyTasksContainer.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',this.tasks=[],this.updateClearCompletedButtonState(),this.updateStats()}})().finally(()=>{this.dailyListLoadPromise=null})),await this.dailyListLoadPromise,this.tasks}async ensureDailyListFirestore(){return this.ensureCueFirestore?this.firestoreDailyListContextPromise?this.firestoreDailyListContextPromise:(this.firestoreDailyListContextPromise=this.ensureCueFirestore().then(t=>{let{db:n,getCollection:s}=t??{},i=typeof s=="function"&&n?s(n,"dailyLists"):null;return{...t,dailyListsCollection:i}}).catch(t=>{throw console.error("Failed to initialise Firestore for daily lists",t),t}),this.firestoreDailyListContextPromise):null}getDailyListDocRef(t,n){let{doc:s,dailyListsCollection:i,db:o}=t??{};if(typeof s!="function")throw new Error("Firestore document helper is unavailable");return i?s(i,n):s(o,"dailyLists",n)}isPermissionDeniedError(t){let n=typeof t?.code=="string"?t.code.toLowerCase():"";if(n)return n.includes("permission-denied")||n.includes("insufficient-permission");let s=typeof t?.message=="string"?t.message.toLowerCase():"";return!!(s&&s.includes("permission"))}getLocalDailyTasks(t){let n=this.readDailyTaskStorage(),s=n&&typeof n=="object"?n[t]:[];return fe(s)}setLocalDailyTasks(t,n){let s=this.readDailyTaskStorage(),i=fe(n);return s[t]=i,this.writeDailyTaskStorage(s),i}readDailyTaskStorage(){if(!this.storage||typeof this.storage.getItem!="function")return{};try{let t=this.storage.getItem(en);if(!t)return{};let n=JSON.parse(t);return n&&typeof n=="object"?n:{}}catch(t){return console.warn("Unable to read daily tasks from storage",t),{}}}writeDailyTaskStorage(t){if(!(!this.storage||typeof this.storage.setItem!="function"))try{let n=t&&typeof t=="object"?t:{};this.storage.setItem(en,JSON.stringify(n))}catch(n){console.warn("Unable to persist daily tasks locally",n)}}async handleQuickAdd(t){let{text:n,priority:s,category:i,estimateMs:o}=Es(t);if(!n){this.quickAddInput?.focus();return}let a={text:n,completed:!1,priority:s,category:i,estimateMs:o};this.quickAddInput&&(this.quickAddInput.value="",this.quickAddInput.focus());try{await this.addDailyTask(a)}catch(l){console.error("Failed to add task to the daily list",l),this.quickAddInput&&(this.quickAddInput.value=t,this.quickAddInput.focus())}}async addDailyTask(t){let n=nn(t),s=[...this.tasks];this.tasks=[...this.tasks,n],this.renderDailyTasks();try{return await this.saveDailyTasks(this.tasks),n}catch(i){throw console.error("Failed to persist new daily task",i),this.tasks=s,this.renderDailyTasks(),i}}async completeTask(t,n){let s=this.tasks.map(o=>({...o})),i=!1;if(this.tasks=this.tasks.map(o=>{if(o.id!==t)return o;i=!0;let a=n?Date.now():null;return{...o,completed:n,completedAt:a,timeTrackedMs:n?Math.max(0,(a??Date.now())-o.createdAt):0}}),!!i){this.renderDailyTasks();try{await this.saveDailyTasks(this.tasks)}catch(o){console.error("Failed to update task completion state",o),this.tasks=s,this.renderDailyTasks()}}}async clearCompleted(){if(!this.tasks.length)return;let t=this.tasks.filter(s=>!s.completed);if(t.length===this.tasks.length)return;this.pushUndoState();let n=this.tasks;this.tasks=t,this.renderDailyTasks();try{await this.saveDailyTasks(this.tasks)}catch(s){console.error("Failed to clear completed tasks",s),this.tasks=n,this.renderDailyTasks(),this.popUndoState()}}cycleTaskPriority(t){let n=this.tasks.findIndex(a=>a.id===t);if(n===-1)return;let s=this.tasks[n],i=ae.indexOf(s.priority),o=ae[(i+1)%ae.length];this.tasks=this.tasks.map(a=>a.id===t?{...a,priority:o}:a),this.renderDailyTasks(),this.saveDailyTasks(this.tasks)}deleteTask(t){this.tasks.find(s=>s.id===t)&&(this.pushUndoState(),this.tasks=this.tasks.filter(s=>s.id!==t),this.renderDailyTasks(),this.saveDailyTasks(this.tasks).catch(s=>{console.error("Failed to delete daily task",s),this.undoLastAction()}))}pushUndoState(){this.undoStack.push({tasks:this.tasks.map(t=>({...t}))}),this.updateUndoButton()}popUndoState(){let t=this.undoStack.pop();return this.updateUndoButton(),t}undoLastAction(){let t=this.popUndoState();t&&(this.tasks=fe(t.tasks),this.renderDailyTasks(),this.saveDailyTasks(this.tasks))}updateUndoButton(){this.undoButton&&(this.undoStack.length?this.undoButton.classList.remove("hidden"):this.undoButton.classList.add("hidden"))}readTodayId(){return this.todayId||nt()}async saveDailyTasks(t){let n=this.readTodayId(),s=fe(t);if(this.shouldUseLocalDailyList){this.setLocalDailyTasks(n,s);return}try{let i=await this.ensureDailyListFirestore();if(!i){this.setLocalDailyTasks(n,s);return}let o=this.getDailyListDocRef(i,n);typeof i.setDoc=="function"?await i.setDoc(o,{tasks:s},{merge:!0}):await i.updateDoc(o,{tasks:s}),this.setLocalDailyTasks(n,s)}catch(i){if(this.isPermissionDeniedError(i)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",i),this.shouldUseLocalDailyList=!0,this.showPermissionNotice(),this.setLocalDailyTasks(n,s);return}throw i}}}});var ro=ds(()=>{us();fs();et();ms();on();Qt();function Ts(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let s=document.querySelectorAll("[data-open-reminder-modal]");if(!s.length)return;if(!e){let m=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};s.forEach(h=>{h.addEventListener("click",v=>{if(v.preventDefault(),typeof window<"u"){let H="#reminders";window.location.hash!==H&&(window.location.hash=H),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{m()})})});return}let i=e.querySelector("[data-reminder-modal-backdrop]"),o=e.querySelectorAll("[data-close-modal]"),a=document.getElementById("mainContent"),l=document.querySelector('nav[aria-label="Primary"]'),c=[a,l],d=e.querySelector('[role="dialog"]')??e,p=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],y=null,T=()=>{if(!(d instanceof HTMLElement))return[];let m=d.querySelectorAll(p.join(","));return Array.from(m).filter(h=>{let v=h instanceof HTMLElement,H=typeof SVGElement<"u"&&h instanceof SVGElement;if(!v&&!H||h.getAttribute("aria-hidden")==="true"||"disabled"in h&&h.disabled||h.hidden||h.closest("[hidden]"))return!1;let E=h.getBoundingClientRect();return E.width>0&&E.height>0})},C=()=>{let m=T(),h=m.find(v=>v.hasAttribute("data-autofocus")||v.hasAttribute("autofocus"))||(n&&m.includes(n)?n:null)||m[0];if(h&&typeof h.focus=="function"){h.focus({preventScroll:!0});return}d instanceof HTMLElement&&typeof d.focus=="function"&&d.focus({preventScroll:!0})},k=m=>{d instanceof HTMLElement&&(!(m.target instanceof Node)||!d.contains(m.target))&&(m.stopPropagation(),C())},I=m=>{if(m.key!=="Tab")return;let h=T();if(!h.length){m.preventDefault(),d instanceof HTMLElement&&d.focus({preventScroll:!0});return}let v=h[0],H=h[h.length-1],E=document.activeElement;if(m.shiftKey){(!d.contains(E)||E===v)&&(m.preventDefault(),H.focus());return}(!d.contains(E)||E===H)&&(m.preventDefault(),v.focus())},V=m=>{c.forEach(h=>{h&&(m?h.setAttribute("inert",""):h.removeAttribute("inert"))})},_=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),V(!1),document.removeEventListener("keydown",N,!0),e.removeEventListener("keydown",I,!0),e.removeEventListener("focusin",k,!0),y&&typeof y.focus=="function"&&y.focus(),y=null},N=m=>{m.key==="Escape"&&(m.preventDefault(),_())},G=({triggerElement:m}={})=>{m&&typeof m.focus=="function"?y=m:y=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),V(!0),document.addEventListener("keydown",N,!0),e.addEventListener("keydown",I,!0),e.addEventListener("focusin",k,!0),window.requestAnimationFrame(()=>{C()})},j=(m,h={})=>{try{document.dispatchEvent(new CustomEvent(m,{detail:h}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let v=document.createEvent("CustomEvent");v.initCustomEvent(m,!0,!0,h),document.dispatchEvent(v)}}},B=(m={})=>{j("cue:cancelled",m)};s.forEach(m=>{m.addEventListener("click",h=>{h.preventDefault();let H={trigger:h.currentTarget instanceof HTMLElement?h.currentTarget:null,mode:"create"};j("cue:prepare",H),j("cue:open",H)})}),o.forEach(m=>{m.addEventListener("click",h=>{h.preventDefault(),B({trigger:m,reason:"button"})})}),e.addEventListener("click",m=>{m.target===e&&B({reason:"backdrop"})}),i?.addEventListener("click",m=>{m.target===i&&B({reason:"backdrop"})}),document.addEventListener("cue:open",m=>{let h=m?.detail?.trigger,v=h instanceof HTMLElement?h:null;G({triggerElement:v})});let P=()=>{_()};document.addEventListener("cue:close",P),document.addEventListener("cue:cancelled",P);let F=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&F instanceof HTMLElement&&t.addEventListener("submit",m=>{m.preventDefault(),!F.matches(":disabled")&&F.click()}),F instanceof HTMLElement&&document.addEventListener("reminder:save",m=>{let h=m?.detail?.trigger;h&&h!==F||F.matches(":disabled")||F.click()})}Ts();function it(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var an=null;function Ls(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function ks(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function ws(e){typeof document>"u"||!e||(window.clearTimeout(an),an=window.setTimeout(()=>{let t=Ls(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function ge(e){let t=e||ks();t&&ws(t)}function vs(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{ge()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",s=>{if(!(s.currentTarget instanceof HTMLAnchorElement))return;let i=s.currentTarget.getAttribute("href")||"";if(!i.startsWith("#"))return;s.preventDefault();let o=i||"#dashboard",a=o.replace("#","")||"dashboard";window.location.hash!==o&&(window.location.hash=o),typeof window.renderRoute=="function"&&window.renderRoute(),ge(a)})}),typeof window.renderRoute=="function"&&window.renderRoute(),ge()}vs();var rn=document.getElementById("settings-save-button"),Me=document.getElementById("settings-save-confirmation"),M=document.getElementById("live-status"),ot=null,te=document.getElementById("resourcePlannerStatus"),at=null;document.addEventListener("planner:reminderCreated",e=>{if(!M)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",s=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",i=s?`Reminder saved for ${s}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";M.textContent=i});rn&&Me&&rn.addEventListener("click",e=>{e.preventDefault(),Me.classList.remove("hidden"),Me.textContent="Settings saved!",M&&(M.textContent="Settings saved!"),ot&&window.clearTimeout(ot),ot=window.setTimeout(()=>{Me.classList.add("hidden")},3e3)});function Ss(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),ge(t),M&&(M.textContent="Opening planner to add a new lesson."),Dt(),window.requestAnimationFrame(()=>{let s=Zn();s&&typeof s.catch=="function"&&s.catch(i=>{console.error("Planner quick action failed to start new lesson flow",i)})})}function As(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Ss)})}As();function rt(e,{tone:t="success"}={}){te&&(te.textContent=e,te.classList.remove("hidden"),te.classList.remove("text-success","text-error"),te.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(at&&window.clearTimeout(at),at=window.setTimeout(()=>{te.classList.add("hidden"),te.textContent=""},4e3))),M&&(M.textContent=e)}function At(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function xs(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let s=n.getAttribute("data-resource-title")?.trim(),i=n.getAttribute("data-resource-link")?.trim();if(!s||!i)return;let o="#planner";window.location.hash!==o&&(window.location.hash=o),typeof window.renderRoute=="function"&&window.renderRoute(),ge("planner"),Dt(),await Ge();let a=`${s} \u2014 ${i}`,l=Ni(),c=null;try{if(l)c=await addLessonDetail(f,l,{badge:"Resource",text:a});else{let d=At("lesson"),p=b?.lessons?.[0]?.dayLabel||"Monday";c=await addLessonToWeek(f,{id:d,dayName:p,title:s,summary:`Resource link: ${i}`,details:[{badge:"Resource",text:a}]}),c&&(R=d)}if(c){b=c,x(c),D(c,f);let d=l?`Added "${s}" to your selected lesson.`:`Created a lesson for "${s}" in this week's planner.`;rt(d);return}rt("Unable to save that resource to the planner right now.",{tone:"error"})}catch(d){console.error("Failed to save resource to planner",d),rt("Unable to save that resource to the planner right now.",{tone:"error"})}}function Cs(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",xs)})}Cs();var xn=document.getElementById("reminder-title"),Is=document.getElementById("reminderText"),O=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),s=e.querySelector(".modal-backdrop button"),i=document.getElementById("modal-title");return Yt({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:s instanceof HTMLElement?s:null,titleInput:xn,modalTitle:i instanceof HTMLElement?i:null,defaultTitle:Ze,editTitle:Je})})();O?.setEditMode(!1);var Ds=()=>{let e=!!xn;if(!!Is)return De({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?De(n):De({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Ds().catch(e=>{console.error("Failed to initialise reminders",e)});var yt=initNotesSync(),lt=initSupabaseAuth({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{yt?.handleSessionChange(e)}});if(lt?.supabase){yt?.setSupabaseClient(lt.supabase);try{lt.supabase.auth.getSession().then(({data:e})=>{yt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var Y=document.getElementById("cues-list"),ct=document.getElementById("pinnedNotesCard"),ce=document.getElementById("pinnedNotesList"),ne=document.getElementById("cue-form"),U=ne?.querySelector("#cue-id-input"),Ms=O?.defaultTitle||O?.modalTitle?.textContent?.trim()||Ze,go=O?.editTitle||Je,Bs=document.getElementById("tab-cues"),Ns=document.getElementById("tab-daily"),Ps=document.getElementById("cues-view"),Fs=document.getElementById("daily-list-view"),Hs=document.getElementById("daily-list-header"),Rs=document.getElementById("quick-add-form"),Vs=document.getElementById("quick-add-input"),_s=document.getElementById("daily-voice-btn"),$s=document.getElementById("daily-tasks-container"),qs=document.getElementById("clear-completed-btn"),Us=document.getElementById("daily-list-permission-notice"),A=document.getElementById("plannerCards")||document.getElementById("planner-grid"),ln=document.getElementById("plannerWeekRange"),Os=document.getElementById("planner-prev"),js=document.getElementById("planner-next"),Ws=document.getElementById("planner-today"),zs=document.getElementById("planner-copy-week"),Qs=document.getElementById("planner-clear-week"),Ys=document.getElementById("planner-duplicate-btn"),Gs=document.getElementById("planner-new-lesson-btn"),ht=document.getElementById("planner-list-view-toggle"),gt=document.getElementById("planner-week-view-toggle"),Ee=document.getElementById("plannerWeekView"),$e=document.querySelector("[data-planner-text-size]"),dt=document.querySelector("[data-planner-card-panel]"),cn=document.getElementById("plannerSummaryCount"),qe=document.getElementById("plannerSummaryRange"),dn=document.getElementById("plannerInsightsLessons"),un=document.getElementById("plannerInsightsSubjects"),fn=document.getElementById("plannerInsightsNotes"),be=document.getElementById("plannerTeacherNotes"),ut=document.getElementById("plannerTeacherNotesStatus"),$=document.getElementById("planner-lesson-timetable"),bo=document.getElementById("timetable-form"),Eo=document.getElementById("timetable-list"),To=document.getElementById("timetable-day"),Lo=document.getElementById("timetable-period"),ko=document.getElementById("timetable-class"),wo=document.getElementById("timetable-subject"),vo=document.getElementById("timetable-submit"),So=document.getElementById("timetable-reset"),Be=document.querySelector("[data-mobile-notes-text-size]"),ft=document.querySelector(".mobile-panel--notes"),Cn="plannerTextSizePreference",Ue="default",ze=new Set(["small","default","large"]),Ks=["planner-text-small","planner-text-default","planner-text-large"],In="mobileNotesTextSizePreference",Oe="default",Qe=new Set(["small","default","large"]),Xs=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function bt(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function Zs(){if(typeof localStorage>"u")return Ue;let e=localStorage.getItem(Cn);return e&&ze.has(e)?e:Ue}function Js(e){typeof localStorage>"u"||!ze.has(e)||localStorage.setItem(Cn,e)}function Dn(e){if(!dt)return;let t=ze.has(e)?e:Ue;Ks.forEach(n=>dt.classList.remove(n)),dt.classList.add(`planner-text-${t}`)}var Mn=Zs();Dn(Mn);bt($e)&&($e.value=Mn);function Bn(){if(typeof localStorage>"u")return Oe;let e=localStorage.getItem(In);return e&&Qe.has(e)?e:Oe}function ei(e){typeof localStorage>"u"||!Qe.has(e)||localStorage.setItem(In,e)}function Nn(e){if(!ft)return;let t=Qe.has(e)?e:Oe;Xs.forEach(n=>ft.classList.remove(n)),ft.classList.add(`mobile-panel--notes-size-${t}`)}var Pn=Bn();Nn(Pn);Be instanceof HTMLSelectElement&&(Be.value=Pn,Be.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:Oe;if(!Qe.has(t)){Be.value=Bn();return}ei(t),Nn(t)}));var ti=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function ni(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=ti.findIndex(s=>s.toLowerCase()===t.toLowerCase());return n>=0?n:0}function si(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function ii(e){if(!e)return"";let t=[],n=typeof e.day=="string"?e.day.trim():"",s=typeof e.period=="string"?e.period.trim():"",i=typeof e.className=="string"?e.className.trim():"";return n&&t.push(n.charAt(0).toUpperCase()+n.slice(1)),s&&t.push(s),i&&t.push(i),t.join(" \u2013 ")}function je(e){return Number.isFinite(e)?e<0?0:e>6?6:e:1}function Et(e){if(typeof e!="string")return"Monday";let t=e.trim();return t?t.charAt(0).toUpperCase()+t.slice(1):"Monday"}function mt(e=""){if(!($ instanceof HTMLSelectElement))return;let t=['<option value="">No timetable link</option>'];It.forEach(n=>{let s=ii(n)||"Timetable slot",i=e&&n.id===e?"selected":"";t.push(`<option value="${n.id}" ${i}>${L(s)}</option>`)}),$.innerHTML=t.join(""),e&&$.value!==e&&($.value=e)}function oi(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),s=document.getElementById("planner-modal-description"),i=document.getElementById("planner-modal-error"),o=document.getElementById("planner-modal-submit"),a=document.getElementById("planner-modal-submit-add-another"),l=document.getElementById("planner-lesson-day"),c=document.getElementById("planner-lesson-period"),d=document.getElementById("planner-lesson-title"),p=document.getElementById("planner-lesson-summary"),y=document.getElementById("planner-lesson-subject"),T=document.getElementById("planner-lesson-status"),C=document.getElementById("planner-detail-badge"),k=document.getElementById("planner-detail-text"),I=document.getElementById("planner-duplicate-week"),V=t?.querySelectorAll("[data-summary-template]")||[];if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(o instanceof HTMLElement)||!(l instanceof HTMLSelectElement)||!(c instanceof HTMLInputElement)||!(d instanceof HTMLInputElement)||!(p instanceof HTMLTextAreaElement)||!(T instanceof HTMLSelectElement))return null;let _=t.querySelector("[data-planner-lesson-section]"),N=t.querySelector("[data-planner-summary-section]"),G=t.querySelector("[data-planner-detail-section]"),j=t.querySelector("[data-planner-duplicate-section]"),B=e.querySelector("[data-planner-modal-dialog]"),P=e.querySelector("[data-planner-modal-backdrop]"),F=e.querySelectorAll("[data-planner-modal-close]"),m=document.getElementById("mainContent"),h=document.querySelector('nav[aria-label="Primary"]'),v=(()=>{let r=[],u=e.parentElement;return h instanceof HTMLElement&&r.push(h),u instanceof HTMLElement?r.push(...Array.from(u.children).filter(g=>g instanceof HTMLElement&&g!==e)):m instanceof HTMLElement&&(m.contains(e)?r.push(...Array.from(m.children).filter(g=>g instanceof HTMLElement&&!g.contains(e))):r.push(m)),r})(),H=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],E={mode:"add",lessonId:null,trigger:null},ke=null,Mt=null,Bt="",Nt="",K="simple",we="save",ee=r=>{ke=r instanceof HTMLElement?r:null},Pt=r=>{we=r},ue=r=>{if(!(T instanceof HTMLSelectElement))return;let u=de[r]?r:"not_started";T.value=u},ve=r=>{let u=typeof r=="string"&&r.trim()?r.trim():"Monday";l.value=u,l.value!==u&&(l.value="Monday")},ss=r=>{let u=Xn(r||"simple");!u||typeof p.value=="string"&&p.value.trim()&&!window.confirm("Replace existing summary with this template?")||(p.value=u,K=r||"simple",p.focus())},Ft=r=>{v.forEach(u=>{u&&(r?u.setAttribute("inert",""):u.removeAttribute("inert"))})},Ht=()=>{if(!(B instanceof HTMLElement))return[];let r=B.querySelectorAll(H.join(","));return Array.from(r).filter(u=>{if(u.closest('[aria-hidden="true"]')||"disabled"in u&&u.disabled)return!1;let g=u.getBoundingClientRect();return g.width>0&&g.height>0})},Rt=()=>{let r=Ht(),u=(ke&&r.includes(ke)?ke:null)||r[0]||B;u&&typeof u.focus=="function"&&u.focus({preventScroll:!0})},Vt=r=>{B instanceof HTMLElement&&(B.contains(r.target)||Rt())},is=r=>{if(r.key!=="Tab")return;let u=Ht();if(!u.length){r.preventDefault();return}let g=u[0],q=u[u.length-1];if(r.shiftKey&&document.activeElement===g){r.preventDefault(),q.focus();return}!r.shiftKey&&document.activeElement===q&&(r.preventDefault(),g.focus())},_t=r=>{if(r.key==="Escape"){r.preventDefault(),W();return}is(r)},$t=()=>{i&&(i.textContent="",i.classList.add("hidden"),i.setAttribute("aria-hidden","true"))},X=r=>{i&&(i.textContent=r,i.classList.remove("hidden"),i.removeAttribute("aria-hidden"))},qt=r=>{o.disabled=!!r,o.classList.toggle("loading",!!r),a instanceof HTMLButtonElement&&(a.disabled=!!r,a.classList.toggle("loading",!!r))},S=(r,u)=>{r instanceof HTMLElement&&(r.classList.toggle("hidden",!u),u?r.removeAttribute("aria-hidden"):r.setAttribute("aria-hidden","true"))},Se=r=>{[l,c,d,p,y,T,$].forEach(u=>{u instanceof HTMLElement&&(u.disabled=!!r,u.classList.toggle("opacity-60",!!r),u.classList.toggle("cursor-not-allowed",!!r))}),V.forEach(u=>{u instanceof HTMLButtonElement&&(u.disabled=!!r,u.classList.toggle("opacity-60",!!r),u.classList.toggle("cursor-not-allowed",!!r))})},se=()=>{t.reset(),$t(),ee(null),Se(!1),mt(""),$ instanceof HTMLSelectElement&&($.value=""),y instanceof HTMLInputElement&&(y.value=""),c instanceof HTMLInputElement&&(c.value=""),C instanceof HTMLInputElement&&(C.value=""),(k instanceof HTMLTextAreaElement||k instanceof HTMLInputElement)&&(k.value=""),I instanceof HTMLInputElement&&(I.value=""),ue("not_started"),K="simple",we="save"},Ae=({title:r,description:u,action:g})=>{n&&(n.textContent=r||"Plan lesson"),s&&(s.textContent=u||""),o.textContent=g||"Save lesson"},xe=({trigger:r}={})=>{E.trigger=r instanceof HTMLElement?r:null,Mt=E.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),Ft(!0),document.addEventListener("keydown",_t,!0),e.addEventListener("focusin",Vt,!0),window.requestAnimationFrame(()=>{Rt()})},W=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),Ft(!1),document.removeEventListener("keydown",_t,!0),e.removeEventListener("focusin",Vt,!0);let r=E.trigger||Mt;E.mode="add",E.lessonId=null,E.trigger=null,ee(null),se(),r&&typeof r.focus=="function"&&r.focus({preventScroll:!0})},os=({defaultDay:r="Monday",trigger:u,timetableEntry:g}={})=>{E.mode="add",E.lessonId=null,se(),S(_,!0),S(N,!0),S(G,!1),S(j,!1),Se(!1);let q=typeof g?.day=="string"&&g.day.trim()?g.day.charAt(0).toUpperCase()+g.day.slice(1):typeof r=="string"&&r.trim()?r.trim():"Monday";ve(q),d.value=g?.className&&g.className.trim()||(q?`${q} lesson`:""),p.value="",c instanceof HTMLInputElement&&(c.value=g?.period||""),y instanceof HTMLInputElement&&(y.value=g?.subject||""),mt(g?.id||""),ue("not_started"),K="simple",Ae({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),ee(d),xe({trigger:u})},as=({lesson:r,trigger:u}={})=>{if(!r)return;E.mode="edit",E.lessonId=r.id,se(),S(_,!0),S(N,!0),S(G,!1),S(j,!1),Se(!1);let g=r.dayLabel||r.dayName||"Monday";ve(g),d.value=r.title||"",p.value=r.summary||"",c instanceof HTMLInputElement&&(c.value=r.period||""),y instanceof HTMLInputElement&&(y.value=r.subject||""),mt(r.timetableEntryId||""),$ instanceof HTMLSelectElement&&($.value=r.timetableEntryId||""),ue(r.status||"not_started"),K=r.templateType||"simple",Ae({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),ee(d),xe({trigger:u})},rs=({lesson:r,trigger:u}={})=>{if(!r)return;E.mode="detail",E.lessonId=r.id,se(),S(_,!0),S(N,!0),S(G,!0),S(j,!1),Se(!0);let g=r.dayLabel||r.dayName||"Monday";ve(g),d.value=r.title||"",p.value=r.summary||"",c instanceof HTMLInputElement&&(c.value=r.period||""),y instanceof HTMLInputElement&&(y.value=r.subject||""),ue(r.status||"not_started"),K=r.templateType||"simple",C instanceof HTMLInputElement&&(C.value=""),(k instanceof HTMLTextAreaElement||k instanceof HTMLInputElement)&&(k.value=""),Ae({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),ee(k instanceof HTMLElement?k:null),xe({trigger:u})},ls=({suggestedWeekId:r="",trigger:u}={})=>{E.mode="duplicate",E.lessonId=null,se(),S(_,!1),S(N,!1),S(G,!1),S(j,!0),I instanceof HTMLInputElement&&(I.value=r),Ae({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),ee(I instanceof HTMLElement?I:null),xe({trigger:u})},cs=async r=>{r.preventDefault(),$t(),qt(!0);let u=we==="add_another";try{if(E.mode==="duplicate"){let w=I?.value?.trim();if(!w){X("Enter the Monday date for the destination week.");return}if(w===f){X("Choose a different week to duplicate into.");return}let ie=await duplicateWeekPlan(f,w);ie&&(f=w,jn(w),b=ie,x(ie),D(ie,w),W());return}if(E.mode==="detail"){if(!E.lessonId){X("Select a lesson before adding details.");return}let w=k?.value?.trim();if(!w){X("Add text for this detail.");return}let ie=C?.value?.trim()||"",Ie=await addLessonDetail(f,E.lessonId,{badge:ie,text:w});Ie&&(b=Ie,x(Ie),D(Ie,f),W());return}let g=l.value.trim(),q=c?.value?.trim()||"",Ke=d.value.trim(),Ut=p.value.trim(),Xe=y?.value?.trim()||"",Ot=de[T?.value]?T.value:"not_started",jt=$ instanceof HTMLSelectElement?$.value:"",Wt=(()=>{let w=getWeekDateForDayIndex(f,1);return w instanceof Date&&!Number.isNaN(w.getTime())?w.toISOString():""})();if(!g){X("Choose a day for this lesson.");return}if(!Ke){X("Enter a lesson title.");return}if(E.mode==="edit"){if(!E.lessonId){X("Select a lesson to edit.");return}let w=await updateLessonInWeek(f,E.lessonId,{dayName:g,title:Ke,summary:Ut,subject:Xe,period:q,status:Ot,timetableEntryId:jt,weekStartDate:Wt,templateType:K||"simple"});w&&(b=w,x(w),D(w,f),W());return}let Ce=await addLessonToWeek(f,{dayName:g,title:Ke,summary:Ut,subject:Xe,period:q,status:Ot,timetableEntryId:jt,weekStartDate:Wt,templateType:K||"simple"});Ce&&(b=Ce,x(Ce),D(Ce,f),u?(Bt=g,Nt=Xe,se(),ve(Bt||"Monday"),d.value=l.value?`${l.value} lesson`:"",y instanceof HTMLInputElement&&(y.value=Nt||""),ue("not_started"),K="simple",ee(d)):W())}catch(g){console.error("Failed to save planner change",g),X("Unable to save changes right now. Please try again.")}finally{qt(!1),we="save"}};return a instanceof HTMLButtonElement&&a.addEventListener("click",()=>Pt("add_another")),o.addEventListener("click",()=>Pt("save")),V.forEach(r=>{r instanceof HTMLButtonElement&&r.addEventListener("click",u=>{u.preventDefault();let g=r.dataset.summaryTemplate||"simple";ss(g)})}),t.addEventListener("submit",cs),F.forEach(r=>{r.addEventListener("click",u=>{u.preventDefault(),W()})}),e.addEventListener("click",r=>{r.target===e&&W()}),P?.addEventListener("click",r=>{r.target===P&&W()}),{openAddLesson:os,openEditLesson:as,openAddDetail:rs,openDuplicatePlan:ls,close:W}}var mn=document.getElementById("remindersCount"),Z=typeof document<"u"?oi():null,pn=document.getElementById("plannerCount"),yn=document.getElementById("plannerSubtitle"),Ao=document.getElementById("resourcesCount"),xo=document.getElementById("templatesCount"),Ne=document.getElementById("dailySnapshotList"),Pe=document.getElementById("todaysFocusList"),z=document.getElementById("weekAtAGlanceList"),Q=null;z&&(Q=document.createElement("li"),Q.dataset.emptyState="week",Q.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",Q.textContent="No upcoming events this week.");var hn=()=>{if(!z||!Q)return;z.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?z.contains(Q)||z.appendChild(Q):z.contains(Q)&&z.removeChild(Q)};z&&(hn(),new MutationObserver(hn).observe(z,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var pt=e=>{ct&&(e?ct.classList.remove("hidden"):ct.classList.add("hidden"))},Te={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},gn=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),bn=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),Re=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",xt=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},ai=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Fn=e=>{if(!e)return"";if(gn)try{return gn.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},ri=e=>{if(!e)return"";if(bn)try{return bn.format(e)}catch{}return e.toLocaleDateString()},Hn=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Te,t)?t:"medium"},En=e=>{let t=Hn(e);return Te[t]?.rank??Te.medium.rank},li=e=>{let t=Hn(e);return Te[t]??Te.medium},Tn=e=>{let t=xt(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Rn(e=[]){if(!Ne)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(s=>({reminder:s,date:xt(s)})).filter(({date:s})=>s&&ai(s,t)).sort((s,i)=>s.date.getTime()-i.date.getTime());if(!n.length){Ne.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Ne.innerHTML="",n.forEach(({reminder:s,date:i})=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=Re(s),o.appendChild(a);let l=Fn(i),c=document.createElement("p");c.className="text-xs text-base-content/70",c.textContent=l?`Due ${l}`:"Due today",o.appendChild(c),Ne.appendChild(o)})}function Vn(e=[]){if(!Pe)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,s)=>{let i=En(n)-En(s);if(i!==0)return i;let o=Tn(n)-Tn(s);return o!==0?o:Re(n).localeCompare(Re(s),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){Pe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}Pe.innerHTML="",t.forEach(n=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let i=document.createElement("div");i.className="flex items-center justify-between gap-3";let o=document.createElement("p");o.className="font-semibold text-base-content",o.textContent=Re(n),i.appendChild(o);let a=li(n),l=document.createElement("span");l.className=a.badgeClass,l.textContent=a.badgeLabel,i.appendChild(l),s.appendChild(i);let c=xt(n),d=document.createElement("p");if(d.className="text-xs text-base-content/70",c){let p=Fn(c),y=ri(c),T=[];p&&T.push(`Due ${p}`),y&&T.push(y),d.textContent=T.length?T.join(" \u2022 "):"Due soon"}else d.textContent="No due date";s.appendChild(d),Pe.appendChild(s)})}var ci=e=>{if(!mn)return;let t=Array.isArray(e)?e.length:0;mn.textContent=String(t)},di=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];ci(t),Rn(t),Vn(t)};document.addEventListener("memoryCue:remindersUpdated",di);Rn();Vn();var Tt=Kt(Gt),ui={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},Fe=null,fi=3,Ln=120;function mi(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Ln?t:`${t.slice(0,Ln-1)}\u2026`:""}function pi(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let s=n.trim().toLowerCase();return s==="true"||s==="1"||s==="yes"}return!1})}function kn(e){if(!ce)return;let t=Array.isArray(e)?e:[];if(!t.length){ce.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',pt(!1);return}let n=t.filter(o=>pi(o));if(!n.length){ce.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',pt(!1);return}pt(!0);let i=n.slice(0,fi).map(o=>{let a=L(oe(o,"title")||"Untitled Cue"),l=oe(o,"details"),c=L(mi(l)),d=c?`<p class="mt-1 text-sm text-base-content/70">${c}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${a}</p>
          ${d}
        </li>
      `}).join("");ce.innerHTML=i}function Lt(e,{tone:t="muted"}={}){if(!Y)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),Y.innerHTML=`<p class="${n.join(" ")}">${L(e)}</p>`}function yi(e){if(!Y)return;if(!Array.isArray(e)||e.length===0){Lt("No cues yet.");return}let t=e.map(n=>{let s=L(oe(n,"title")||"Untitled Cue"),i=L(oe(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${s}</h2>
            ${i?`<p>${i}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${L(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${L(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");Y.innerHTML=t}async function Le(){return Fe||(Fe=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:s,enableIndexedDbPersistence:i,collection:o,doc:a,getDoc:l,addDoc:c,updateDoc:d,getDocs:p,query:y,orderBy:T,serverTimestamp:C,setDoc:k,arrayUnion:I}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),V=t(),_=V&&V.length?V[0]:e(ui),N=n(_);(function(){let B=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;B&&(B.__persistenceInitialized__||(B.__persistenceInitialized__=!0,(async()=>{try{await s(N),console.info("[Firestore] Persistence: multi-tab enabled")}catch(P){if(P&&P.code==="failed-precondition")try{await i(N),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(F){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",F?.code||F)}else P&&P.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",P?.code||P)}})()))})();let G=o(N,"cues");return{db:N,cuesCollection:G,getCollection:o,doc:a,getDoc:l,addDoc:c,updateDoc:d,getDocs:p,query:y,orderBy:T,serverTimestamp:C,setDoc:k,arrayUnion:I}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),Fe)}async function hi(){let e=await Le(),{getDocs:t,cuesCollection:n,query:s,orderBy:i}=e,o=s&&i?s(n,i("createdAt","desc")):n;return(await t(o)).docs.map(l=>({id:l.id,...l.data()}))}async function gi(e){if(!e)return null;let t=await Le(),{db:n,doc:s,getDoc:i}=t,o=s(n,"cues",e),a=await i(o);return a.exists()?{id:a.id,...a.data()}:null}async function _n(){if(!(!Y&&!ce))try{let e=await hi();yi(e),kn(e)}catch(e){console.error("Failed to load cues",e),isPermissionDeniedError(e)?Lt("Sign in to view your cues.",{tone:"muted"}):Lt("Unable to load cues right now.",{tone:"error"}),kn([])}}function bi(e){!ne||!U||(Xt(e,Tt),U.value=e?.id||"",O?.setEditMode(!0),O?.show({mode:"edit"}))}async function Ei(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let s=await gi(n);if(!s)return;bi(s)}catch(s){console.error("Failed to prepare cue for editing",s)}}async function Ti(e){if(e.preventDefault(),!ne||!U)return;let t=U.value.trim(),n=Jt(Tt);try{let s=await Le(),{db:i,doc:o,addDoc:a,updateDoc:l,cuesCollection:c,serverTimestamp:d}=s,p=typeof d=="function"?d():null;if(t){let y=o(i,"cues",t),T={...n};p&&(T.updatedAt=p),await l(y,T)}else{let y={...n};p&&(y.createdAt=p,y.updatedAt=p),await a(c,y)}await _n(),Zt(Tt,U,O?.modalTitle??null,Ms),await O?.hide({reason:"form-submit"})}catch(s){console.error("Failed to save cue",s)}}async function Li(){!ne||!U||!Y||(Y.addEventListener("click",Ei),ne.addEventListener("submit",Ti))}ne&&U&&(document.addEventListener("cue:prepare",()=>{U.value="",O?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{U.value="",O?.setEditMode(!1)}));ne&&U&&Y&&Li().catch(e=>{console.error("Failed to initialise cue editing",e)});(Y||ce)&&_n();var Ct=getPlannerWeekIdFromDate(),Ve=!1,f=Ct,b=null,he=null,R=null,It=getTimetableEntries(),We=new Map,ki=800,$n=1500,wn={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},qn=new Set(["saving","saved","error"]),Un="plannerNotesOpenState",re=vi(),He=null,On="list",wi=800;function vi(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Un);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function Si(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Un,JSON.stringify(re))}catch(e){console.warn("Unable to persist planner notes state",e)}}function Ai(e,t){if(e){if(t)re={...re,[e]:!0};else if(re?.[e]){let n={...re};delete n[e],re=n}Si()}}function xi(e,t=Ct){return Array.isArray(e)?e:e&&typeof e=="object"&&Array.isArray(e.lessons)?e.lessons:typeof t=="string"&&t?getPlannerLessonsForWeek(t):[]}var Ci=(e=[])=>{if(!pn)return;let t=Array.isArray(e)?e.length:0;pn.textContent=String(t)};function Ii(e=[]){let t=Array.isArray(e)?e:[];if(dn&&(dn.textContent=String(t.length)),un){let n=new Set;t.forEach(s=>{let i=zn(s);i&&n.add(i.toLowerCase())}),un.textContent=String(n.size)}if(fn){let n=t.filter(s=>typeof s.notes=="string"&&s.notes.trim().length>0).length;fn.textContent=String(n)}}function D(e,t){let n=xi(e,t);Ci(n);let s=e?.weekId||t||Ct,i=getWeekLabel(s,{short:!0});yn&&(yn.textContent=i||""),cn&&(cn.textContent=String(n.length)),qe&&(qe.textContent=i||""),Ii(n)}function vn(e,{tone:t="muted"}={}){if(!A)return;R=null;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),A.innerHTML=`<p class="${n.join(" ")}">${L(e)}</p>`}function jn(e){if(!ln)return;let t=getWeekLabel(e);ln.textContent=t||"",qe&&(qe.textContent=t||"")}function Wn(e=f){let t=getWeekDateForDayIndex(e,1);return t instanceof Date&&!Number.isNaN(t.getTime())?t.toISOString():""}function zn(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function Di(e){if(!e)return"badge-ghost";let t=e.toLowerCase();return t.includes("hpe")||t.includes("pe")?"badge-info":t.includes("english")?"badge-success":t.includes("civics")||t.includes("cac")?"badge-secondary":t.includes("geo")?"badge-warning":"badge-ghost"}var de={not_started:{label:"Not started",badge:"badge-ghost"},in_progress:{label:"In progress",badge:"badge-warning"},ready:{label:"Ready",badge:"badge-success"},taught:{label:"Taught",badge:"badge-neutral"}};function Qn(e=[],t=f){let n=Array.isArray(e)?e:[],s=new Set,i=Wn(t),o=[];return It.forEach(a=>{let l=n.find(d=>d.timetableEntryId===a.id),c=je(Number(a.dayIndex));l?(s.add(l.id),o.push({type:"lesson",entry:a,lesson:l,dayIndex:c})):o.push({type:"slot",entry:a,lesson:null,dayIndex:c,weekStartDate:i})}),n.forEach(a=>{if(s.has(a.id))return;let l=je(Number(a.dayIndex));o.push({type:"lesson",entry:null,lesson:a,dayIndex:l,isLoose:!0})}),o.sort((a,l)=>{if(a.dayIndex!==l.dayIndex)return a.dayIndex-l.dayIndex;let c=a.entry?.period||a.lesson?.period||"",d=l.entry?.period||l.lesson?.period||"";if(c&&d&&c!==d)return c.localeCompare(d,void 0,{numeric:!0,sensitivity:"base"});let p=a.entry?.className||a.lesson?.title||"",y=l.entry?.className||l.lesson?.title||"";return p.localeCompare(y)})}function x(e){let t=document.querySelector(".planner-grid");if(!t)return;let n=Array.isArray(e?.lessons)?e.lessons:[],s=["Monday","Tuesday","Wednesday","Thursday"];s.map(o=>({day:o,lessons:n.filter(a=>a.dayName===o)})).forEach(o=>{let l=t.querySelector(`.day-card:nth-child(${s.indexOf(o.day)+1})`).querySelector(".day-content");if(o.lessons.length===0){l.innerHTML='<p class="text-sm text-base-content/60">No lessons planned for this day.</p>';return}l.innerHTML=o.lessons.map(c=>`
      <div class="lesson-card">
        <p class="lesson-title">${c.title}</p>
        <div class="lesson-details">
          ${c.details.map(d=>`
            <div class="lesson-tag">
              <span class="tag-dot" style="background-color: ${d.color||"#888"};"></span>
              <span>${d.text}</span>
            </div>
          `).join("")}
        </div>
        <button class="btn btn-sm btn-outline add-detail-btn">Add detail</button>
      </div>
    `).join("")})}function Mi(e=[],t=null){if(!Ee)return;let n=Array.isArray(t)?t:Qn(e,f),i=[{day:"Monday",index:1},{day:"Tuesday",index:2},{day:"Wednesday",index:3},{day:"Thursday",index:4},{day:"Friday",index:5}].map(a=>({...a,items:[]}));n.forEach(a=>{let l=je(Number(a?.dayIndex)),c=i.find(d=>d.index===l);c&&c.items.push(a)});let o=i.map(({day:a,items:l})=>{let c=l.map(p=>{if(p.type==="slot"&&p.entry){let V=p.entry.period?` \xB7 ${L(p.entry.period)}`:"",_=p.entry.subject?`<span class="badge badge-ghost badge-xs">${L(p.entry.subject)}</span>`:"";return`
              <div class="rounded-xl border border-dashed border-base-200 bg-base-100 px-3 py-2">
                <div class="flex items-start justify-between gap-2">
                  <div>
                    <p class="text-xs font-semibold text-base-content/70">${L(p.entry.className||"Timetable slot")}</p>
                    <p class="text-xs text-base-content/60">${L(Et(p.entry.day||a)+V)}</p>
                  </div>
                  ${_}
                </div>
                <div class="mt-2 flex flex-wrap justify-end">
                  <button class="btn btn-primary btn-ghost btn-xs" type="button" data-planner-action="create-slot" data-timetable-entry-id="${p.entry.id}">Plan lesson</button>
                </div>
              </div>
            `}let y=p.lesson||p,T=zn(y),C=Di(T),k=de[y.status]?.label||de.not_started.label,I=de[y.status]?.badge||de.not_started.badge;return`
            <button
              type="button"
              class="w-full text-left rounded-xl border border-base-200 bg-base-100 px-3 py-2 shadow-sm transition hover:-translate-y-[1px] hover:shadow"
              data-week-view-lesson="${y.id||""}"
            >
              <div class="flex items-start justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold text-base-content/70">${L(y.title||y.dayLabel||"Lesson")}</p>
                  <p class="text-xs text-base-content/60">${L(y.summary||"")}</p>
                </div>
                <div class="flex flex-col items-end gap-1">
                  ${T?`<span class="badge ${C} badge-xs">${L(T)}</span>`:""}
                  <span class="badge ${I} badge-xs">${L(k)}</span>
                </div>
              </div>
            </button>
          `}).join("");return`
        <div class="space-y-2 rounded-2xl border border-base-200 bg-base-200/50 p-3">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-base-content/70">${a}</p>
          <div class="space-y-2">${c||'<p class="text-xs text-base-content/60">No lessons yet.</p>'}</div>
        </div>
      `}).join("");Ee.innerHTML=o}function _e(e="list"){let t=e==="week"?"week":"list";if(On=t,A&&A.classList.toggle("hidden",t==="week"),Ee&&Ee.classList.toggle("hidden",t!=="week"),ht instanceof HTMLElement&&ht.setAttribute("aria-pressed",t==="list"?"true":"false"),gt instanceof HTMLElement&&gt.setAttribute("aria-pressed",t==="week"?"true":"false"),t==="week"){let n=b?.lessons||[];Mi(n,Qn(n,f))}}function Yn(e){R=e||null,A&&A.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function Bi(e){let t=e.target instanceof Element?e.target.closest("[data-week-view-lesson]"):null;if(!t)return;let n=t.getAttribute("data-week-view-lesson");if(!n)return;_e("list"),Yn(n);let s=A?.querySelector(`[data-lesson-id="${n}"]`);s instanceof HTMLElement&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"center"})}function Ni(){return R&&(Array.isArray(b?.lessons)?b.lessons:[]).some(t=>t.id===R)?R:null}function Pi(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===R||Yn(n)}function Fi(e){let t=bt(e?.currentTarget)?e.currentTarget:$e;if(!bt(t))return;let n=t.value,s=ze.has(n)?n:Ue;Dn(s),Js(s),t.value!==s&&(t.value=s)}function Ye(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function Gn(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function Kn(e){if(!e)return;let t=We.get(e);if(!t)return;let n=Gn();n&&n(t),We.delete(e)}function me(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&qn.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function pe(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&qn.has(t)?t:null,s=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(s instanceof HTMLElement){let i=n||"idle",o=wn[i]||wn.idle;s.textContent=o,s.setAttribute("data-status",i)}}function ye(e="idle"){if(!(ut instanceof HTMLElement))return;let t={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},n=t[e]||t.idle;ut.textContent=n,ut.setAttribute("data-status",e)}async function Hi(e){if(f){ye("saving");try{let t=await updatePlannerTeacherNotes(f,e);t&&(b=t),ye("saved");let n=Ye();n?n(()=>ye("idle"),$n):ye("idle")}catch(t){console.error("Failed to save teacher notes",t),ye("error")}}}function Ri(e){if(!(be instanceof HTMLTextAreaElement)||e?.target!==be)return;if(He){let n=Gn();n&&n(He)}let t=Ye();t&&(He=t(()=>{He=null,Hi(be.value)},wi))}function Xn(e="simple"){switch(e){case"hpe":return`Focus skill:
Warm-up:
Skill drill:
Modified game:
Reflection questions:`;case"english":return`Text focus:
Discussion questions:
Mentor sentence:
Writing task:
Reflection / exit ticket:`;case"cac":return`Civics topic:
Key terms:
Source / video:
Discussion questions:
Activity:
Reflection question:`;case"simple":default:return`Learning intention:
Success criteria:
Warm-up:
Main activity:
Exit task:`}}async function Vi(e,t){if(!e)return;await Ge();let n=b?.lessons?.find(a=>a.id===e);if(!n)return;let s=Xn(t),i=typeof n.notes=="string"?n.notes:"";if(i&&typeof window<"u"&&typeof window.confirm=="function"&&!window.confirm("Add this template to the existing notes?"))return;let o=i?`${i.trim()}

${s}`:s;try{let a=await updateLessonInWeek(f,e,{notes:o,templateType:t||"simple"});a&&(b=a,x(a),D(a,f))}catch(a){console.error("Failed to apply lesson template",a)}}async function _i(e){let t=e.target instanceof HTMLSelectElement&&e.target.hasAttribute("data-lesson-status")?e.target:null;if(!t)return;let n=t.getAttribute("data-lesson-id"),s=t.value;if(n)try{let i=await updateLessonInWeek(f,n,{status:s});i&&(b=i,x(i),D(i,f))}catch(i){console.error("Failed to update lesson status",i)}}async function $i(e,t,n){if(!e||!(t instanceof HTMLInputElement)||!(n instanceof HTMLInputElement))return;let s=t.value.trim(),i=n.value.trim();if(!s&&!i)return;let o=b?.lessons?.find(l=>l.id===e);if(!o)return;let a=Array.isArray(o.resources)?[...o.resources]:[];a.push({id:At("resource"),label:s,url:i});try{let l=await updateLessonInWeek(f,e,{resources:a});l&&(b=l,x(l)),t.value="",n.value=""}catch(l){console.error("Failed to add resource",l)}}async function qi(e,t){if(!e||!t)return;let n=b?.lessons?.find(i=>i.id===e);if(!n)return;let s=(n.resources||[]).filter(i=>i?.id!==t);try{let i=await updateLessonInWeek(f,e,{resources:s});i&&(b=i,x(i))}catch(i){console.error("Failed to remove resource",i)}}async function kt(e,t,n){if(!e||!f)return;let s=n instanceof HTMLTextAreaElement?n:null;s&&(me(s,"saving"),pe(s,"saving"));try{let i=await updateLessonInWeek(f,e,{notes:t});if(i&&(b=i),s){me(s,"saved"),pe(s,"saved");let o=Ye();o?o(()=>{s.getAttribute("data-notes-status")==="saved"&&(me(s,null),pe(s,null))},$n):(me(s,null),pe(s,null))}}catch(i){console.error("Failed to save planner notes",i),s&&(me(s,"error"),pe(s,"error"))}}function Ui(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;Kn(n);let s=Ye();if(!s){kt(n,t.value,t);return}let i=s(()=>{We.delete(n),kt(n,t.value,t)},ki);We.set(n,i)}function Oi(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(Kn(n),kt(n,t.value,t))}function ji(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let s=t.hasAttribute("open");Ai(n,s)}function le(e){if(!A)return he=null,Promise.resolve();let t=e||getPlannerWeekIdFromDate();f=t,jn(t),vn("Loading plan\u2026");let n=(async()=>{try{let s=await loadWeekPlan(t);b=s,x(s),D(s,t)}catch(s){console.error("Failed to load planner week",s),vn("Unable to load this week's planner.",{tone:"error"})}})();return he=n,n.finally(()=>{he===n&&(he=null)})}async function Ge(){if(!A)return;Ve||Dt();let e=he;if(!e&&(!b||b.weekId!==f)&&(e=le(f)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function Wi(e,t){if(!e)return;await Ge();let n=Array.isArray(b?.lessons)?b.lessons:[];if(!n.length)return;let s=n.find(C=>C?.id===e);if(!s)return;let i=typeof s.dayLabel=="string"&&s.dayLabel.trim()?s.dayLabel.trim():typeof s.dayName=="string"&&s.dayName.trim()?s.dayName.trim():"",o=typeof s.title=="string"&&s.title.trim()?s.title.trim():i||"Lesson",a=typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():"",l=a||o,c=i?`${i} \xB7 ${l}`:l,d=a||"",p=ni(s),y=si(getWeekDateForDayIndex(f,p)),T={reminderTitle:c,reminderNotes:d,dueDate:y,dayLabel:i,lessonTitle:o,summary:a,plannerLessonId:e};it("cue:prepare",{trigger:t,source:"planner"}),it("planner:prefillReminder",T),it("cue:open",{trigger:t,source:"planner"})}async function zi(e,t){if(!e)return;await Ge();let s=(Array.isArray(b?.lessons)?b.lessons:[]).find(l=>l?.id===e);if(!s)return;let i=t instanceof HTMLElement?t:null;i&&i.setAttribute("disabled","true");let o=At("lesson"),a={id:o,dayIndex:s.dayIndex,dayLabel:s.dayLabel,dayName:s.dayName,title:s.title,summary:s.summary,subject:s.subject,notes:s.notes,period:s.period,templateType:s.templateType||"simple",status:"not_started",resources:Array.isArray(s.resources)?s.resources.map(l=>({label:l?.label||"",url:l?.url||""})):[],details:Array.isArray(s.details)?s.details.map(l=>({badge:l?.badge||"",text:l?.text||""})):[]};try{let l=await addLessonToWeek(f,a),c=l;l&&Number.isFinite(s.position)&&(c=await updateLessonInWeek(f,o,{position:s.position+.1})),c&&(b=c,R=o,x(c),D(c,f),M&&(M.textContent=`Duplicated ${s.title||"lesson"} into this week.`))}catch(l){console.error("Failed to duplicate planner lesson",l),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{i&&i.removeAttribute("disabled")}}async function Qi(e,t){if(!e||!f)return;let n=It.find(i=>i.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;s&&s.setAttribute("disabled","true");try{let i=Wn(f),o=await addLessonToWeek(f,{dayIndex:je(Number(n.dayIndex)),dayName:Et(n.day),title:n.className||Et(n.day||"Monday"),summary:"",subject:n.subject||"",period:n.period||"",status:"not_started",timetableEntryId:n.id,weekStartDate:i});o&&(b=o,R=o.lessons?.find(l=>l.timetableEntryId===n.id&&(!l.weekStartDate||l.weekStartDate===i))?.id||R,x(o),D(o,f))}catch(i){console.error("Failed to create lesson from timetable slot",i)}finally{s&&s.removeAttribute("disabled")}}async function Yi(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),s=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":Zi(s,t);break;case"edit":Ji(s,t);break;case"delete":eo(s);break;case"duplicate":await zi(s,t);break;case"apply-template":{let i=t.getAttribute("data-template-type")||"simple";Vi(s,i);break}case"add-resource":{let i=t.closest("[data-planner-lesson]"),o=i?.querySelector("input[data-resource-label][data-lesson-id]"),a=i?.querySelector("input[data-resource-url][data-lesson-id]");await $i(s,o,a);break}case"remove-resource":{let i=t.getAttribute("data-resource-id");await qi(s,i);break}case"move-up":Sn(s,"up",t);break;case"move-down":Sn(s,"down",t);break;case"create-reminder":await Wi(s,t);break;case"create-slot":{let i=t.getAttribute("data-timetable-entry-id");await Qi(i,t);break}default:break}}async function Zn(e){if(typeof document>"u"||!Z)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=b?.lessons?.[0]?.dayLabel||"Monday";Z.openAddLesson({defaultDay:n,trigger:t})}async function Gi(e){if(!Z)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=getWeekIdFromOffset(f,1);Z.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function Ki(e){if(!f)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=getWeekIdFromOffset(f,-1);if(n){t&&t.setAttribute("disabled","true");try{let s=await duplicateWeekPlan(n,f);s&&(b=s,R=null,x(s),D(s,f),M&&(M.textContent="Copied last week into this plan."))}catch(s){console.error("Failed to copy previous planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{t&&t.removeAttribute("disabled")}}}async function Xi(e){if(!f)return;e?.preventDefault?.();let t=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(t=window.confirm("Clear all lessons for this week?")),!t)return;let n=e?.currentTarget instanceof HTMLElement?e.currentTarget:null;n&&n.setAttribute("disabled","true");try{let s=await clearWeekPlan(f);s&&(b=s,R=null,x(s),D(s,f),M&&(M.textContent="Cleared this week's plan."))}catch(s){console.error("Failed to clear planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function Zi(e,t){if(!e||!Z)return;let n=b?.lessons?.find(i=>i.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;Z.openAddDetail({lesson:n,trigger:s})}async function Ji(e,t){if(!e||!Z)return;let n=b?.lessons?.find(i=>i.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;Z.openEditLesson({lesson:n,trigger:s})}async function Sn(e,t,n){if(!e||!t)return;let s=f||getPlannerWeekIdFromDate();if(!s)return;let i=n instanceof HTMLElement?n:null;i&&i.setAttribute("disabled","true");try{let o=await movePlannerLesson(s,e,t);o&&(b=o,x(o),D(o,s))}catch(o){console.error("Failed to move planner lesson",o),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{i&&i.removeAttribute("disabled")}}async function eo(e){if(!e||typeof window>"u")return;let t=b?.lessons?.find(s=>s.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let s=await deleteLessonFromWeek(f,e);s&&(b=s,x(s),D(s,f))}catch(s){console.error("Failed to delete planner lesson",s),window.alert("Unable to delete that lesson right now.")}}function Dt(){if(Ve||!A){Ve&&le(f);return}Ve=!0,initPlannerStore({ensureFirestore:Le}),A.addEventListener("click",Pi),A.addEventListener("click",Yi),A.addEventListener("change",_i),A.addEventListener("input",Ui),A.addEventListener("focusout",Oi),A.addEventListener("toggle",ji),Ee?.addEventListener("click",Bi),be instanceof HTMLTextAreaElement&&be.addEventListener("input",Ri),Gs?.addEventListener("click",Zn),Ys?.addEventListener("click",Gi),zs?.addEventListener("click",Ki),Qs?.addEventListener("click",Xi),$e?.addEventListener("change",Fi),ht?.addEventListener("click",()=>_e("list")),gt?.addEventListener("click",()=>_e("week")),Os?.addEventListener("click",()=>{let e=getWeekIdFromOffset(f,-1);le(e)}),js?.addEventListener("click",()=>{let e=getWeekIdFromOffset(f,1);le(e)}),Ws?.addEventListener("click",()=>{le(getPlannerWeekIdFromDate())}),_e(On),le(f)}var Co=sn({dailyTab:Ns,dailyView:Fs,dailyListHeader:Hs,quickAddForm:Rs,quickAddInput:Vs,quickAddVoiceButton:_s,dailyTasksContainer:$s,clearCompletedButton:qs,dailyListPermissionNotice:Us,cuesTab:Bs,cuesView:Ps,ensureCueFirestore:()=>Le()}),Jn="theme",to="professional",wt="memoryCue:theme-change",no="professional",vt=document.getElementById("theme-menu"),es="[data-theme-name],[data-theme-option]",so=new Set(["dark","dracula","synthwave"]);function J(e){return typeof e=="string"?e.trim():""}function ts(e){return e instanceof HTMLElement?J(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function io(e){let t=J(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",so.has(t)))}function An(e){let t=J(e);if(t)try{localStorage.setItem(Jn,t)}catch(n){console.warn("Unable to save theme preference",n)}}function ns(e){if(!vt)return;let t=J(e);vt.querySelectorAll(es).forEach(s=>{if(!(s instanceof HTMLElement))return;let i=ts(s),o=t&&i===t;s.setAttribute("aria-checked",o?"true":"false"),s.classList.toggle("active",o)})}function oo(e){let t=J(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(wt,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let s=document.createEvent("CustomEvent");s.initCustomEvent(wt,!0,!0,{theme:t}),window.dispatchEvent(s)}}}function St(e,{persist:t=!0,notify:n=!0}={}){let s=J(e);if(!s)return;J(document.documentElement.getAttribute("data-theme"))!==s&&io(s),t&&An(s),ns(s),n&&oo(s)}function ao(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){St(no,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Jn)||""}catch(s){console.warn("Unable to load theme preference",s)}let n=t||document.documentElement.getAttribute("data-theme")||to;n&&St(n,{persist:!1,notify:!0})}vt?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(es):null;if(!t)return;e.preventDefault();let n=ts(t);n&&St(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(wt,e=>{let t=J(e?.detail?.theme);t&&ns(t)});ao()});export default ro();
