import{b as hn,c as No}from"./chunk-QHE5AMPX.js";import{a as Ui,b as Vn,c as Do}from"./chunk-GUVSRPRW.js";function ji(o={}){try{Object.assign(j,o||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function Wi(o={}){try{if(j&&typeof j.signInWithPopup=="function"&&j.auth&&typeof j.GoogleAuthProvider=="function")return j.signInWithPopup(j.auth,new j.GoogleAuthProvider);if(j&&typeof j.signInWithRedirect=="function"&&j.auth&&typeof j.GoogleAuthProvider=="function")return j.signInWithRedirect(j.auth,new j.GoogleAuthProvider);let r=hn();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...o});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{j?.toast?.("Sign-in failed")}catch(l){console.warn("[supabase-auth] toast handler failed",l)}throw r}return Promise.resolve(null)}async function Vi(){try{if(j&&typeof j.signOut=="function")return j.signOut(j.auth);let o=hn();if(o&&o.auth&&typeof o.auth.signOut=="function")return o.auth.signOut()}catch(o){throw console.error("[supabase-auth] startSignOutFlow error",o),o}return Promise.resolve(null)}function Fo(o){return o?Array.isArray(o)?o:[o]:[]}function Lt(o){return Array.from(new Set(o.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function ye(o,r){let l=Fo(r).filter(Boolean);if(!l.length)return[];let y=l.flatMap(D=>Array.from(o.querySelectorAll(D)));return Lt(y)}function Bo(o,r=document){let l=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:ye(l,o.authForm),emailInputs:ye(l,o.emailInput),signInButtons:ye(l,o.signInButtons),signOutButtons:ye(l,o.signOutButtons),userBadges:ye(l,o.userBadge),userBadgeEmails:ye(l,o.userBadgeEmail),userBadgeInitials:ye(l,o.userBadgeInitial),userNameEls:ye(l,o.userName),syncStatusEls:ye(l,o.syncStatus),syncStatusTextEls:ye(l,o.syncStatusText),statusIndicatorEls:ye(l,o.statusIndicator),feedbackEls:ye(l,o.feedback)}}function Tt(o,r){Lt(Array.isArray(o)?o:[o]).forEach(l=>{l instanceof HTMLElement&&(l.classList.toggle("hidden",!r),r?l.removeAttribute("hidden"):l.setAttribute("hidden",""))})}function He(o,r){Lt(Array.isArray(o)?o:[o]).forEach(l=>{l instanceof HTMLElement&&(l.textContent=r||"")})}function Mo(o,r){Lt(o).forEach(l=>{l instanceof HTMLElement&&(l.dataset.state=r,l.classList.toggle("online",r==="online"),l.classList.toggle("offline",r!=="online"))})}function It(o,r){Lt(o).forEach(l=>{if(!(l instanceof HTMLElement))return;l.textContent=r||"";let y=!!r;l.classList.toggle("hidden",!y),y?l.removeAttribute("hidden"):l.setAttribute("hidden","")})}function Yi(o={}){let r={...qi.syncStatusText,...o.syncStatusText||{}};return{...qi,...o,syncStatusText:r}}function At(o,{user:r,messages:l}={}){let y=Yi(l),D=!!r;Tt(o.signInButtons,!D),Tt(o.authForms,!D),Tt(o.signOutButtons,D),Tt(o.userBadges,D);let P=typeof r?.email=="string"?r.email:"",$=P?P.charAt(0).toUpperCase():"U";D?(He(o.userBadgeEmails,P),He(o.userBadgeInitials,$),He(o.userNameEls,P)):(He(o.userBadgeEmails,""),He(o.userBadgeInitials,""),He(o.userNameEls,""));let oe=typeof y.signedIn=="function"?y.signedIn(r):y.signedIn,O=typeof y.signedOut=="function"?y.signedOut(r):y.signedOut,se=D?oe:O,ce=!D;o.syncStatusEls.length&&(He(o.syncStatusEls,se),o.syncStatusEls.forEach(Ie=>{Ie instanceof HTMLElement&&(Ie.classList.toggle("online",D),Ie.dataset.state=D?"online":"offline")}),Tt(o.syncStatusEls,ce));let x=D?y.syncStatusText?.signedIn:y.syncStatusText?.signedOut;He(o.syncStatusTextEls,x||""),Mo(o.statusIndicatorEls,D?"online":"offline"),It(o.feedbackEls,"")}function Oo(o,r){r.authForms.forEach(l=>{!(l instanceof HTMLFormElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("submit",async y=>{y.preventDefault();let D=r.emailInputs.find($=>l.contains($))||l.querySelector('input[type="email"]'),P=typeof D?.value=="string"?D.value.trim():"";if(!P){It(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:$}=await o.auth.signInWithOtp({email:P});$?It(r.feedbackEls,$.message||"Unable to send magic link."):It(r.feedbackEls,"Magic link sent. Check your email.")}catch($){It(r.feedbackEls,$?.message||"Unable to send magic link.")}}))})}function Po(o,r){r.signOutButtons.forEach(l=>{!(l instanceof HTMLElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("click",async()=>{try{await o.auth.signOut()}catch(y){console.error("[supabase] Sign-out failed.",y)}}))})}function Zo(o={}){let{supabase:r,scope:l=document,selectors:y={},messages:D={},disableButtonBinding:P=!1,onSessionChange:$}=o,oe={...Ro,...y},O=Bo(oe,l),se=Yi(D);At(O,{user:null,messages:se});let ce=r||hn()||(typeof window<"u"?window.supabase:null);if(!ce)return{supabase:null,elements:O,applyAuthState:ue=>At(O,{...ue,messages:se}),destroy(){}};Oo(ce,O),P||Po(ce,O);let x=[],{data:Ie}=ce.auth.onAuthStateChange((ue,be)=>{if(At(O,{user:be?.user??null,messages:se}),typeof $=="function")try{$(be?.user??null,be)}catch(rt){console.error("[supabase] onSessionChange handler failed.",rt)}});return Ie?.subscription&&x.push(()=>{try{Ie.subscription.unsubscribe()}catch{}}),ce.auth.getSession().then(({data:ue,error:be})=>{be||At(O,{user:ue?.session?.user??null,messages:se})}).catch(ue=>{console.error("[supabase] getSession failed.",ue)}),{supabase:ce,elements:O,applyAuthState:ue=>At(O,{...ue,messages:se}),destroy(){x.forEach(ue=>{try{ue()}catch{}})}}}var j,Ro,qi,Gi=Vn(()=>{No();j={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};Ro={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},qi={signedOut:"",signedIn:o=>`Reminders syncing for ${o?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var zi=Do((ts,Ct)=>{var yn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Ki(o){if(!o||typeof o!="object")return null;let r=Object.entries(o).filter(([l,y])=>typeof y=="string"&&y.trim()!=="");return r.length?Object.fromEntries(r):null}function _o(){let o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=Ki(o?.__FIREBASE_CONFIG);if(r)return r;let l=Ki(o?.__ENV?.FIREBASE_CONFIG);if(l)return l;let D=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((P,[$,oe])=>{let O=o?.__ENV?.[$]??o?.[$];return typeof O=="string"&&O.trim()!==""&&(P[oe]=O),P},{});return Object.keys(D).length?D:null}function Qi(){let o=_o();return o?{...yn,...o}:{...yn}}var Xi={DEFAULT_FIREBASE_CONFIG:yn,getFirebaseConfig:Qi};if(typeof globalThis<"u"){let o=globalThis;o.memoryCueFirebase=o.memoryCueFirebase||{},o.memoryCueFirebase.getFirebaseConfig=Qi,o.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=yn}typeof Ct<"u"&&Ct.exports&&(Ct.exports=Xi,Ct.exports.default=Xi)});function Uo(){if(Ae)return{...Ae};let r=Jn()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return Ae=r.getFirebaseConfig(),{...Ae};if(typeof Ui=="function")try{let l=zi();if(l){let y=typeof l.getFirebaseConfig=="function"?l.getFirebaseConfig:typeof l.default?.getFirebaseConfig=="function"?l.default.getFirebaseConfig:null;if(y)return Ae=y(),{...Ae}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(Ae={...r.DEFAULT_FIREBASE_CONFIG},{...Ae}):(Ae={...$o},{...Ae})}function Jn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function nr(){let o=Jn(),r=o&&o.TimestampTrigger;return typeof r=="function"?r:null}function Fe(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!nr()}function qo(){if(typeof window>"u"||!window.location)return Yn;try{return new URL(Yn,window.location.href).href}catch{return Yn}}async function $e(){return gn||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(gn=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(qo()),await navigator.serviceWorker.ready}catch(o){return console.warn("Service worker registration failed",o),null}})(),gn))}async function tr(o){if(!o||typeof o!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await $e();if(!r)return!1;let l=new Set;navigator.serviceWorker.controller&&l.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(D=>{let P=r[D];P&&l.add(P)});let y=!1;return l.forEach(D=>{try{D.postMessage(o),y=!0}catch(P){console.warn("Failed posting message to service worker",P)}}),y}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function bn(){if(Fe())return!1;if(Kn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(xt)try{return await xt}catch{}xt=(async()=>{let o=await $e();if(!o)return!1;let r=!1;if("periodicSync"in o)try{let l=await o.periodicSync.getTags();(!Array.isArray(l)||!l.includes(Gn))&&await o.periodicSync.register(Gn,{minInterval:15*60*1e3}),r=!0}catch(l){console.warn("Periodic background sync unavailable",l)}if(!r&&"sync"in o)try{await o.sync.register(Gn),r=!0}catch(l){console.warn("Background sync unavailable",l)}return r})();try{let o=await xt;return o&&(Kn=!0),o}catch(o){return console.warn("Background reminder sync setup failed",o),Kn=!1,!1}finally{xt=null}}async function Qn(o=[],{requestCheck:r=!1}={}){if(!Fe()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let l=await $e();if(!l)return;let y=await tr({type:er.updateScheduledReminders,reminders:Array.isArray(o)?o:[]});if(r&&await tr({type:er.checkScheduledReminders}),!y&&typeof l.update=="function")try{await l.update()}catch{}}catch(l){console.warn("Failed syncing reminders with service worker",l)}}async function zn(o,r){if(Fe())try{let l=r||await $e();if(!l)return;let y=[];try{y=await l.getNotifications({tag:o,includeTriggered:!0})}catch{y=await l.getNotifications({tag:o})}for(let D of y)try{D.close()}catch{}}catch{}}function ir(){for(let o of Array.from(Re.values()))try{o.close()}catch{}Re.clear()}function jo(){if(Zi||typeof window>"u"||typeof window.addEventListener!="function")return;let o=()=>ir();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,o)}catch{}}),Zi=!0}function J(o){if(typeof o=="string"){let r=o.replace(/\s+/g," ").trim();if(r)return r}return G}async function is(o={}){let r=e=>e?document.querySelector(e):null,l=e=>e?Array.from(document.querySelectorAll(e)):[],y=r(o.titleSel),D=r(o.dateSel),P=r(o.timeSel),$=r(o.detailsSel),oe=r(o.prioritySel),O=r(o.categorySel),se=r(o.saveBtnSel),ce=r(o.cancelEditBtnSel),x=r(o.listSel),Ie="reminder-title-pinned",ue="reminder-title-unpinned",be=r(o.detailPanelSel),rt=r(o.detailEmptySel),wn=r(o.detailContentSel),kt=r(o.detailTitleSel),Dt=r(o.detailDueSel),Nt=r(o.detailPrioritySel),Rt=r(o.detailCategorySel),Le=r(o.detailNotesSel),ei=Le?.dataset?.placeholder||"No notes added yet.",rr=r(o.detailClearSel),Ft=l(o.googleSignInBtnSel),Bt=l(o.googleSignOutBtnSel),U=r(o.statusSel),K=r(o.syncStatusSel),or={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},sr=6e3,fe=null,Mt=null;function Ye(e,{clearMessage:t=!0}={}){fe&&(e&&fe.tokenId!==e||(fe.timeoutId&&clearTimeout(fe.timeoutId),t&&U&&U.dataset.undoToken===fe.tokenId&&(typeof U.replaceChildren=="function"?U.replaceChildren():U.textContent="",delete U.dataset.undoToken,delete U.dataset.statusKind),fe=null))}function ar(e){if(!U)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Eo(e.tokenId)),e.button=i,typeof U.replaceChildren=="function"?U.replaceChildren(t,n,i):(U.textContent="",U.append(t,n,i)),U.dataset.statusKind="undo",U.dataset.undoToken=e.tokenId}function ot(e){if(!be)return;let t=!!e;if(be.dataset.state=t?"active":"empty",be.dataset.selectedId=t&&e?.id?e.id:"",rt&&(rt.classList.toggle("hidden",t),rt.setAttribute("aria-hidden",t?"true":"false")),wn&&(wn.classList.toggle("hidden",!t),wn.setAttribute("aria-hidden",t?"false":"true")),!t){kt&&(kt.textContent=""),Dt&&(Dt.textContent=""),Nt&&(Nt.textContent=""),Rt&&(Rt.textContent=""),Le&&(Le.textContent=ei,Le.dataset.empty="true");return}if(kt&&(kt.textContent=e.title||"Untitled reminder"),Dt&&(Dt.textContent=Fi(e)),Nt&&(Nt.textContent=e.priority||"Medium"),Rt&&(Rt.textContent=e.category||G),Le){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Le.textContent=n,Le.dataset.empty="false"):(Le.textContent=ei,Le.dataset.empty="true")}}function ti(){Mt=null,ot(null)}function dr(e){Mt=e?.id||null,ot(e||null)}function lr(){if(!be)return;if(!Mt){ot(null);return}let e=p.find(t=>t?.id===Mt);if(e){ot(e);return}ti()}ot(null);function vn(e,t){if(!K)return;let n=["online","offline","error"];n.forEach(a=>K.classList.remove(a)),n.includes(e)&&K.classList.add(e),K.dataset.state=e;let i=typeof t=="string"?t:or[e]||"";e==="online"||e==="offline"?(K.textContent="",K.dataset.compact="true",i?(K.setAttribute("aria-label",i),K.setAttribute("title",i)):(K.removeAttribute("aria-label"),K.removeAttribute("title"))):(K.textContent=i,K.removeAttribute("data-compact"),i?(K.setAttribute("aria-label",i),K.setAttribute("title",i)):(K.removeAttribute("aria-label"),K.removeAttribute("title")))}let te=r(o.notesSel),cr=r(o.saveNotesBtnSel),ur=r(o.loadNotesBtnSel),ni=r(o.countTotalSel),Ot=r(o.googleUserNameSel),Ue=r(o.dateFeedbackSel),ae=r(o.voiceBtnSel),fr=r(o.notifBtnSel),st=r(o.moreBtnSel),at=r(o.moreMenuSel),mr=r(o.copyMtlBtnSel),En=r(o.importFileSel),pr=r(o.exportBtnSel),hr=r(o.syncAllBtnSel),Ge=r(o.syncUrlInputSel),yr=r(o.saveSettingsSel),gr=r(o.testSyncSel),br=l(o.openSettingsSel),Pt=r(o.settingsSectionSel),Ke=r(o.emptyStateSel),ii=r(o.listWrapperSel),Sn=r(o.categoryOptionsSel),ne=r(o.plannerContextSel),W=r(o.plannerLessonInputSel),ie=o.variant||"mobile",wr=typeof o.autoWireAuthButtons=="boolean"?o.autoWireAuthButtons:ie!=="desktop",dt="all",Tn=[],An="";function vr(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function Xe(){if(ie!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=vr(),n;dt==="today"?n=`Today\u2019s reminders \u2022 ${t}`:dt==="completed"?n=`Completed reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,An&&(n+=` \u2022 ${An}`),e.textContent=n}function Er(){ie==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(s=>{if(!s.ok)throw new Error("Weather request failed");return s.json()}).then(s=>{s&&s.current_weather&&typeof s.current_weather.temperature=="number"&&(An=`${Math.round(s.current_weather.temperature)}\xB0C`,Xe())}).catch(s=>{console.warn("Failed to fetch current temperature",s)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let ri="mc:lastDefaults",In=()=>{ne&&(ne.classList.add("hidden"),ne.setAttribute("aria-hidden","true"),typeof ne.replaceChildren=="function"?ne.replaceChildren():ne.textContent=""),W&&(W.value="",W.dataset&&(delete W.dataset.lessonDayLabel,delete W.dataset.lessonTitle,delete W.dataset.lessonSummary))},Sr=(e={})=>{if(!ne)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",s=document.createElement("p");s.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",s.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let d=i?document.createElement("p"):null;d&&(d.className="text-sm text-base-content/70",d.textContent=i),typeof ne.replaceChildren=="function"?ne.replaceChildren(...[s,a,d].filter(Boolean)):(ne.textContent="",ne.append(s,a),d&&ne.append(d)),ne.classList.remove("hidden"),ne.removeAttribute("aria-hidden")},Tr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";y&&typeof e.reminderTitle=="string"&&(y.value=e.reminderTitle),$&&typeof e.reminderNotes=="string"&&($.value=e.reminderNotes),D&&typeof e.dueDate=="string"&&(D.value=e.dueDate),W&&(W.value=t,W.dataset&&(W.dataset.lessonDayLabel=dayLabel,W.dataset.lessonTitle=lessonTitle,W.dataset.lessonSummary=summary)),Sr(e)};function Ln(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(ri)||"{}")||{}}catch{return{}}}function Ar(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(ri,JSON.stringify(e))}catch{}}function Ir(e){let t=Ln(),n={category:J(e?.category||t.category||G),priority:e?.priority||t.priority||"Medium"};Ar(n)}let oi='fieldset#priorityChips input[name="priority"]';function _t(){try{let e=document.querySelector(`${oi}:checked`);if(e&&e.value)return e.value}catch{}return oe&&typeof oe.value=="string"&&oe.value?oe.value:"Medium"}function Ht(e){let t=e||"Medium";oe&&typeof oe.value<"u"&&(oe.value=t);try{let n=Array.from(document.querySelectorAll(oi));if(!n.length)return;let i=!1;if(n.forEach(s=>{let a=s.value===t;s.checked=a,i=i||a}),!i){let s=n.find(a=>a.value==="Medium")||n[0];s&&(s.checked=!0)}}catch{}}function si(){let e=Ln();e.category&&O&&(O.value=e.category),e.priority&&Ht(e.priority)}si();let Lr=typeof document<"u"?document.getElementById("quickAddForm"):null,z=typeof document<"u"?document.getElementById("quickAddInput"):null,Cr=typeof document<"u"?document.getElementById("quickAddSubmit"):null,de=typeof document<"u"?document.getElementById("quickAddVoice")||document.getElementById("voiceBtn"):null,Be=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,Cn=null,xn="memoryCueNotes",ai="memoryCueFolders",di="Lesson \u2013 Reflections";function xr(e){let t=typeof e=="string"?e:"",n=[{kind:"footy-drill",pattern:/^\s*footy\s+drill\s*:\s*/i},{kind:"reflection",pattern:/^\s*reflection\s*:\s*/i},{kind:"task",pattern:/^\s*task\s*:\s*/i}];for(let i of n)if(i.pattern.test(t))return{kind:i.kind,text:t.replace(i.pattern,"").trim()};return{kind:"default",text:t.trim()}}function li(e,t=[]){if(typeof localStorage>"u")return Array.isArray(t)?[...t]:[];try{let n=localStorage.getItem(e);if(!n)return Array.isArray(t)?[...t]:[];let i=JSON.parse(n);return Array.isArray(i)?i:Array.isArray(t)?[...t]:[]}catch{return Array.isArray(t)?[...t]:[]}}function kr(){let t=li(ai,[{id:"unsorted",name:"Unsorted",order:0}]).filter(d=>d&&typeof d=="object"&&typeof d.id=="string"),n=t.find(d=>d.name===di);if(n?.id)return n.id;let i=new Set(t.map(d=>d.id)),s="lesson-reflections",a=1;for(;i.has(s);)a+=1,s=`lesson-reflections-${a}`;t.push({id:s,name:di,order:t.length});try{localStorage.setItem(ai,JSON.stringify(t))}catch{}return s}function Dr(e){let t=typeof e=="string"?e.trim():"";if(!t||typeof localStorage>"u")return null;let n=kr(),i=li(xn,[]),s=new Date().toISOString(),a={id:on(),title:t,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:s,folderId:n};i.unshift(a);try{localStorage.setItem(xn,JSON.stringify(i))}catch{return null}return a}function Nr(e,t){let n=Ln(),i=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||_t(),category:J(n.category||O?.value||G),notes:"",due:i,pinToToday:!1}}function ci(e,t=null){let n=typeof e=="string"?e.trim():"";if(!n)return{keywordQuery:"",timeRange:null};let i=t instanceof Date&&!Number.isNaN(t.getTime())?new Date(t):new Date,s=n.toLowerCase(),a=/\b(monday|mon|tuesday|tue|tues|wednesday|wed|thursday|thu|thur|thurs|friday|fri|saturday|sat|sunday|sun)\b/i,d=/\b(\d{1,2})(?::(\d{2}))?\s*(am|pm)?\b/i,u=/\btoday\b/i,m=/\byesterday\b/i,c=s.match(a),h=s.match(d),I=s.match(u),T=s.match(m),H=()=>{if(!h)return null;let E=Number.parseInt(h[1],10),R=Number.parseInt(h[2]||"0",10),v=h[3]?h[3].toLowerCase():null;return!Number.isFinite(E)||!Number.isFinite(R)||R>59||(v==="pm"&&E<12?E+=12:v==="am"&&E===12&&(E=0),E>23)?null:{hours:E,minutes:R}},q=E=>String(E).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),S=()=>{let E=n;return c&&(E=E.replace(new RegExp(`\\b${q(c[0])}\\b`,"i")," ")),I&&(E=E.replace(new RegExp(`\\b${q(I[0])}\\b`,"i")," ")),T&&(E=E.replace(new RegExp(`\\b${q(T[0])}\\b`,"i")," ")),h&&(E=E.replace(new RegExp(q(h[0]),"i")," ")),E.replace(/\s+/g," ").trim()},w=(E=0)=>{let R=new Date(i);R.setHours(0,0,0,0),R.setDate(R.getDate()+E);let v=new Date(R);return v.setHours(23,59,59,999),{start:R.getTime(),end:v.getTime()}},N=H();if(c&&N){let E=c[1].slice(0,3).toLowerCase(),v={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[E];if(typeof v=="number"){let B=new Date(i),M=(v-B.getDay()+7)%7;return B.setDate(B.getDate()+M),B.setHours(N.hours,N.minutes,0,0),{keywordQuery:S(),timeRange:{start:B.getTime()-60*60*1e3,end:B.getTime()+60*60*1e3}}}}if(I||T){if(N){let E=new Date(i);return T&&E.setDate(E.getDate()-1),E.setHours(N.hours,N.minutes,0,0),{keywordQuery:S(),timeRange:{start:E.getTime()-60*60*1e3,end:E.getTime()+60*60*1e3}}}return{keywordQuery:S(),timeRange:w(T?-1:0)}}return{keywordQuery:n,timeRange:null}}function Rr(){let e=typeof document<"u"?document.getElementById("inboxSearchInput"):null,t=typeof document<"u"?document.getElementById("inboxSearchResults"):null,n=typeof document<"u"?document.getElementById("inboxSearchClear"):null;if(!e||!t)return;let i=()=>{if(typeof localStorage>"u")return[];try{let v=localStorage.getItem(xn),B=v?JSON.parse(v):[];return Array.isArray(B)?B:[]}catch{return[]}},s=v=>{if(!Number.isFinite(v))return"No date";try{return new Date(v).toLocaleString()}catch{return"No date"}},a=v=>String(v||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),d=(v,B)=>{let M=String(v||"");if(!B)return a(M);let f=M.toLowerCase(),b=B.toLowerCase(),C=f.indexOf(b);if(C<0)return a(M);let F=a(M.slice(0,C)),A=a(M.slice(C,C+B.length)),pe=a(M.slice(C+B.length));return`${F}<mark class="inbox-search-match">${A}</mark>${pe}`},u=()=>{let v=(Array.isArray(p)?p:[]).map(M=>({type:"Reminder",title:M?.title||"",body:M?.notes||"",timestamp:Number.isFinite(M?.createdAt)?M.createdAt:null})),B=i().map(M=>{let f=typeof M?.updatedAt=="string"?Date.parse(M.updatedAt):Number.NaN,b=typeof M?.createdAt=="string"?Date.parse(M.createdAt):Number.NaN;return{type:"Note",title:M?.title||"",body:M?.bodyText||M?.body||"",timestamp:Number.isFinite(f)?f:Number.isFinite(b)?b:null}});return[...v,...B]},m=[],c=-1,h=null,I=null,T=()=>{m=[],c=-1,h=null,t.innerHTML="",t.dataset.mode=""},H=(v,B={})=>{let M=Number.isFinite(B.limit)?B.limit:20,f=B.query||"",b=Number.isInteger(B.selectedIndex)?B.selectedIndex:-1,C=B.mode||"";if(t.innerHTML="",t.dataset.mode=C,!v.length){if(C==="autocomplete"){let A=document.createElement("div");A.className="inbox-search-empty text-xs opacity-70 py-2 px-2",A.textContent="No matches",t.appendChild(A)}return}let F=document.createDocumentFragment();v.slice(0,M).forEach((A,pe)=>{let Q=document.createElement("li");Q.className="inbox-search-result-item text-xs py-1 border-b border-base-300/60",C==="autocomplete"&&(Q.classList.add("inbox-search-result-item--autocomplete"),Q.setAttribute("role","option"),Q.tabIndex=-1,pe===b&&Q.classList.add("is-active"));let L=document.createElement("span");L.className="badge badge-outline badge-xs mr-2",L.textContent=A.type;let We=document.createElement("span");We.className="inbox-search-result-title",C==="autocomplete"?We.innerHTML=d(A.title||"(untitled)",f):We.textContent=A.title||"(untitled)";let De=document.createElement("div");De.className="opacity-70",De.textContent=s(A.timestamp),C==="autocomplete"&&Q.addEventListener("mousedown",$i=>{$i.preventDefault(),e.value=A.title||"",q(),T()}),Q.appendChild(L),Q.appendChild(We),Q.appendChild(De),F.appendChild(Q)}),t.appendChild(F)},q=()=>{let B=(e.value||"").trim();if(n&&(n.hidden=!B),!B){t.innerHTML="";return}let M=ci(B),f=(M.keywordQuery||"").toLowerCase().split(/\s+/).map(F=>F.trim()).filter(Boolean),C=u().filter(F=>{let A=`${F.title} ${F.body}`.toLowerCase();return!f.length||f.every(Q=>A.includes(Q))?M.timeRange?Number.isFinite(F.timestamp)?F.timestamp>=M.timeRange.start&&F.timestamp<=M.timeRange.end:!1:!0:!1});C.sort((F,A)=>(A.timestamp||0)-(F.timestamp||0)),H(C)},S=v=>{let B=v.toLowerCase(),M=u().filter(f=>{let b=String(f.title||"").toLowerCase(),C=String(f.body||"").toLowerCase();return b.includes(B)||C.includes(B)});return M.sort((f,b)=>{let C=String(f.title||"").toLowerCase(),F=String(b.title||"").toLowerCase(),A=String(f.body||"").toLowerCase(),pe=String(b.body||"").toLowerCase(),Q=C.startsWith(B)||A.startsWith(B),L=F.startsWith(B)||pe.startsWith(B);return Q!==L?Q?-1:1:(b.timestamp||0)-(f.timestamp||0)}),M.slice(0,8)},w=v=>{m=S(v),c=m.length?0:-1,H(m,{limit:8,query:v,selectedIndex:c,mode:"autocomplete"})},N=()=>{H(m,{limit:8,query:e.value.trim(),selectedIndex:c,mode:"autocomplete"})},E=()=>{let v=(e.value||"").trim();v!==h&&(I&&clearTimeout(I),I=setTimeout(()=>{if(h=v,!v){T();return}w(v)},120))},R=()=>{if(c<0||c>=m.length)return;let v=m[c];e.value=v.title||"",q(),T()};e.addEventListener("input",E),e.addEventListener("keydown",v=>{if(t.dataset.mode==="autocomplete")if(v.key==="ArrowDown"){if(v.preventDefault(),!m.length)return;c=Math.min(c+1,m.length-1),N()}else if(v.key==="ArrowUp"){if(v.preventDefault(),!m.length)return;c=Math.max(c-1,0),N()}else v.key==="Enter"?c>=0&&(v.preventDefault(),R()):v.key==="Escape"&&(v.preventDefault(),T())}),document.addEventListener("click",v=>{v.target instanceof Node&&(v.target===e||t.contains(v.target)||T())}),n&&n.addEventListener("click",()=>{e.value="",T(),n.hidden=!0,e.focus()}),document.addEventListener("memoryCue:remindersUpdated",q)}async function lt(e={}){if(!z)return null;if(typeof Cn=="function")try{Cn()}catch{}let t=typeof e.text=="string"?e.text:(z.value||"").trim(),n=xr(t),i=n.text;if(!i)return null;if(n.kind==="reflection"){let c=Dr(i);return c?(z.value="",c):null}let a=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,d=null;if(a)d=new Date(a).toISOString();else try{let c=dn(i);c&&c.time&&(d=new Date(`${c.date}T${c.time}:00`).toISOString())}catch{d=null}let u=Nr(i,d);if(n.kind==="footy-drill"?u.category="Footy \u2013 Drills":n.kind==="task"&&(u.category="Tasks"),e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{u.notifyAt=new Date(e.notifyAt).toISOString()}catch{u.notifyAt=null}let m=ki(u,{closeSheet:!1});if(m&&typeof document<"u"){z.value="";try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:m}}))}catch{}}return m||null}typeof window<"u"&&(window.memoryCueQuickAddNow=lt),Cr?.addEventListener("click",()=>{lt()}),z?.addEventListener("keydown",e=>{(e.key==="Enter"||e.key==="NumpadEnter")&&(e.preventDefault(),lt())}),Lr?.addEventListener("submit",e=>{e.preventDefault(),lt()}),Rr();function Fr(){if(typeof HTMLElement>"u"||!(de instanceof HTMLElement)||!(z instanceof HTMLInputElement)||de.dataset.voiceBound==="true")return;if(de.dataset.voiceBound="true",typeof window>"u"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true"),de.getAttribute("title")||(de.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,de.setAttribute("aria-pressed",d?"true":"false"),de.dataset.listening=d?"true":"false",de.classList.toggle("is-listening",d)},s=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",m=>{let c=m?.results?.[0]?.[0]?.transcript?.trim()||"";if(c){z.value=c;try{z.focus({preventScroll:!0})}catch{z.focus()}try{let h=z.value.length;typeof z.setSelectionRange=="function"&&z.setSelectionRange(h,h)}catch{}}});let u=()=>{i(!1)};return t.addEventListener("end",u),t.addEventListener("error",u),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};Cn=a,de.addEventListener("click",()=>{let d=s();if(d){if(n){a();return}try{d.start(),i(!0)}catch(u){console.warn("Quick add voice error:",u),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}Fr();let ui=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,we=null,fi=!!ui;fi&&(we=new ui,we.lang="en-AU",we.interimResults=!1,we.maxAlternatives=1);function Br(){try{if(typeof k=="function"){k("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}Be&&(fi&&we?Be.addEventListener("click",()=>{try{we.start(),Be.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):Be.addEventListener("click",()=>{Br()})),we&&(we.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Pr(t)}),we.addEventListener("end",()=>{Be&&Be.classList.remove("is-recording")}),we.addEventListener("error",()=>{Be&&Be.classList.remove("is-recording")}));function Mr(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function Or(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,s=new Date(i);if(n.includes("tomorrow"))s.setDate(s.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let d=parseInt(a[1],10),u=a[2]?parseInt(a[2],10):0,m=a[3];m||(/\b(p\.?m\.?|p m)\b/.test(n)?m="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(m="am")),m==="pm"&&d<12&&(d+=12),m==="am"&&d===12&&(d=0),s.setHours(d,u,0,0);let c=new Date(s),h=new Date(c.getTime()-10*60*1e3);return t.dueDate=c,t.notifyAt=h,t}function Pr(e){if(!e||!z)return;let t=Mr(e),{dueDate:n,notifyAt:i}=Or(e);z.value=t,lt({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&z&&(e.preventDefault(),z.focus())})));try{ie==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let _r=o.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",mi=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Hr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",$t=o.reminderLandingPath||(ie==="desktop"?"index.html#reminders":"mobile.html"),me=(e,t={})=>{let n=null;try{n=typeof CustomEvent<"u"?CustomEvent:null}catch{n=null}!n&&typeof window<"u"&&typeof window.CustomEvent<"u"&&(n=window.CustomEvent),n||(n=function(i,s){s=s||{bubbles:!1,cancelable:!1,detail:null};let a=new Event(i,s);return a.detail=s.detail,a}),document.dispatchEvent(new n(e,{detail:t}))};function pi(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function ct(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:p}}))}catch{}}O&&!O.value&&(O.value=G),Fe()&&$e();function Ce(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let s=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(s.push(n);s.length>20;)s.shift();window.memoryCueActivityQueue=s}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Ji,{detail:n}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent(Ji,!1,!1,n),document.dispatchEvent(s))}}catch{}}}function $r(){if(typeof HTMLElement>"u"||!(ae instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&y instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&y instanceof HTMLTextAreaElement;if(!e&&!t||ae.dataset.voiceBound==="true")return;if(ae.dataset.voiceBound="true",typeof window>"u"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true"),ae.getAttribute("title")||(ae.title="Voice input is not supported in this browser.");return}let i=null,s=!1,a=c=>{s=c,ae.setAttribute("aria-pressed",c?"true":"false"),ae.dataset.listening=c?"true":"false",ae.classList.toggle("is-listening",c)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",h=>{let I=h.results?.[0]?.[0]?.transcript?.trim()||"";if(I){y.value=I;try{y.focus({preventScroll:!0})}catch{try{y.focus()}catch{}}try{let T=y.value.length;typeof y.setSelectionRange=="function"&&y.setSelectionRange(T,T)}catch{}Ce({action:"dictated",label:`Voice input captured \xB7 ${I}`})}});let c=()=>{a(!1)};return i.addEventListener("end",c),i.addEventListener("error",c),i},u=()=>{if(!(!s||!i)){try{i.stop()}catch{}a(!1)}};ae.addEventListener("click",()=>{let c=d();if(c){if(s){u();return}try{c.start(),a(!0)}catch(h){console.warn("Speech recognition error:",h),a(!1)}}});let m=()=>{u()};typeof document<"u"&&(document.addEventListener("cue:close",m),document.addEventListener("reminders:updated",m)),a(!1)}jo(),$r();let Ut,qt,jt,Wt,Qe,Vt,Yt,Gt,Kt,Xt,Qt,ut,ft,zt,Jt,kn,Dn,Zt,Nn,hi=o.firebaseDeps,Rn=typeof o.importModule=="function"?o.importModule:e=>import(e),mt=Jn(),pt=!1,ve=!1,Fn=null,xe=null,ht=null,p=[],ze=!1,re=null,yt=null,Je=null,gt=null,en=null,qe={},je={},X={},yi=typeof document<"u"?document.getElementById("createSheetTitle"):null,gi=()=>{y instanceof HTMLElement&&setTimeout(()=>{try{y.focus()}catch{}},0)},Ze=(e,t=null)=>{gt=e||null,en=t||null,Je=gt==="edit"?en:null,yi instanceof HTMLElement&&(yi.textContent=gt==="edit"?"Edit reminder":"New reminder")};function ge(e=p){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,s=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===s?Ai(t||{},n||{}):s-i})}function Ur(e=p){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let s=Number.isFinite(i?.orderIndex)?i.orderIndex:null;s!=null&&(s<t&&(t=s),s>n&&(n=s))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function bt(e=p){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),ge(n);else{n=e.slice().sort(Ai);let i=n.length;n.forEach((s,a)=>{s.orderIndex=(i-a)*Te})}return e===p&&(p=n),n}function bi(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Ur();if(t==="end"){let s=Number.isFinite(n)?n:0;e.orderIndex=s-Te||Te}else{let s=Number.isFinite(i)?i:0;e.orderIndex=s+Te||Te}}function tn(e=p){if(!Array.isArray(e)||e.length<2)return!1;ge(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],s=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(s?.orderIndex)?s.orderIndex:null;if(a==null||d==null||a<=d||a-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Te;return e===p&&ge(p),!0}let _={draggingId:null,dropTargetId:null,dropBefore:!0},wi=!1,g={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function qr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function wt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Me(){x&&(x.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),x.classList.remove("drag-over-list"))}function Bn(){if(!x)return;let e=x.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Me(),_.draggingId=null,_.dropTargetId=null,_.dropBefore=!0}function vi(e,t,n){if(!e||e===t)return;let i=p.findIndex(T=>T?.id===e);if(i<0)return;let[s]=p.splice(i,1),a;if(!t)a=p.length;else{let T=p.findIndex(H=>H?.id===t);if(T<0){p.splice(i,0,s);return}a=n?T:T+1}p.splice(a,0,s);let d=p[a-1],u=p[a+1],m=Number.isFinite(d?.orderIndex)?d.orderIndex:null,c=Number.isFinite(u?.orderIndex)?u.orderIndex:null,h;m!=null&&c!=null?h=(m+c)/2:m!=null?h=m-Te:c!=null?h=c+Te:h=Te,Number.isFinite(h)||(h=Te*(p.length+1)),s.orderIndex=h,ge(p);let I=tn(p);ze=!0,V(),Z(),I?p.forEach(T=>le(T)):le(s),ct(),me("memoryCue:remindersUpdated",{items:p}),Ce({action:"reordered",label:"Reminders reordered"})}function jr(e){let t=wt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(_.draggingId=i,_.dropTargetId=null,_.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Wr(e){if(!_.draggingId)return;let t=wt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),_.dropTargetId=null,_.dropBefore=!1,Me(),x?.classList.add("drag-over-list");return}if(t.dataset.id===_.draggingId){e.preventDefault(),Me();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,s=e.clientY<i;(_.dropTargetId!==t.dataset.id||_.dropBefore!==s)&&(Me(),t.classList.add(s?"drag-over-before":"drag-over-after"),_.dropTargetId=t.dataset.id,_.dropBefore=s)}function Vr(e){let t=wt(e.target);if(!t){x?.contains(e.relatedTarget)||Me();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),x?.contains(e.relatedTarget)||x?.classList.remove("drag-over-list"))}function Yr(e){if(!_.draggingId)return;e.preventDefault();let t=wt(e.target),n=t?.dataset.id||null,i=_.dropBefore;if(t){let s=t.getBoundingClientRect(),a=s.top+s.height/2;i=e.clientY<a}else n=null,i=!1;vi(_.draggingId,n,i),Bn()}function Gr(){Bn()}function Kr(){!x||wi||(wi=!0,x.addEventListener("dragstart",jr),x.addEventListener("dragover",Wr),x.addEventListener("drop",Yr),x.addEventListener("dragend",Gr),x.addEventListener("dragleave",Vr),nn())}function nn(){if(!x||nn._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){nn._bound=!0;return}let t=6,n=160;function i(){g.longPressTimer&&(clearTimeout(g.longPressTimer),g.longPressTimer=null)}function s(){x&&(g.initialTouchAction!=null?x.style.touchAction=g.initialTouchAction:x.style.removeProperty("touch-action"))}function a({keepHighlights:S=!1}={}){if(i(),g.item&&g.pointerId!=null)try{g.item.hasPointerCapture?.(g.pointerId)&&g.item.releasePointerCapture(g.pointerId)}catch{}if(g.placeholder?.parentNode)try{g.placeholder.parentNode.removeChild(g.placeholder)}catch{}g.item&&(g.item.classList.remove("is-dragging"),g.originalStyles?g.item.setAttribute("style",g.originalStyles):g.item.removeAttribute("style")),s(),S||Me(),Object.assign(g,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(S){return x?Array.from(x.querySelectorAll("[data-reminder-item]")).filter(w=>w!==S):[]}function u(S){let w=g.item;if(!w||g.ready)return;let N=w.getBoundingClientRect(),E=window.getComputedStyle(w);g.ready=!0,_.draggingId=w.dataset.id||null,g.offsetY=S.clientY-N.top,g.fixedX=N.left;let R=document.createElement("div");R.className="touch-drag-placeholder",R.setAttribute("aria-hidden","true"),R.style.height=`${N.height}px`,R.style.boxSizing="border-box",R.style.marginTop=E.marginTop,R.style.marginBottom=E.marginBottom,R.style.marginLeft=E.marginLeft,R.style.marginRight=E.marginRight,R.style.borderRadius=E.borderRadius,R.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",R.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",R.style.pointerEvents="none",R.style.display="block",R.style.width="100%",w.parentNode?.insertBefore(R,w),g.placeholder=R,g.longPressTimer=null,g.originalStyles=w.getAttribute("style")||"",w.classList.add("is-dragging"),w.style.position="fixed",w.style.left=`${N.left}px`,w.style.top=`${N.top}px`,w.style.width=`${N.width}px`,w.style.zIndex="999",w.style.pointerEvents="none",w.style.touchAction="none",g.initialTouchAction=x.style.touchAction||"",x.style.touchAction="none"}function m(S){let w=g.item;if(!w||!g.ready)return;let N=S-g.offsetY;w.style.top=`${N}px`,w.style.left=`${g.fixedX}px`}function c(S){if(!g.ready||!x)return;let w=g.item,N=d(w);if(Me(),!N.length){_.dropTargetId=null,_.dropBefore=!1;return}let E=null,R=!1;for(let f of N){let b=f.getBoundingClientRect(),C=b.top+b.height/2;if(S<C){E=f,R=!0;break}}if(!E){E=N[N.length-1];let f=E.getBoundingClientRect(),b=f.top+f.height/2;R=S<b,R||(R=!1)}if(!E){_.dropTargetId=null,_.dropBefore=!1;return}let v=E.getBoundingClientRect(),B=v.top+v.height/2,M=S<B;E.classList.add(M?"drag-over-before":"drag-over-after"),_.dropTargetId=E.dataset.id||null,_.dropBefore=M}function h(S){let w=_.draggingId,N=g.moved;if(!g.ready){a();return}a(),!S&&N&&w&&vi(w,_.dropTargetId,_.dropBefore),Bn()}function I(S){let w=S.pointerType||"";if(w&&w!=="touch"&&w!=="pen"||g.active)return;let N=wt(S.target);if(!N)return;let E=qr(S.target);if(!(E&&E!==N)){g.active=!0,g.pointerId=S.pointerId,g.item=N,g.startX=S.clientX,g.startY=S.clientY,g.lastClientX=S.clientX,g.lastClientY=S.clientY,g.moved=!1,g.ready=!1,g.originalStyles=N.getAttribute("style")||"",g.startTime=S.timeStamp||Date.now(),_.dropTargetId=null,_.dropBefore=!0,_.draggingId=null,i(),g.longPressTimer=setTimeout(()=>{u({clientY:g.lastClientY})},n);try{N.setPointerCapture(S.pointerId)}catch{}}}function T(S){if(!g.active||S.pointerId!==g.pointerId)return;let w=S.pointerType||"";if(!(w&&w!=="touch"&&w!=="pen")){if(g.lastClientX=S.clientX,g.lastClientY=S.clientY,!g.ready){let N=Math.abs(S.clientX-g.startX),E=Math.abs(S.clientY-g.startY);if(N>t||E>t){let R=typeof S.timeStamp=="number"?S.timeStamp:Date.now();Math.abs(R-g.startTime)>=n?(i(),u({clientY:g.lastClientY})):a()}return}S.preventDefault(),g.moved=!0,m(S.clientY),c(S.clientY)}}function H(S){!g.active||S.pointerId!==g.pointerId||h(!1)}function q(S){!g.active||S.pointerId!==g.pointerId||h(!0)}x.addEventListener("pointerdown",I),window.addEventListener("pointermove",T),window.addEventListener("pointerup",H),window.addEventListener("pointercancel",q),nn._bound=!0}function Ei(){re=null,vn("offline"),Ft.forEach(e=>e.classList.remove("hidden")),Bt.forEach(e=>e.classList.add("hidden")),Ot&&(Ot.textContent=""),yt?.(),yt=null,On(),V(),Z(),_e()}function Mn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Xn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),s=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:on(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:J(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:s,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Xr(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Xn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:J(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(Xn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function Z(){ge(p),Xr(p)}function On(){p=bt(Mn())}On();async function Qr(){if(!re){p=Mn();return}let e=bt(Mn());if(!e.length){p=[],Z();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await le(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}p=bt(e.map(n=>({...n,pendingSync:!1}))),Z(),V(),_e()}try{X=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{X={}}if(X&&typeof X=="object"&&Object.values(X).forEach(e=>{e&&typeof e=="object"&&(e.category=J(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:vt(e),e.urlPath=e.urlPath||$t,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Fe()){let e=Ri();typeof Notification<"u"&&Notification.permission==="granted"?(bn(),e.length&&Qn(e,{requestCheck:!0})):e.length&&Qn(e)}let rn=e=>{if(!mt)return;let t=[mt];mt.window&&!t.includes(mt.window)&&t.push(mt.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function zr(){if(!te)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",s=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in te?te.value:te.innerHTML,d=h=>{if("value"in te){te.value=h;return}if(typeof h!="string"||h.length===0){te.innerHTML="";return}let I=h.trim();if(/<\/?[a-z][\s\S]*>/i.test(I)){te.innerHTML=h;return}let H=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");te.innerHTML=H},u=h=>{h?te.classList.add("notes-editor--columns"):te.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!h))},m="";try{m=localStorage.getItem(n)||""}catch{k("Unable to access saved notes")}d(m);let c=!1;try{c=localStorage.getItem(i)==="1"}catch{c=!1}u(c),te.addEventListener("input",()=>{m=a();try{localStorage.setItem(n,m)}catch{k("Notes saved for this session only")}}),cr?.addEventListener("click",()=>{m=a();try{localStorage.setItem(n,m),k("Notes saved")}catch{k("Notes saved for this session only")}}),ur?.addEventListener("click",()=>{let h=m;try{h=localStorage.getItem(n)||m}catch{k("Unable to load saved notes")}m=h,d(m)}),e?.addEventListener("click",h=>{let I=h.target;if(!(I instanceof Element))return;let T=I.closest("button[data-action]");if(!T)return;let H=T.getAttribute("data-action");if(H==="columns"){let q=!te.classList.contains("notes-editor--columns");u(q);try{localStorage.setItem(i,q?"1":"0")}catch{k("Column preference saved for this session only")}return}if(!s){k("Formatting controls are not supported in this browser");return}te.focus(),H==="bullets"?document.execCommand("insertUnorderedList"):H==="numbers"&&document.execCommand("insertOrderedList")})}if(zr(),se?.addEventListener("click",Hi),hi)({initializeApp:Ut,getFirestore:qt,enableMultiTabIndexedDbPersistence:jt,enableIndexedDbPersistence:Wt,doc:Qe,setDoc:Vt,deleteDoc:Yt,onSnapshot:Gt,collection:Kt,query:Xt,orderBy:Qt,serverTimestamp:ut,getAuth:ft,onAuthStateChanged:zt,GoogleAuthProvider:Jt,signInWithPopup:kn,signInWithRedirect:Dn,getRedirectResult:Zt,signOut:Nn}=hi),pt=!0;else try{({initializeApp:Ut}=await Rn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:qt,enableMultiTabIndexedDbPersistence:jt,enableIndexedDbPersistence:Wt,doc:Qe,setDoc:Vt,deleteDoc:Yt,onSnapshot:Gt,collection:Kt,query:Xt,orderBy:Qt,serverTimestamp:ut}=await Rn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:ft,onAuthStateChanged:zt,GoogleAuthProvider:Jt,signInWithPopup:kn,signInWithRedirect:Dn,getRedirectResult:Zt,signOut:Nn}=await Rn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),pt=!0}catch(e){pt=!1,console.warn("Firebase modules failed to load:",e),k("Firebase failed to load; notes available offline"),rn(!1)}if(pt&&typeof Ut=="function"&&typeof qt=="function"&&typeof ft=="function")try{let e=Uo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Fn=Ut(e),xe=qt(Fn),ve=!0,console.info("[Firebase] Firestore initialised",e.projectId),rn(!0)}catch(e){ve=!1,console.warn("Firebase initialization failed:",e),k("Firebase failed to load; notes available offline"),rn(!1)}else pt?(ve=!1,rn(!1)):ve=!1;ve&&typeof jt=="function"&&typeof Wt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await jt(xe),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Wt(xe),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ve&&typeof ft=="function"&&(ht=ft(Fn));function Jr(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Zr=typeof navigator<"u"&&navigator.language?navigator.language:"",Si=Jr(Zr),et=Si||"en-US",ke="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(ke=e.timeZone),!Si&&e.locale&&(et=e.locale)}catch{}let eo=new Intl.DateTimeFormat(et,{timeZone:ke,hour:"2-digit",minute:"2-digit"}),to=new Intl.DateTimeFormat(et,{timeZone:ke,weekday:"long",day:"numeric",month:"long"}),no=new Intl.DateTimeFormat("en-CA",{timeZone:ke,year:"numeric",month:"2-digit",day:"2-digit"}),io=new Intl.DateTimeFormat(et,{timeZone:ke,weekday:"long"}),ro=new Intl.DateTimeFormat(et,{timeZone:ke,month:"short",day:"numeric"});function Oe(e){let t=no.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,s=t.find(a=>a.type==="day").value;return`${n}-${i}-${s}`}function Ti(e,t){let[n,i,s]=e.split("-").map(m=>parseInt(m,10)),[a,d]=t.split(":").map(m=>parseInt(m,10)),u=new Date;return u.setFullYear(n,(i||1)-1,s||1),u.setHours(a||0,d||0,0,0),u.toISOString()}let oo=new Intl.DateTimeFormat("en-CA",{timeZone:ke,year:"numeric",month:"2-digit",day:"2-digit"}),so=new Intl.DateTimeFormat("en-CA",{timeZone:ke,hour:"2-digit",minute:"2-digit",hour12:!1});function ao(e){try{let t=new Date(e),n=oo.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",s=n.find(d=>d.type==="month")?.value||"00",a=n.find(d=>d.type==="day")?.value||"00";return`${i}-${s}-${a}`}catch{return""}}function lo(e){try{let t=new Date(e),n=so.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",s=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${s}`}catch{return""}}function on(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function sn(){return Oe(new Date)}function co(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Ko(e){let t=co(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function an(e){return e==="High"?3:e==="Medium"?2:1}function Ai(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let s=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(s!==a)return s-a;let d=an(t?.priority)-an(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function Xo(e,t){let n=an(t.priority)-an(e.priority);if(n)return n;let i=+new Date(e.due||0),s=+new Date(t.due||0);return i!==s?i-s:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Ii(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return to.format(t)}catch{return e}}function Pn(e){return eo.format(e)}function uo(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Qo(e){return e?uo(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function k(e){U&&(Ye(),U.dataset.statusKind="toast",U.textContent=e,clearTimeout(k._t),k._t=setTimeout(()=>{U&&U.dataset.statusKind==="toast"&&(U.textContent="",delete U.dataset.statusKind)},2500))}function fo(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function dn(e){e=String(e||"").toLowerCase();let t={date:sn(),time:""},n=u=>{let m=new Date,c=m.getDay(),h=(u-c+7)%7,I=new Date(m);return I.setDate(m.getDate()+(h===0?7:h)),I},i=u=>{let m=new Date,c=m.getDay(),h=(u-c+7)%7,I=new Date(m);return I.setDate(m.getDate()+h),I},s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let u=new Date;u.setDate(u.getDate()+1),t.date=Oe(u)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=s[u[1]],c=n(m);t.date=Oe(c)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=s[u[1]],c=i(m);t.date=Oe(c)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=s[u[1]],c=n(m);t.date=Oe(c)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let u=e.match(/\bin\s+(\d+)\s+days?\b/),m=parseInt(u[1],10),c=new Date;c.setDate(c.getDate()+m),t.date=Oe(c)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let u=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),m=parseInt(u[1],10),c=parseInt(u[2],10)-1,h=u[3]?parseInt(u[3],10):new Date().getFullYear(),I=new Date(h,c,m);t.date=Oe(I)}else for(let[u,m]of Object.entries(a)){let c=new RegExp(`\\b${u}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(c.test(e)){let h=e.match(c),I=parseInt(h[1],10),T=new Date().getFullYear(),H=new Date(T,m,I);t.date=Oe(H);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let u=parseInt(d[1],10),m=d[2]?parseInt(d[2],10):0,c=d[3];c&&(c==="pm"&&u<12&&(u+=12),c==="am"&&u===12&&(u=0)),t.time=`${String(u).padStart(2,"0")}:${String(m).padStart(2,"0")}`}return t}let _n=ve&&ht&&typeof Jt=="function";ji({authReady:_n,auth:ht,GoogleAuthProvider:Jt,signInWithPopup:kn,signInWithRedirect:Dn,signOut:Nn,toast:k});let Li=wr,Ci=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(s=>{console.error("Auth handler error:",s)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Li&&Ft.length&&Ft.forEach(e=>Ci(e,Wi)),_n&&typeof Zt=="function"&&Zt(ht).catch(()=>{}),Li&&Bt.length&&Bt.forEach(e=>Ci(e,Vi)),_n&&typeof zt=="function"?zt(ht,async e=>{e?(re=e.uid,vn("online"),Ft.forEach(t=>t.classList.add("hidden")),Bt.forEach(t=>t.classList.remove("hidden")),Ot&&(Ot.textContent=e.displayName||e.email||""),mo(),await Qr()):Ei()}):Ei();function mo(){if(!ve||!xe||typeof Kt!="function"||typeof Xt!="function"||typeof Qt!="function"||typeof Gt!="function")return;if(!re){On(),V(),Xe(),Z(),_e();return}yt&&yt();let e=Kt(xe,"users",re,"reminders"),t=Xt(e,Qt("updatedAt","desc"));yt=Gt(t,n=>{let i=[];n.forEach(s=>{let a=s.data(),d=Number(a.orderIndex),u=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,m=a.pinToToday===!0;i.push({id:s.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:J(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:u,pinToToday:m})}),p=bt(i),V(),Xe(),Z(),_e()},n=>{console.error("Firestore sync error:",n),K&&vn("error","Sync Error")})}async function le(e){if(!(!ve||!re||!xe||typeof Qe!="function"||typeof Vt!="function"||typeof ut!="function"))try{await Vt(Qe(xe,"users",re,"reminders",e.id),{ownerUid:re,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||G,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):ut(),updatedAt:ut()},{merge:!0})}catch(t){console.error("Save failed:",t),k("Save queued (offline)")}}async function po(e){if(!(!ve||!re||!xe||typeof Qe!="function"||typeof Yt!="function"))try{await Yt(Qe(xe,"users",re,"reminders",e))}catch{k("Delete queued (offline)")}}async function ln(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||G,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Pe({preserveDetail:e=!1,resetMode:t=!0}={}){y&&(y.value=""),D&&(D.value=""),P&&(P.value=""),$&&($.value=""),Ht("Medium"),O&&(O.value=G),si(),t?Ze(null):Je=gt==="edit"?en:null,se&&(se.textContent="Save"),ce?.classList.add("hidden"),In(),e||ti()}function ho(e){let t=p.find(n=>n.id===e);t&&(Ze("edit",e),y&&(y.value=t.title||""),D&&P&&(t.due?(D.value=ao(t.due),P.value=lo(t.due)):(D.value="",P.value="")),Ht(t?.priority||"Medium"),O&&(O.value=J(t.category)),$&&($.value=typeof t.notes=="string"?t.notes:""),W&&(W.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),In(),dr(t),se&&(se.textContent="Update"),ce?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),gi(),me("cue:open",{mode:"edit"}))}function xi(e){let t=e?.id||e;t&&(Ze("edit",t),ho(t))}function yo(e=null){Pe({resetMode:!1}),Ze("new");let t={mode:"create",trigger:e};me("cue:prepare",t),me("cue:open",t),gi()}typeof window<"u"&&(window.openNewReminderSheet=yo,window.openEditReminderSheet=xi);function ki(e={},t={}){let{closeSheet:n=!0,activityAction:i="created",activityLabelPrefix:s="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let d=Date.now(),u=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),m=J(e.category??(O?O.value:G)),c=null;e.due instanceof Date?c=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(c=e.due);let h=null;e.notifyAt instanceof Date?h=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(h=e.notifyAt);let I={id:on(),title:a,priority:e.priority||_t(),category:m,notes:u,done:!1,createdAt:d,updatedAt:d,due:c,pendingSync:!re,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:h};bi(I,{position:"start"}),p=[I,...p],ge(p);let T=tn(p);return ze=!0,V(),Z(),Ir(I),T?p.forEach(H=>le(H)):le(I),ln(I),tt(I),_e(),ct(),me("memoryCue:remindersUpdated",{items:p}),n&&pi(),Ce({action:i,label:`${s} \xB7 ${I.title}`}),I}function go(e){return ki(e,{closeSheet:!0})}function bo(e,t){if(!re)return k("Sign in to add notes"),null;if(!e)return null;let n=p.find(d=>d.id===e);if(!n)return null;let s=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!s)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${s}`:s,n.updatedAt=Date.now(),le(n),V(),Z(),Ce({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function wo(e){let t=p.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),le(t),ln(t),V(),Z(),t.done?(un(e),Ce({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(tt(t),Ce({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function vo(e,t){let n=p.find(s=>s?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),le(n),V(),Z(),ct(),me("memoryCue:remindersUpdated",{items:p}))}function Eo(e){if(!fe||fe.tokenId!==e)return;let{item:t,index:n}=fe;if(!t){Ye(e);return}Ye(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),p.length):p.length;t.pendingSync=!re,t.updatedAt=Date.now(),p.splice(i,0,t),ge(p);let s=tn(p);ze=!0,V(),Z(),tt(t),s?p.forEach(a=>le(a)):le(t),ln(t),ct(),me("memoryCue:remindersUpdated",{items:p}),Ce({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),k("Reminder restored")}function Hn(e){let t=p.findIndex(s=>s.id===e),n=t>=0?p.splice(t,1)[0]:null;n&&Je===e&&Pe(),V(),Z(),po(e),un(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Ce({action:"deleted",label:i}),n&&U){Ye();let s=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;fe={tokenId:s,item:n,index:t,timeoutId:null},ar(fe),fe.timeoutId=setTimeout(()=>{Ye(s)},sr)}else n&&Ye()}function Di(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,s=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,u=!1,m=0,c=0,h=0,I=()=>{if(u){if(u=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",H),e.removeEventListener("pointerup",q),e.removeEventListener("pointercancel",S),e.removeEventListener("pointerleave",S),window.removeEventListener("pointerup",q),window.removeEventListener("pointercancel",S)}},T=w=>{if(w.pointerType==="mouse"&&w.button!==0)return;u&&I();let N=w.target;N instanceof Element&&N.closest(a)||(d=w.pointerId,m=w.clientX,c=w.clientY,h=typeof w.timeStamp=="number"?w.timeStamp:Date.now(),u=!0,e.addEventListener("pointermove",H),e.addEventListener("pointerup",q),e.addEventListener("pointercancel",S),e.addEventListener("pointerleave",S),window.addEventListener("pointerup",q),window.addEventListener("pointercancel",S))},H=w=>{if(!u||w.pointerId!==d)return;Math.abs(w.clientY-c)>i&&I()},q=w=>{if(!u||w.pointerId!==d)return;let N=w.clientX-m,E=Math.abs(w.clientY-c),R=(typeof w.timeStamp=="number"?w.timeStamp:Date.now())-h;if(I(),N<=-n&&E<=i&&R<=s){w.preventDefault(),w.stopPropagation();try{t()}catch(v){console.warn("Swipe delete handler failed",v)}}},S=w=>{u&&(typeof w.pointerId=="number"&&w.pointerId!==d||I())};e.addEventListener("pointerdown",T)}function vt(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=Pn(i);if(s)return`${n} \u2022 ${s}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=Pn(i);if(s)return`Due ${s}`}}catch{}return"Due now"}function Ni(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}k("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Ri(){return Object.values(X||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||G,notes:typeof e.notes=="string"?e.notes:"",body:vt(e),urlPath:e.urlPath||$t,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function $n(){try{localStorage.setItem("scheduledReminders",JSON.stringify(X))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Ri(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&bn(),Qn(e,{requestCheck:t})}function cn(e,{closeNotification:t=!0}={}){if(t){let n=Re.get(e);if(n){try{n.close()}catch{}Re.delete(e)}}qe[e]&&(clearTimeout(qe[e]),delete qe[e]),je[e]&&(clearTimeout(je[e]),delete je[e]),zn(e),X[e]&&(delete X[e],$n())}function un(e){cn(e)}function Un(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Re.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:vt(e),tag:e.id});Re.set(e.id,n);let i=()=>{Re.get(e.id)===n&&Re.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function So(e){if(!Fe())return!1;let t=nr();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await $e();if(!i)return!1;await zn(e.id,i);let s={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||G,body:a,urlPath:$t},a=vt(e),d={body:a,tag:e.id,data:s,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function tt(e){if(!e||!e.id)return;if(e.category=J(e.category),!e.due||e.done){un(e.id);return}let t=X[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||G,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:vt(e),urlPath:$t,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let u=typeof t.due=="string"?t.due:null,m=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return u===e.due?m:null})()};if(X[e.id]=n,$n(),qe[e.id]&&(clearTimeout(qe[e.id]),delete qe[e.id]),je[e.id]&&(clearTimeout(je[e.id]),delete je[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let s=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(X[e.id]?.viaTrigger){cn(e.id,{closeNotification:!1});return}Un(e),cn(e.id,{closeNotification:!1});return}let d=Fe();if(Number.isFinite(s)&&s>Date.now()&&s<i){let u=s-Date.now();je[e.id]=setTimeout(()=>{Un({...e,due:e.due||n.due})},u)}d&&(n.viaTrigger=!1,So(e).then(u=>{u&&X[e.id]&&(X[e.id]={...X[e.id],viaTrigger:!0},$n())})),qe[e.id]=setTimeout(()=>{d&&zn(e.id),Un(e),cn(e.id,{closeNotification:!1})},a)}function _e(){Object.values(X).forEach(e=>tt({...e,category:J(e?.category)}))}function Fi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=io.format(t),i=ro.format(t),s=Pn(t);return`${n}, ${i}${s?` at ${s}`:""}`}catch{return"No due date"}}let Bi="__mcPinToggleHandler";var qn=!1;function Et(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Ie,t),e.classList.toggle(ue,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Mi(e){if(!(e instanceof HTMLElement)||e[Bi])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let s=i.currentTarget;if(!(s instanceof HTMLElement))return;let d=(typeof s.closest=="function"?s.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){Et(s,!1);return}let u=!s.classList.contains(Ie);await Promise.resolve(vo(d,u)),Et(s,u)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Bi]={click:t,keydown:n}}function To(){if(!x)return;let e=x.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){Et(t,!1),Mi(t);return}let a=!!p.find(d=>d?.id===i)?.pinToToday;Et(t,a),Mi(t)})}function Oi(){if(!x||qn)return;qn=!0;let e=()=>{qn=!1,To()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function Ao(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function Io(e,t,n){if(!Array.isArray(e))return[];let s=t==="completed"?e.filter(a=>!!a?.done):e.filter(a=>!a?.done);return t==="today"?s.filter(a=>Ao(a,n)):s}function Lo(){let e=document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]");e.length&&e.forEach(t=>{let i=t.getAttribute("data-reminders-tab")===dt;t.setAttribute("aria-pressed",i?"true":"false"),i?t.classList.add("reminders-tab-active","active"):t.classList.remove("reminders-tab-active","active")})}function Pi(e){if(!e||e===dt)return!1;document.querySelectorAll("#reminders-slim-header [data-reminders-tab], #view-reminders [data-reminders-tab]").length&&(Array.isArray(Tn)&&V(),Xe())}function _i(){if(ie!=="mobile"||typeof document>"u"||_i._wired)return;Lo(),Xe(),document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]").forEach(t=>{t.addEventListener("click",()=>{let n=t.getAttribute("data-reminders-tab");Pi(n)})})}function V(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let s={start:n,end:i};if(Me(),ge(p),ni)try{ni.textContent=String(p.length)}catch{}p.forEach(f=>{f&&typeof f=="object"&&(f.category=J(f.category))});let a=new Set(Ho.map(f=>J(f)));p.forEach(f=>{f&&typeof f=="object"&&a.add(J(f.category))});let d=Array.from(a).sort((f,b)=>f.localeCompare(b,void 0,{sensitivity:"base"}));if(Sn){let f=new Set;Array.from(Sn.querySelectorAll("option")).forEach(b=>{f.add(b.value.trim().toLowerCase())}),d.forEach(b=>{let C=b.toLowerCase();if(!f.has(C)){let F=document.createElement("option");F.value=b,Sn.appendChild(F),f.add(C)}})}if(ze)ze=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let f=p.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:f}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:f}),document.dispatchEvent(b))}}catch{}}let u=p.slice();ge(u),ie==="mobile"&&(Tn=u.slice(),u=Io(Tn,dt,s),Xe());let m=!0,c=p.length>0,h=u.length>0,I=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let f=Object.values(X||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(f.map(b=>b.id))})();if(Ke)if(h)Ke.classList.add("hidden");else{let f=c?"No reminders to show right now.":_r;mi?mi(Ke,{icon:c?"sparkles":"bell",title:c?"Nothing to display":"Create your first cue",description:f,action:c?void 0:`<button type="button" class="${Hr}" data-trigger="open-cue">Create reminder</button>`}):Ke.textContent=f,Ke.classList.remove("hidden")}if(ii&&ii.classList.toggle("has-items",h),!x)return;if(!h){Ke?(x.innerHTML="",x.classList.add("hidden")):(x.innerHTML='<div class="text-muted">No reminders found.</div>',x.classList.remove("hidden")),Oi();return}x.classList.remove("hidden"),x.replaceChildren();let T=document.createDocumentFragment(),H=x.tagName==="UL"||x.tagName==="OL",q=!0,S=["priority-high","priority-medium","priority-low"],w=(f,b)=>{if(!(f instanceof HTMLElement))return;f.classList.remove(...S);let C=typeof b=="string"?b.trim().toLowerCase():"";C.startsWith("h")?f.classList.add("priority-high"):C.startsWith("m")?f.classList.add("priority-medium"):C.startsWith("l")&&f.classList.add("priority-low")},N=(f,b="neutral")=>{let C=document.createElement("span");C.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",C.title=f,C.dataset.tone=b;let F=document.createElement("span");F.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?F.classList.add("bg-error"):b==="priority-medium"?F.classList.add("bg-warning"):b==="priority-low"?F.classList.add("bg-secondary"):b==="category"?F.classList.add("bg-primary"):F.classList.add("bg-base-content","opacity-40");let A=document.createElement("span");return A.className="truncate",A.textContent=f,C.append(F,A),C},E=(f,b,{elementTag:C,isMobile:F})=>{let A={id:f.id,title:f.title,dueIso:f.due||null,priority:f.priority||"Medium",category:b,done:!!f.done,pinToToday:f.pinToToday===!0},pe="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Q="task-item reminder-row reminder-card w-full text-base-content",L=document.createElement(C);L.className=F?Q:pe,L.dataset.id=A.id,L.dataset.category=A.category,L.dataset.title=A.title;let We=A.priority&&String(A.priority).trim();We?L.dataset.priority=We:delete L.dataset.priority,L.dataset.done=String(A.done),A.dueIso?L.dataset.due=A.dueIso:delete L.dataset.due,A.pinToToday?L.dataset.pinToToday="true":delete L.dataset.pinToToday,L.dataset.reminder=JSON.stringify(A),L.dataset.orderIndex=Number.isFinite(f.orderIndex)?String(f.orderIndex):"",L.dataset.reminderItem="true",L.classList.add("reminder-draggable"),L.setAttribute("draggable","true"),L.setAttribute("role","button"),L.tabIndex=0,L.setAttribute("aria-label",`Edit reminder: ${f.title}`),w(L,A.priority),I.has(A.id)?L.dataset.notificationActive="true":delete L.dataset.notificationActive;let De=A.dueIso?new Date(A.dueIso):null;m&&De&&De>=n&&De<=i?(L.classList.add("is-today"),L.dataset.today="true"):(L.classList.remove("is-today"),delete L.dataset.today);let jn=Fi(f),fn=jn&&jn!=="No due date"?jn:"",nt=document.createElement("div");nt.className="task-toolbar flex items-start gap-1",nt.setAttribute("role","toolbar"),nt.setAttribute("aria-label","Reminder actions"),F&&nt.classList.add("flex-shrink-0");let ee=document.createElement("button");ee.type="button",ee.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",ee.classList.toggle("reminder-complete-toggle--active",A.done);let ko=A.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";ee.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${ko}"
          />
        </svg>`,A.done?(ee.classList.add("text-base-content/60"),ee.setAttribute("aria-label",`Mark reminder as active: ${f.title}`)):(ee.classList.add("text-success"),ee.setAttribute("aria-label",`Mark reminder as done: ${f.title}`)),ee.setAttribute("aria-pressed",A.done?"true":"false"),ee.setAttribute("data-reminder-control","toggle"),ee.setAttribute("data-no-swipe","true"),ee.addEventListener("click",Y=>{Y.preventDefault(),Y.stopPropagation(),wo(A.id)});let mn=()=>xi(f);if(F){let Y=document.createElement("div");Y.className="reminder-card-main reminder-row-main";let Se=document.createElement("div");Se.className="reminder-title reminder-row-title",Se.dataset.reminderTitle="true";let Ve=document.createElement("span");if(Ve.dataset.role="reminder-today-toggle",Ve.className="reminder-title-toggle cursor-pointer",Ve.setAttribute("role","button"),Ve.tabIndex=0,Ve.textContent=f.title,Et(Ve,A.pinToToday),Se.appendChild(Ve),Y.appendChild(Se),fn){let he=document.createElement("div");he.className="reminder-date reminder-row-meta",he.textContent=fn,Y.appendChild(he)}return A.done?L.classList.add("reminder-row-completed"):De&&De<e&&L.classList.add("reminder-row-overdue"),ee.classList.add("reminder-row-complete","reminder-complete-btn"),L.append(ee,Y),L.addEventListener("click",he=>{if(he.defaultPrevented)return;let Wn=he.target;Wn&&typeof Wn.closest=="function"&&Wn.closest("[data-reminder-control]")||mn()}),L.addEventListener("keydown",he=>{he.defaultPrevented||he.target===L&&(he.key==="Enter"||he.key===" ")&&(he.preventDefault(),mn())}),F&&Di(L,()=>Hn(A.id)),L}let pn=document.createElement("div");pn.className="flex min-w-0 flex-1 flex-col gap-2";let it=document.createElement("p");it.className="text-lg font-bold leading-snug text-base-content",it.classList.add("desktop-reminder-title"),it.classList.add("sm:text-[0.95rem]"),A.done&&it.classList.add("line-through","text-base-content/60"),it.textContent=f.title,pn.appendChild(it);let St=document.createElement("div");St.className="desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70",fn&&St.appendChild(N(fn,"due")),!!(b&&b!==G)&&St.appendChild(N(b,"category")),St.children.length&&pn.appendChild(St),L.appendChild(pn);let Ne=document.createElement("button");return Ne.type="button",Ne.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Ne.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Ne.setAttribute("aria-label",`Delete reminder: ${f.title}`),Ne.setAttribute("data-action","delete"),Ne.setAttribute("data-reminder-control","delete"),Ne.setAttribute("data-no-swipe","true"),Ne.addEventListener("click",Y=>{Y.preventDefault(),Y.stopPropagation();try{Hn(A.id)}catch(Se){console.warn("Delete handler failed",Se)}}),nt.append(ee,Ne),L.appendChild(nt),L.addEventListener("click",Y=>{if(Y.defaultPrevented)return;let Se=Y.target;Se&&typeof Se.closest=="function"&&Se.closest("[data-reminder-control]")||mn()}),L.addEventListener("keydown",Y=>{Y.defaultPrevented||Y.target===L&&(Y.key==="Enter"||Y.key===" ")&&(Y.preventDefault(),mn())}),F&&Di(L,()=>Hn(A.id)),L},R=(f,b)=>E(f,b,{elementTag:"div",isMobile:!0});if(ie!=="desktop"&&!q){u.forEach(f=>{let b=f.category||G;T.appendChild(R(f,b))}),x.appendChild(T);return}let v=new Map;u.forEach(f=>{let b=f.category||G;v.has(b)||v.set(b,[]),v.get(b).push(f)});let B=Array.from(v.entries()).sort((f,b)=>f[0].localeCompare(b[0],void 0,{sensitivity:"base"})),M=!0;B.forEach(([f,b])=>{if(f!==G){let C=document.createElement(H?"li":"div");C.dataset.categoryHeading=f,H&&(C.setAttribute("role","presentation"),C.style.listStyle="none"),C.className=ie==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",M||(C.style.marginTop=ie==="desktop"?"1.25rem":"1rem");let F=document.createElement("div");F.setAttribute("role","heading"),F.setAttribute("aria-level","3"),F.className=ie==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let A=document.createElement("span");A.textContent=f;let pe=document.createElement("span");pe.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",pe.textContent=`${b.length} ${b.length===1?"item":"items"}`,F.append(A,pe),C.appendChild(F),T.appendChild(C)}b.forEach(C=>{if(ie==="desktop"){let F=E(C,f,{elementTag:H?"li":"div",isMobile:!1});T.appendChild(F);return}T.appendChild(R(C,f))}),M=!1}),x.appendChild(T),lr(),Oi()}function Ee(){st?.setAttribute("aria-expanded","false"),at?.classList.add("hidden")}function Co(){st?.setAttribute("aria-expanded","true"),at?.classList.remove("hidden")}st?.addEventListener("click",e=>{e.stopPropagation(),st.getAttribute("aria-expanded")==="true"?Ee():Co()}),document.addEventListener("click",e=>{at&&!at.classList.contains("hidden")&&!at.contains(e.target)&&e.target!==st&&Ee()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Ee()}),br.forEach(e=>{e.addEventListener("click",()=>{let t=Pt?.classList.contains("hidden");Pt?.classList.toggle("hidden"),t&&Pt?.scrollIntoView({behavior:"smooth",block:"start"}),Ee()})}),document.addEventListener("DOMContentLoaded",()=>{Pt?.classList.add("hidden")});function Hi(){try{console.log("handleSaveAction invoked",{editingId:Je,title:y?.value})}catch{}let t=(typeof y?.value=="string"?y.value:"").trim(),n=typeof D?.value=="string"?D.value:"",i=typeof P?.value=="string"?P.value:"",s=typeof W?.value=="string"?W.value.trim():"";if(gt==="edit"&&Je){let c=p.find(T=>T.id===Je);if(!c){Pe();return}if(!t){k("Add a reminder title");return}let h=null;if(n||i){let T=n||sn();h=Ti(T,i||"09:00")}else{let T=dn(t);T.time&&(h=new Date(`${T.date}T${T.time}:00`).toISOString())}c.title=t;let I=_t();c.priority=I,Ht(I),O&&(c.category=J(O.value)),c.due=h,$&&(c.notes=$.value.trim()),c.plannerLessonId=s||null,c.updatedAt=Date.now(),le(c),ln(c),ze=!0,V(),tt(c),Z(),ct(),me("memoryCue:remindersUpdated",{items:p}),pi(),Ce({action:"updated",label:`Reminder updated \xB7 ${c.title}`}),Pe(),k("Reminder updated"),me("cue:close",{reason:"updated"});return}if(!t){k("Add a reminder title");return}let a=$?$.value.trim():"",d=null;if(n||i){let c=n||sn();d=Ti(c,i||"09:00")}else{let c=dn(t);c.time&&(d=new Date(`${c.date}T${c.time}:00`).toISOString())}let u=s?{lessonId:s,dayLabel:W?.dataset?.lessonDayLabel||"",lessonTitle:W?.dataset?.lessonTitle||"",summary:W?.dataset?.lessonSummary||""}:null,m=go({title:t,priority:_t(),category:O?O.value:"",due:d,notes:a,plannerLessonId:s||null});m&&(u?(k("Planner reminder created"),me("planner:reminderCreated",{lessonId:u.lessonId,dayLabel:u.dayLabel,lessonTitle:u.lessonTitle,summary:u.summary,reminderId:m.id,reminderTitle:m.title,reminderDue:m.due||null})):k("Reminder created")),y&&(y.value=""),P&&(P.value=""),$&&($.value=""),In(),me("cue:close",{reason:"created"})}y?.addEventListener("keydown",e=>{e.key==="Enter"&&Hi()});function xo(){if(!y||!Ue)return;let e=y.value.trim();if(!e){Ue.style.display="none";return}try{let t=dn(e),n=sn();if(t.date!==n||t.time){let i="";if(t.date!==n){let s=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Ii(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Ue.textContent=`Parsed: ${i}`,Ue.style.display="block"):Ue.style.display="none"}else Ue.style.display="none"}catch{Ue.style.display="none"}}if(y?.addEventListener("input",fo(xo,300)),ce?.addEventListener("click",()=>{Pe(),k("Edit cancelled"),me("cue:close",{reason:"edit-cancelled"})}),rr?.addEventListener("click",()=>{Pe()}),document.addEventListener("cue:cancelled",()=>{Pe()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";Pe({resetMode:!1}),Ze(t,t==="edit"?en:null)}),document.addEventListener("cue:close",()=>{Ze(null)}),document.addEventListener("planner:prefillReminder",e=>{Tr(e?.detail||{})}),window.addEventListener("load",()=>y?.focus()),mr?.addEventListener("click",()=>{let e=p.filter(t=>!t.done).map(t=>{let n=t.due?Ii(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(et,{hour:"2-digit",minute:"2-digit",timeZone:ke}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){k("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>k("Copied for Master Task List")).catch(()=>k("Copy failed")),Ee()}),En?.addEventListener("change",()=>{let e=En.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let d={...a,id:on(),category:J(a.category),pendingSync:!re,orderIndex:null};bi(d,{position:"start"}),p=[d,...p],i.push(d)}),ge(p);let s=tn(p);V(),Z(),s?p.forEach(a=>le(a)):i.forEach(a=>le(a)),k("Import successful")}catch{k("Invalid JSON")}},t.readAsText(e),En.value="",Ee()}),pr?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Ee()}),hr?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){k("Add your Apps Script URL in Settings first"),Ee();return}if(!p.length){k("No tasks to sync"),Ee();return}k("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<p.length;i+=t){let s=p.slice(i,i+t),a=await Promise.allSettled(s.map(d=>{let u={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||G,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})}));n+=a.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}k(`Sync complete: ${p.length-n} ok${n?`, ${n} failed`:""}`),Ee()}),Ge&&(Ge.value=localStorage.getItem("syncUrl")||""),yr?.addEventListener("click",()=>{Ge&&(localStorage.setItem("syncUrl",Ge.value.trim()),k("Settings saved"))}),gr?.addEventListener("click",async()=>{if(!Ge)return;let e=Ge.value.trim();if(!e){k("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});k(t.ok?"Test ok":"Test failed")}catch{k("Test failed")}}),fr?.addEventListener("click",async()=>{if(!("Notification"in window)){k("Notifications not supported");return}if(Notification.permission==="granted"){k("Notifications enabled"),Fe()?$e():(bn(),Ni()),_e(),V();return}try{await Notification.requestPermission()==="granted"?(k("Notifications enabled"),Fe()?$e():(bn(),Ni()),_e(),V()):k("Notifications blocked")}catch{k("Notifications blocked")}}),_i(),ie==="mobile"){let e=()=>{try{Er()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return Kr(),_e(),V(),Z(),ie==="mobile"&&(window.setMobileRemindersFilter=Pi),{cancelReminder:un,scheduleReminder:tt,closeActiveNotifications:ir,getActiveNotifications:()=>Re,addNoteToReminder:bo,__testing:{setItems(e=[]){p=Array.isArray(e)?e.map(t=>({...t,category:J(t?.category)})):[],p=bt(p),ge(p),V()},render:V,getItems:()=>p.map(e=>({...e})),parseInboxTimeQuery:ci}}}var Ji,Re,Zi,Yn,Gn,er,gn,xt,Kn,G,Ho,Xn,Te,$o,Ae,Wo=Vn(()=>{Gi();Ji="memoryCue:activity",Re=new Map,Zi=!1,Yn="service-worker.js",Gn="memory-cue-reminder-sync",er=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),gn=null,xt=null,Kn=!1,G="General",Ho=Object.freeze([G,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Xn="memoryCue:offlineReminders",Te=1024,$o=Object.freeze({}),Ae=null});function ss(o){return new Zn(o)}var Vo,Yo,Zn,Go=Vn(()=>{Vo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Yo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Zn=class o{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...Yo,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let l=this.getFocusableElements();if(l.length===0){r.preventDefault(),this.modal.focus();return}let y=l[0],D=l[l.length-1],P=document.activeElement;r.shiftKey&&P===y?(r.preventDefault(),D.focus()):!r.shiftKey&&P===D&&(r.preventDefault(),y.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Vo)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let l=r?.detail?.mode==="edit";this.setEditMode(l),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let l=r.detail?.reason||"external-close";this.hide({reason:l})}dispatchEvent(r,l={}){let y=this.events[r];if(!y||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let D=new CustomEvent(y,{detail:l,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(D)}requestClose(r){let l={reason:r,controller:this};this.dispatchEvent("cancelled",l),this.dispatchEvent("closeRequest",{...l,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let l=this.animationHooks?.[r];typeof l=="function"&&await l(this)}addToStack(){let r=o.activeStack,l=r.indexOf(this);l!==-1&&r.splice(l,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=o.activeStack,l=r.indexOf(this);l!==-1&&r.splice(l,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{Zo as a,Gi as b,is as c,Wo as d,Zn as e,ss as f,Go as g};
