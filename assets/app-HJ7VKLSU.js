import{a as $n,b as Io,c as Qe,d as Do,f as _t,g as Ze,h as $t,i as Co,j as jn,k as No}from"./chunk-O3VG5ZSV.js";import{a as _n,b as ko}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as Ot,c as Ao}from"./chunk-GUVSRPRW.js";function Un(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:r})=>{if(!Array.isArray(r))return null;for(let o of r){if(typeof o!="string"||!o)continue;let a=t.getElementById(o);if(a)return{key:n,element:a}}return null}).filter(n=>!!(n&&n.element))}function Ee(e,t){if(!e||typeof e!="object")return"";let n=Mo[t]||[t];for(let r of n)if(Object.prototype.hasOwnProperty.call(e,r)){let o=e[r];return o==null?"":typeof o=="string"?o:String(o)}return""}function Po(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function Bo(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Wn(e,t){Array.isArray(t)&&t.forEach(({key:n,element:r})=>{let o=e&&typeof e=="object"?Ee(e,n):"";Po(r,o)})}function Vn(e,t,n,r){Array.isArray(e)&&e.forEach(({element:o})=>{o instanceof HTMLInputElement?["checkbox","radio"].includes(o.type)?o.checked=!1:o.value="":(o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement)&&(o.value="")}),t&&(t.value=""),n&&(n.textContent=r)}function zn(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:r})=>{let o=Bo(r);if(typeof o=="boolean"){t[n]=o;return}let a=typeof o=="string"?o.trim():o;t[n]=a??""}),t}function I(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var qn,Mo,jt,qt,Kn=Ot(()=>{qn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],Mo={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},jt="Create Cue",qt="Edit Cue"});function Yn(e){return new Ut(e)}var Fo,Ho,Ut,Gn=Ot(()=>{Fo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Ho={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Ut=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...Ho,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let r=n[0],o=n[n.length-1],a=document.activeElement;t.shiftKey&&a===r?(t.preventDefault(),o.focus()):!t.shiftKey&&a===o&&(t.preventDefault(),r.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Fo)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let r=this.events[t];if(!r||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let o=new CustomEvent(r,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(o)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Jn,Xn,Qn,Vt,Wt,Ro,Se,zt,Oo,Zn,er,Kt,_o,tr,rt,nr,rr,Yt,de,$o,or,we,ar,jo,qo,Uo,sr,Gt,tt,Re,et,Le,He,Wo,ir,re,lr,ue,cr,dr,nt,Vo,Fe,fe,ur,Q,ot,fr,Jt,mr,V,at,Xt,pr,yr,Qt,hr,gr,ve,br,st,Zt,Er=Ot(()=>{Jn="memoryCue:plannerPlans",Xn="memoryCue:plannerTemplates",Qn="memoryCue:lastPlannerTemplate",Vt="memoryCue:plannerUpdated",Wt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ro=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],Se=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},zt=e=>{if(!Se()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},Oo=(e,t)=>{if(!(!Se()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch{}},Zn=e=>{try{return JSON.parse(e)}catch{return null}},er=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Kt=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,_o=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),r=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-r),t},tr=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`},rt=e=>{if(typeof e!="string")return null;let[t,n,r]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),i=Number.parseInt(r,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(i))return null;let s=new Date(o,a-1,i);return Number.isNaN(s.getTime())?null:(s.setHours(0,0,0,0),s)},nr=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=Wt.findIndex(r=>r.toLowerCase()===t);return n>=0?n:0},rr=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:er(),badge:n,text:t}},Yt=(e,t={})=>{let n=typeof t=="object"&&t?t:{},r=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:nr(e?.dayName||n.dayName||n.dayLabel),o=Kt(r),a=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():Wt[o],i=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",l=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(A=>rr(A)).filter(Boolean),u=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:er(),g=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,y=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",E=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"";return{id:u,dayIndex:o,dayLabel:Wt[o]||"Lesson",title:a,summary:i,details:l,notes:y,subject:E,position:Number.isFinite(g)?g:null}},de=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let r=Number.isFinite(t.position),o=Number.isFinite(n.position);return r&&o&&t.position!==n.position?t.position-n.position:r&&!o?-1:!r&&o?1:t.title.localeCompare(n.title)}),$o=e=>{let t=new Map;return e.forEach(n=>{let r=String(n.dayIndex),o=t.get(r)??0;Number.isFinite(n.position)?t.set(r,Math.max(o,n.position+1)):(n.position=o,t.set(r,o+1))}),e},or=(e,t,n)=>{let r=e.filter(o=>!(o.dayIndex!==t||n&&o.id===n));return r.length?r.reduce((o,a)=>Number.isFinite(a.position)?Math.max(o,a.position):o,-1)+1:0},we=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,r=rt(n),o=Array.isArray(e?.lessons)?$o(e.lessons.map(i=>Yt(i)).filter(Boolean)):[],a=typeof e?.templateId=="string"?e.templateId.trim():"";return{weekId:n,startDate:r?r.toISOString():"",lessons:de(o),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString(),templateId:a}},ar=()=>{if(!Se())return{};try{let e=zt(Jn);if(typeof e!="string"||!e.length)return{};let t=Zn(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},jo=e=>{if(Se())try{window.localStorage.setItem(Jn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},qo=()=>{if(!Se())return{};try{let e=zt(Xn);if(typeof e!="string"||!e.length)return{};let t=Zn(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},Uo=e=>{if(Se())try{window.localStorage.setItem(Xn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},sr=e=>{if(!e)return null;let n=ar()[e];return n?we(n,e):null},Gt=(e,t)=>{if(!e||!t)return t;let n=ar();return n[e]=t,jo(n),t},tt=new Map,Re=null,et=null,Le=!1,He=null,Wo=()=>{if(typeof He=="string")return He;let e=zt(Qn);return He=typeof e=="string"?e:"",He},ir=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();He=t,Oo(Qn,t)},re=e=>{e?.templateId&&ir(e.templateId)},lr=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},ue=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(Vt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},cr=async()=>Re?et||(et=Re().then(e=>{let{db:t,getCollection:n}=e||{},r=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),et):null,dr=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:r,db:o}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(o,"plannerPlans",t)},nt=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&tt.set(e.weekId,e),e),Vo=e=>{let t=Q();return we({weekId:e,lessons:e===t?Ro:[]},e)},Fe=e=>{let t=sr(e);if(t)return nt(t),t;let n=Vo(e);return Gt(e,n),nt(n),n},fe=async e=>{if(!e?.weekId)return e;let t=we(e,e.weekId);if(Gt(t.weekId,t),nt(t),re(t),Le||!Re)return t;try{let n=await cr();if(!n)return t;let r=dr(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(r,t,{merge:!0}):await n.updateDoc(r,t),t}catch(n){return lr(n)?(console.warn("Persisting planner data locally due to permission issue",n),Le=!0,t):(console.error("Failed to persist planner plan",n),t)}},ur=(e={})=>{typeof e.ensureFirestore=="function"&&(Re=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(Le=e.forceLocal)},Q=(e=new Date)=>{let t=_o(e);return tr(t)},ot=(e,t=0)=>{let n=rt(e);if(!n||!Number.isFinite(t))return e;let r=new Date(n);return r.setDate(n.getDate()+t*7),tr(r)},fr=(e=Q(),t=0)=>{let n=rt(e);if(!n)return null;let r=Number.isFinite(t)?t:0,o=Kt(r),a=new Date(n);return a.setDate(n.getDate()+o),a},Jt=(e,{short:t=!1}={})=>{let n=rt(e);if(!n)return"";let r=new Date(n);r.setDate(n.getDate()+6);let o=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),a=o.format(n),i=o.format(r),s=n.getFullYear()===r.getFullYear();if(t)return`Week of ${a}`;let l=s?n.getFullYear():`${n.getFullYear()} \u2013 ${r.getFullYear()}`;return`${a} \u2013 ${i}, ${l}`},mr=(e=Q())=>{if(!e)return[];let t=tt.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=sr(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},V=async(e=Q())=>{if(!e)return null;if(tt.has(e)){let t=tt.get(e);return re(t),t}if(Le||!Re){let t=Fe(e);return re(t),t}try{let t=await cr();if(!t){let a=Fe(e);return re(a),a}let n=dr(t,e),r=await t.getDoc(n);if(r.exists()){let a=r.data(),i=we({...a,weekId:e},e);return Gt(e,i),nt(i),Le=!1,re(i),i}let o=Fe(e);return typeof t.setDoc=="function"&&await t.setDoc(n,o,{merge:!0}),re(o),o}catch(t){if(lr(t)){console.warn("Falling back to local planner data due to permission issue",t),Le=!0;let r=Fe(e);return re(r),r}console.error("Failed to load planner data",t);let n=Fe(e);return re(n),n}},at=async(e,t)=>{if(!e)return null;let n=await V(e),r=Yt(t);r.position=or(n?.lessons||[],r.dayIndex);let o={...n,lessons:de([...n?.lessons||[],r]),updatedAt:new Date().toISOString()},a=await fe(o);return ue(a),a},Xt=async(e,t,n={})=>{if(!e||!t)return null;let r=await V(e),o=[...r?.lessons||[]],a=o.findIndex(g=>g.id===t);if(a===-1)return r;let i=o[a],s=Yt({...i,...n,id:t},i);if(s.dayIndex!==i.dayIndex){let g=o.filter((y,E)=>E!==a);s.position=or(g,s.dayIndex)}o[a]=s;let l={...r,lessons:de(o),updatedAt:new Date().toISOString()},u=await fe(l);return ue(u),u},pr=async(e,t)=>{if(!e||!t)return null;let n=await V(e),r=(n?.lessons||[]).filter(i=>i.id!==t),o={...n,lessons:de(r),updatedAt:new Date().toISOString()},a=await fe(o);return ue(a),a},yr=async(e,t,n)=>{if(!e||!t||!n)return null;let r=n==="up"?-1:n==="down"?1:0;if(!r)return V(e);let o=await V(e),a=[...o?.lessons||[]],i=a.findIndex(T=>T.id===t);if(i===-1)return o;let s=a[i],l=a.filter(T=>T.dayIndex===s.dayIndex);if(l.length<=1)return o;let g=de(l).map(T=>T.id),y=g.indexOf(t);if(y===-1)return o;let E=y+r;if(E<0||E>=g.length)return o;let[A]=g.splice(y,1);g.splice(E,0,A);let C=new Map(g.map((T,f)=>[T,f])),F=a.map(T=>{if(T.dayIndex!==s.dayIndex)return T;let f=C.get(T.id);return typeof f=="number"?{...T,position:f}:T}),P={...o,lessons:de(F),updatedAt:new Date().toISOString()},M=await fe(P);return ue(M),M},Qt=async(e,t,n)=>{if(!e||!t)return null;let r=await V(e),o=[...r?.lessons||[]],a=o.findIndex(y=>y.id===t);if(a===-1)return r;let i=rr(n);if(!i)return r;let s=o[a],l={...s,details:[...s.details||[],i]};o[a]=l;let u={...r,lessons:de(o),updatedAt:new Date().toISOString()},g=await fe(u);return ue(g),g},hr=async(e,t)=>{if(!e||!t)return null;let n=await V(e),r=(n?.lessons||[]).map(i=>({title:i.title,summary:i.summary,dayIndex:i.dayIndex,notes:typeof i.notes=="string"?i.notes:"",subject:typeof i.subject=="string"?i.subject:"",details:(i.details||[]).map(s=>({badge:s.badge,text:s.text}))})),o=we({weekId:t,lessons:r,templateId:typeof n?.templateId=="string"?n.templateId:""},t);o.updatedAt=new Date().toISOString();let a=await fe(o);return ue(a),a},gr=e=>{if(!e||typeof e!="object")return null;let t=Kt(Number.isFinite(e.dayIndex)?e.dayIndex:nr(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",r=typeof e.summary=="string"?e.summary:"",o=typeof e.notes=="string"?e.notes:"",a=typeof e.subject=="string"?e.subject.trim():"",i=Array.isArray(e.details)?e.details.map(s=>{if(!s||typeof s!="object")return null;let l=typeof s.badge=="string"?s.badge:"",u=typeof s.text=="string"?s.text:"";return u.trim()?{badge:l,text:u}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:r,details:i,notes:o,subject:a}},ve=()=>{let e=qo(),t={};return Object.keys(e).forEach(n=>{let r=e[n];if(!r||typeof r!="object")return;let o=typeof r.name=="string"&&r.name.trim()?r.name.trim():n,a=Array.isArray(r.lessons)?r.lessons.map(i=>gr(i)).filter(Boolean):[];t[o]={name:o,lessons:a,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:""}}),t},br=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let r=ve(),o=Array.isArray(t.lessons)?t.lessons.map(a=>gr(a)).filter(Boolean):[];return r[n]={name:n,lessons:o,updatedAt:new Date().toISOString()},Uo(r),r[n]},st=()=>Wo(),Zt=async(e,t)=>{if(!e||!t)return null;let r=ve()[t];if(!r)return V(e);ir(t);let o=Array.isArray(r.lessons)?r.lessons.map(s=>({dayIndex:s.dayIndex,title:s.title,summary:s.summary,notes:typeof s.notes=="string"?s.notes:"",subject:typeof s.subject=="string"?s.subject:"",details:Array.isArray(s.details)?s.details.map(l=>({badge:l.badge,text:l.text})):[]})):[],a=we({weekId:e,lessons:o,templateId:t},e);a.updatedAt=new Date().toISOString();let i=await fe(a);return ue(i),i}});var Ts=Ao(()=>{ko();Do();Kn();Gn();Io();Co();No();Er();_n();function zo(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let r=document.querySelectorAll("[data-open-reminder-modal]");if(!r.length)return;if(!e){let d=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};r.forEach(h=>{h.addEventListener("click",N=>{if(N.preventDefault(),typeof window<"u"){let k="#reminders";window.location.hash!==k&&(window.location.hash=k),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{d()})})});return}let o=e.querySelector("[data-reminder-modal-backdrop]"),a=e.querySelectorAll("[data-close-modal]"),i=document.getElementById("mainContent"),s=document.querySelector('nav[aria-label="Primary"]'),l=[i,s],u=e.querySelector('[role="dialog"]')??e,g=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],y=null,E=()=>{if(!(u instanceof HTMLElement))return[];let d=u.querySelectorAll(g.join(","));return Array.from(d).filter(h=>{let N=h instanceof HTMLElement,k=typeof SVGElement<"u"&&h instanceof SVGElement;if(!N&&!k||h.getAttribute("aria-hidden")==="true"||"disabled"in h&&h.disabled||h.hidden||h.closest("[hidden]"))return!1;let H=h.getBoundingClientRect();return H.width>0&&H.height>0})},A=()=>{let d=E(),h=d.find(N=>N.hasAttribute("data-autofocus")||N.hasAttribute("autofocus"))||(n&&d.includes(n)?n:null)||d[0];if(h&&typeof h.focus=="function"){h.focus({preventScroll:!0});return}u instanceof HTMLElement&&typeof u.focus=="function"&&u.focus({preventScroll:!0})},C=d=>{u instanceof HTMLElement&&(!(d.target instanceof Node)||!u.contains(d.target))&&(d.stopPropagation(),A())},F=d=>{if(d.key!=="Tab")return;let h=E();if(!h.length){d.preventDefault(),u instanceof HTMLElement&&u.focus({preventScroll:!0});return}let N=h[0],k=h[h.length-1],H=document.activeElement;if(d.shiftKey){(!u.contains(H)||H===N)&&(d.preventDefault(),k.focus());return}(!u.contains(H)||H===k)&&(d.preventDefault(),N.focus())},P=d=>{l.forEach(h=>{h&&(d?h.setAttribute("inert",""):h.removeAttribute("inert"))})},M=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),P(!1),document.removeEventListener("keydown",T,!0),e.removeEventListener("keydown",F,!0),e.removeEventListener("focusin",C,!0),y&&typeof y.focus=="function"&&y.focus(),y=null},T=d=>{d.key==="Escape"&&(d.preventDefault(),M())},f=({triggerElement:d}={})=>{d&&typeof d.focus=="function"?y=d:y=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),P(!0),document.addEventListener("keydown",T,!0),e.addEventListener("keydown",F,!0),e.addEventListener("focusin",C,!0),window.requestAnimationFrame(()=>{A()})},m=(d,h={})=>{try{document.dispatchEvent(new CustomEvent(d,{detail:h}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let N=document.createEvent("CustomEvent");N.initCustomEvent(d,!0,!0,h),document.dispatchEvent(N)}}},b=(d={})=>{m("cue:cancelled",d)};r.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault();let k={trigger:h.currentTarget instanceof HTMLElement?h.currentTarget:null,mode:"create"};m("cue:prepare",k),m("cue:open",k)})}),a.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault(),b({trigger:d,reason:"button"})})}),e.addEventListener("click",d=>{d.target===e&&b({reason:"backdrop"})}),o?.addEventListener("click",d=>{d.target===o&&b({reason:"backdrop"})}),document.addEventListener("cue:open",d=>{let h=d?.detail?.trigger,N=h instanceof HTMLElement?h:null;f({triggerElement:N})});let L=()=>{M()};document.addEventListener("cue:close",L),document.addEventListener("cue:cancelled",L);let w=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&w instanceof HTMLElement&&t.addEventListener("submit",d=>{d.preventDefault(),!w.matches(":disabled")&&w.click()}),w instanceof HTMLElement&&document.addEventListener("reminder:save",d=>{let h=d?.detail?.trigger;h&&h!==w||w.matches(":disabled")||w.click()})}zo();function en(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var Lr=null;function Ko(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function _r(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Yo(e){typeof document>"u"||!e||(window.clearTimeout(Lr),Lr=window.setTimeout(()=>{let t=Ko(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Ae(e){let t=e||_r();t&&Yo(t)}function Go(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Ae()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",r=>{if(!(r.currentTarget instanceof HTMLAnchorElement))return;let o=r.currentTarget.getAttribute("href")||"";if(!o.startsWith("#"))return;r.preventDefault();let a=o||"#dashboard",i=a.replace("#","")||"dashboard";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Ae(i)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Ae()}Go();var Sr=document.getElementById("settings-save-button"),it=document.getElementById("settings-save-confirmation"),W=document.getElementById("live-status"),tn=null,me=document.getElementById("resourcePlannerStatus"),nn=null;document.addEventListener("planner:reminderCreated",e=>{if(!W)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",r=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",o=r?`Reminder saved for ${r}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";W.textContent=o});Sr&&it&&Sr.addEventListener("click",e=>{e.preventDefault(),it.classList.remove("hidden"),it.textContent="Settings saved!",W&&(W.textContent="Settings saved!"),tn&&window.clearTimeout(tn),tn=window.setTimeout(()=>{it.classList.add("hidden")},3e3)});function Jo(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Ae(t),W&&(W.textContent="Opening planner to add a new lesson."),Ht(),window.requestAnimationFrame(()=>{let r=co();r&&typeof r.catch=="function"&&r.catch(o=>{console.error("Planner quick action failed to start new lesson flow",o)})})}function Xo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Jo)})}Xo();function rn(e,{tone:t="success"}={}){me&&(me.textContent=e,me.classList.remove("hidden"),me.classList.remove("text-success","text-error"),me.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(nn&&window.clearTimeout(nn),nn=window.setTimeout(()=>{me.classList.add("hidden"),me.textContent=""},4e3))),W&&(W.textContent=e)}function $r(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function Qo(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let r=n.getAttribute("data-resource-title")?.trim(),o=n.getAttribute("data-resource-link")?.trim();if(!r||!o)return;let a="#planner";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Ae("planner"),Ht(),await vn();let i=`${r} \u2014 ${o}`,s=za(),l=null;try{if(s)l=await Qt(S,s,{badge:"Resource",text:i});else{let u=$r("lesson"),g=v?.lessons?.[0]?.dayLabel||"Monday";l=await at(S,{id:u,dayName:g,title:r,summary:`Resource link: ${o}`,details:[{badge:"Resource",text:i}]}),l&&(O=u)}if(l){v=l,U(l),q(l,S),K(l);let u=s?`Added "${r}" to your selected lesson.`:`Created a lesson for "${r}" in this week's planner.`;rn(u);return}rn("Unable to save that resource to the planner right now.",{tone:"error"})}catch(u){console.error("Failed to save resource to planner",u),rn("Unable to save that resource to the planner right now.",{tone:"error"})}}function Zo(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",Qo)})}Zo();var jr=document.getElementById("reminder-title"),ea=document.getElementById("reminderText"),J=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),r=e.querySelector(".modal-backdrop button"),o=document.getElementById("modal-title");return Yn({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:r instanceof HTMLElement?r:null,titleInput:jr,modalTitle:o instanceof HTMLElement?o:null,defaultTitle:jt,editTitle:qt})})();J?.setEditMode(!1);var ta=()=>{let e=!!jr;if(!!ea)return Qe({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?Qe(n):Qe({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};ta().catch(e=>{console.error("Failed to initialise reminders",e)});var dn=jn(),on=$n({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{dn?.handleSessionChange(e)}});if(on?.supabase){dn?.setSupabaseClient(on.supabase);try{on.supabase.auth.getSession().then(({data:e})=>{dn?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var te=document.getElementById("cues-list"),an=document.getElementById("pinnedNotesCard"),xe=document.getElementById("pinnedNotesList"),be=document.getElementById("cue-form"),G=be?.querySelector("#cue-id-input"),na=J?.defaultTitle||J?.modalTitle?.textContent?.trim()||jt,Hs=J?.editTitle||qt,vt=document.getElementById("tab-cues"),Tt=document.getElementById("tab-daily"),Ue=document.getElementById("cues-view"),We=document.getElementById("daily-list-view"),wr=document.getElementById("daily-list-header"),qr=document.getElementById("quick-add-form"),j=document.getElementById("quick-add-input"),z=document.getElementById("daily-voice-btn"),se=document.getElementById("daily-tasks-container"),un=document.getElementById("clear-completed-btn"),xt=document.getElementById("daily-list-permission-notice"),$=document.getElementById("plannerCards")||document.getElementById("planner-grid"),vr=document.getElementById("planner-week"),ra=document.getElementById("planner-prev"),oa=document.getElementById("planner-next"),aa=document.getElementById("planner-today"),sa=document.getElementById("planner-duplicate-btn"),ia=document.getElementById("planner-new-lesson-btn"),oe=document.getElementById("planner-template-select"),Ur=document.getElementById("planner-template-save-btn"),At=document.querySelector("[data-planner-text-size]"),$e=document.getElementById("planner-subject-filter"),sn=document.querySelector(".desktop-panel--planner"),ke=document.getElementById("planner-detail-panel"),lt=ke?.querySelector("[data-planner-detail-empty]"),ct=ke?.querySelector("[data-planner-detail-content]"),dt=document.getElementById("planner-detail-day"),ut=document.getElementById("planner-detail-title"),ft=document.getElementById("planner-detail-summary"),mt=document.getElementById("planner-detail-subject"),pt=document.getElementById("planner-detail-details"),la=document.getElementById("planner-detail-actions"),yt=document.querySelector("[data-mobile-notes-text-size]"),ln=document.querySelector(".mobile-panel--notes"),Wr="plannerTextSizePreference",kt="default",Mt=new Set(["small","default","large"]),ca=["planner-text-small","planner-text-default","planner-text-large"],Vr="mobileNotesTextSizePreference",It="default",Pt=new Set(["small","default","large"]),da=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function fn(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function ua(){if(typeof localStorage>"u")return kt;let e=localStorage.getItem(Wr);return e&&Mt.has(e)?e:kt}function fa(e){typeof localStorage>"u"||!Mt.has(e)||localStorage.setItem(Wr,e)}function zr(e){if(!sn)return;let t=Mt.has(e)?e:kt;ca.forEach(n=>sn.classList.remove(n)),sn.classList.add(`planner-text-${t}`)}var Kr=ua();zr(Kr);fn(At)&&(At.value=Kr);function Yr(){if(typeof localStorage>"u")return It;let e=localStorage.getItem(Vr);return e&&Pt.has(e)?e:It}function ma(e){typeof localStorage>"u"||!Pt.has(e)||localStorage.setItem(Vr,e)}function Gr(e){if(!ln)return;let t=Pt.has(e)?e:It;da.forEach(n=>ln.classList.remove(n)),ln.classList.add(`mobile-panel--notes-size-${t}`)}var Jr=Yr();Gr(Jr);yt instanceof HTMLSelectElement&&(yt.value=Jr,yt.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:It;if(!Pt.has(t)){yt.value=Yr();return}ma(t),Gr(t)}));var pa=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function ya(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=pa.findIndex(r=>r.toLowerCase()===t.toLowerCase());return n>=0?n:0}function ha(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function ga(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),r=document.getElementById("planner-modal-description"),o=document.getElementById("planner-modal-error"),a=document.getElementById("planner-modal-submit"),i=document.getElementById("planner-lesson-day"),s=document.getElementById("planner-lesson-title"),l=document.getElementById("planner-lesson-summary"),u=document.getElementById("planner-lesson-subject"),g=document.getElementById("planner-detail-badge"),y=document.getElementById("planner-detail-text"),E=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(a instanceof HTMLElement)||!(i instanceof HTMLSelectElement)||!(s instanceof HTMLInputElement)||!(l instanceof HTMLTextAreaElement))return null;let A=t.querySelector("[data-planner-lesson-section]"),C=t.querySelector("[data-planner-summary-section]"),F=t.querySelector("[data-planner-detail-section]"),P=t.querySelector("[data-planner-duplicate-section]"),M=e.querySelector("[data-planner-modal-dialog]"),T=e.querySelector("[data-planner-modal-backdrop]"),f=e.querySelectorAll("[data-planner-modal-close]"),m=document.getElementById("mainContent"),b=document.querySelector('nav[aria-label="Primary"]'),L=(()=>{let c=[],p=e.parentElement;return b instanceof HTMLElement&&c.push(b),p instanceof HTMLElement?c.push(...Array.from(p.children).filter(x=>x instanceof HTMLElement&&x!==e)):m instanceof HTMLElement&&(m.contains(e)?c.push(...Array.from(m.children).filter(x=>x instanceof HTMLElement&&!x.contains(e))):c.push(m)),c})(),w=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],d={mode:"add",lessonId:null,trigger:null},h=null,N=null,k=c=>{h=c instanceof HTMLElement?c:null},H=c=>{L.forEach(p=>{p&&(c?p.setAttribute("inert",""):p.removeAttribute("inert"))})},Mn=()=>{if(!(M instanceof HTMLElement))return[];let c=M.querySelectorAll(w.join(","));return Array.from(c).filter(p=>{if(p.closest('[aria-hidden="true"]')||"disabled"in p&&p.disabled)return!1;let x=p.getBoundingClientRect();return x.width>0&&x.height>0})},Pn=()=>{let c=Mn(),p=(h&&c.includes(h)?h:null)||c[0]||M;p&&typeof p.focus=="function"&&p.focus({preventScroll:!0})},Bn=c=>{M instanceof HTMLElement&&(M.contains(c.target)||Pn())},Lo=c=>{if(c.key!=="Tab")return;let p=Mn();if(!p.length){c.preventDefault();return}let x=p[0],Me=p[p.length-1];if(c.shiftKey&&document.activeElement===x){c.preventDefault(),Me.focus();return}!c.shiftKey&&document.activeElement===Me&&(c.preventDefault(),x.focus())},Fn=c=>{if(c.key==="Escape"){c.preventDefault(),X();return}Lo(c)},Hn=()=>{o&&(o.textContent="",o.classList.add("hidden"),o.setAttribute("aria-hidden","true"))},ne=c=>{o&&(o.textContent=c,o.classList.remove("hidden"),o.removeAttribute("aria-hidden"))},Rn=c=>{a.disabled=!!c,a.classList.toggle("loading",!!c)},B=(c,p)=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!p),p?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"))},Ge=c=>{[i,s,l,u].forEach(p=>{p instanceof HTMLElement&&(p.disabled=!!c,p.classList.toggle("opacity-60",!!c),p.classList.toggle("cursor-not-allowed",!!c))})},Ne=()=>{t.reset(),Hn(),k(null),Ge(!1),u instanceof HTMLInputElement&&(u.value=""),g instanceof HTMLInputElement&&(g.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),E instanceof HTMLInputElement&&(E.value="")},Je=({title:c,description:p,action:x})=>{n&&(n.textContent=c||"Plan lesson"),r&&(r.textContent=p||""),a.textContent=x||"Save lesson"},Xe=({trigger:c}={})=>{d.trigger=c instanceof HTMLElement?c:null,N=d.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),H(!0),document.addEventListener("keydown",Fn,!0),e.addEventListener("focusin",Bn,!0),window.requestAnimationFrame(()=>{Pn()})},X=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),H(!1),document.removeEventListener("keydown",Fn,!0),e.removeEventListener("focusin",Bn,!0);let c=d.trigger||N;d.mode="add",d.lessonId=null,d.trigger=null,k(null),Ne(),c&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},So=({defaultDay:c="Monday",trigger:p}={})=>{d.mode="add",d.lessonId=null,Ne(),B(A,!0),B(C,!0),B(F,!1),B(P,!1),Ge(!1);let x=typeof c=="string"&&c.trim()?c.trim():"Monday";i.value=x,i.value!==x&&(i.value="Monday"),s.value=x?`${x} lesson`:"",l.value="",u instanceof HTMLInputElement&&(u.value=""),Je({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),k(s),Xe({trigger:p})},wo=({lesson:c,trigger:p}={})=>{if(!c)return;d.mode="edit",d.lessonId=c.id,Ne(),B(A,!0),B(C,!0),B(F,!1),B(P,!1),Ge(!1);let x=c.dayLabel||c.dayName||"Monday";i.value=x,i.value!==x&&(i.value="Monday"),s.value=c.title||"",l.value=c.summary||"",u instanceof HTMLInputElement&&(u.value=c.subject||""),Je({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),k(s),Xe({trigger:p})},vo=({lesson:c,trigger:p}={})=>{if(!c)return;d.mode="detail",d.lessonId=c.id,Ne(),B(A,!0),B(C,!0),B(F,!0),B(P,!1),Ge(!0);let x=c.dayLabel||c.dayName||"Monday";i.value=x,i.value!==x&&(i.value="Monday"),s.value=c.title||"",l.value=c.summary||"",u instanceof HTMLInputElement&&(u.value=c.subject||""),g instanceof HTMLInputElement&&(g.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),Je({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),k(y instanceof HTMLElement?y:null),Xe({trigger:p})},To=({suggestedWeekId:c="",trigger:p}={})=>{d.mode="duplicate",d.lessonId=null,Ne(),B(A,!1),B(C,!1),B(F,!1),B(P,!0),E instanceof HTMLInputElement&&(E.value=c),Je({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),k(E instanceof HTMLElement?E:null),Xe({trigger:p})},xo=async c=>{c.preventDefault(),Hn(),Rn(!0);try{if(d.mode==="duplicate"){let R=E?.value?.trim();if(!R){ne("Enter the Monday date for the destination week.");return}if(R===S){ne("Choose a different week to duplicate into.");return}let ce=await hr(S,R);ce&&(S=R,v=ce,U(ce),wn(R),q(ce,R),K(ce),X());return}if(d.mode==="detail"){if(!d.lessonId){ne("Select a lesson before adding details.");return}let R=y?.value?.trim();if(!R){ne("Add text for this detail.");return}let ce=g?.value?.trim()||"",Be=await Qt(S,d.lessonId,{badge:ce,text:R});Be&&(v=Be,U(Be),q(Be,S),K(Be),X());return}let p=i.value.trim(),x=s.value.trim(),Me=l.value.trim(),On=u?.value?.trim()||"";if(!p){ne("Choose a day for this lesson.");return}if(!x){ne("Enter a lesson title.");return}if(d.mode==="edit"){if(!d.lessonId){ne("Select a lesson to edit.");return}let R=await Xt(S,d.lessonId,{dayName:p,title:x,summary:Me,subject:On});R&&(v=R,U(R),q(R,S),K(R),X());return}let Pe=await at(S,{dayName:p,title:x,summary:Me,subject:On});Pe&&(v=Pe,U(Pe),q(Pe,S),K(Pe),X())}catch(p){console.error("Failed to save planner change",p),ne("Unable to save changes right now. Please try again.")}finally{Rn(!1)}};return t.addEventListener("submit",xo),f.forEach(c=>{c.addEventListener("click",p=>{p.preventDefault(),X()})}),e.addEventListener("click",c=>{c.target===e&&X()}),T?.addEventListener("click",c=>{c.target===T&&X()}),{openAddLesson:So,openEditLesson:wo,openAddDetail:vo,openDuplicatePlan:To,close:X}}var Tr=document.getElementById("remindersCount"),ie=typeof document<"u"?ga():null,xr=document.getElementById("plannerCount"),Ar=document.getElementById("plannerSubtitle"),ye="all",ae=ye,Rs=document.getElementById("resourcesCount"),Os=document.getElementById("templatesCount"),ht=document.getElementById("dailySnapshotList"),gt=document.getElementById("todaysFocusList"),Z=document.getElementById("weekAtAGlanceList"),ee=null;Z&&(ee=document.createElement("li"),ee.dataset.emptyState="week",ee.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",ee.textContent="No upcoming events this week.");var kr=()=>{if(!Z||!ee)return;Z.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?Z.contains(ee)||Z.appendChild(ee):Z.contains(ee)&&Z.removeChild(ee)};Z&&(kr(),new MutationObserver(kr).observe(Z,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var cn=e=>{an&&(e?an.classList.remove("hidden"):an.classList.add("hidden"))},Ve={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Ir=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),Dr=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),St=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",Sn=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},ba=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Xr=e=>{if(!e)return"";if(Ir)try{return Ir.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},Ea=e=>{if(!e)return"";if(Dr)try{return Dr.format(e)}catch{}return e.toLocaleDateString()},Qr=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Ve,t)?t:"medium"},Cr=e=>{let t=Qr(e);return Ve[t]?.rank??Ve.medium.rank},La=e=>{let t=Qr(e);return Ve[t]??Ve.medium},Nr=e=>{let t=Sn(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Zr(e=[]){if(!ht)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(r=>({reminder:r,date:Sn(r)})).filter(({date:r})=>r&&ba(r,t)).sort((r,o)=>r.date.getTime()-o.date.getTime());if(!n.length){ht.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}ht.innerHTML="",n.forEach(({reminder:r,date:o})=>{let a=document.createElement("li");a.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=St(r),a.appendChild(i);let s=Xr(o),l=document.createElement("p");l.className="text-xs text-base-content/70",l.textContent=s?`Due ${s}`:"Due today",a.appendChild(l),ht.appendChild(a)})}function eo(e=[]){if(!gt)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,r)=>{let o=Cr(n)-Cr(r);if(o!==0)return o;let a=Nr(n)-Nr(r);return a!==0?a:St(n).localeCompare(St(r),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){gt.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}gt.innerHTML="",t.forEach(n=>{let r=document.createElement("li");r.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let o=document.createElement("div");o.className="flex items-center justify-between gap-3";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=St(n),o.appendChild(a);let i=La(n),s=document.createElement("span");s.className=i.badgeClass,s.textContent=i.badgeLabel,o.appendChild(s),r.appendChild(o);let l=Sn(n),u=document.createElement("p");if(u.className="text-xs text-base-content/70",l){let g=Xr(l),y=Ea(l),E=[];g&&E.push(`Due ${g}`),y&&E.push(y),u.textContent=E.length?E.join(" \u2022 "):"Due soon"}else u.textContent="No due date";r.appendChild(u),gt.appendChild(r)})}var Sa=e=>{if(!Tr)return;let t=Array.isArray(e)?e.length:0;Tr.textContent=String(t)},wa=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Sa(t),Zr(t),eo(t)};document.addEventListener("memoryCue:remindersUpdated",wa);Zr();eo();var mn=Un(qn),va={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},bt=null,Ta=3,Mr=120;function xa(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Mr?t:`${t.slice(0,Mr-1)}\u2026`:""}function Aa(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let r=n.trim().toLowerCase();return r==="true"||r==="1"||r==="yes"}return!1})}function Pr(e){if(!xe)return;let t=Array.isArray(e)?e:[];if(!t.length){xe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',cn(!1);return}let n=t.filter(a=>Aa(a));if(!n.length){xe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',cn(!1);return}cn(!0);let o=n.slice(0,Ta).map(a=>{let i=I(Ee(a,"title")||"Untitled Cue"),s=Ee(a,"details"),l=I(xa(s)),u=l?`<p class="mt-1 text-sm text-base-content/70">${l}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${i}</p>
          ${u}
        </li>
      `}).join("");xe.innerHTML=o}function pn(e,{tone:t="muted"}={}){if(!te)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),te.innerHTML=`<p class="${n.join(" ")}">${I(e)}</p>`}function ka(e){if(!te)return;if(!Array.isArray(e)||e.length===0){pn("No cues yet.");return}let t=e.map(n=>{let r=I(Ee(n,"title")||"Untitled Cue"),o=I(Ee(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${r}</h2>
            ${o?`<p>${o}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${I(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${I(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");te.innerHTML=t}async function Ye(){return bt||(bt=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:r,enableIndexedDbPersistence:o,collection:a,doc:i,getDoc:s,addDoc:l,updateDoc:u,getDocs:g,query:y,orderBy:E,serverTimestamp:A,setDoc:C,arrayUnion:F}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),P=t(),M=P&&P.length?P[0]:e(va),T=n(M);(function(){let b=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;b&&(b.__persistenceInitialized__||(b.__persistenceInitialized__=!0,(async()=>{try{await r(T),console.info("[Firestore] Persistence: multi-tab enabled")}catch(L){if(L&&L.code==="failed-precondition")try{await o(T),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(w){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",w?.code||w)}else L&&L.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",L?.code||L)}})()))})();let f=a(T,"cues");return{db:T,cuesCollection:f,getCollection:a,doc:i,getDoc:s,addDoc:l,updateDoc:u,getDocs:g,query:y,orderBy:E,serverTimestamp:A,setDoc:C,arrayUnion:F}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),bt)}async function Ia(){let e=await Ye(),{getDocs:t,cuesCollection:n,query:r,orderBy:o}=e,a=r&&o?r(n,o("createdAt","desc")):n;return(await t(a)).docs.map(s=>({id:s.id,...s.data()}))}async function Da(e){if(!e)return null;let t=await Ye(),{db:n,doc:r,getDoc:o}=t,a=r(n,"cues",e),i=await o(a);return i.exists()?{id:i.id,...i.data()}:null}async function to(){if(!(!te&&!xe))try{let e=await Ia();ka(e),Pr(e)}catch(e){console.error("Failed to load cues",e),Rt(e)?pn("Sign in to view your cues.",{tone:"muted"}):pn("Unable to load cues right now.",{tone:"error"}),Pr([])}}function Ca(e){!be||!G||(Wn(e,mn),G.value=e?.id||"",J?.setEditMode(!0),J?.show({mode:"edit"}))}async function Na(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let r=await Da(n);if(!r)return;Ca(r)}catch(r){console.error("Failed to prepare cue for editing",r)}}async function Ma(e){if(e.preventDefault(),!be||!G)return;let t=G.value.trim(),n=zn(mn);try{let r=await Ye(),{db:o,doc:a,addDoc:i,updateDoc:s,cuesCollection:l,serverTimestamp:u}=r,g=typeof u=="function"?u():null;if(t){let y=a(o,"cues",t),E={...n};g&&(E.updatedAt=g),await s(y,E)}else{let y={...n};g&&(y.createdAt=g,y.updatedAt=g),await i(l,y)}await to(),Vn(mn,G,J?.modalTitle??null,na),await J?.hide({reason:"form-submit"})}catch(r){console.error("Failed to save cue",r)}}async function Pa(){!be||!G||!te||(te.addEventListener("click",Na),be.addEventListener("submit",Ma))}be&&G&&(document.addEventListener("cue:prepare",()=>{G.value="",J?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{G.value="",J?.setEditMode(!1)}));be&&G&&te&&Pa().catch(e=>{console.error("Failed to initialise cue editing",e)});(te||xe)&&to();var D=[],Et=null,he=!1,ze=Q(),qe=!1,S=ze,v=null,je=null,O=null,Ie=ve(),Dt=new Map,Ba=800,Fa=1500,yn={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},no=new Set(["saving","saved","error"]),ro="plannerNotesOpenState",pe=Ha();function Ha(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(ro);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function Ra(){if(!(typeof localStorage>"u"))try{localStorage.setItem(ro,JSON.stringify(pe))}catch(e){console.warn("Unable to persist planner notes state",e)}}function Oa(e){return e?!!pe?.[e]:!1}function _a(e,t){if(e){if(t)pe={...pe,[e]:!0};else if(pe?.[e]){let n={...pe};delete n[e],pe=n}Ra()}}var $a=e=>{if(!xr)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=mr(ze),xr.textContent=String(t.length)};function q(e,t){if($a(e),Ar){let n=Jt(e?.weekId||t,{short:!0});Ar.textContent=n||""}}function Ct(e,{tone:t="muted"}={}){if(!$)return;O=null,oo(null);let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),$.innerHTML=`<p class="${n.join(" ")}">${I(e)}</p>`}function wn(e){if(!vr)return;let t=Jt(e);vr.textContent=t||""}function Bt(e){if(!oe)return;Ie=ve();let t=Object.values(Ie).sort((a,i)=>a.name.localeCompare(i.name)),n=t.length>0,o=[`<option value="">${I(n?"Select template":"No templates saved")}</option>`];t.forEach(a=>{let i=a.name;o.push(`<option value="${I(i)}">${I(i)}</option>`)}),oe.innerHTML=o.join(""),oe.disabled=!n,e&&Ie[e]?oe.value=e:oe.value=""}function K(e){let t=e?.templateId||st();Bt(t)}function Ft(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function ja(e){let t=Ft(e);return t?t.toLowerCase():""}function qa(e){if(!$e)return;let t=new Map;e.forEach(r=>{let o=Ft(r);if(!o)return;let a=o.toLowerCase();t.has(a)||t.set(a,o)}),(t.size===0||ae!==ye&&!t.has(ae))&&(ae=ye);let n=[`<option value="${ye}">All subjects</option>`];t.forEach((r,o)=>{n.push(`<option value="${I(o)}">${I(r)}</option>`)}),$e.innerHTML=n.join(""),$e.value=ae,$e.disabled=t.size===0}function Ua(e){return Array.isArray(e)?ae===ye?e:e.filter(t=>ja(t)===ae):[]}function Wa(e){ae=typeof e?.target?.value=="string"?e.target.value:ye,U(v)}function oo(e){if(!ke)return;if(!e){ke.removeAttribute("data-lesson-id"),dt&&(dt.textContent=""),ut&&(ut.textContent=""),ft&&(ft.textContent=""),mt&&(mt.innerHTML=""),pt&&(pt.innerHTML=""),lt instanceof HTMLElement&&lt.classList.remove("hidden"),ct instanceof HTMLElement&&ct.classList.add("hidden");return}let t=typeof e.id=="string"?e.id:"";ke.setAttribute("data-lesson-id",t);let n=typeof e.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(dt&&(dt.textContent=n),ut&&(ut.textContent=e.title||n||"Lesson"),ft){let r=typeof e.summary=="string"&&e.summary.trim()?e.summary.trim():"No summary added yet.";ft.textContent=r}if(mt){let r=Ft(e);mt.innerHTML=r?`<span class="badge badge-outline badge-sm text-base-content/80">${I(r)}</span>`:'<p class="text-xs text-base-content/60">No subject tagged.</p>'}if(pt){let r=Array.isArray(e.details)?e.details.filter(o=>typeof o?.text=="string"&&o.text.trim().length>0).map(o=>`
              <div class="rounded-xl border border-base-200/80 bg-base-100/80 p-3">
                <div class="flex flex-wrap items-start gap-2">
                  ${o?.badge?`<span class="badge badge-outline badge-xs text-base-content/70">${I(o.badge)}</span>`:""}
                  <p class="text-sm text-base-content/80">${I(o.text)}</p>
                </div>
              </div>
            `).join(""):"";pt.innerHTML=r||'<p class="text-sm text-base-content/60">No lesson details yet.</p>'}lt instanceof HTMLElement&&lt.classList.add("hidden"),ct instanceof HTMLElement&&ct.classList.remove("hidden")}async function Va(e,t){let r=(Array.isArray(e?.lessons)?e.lessons:[]).length>0,o=typeof e?.templateId=="string"&&e.templateId.trim().length>0;if(r||o)return e;let a=st();if(!a||(Ie[a]||(Ie=ve()),!Ie[a]))return e;try{return await Zt(t,a)||e}catch(i){return console.error("Failed to auto apply preferred planner template",i),e}}function U(e){if(!$)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(qa(t),!t.length){Ct("No lessons saved for this week yet.");return}let n=Ua(t);if(!n.length){Ct("No lessons saved for this subject yet.");return}let r=n.map(a=>typeof a.id=="string"&&a.id?a.id:"").filter(a=>!!a);O&&!r.includes(O)&&(O=null);let o=n.map(a=>{let i=Array.isArray(a.details)?a.details.map(f=>`
                <li class="flex items-center gap-2">
                  ${f.badge?`<span class="badge badge-outline badge-sm text-secondary">${I(f.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${I(f.text)}</span>
                </li>
              `).join(""):"",s=i?`<ul class="space-y-2 text-sm text-base-content/70">${i}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',l=typeof a.id=="string"?a.id:"",u=!!(O&&l&&O===l),g=["data-planner-lesson",l?`data-lesson-id="${l}"`:"",u?'data-planner-selected="true"':""].filter(Boolean).join(" "),y=a.summary?`<p class="text-sm text-base-content/70">${I(a.summary)}</p>`:"",E=Ft(a),A=E?`<span class="badge badge-outline badge-sm text-base-content/70">${I(E)}</span>`:"",C=A?`<div class="mt-2 flex flex-wrap gap-1">${A}</div>`:"",F=typeof a.notes=="string"?a.notes:"",P=Oa(l),M=l?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${l}"
              ${P?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${l}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${I(F)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${I(yn.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",T=l?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${l}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${l}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${g}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${I(a.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${I(a.title||a.dayLabel||"Lesson")}</h2>
                ${y}
                ${C}
              </div>
              <div class="flex flex-wrap items-center justify-end gap-1">
                ${T}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${l}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${l}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${s}
            ${M}
            <div class="flex flex-wrap gap-2">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${l}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${l}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");$.innerHTML=o,ao(O)}function ao(e){O=e||null,$&&$.querySelectorAll("[data-planner-lesson]").forEach(o=>{!!e&&o.getAttribute("data-lesson-id")===e?o.setAttribute("data-planner-selected","true"):o.removeAttribute("data-planner-selected")});let n=(Array.isArray(v?.lessons)?v.lessons:[]).find(r=>r.id===O)||null;oo(n)}function za(){return O&&(Array.isArray(v?.lessons)?v.lessons:[]).some(t=>t.id===O)?O:null}function Ka(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===O||ao(n)}function Ya(e){let t=fn(e?.currentTarget)?e.currentTarget:At;if(!fn(t))return;let n=t.value,r=Mt.has(n)?n:kt;zr(r),fa(r),t.value!==r&&(t.value=r)}function so(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function Ga(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function io(e){if(!e)return;let t=Dt.get(e);if(!t)return;let n=Ga();n&&n(t),Dt.delete(e)}function Oe(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&no.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function _e(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&no.has(t)?t:null,r=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(r instanceof HTMLElement){let o=n||"idle",a=yn[o]||yn.idle;r.textContent=a,r.setAttribute("data-status",o)}}async function hn(e,t,n){if(!e||!S)return;let r=n instanceof HTMLTextAreaElement?n:null;r&&(Oe(r,"saving"),_e(r,"saving"));try{let o=await Xt(S,e,{notes:t});if(o&&(v=o),r){Oe(r,"saved"),_e(r,"saved");let a=so();a?a(()=>{r.getAttribute("data-notes-status")==="saved"&&(Oe(r,null),_e(r,null))},Fa):(Oe(r,null),_e(r,null))}}catch(o){console.error("Failed to save planner notes",o),r&&(Oe(r,"error"),_e(r,"error"))}}function Ja(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;io(n);let r=so();if(!r){hn(n,t.value,t);return}let o=r(()=>{Dt.delete(n),hn(n,t.value,t)},Ba);Dt.set(n,o)}function Xa(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(io(n),hn(n,t.value,t))}function Qa(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let r=t.hasAttribute("open");_a(n,r)}function Te(e){if(!$)return je=null,Promise.resolve();let t=e||Q();S=t,wn(t),Ct("Loading plan\u2026");let n=(async()=>{try{let r=await V(t);r=await Va(r,t),v=r,U(r),q(r,t),K(r)}catch(r){console.error("Failed to load planner week",r),Ct("Unable to load this week's planner.",{tone:"error"})}})();return je=n,n.finally(()=>{je===n&&(je=null)})}async function vn(){if(!$)return;qe||Ht();let e=je;if(!e&&(!v||v.weekId!==S)&&(e=Te(S)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function lo(e,t){if(!e)return;await vn();let n=Array.isArray(v?.lessons)?v.lessons:[];if(!n.length)return;let r=n.find(A=>A?.id===e);if(!r)return;let o=typeof r.dayLabel=="string"&&r.dayLabel.trim()?r.dayLabel.trim():typeof r.dayName=="string"&&r.dayName.trim()?r.dayName.trim():"",a=typeof r.title=="string"&&r.title.trim()?r.title.trim():o||"Lesson",i=typeof r.summary=="string"&&r.summary.trim()?r.summary.trim():"",s=i||a,l=o?`${o} \xB7 ${s}`:s,u=i||"",g=ya(r),y=ha(fr(S,g)),E={reminderTitle:l,reminderNotes:u,dueDate:y,dayLabel:o,lessonTitle:a,summary:i,plannerLessonId:e};en("cue:prepare",{trigger:t,source:"planner"}),en("planner:prefillReminder",E),en("cue:open",{trigger:t,source:"planner"})}async function Za(e,t){if(!e)return;await vn();let r=(Array.isArray(v?.lessons)?v.lessons:[]).find(s=>s?.id===e);if(!r)return;let o=t instanceof HTMLElement?t:null;o&&o.setAttribute("disabled","true");let a=$r("lesson"),i={id:a,dayIndex:r.dayIndex,dayLabel:r.dayLabel,dayName:r.dayName,title:r.title,summary:r.summary,subject:r.subject,notes:r.notes,details:Array.isArray(r.details)?r.details.map(s=>({badge:s?.badge||"",text:s?.text||""})):[]};try{let s=await at(S,i);s&&(v=s,O=a,U(s),q(s,S),K(s),W&&(W.textContent=`Duplicated ${r.title||"lesson"} into this week.`))}catch(s){console.error("Failed to duplicate planner lesson",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}function es(){if(typeof window>"u")return;let e="#resources";window.location.hash!==e&&(window.location.hash=e),typeof window.renderRoute=="function"&&window.renderRoute(),Ae("resources"),W&&(W.textContent="Opening resources to add new materials.")}async function ts(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),r=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":ss(r,t);break;case"edit":is(r,t);break;case"delete":ls(r);break;case"move-up":Br(r,"up",t);break;case"move-down":Br(r,"down",t);break;case"create-reminder":await lo(r,t);break;default:break}}async function ns(e){let t=e.target instanceof Element?e.target.closest("[data-planner-detail-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-detail-action");if(!n)return;let r=ke?.getAttribute("data-lesson-id");switch(n){case"duplicate":r&&await Za(r,t);break;case"reminder":r&&await lo(r,t);break;case"resources":es();break;default:break}}async function co(e){if(typeof document>"u"||!ie)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=v?.lessons?.[0]?.dayLabel||"Monday";ie.openAddLesson({defaultDay:n,trigger:t})}async function rs(e){if(!ie)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=ot(S,1);ie.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function os(e){if(!oe)return;let t=e?.currentTarget instanceof HTMLSelectElement?e.currentTarget:oe,n=t.value?.trim();if(n){t.disabled=!0;try{let r=await Zt(S,n);r&&(v=r,U(r),q(r,S),K(r))}catch(r){console.error("Failed to apply planner template",r),window.alert("Unable to apply that template right now.")}finally{Bt(n)}}}async function as(e){if(e?.preventDefault?.(),!Ur)return;let t=v||await V(S),n=Array.isArray(t?.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let r=typeof window<"u"?window.prompt("Name this template:",t?.templateId||""):null,o=typeof r=="string"?r.trim():"";if(o)try{br(o,{lessons:n}),Bt(o)}catch(a){console.error("Failed to save planner template",a),window.alert("Unable to save that template right now.")}}async function ss(e,t){if(!e||!ie)return;let n=v?.lessons?.find(o=>o.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;ie.openAddDetail({lesson:n,trigger:r})}async function is(e,t){if(!e||!ie)return;let n=v?.lessons?.find(o=>o.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;ie.openEditLesson({lesson:n,trigger:r})}async function Br(e,t,n){if(!e||!t)return;let r=S||Q();if(!r)return;let o=n instanceof HTMLElement?n:null;o&&o.setAttribute("disabled","true");try{let a=await yr(r,e,t);a&&(v=a,U(a),q(a,r),K(a))}catch(a){console.error("Failed to move planner lesson",a),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function ls(e){if(!e||typeof window>"u")return;let t=v?.lessons?.find(r=>r.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let r=await pr(S,e);r&&(v=r,U(r),q(r,S),K(r))}catch(r){console.error("Failed to delete planner lesson",r),window.alert("Unable to delete that lesson right now.")}}function Ht(){if(qe||!$){qe&&Te(S);return}qe=!0,ur({ensureFirestore:Ye}),$.addEventListener("click",Ka),$.addEventListener("click",ts),$.addEventListener("input",Ja),$.addEventListener("focusout",Xa),$.addEventListener("toggle",Qa),la?.addEventListener("click",ns),ia?.addEventListener("click",co),sa?.addEventListener("click",rs),oe?.addEventListener("change",os),$e?.addEventListener("change",Wa),At?.addEventListener("change",Ya),Ur?.addEventListener("click",as),ra?.addEventListener("click",()=>{let e=ot(S,-1);Te(e)}),oa?.addEventListener("click",()=>{let e=ot(S,1);Te(e)}),aa?.addEventListener("click",()=>{Te(Q())}),Bt(st()),Te(S)}function Fr(){typeof window>"u"||_r()==="planner"&&Ht()}function cs(e){let t=e?.detail?.plan;t&&(qe&&t.weekId===S&&(v=t,U(t),wn(t.weekId),K(t)),t.weekId===ze&&q(t,ze))}q(null,ze);typeof document<"u"&&document.addEventListener(Vt,cs);typeof window<"u"&&(window.addEventListener("hashchange",Fr),window.addEventListener("DOMContentLoaded",Fr));var uo="dailyTasksByDate",Lt=null;function Tn(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function ds(e){if(typeof e!="string")return"";let[t,n,r]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),i=Number.parseInt(r,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(i))return e;let s=new Date(o,a-1,i);return Number.isNaN(s.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(s)}function Ke(e){if(!un)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);un.disabled=!t}function ge(e){if(!se)return;if(!Array.isArray(e)||e.length===0){se.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',Ke([]);return}let t=e.map((n,r)=>{let o=I(n?.text||""),a=!!n?.completed,i=`daily-task-${r}`,s=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return a&&s.push("line-through","text-opacity-50"),`
        <label class="flex items-center p-3 border-b border-base-200" data-task-index="${r}" for="${i}">
          <input id="${i}" type="checkbox" class="checkbox checkbox-sm" data-task-index="${r}" ${a?"checked":""} />
          <span class="${s.join(" ")}">${o}</span>
        </label>
      `}).join("");se.innerHTML=t,Ke(e)}function Nt(){xt&&xt.classList.remove("hidden")}function xn(){xt&&xt.classList.add("hidden")}function An(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Ce(e){return Array.isArray(e)?e.map(t=>An(t)):[]}function kn(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(uo);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function fo(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(uo,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Hr(e){let t=kn(),n=t&&typeof t=="object"?t[e]:[];return Ce(n)}function gn(e,t){let n=kn(),r=Ce(t);return n[e]=r,fo(n),r}function Rr(e,t){let n=kn(),r=Ce(n[e]);return r.push(An(t)),n[e]=r,fo(n),r}function Rt(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function In(){return Lt||(Lt=Ye().then(e=>{let{db:t,getCollection:n}=e,r=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),Lt)}function Dn(e,t){let{doc:n,dailyListsCollection:r,db:o}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(o,"dailyLists",t)}async function Cn(){if(!wr||!se)return;let e=Tn(),t=ds(e);wr.textContent=t?`Today's List - ${t}`:"Today's List";let n=!1;if(he){Nt();let r=Hr(e);D=r,ge(r),n=!0}return Et||(n||(se.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',Ke([])),Et=(async()=>{try{let r=await In(),o=Dn(r,e),a=await r.getDoc(o),i=a.exists()?a.data()?.tasks:[];return D=Ce(i),ge(D),gn(e,D),he=!1,xn(),D}catch(r){Rt(r)?(console.warn("Falling back to local daily tasks due to permission issue",r),he=!0,Nt()):console.error("Failed to load daily list",r);let a=Hr(e);return D=a,a.length||n?ge(a):(se.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',D=[],Ke(D)),D}})().finally(()=>{Et=null})),Et}async function us(e){let t=Tn(),n=An(e);try{let r=await In(),o=Dn(r,t),a=await r.getDoc(o);if(a.exists()&&typeof r.arrayUnion=="function")await r.updateDoc(o,{tasks:r.arrayUnion(n)});else{let i=a.exists()?a.data()?.tasks:[],s=Array.isArray(i)?Ce(i):[];s.push(n),typeof r.setDoc=="function"?await r.setDoc(o,{tasks:s},{merge:!0}):await r.updateDoc(o,{tasks:s})}Rr(t,n),he=!1,xn()}catch(r){if(Rt(r)){console.warn("Saving task locally because cloud sync is unavailable",r),he=!0,Nt(),Rr(t,n);return}throw r}}async function mo(e){let t=Tn(),n=Ce(e);try{let r=await In(),o=Dn(r,t);typeof r.setDoc=="function"?await r.setDoc(o,{tasks:n},{merge:!0}):await r.updateDoc(o,{tasks:n}),gn(t,n),he=!1,xn()}catch(r){if(Rt(r)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",r),he=!0,Nt(),gn(t,n);return}throw r}}function po(e){[vt,Tt].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function fs(){!Ue||!We||(Ue.classList.remove("hidden"),We.classList.add("hidden"),po(vt))}function ms(){!Ue||!We||(Ue.classList.add("hidden"),We.classList.remove("hidden"),po(Tt),Cn())}function ps(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),r=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!r.length)return;let o=s=>{n.forEach(l=>{if(!l)return;let u=l.getAttribute("data-dashboard-tab")===s;l.classList.toggle("tab-active",u),l.setAttribute("aria-selected",u?"true":"false")}),r.forEach(l=>{if(!l)return;let u=l.getAttribute("data-dashboard-panel")===s;l.classList.toggle("hidden",!u),l.setAttribute("aria-hidden",u?"false":"true")})},i=(n.find(s=>s.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");i&&o(i),n.forEach(s=>{s.addEventListener("click",()=>{let l=s.getAttribute("data-dashboard-tab");l&&o(l)})})})}window.addEventListener("DOMContentLoaded",ps);vt&&Tt&&Ue&&We&&(vt.addEventListener("click",e=>{e.preventDefault(),fs()}),Tt.addEventListener("click",e=>{e.preventDefault(),ms()}));var _=null,Y=!1,wt=null;function De(e){if(!z)return;z.setAttribute("aria-pressed",e?"true":"false");let t=z.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":z.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function ys(){Y&&(window.clearTimeout(wt),wt=window.setTimeout(()=>{wt=null,Y&&yo(!0)},400))}function yo(e=!1){if(!_)return!1;if(Y&&!e)return!0;try{return _.start(),Y=!0,De(!0),!0}catch{return Y=!1,De(!1),!1}}function Nn(){if(_){Y=!1,window.clearTimeout(wt);try{_.stop()}catch{}De(!1)}}function hs(){if(z)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){z.setAttribute("disabled","true"),z.setAttribute("aria-disabled","true"),z.title="Voice input is not supported in this browser.";return}_=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(_.lang=t,_.interimResults=!1,"continuous"in _)try{_.continuous=!0}catch{}_.onresult=n=>{let r=n?.results?.[0]?.[0]?.transcript||"";if(r&&j){j.value=r.trim();try{j.focus({preventScroll:!0})}catch{j.focus()}try{let o=j.value.length;j.setSelectionRange(o,o)}catch{}}},_.onend=()=>{if(!Y){De(!1);return}ys()},_.onerror=()=>{Y=!1,De(!1)}}catch{_=null,De(!1),z.setAttribute("disabled","true"),z.setAttribute("aria-disabled","true")}}hs();z?.addEventListener("click",()=>{_&&(Y?Nn():yo())});qr?.addEventListener("submit",()=>{Y&&Nn()});window.addEventListener("pagehide",()=>{Y&&Nn()});qr?.addEventListener("submit",async e=>{if(e.preventDefault(),!j)return;let t=j.value.trim();if(!t){j.focus();return}let n={text:t,completed:!1};j.value="",j.focus();try{await us(n),await Cn()}catch(r){console.error("Failed to add task to the daily list",r),j.value=t,j.focus()}});se?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(D)||Number.isNaN(n)||!D[n])return;let r=document.activeElement===t,o=()=>{if(!r)return;let s=se?.querySelector(`input[data-task-index="${n}"]`);if(s instanceof HTMLInputElement)try{s.focus({preventScroll:!0})}catch{s.focus()}},a=D.map(s=>({...s})),i=a.map((s,l)=>l===n?{...s,completed:t.checked}:s);D=i,ge(i),o();try{await mo(i)}catch(s){console.error("Failed to update task completion state",s),D=a,ge(a),o()}});un?.addEventListener("click",async()=>{if(!Array.isArray(D)||D.length===0)return;let e=D.filter(n=>!n.completed);if(e.length===D.length)return;let t=D.map(n=>({...n}));D=e,ge(e);try{await mo(e)}catch(n){console.error("Failed to clear completed tasks",n),D=t,ge(t)}});Ke(D);Cn();function gs(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),r=document.getElementById("noteNewBtn"),o=document.getElementById("notesList"),a=document.querySelector("[data-notes-layout]"),i=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!r)return;let s=null,l=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}},u=()=>a&&a.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",g=f=>{let m=f==="collapsed";i.forEach(b=>{if(!(b instanceof HTMLElement))return;b.setAttribute("aria-expanded",m?"false":"true");let L=b.dataset.notesShelfToggleVariant;L==="primary"?b.textContent=m?"Show saved notes":"Hide saved notes":L==="close"&&(b.textContent=m?"Show":"Close")})},y=f=>{a&&(a.dataset.notesShelfState=f==="collapsed"?"collapsed":"expanded"),g(u())},E=()=>{let f=u()==="collapsed"?"expanded":"collapsed";y(f),f==="collapsed"&&l()};i.length&&(i.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),E()})}),y(u()));let A=f=>{if(!f){s=null,e.value="",t.value="";return}s=f.id,e.value=f.title||"",t.value=f.body||""},C=()=>{if(!o)return;o.querySelectorAll("button[data-note-id]").forEach(m=>{if(!(m instanceof HTMLElement))return;let b=m.getAttribute("data-note-id")===s;m.classList.toggle("bg-base-200/80",b),m.classList.toggle("border-base-300",!b),m.classList.toggle("border-primary",b),m.classList.toggle("font-medium",b),m.setAttribute("aria-current",b?"true":"false")})},F=()=>{let f=Ze();return Array.isArray(f)?[...f].sort((m,b)=>{let L=Date.parse(m?.updatedAt||""),w=Date.parse(b?.updatedAt||"");return(Number.isNaN(w)?0:w)-(Number.isNaN(L)?0:L)}):[]},P=f=>{if(!f)return;let m=Ze();if(!Array.isArray(m))return;let b=m.filter(w=>w.id!==f);if(b.length===m.length)return;$t(b),s===f&&(s=null);let L=M();if(s){let w=L.find(d=>d.id===s)||null;A(w)}else L.length?A(L[0]):A(null);C()},M=(f=F())=>{if(!o)return f;if(o.innerHTML="",!f.length){let m=document.createElement("li");return m.className="text-sm italic text-base-content/60",m.textContent="No saved notes yet.",o.appendChild(m),f}return f.forEach(m=>{let b=document.createElement("li");b.className="flex items-center gap-2";let L=document.createElement("button");L.type="button",L.dataset.noteId=m.id,L.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",L.textContent=m.title||"Untitled note",L.addEventListener("click",()=>{A(m),C(),l()});let w=document.createElement("button");w.type="button",w.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",w.setAttribute("aria-label",`Delete note "${m.title||"Untitled note"}"`),w.textContent="Delete",w.addEventListener("click",d=>{d.stopPropagation(),P(m.id)}),b.appendChild(L),b.appendChild(w),o.appendChild(b)}),C(),f},T=()=>{let f=M();if(!f.length){A(null),C();return}let m=s?f.find(b=>b.id===s):null;A(m||f[0]),C()};n.addEventListener("click",()=>{let f=Ze(),m=Array.isArray(f)?[...f]:[],b=typeof e.value=="string"?e.value.trim():"",L=typeof t.value=="string"?t.value:"",w=b||"Untitled note",d=new Date().toISOString();if(s){let k=m.findIndex(H=>H.id===s);if(k>=0)m[k]={...m[k],title:w,body:L,updatedAt:d};else{let H=_t(w,L,{updatedAt:d});s=H.id,m.unshift(H)}}else{let k=_t(w,L);s=k.id,m.unshift(k)}$t(m);let h=M(),N=s?h.find(k=>k.id===s):null;A(N||null),C()}),r.addEventListener("click",()=>{s=null,e.value="",t.value="",C(),l()}),T()}gs();var ho="theme",bs="professional",bn="memoryCue:theme-change",Es="professional",En=document.getElementById("theme-menu"),go="[data-theme-name],[data-theme-option]",Ls=new Set(["dark","dracula","synthwave"]);function le(e){return typeof e=="string"?e.trim():""}function bo(e){return e instanceof HTMLElement?le(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Ss(e){let t=le(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Ls.has(t)))}function Or(e){let t=le(e);if(t)try{localStorage.setItem(ho,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Eo(e){if(!En)return;let t=le(e);En.querySelectorAll(go).forEach(r=>{if(!(r instanceof HTMLElement))return;let o=bo(r),a=t&&o===t;r.setAttribute("aria-checked",a?"true":"false"),r.classList.toggle("active",a)})}function ws(e){let t=le(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(bn,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let r=document.createEvent("CustomEvent");r.initCustomEvent(bn,!0,!0,{theme:t}),window.dispatchEvent(r)}}}function Ln(e,{persist:t=!0,notify:n=!0}={}){let r=le(e);if(!r)return;le(document.documentElement.getAttribute("data-theme"))!==r&&Ss(r),t&&Or(r),Eo(r),n&&ws(r)}function vs(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){Ln(Es,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(ho)||""}catch(r){console.warn("Unable to load theme preference",r)}let n=t||document.documentElement.getAttribute("data-theme")||bs;n&&Ln(n,{persist:!1,notify:!0})}En?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(go):null;if(!t)return;e.preventDefault();let n=bo(t);n&&Ln(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(bn,e=>{let t=le(e?.detail?.theme);t&&Eo(t)});vs()});export default Ts();
