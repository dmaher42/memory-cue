import{a as bn,b as nr,c as Ue,d as or,f as gt,g as je,h as bt,i as rr,j as En,k as sr}from"./chunk-6FVLAECD.js";import{a as gn,b as tr}from"./chunk-MG4MJA24.js";import"./chunk-CTK42JWW.js";import{b as ht,c as er}from"./chunk-GUVSRPRW.js";function Sn(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let r of o){if(typeof r!="string"||!r)continue;let s=t.getElementById(r);if(s)return{key:n,element:s}}return null}).filter(n=>!!(n&&n.element))}function pe(e,t){if(!e||typeof e!="object")return"";let n=ar[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let r=e[o];return r==null?"":typeof r=="string"?r:String(r)}return""}function ir(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function lr(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Ln(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let r=e&&typeof e=="object"?pe(e,n):"";ir(o,r)})}function vn(e,t,n,o){Array.isArray(e)&&e.forEach(({element:r})=>{r instanceof HTMLInputElement?["checkbox","radio"].includes(r.type)?r.checked=!1:r.value="":(r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement)&&(r.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function Tn(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let r=lr(o);if(typeof r=="boolean"){t[n]=r;return}let s=typeof r=="string"?r.trim():r;t[n]=s??""}),t}function B(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var wn,ar,Et,wt,xn=ht(()=>{wn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],ar={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Et="Create Cue",wt="Edit Cue"});function An(e){return new St(e)}var cr,dr,St,kn=ht(()=>{cr=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),dr={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},St=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...dr,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let o=n[0],r=n[n.length-1],s=document.activeElement;t.shiftKey&&s===o?(t.preventDefault(),r.focus()):!t.shiftKey&&s===r&&(t.preventDefault(),o.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(cr)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let o=this.events[t];if(!o||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let r=new CustomEvent(o,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(r)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var In,vt,Lt,Tt,ur,fr,Cn,Dn,mr,Nn,Ke,pr,Bn,xt,se,yr,Mn,xe,Pn,hr,Fn,At,Ve,Te,We,ye,Hn,ae,Rn,On,ze,gr,ve,ie,_n,te,Ae,$n,kt,qn,K,It,Ct,Un,jn,Dt,Nt,Wn,Vn=ht(()=>{In="memoryCue:plannerPlans",vt="memoryCue:plannerUpdated",Lt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Tt=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},ur=e=>{if(!Tt()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},fr=e=>{try{return JSON.parse(e)}catch{return null}},Cn=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Dn=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,mr=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),o=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t},Nn=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`},Ke=e=>{if(typeof e!="string")return null;let[t,n,o]=e.split("-"),r=Number.parseInt(t,10),s=Number.parseInt(n,10),i=Number.parseInt(o,10);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(i))return null;let a=new Date(r,s-1,i);return Number.isNaN(a.getTime())?null:(a.setHours(0,0,0,0),a)},pr=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=Lt.findIndex(o=>o.toLowerCase()===t);return n>=0?n:0},Bn=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:Cn(),badge:n,text:t}},xt=(e,t={})=>{let n=typeof t=="object"&&t?t:{},o=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:pr(e?.dayName||n.dayName||n.dayLabel),r=Dn(o),s=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():Lt[r],i=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",c=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(x=>Bn(x)).filter(Boolean),u=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:Cn(),g=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,y=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",E=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"";return{id:u,dayIndex:r,dayLabel:Lt[r]||"Lesson",title:s,summary:i,details:c,notes:y,subject:E,position:Number.isFinite(g)?g:null}},se=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let o=Number.isFinite(t.position),r=Number.isFinite(n.position);return o&&r&&t.position!==n.position?t.position-n.position:o&&!r?-1:!o&&r?1:t.title.localeCompare(n.title)}),yr=e=>{let t=new Map;return e.forEach(n=>{let o=String(n.dayIndex),r=t.get(o)??0;Number.isFinite(n.position)?t.set(o,Math.max(r,n.position+1)):(n.position=r,t.set(o,r+1))}),e},Mn=(e,t,n)=>{let o=e.filter(r=>!(r.dayIndex!==t||n&&r.id===n));return o.length?o.reduce((r,s)=>Number.isFinite(s.position)?Math.max(r,s.position):r,-1)+1:0},xe=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,o=Ke(n),r=Array.isArray(e?.lessons)?yr(e.lessons.map(s=>xt(s)).filter(Boolean)):[];return{weekId:n,startDate:o?o.toISOString():"",lessons:se(r),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString()}},Pn=()=>{if(!Tt())return{};try{let e=ur(In);if(typeof e!="string"||!e.length)return{};let t=fr(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},hr=e=>{if(Tt())try{window.localStorage.setItem(In,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},Fn=e=>{if(!e)return null;let n=Pn()[e];return n?xe(n,e):null},At=(e,t)=>{if(!e||!t)return t;let n=Pn();return n[e]=t,hr(n),t},Ve=new Map,Te=null,We=null,ye=!1,Hn=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},ae=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(vt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},Rn=async()=>Te?We||(We=Te().then(e=>{let{db:t,getCollection:n}=e||{},o=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),We):null,On=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:o,db:r}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(r,"plannerPlans",t)},ze=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Ve.set(e.weekId,e),e),gr=e=>xe({weekId:e,lessons:[]},e),ve=e=>{let t=Fn(e);if(t)return ze(t),t;let n=gr(e);return At(e,n),ze(n),n},ie=async e=>{if(!e?.weekId)return e;let t=xe(e,e.weekId);if(At(t.weekId,t),ze(t),ye||!Te)return t;try{let n=await Rn();if(!n)return t;let o=On(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(o,t,{merge:!0}):await n.updateDoc(o,t),t}catch(n){return Hn(n)?(console.warn("Persisting planner data locally due to permission issue",n),ye=!0,t):(console.error("Failed to persist planner plan",n),t)}},_n=(e={})=>{typeof e.ensureFirestore=="function"&&(Te=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(ye=e.forceLocal)},te=(e=new Date)=>{let t=mr(e);return Nn(t)},Ae=(e,t=0)=>{let n=Ke(e);if(!n||!Number.isFinite(t))return e;let o=new Date(n);return o.setDate(n.getDate()+t*7),Nn(o)},$n=(e=te(),t=0)=>{let n=Ke(e);if(!n)return null;let o=Number.isFinite(t)?t:0,r=Dn(o),s=new Date(n);return s.setDate(n.getDate()+r),s},kt=(e,{short:t=!1}={})=>{let n=Ke(e);if(!n)return"";let o=new Date(n);o.setDate(n.getDate()+6);let r=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),s=r.format(n),i=r.format(o),a=n.getFullYear()===o.getFullYear();if(t)return`Week of ${s}`;let c=a?n.getFullYear():`${n.getFullYear()} \u2013 ${o.getFullYear()}`;return`${s} \u2013 ${i}, ${c}`},qn=(e=te())=>{if(!e)return[];let t=Ve.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=Fn(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},K=async(e=te())=>{if(!e)return null;if(Ve.has(e))return Ve.get(e);if(ye||!Te)return ve(e);try{let t=await Rn();if(!t)return ve(e);let n=On(t,e),o=await t.getDoc(n);if(o.exists()){let s=o.data(),i=xe({...s,weekId:e},e);return At(e,i),ze(i),ye=!1,i}let r=ve(e);return typeof t.setDoc=="function"&&await t.setDoc(n,r,{merge:!0}),r}catch(t){return Hn(t)?(console.warn("Falling back to local planner data due to permission issue",t),ye=!0,ve(e)):(console.error("Failed to load planner data",t),ve(e))}},It=async(e,t)=>{if(!e)return null;let n=await K(e),o=xt(t);o.position=Mn(n?.lessons||[],o.dayIndex);let r={...n,lessons:se([...n?.lessons||[],o]),updatedAt:new Date().toISOString()},s=await ie(r);return ae(s),s},Ct=async(e,t,n={})=>{if(!e||!t)return null;let o=await K(e),r=[...o?.lessons||[]],s=r.findIndex(g=>g.id===t);if(s===-1)return o;let i=r[s],a=xt({...i,...n,id:t},i);if(a.dayIndex!==i.dayIndex){let g=r.filter((y,E)=>E!==s);a.position=Mn(g,a.dayIndex)}r[s]=a;let c={...o,lessons:se(r),updatedAt:new Date().toISOString()},u=await ie(c);return ae(u),u},Un=async(e,t)=>{if(!e||!t)return null;let n=await K(e),o=(n?.lessons||[]).filter(i=>i.id!==t),r={...n,lessons:se(o),updatedAt:new Date().toISOString()},s=await ie(r);return ae(s),s},jn=async(e,t,n)=>{if(!e||!t||!n)return null;let o=n==="up"?-1:n==="down"?1:0;if(!o)return K(e);let r=await K(e),s=[...r?.lessons||[]],i=s.findIndex(v=>v.id===t);if(i===-1)return r;let a=s[i],c=s.filter(v=>v.dayIndex===a.dayIndex);if(c.length<=1)return r;let g=se(c).map(v=>v.id),y=g.indexOf(t);if(y===-1)return r;let E=y+o;if(E<0||E>=g.length)return r;let[x]=g.splice(y,1);g.splice(E,0,x);let C=new Map(g.map((v,f)=>[v,f])),F=s.map(v=>{if(v.dayIndex!==a.dayIndex)return v;let f=C.get(v.id);return typeof f=="number"?{...v,position:f}:v}),M={...r,lessons:se(F),updatedAt:new Date().toISOString()},N=await ie(M);return ae(N),N},Dt=async(e,t,n)=>{if(!e||!t)return null;let o=await K(e),r=[...o?.lessons||[]],s=r.findIndex(y=>y.id===t);if(s===-1)return o;let i=Bn(n);if(!i)return o;let a=r[s],c={...a,details:[...a.details||[],i]};r[s]=c;let u={...o,lessons:se(r),updatedAt:new Date().toISOString()},g=await ie(u);return ae(g),g},Nt=async(e,t)=>{if(!e||!t)return null;let o=((await K(e))?.lessons||[]).map(i=>({title:i.title,summary:i.summary,dayIndex:i.dayIndex,notes:typeof i.notes=="string"?i.notes:"",subject:typeof i.subject=="string"?i.subject:"",details:(i.details||[]).map(a=>({badge:a.badge,text:a.text}))})),r=xe({weekId:t,lessons:o},t);r.updatedAt=new Date().toISOString();let s=await ie(r);return ae(s),s},Wn=async e=>{if(!e)return null;let t=await K(e);if(!t)return null;let n={...t,lessons:[],updatedAt:new Date().toISOString()},o=await ie(n);return ae(o),o}});var Ks=er(()=>{tr();or();xn();kn();nr();rr();sr();Vn();gn();function br(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let o=document.querySelectorAll("[data-open-reminder-modal]");if(!o.length)return;if(!e){let d=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};o.forEach(h=>{h.addEventListener("click",D=>{if(D.preventDefault(),typeof window<"u"){let A="#reminders";window.location.hash!==A&&(window.location.hash=A),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{d()})})});return}let r=e.querySelector("[data-reminder-modal-backdrop]"),s=e.querySelectorAll("[data-close-modal]"),i=document.getElementById("mainContent"),a=document.querySelector('nav[aria-label="Primary"]'),c=[i,a],u=e.querySelector('[role="dialog"]')??e,g=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],y=null,E=()=>{if(!(u instanceof HTMLElement))return[];let d=u.querySelectorAll(g.join(","));return Array.from(d).filter(h=>{let D=h instanceof HTMLElement,A=typeof SVGElement<"u"&&h instanceof SVGElement;if(!D&&!A||h.getAttribute("aria-hidden")==="true"||"disabled"in h&&h.disabled||h.hidden||h.closest("[hidden]"))return!1;let H=h.getBoundingClientRect();return H.width>0&&H.height>0})},x=()=>{let d=E(),h=d.find(D=>D.hasAttribute("data-autofocus")||D.hasAttribute("autofocus"))||(n&&d.includes(n)?n:null)||d[0];if(h&&typeof h.focus=="function"){h.focus({preventScroll:!0});return}u instanceof HTMLElement&&typeof u.focus=="function"&&u.focus({preventScroll:!0})},C=d=>{u instanceof HTMLElement&&(!(d.target instanceof Node)||!u.contains(d.target))&&(d.stopPropagation(),x())},F=d=>{if(d.key!=="Tab")return;let h=E();if(!h.length){d.preventDefault(),u instanceof HTMLElement&&u.focus({preventScroll:!0});return}let D=h[0],A=h[h.length-1],H=document.activeElement;if(d.shiftKey){(!u.contains(H)||H===D)&&(d.preventDefault(),A.focus());return}(!u.contains(H)||H===A)&&(d.preventDefault(),D.focus())},M=d=>{c.forEach(h=>{h&&(d?h.setAttribute("inert",""):h.removeAttribute("inert"))})},N=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),M(!1),document.removeEventListener("keydown",v,!0),e.removeEventListener("keydown",F,!0),e.removeEventListener("focusin",C,!0),y&&typeof y.focus=="function"&&y.focus(),y=null},v=d=>{d.key==="Escape"&&(d.preventDefault(),N())},f=({triggerElement:d}={})=>{d&&typeof d.focus=="function"?y=d:y=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),M(!0),document.addEventListener("keydown",v,!0),e.addEventListener("keydown",F,!0),e.addEventListener("focusin",C,!0),window.requestAnimationFrame(()=>{x()})},m=(d,h={})=>{try{document.dispatchEvent(new CustomEvent(d,{detail:h}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let D=document.createEvent("CustomEvent");D.initCustomEvent(d,!0,!0,h),document.dispatchEvent(D)}}},b=(d={})=>{m("cue:cancelled",d)};o.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault();let A={trigger:h.currentTarget instanceof HTMLElement?h.currentTarget:null,mode:"create"};m("cue:prepare",A),m("cue:open",A)})}),s.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault(),b({trigger:d,reason:"button"})})}),e.addEventListener("click",d=>{d.target===e&&b({reason:"backdrop"})}),r?.addEventListener("click",d=>{d.target===r&&b({reason:"backdrop"})}),document.addEventListener("cue:open",d=>{let h=d?.detail?.trigger,D=h instanceof HTMLElement?h:null;f({triggerElement:D})});let S=()=>{N()};document.addEventListener("cue:close",S),document.addEventListener("cue:cancelled",S);let L=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&L instanceof HTMLElement&&t.addEventListener("submit",d=>{d.preventDefault(),!L.matches(":disabled")&&L.click()}),L instanceof HTMLElement&&document.addEventListener("reminder:save",d=>{let h=d?.detail?.trigger;h&&h!==L||L.matches(":disabled")||L.click()})}br();function Bt(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var zn=null;function Er(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function ho(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function wr(e){typeof document>"u"||!e||(window.clearTimeout(zn),zn=window.setTimeout(()=>{let t=Er(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function De(e){let t=e||ho();t&&wr(t)}function Sr(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{De()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{if(!(o.currentTarget instanceof HTMLAnchorElement))return;let r=o.currentTarget.getAttribute("href")||"";if(!r.startsWith("#"))return;o.preventDefault();let s=r||"#dashboard",i=s.replace("#","")||"dashboard";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),De(i)})}),typeof window.renderRoute=="function"&&window.renderRoute(),De()}Sr();var Kn=document.getElementById("settings-save-button"),Ye=document.getElementById("settings-save-confirmation"),j=document.getElementById("live-status"),Mt=null,le=document.getElementById("resourcePlannerStatus"),Pt=null;document.addEventListener("planner:reminderCreated",e=>{if(!j)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",o=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",r=o?`Reminder saved for ${o}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";j.textContent=r});Kn&&Ye&&Kn.addEventListener("click",e=>{e.preventDefault(),Ye.classList.remove("hidden"),Ye.textContent="Settings saved!",j&&(j.textContent="Settings saved!"),Mt&&window.clearTimeout(Mt),Mt=window.setTimeout(()=>{Ye.classList.add("hidden")},3e3)});function Lr(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),De(t),j&&(j.textContent="Opening planner to add a new lesson."),pt(),window.requestAnimationFrame(()=>{let o=Oo();o&&typeof o.catch=="function"&&o.catch(r=>{console.error("Planner quick action failed to start new lesson flow",r)})})}function vr(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Lr)})}vr();function Ft(e,{tone:t="success"}={}){le&&(le.textContent=e,le.classList.remove("hidden"),le.classList.remove("text-success","text-error"),le.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(Pt&&window.clearTimeout(Pt),Pt=window.setTimeout(()=>{le.classList.add("hidden"),le.textContent=""},4e3))),j&&(j.textContent=e)}function Tr(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function xr(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let o=n.getAttribute("data-resource-title")?.trim(),r=n.getAttribute("data-resource-link")?.trim();if(!o||!r)return;let s="#planner";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),De("planner"),pt(),await Ro();let i=`${o} \u2014 ${r}`,a=gs(),c=null;try{if(a)c=await Dt(w,a,{badge:"Resource",text:i});else{let u=Tr("lesson"),g=k?.lessons?.[0]?.dayLabel||"Monday";c=await It(w,{id:u,dayName:g,title:o,summary:`Resource link: ${r}`,details:[{badge:"Resource",text:i}]}),c&&(R=u)}if(c){k=c,V(c),U(c,w);let u=a?`Added "${o}" to your selected lesson.`:`Created a lesson for "${o}" in this week's planner.`;Ft(u);return}Ft("Unable to save that resource to the planner right now.",{tone:"error"})}catch(u){console.error("Failed to save resource to planner",u),Ft("Unable to save that resource to the planner right now.",{tone:"error"})}}function Ar(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",xr)})}Ar();var go=document.getElementById("reminder-title"),kr=document.getElementById("reminderText"),G=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),o=e.querySelector(".modal-backdrop button"),r=document.getElementById("modal-title");return An({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:o instanceof HTMLElement?o:null,titleInput:go,modalTitle:r instanceof HTMLElement?r:null,defaultTitle:Et,editTitle:wt})})();G?.setEditMode(!1);var Ir=()=>{let e=!!go;if(!!kr)return Ue({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?Ue(n):Ue({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Ir().catch(e=>{console.error("Failed to initialise reminders",e)});var qt=En(),Ht=bn({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{qt?.handleSessionChange(e)}});if(Ht?.supabase){qt?.setSupabaseClient(Ht.supabase);try{Ht.supabase.auth.getSession().then(({data:e})=>{qt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var J=document.getElementById("cues-list"),Rt=document.getElementById("pinnedNotesCard"),ge=document.getElementById("pinnedNotesList"),fe=document.getElementById("cue-form"),Y=fe?.querySelector("#cue-id-input"),Cr=G?.defaultTitle||G?.modalTitle?.textContent?.trim()||Et,sa=G?.editTitle||wt,ot=document.getElementById("tab-cues"),rt=document.getElementById("tab-daily"),Be=document.getElementById("cues-view"),Me=document.getElementById("daily-list-view"),Yn=document.getElementById("daily-list-header"),bo=document.getElementById("quick-add-form"),q=document.getElementById("quick-add-input"),W=document.getElementById("daily-voice-btn"),ne=document.getElementById("daily-tasks-container"),Ut=document.getElementById("clear-completed-btn"),st=document.getElementById("daily-list-permission-notice"),$=document.getElementById("plannerCards")||document.getElementById("planner-grid"),Gn=document.getElementById("plannerWeekRange"),Dr=document.getElementById("planner-prev"),Nr=document.getElementById("planner-next"),Br=document.getElementById("planner-today"),Mr=document.getElementById("planner-copy-week"),Pr=document.getElementById("planner-clear-week"),Fr=document.getElementById("planner-duplicate-btn"),Hr=document.getElementById("planner-new-lesson-btn"),at=document.querySelector("[data-planner-text-size]"),Ot=document.querySelector("[data-planner-card-panel]"),Xn=document.getElementById("plannerSummaryCount"),it=document.getElementById("plannerSummaryRange"),Qn=document.getElementById("plannerInsightsLessons"),Zn=document.getElementById("plannerInsightsSubjects"),Jn=document.getElementById("plannerInsightsNotes"),Ge=document.querySelector("[data-mobile-notes-text-size]"),_t=document.querySelector(".mobile-panel--notes"),Eo="plannerTextSizePreference",lt="default",ft=new Set(["small","default","large"]),Rr=["planner-text-small","planner-text-default","planner-text-large"],wo="mobileNotesTextSizePreference",ct="default",mt=new Set(["small","default","large"]),Or=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function jt(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function _r(){if(typeof localStorage>"u")return lt;let e=localStorage.getItem(Eo);return e&&ft.has(e)?e:lt}function $r(e){typeof localStorage>"u"||!ft.has(e)||localStorage.setItem(Eo,e)}function So(e){if(!Ot)return;let t=ft.has(e)?e:lt;Rr.forEach(n=>Ot.classList.remove(n)),Ot.classList.add(`planner-text-${t}`)}var Lo=_r();So(Lo);jt(at)&&(at.value=Lo);function vo(){if(typeof localStorage>"u")return ct;let e=localStorage.getItem(wo);return e&&mt.has(e)?e:ct}function qr(e){typeof localStorage>"u"||!mt.has(e)||localStorage.setItem(wo,e)}function To(e){if(!_t)return;let t=mt.has(e)?e:ct;Or.forEach(n=>_t.classList.remove(n)),_t.classList.add(`mobile-panel--notes-size-${t}`)}var xo=vo();To(xo);Ge instanceof HTMLSelectElement&&(Ge.value=xo,Ge.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:ct;if(!mt.has(t)){Ge.value=vo();return}qr(t),To(t)}));var Ur=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function jr(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=Ur.findIndex(o=>o.toLowerCase()===t.toLowerCase());return n>=0?n:0}function Wr(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function Vr(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),o=document.getElementById("planner-modal-description"),r=document.getElementById("planner-modal-error"),s=document.getElementById("planner-modal-submit"),i=document.getElementById("planner-lesson-day"),a=document.getElementById("planner-lesson-title"),c=document.getElementById("planner-lesson-summary"),u=document.getElementById("planner-lesson-subject"),g=document.getElementById("planner-detail-badge"),y=document.getElementById("planner-detail-text"),E=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(s instanceof HTMLElement)||!(i instanceof HTMLSelectElement)||!(a instanceof HTMLInputElement)||!(c instanceof HTMLTextAreaElement))return null;let x=t.querySelector("[data-planner-lesson-section]"),C=t.querySelector("[data-planner-summary-section]"),F=t.querySelector("[data-planner-detail-section]"),M=t.querySelector("[data-planner-duplicate-section]"),N=e.querySelector("[data-planner-modal-dialog]"),v=e.querySelector("[data-planner-modal-backdrop]"),f=e.querySelectorAll("[data-planner-modal-close]"),m=document.getElementById("mainContent"),b=document.querySelector('nav[aria-label="Primary"]'),S=(()=>{let l=[],p=e.parentElement;return b instanceof HTMLElement&&l.push(b),p instanceof HTMLElement?l.push(...Array.from(p.children).filter(T=>T instanceof HTMLElement&&T!==e)):m instanceof HTMLElement&&(m.contains(e)?l.push(...Array.from(m.children).filter(T=>T instanceof HTMLElement&&!T.contains(e))):l.push(m)),l})(),L=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],d={mode:"add",lessonId:null,trigger:null},h=null,D=null,A=l=>{h=l instanceof HTMLElement?l:null},H=l=>{S.forEach(p=>{p&&(l?p.setAttribute("inert",""):p.removeAttribute("inert"))})},dn=()=>{if(!(N instanceof HTMLElement))return[];let l=N.querySelectorAll(L.join(","));return Array.from(l).filter(p=>{if(p.closest('[aria-hidden="true"]')||"disabled"in p&&p.disabled)return!1;let T=p.getBoundingClientRect();return T.width>0&&T.height>0})},un=()=>{let l=dn(),p=(h&&l.includes(h)?h:null)||l[0]||N;p&&typeof p.focus=="function"&&p.focus({preventScroll:!0})},fn=l=>{N instanceof HTMLElement&&(N.contains(l.target)||un())},Yo=l=>{if(l.key!=="Tab")return;let p=dn();if(!p.length){l.preventDefault();return}let T=p[0],Le=p[p.length-1];if(l.shiftKey&&document.activeElement===T){l.preventDefault(),Le.focus();return}!l.shiftKey&&document.activeElement===Le&&(l.preventDefault(),T.focus())},mn=l=>{if(l.key==="Escape"){l.preventDefault(),X();return}Yo(l)},pn=()=>{r&&(r.textContent="",r.classList.add("hidden"),r.setAttribute("aria-hidden","true"))},ee=l=>{r&&(r.textContent=l,r.classList.remove("hidden"),r.removeAttribute("aria-hidden"))},yn=l=>{s.disabled=!!l,s.classList.toggle("loading",!!l)},P=(l,p)=>{l instanceof HTMLElement&&(l.classList.toggle("hidden",!p),p?l.removeAttribute("aria-hidden"):l.setAttribute("aria-hidden","true"))},Re=l=>{[i,a,c,u].forEach(p=>{p instanceof HTMLElement&&(p.disabled=!!l,p.classList.toggle("opacity-60",!!l),p.classList.toggle("cursor-not-allowed",!!l))})},Se=()=>{t.reset(),pn(),A(null),Re(!1),u instanceof HTMLInputElement&&(u.value=""),g instanceof HTMLInputElement&&(g.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),E instanceof HTMLInputElement&&(E.value="")},Oe=({title:l,description:p,action:T})=>{n&&(n.textContent=l||"Plan lesson"),o&&(o.textContent=p||""),s.textContent=T||"Save lesson"},_e=({trigger:l}={})=>{d.trigger=l instanceof HTMLElement?l:null,D=d.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),H(!0),document.addEventListener("keydown",mn,!0),e.addEventListener("focusin",fn,!0),window.requestAnimationFrame(()=>{un()})},X=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),H(!1),document.removeEventListener("keydown",mn,!0),e.removeEventListener("focusin",fn,!0);let l=d.trigger||D;d.mode="add",d.lessonId=null,d.trigger=null,A(null),Se(),l&&typeof l.focus=="function"&&l.focus({preventScroll:!0})},Go=({defaultDay:l="Monday",trigger:p}={})=>{d.mode="add",d.lessonId=null,Se(),P(x,!0),P(C,!0),P(F,!1),P(M,!1),Re(!1);let T=typeof l=="string"&&l.trim()?l.trim():"Monday";i.value=T,i.value!==T&&(i.value="Monday"),a.value=T?`${T} lesson`:"",c.value="",u instanceof HTMLInputElement&&(u.value=""),Oe({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),A(a),_e({trigger:p})},Xo=({lesson:l,trigger:p}={})=>{if(!l)return;d.mode="edit",d.lessonId=l.id,Se(),P(x,!0),P(C,!0),P(F,!1),P(M,!1),Re(!1);let T=l.dayLabel||l.dayName||"Monday";i.value=T,i.value!==T&&(i.value="Monday"),a.value=l.title||"",c.value=l.summary||"",u instanceof HTMLInputElement&&(u.value=l.subject||""),Oe({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),A(a),_e({trigger:p})},Qo=({lesson:l,trigger:p}={})=>{if(!l)return;d.mode="detail",d.lessonId=l.id,Se(),P(x,!0),P(C,!0),P(F,!0),P(M,!1),Re(!0);let T=l.dayLabel||l.dayName||"Monday";i.value=T,i.value!==T&&(i.value="Monday"),a.value=l.title||"",c.value=l.summary||"",u instanceof HTMLInputElement&&(u.value=l.subject||""),g instanceof HTMLInputElement&&(g.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),Oe({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),A(y instanceof HTMLElement?y:null),_e({trigger:p})},Zo=({suggestedWeekId:l="",trigger:p}={})=>{d.mode="duplicate",d.lessonId=null,Se(),P(x,!1),P(C,!1),P(F,!1),P(M,!0),E instanceof HTMLInputElement&&(E.value=l),Oe({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),A(E instanceof HTMLElement?E:null),_e({trigger:p})},Jo=async l=>{l.preventDefault(),pn(),yn(!0);try{if(d.mode==="duplicate"){let O=E?.value?.trim();if(!O){ee("Enter the Monday date for the destination week.");return}if(O===w){ee("Choose a different week to duplicate into.");return}let me=await Nt(w,O);me&&(w=O,en(O),k=me,V(me),U(me,O),X());return}if(d.mode==="detail"){if(!d.lessonId){ee("Select a lesson before adding details.");return}let O=y?.value?.trim();if(!O){ee("Add text for this detail.");return}let me=g?.value?.trim()||"",qe=await Dt(w,d.lessonId,{badge:me,text:O});qe&&(k=qe,V(qe),U(qe,w),X());return}let p=i.value.trim(),T=a.value.trim(),Le=c.value.trim(),hn=u?.value?.trim()||"";if(!p){ee("Choose a day for this lesson.");return}if(!T){ee("Enter a lesson title.");return}if(d.mode==="edit"){if(!d.lessonId){ee("Select a lesson to edit.");return}let O=await Ct(w,d.lessonId,{dayName:p,title:T,summary:Le,subject:hn});O&&(k=O,V(O),U(O,w),X());return}let $e=await It(w,{dayName:p,title:T,summary:Le,subject:hn});$e&&(k=$e,V($e),U($e,w),X())}catch(p){console.error("Failed to save planner change",p),ee("Unable to save changes right now. Please try again.")}finally{yn(!1)}};return t.addEventListener("submit",Jo),f.forEach(l=>{l.addEventListener("click",p=>{p.preventDefault(),X()})}),e.addEventListener("click",l=>{l.target===e&&X()}),v?.addEventListener("click",l=>{l.target===v&&X()}),{openAddLesson:Go,openEditLesson:Xo,openAddDetail:Qo,openDuplicatePlan:Zo,close:X}}var eo=document.getElementById("remindersCount"),oe=typeof document<"u"?Vr():null,to=document.getElementById("plannerCount"),no=document.getElementById("plannerSubtitle"),aa=document.getElementById("resourcesCount"),ia=document.getElementById("templatesCount"),Xe=document.getElementById("dailySnapshotList"),Qe=document.getElementById("todaysFocusList"),Q=document.getElementById("weekAtAGlanceList"),Z=null;Q&&(Z=document.createElement("li"),Z.dataset.emptyState="week",Z.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",Z.textContent="No upcoming events this week.");var oo=()=>{if(!Q||!Z)return;Q.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?Q.contains(Z)||Q.appendChild(Z):Q.contains(Z)&&Q.removeChild(Z)};Q&&(oo(),new MutationObserver(oo).observe(Q,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var $t=e=>{Rt&&(e?Rt.classList.remove("hidden"):Rt.classList.add("hidden"))},Pe={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},ro=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),so=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),tt=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",Jt=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},zr=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Ao=e=>{if(!e)return"";if(ro)try{return ro.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},Kr=e=>{if(!e)return"";if(so)try{return so.format(e)}catch{}return e.toLocaleDateString()},ko=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Pe,t)?t:"medium"},ao=e=>{let t=ko(e);return Pe[t]?.rank??Pe.medium.rank},Yr=e=>{let t=ko(e);return Pe[t]??Pe.medium},io=e=>{let t=Jt(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Io(e=[]){if(!Xe)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(o=>({reminder:o,date:Jt(o)})).filter(({date:o})=>o&&zr(o,t)).sort((o,r)=>o.date.getTime()-r.date.getTime());if(!n.length){Xe.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Xe.innerHTML="",n.forEach(({reminder:o,date:r})=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=tt(o),s.appendChild(i);let a=Ao(r),c=document.createElement("p");c.className="text-xs text-base-content/70",c.textContent=a?`Due ${a}`:"Due today",s.appendChild(c),Xe.appendChild(s)})}function Co(e=[]){if(!Qe)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,o)=>{let r=ao(n)-ao(o);if(r!==0)return r;let s=io(n)-io(o);return s!==0?s:tt(n).localeCompare(tt(o),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){Qe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}Qe.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let r=document.createElement("div");r.className="flex items-center justify-between gap-3";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=tt(n),r.appendChild(s);let i=Yr(n),a=document.createElement("span");a.className=i.badgeClass,a.textContent=i.badgeLabel,r.appendChild(a),o.appendChild(r);let c=Jt(n),u=document.createElement("p");if(u.className="text-xs text-base-content/70",c){let g=Ao(c),y=Kr(c),E=[];g&&E.push(`Due ${g}`),y&&E.push(y),u.textContent=E.length?E.join(" \u2022 "):"Due soon"}else u.textContent="No due date";o.appendChild(u),Qe.appendChild(o)})}var Gr=e=>{if(!eo)return;let t=Array.isArray(e)?e.length:0;eo.textContent=String(t)},Xr=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Gr(t),Io(t),Co(t)};document.addEventListener("memoryCue:remindersUpdated",Xr);Io();Co();var Wt=Sn(wn),Qr={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},Ze=null,Zr=3,lo=120;function Jr(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=lo?t:`${t.slice(0,lo-1)}\u2026`:""}function es(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let o=n.trim().toLowerCase();return o==="true"||o==="1"||o==="yes"}return!1})}function co(e){if(!ge)return;let t=Array.isArray(e)?e:[];if(!t.length){ge.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',$t(!1);return}let n=t.filter(s=>es(s));if(!n.length){ge.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',$t(!1);return}$t(!0);let r=n.slice(0,Zr).map(s=>{let i=B(pe(s,"title")||"Untitled Cue"),a=pe(s,"details"),c=B(Jr(a)),u=c?`<p class="mt-1 text-sm text-base-content/70">${c}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${i}</p>
          ${u}
        </li>
      `}).join("");ge.innerHTML=r}function Vt(e,{tone:t="muted"}={}){if(!J)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),J.innerHTML=`<p class="${n.join(" ")}">${B(e)}</p>`}function ts(e){if(!J)return;if(!Array.isArray(e)||e.length===0){Vt("No cues yet.");return}let t=e.map(n=>{let o=B(pe(n,"title")||"Untitled Cue"),r=B(pe(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${r?`<p>${r}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${B(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${B(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");J.innerHTML=t}async function He(){return Ze||(Ze=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:r,collection:s,doc:i,getDoc:a,addDoc:c,updateDoc:u,getDocs:g,query:y,orderBy:E,serverTimestamp:x,setDoc:C,arrayUnion:F}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),M=t(),N=M&&M.length?M[0]:e(Qr),v=n(N);(function(){let b=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;b&&(b.__persistenceInitialized__||(b.__persistenceInitialized__=!0,(async()=>{try{await o(v),console.info("[Firestore] Persistence: multi-tab enabled")}catch(S){if(S&&S.code==="failed-precondition")try{await r(v),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(L){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",L?.code||L)}else S&&S.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",S?.code||S)}})()))})();let f=s(v,"cues");return{db:v,cuesCollection:f,getCollection:s,doc:i,getDoc:a,addDoc:c,updateDoc:u,getDocs:g,query:y,orderBy:E,serverTimestamp:x,setDoc:C,arrayUnion:F}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),Ze)}async function ns(){let e=await He(),{getDocs:t,cuesCollection:n,query:o,orderBy:r}=e,s=o&&r?o(n,r("createdAt","desc")):n;return(await t(s)).docs.map(a=>({id:a.id,...a.data()}))}async function os(e){if(!e)return null;let t=await He(),{db:n,doc:o,getDoc:r}=t,s=o(n,"cues",e),i=await r(s);return i.exists()?{id:i.id,...i.data()}:null}async function Do(){if(!(!J&&!ge))try{let e=await ns();ts(e),co(e)}catch(e){console.error("Failed to load cues",e),yt(e)?Vt("Sign in to view your cues.",{tone:"muted"}):Vt("Unable to load cues right now.",{tone:"error"}),co([])}}function rs(e){!fe||!Y||(Ln(e,Wt),Y.value=e?.id||"",G?.setEditMode(!0),G?.show({mode:"edit"}))}async function ss(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await os(n);if(!o)return;rs(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function as(e){if(e.preventDefault(),!fe||!Y)return;let t=Y.value.trim(),n=Tn(Wt);try{let o=await He(),{db:r,doc:s,addDoc:i,updateDoc:a,cuesCollection:c,serverTimestamp:u}=o,g=typeof u=="function"?u():null;if(t){let y=s(r,"cues",t),E={...n};g&&(E.updatedAt=g),await a(y,E)}else{let y={...n};g&&(y.createdAt=g,y.updatedAt=g),await i(c,y)}await Do(),vn(Wt,Y,G?.modalTitle??null,Cr),await G?.hide({reason:"form-submit"})}catch(o){console.error("Failed to save cue",o)}}async function is(){!fe||!Y||!J||(J.addEventListener("click",ss),fe.addEventListener("submit",as))}fe&&Y&&(document.addEventListener("cue:prepare",()=>{Y.value="",G?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{Y.value="",G?.setEditMode(!1)}));fe&&Y&&J&&is().catch(e=>{console.error("Failed to initialise cue editing",e)});(J||ge)&&Do();var I=[],Je=null,de=!1,Ee=te(),Ne=!1,w=Ee,k=null,Ce=null,R=null,dt=new Map,ls=800,cs=1500,zt={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},No=new Set(["saving","saved","error"]),Bo="plannerNotesOpenState",ce=ds();function ds(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Bo);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function us(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Bo,JSON.stringify(ce))}catch(e){console.warn("Unable to persist planner notes state",e)}}function fs(e){return e?!!ce?.[e]:!1}function ms(e,t){if(e){if(t)ce={...ce,[e]:!0};else if(ce?.[e]){let n={...ce};delete n[e],ce=n}us()}}function ps(e,t=Ee){return Array.isArray(e)?e:e&&typeof e=="object"&&Array.isArray(e.lessons)?e.lessons:typeof t=="string"&&t?qn(t):[]}var ys=(e=[])=>{if(!to)return;let t=Array.isArray(e)?e.length:0;to.textContent=String(t)};function hs(e=[]){let t=Array.isArray(e)?e:[];if(Qn&&(Qn.textContent=String(t.length)),Zn){let n=new Set;t.forEach(o=>{let r=Mo(o);r&&n.add(r.toLowerCase())}),Zn.textContent=String(n.size)}if(Jn){let n=t.filter(o=>typeof o.notes=="string"&&o.notes.trim().length>0).length;Jn.textContent=String(n)}}function U(e,t){let n=ps(e,t);ys(n);let o=e?.weekId||t||Ee,r=kt(o,{short:!0});no&&(no.textContent=r||""),Xn&&(Xn.textContent=String(n.length)),it&&(it.textContent=r||""),hs(n)}function Kt(e,{tone:t="muted"}={}){if(!$)return;R=null;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),$.innerHTML=`<p class="${n.join(" ")}">${B(e)}</p>`}function en(e){if(!Gn)return;let t=kt(e);Gn.textContent=t||"",it&&(it.textContent=t||"")}function Mo(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function V(e){if(!$)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){Kt("No lessons saved for this week yet.");return}let n=t,o=n.map(s=>typeof s.id=="string"&&s.id?s.id:"").filter(s=>!!s);R&&!o.includes(R)&&(R=null);let r=n.map(s=>{let i=Array.isArray(s.details)?s.details.map(f=>`
                <li class="flex items-center gap-2">
                  ${f.badge?`<span class="badge badge-outline badge-sm text-secondary">${B(f.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${B(f.text)}</span>
                </li>
              `).join(""):"",a=i?`<ul class="space-y-2 text-sm text-base-content/70">${i}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',c=typeof s.id=="string"?s.id:"",u=!!(R&&c&&R===c),g=["data-planner-lesson",c?`data-lesson-id="${c}"`:"",u?'data-planner-selected="true"':""].filter(Boolean).join(" "),y=s.summary?`<p class="text-sm text-base-content/70">${B(s.summary)}</p>`:"",E=Mo(s),x=E?`<span class="badge badge-outline badge-sm text-base-content/70">${B(E)}</span>`:"",C=x?`<div class="mt-2 flex flex-wrap gap-1">${x}</div>`:"",F=typeof s.notes=="string"?s.notes:"",M=fs(c),N=c?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${c}"
              ${M?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${c}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${B(F)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${B(zt.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",v=c?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${c}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${c}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${g}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${B(s.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${B(s.title||s.dayLabel||"Lesson")}</h2>
                ${y}
                ${C}
              </div>
              <div class="flex flex-wrap items-center justify-end gap-1">
                ${v}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${c}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${c}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${a}
            ${N}
            <div class="flex flex-wrap gap-2">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${c}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${c}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");$.innerHTML=r,Po(R)}function Po(e){R=e||null,$&&$.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function gs(){return R&&(Array.isArray(k?.lessons)?k.lessons:[]).some(t=>t.id===R)?R:null}function bs(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===R||Po(n)}function Es(e){let t=jt(e?.currentTarget)?e.currentTarget:at;if(!jt(t))return;let n=t.value,o=ft.has(n)?n:lt;So(o),$r(o),t.value!==o&&(t.value=o)}function Fo(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function ws(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function Ho(e){if(!e)return;let t=dt.get(e);if(!t)return;let n=ws();n&&n(t),dt.delete(e)}function ke(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&No.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Ie(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&No.has(t)?t:null,o=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(o instanceof HTMLElement){let r=n||"idle",s=zt[r]||zt.idle;o.textContent=s,o.setAttribute("data-status",r)}}async function Yt(e,t,n){if(!e||!w)return;let o=n instanceof HTMLTextAreaElement?n:null;o&&(ke(o,"saving"),Ie(o,"saving"));try{let r=await Ct(w,e,{notes:t});if(r&&(k=r),o){ke(o,"saved"),Ie(o,"saved");let s=Fo();s?s(()=>{o.getAttribute("data-notes-status")==="saved"&&(ke(o,null),Ie(o,null))},cs):(ke(o,null),Ie(o,null))}}catch(r){console.error("Failed to save planner notes",r),o&&(ke(o,"error"),Ie(o,"error"))}}function Ss(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;Ho(n);let o=Fo();if(!o){Yt(n,t.value,t);return}let r=o(()=>{dt.delete(n),Yt(n,t.value,t)},ls);dt.set(n,r)}function Ls(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(Ho(n),Yt(n,t.value,t))}function vs(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let o=t.hasAttribute("open");ms(n,o)}function he(e){if(!$)return Ce=null,Promise.resolve();let t=e||te();w=t,en(t),Kt("Loading plan\u2026");let n=(async()=>{try{let o=await K(t);k=o,V(o),U(o,t)}catch(o){console.error("Failed to load planner week",o),Kt("Unable to load this week's planner.",{tone:"error"})}})();return Ce=n,n.finally(()=>{Ce===n&&(Ce=null)})}async function Ro(){if(!$)return;Ne||pt();let e=Ce;if(!e&&(!k||k.weekId!==w)&&(e=he(w)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function Ts(e,t){if(!e)return;await Ro();let n=Array.isArray(k?.lessons)?k.lessons:[];if(!n.length)return;let o=n.find(x=>x?.id===e);if(!o)return;let r=typeof o.dayLabel=="string"&&o.dayLabel.trim()?o.dayLabel.trim():typeof o.dayName=="string"&&o.dayName.trim()?o.dayName.trim():"",s=typeof o.title=="string"&&o.title.trim()?o.title.trim():r||"Lesson",i=typeof o.summary=="string"&&o.summary.trim()?o.summary.trim():"",a=i||s,c=r?`${r} \xB7 ${a}`:a,u=i||"",g=jr(o),y=Wr($n(w,g)),E={reminderTitle:c,reminderNotes:u,dueDate:y,dayLabel:r,lessonTitle:s,summary:i,plannerLessonId:e};Bt("cue:prepare",{trigger:t,source:"planner"}),Bt("planner:prefillReminder",E),Bt("cue:open",{trigger:t,source:"planner"})}async function xs(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),o=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":Cs(o,t);break;case"edit":Ds(o,t);break;case"delete":Ns(o);break;case"move-up":uo(o,"up",t);break;case"move-down":uo(o,"down",t);break;case"create-reminder":await Ts(o,t);break;default:break}}async function Oo(e){if(typeof document>"u"||!oe)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=k?.lessons?.[0]?.dayLabel||"Monday";oe.openAddLesson({defaultDay:n,trigger:t})}async function As(e){if(!oe)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Ae(w,1);oe.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function ks(e){if(!w)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Ae(w,-1);if(n){t&&t.setAttribute("disabled","true");try{let o=await Nt(n,w);o&&(k=o,R=null,V(o),U(o,w),j&&(j.textContent="Copied last week into this plan."))}catch(o){console.error("Failed to copy previous planner week",o),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{t&&t.removeAttribute("disabled")}}}async function Is(e){if(!w)return;e?.preventDefault?.();let t=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(t=window.confirm("Clear all lessons for this week?")),!t)return;let n=e?.currentTarget instanceof HTMLElement?e.currentTarget:null;n&&n.setAttribute("disabled","true");try{let o=await Wn(w);o&&(k=o,R=null,V(o),U(o,w),j&&(j.textContent="Cleared this week's plan."))}catch(o){console.error("Failed to clear planner week",o),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function Cs(e,t){if(!e||!oe)return;let n=k?.lessons?.find(r=>r.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;oe.openAddDetail({lesson:n,trigger:o})}async function Ds(e,t){if(!e||!oe)return;let n=k?.lessons?.find(r=>r.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;oe.openEditLesson({lesson:n,trigger:o})}async function uo(e,t,n){if(!e||!t)return;let o=w||te();if(!o)return;let r=n instanceof HTMLElement?n:null;r&&r.setAttribute("disabled","true");try{let s=await jn(o,e,t);s&&(k=s,V(s),U(s,o))}catch(s){console.error("Failed to move planner lesson",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{r&&r.removeAttribute("disabled")}}async function Ns(e){if(!e||typeof window>"u")return;let t=k?.lessons?.find(o=>o.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let o=await Un(w,e);o&&(k=o,V(o),U(o,w))}catch(o){console.error("Failed to delete planner lesson",o),window.alert("Unable to delete that lesson right now.")}}function pt(){if(Ne||!$){Ne&&he(w);return}Ne=!0,_n({ensureFirestore:He}),$.addEventListener("click",bs),$.addEventListener("click",xs),$.addEventListener("input",Ss),$.addEventListener("focusout",Ls),$.addEventListener("toggle",vs),Hr?.addEventListener("click",Oo),Fr?.addEventListener("click",As),Mr?.addEventListener("click",ks),Pr?.addEventListener("click",Is),at?.addEventListener("change",Es),Dr?.addEventListener("click",()=>{let e=Ae(w,-1);he(e)}),Nr?.addEventListener("click",()=>{let e=Ae(w,1);he(e)}),Br?.addEventListener("click",()=>{he(te())}),he(w)}function fo(){typeof window>"u"||ho()==="planner"&&pt()}function Bs(e){let t=e?.detail?.plan;t&&(Ne&&t.weekId===w?(k=t,V(t),en(t.weekId),U(t,t.weekId)):t.weekId===Ee&&U(t,Ee))}U(null,Ee);typeof document<"u"&&document.addEventListener(vt,Bs);typeof window<"u"&&(window.addEventListener("hashchange",fo),window.addEventListener("DOMContentLoaded",fo));var _o="dailyTasksByDate",et=null;function tn(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function Ms(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),r=Number.parseInt(t,10),s=Number.parseInt(n,10),i=Number.parseInt(o,10);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(i))return e;let a=new Date(r,s-1,i);return Number.isNaN(a.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(a)}function Fe(e){if(!Ut)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);Ut.disabled=!t}function ue(e){if(!ne)return;if(!Array.isArray(e)||e.length===0){ne.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',Fe([]);return}let t=e.map((n,o)=>{let r=B(n?.text||""),s=!!n?.completed,i=`daily-task-${o}`,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return s&&a.push("line-through","text-opacity-50"),`
        <label class="flex items-center p-3 border-b border-base-200" data-task-index="${o}" for="${i}">
          <input id="${i}" type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" ${s?"checked":""} />
          <span class="${a.join(" ")}">${r}</span>
        </label>
      `}).join("");ne.innerHTML=t,Fe(e)}function ut(){st&&st.classList.remove("hidden")}function nn(){st&&st.classList.add("hidden")}function on(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function we(e){return Array.isArray(e)?e.map(t=>on(t)):[]}function rn(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(_o);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function $o(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(_o,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function mo(e){let t=rn(),n=t&&typeof t=="object"?t[e]:[];return we(n)}function Gt(e,t){let n=rn(),o=we(t);return n[e]=o,$o(n),o}function po(e,t){let n=rn(),o=we(n[e]);return o.push(on(t)),n[e]=o,$o(n),o}function yt(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function sn(){return et||(et=He().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),et)}function an(e,t){let{doc:n,dailyListsCollection:o,db:r}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(r,"dailyLists",t)}async function ln(){if(!Yn||!ne)return;let e=tn(),t=Ms(e);Yn.textContent=t?`Today's List - ${t}`:"Today's List";let n=!1;if(de){ut();let o=mo(e);I=o,ue(o),n=!0}return Je||(n||(ne.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',Fe([])),Je=(async()=>{try{let o=await sn(),r=an(o,e),s=await o.getDoc(r),i=s.exists()?s.data()?.tasks:[];return I=we(i),ue(I),Gt(e,I),de=!1,nn(),I}catch(o){yt(o)?(console.warn("Falling back to local daily tasks due to permission issue",o),de=!0,ut()):console.error("Failed to load daily list",o);let s=mo(e);return I=s,s.length||n?ue(s):(ne.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',I=[],Fe(I)),I}})().finally(()=>{Je=null})),Je}async function Ps(e){let t=tn(),n=on(e);try{let o=await sn(),r=an(o,t),s=await o.getDoc(r);if(s.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(r,{tasks:o.arrayUnion(n)});else{let i=s.exists()?s.data()?.tasks:[],a=Array.isArray(i)?we(i):[];a.push(n),typeof o.setDoc=="function"?await o.setDoc(r,{tasks:a},{merge:!0}):await o.updateDoc(r,{tasks:a})}po(t,n),de=!1,nn()}catch(o){if(yt(o)){console.warn("Saving task locally because cloud sync is unavailable",o),de=!0,ut(),po(t,n);return}throw o}}async function qo(e){let t=tn(),n=we(e);try{let o=await sn(),r=an(o,t);typeof o.setDoc=="function"?await o.setDoc(r,{tasks:n},{merge:!0}):await o.updateDoc(r,{tasks:n}),Gt(t,n),de=!1,nn()}catch(o){if(yt(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),de=!0,ut(),Gt(t,n);return}throw o}}function Uo(e){[ot,rt].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function Fs(){!Be||!Me||(Be.classList.remove("hidden"),Me.classList.add("hidden"),Uo(ot))}function Hs(){!Be||!Me||(Be.classList.add("hidden"),Me.classList.remove("hidden"),Uo(rt),ln())}function Rs(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),o=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!o.length)return;let r=a=>{n.forEach(c=>{if(!c)return;let u=c.getAttribute("data-dashboard-tab")===a;c.classList.toggle("tab-active",u),c.setAttribute("aria-selected",u?"true":"false")}),o.forEach(c=>{if(!c)return;let u=c.getAttribute("data-dashboard-panel")===a;c.classList.toggle("hidden",!u),c.setAttribute("aria-hidden",u?"false":"true")})},i=(n.find(a=>a.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");i&&r(i),n.forEach(a=>{a.addEventListener("click",()=>{let c=a.getAttribute("data-dashboard-tab");c&&r(c)})})})}window.addEventListener("DOMContentLoaded",Rs);ot&&rt&&Be&&Me&&(ot.addEventListener("click",e=>{e.preventDefault(),Fs()}),rt.addEventListener("click",e=>{e.preventDefault(),Hs()}));var _=null,z=!1,nt=null;function be(e){if(!W)return;W.setAttribute("aria-pressed",e?"true":"false");let t=W.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":W.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function Os(){z&&(window.clearTimeout(nt),nt=window.setTimeout(()=>{nt=null,z&&jo(!0)},400))}function jo(e=!1){if(!_)return!1;if(z&&!e)return!0;try{return _.start(),z=!0,be(!0),!0}catch{return z=!1,be(!1),!1}}function cn(){if(_){z=!1,window.clearTimeout(nt);try{_.stop()}catch{}be(!1)}}function _s(){if(W)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){W.setAttribute("disabled","true"),W.setAttribute("aria-disabled","true"),W.title="Voice input is not supported in this browser.";return}_=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(_.lang=t,_.interimResults=!1,"continuous"in _)try{_.continuous=!0}catch{}_.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&q){q.value=o.trim();try{q.focus({preventScroll:!0})}catch{q.focus()}try{let r=q.value.length;q.setSelectionRange(r,r)}catch{}}},_.onend=()=>{if(!z){be(!1);return}Os()},_.onerror=()=>{z=!1,be(!1)}}catch{_=null,be(!1),W.setAttribute("disabled","true"),W.setAttribute("aria-disabled","true")}}_s();W?.addEventListener("click",()=>{_&&(z?cn():jo())});bo?.addEventListener("submit",()=>{z&&cn()});window.addEventListener("pagehide",()=>{z&&cn()});bo?.addEventListener("submit",async e=>{if(e.preventDefault(),!q)return;let t=q.value.trim();if(!t){q.focus();return}let n={text:t,completed:!1};q.value="",q.focus();try{await Ps(n),await ln()}catch(o){console.error("Failed to add task to the daily list",o),q.value=t,q.focus()}});ne?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(I)||Number.isNaN(n)||!I[n])return;let o=document.activeElement===t,r=()=>{if(!o)return;let a=ne?.querySelector(`input[data-task-index="${n}"]`);if(a instanceof HTMLInputElement)try{a.focus({preventScroll:!0})}catch{a.focus()}},s=I.map(a=>({...a})),i=s.map((a,c)=>c===n?{...a,completed:t.checked}:a);I=i,ue(i),r();try{await qo(i)}catch(a){console.error("Failed to update task completion state",a),I=s,ue(s),r()}});Ut?.addEventListener("click",async()=>{if(!Array.isArray(I)||I.length===0)return;let e=I.filter(n=>!n.completed);if(e.length===I.length)return;let t=I.map(n=>({...n}));I=e,ue(e);try{await qo(e)}catch(n){console.error("Failed to clear completed tasks",n),I=t,ue(t)}});Fe(I);ln();function $s(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),o=document.getElementById("noteNewBtn"),r=document.getElementById("notesList"),s=document.querySelector("[data-notes-layout]"),i=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!o)return;let a=null,c=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}},u=()=>s&&s.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",g=f=>{let m=f==="collapsed";i.forEach(b=>{if(!(b instanceof HTMLElement))return;b.setAttribute("aria-expanded",m?"false":"true");let S=b.dataset.notesShelfToggleVariant;S==="primary"?b.textContent=m?"Show saved notes":"Hide saved notes":S==="close"&&(b.textContent=m?"Show":"Close")})},y=f=>{s&&(s.dataset.notesShelfState=f==="collapsed"?"collapsed":"expanded"),g(u())},E=()=>{let f=u()==="collapsed"?"expanded":"collapsed";y(f),f==="collapsed"&&c()};i.length&&(i.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),E()})}),y(u()));let x=f=>{if(!f){a=null,e.value="",t.value="";return}a=f.id,e.value=f.title||"",t.value=f.body||""},C=()=>{if(!r)return;r.querySelectorAll("button[data-note-id]").forEach(m=>{if(!(m instanceof HTMLElement))return;let b=m.getAttribute("data-note-id")===a;m.classList.toggle("bg-base-200/80",b),m.classList.toggle("border-base-300",!b),m.classList.toggle("border-primary",b),m.classList.toggle("font-medium",b),m.setAttribute("aria-current",b?"true":"false")})},F=()=>{let f=je();return Array.isArray(f)?[...f].sort((m,b)=>{let S=Date.parse(m?.updatedAt||""),L=Date.parse(b?.updatedAt||"");return(Number.isNaN(L)?0:L)-(Number.isNaN(S)?0:S)}):[]},M=f=>{if(!f)return;let m=je();if(!Array.isArray(m))return;let b=m.filter(L=>L.id!==f);if(b.length===m.length)return;bt(b),a===f&&(a=null);let S=N();if(a){let L=S.find(d=>d.id===a)||null;x(L)}else S.length?x(S[0]):x(null);C()},N=(f=F())=>{if(!r)return f;if(r.innerHTML="",!f.length){let m=document.createElement("li");return m.className="text-sm italic text-base-content/60",m.textContent="No saved notes yet.",r.appendChild(m),f}return f.forEach(m=>{let b=document.createElement("li");b.className="flex items-center gap-2";let S=document.createElement("button");S.type="button",S.dataset.noteId=m.id,S.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",S.textContent=m.title||"Untitled note",S.addEventListener("click",()=>{x(m),C(),c()});let L=document.createElement("button");L.type="button",L.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",L.setAttribute("aria-label",`Delete note "${m.title||"Untitled note"}"`),L.textContent="Delete",L.addEventListener("click",d=>{d.stopPropagation(),M(m.id)}),b.appendChild(S),b.appendChild(L),r.appendChild(b)}),C(),f},v=()=>{let f=N();if(!f.length){x(null),C();return}let m=a?f.find(b=>b.id===a):null;x(m||f[0]),C()};n.addEventListener("click",()=>{let f=je(),m=Array.isArray(f)?[...f]:[],b=typeof e.value=="string"?e.value.trim():"",S=typeof t.value=="string"?t.value:"",L=b||"Untitled note",d=new Date().toISOString();if(a){let A=m.findIndex(H=>H.id===a);if(A>=0)m[A]={...m[A],title:L,body:S,updatedAt:d};else{let H=gt(L,S,{updatedAt:d});a=H.id,m.unshift(H)}}else{let A=gt(L,S);a=A.id,m.unshift(A)}bt(m);let h=N(),D=a?h.find(A=>A.id===a):null;x(D||null),C()}),o.addEventListener("click",()=>{a=null,e.value="",t.value="",C(),c()}),v()}$s();var Wo="theme",qs="professional",Xt="memoryCue:theme-change",Us="professional",Qt=document.getElementById("theme-menu"),Vo="[data-theme-name],[data-theme-option]",js=new Set(["dark","dracula","synthwave"]);function re(e){return typeof e=="string"?e.trim():""}function zo(e){return e instanceof HTMLElement?re(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Ws(e){let t=re(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",js.has(t)))}function yo(e){let t=re(e);if(t)try{localStorage.setItem(Wo,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Ko(e){if(!Qt)return;let t=re(e);Qt.querySelectorAll(Vo).forEach(o=>{if(!(o instanceof HTMLElement))return;let r=zo(o),s=t&&r===t;o.setAttribute("aria-checked",s?"true":"false"),o.classList.toggle("active",s)})}function Vs(e){let t=re(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(Xt,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent(Xt,!0,!0,{theme:t}),window.dispatchEvent(o)}}}function Zt(e,{persist:t=!0,notify:n=!0}={}){let o=re(e);if(!o)return;re(document.documentElement.getAttribute("data-theme"))!==o&&Ws(o),t&&yo(o),Ko(o),n&&Vs(o)}function zs(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){Zt(Us,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Wo)||""}catch(o){console.warn("Unable to load theme preference",o)}let n=t||document.documentElement.getAttribute("data-theme")||qs;n&&Zt(n,{persist:!1,notify:!0})}Qt?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(Vo):null;if(!t)return;e.preventDefault();let n=zo(t);n&&Zt(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(Xt,e=>{let t=re(e?.detail?.theme);t&&Ko(t)});zs()});export default Ks();
