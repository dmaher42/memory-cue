import{a as Y,b as Re}from"./chunk-T3BPUE6R.js";import{a as Ue,b as Ne}from"./chunk-RCZ4YZVR.js";function ue(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let i of o){if(typeof i!="string"||!i)continue;let r=t.getElementById(i);if(r)return{key:n,element:r}}return null}).filter(n=>!!(n&&n.element))}function _(e,t){if(!e||typeof e!="object")return"";let n=Oe[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let i=e[o];return i==null?"":typeof i=="string"?i:String(i)}return""}function He(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function Pe(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function fe(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let i=e&&typeof e=="object"?_(e,n):"";He(o,i)})}function me(e,t,n,o){Array.isArray(e)&&e.forEach(({element:i})=>{i instanceof HTMLInputElement?["checkbox","radio"].includes(i.type)?i.checked=!1:i.value="":(i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function ye(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let i=Pe(o);if(typeof i=="boolean"){t[n]=i;return}let r=typeof i=="string"?i.trim():i;t[n]=r??""}),t}function k(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var ce,Oe,le,de,pe=Ue(()=>{ce=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],Oe={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},le="Create Cue",de="Edit Cue"});var ut=Ne(()=>{Re();pe();var y=document.getElementById("cue-modal")??document.getElementById("cue_modal"),be=document.getElementById("openCueModal"),Ve=document.getElementById("closeCueModal"),qe=y?.querySelector(".modal-backdrop button"),O=document.getElementById("title"),$e=document.getElementById("reminderText"),je=()=>{O&&window.setTimeout(()=>{try{O.focus({preventScroll:!0})}catch{O.focus()}},50)},X=()=>{!y||typeof y.showModal!="function"||(y.open||y.showModal(),je())},Se=()=>{y&&y.open&&y.close()};be?.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("cue:prepare",{detail:{mode:"create"}})),X()});Ve?.addEventListener("click",()=>{let e={reason:"user-dismissed"};document.dispatchEvent(new CustomEvent("cue:cancelled",{detail:e})),document.dispatchEvent(new CustomEvent("cue:close",{detail:e}))});qe?.addEventListener("click",()=>{let e={reason:"backdrop"};document.dispatchEvent(new CustomEvent("cue:cancelled",{detail:e})),document.dispatchEvent(new CustomEvent("cue:close",{detail:e}))});y?.addEventListener("cancel",e=>{e.preventDefault();let t={reason:"keyboard"};document.dispatchEvent(new CustomEvent("cue:cancelled",{detail:t})),document.dispatchEvent(new CustomEvent("cue:close",{detail:t}))});document.addEventListener("cue:open",()=>{X()});document.addEventListener("cue:close",()=>{Se(),be?.focus()});var ze=()=>{let e=!!O,t=!!$e;return!e&&!t?Promise.resolve():t?Y({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",defaultFilter:"all",countTodaySel:"#todayCount",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge",countCompletedSel:"#completedCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",dateFeedbackSel:"#dateFeedback"}):Y({titleSel:"#title",dateSel:"#date",timeSel:"#time",detailsSel:"#details",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveBtn",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",statusSel:"#status",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",filterBtnsSel:"[data-filter]",sortSel:"#sort",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",defaultFilter:"today",countTodaySel:"#inlineTodayCount",countOverdueSel:"#inlineOverdueCount",countTotalSel:"#inlineTotalCount",countCompletedSel:"#inlineCompletedCount",emptyStateSel:"#emptyState",listWrapperSel:"#remindersWrapper",dateFeedbackSel:"#dateFeedback",variant:"desktop"})};ze().catch(e=>{console.error("Failed to initialise reminders",e)});var b=document.getElementById("cues-list"),v=document.getElementById("cue-form"),u=v?.querySelector("#cue-id-input"),p=document.getElementById("modal-title"),W=p?.textContent?.trim()||le,Ke=de,V=document.getElementById("tab-cues"),q=document.getElementById("tab-daily"),D=document.getElementById("cues-view"),A=document.getElementById("daily-list-view"),ge=document.getElementById("daily-list-header"),Ee=document.getElementById("quick-add-form"),d=document.getElementById("quick-add-input"),f=document.getElementById("daily-voice-btn"),S=document.getElementById("daily-tasks-container"),J=document.getElementById("clear-completed-btn"),$=document.getElementById("daily-list-permission-notice"),Z=ue(ce),Qe={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},U=null;function Ye(e){if(!b)return;if(!Array.isArray(e)||e.length===0){b.innerHTML='<p class="text-sm text-base-content/60">No cues yet.</p>';return}let t=e.map(n=>{let o=k(_(n,"title")||"Untitled Cue"),i=k(_(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${i?`<p>${i}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${k(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${k(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");b.innerHTML=t}async function z(){return U||(U=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:i,collection:r,doc:s,getDoc:l,addDoc:F,updateDoc:I,getDocs:g,query:h,orderBy:B,serverTimestamp:Fe,setDoc:Ie,arrayUnion:Be}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),K=t(),Me=K&&K.length?K[0]:e(Qe),M=n(Me);(function(){let Q=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;Q&&(Q.__persistenceInitialized__||(Q.__persistenceInitialized__=!0,(async()=>{try{await o(M),console.info("[Firestore] Persistence: multi-tab enabled")}catch(T){if(T&&T.code==="failed-precondition")try{await i(M),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(se){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",se?.code||se)}else T&&T.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",T?.code||T)}})()))})();let _e=r(M,"cues");return{db:M,cuesCollection:_e,getCollection:r,doc:s,getDoc:l,addDoc:F,updateDoc:I,getDocs:g,query:h,orderBy:B,serverTimestamp:Fe,setDoc:Ie,arrayUnion:Be}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),U)}async function Ge(){let e=await z(),{getDocs:t,cuesCollection:n,query:o,orderBy:i}=e,r=o&&i?o(n,i("createdAt","desc")):n;return(await t(r)).docs.map(l=>({id:l.id,...l.data()}))}async function We(e){if(!e)return null;let t=await z(),{db:n,doc:o,getDoc:i}=t,r=o(n,"cues",e),s=await i(r);return s.exists()?{id:s.id,...s.data()}:null}async function we(){if(b)try{let e=await Ge();Ye(e)}catch(e){console.error("Failed to load cues",e)}}function Je(e){!v||!u||(fe(e,Z),u.value=e?.id||"",p&&(p.textContent=Ke),X())}async function Ze(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await We(n);if(!o)return;Je(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function Xe(e){if(e.preventDefault(),!v||!u)return;let t=u.value.trim(),n=ye(Z);try{let o=await z(),{db:i,doc:r,addDoc:s,updateDoc:l,cuesCollection:F,serverTimestamp:I}=o,g=typeof I=="function"?I():null;if(t){let h=r(i,"cues",t),B={...n};g&&(B.updatedAt=g),await l(h,B)}else{let h={...n};g&&(h.createdAt=g,h.updatedAt=g),await s(F,h)}await we(),me(Z,u,p,W),Se()}catch(o){console.error("Failed to save cue",o)}}async function et(){!v||!u||!b||(await we(),b.addEventListener("click",Ze),v.addEventListener("submit",Xe))}v&&u&&(document.addEventListener("cue:prepare",()=>{u&&(u.value=""),p&&(p.textContent=W)}),document.addEventListener("cue:close",()=>{u&&(u.value=""),p&&(p.textContent=W)}));v&&u&&b&&et().catch(e=>{console.error("Failed to initialise cue editing",e)});var a=[],N=null,E=!1,ve="dailyTasksByDate",R=null;function ee(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function tt(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),i=Number.parseInt(t,10),r=Number.parseInt(n,10),s=Number.parseInt(o,10);if(!Number.isFinite(i)||!Number.isFinite(r)||!Number.isFinite(s))return e;let l=new Date(i,r-1,s);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(l)}function x(e){if(!J)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);J.disabled=!t}function w(e){if(!S)return;if(!Array.isArray(e)||e.length===0){S.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',x([]);return}let t=e.map((n,o)=>{let i=k(n?.text||""),r=!!n?.completed,s=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return r&&s.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${i}" ${r?"checked":""} />
          <span class="${s.join(" ")}">${i}</span>
        </div>
      `}).join("");S.innerHTML=t,x(e)}function j(){$&&$.classList.remove("hidden")}function nt(){$&&$.classList.add("hidden")}function te(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function C(e){return Array.isArray(e)?e.map(t=>te(t)):[]}function ne(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(ve);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function Te(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(ve,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function he(e){let t=ne(),n=t&&typeof t=="object"?t[e]:[];return C(n)}function H(e,t){let n=ne(),o=C(t);return n[e]=o,Te(n),o}function G(e,t){let n=ne(),o=C(n[e]);return o.push(te(t)),n[e]=o,Te(n),o}function oe(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function ie(){return R||(R=z().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),R)}function re(e,t){let{doc:n,dailyListsCollection:o,db:i}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(i,"dailyLists",t)}async function ke(){if(!ge||!S)return;let e=ee(),t=tt(e);if(ge.textContent=t?`Today's List - ${t}`:"Today's List",E){j();let n=he(e);return a=n,w(n),Promise.resolve(n)}return N||(S.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',x([]),N=(async()=>{try{let n=await ie(),o=re(n,e),i=await n.getDoc(o),r=i.exists()?i.data()?.tasks:[];a=C(r),w(a),H(e,a),E=!1,nt()}catch(n){if(oe(n)){console.warn("Falling back to local daily tasks due to permission issue",n),E=!0,j();let o=he(e);a=o,w(o);return}console.error("Failed to load daily list",n),S.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',a=[],x(a)}})().finally(()=>{N=null})),N}async function ot(e){let t=ee(),n=te(e);if(E){G(t,n);return}try{let o=await ie(),i=re(o,t),r=await o.getDoc(i);if(r.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(i,{tasks:o.arrayUnion(n)});else{let s=r.exists()?r.data()?.tasks:[],l=Array.isArray(s)?C(s):[];l.push(n),typeof o.setDoc=="function"?await o.setDoc(i,{tasks:l},{merge:!0}):await o.updateDoc(i,{tasks:l})}G(t,n)}catch(o){if(oe(o)){console.warn("Saving task locally because cloud sync is unavailable",o),E=!0,j(),G(t,n);return}throw o}}async function Le(e){let t=ee(),n=C(e);if(E){H(t,n);return}try{let o=await ie(),i=re(o,t);typeof o.setDoc=="function"?await o.setDoc(i,{tasks:n},{merge:!0}):await o.updateDoc(i,{tasks:n}),H(t,n)}catch(o){if(oe(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),E=!0,j(),H(t,n);return}throw o}}function Ce(e){[V,q].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function it(){!D||!A||(D.classList.remove("hidden"),A.classList.add("hidden"),Ce(V))}function rt(){!D||!A||(D.classList.add("hidden"),A.classList.remove("hidden"),Ce(q),ke())}V&&q&&D&&A&&(V.addEventListener("click",e=>{e.preventDefault(),it()}),q.addEventListener("click",e=>{e.preventDefault(),rt()}));var c=null,m=!1,P=null;function L(e){if(!f)return;f.setAttribute("aria-pressed",e?"true":"false");let t=f.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":f.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function at(){m&&(window.clearTimeout(P),P=window.setTimeout(()=>{P=null,m&&De(!0)},400))}function De(e=!1){if(!c)return!1;if(m&&!e)return!0;try{return c.start(),m=!0,L(!0),!0}catch{return m=!1,L(!1),!1}}function ae(){if(c){m=!1,window.clearTimeout(P);try{c.stop()}catch{}L(!1)}}function st(){if(f)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){f.setAttribute("disabled","true"),f.setAttribute("aria-disabled","true"),f.title="Voice input is not supported in this browser.";return}c=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(c.lang=t,c.interimResults=!1,"continuous"in c)try{c.continuous=!0}catch{}c.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&d){d.value=o.trim();try{d.focus({preventScroll:!0})}catch{d.focus()}try{let i=d.value.length;d.setSelectionRange(i,i)}catch{}}},c.onend=()=>{if(!m){L(!1);return}at()},c.onerror=()=>{m=!1,L(!1)}}catch{c=null,L(!1),f.setAttribute("disabled","true"),f.setAttribute("aria-disabled","true")}}st();f?.addEventListener("click",()=>{c&&(m?ae():De())});Ee?.addEventListener("submit",()=>{m&&ae()});window.addEventListener("pagehide",()=>{m&&ae()});Ee?.addEventListener("submit",async e=>{if(e.preventDefault(),!d)return;let t=d.value.trim();if(!t){d.focus();return}let n={text:t,completed:!1};d.value="",d.focus();try{await ot(n),await ke()}catch(o){console.error("Failed to add task to the daily list",o),d.value=t,d.focus()}});S?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(a)||Number.isNaN(n)||!a[n])return;let o=a.map(r=>({...r})),i=o.map((r,s)=>s===n?{...r,completed:t.checked}:r);a=i,w(i);try{await Le(i)}catch(r){console.error("Failed to update task completion state",r),a=o,w(o)}});J?.addEventListener("click",async()=>{if(!Array.isArray(a)||a.length===0)return;let e=a.filter(n=>!n.completed);if(e.length===a.length)return;let t=a.map(n=>({...n}));a=e,w(e);try{await Le(e)}catch(n){console.error("Failed to clear completed tasks",n),a=t,w(t)}});x(a);var Ae="theme",ct=document.getElementById("theme-menu");function xe(e){if(typeof e!="string"||!e.trim())return;let t=e.trim();document.documentElement.setAttribute("data-theme",t);let n=new Set(["dark","dracula","synthwave"]);document.documentElement.classList.toggle("dark",n.has(t))}function lt(e){if(typeof e!="string"||!e.trim())return;let t=e.trim();try{localStorage.setItem(Ae,t)}catch(n){console.warn("Unable to save theme preference",n)}}function dt(){let e="";try{e=localStorage.getItem(Ae)||""}catch(t){console.warn("Unable to load theme preference",t)}e&&xe(e)}ct?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest("[data-theme-name]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-theme-name");n&&(xe(n),lt(n))});dt()});export default ut();
