import{a as An,b as Bi,c as Mi}from"./chunk-GUVSRPRW.js";var Dn=Mi((Wi,qe)=>{var At=Object.freeze({apiKey:"AIzaSyB8n0PCndJgHnU_i5y4PiFv8zn2eA1New0",authDomain:"memory-cue-pro.firebaseapp.com",projectId:"memory-cue-pro",storageBucket:"memory-cue-pro.firebasestorage.app",messagingSenderId:"494760962301",appId:"1:494760962301:web:52c0fe3567f0c8f8b9e5e6",measurementId:"G-1H4CPRO123"});function Tn(a){if(!a||typeof a!="object")return null;let l=Object.entries(a).filter(([A,S])=>typeof S=="string"&&S.trim()!=="");return l.length?Object.fromEntries(l):null}function Oi(){let a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},l=Tn(a?.__FIREBASE_CONFIG);if(l)return l;let A=Tn(a?.__ENV?.FIREBASE_CONFIG);if(A)return A;let F=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((R,[Y,ie])=>{let k=a?.__ENV?.[Y]??a?.[Y];return typeof k=="string"&&k.trim()!==""&&(R[ie]=k),R},{});return Object.keys(F).length?F:null}function Ln(){let a=Oi();return a?{...At,...a}:{...At}}var Cn={DEFAULT_FIREBASE_CONFIG:At,getFirebaseConfig:Ln};if(typeof globalThis<"u"){let a=globalThis;a.memoryCueFirebase=a.memoryCueFirebase||{},a.memoryCueFirebase.getFirebaseConfig=Ln,a.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=At}typeof qe<"u"&&qe.exports&&(qe.exports=Cn,qe.exports.default=Cn)});function $i(){if(ne)return{...ne};let l=Qt()?.memoryCueFirebase;if(l&&typeof l.getFirebaseConfig=="function")return ne=l.getFirebaseConfig(),{...ne};if(typeof An=="function")try{let A=Dn();if(A){let S=typeof A.getFirebaseConfig=="function"?A.getFirebaseConfig:typeof A.default?.getFirebaseConfig=="function"?A.default.getFirebaseConfig:null;if(S)return ne=S(),{...ne}}}catch{}return l&&l.DEFAULT_FIREBASE_CONFIG?(ne={...l.DEFAULT_FIREBASE_CONFIG},{...ne}):(ne={...Pi},{...ne})}function Qt(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Rn(){let a=Qt(),l=a&&a.TimestampTrigger;return typeof l=="function"?l:null}function se(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Rn()}function ji(){if(typeof window>"u"||!window.location)return Gt;try{return new URL(Gt,window.location.href).href}catch{return Gt}}async function me(){return Tt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Tt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(ji()),await navigator.serviceWorker.ready}catch(a){return console.warn("Service worker registration failed",a),null}})(),Tt))}async function Fn(a){if(!a||typeof a!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let l=await me();if(!l)return!1;let A=new Set;navigator.serviceWorker.controller&&A.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(F=>{let R=l[F];R&&A.add(R)});let S=!1;return A.forEach(F=>{try{F.postMessage(a),S=!0}catch(R){console.warn("Failed posting message to service worker",R)}}),S}catch(l){return console.warn("Unable to reach service worker",l),!1}}async function Ct(){if(se())return!1;if(zt)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(We)try{return await We}catch{}We=(async()=>{let a=await me();if(!a)return!1;let l=!1;if("periodicSync"in a)try{let A=await a.periodicSync.getTags();(!Array.isArray(A)||!A.includes(Vt))&&await a.periodicSync.register(Vt,{minInterval:15*60*1e3}),l=!0}catch(A){console.warn("Periodic background sync unavailable",A)}if(!l&&"sync"in a)try{await a.sync.register(Vt),l=!0}catch(A){console.warn("Background sync unavailable",A)}return l})();try{let a=await We;return a&&(zt=!0),a}catch(a){return console.warn("Background reminder sync setup failed",a),zt=!1,!1}finally{We=null}}async function Xt(a=[],{requestCheck:l=!1}={}){if(!se()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let A=await me();if(!A)return;let S=await Fn({type:Nn.updateScheduledReminders,reminders:Array.isArray(a)?a:[]});if(l&&await Fn({type:Nn.checkScheduledReminders}),!S&&typeof A.update=="function")try{await A.update()}catch{}}catch(A){console.warn("Failed syncing reminders with service worker",A)}}async function Jt(a,l){if(se())try{let A=l||await me();if(!A)return;let S=[];try{S=await A.getNotifications({tag:a,includeTriggered:!0})}catch{S=await A.getNotifications({tag:a})}for(let F of S)try{F.close()}catch{}}catch{}}function Bn(){for(let a of Array.from(ae.values()))try{a.close()}catch{}ae.clear()}function Ui(){if(kn||typeof window>"u"||typeof window.addEventListener!="function")return;let a=()=>Bn();["pagehide","beforeunload"].forEach(l=>{try{window.addEventListener(l,a)}catch{}}),kn=!0}function _(a){if(typeof a=="string"){let l=a.replace(/\s+/g," ").trim();if(l)return l}return $}async function Gi(a={}){let l=e=>e?document.querySelector(e):null,A=e=>e?Array.from(document.querySelectorAll(e)):[],S=l(a.titleSel),F=l(a.dateSel),R=l(a.timeSel),Y=l(a.detailsSel),ie=l(a.prioritySel),k=l(a.categorySel),De=l(a.saveBtnSel),Lt=l(a.cancelEditBtnSel),E=l(a.listSel),Ge=A(a.googleSignInBtnSel),Ve=A(a.googleSignOutBtnSel),D=l(a.statusSel),M=l(a.syncStatusSel),Mn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},On=6e3,z=null;function Ee(e,{clearMessage:t=!0}={}){z&&(e&&z.tokenId!==e||(z.timeoutId&&clearTimeout(z.timeoutId),t&&D&&D.dataset.undoToken===z.tokenId&&(typeof D.replaceChildren=="function"?D.replaceChildren():D.textContent="",delete D.dataset.undoToken,delete D.dataset.statusKind),z=null))}function _n(e){if(!D)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>xi(e.tokenId)),e.button=i,typeof D.replaceChildren=="function"?D.replaceChildren(t,n,i):(D.textContent="",D.append(t,n,i)),D.dataset.statusKind="undo",D.dataset.undoToken=e.tokenId}function Dt(e,t){if(!M)return;let n=["online","offline","error"];n.forEach(r=>M.classList.remove(r)),n.includes(e)&&M.classList.add(e),M.dataset.state=e;let i=typeof t=="string"?t:Mn[e]||"";e==="online"||e==="offline"?(M.textContent="",M.dataset.compact="true",i?(M.setAttribute("aria-label",i),M.setAttribute("title",i)):(M.removeAttribute("aria-label"),M.removeAttribute("title"))):(M.textContent=i,M.removeAttribute("data-compact"),i?(M.setAttribute("aria-label",i),M.setAttribute("title",i)):(M.removeAttribute("aria-label"),M.removeAttribute("title")))}let j=l(a.notesSel),Pn=l(a.saveNotesBtnSel),$n=l(a.loadNotesBtnSel),Zt=l(a.countTotalSel),ze=l(a.googleUserNameSel),ge=l(a.dateFeedbackSel),q=l(a.voiceBtnSel),jn=l(a.notifBtnSel),xe=l(a.moreBtnSel),ke=l(a.moreMenuSel),Un=l(a.copyMtlBtnSel),xt=l(a.importFileSel),Hn=l(a.exportBtnSel),Yn=l(a.syncAllBtnSel),Ie=l(a.syncUrlInputSel),qn=l(a.saveSettingsSel),Wn=l(a.testSyncSel),Gn=A(a.openSettingsSel),Ke=l(a.settingsSectionSel),Ae=l(a.emptyStateSel),en=l(a.listWrapperSel),kt=l(a.categoryOptionsSel),ye=a.variant||"mobile",tn="mc:lastDefaults";function Nt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(tn)||"{}")||{}}catch{return{}}}function Vn(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(tn,JSON.stringify(e))}catch{}}function nn(e){let t=Nt(),n={category:_(e?.category||t.category||$),priority:e?.priority||t.priority||"Medium"};Vn(n)}let on='fieldset#priorityChips input[name="priority"]';function Ft(){try{let e=document.querySelector(`${on}:checked`);if(e&&e.value)return e.value}catch{}return ie&&typeof ie.value=="string"&&ie.value?ie.value:"Medium"}function Xe(e){let t=e||"Medium";ie&&typeof ie.value<"u"&&(ie.value=t);try{let n=Array.from(document.querySelectorAll(on));if(!n.length)return;let i=!1;if(n.forEach(o=>{let r=o.value===t;o.checked=r,i=i||r}),!i){let o=n.find(r=>r.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function rn(){let e=Nt();e.category&&k&&(k.value=e.category),e.priority&&Xe(e.priority)}rn();let W=typeof document<"u"?document.getElementById("quickAddInput"):null,zn=typeof document<"u"?document.getElementById("quickAddSubmit"):null,G=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,Rt=null;function Kn(e,t){let n=Date.now(),i=Nt(),o=typeof t=="string"&&t?t:null;return{id:yt(),title:(e||"").trim(),priority:i.priority||Ft(),category:_(i.category||k?.value||$),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!U}}async function Bt(){if(!W)return;if(typeof Rt=="function")try{Rt()}catch{}let e=(W.value||"").trim();if(!e)return;let t=null;try{let o=wt(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=Kn(e,t);_t(n,{position:"start"}),s.unshift(n),K(s);let i=$e(s);be=!0,B(),P(),i?s.forEach(o=>H(o)):H(n),Ue(n),we(n),fe(),nn(n),Ne();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:s}}))}catch{}Q({action:"created",label:`Reminder added \xB7 ${n.title}`}),W.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Bt),zn?.addEventListener("click",()=>{Bt()}),W?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Bt())});function Xn(){if(typeof HTMLElement>"u"||!(G instanceof HTMLElement)||!(W instanceof HTMLInputElement)||G.dataset.voiceBound==="true")return;if(G.dataset.voiceBound="true",typeof window>"u"){G.setAttribute("disabled","true"),G.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){G.setAttribute("disabled","true"),G.setAttribute("aria-disabled","true"),G.getAttribute("title")||(G.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,G.setAttribute("aria-pressed",d?"true":"false"),G.dataset.listening=d?"true":"false",G.classList.toggle("is-listening",d)},o=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",g=>{let y=g?.results?.[0]?.[0]?.transcript?.trim()||"";if(y){W.value=y;try{W.focus({preventScroll:!0})}catch{W.focus()}try{let b=W.value.length;typeof W.setSelectionRange=="function"&&W.setSelectionRange(b,b)}catch{}}});let f=()=>{i(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},r=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};Rt=r,G.addEventListener("click",()=>{let d=o();if(d){if(n){r();return}try{d.start(),i(!0)}catch(f){console.warn("Quick add voice error:",f),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",r),i(!1)}Xn(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&W&&(e.preventDefault(),W.focus())})));try{ye==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Jn=a.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",an=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Qn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Je=a.reminderLandingPath||(ye==="desktop"?"index.html#reminders":"mobile.html"),de=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function sn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ne(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:s}}))}catch{}}k&&!k.value&&(k.value=$),se()&&me();function Q(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(xn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(xn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function Zn(){if(typeof HTMLElement>"u"||!(q instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&S instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&S instanceof HTMLTextAreaElement;if(!e&&!t||q.dataset.voiceBound==="true")return;if(q.dataset.voiceBound="true",typeof window>"u"){q.setAttribute("disabled","true"),q.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){q.setAttribute("disabled","true"),q.setAttribute("aria-disabled","true"),q.getAttribute("title")||(q.title="Voice input is not supported in this browser.");return}let i=null,o=!1,r=y=>{o=y,q.setAttribute("aria-pressed",y?"true":"false"),q.dataset.listening=y?"true":"false",q.classList.toggle("is-listening",y)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",b=>{let C=b.results?.[0]?.[0]?.transcript?.trim()||"";if(C){S.value=C;try{S.focus({preventScroll:!0})}catch{try{S.focus()}catch{}}try{let x=S.value.length;typeof S.setSelectionRange=="function"&&S.setSelectionRange(x,x)}catch{}Q({action:"dictated",label:`Voice input captured \xB7 ${C}`})}});let y=()=>{r(!1)};return i.addEventListener("end",y),i.addEventListener("error",y),i},f=()=>{if(!(!o||!i)){try{i.stop()}catch{}r(!1)}};q.addEventListener("click",()=>{let y=d();if(y){if(o){f();return}try{y.start(),r(!0)}catch(b){console.warn("Speech recognition error:",b),r(!1)}}});let g=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",g),document.addEventListener("reminders:updated",g)),r(!1)}Ui(),Zn();let Qe,Ze,et,tt,Te,nt,it,ot,rt,at,st,Fe,Re,dt,ct,lt,ut,ft,pt,dn=a.firebaseDeps,Mt=typeof a.importModule=="function"?a.importModule:e=>import(e),Be=Qt(),Me=!1,Z=!1,Ot=null,oe=null,he=null,s=[],be=!1,U=null,Oe=null,_e=null,ve={},O={};function K(e=s){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?mn(t||{},n||{}):o-i})}function ei(e=s){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function Pe(e=s){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),K(n);else{n=e.slice().sort(mn);let i=n.length;n.forEach((o,r)=>{o.orderIndex=(i-r)*te})}return e===s&&(s=n),n}function _t(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=ei();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-te||te}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+te||te}}function $e(e=s){if(!Array.isArray(e)||e.length<2)return!1;K(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],r=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(r==null||d==null||r<=d||r-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*te;return e===s&&K(s),!0}let T={draggingId:null,dropTargetId:null,dropBefore:!0},cn=!1,u={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function ti(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function je(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function ce(){E&&(E.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),E.classList.remove("drag-over-list"))}function Pt(){if(!E)return;let e=E.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),ce(),T.draggingId=null,T.dropTargetId=null,T.dropBefore=!0}function ln(e,t,n){if(!e||e===t)return;let i=s.findIndex(x=>x?.id===e);if(i<0)return;let[o]=s.splice(i,1),r;if(!t)r=s.length;else{let x=s.findIndex(V=>V?.id===t);if(x<0){s.splice(i,0,o);return}r=n?x:x+1}s.splice(r,0,o);let d=s[r-1],f=s[r+1],g=Number.isFinite(d?.orderIndex)?d.orderIndex:null,y=Number.isFinite(f?.orderIndex)?f.orderIndex:null,b;g!=null&&y!=null?b=(g+y)/2:g!=null?b=g-te:y!=null?b=y+te:b=te,Number.isFinite(b)||(b=te*(s.length+1)),o.orderIndex=b,K(s);let C=$e(s);be=!0,B(),P(),C?s.forEach(x=>H(x)):H(o),Ne(),de("memoryCue:remindersUpdated",{items:s}),Q({action:"reordered",label:"Reminders reordered"})}function ni(e){let t=je(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(T.draggingId=i,T.dropTargetId=null,T.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function ii(e){if(!T.draggingId)return;let t=je(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),T.dropTargetId=null,T.dropBefore=!1,ce(),E?.classList.add("drag-over-list");return}if(t.dataset.id===T.draggingId){e.preventDefault(),ce();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(T.dropTargetId!==t.dataset.id||T.dropBefore!==o)&&(ce(),t.classList.add(o?"drag-over-before":"drag-over-after"),T.dropTargetId=t.dataset.id,T.dropBefore=o)}function oi(e){let t=je(e.target);if(!t){E?.contains(e.relatedTarget)||ce();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),E?.contains(e.relatedTarget)||E?.classList.remove("drag-over-list"))}function ri(e){if(!T.draggingId)return;e.preventDefault();let t=je(e.target),n=t?.dataset.id||null,i=T.dropBefore;if(t){let o=t.getBoundingClientRect(),r=o.top+o.height/2;i=e.clientY<r}else n=null,i=!1;ln(T.draggingId,n,i),Pt()}function ai(){Pt()}function si(){!E||cn||(cn=!0,E.addEventListener("dragstart",ni),E.addEventListener("dragover",ii),E.addEventListener("drop",ri),E.addEventListener("dragend",ai),E.addEventListener("dragleave",oi),mt())}function mt(){if(!E||mt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){mt._bound=!0;return}let t=6,n=160;function i(){u.longPressTimer&&(clearTimeout(u.longPressTimer),u.longPressTimer=null)}function o(){E&&(u.initialTouchAction!=null?E.style.touchAction=u.initialTouchAction:E.style.removeProperty("touch-action"))}function r({keepHighlights:h=!1}={}){if(i(),u.item&&u.pointerId!=null)try{u.item.hasPointerCapture?.(u.pointerId)&&u.item.releasePointerCapture(u.pointerId)}catch{}if(u.placeholder?.parentNode)try{u.placeholder.parentNode.removeChild(u.placeholder)}catch{}u.item&&(u.item.classList.remove("is-dragging"),u.originalStyles?u.item.setAttribute("style",u.originalStyles):u.item.removeAttribute("style")),o(),h||ce(),Object.assign(u,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(h){return E?Array.from(E.querySelectorAll("[data-reminder-item]")).filter(I=>I!==h):[]}function f(h){let I=u.item;if(!I||u.ready)return;let L=I.getBoundingClientRect(),c=window.getComputedStyle(I);u.ready=!0,T.draggingId=I.dataset.id||null,u.offsetY=h.clientY-L.top,u.fixedX=L.left;let m=document.createElement("div");m.className="touch-drag-placeholder",m.setAttribute("aria-hidden","true"),m.style.height=`${L.height}px`,m.style.boxSizing="border-box",m.style.marginTop=c.marginTop,m.style.marginBottom=c.marginBottom,m.style.marginLeft=c.marginLeft,m.style.marginRight=c.marginRight,m.style.borderRadius=c.borderRadius,m.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",m.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",m.style.pointerEvents="none",m.style.display="block",m.style.width="100%",I.parentNode?.insertBefore(m,I),u.placeholder=m,u.longPressTimer=null,u.originalStyles=I.getAttribute("style")||"",I.classList.add("is-dragging"),I.style.position="fixed",I.style.left=`${L.left}px`,I.style.top=`${L.top}px`,I.style.width=`${L.width}px`,I.style.zIndex="999",I.style.pointerEvents="none",I.style.touchAction="none",u.initialTouchAction=E.style.touchAction||"",E.style.touchAction="none"}function g(h){let I=u.item;if(!I||!u.ready)return;let L=h-u.offsetY;I.style.top=`${L}px`,I.style.left=`${u.fixedX}px`}function y(h){if(!u.ready||!E)return;let I=u.item,L=d(I);if(ce(),!L.length){T.dropTargetId=null,T.dropBefore=!1;return}let c=null,m=!1;for(let X of L){let pe=X.getBoundingClientRect(),Le=pe.top+pe.height/2;if(h<Le){c=X,m=!0;break}}if(!c){c=L[L.length-1];let X=c.getBoundingClientRect(),pe=X.top+X.height/2;m=h<pe,m||(m=!1)}if(!c){T.dropTargetId=null,T.dropBefore=!1;return}let p=c.getBoundingClientRect(),w=p.top+p.height/2,N=h<w;c.classList.add(N?"drag-over-before":"drag-over-after"),T.dropTargetId=c.dataset.id||null,T.dropBefore=N}function b(h){let I=T.draggingId,L=u.moved;if(!u.ready){r();return}r(),!h&&L&&I&&ln(I,T.dropTargetId,T.dropBefore),Pt()}function C(h){let I=h.pointerType||"";if(I&&I!=="touch"&&I!=="pen"||u.active)return;let L=je(h.target);if(!L)return;let c=ti(h.target);if(!(c&&c!==L)){u.active=!0,u.pointerId=h.pointerId,u.item=L,u.startX=h.clientX,u.startY=h.clientY,u.lastClientX=h.clientX,u.lastClientY=h.clientY,u.moved=!1,u.ready=!1,u.originalStyles=L.getAttribute("style")||"",u.startTime=h.timeStamp||Date.now(),T.dropTargetId=null,T.dropBefore=!0,T.draggingId=null,i(),u.longPressTimer=setTimeout(()=>{f({clientY:u.lastClientY})},n);try{L.setPointerCapture(h.pointerId)}catch{}}}function x(h){if(!u.active||h.pointerId!==u.pointerId)return;let I=h.pointerType||"";if(!(I&&I!=="touch"&&I!=="pen")){if(u.lastClientX=h.clientX,u.lastClientY=h.clientY,!u.ready){let L=Math.abs(h.clientX-u.startX),c=Math.abs(h.clientY-u.startY);if(L>t||c>t){let m=typeof h.timeStamp=="number"?h.timeStamp:Date.now();Math.abs(m-u.startTime)>=n?(i(),f({clientY:u.lastClientY})):r()}return}h.preventDefault(),u.moved=!0,g(h.clientY),y(h.clientY)}}function V(h){!u.active||h.pointerId!==u.pointerId||b(!1)}function Se(h){!u.active||h.pointerId!==u.pointerId||b(!0)}E.addEventListener("pointerdown",C),window.addEventListener("pointermove",x),window.addEventListener("pointerup",V),window.addEventListener("pointercancel",Se),mt._bound=!0}function un(){U=null,Dt("offline"),Ge.forEach(e=>e.classList.remove("hidden")),Ve.forEach(e=>e.classList.add("hidden")),ze&&(ze.textContent=""),Oe?.(),Oe=null,jt(),B(),P(),fe()}function $t(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Kt);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,r=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:yt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:_(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(r)?r:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function di(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Kt);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:_(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(Kt,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function P(){K(s),di(s)}function jt(){s=Pe($t())}jt();async function ci(){if(!U){s=$t();return}let e=Pe($t());if(!e.length){s=[],P();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await H(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}s=Pe(e.map(n=>({...n,pendingSync:!1}))),P(),B(),fe()}try{O=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{O={}}if(O&&typeof O=="object"&&Object.values(O).forEach(e=>{e&&typeof e=="object"&&(e.category=_(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Ye(e),e.urlPath=e.urlPath||Je,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!se()){let e=vn();typeof Notification<"u"&&Notification.permission==="granted"?(Ct(),e.length&&Xt(e,{requestCheck:!0})):e.length&&Xt(e)}let gt=e=>{if(!Be)return;let t=[Be];Be.window&&!t.includes(Be.window)&&t.push(Be.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function li(){if(!j)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",r=()=>"value"in j?j.value:j.innerHTML,d=b=>{if("value"in j){j.value=b;return}if(typeof b!="string"||b.length===0){j.innerHTML="";return}let C=b.trim();if(/<\/?[a-z][\s\S]*>/i.test(C)){j.innerHTML=b;return}let V=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");j.innerHTML=V},f=b=>{b?j.classList.add("notes-editor--columns"):j.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!b))},g="";try{g=localStorage.getItem(n)||""}catch{v("Unable to access saved notes")}d(g);let y=!1;try{y=localStorage.getItem(i)==="1"}catch{y=!1}f(y),j.addEventListener("input",()=>{g=r();try{localStorage.setItem(n,g)}catch{v("Notes saved for this session only")}}),Pn?.addEventListener("click",()=>{g=r();try{localStorage.setItem(n,g),v("Notes saved")}catch{v("Notes saved for this session only")}}),$n?.addEventListener("click",()=>{let b=g;try{b=localStorage.getItem(n)||g}catch{v("Unable to load saved notes")}g=b,d(g)}),e?.addEventListener("click",b=>{let C=b.target;if(!(C instanceof Element))return;let x=C.closest("button[data-action]");if(!x)return;let V=x.getAttribute("data-action");if(V==="columns"){let Se=!j.classList.contains("notes-editor--columns");f(Se);try{localStorage.setItem(i,Se?"1":"0")}catch{v("Column preference saved for this session only")}return}if(!o){v("Formatting controls are not supported in this browser");return}j.focus(),V==="bullets"?document.execCommand("insertUnorderedList"):V==="numbers"&&document.execCommand("insertOrderedList")})}if(li(),De?.addEventListener("click",Sn),dn)({initializeApp:Qe,getFirestore:Ze,enableMultiTabIndexedDbPersistence:et,enableIndexedDbPersistence:tt,doc:Te,setDoc:nt,deleteDoc:it,onSnapshot:ot,collection:rt,query:at,orderBy:st,serverTimestamp:Fe,getAuth:Re,onAuthStateChanged:dt,GoogleAuthProvider:ct,signInWithPopup:lt,signInWithRedirect:ut,getRedirectResult:ft,signOut:pt}=dn),Me=!0;else try{({initializeApp:Qe}=await Mt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Ze,enableMultiTabIndexedDbPersistence:et,enableIndexedDbPersistence:tt,doc:Te,setDoc:nt,deleteDoc:it,onSnapshot:ot,collection:rt,query:at,orderBy:st,serverTimestamp:Fe}=await Mt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Re,onAuthStateChanged:dt,GoogleAuthProvider:ct,signInWithPopup:lt,signInWithRedirect:ut,getRedirectResult:ft,signOut:pt}=await Mt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Me=!0}catch(e){Me=!1,console.warn("Firebase modules failed to load:",e),v("Firebase failed to load; notes available offline"),gt(!1)}if(Me&&typeof Qe=="function"&&typeof Ze=="function"&&typeof Re=="function")try{let e=$i();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Ot=Qe(e),oe=Ze(Ot),Z=!0,console.info("[Firebase] Firestore initialised",e.projectId),gt(!0)}catch(e){Z=!1,console.warn("Firebase initialization failed:",e),v("Firebase failed to load; notes available offline"),gt(!1)}else Me?(Z=!1,gt(!1)):Z=!1;Z&&typeof et=="function"&&typeof tt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await et(oe),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await tt(oe),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),Z&&typeof Re=="function"&&(he=Re(Ot));function ui(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let fi=typeof navigator<"u"&&navigator.language?navigator.language:"",fn=ui(fi),Ce=fn||"en-US",re="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(re=e.timeZone),!fn&&e.locale&&(Ce=e.locale)}catch{}let pi=new Intl.DateTimeFormat(Ce,{timeZone:re,hour:"2-digit",minute:"2-digit"}),mi=new Intl.DateTimeFormat(Ce,{timeZone:re,weekday:"long",day:"numeric",month:"long"}),gi=new Intl.DateTimeFormat("en-CA",{timeZone:re,year:"numeric",month:"2-digit",day:"2-digit"}),yi=new Intl.DateTimeFormat(Ce,{timeZone:re,weekday:"long"}),hi=new Intl.DateTimeFormat(Ce,{timeZone:re,month:"short",day:"numeric"});function le(e){let t=gi.formatToParts(e),n=t.find(r=>r.type==="year").value,i=t.find(r=>r.type==="month").value,o=t.find(r=>r.type==="day").value;return`${n}-${i}-${o}`}function pn(e,t){let[n,i,o]=e.split("-").map(g=>parseInt(g,10)),[r,d]=t.split(":").map(g=>parseInt(g,10)),f=new Date;return f.setFullYear(n,(i||1)-1,o||1),f.setHours(r||0,d||0,0,0),f.toISOString()}let bi=new Intl.DateTimeFormat("en-CA",{timeZone:re,year:"numeric",month:"2-digit",day:"2-digit"}),vi=new Intl.DateTimeFormat("en-CA",{timeZone:re,hour:"2-digit",minute:"2-digit",hour12:!1});function wi(e){try{let t=new Date(e),n=bi.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",o=n.find(d=>d.type==="month")?.value||"00",r=n.find(d=>d.type==="day")?.value||"00";return`${i}-${o}-${r}`}catch{return""}}function Si(e){try{let t=new Date(e),n=vi.formatToParts(t),i=n.find(r=>r.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(r=>r.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function yt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function ht(){return le(new Date)}function Ei(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Yi(e){let t=Ei(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function bt(e){return e==="High"?3:e==="Medium"?2:1}function mn(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,r=t?.due?new Date(t.due).getTime():1/0;if(o!==r)return o-r;let d=bt(t?.priority)-bt(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function qi(e,t){let n=bt(t.priority)-bt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Ut(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return mi.format(t)}catch{return e}}function vt(e){return pi.format(e)}function ue(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function gn(e){return e?ue(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function v(e){D&&(Ee(),D.dataset.statusKind="toast",D.textContent=e,clearTimeout(v._t),v._t=setTimeout(()=>{D&&D.dataset.statusKind==="toast"&&(D.textContent="",delete D.dataset.statusKind)},2500))}function Ii(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function wt(e){e=String(e||"").toLowerCase();let t={date:ht(),time:""},n=f=>{let g=new Date,y=g.getDay(),b=(f-y+7)%7,C=new Date(g);return C.setDate(g.getDate()+(b===0?7:b)),C},i=f=>{let g=new Date,y=g.getDay(),b=(f-y+7)%7,C=new Date(g);return C.setDate(g.getDate()+b),C},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},r={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=le(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),g=o[f[1]],y=n(g);t.date=le(y)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),g=o[f[1]],y=i(g);t.date=le(y)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),g=o[f[1]],y=n(g);t.date=le(y)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),g=parseInt(f[1],10),y=new Date;y.setDate(y.getDate()+g),t.date=le(y)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),g=parseInt(f[1],10),y=parseInt(f[2],10)-1,b=f[3]?parseInt(f[3],10):new Date().getFullYear(),C=new Date(b,y,g);t.date=le(C)}else for(let[f,g]of Object.entries(r)){let y=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(y.test(e)){let b=e.match(y),C=parseInt(b[1],10),x=new Date().getFullYear(),V=new Date(x,g,C);t.date=le(V);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let f=parseInt(d[1],10),g=d[2]?parseInt(d[2],10):0,y=d[3];y&&(y==="pm"&&f<12&&(f+=12),y==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(g).padStart(2,"0")}`}return t}let St=Z&&he&&typeof ct=="function";if(Ge.length){let e=async()=>{if(!St||typeof lt!="function"||typeof ut!="function"){v("Sign-in unavailable offline");return}let t=new ct;try{await lt(he,t)}catch{try{await ut(he,t)}catch{v("Google sign-in failed")}}};Ge.forEach(t=>{t.addEventListener("click",e)})}if(St&&typeof ft=="function"&&ft(he).catch(()=>{}),Ve.length){let e=async()=>{if(!St||typeof pt!="function"){v("Sign-out unavailable offline");return}try{await pt(he),v("Signed out")}catch{v("Sign-out failed")}};Ve.forEach(t=>{t.addEventListener("click",e)})}St&&typeof dt=="function"?dt(he,async e=>{e?(U=e.uid,Dt("online"),Ge.forEach(t=>t.classList.add("hidden")),Ve.forEach(t=>t.classList.remove("hidden")),ze&&(ze.textContent=e.displayName||e.email||""),Ai(),await ci()):un()}):un();function Ai(){if(!Z||!oe||typeof rt!="function"||typeof at!="function"||typeof st!="function"||typeof ot!="function")return;if(!U){jt(),B(),P(),fe();return}Oe&&Oe();let e=rt(oe,"users",U,"reminders"),t=at(e,st("updatedAt","desc"));Oe=ot(t,n=>{let i=[];n.forEach(o=>{let r=o.data(),d=Number(r.orderIndex);i.push({id:o.id,title:r.title,priority:r.priority,notes:r.notes||"",done:!!r.done,due:r.due||null,category:_(r.category),createdAt:r.createdAt?.toMillis?.()||0,updatedAt:r.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null})}),s=Pe(i),B(),P(),fe()},n=>{console.error("Firestore sync error:",n),M&&Dt("error","Sync Error")})}async function H(e){if(!(!Z||!U||!oe||typeof Te!="function"||typeof nt!="function"||typeof Fe!="function"))try{await nt(Te(oe,"users",U,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||$,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):Fe(),updatedAt:Fe()},{merge:!0})}catch(t){console.error("Save failed:",t),v("Save queued (offline)")}}async function Ti(e){if(!(!Z||!U||!oe||typeof Te!="function"||typeof it!="function"))try{await it(Te(oe,"users",U,"reminders",e))}catch{v("Delete queued (offline)")}}async function Ue(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||$,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function He(){S&&(S.value=""),F&&(F.value=""),R&&(R.value=""),Y&&(Y.value=""),Xe("Medium"),k&&(k.value=$),rn(),_e=null,De&&(De.textContent="Save Cue"),Lt?.classList.add("hidden")}function yn(e){let t=s.find(n=>n.id===e);t&&(S&&(S.value=t.title||""),F&&R&&(t.due?(F.value=wi(t.due),R.value=Si(t.due)):(F.value="",R.value="")),Xe(t?.priority||"Medium"),k&&(k.value=_(t.category)),Y&&(Y.value=typeof t.notes=="string"?t.notes:""),_e=e,De&&(De.textContent="Update Cue"),Lt?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),S?.focus(),de("cue:open",{mode:"edit"}))}function Ci(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=_(e.category??(k?k.value:"")),o={id:yt(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!U};_t(o,{position:"start"}),s=[o,...s],K(s);let r=$e(s);return be=!0,B(),P(),nn(o),r?s.forEach(d=>H(d)):H(o),Ue(o),we(o),Ne(),de("memoryCue:remindersUpdated",{items:s}),sn(),Q({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Li(e,t){if(!U)return v("Sign in to add notes"),null;if(!e)return null;let n=s.find(d=>d.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let r=typeof n.notes=="string"?n.notes:"";return n.notes=r?`${r}
${o}`:o,n.updatedAt=Date.now(),H(n),B(),P(),Q({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Di(e){let t=s.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),H(t),Ue(t),B(),P(),t.done?(It(e),Q({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(we(t),Q({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function xi(e){if(!z||z.tokenId!==e)return;let{item:t,index:n}=z;if(!t){Ee(e);return}Ee(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),s.length):s.length;t.pendingSync=!U,t.updatedAt=Date.now(),s.splice(i,0,t),K(s);let o=$e(s);be=!0,B(),P(),we(t),o?s.forEach(r=>H(r)):H(t),Ue(t),Ne(),de("memoryCue:remindersUpdated",{items:s}),Q({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),v("Reminder restored")}function hn(e){let t=s.findIndex(o=>o.id===e),n=t>=0?s.splice(t,1)[0]:null;B(),P(),Ti(e),It(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Q({action:"deleted",label:i}),n&&D){Ee();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;z={tokenId:o,item:n,index:t,timeoutId:null},_n(z),z.timeoutId=setTimeout(()=>{Ee(o)},On)}else n&&Ee()}function Ye(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=vt(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=vt(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function bn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}v("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function vn(){return Object.values(O||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||$,notes:typeof e.notes=="string"?e.notes:"",body:Ye(e),urlPath:e.urlPath||Je,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Ht(){try{localStorage.setItem("scheduledReminders",JSON.stringify(O))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=vn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Ct(),Xt(e,{requestCheck:t})}function Et(e,{closeNotification:t=!0}={}){if(t){let n=ae.get(e);if(n){try{n.close()}catch{}ae.delete(e)}}ve[e]&&(clearTimeout(ve[e]),delete ve[e]),Jt(e),O[e]&&(delete O[e],Ht())}function It(e){Et(e)}function wn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ae.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Ye(e),tag:e.id});ae.set(e.id,n);let i=()=>{ae.get(e.id)===n&&ae.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function ki(e){if(!se())return!1;let t=Rn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await me();if(!i)return!1;await Jt(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||$,body:r,urlPath:Je},r=Ye(e),d={body:r,tag:e.id,data:o,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function we(e){if(!e||!e.id)return;if(e.category=_(e.category),!e.due||e.done){It(e.id);return}let t=O[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||$,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Ye(e),urlPath:Je,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let d=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return d===e.due?f:null})()};if(O[e.id]=n,Ht(),ve[e.id]&&(clearTimeout(ve[e.id]),delete ve[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(O[e.id]?.viaTrigger){Et(e.id,{closeNotification:!1});return}wn(e),Et(e.id,{closeNotification:!1});return}let r=se();r&&(n.viaTrigger=!1,ki(e).then(d=>{d&&O[e.id]&&(O[e.id]={...O[e.id],viaTrigger:!0},Ht())})),ve[e.id]=setTimeout(()=>{r&&Jt(e.id),wn(e),Et(e.id,{closeNotification:!1})},o)}function fe(){Object.values(O).forEach(e=>we({...e,category:_(e?.category)}))}function Ni(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=yi.format(t),i=hi.format(t),o=vt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function B(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),ce(),K(s),Zt)try{Zt.textContent=String(s.length)}catch{}s.forEach(c=>{c&&typeof c=="object"&&(c.category=_(c.category))});let o=new Set(_i.map(c=>_(c)));s.forEach(c=>{c&&typeof c=="object"&&o.add(_(c.category))});let r=Array.from(o).sort((c,m)=>c.localeCompare(m,void 0,{sensitivity:"base"}));if(kt){let c=new Set;Array.from(kt.querySelectorAll("option")).forEach(m=>{c.add(m.value.trim().toLowerCase())}),r.forEach(m=>{let p=m.toLowerCase();if(!c.has(p)){let w=document.createElement("option");w.value=m,kt.appendChild(w),c.add(p)}})}if(be)be=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let c=s.map(m=>({...m}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:c}}));else if(document.createEvent){let m=document.createEvent("CustomEvent");m&&m.initCustomEvent&&(m.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:c}),document.dispatchEvent(m))}}catch{}}let d=s.slice();K(d);let f=!0,g=s.length>0,y=d.length>0,b=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let c=Object.values(O||{}).filter(m=>m&&typeof m=="object"&&m.id);return new Set(c.map(m=>m.id))})();if(Ae)if(y)Ae.classList.add("hidden");else{let c=g?"No reminders to show right now.":Jn;an?an(Ae,{icon:g?"sparkles":"bell",title:g?"Nothing to display":"Create your first cue",description:c,action:g?void 0:`<button type="button" class="${Qn}" data-trigger="open-cue">Create reminder</button>`}):Ae.textContent=c,Ae.classList.remove("hidden")}if(en&&en.classList.toggle("has-items",y),!E)return;if(!y){Ae?(E.innerHTML="",E.classList.add("hidden")):(E.innerHTML='<div class="text-muted">No reminders found.</div>',E.classList.remove("hidden"));return}E.classList.remove("hidden"),E.replaceChildren();let C=document.createDocumentFragment(),x=E.tagName==="UL"||E.tagName==="OL",V=!0,Se=(c,m)=>{let p=document.createElement("div");p.className="task-item";let w={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:m,done:!!c.done};p.dataset.category=m,p.dataset.reminder=JSON.stringify(w),p.dataset.id=w.id,p.dataset.title=w.title,p.dataset.priority=w.priority,p.dataset.done=String(w.done),p.dataset.orderIndex=Number.isFinite(c.orderIndex)?String(c.orderIndex):"",p.dataset.reminderItem="true",p.setAttribute("draggable","true"),p.classList.add("reminder-draggable"),p.setAttribute("role","button"),p.tabIndex=0,p.setAttribute("aria-label",`Edit reminder: ${c.title}`),w.dueIso&&(p.dataset.due=w.dueIso),b.has(w.id)?p.dataset.notificationActive="true":delete p.dataset.notificationActive;let N=w.dueIso?new Date(w.dueIso):null;f&&N&&N>=n&&N<=i&&(p.classList.add("is-today"),p.dataset.today="true");let pe=c.due?`${vt(new Date(c.due))} \u2022 ${Ut(c.due.slice(0,10))}`:"No due date",Le=m?ue(m):"",Yt=ue(w.priority),qt=[`<span class="task-chip" data-chip="due">${ue(pe)}</span>`,Le?`<span class="task-chip" data-chip="category">${Le}</span>`:"",`<span class="task-chip" data-chip="priority">${Yt}</span>`].filter(Boolean).join(""),Wt=c.notes?`<div class="task-notes">${gn(c.notes)}</div>`:"";p.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${ue(c.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          <div class="task-meta">
            <div class="task-meta-row" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              ${qt}
            </div>
          </div>
          ${Wt}
        </div>`;let En=p.querySelector("[data-del]");En&&En.addEventListener("click",J=>{J.stopPropagation(),hn(c.id)});let In=()=>yn(c.id);return p.addEventListener("click",J=>{J.defaultPrevented||J.target instanceof HTMLElement&&J.target.closest("[data-del]")||In()}),p.addEventListener("keydown",J=>{J.defaultPrevented||J.target===p&&(J.key==="Enter"||J.key===" ")&&(J.preventDefault(),In())}),p};if(ye!=="desktop"&&!V){d.forEach(c=>{let m=c.category||$;C.appendChild(Se(c,m))}),E.appendChild(C);return}let h=new Map;d.forEach(c=>{let m=c.category||$;h.has(m)||h.set(m,[]),h.get(m).push(c)});let I=Array.from(h.entries()).sort((c,m)=>c[0].localeCompare(m[0],void 0,{sensitivity:"base"})),L=!0;I.forEach(([c,m])=>{if(c!==$){let p=document.createElement(x?"li":"div");p.dataset.categoryHeading=c,x&&(p.setAttribute("role","presentation"),p.style.listStyle="none"),p.className=ye==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",L||(p.style.marginTop=ye==="desktop"?"1.25rem":"1rem");let w=document.createElement("div");w.setAttribute("role","heading"),w.setAttribute("aria-level","3"),w.className=ye==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let N=document.createElement("span");N.textContent=c;let X=document.createElement("span");X.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",X.textContent=`${m.length} ${m.length===1?"item":"items"}`,w.append(N,X),p.appendChild(w),C.appendChild(p)}m.forEach(p=>{if(ye==="desktop"){let w=document.createElement(x?"li":"div"),N={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:c,done:!!p.done};w.dataset.id=N.id,w.dataset.category=N.category,w.dataset.title=N.title,w.dataset.priority=N.priority,w.dataset.done=String(N.done),N.dueIso&&(w.dataset.due=N.dueIso),w.dataset.reminder=JSON.stringify(N),w.dataset.orderIndex=Number.isFinite(p.orderIndex)?String(p.orderIndex):"",w.dataset.reminderItem="true",w.setAttribute("draggable","true"),w.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200",b.has(N.id)?w.dataset.notificationActive="true":delete w.dataset.notificationActive;let X=Ni(p),pe=p.done?"line-through text-base-content/50":"text-base-content",Le=p.done?"Completed":"Active",Yt=p.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",qt=p.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Wt=p.notes?`<p class="text-sm leading-relaxed text-base-content/70">${gn(p.notes)}</p>`:"";w.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${pe}">${ue(p.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ue(X)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ue(c)}
            </span>
            <span class="${Yt} text-[0.7rem] sm:text-xs">${Le}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Wt}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${qt}">${p.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,w.querySelector('[data-action="toggle"]').addEventListener("click",()=>Di(p.id)),w.querySelector('[data-action="edit"]').addEventListener("click",()=>yn(p.id)),w.querySelector('[data-action="delete"]').addEventListener("click",()=>hn(p.id)),C.appendChild(w);return}C.appendChild(Se(p,c))}),L=!1}),E.appendChild(C)}function ee(){xe?.setAttribute("aria-expanded","false"),ke?.classList.add("hidden")}function Fi(){xe?.setAttribute("aria-expanded","true"),ke?.classList.remove("hidden")}xe?.addEventListener("click",e=>{e.stopPropagation(),xe.getAttribute("aria-expanded")==="true"?ee():Fi()}),document.addEventListener("click",e=>{ke&&!ke.classList.contains("hidden")&&!ke.contains(e.target)&&e.target!==xe&&ee()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ee()}),Gn.forEach(e=>{e.addEventListener("click",()=>{let t=Ke?.classList.contains("hidden");Ke?.classList.toggle("hidden"),t&&Ke?.scrollIntoView({behavior:"smooth",block:"start"}),ee()})}),document.addEventListener("DOMContentLoaded",()=>{Ke?.classList.add("hidden")});function Sn(){try{console.log("handleSaveAction invoked",{editingId:_e,title:S?.value})}catch{}if(_e){let i=s.find(f=>f.id===_e);if(!i){He();return}let o=S.value.trim();if(!o){v("Add a reminder title");return}let r=null;if(F.value||R.value){let f=F.value||ht(),g=R.value||"09:00";r=pn(f,g)}else{let f=wt(o);f.time&&(r=new Date(`${f.date}T${f.time}:00`).toISOString())}i.title=o;let d=Ft();i.priority=d,Xe(d),k&&(i.category=_(k.value)),i.due=r,Y&&(i.notes=Y.value.trim()),i.updatedAt=Date.now(),H(i),Ue(i),be=!0,B(),we(i),P(),Ne(),de("memoryCue:remindersUpdated",{items:s}),sn(),Q({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),He(),v("Reminder updated"),de("cue:close",{reason:"updated"});return}let e=S.value.trim();if(!e){v("Add a reminder title");return}let t=Y?Y.value.trim():"",n=null;if(F.value||R.value){let i=F.value||ht(),o=R.value||"09:00";n=pn(i,o)}else{let i=wt(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Ci({title:e,priority:Ft(),category:k?k.value:"",due:n,notes:t}),S.value="",R.value="",Y&&(Y.value=""),de("cue:close",{reason:"created"})}S?.addEventListener("keydown",e=>{e.key==="Enter"&&Sn()});function Ri(){if(!S||!ge)return;let e=S.value.trim();if(!e){ge.style.display="none";return}try{let t=wt(e),n=ht();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Ut(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(ge.textContent=`Parsed: ${i}`,ge.style.display="block"):ge.style.display="none"}else ge.style.display="none"}catch{ge.style.display="none"}}return S?.addEventListener("input",Ii(Ri,300)),Lt?.addEventListener("click",()=>{He(),v("Edit cancelled"),de("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{He()}),document.addEventListener("cue:prepare",()=>{He()}),window.addEventListener("load",()=>S?.focus()),Un?.addEventListener("click",()=>{let e=s.filter(t=>!t.done).map(t=>{let n=t.due?Ut(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Ce,{hour:"2-digit",minute:"2-digit",timeZone:re}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){v("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>v("Copied for Master Task List")).catch(()=>v("Copy failed")),ee()}),xt?.addEventListener("change",()=>{let e=xt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(r=>{let d={...r,id:yt(),category:_(r.category),pendingSync:!U,orderIndex:null};_t(d,{position:"start"}),s=[d,...s],i.push(d)}),K(s);let o=$e(s);B(),P(),o?s.forEach(r=>H(r)):i.forEach(r=>H(r)),v("Import successful")}catch{v("Invalid JSON")}},t.readAsText(e),xt.value="",ee()}),Hn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),ee()}),Yn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){v("Add your Apps Script URL in Settings first"),ee();return}if(!s.length){v("No tasks to sync"),ee();return}v("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<s.length;i+=t){let o=s.slice(i,i+t),r=await Promise.allSettled(o.map(d=>{let f={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||$,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=r.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}v(`Sync complete: ${s.length-n} ok${n?`, ${n} failed`:""}`),ee()}),Ie&&(Ie.value=localStorage.getItem("syncUrl")||""),qn?.addEventListener("click",()=>{Ie&&(localStorage.setItem("syncUrl",Ie.value.trim()),v("Settings saved"))}),Wn?.addEventListener("click",async()=>{if(!Ie)return;let e=Ie.value.trim();if(!e){v("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});v(t.ok?"Test ok":"Test failed")}catch{v("Test failed")}}),jn?.addEventListener("click",async()=>{if(!("Notification"in window)){v("Notifications not supported");return}if(Notification.permission==="granted"){v("Notifications enabled"),se()?me():(Ct(),bn()),fe(),B();return}try{await Notification.requestPermission()==="granted"?(v("Notifications enabled"),se()?me():(Ct(),bn()),fe(),B()):v("Notifications blocked")}catch{v("Notifications blocked")}}),si(),fe(),B(),P(),{cancelReminder:It,scheduleReminder:we,closeActiveNotifications:Bn,getActiveNotifications:()=>ae,addNoteToReminder:Li,__testing:{setItems(e=[]){s=Array.isArray(e)?e.map(t=>({...t,category:_(t?.category)})):[],s=Pe(s),K(s),B()},render:B,getItems:()=>s.map(e=>({...e}))}}}var xn,ae,kn,Gt,Vt,Nn,Tt,We,zt,$,_i,Kt,te,Pi,ne,Hi=Bi(()=>{xn="memoryCue:activity",ae=new Map,kn=!1,Gt="service-worker.js",Vt="memory-cue-reminder-sync",Nn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Tt=null,We=null,zt=!1,$="General",_i=Object.freeze([$,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Kt="memoryCue:offlineReminders",te=1024,Pi=Object.freeze({apiKey:"AIzaSyB8n0PCndJgHnU_i5y4PiFv8zn2eA1New0",authDomain:"memory-cue-pro.firebaseapp.com",projectId:"memory-cue-pro",storageBucket:"memory-cue-pro.firebasestorage.app",messagingSenderId:"494760962301",appId:"1:494760962301:web:52c0fe3567f0c8f8b9e5e6",measurementId:"G-1H4CPRO123"}),ne=null});export{Gi as a,Hi as b};
