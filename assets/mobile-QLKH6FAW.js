import{a as zt,b as xn,c as Vt,d as Nn,e as be,g as Mn}from"./chunk-6FIWU4IC.js";import{a as Pt,b as Bn}from"./chunk-MG4MJA24.js";import{b as $t,c as Fn}from"./chunk-CTK42JWW.js";import{b as qt,c as kn}from"./chunk-GUVSRPRW.js";var Fe,Ke,Dn,Ee,st,Yt,Wt,jt,lt,dt,Gt,ce,Ye,Kt,Hn,te,Z,at,q,J,Se,Jt,ve=qt(()=>{Fe="memoryCueNotes",Ke="memoryCueFolders",Dn=["mobileNotes"],Ee=()=>typeof localStorage<"u",st=null,Yt=o=>{st=typeof o=="function"?o:null},Wt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,jt=o=>{if(typeof o!="string")return"";let t=o.trim();return t.length?(/[<>]/.test(t),o):""},lt=o=>{if(typeof o!="string")return"";let t=o.trim();return t.length?/[<>]/.test(t)?o:jt(o):""},dt=(o="")=>{if(typeof document<"u"&&typeof document.createElement=="function"){let t=document.createElement("div");return t.innerHTML=typeof o=="string"?o:"",(t.textContent||t.innerText||"").trim()}return typeof o!="string"?"":o.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim()},Gt=o=>{if(typeof o!="string")return!1;let t=Date.parse(o);return!Number.isNaN(t)},ce=(o,t,s={})=>{let c=typeof o=="string"?o.trim():"",m=typeof s.bodyHtml=="string"&&s.bodyHtml.length?s.bodyHtml:t,l=lt(m),u=typeof s.bodyText=="string"?s.bodyText:null,g=u&&u.trim().length?u.trim():dt(l);return{id:s.id&&typeof s.id=="string"?s.id:Wt(),title:c||"Untitled note",body:l,bodyHtml:l,bodyText:g,updatedAt:s.updatedAt&&Gt(s.updatedAt)?s.updatedAt:new Date().toISOString(),folderId:s.folderId&&typeof s.folderId=="string"?s.folderId:null}},Ye=o=>{if(Array.isArray(o))return o.map(t=>{if(!t||typeof t!="object")return null;let s=typeof t.title=="string"?t.title.trim():"",c=typeof t.bodyHtml=="string"&&t.bodyHtml.length?t.bodyHtml:t.body,m=lt(c),l=typeof t.bodyText=="string"&&t.bodyText.trim().length?t.bodyText.trim():dt(m),u=typeof t.id=="string"&&t.id.trim()?t.id:Wt(),g=Gt(t.updatedAt)?t.updatedAt:new Date().toISOString();return!s&&!m&&!t.body?null:{id:u,title:s||"Untitled note",body:m,bodyHtml:m,bodyText:l,updatedAt:g,folderId:typeof t.folderId=="string"&&t.folderId?t.folderId:null}}).filter(Boolean);if(o&&typeof o=="object"){let t=typeof o.title=="string"?o.title:"",s=typeof o.bodyHtml=="string"&&o.bodyHtml.length?o.bodyHtml:typeof o.body=="string"?o.body:"",c=lt(s),m=typeof o.bodyText=="string"&&o.bodyText.trim().length?o.bodyText.trim():dt(c);return!t&&!c?[]:[ce(t,c,{id:typeof o.id=="string"?o.id:void 0,updatedAt:typeof o.updatedAt=="string"?o.updatedAt:void 0,folderId:typeof o.folderId=="string"?o.folderId:void 0,bodyHtml:c,bodyText:m})]}return typeof o=="string"&&o.trim().length?[ce("Notebook (legacy)",jt(o))]:[]},Kt=o=>{if(!Ee())return null;try{return localStorage.getItem(o)}catch{return null}},Hn=o=>{if(Ee())try{localStorage.removeItem(o)}catch{}},te=()=>{if(!Ee())return[];let o=Kt(Fe);if(typeof o=="string")try{let t=JSON.parse(o),s=Ye(t);if(s.length)return s}catch{let t=Ye(o);if(t.length)return Z(t),t}for(let t of Dn){let s=Kt(t);if(typeof s=="string"&&s.trim().length){let c=Ye(s);if(c.length)return Z(c),Hn(t),c}}return[]},Z=(o,t={})=>{if(!Ee()||!Array.isArray(o))return!1;let s=o.map(c=>{let l=Ye([c])[0];return l&&(l.folderId=typeof c.folderId=="string"&&c.folderId?c.folderId:l.folderId||null),l}).filter(Boolean);try{if(localStorage.setItem(Fe,JSON.stringify(s)),!t.skipRemoteSync&&typeof st=="function")try{let c=st(s);c&&typeof c.then=="function"&&c.catch(m=>{console.error("[notes-storage] Remote sync failed.",m)})}catch(c){console.error("[notes-storage] Remote sync handler threw.",c)}return!0}catch{return!1}},at=()=>[{id:"unsorted",name:"Unsorted"}],q=()=>{if(!Ee())return at();try{let t=localStorage.getItem(Ke);if(typeof t=="string"){let s=JSON.parse(t);if(Array.isArray(s)&&s.length){let c=!1,m=s.map((l,u)=>{let g=String(l.id),B=typeof l.name=="string"?l.name:String(l.id),F=typeof l.order=="number"?l.order:u;return typeof l.order!="number"&&(c=!0),{id:g,name:B,order:F}});if(c)try{localStorage.setItem(Ke,JSON.stringify(m))}catch{}return m}}}catch{}let o=at();try{localStorage.setItem(Ke,JSON.stringify(o))}catch{}return o},J=o=>{let s=q().find(c=>c&&String(c.id)===String(o));return s?String(s.name):"Unsorted"},Se=o=>{if(!Ee()||!Array.isArray(o))return!1;try{let t=o.filter(s=>s&&typeof s.id=="string"&&s.id.trim()).map((s,c)=>({id:s.id,name:typeof s.name=="string"?s.name:String(s.id),order:typeof s.order=="number"?s.order:c}));return t.length||t.push(...at()),localStorage.setItem(Ke,JSON.stringify(t)),!0}catch{return!1}},Jt=(o,t)=>{if(!o||typeof o!="string")return!1;let s=te(),c=!1,m=s.map(u=>u.id===o?(c=!0,{...u,folderId:t&&typeof t=="string"?t:null,updatedAt:new Date().toISOString()}):u);return c?Z(m):!1}});var On,_n,Un,We,Rn,qn,Qt,Xt=qt(()=>{Fn();ve();On="notes",_n="user_id",Un="updated_at",We=o=>{if(typeof o!="string")return 0;let t=Date.parse(o);return Number.isNaN(t)?0:t},Rn=(o=[],t=[])=>{let s=new Map;return t.forEach(c=>{c&&typeof c.id=="string"&&s.set(c.id,c)}),o.forEach(c=>{if(!c||typeof c.id!="string")return;let m=s.get(c.id);if(!m){s.set(c.id,c);return}let l=We(c.updatedAt),u=We(m.updatedAt);l>u&&s.set(c.id,c)}),Array.from(s.values()).sort((c,m)=>We(m?.updatedAt)-We(c?.updatedAt))},qn=o=>t=>{if(!t||typeof t!="object")return null;let s=(typeof t.body_html=="string"&&t.body_html.length?t.body_html:null)??t.body,c={id:typeof t.id=="string"&&t.id?t.id:void 0,updatedAt:typeof t[o]=="string"?t[o]:void 0,folderId:typeof t.folder_id=="string"&&t.folder_id?t.folder_id:void 0,bodyHtml:s,bodyText:typeof t.body_text=="string"?t.body_text:void 0};return ce(t.title,s,c)},Qt=(o={})=>{let{tableName:t=On,userColumn:s=_n,updatedAtColumn:c=Un,supabase:m=null}=o,l=m||null,u=null,g=!1,B=new Set,F=null,C=()=>l||(l=$t(),l),E=qn(c),P=async()=>(!u||g||F||(F=k().catch(()=>{}).finally(()=>{F=null})),F),z=async H=>{let x=C();if(!x||!u)return;let O=(Array.isArray(H)?H.filter(T=>T&&typeof T.id=="string"):[]).map(T=>({id:T.id,[s]:u,title:T.title,body:typeof T.bodyHtml=="string"&&T.bodyHtml.length?T.bodyHtml:T.body,folder_id:typeof T.folderId=="string"&&T.folderId?T.folderId:null,[c]:typeof T.updatedAt=="string"&&T.updatedAt?T.updatedAt:new Date().toISOString()})),G=new Set(O.map(T=>T.id));if(O.length){let{error:T}=await x.from(t).upsert(O);if(T)throw T}let K=[...B].filter(T=>T&&!G.has(T));if(K.length){let{error:T}=await x.from(t).delete().in("id",K).eq(s,u);if(T)throw T}B=new Set(G)},k=async()=>{let H=C();if(!(!H||!u))try{let{data:x,error:R}=await H.from(t).select(`id,title,body,folder_id,${c}`).eq(s,u);if(R)throw R;let O=Array.isArray(x)?x:[];B=new Set(O.map($=>typeof $.id=="string"?$.id:null).filter(Boolean));let G=O.map(E).filter(Boolean),K=te();if(!G.length){if(K.length)try{await z(K)}catch($){console.error("[notes-sync] Failed to upload local notes to Supabase.",$)}return}let T=Rn(K,G);g=!0;let Q=Z(T,{skipRemoteSync:!0});g=!1,Q||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await z(T)}catch($){console.error("[notes-sync] Failed to reconcile notes with Supabase.",$)}}catch(x){console.error("[notes-sync] Failed to fetch notes from Supabase.",x)}finally{g=!1}};Yt(async H=>{if(!g)try{await z(H)}catch(x){console.error("[notes-sync] Failed to sync notes to Supabase.",x)}});let j=async H=>{if(u=typeof H?.id=="string"?H.id:null,!u){B=new Set;return}await k()};return typeof window<"u"&&(window.addEventListener("online",P),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&P()})),{setSupabaseClient(H){H&&(l=H)},handleSessionChange:j,syncFromRemote:k}}});var Pn=kn(()=>{Bn();Nn();xn();ve();ve();ve();Xt();Mn();ve();Pt();(function(){let o=()=>{let t=document.getElementById("create-sheet"),s=document.getElementById("closeCreateSheet");if(!(t instanceof HTMLElement)||!(s instanceof HTMLElement)){let i=typeof o._retryCount=="number"?o._retryCount:0;i<10&&(o._retryCount=i+1,setTimeout(o,50));return}if(o._initialised)return;o._initialised=!0;let c=t.querySelector("[data-dialog-content]"),m=t.querySelector(".sheet-backdrop"),l=document.getElementById("createReminderForm"),u=document.getElementById("saveReminder"),g=document.getElementById("priority"),B=document.getElementById("priorityChips"),F=t.querySelector(".reminder-editor-shell"),C=t.querySelector(".notif-switch-row"),E=t.querySelector("#notifBtn"),P=B?Array.from(B.querySelectorAll('input[name="priority"]')):[],z=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),k=Array.from(z).filter(i=>i instanceof HTMLElement),j=k[0]||null,H=()=>{t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open")};H(),[C,E].forEach(i=>{i?.addEventListener("click",h=>h.stopPropagation())});let x=null,R=(i,h)=>{try{document.dispatchEvent(new CustomEvent(i,{detail:h}))}catch(I){console.warn(`${i} dispatch failed`,I)}},O=()=>{let i=g?.value||"Medium";P.forEach(h=>{let I=h.value===i;h.checked=I,h.setAttribute("aria-checked",I?"true":"false")})},G=i=>{g&&(g.value!==i&&(g.value=i,g.dispatchEvent(new Event("change",{bubbles:!0}))),O())};P.forEach(i=>{i.addEventListener("change",()=>{i.checked&&G(i.value)})}),g?.addEventListener("change",O),O();let K=()=>{let i=t.querySelector('input, textarea, select, button, [contenteditable="true"]');i instanceof HTMLElement&&setTimeout(()=>{try{i.focus()}catch{}},0)},T=()=>{F instanceof HTMLElement&&(F.classList.remove("reminder-enter","reminder-enter-active"),F.offsetWidth,F.classList.add("reminder-enter"),requestAnimationFrame(()=>{F.classList.add("reminder-enter-active")}))},Q=i=>{x=i instanceof HTMLElement?i:null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),x&&x.setAttribute("aria-expanded","true"),O(),K(),T(),R("reminder:sheet-opened",{trigger:x})},$=(i="dismissed")=>{let h=!t.classList.contains("hidden");F&&F.classList.remove("reminder-enter","reminder-enter-active"),H(),x&&x.setAttribute("aria-expanded","false");let I=x&&document.body.contains(x)&&x||j;if(I&&typeof I.focus=="function")try{I.focus()}catch{}h&&R("reminder:sheet-closed",{reason:i,trigger:x}),x=null};k.forEach(i=>{i.addEventListener("click",h=>{h.preventDefault();let I={mode:"create",trigger:i};R("cue:prepare",I),R("cue:open",I)})}),s.addEventListener("click",i=>{i.preventDefault(),$("close-button")}),m?.addEventListener("click",i=>{i.target===m&&$("backdrop")}),t.addEventListener("keydown",i=>{i.key==="Escape"&&(i.stopPropagation(),$("escape"))}),c?.addEventListener("click",i=>{i.stopPropagation()}),t.addEventListener("click",i=>{i.target instanceof HTMLElement&&i.target.hasAttribute("data-close")&&$("backdrop")}),document.addEventListener("cue:open",i=>{O(),Q(i?.detail?.trigger||null)}),document.addEventListener("cue:close",i=>{$(i?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{O()}),document.addEventListener("cue:cancelled",()=>{$("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=$),document.addEventListener("reminder:save",i=>{if(!(u instanceof HTMLElement))return;let h=i?.detail?.trigger;h&&h!==u||u.matches(":disabled")||u.click()}),l instanceof HTMLFormElement&&u instanceof HTMLElement&&l.addEventListener("submit",i=>{i.preventDefault(),!u.matches(":disabled")&&u.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o()})();(function(){let o=!1;try{typeof localStorage<"u"&&localStorage.getItem("mc_debug_freeze")==="1"&&(o=!0)}catch{o=!1}try{if(!o){let l=typeof location<"u"?new URL(location.href):null;l&&l.searchParams.has("debugFreeze")&&(o=!0)}}catch{}if(!o)return;function t(l){if(!l)return null;try{let u=l.tagName,g=l.id?`#${l.id}`:"",B=l.className?`.${String(l.className).split(/\s+/).slice(0,3).join(".")}`:"";return`${u}${g}${B}`}catch{return String(l)}}function s(){let l=[[window.innerWidth/2,window.innerHeight/2],[10,10],[window.innerWidth-10,10],[10,window.innerHeight-10],[window.innerWidth-10,window.innerHeight-10]],u=new Set;for(let[g,B]of l)try{let F=document.elementFromPoint(g,B);if(!F)continue;let C=F;for(;C;)u.add(C),C=C.parentElement}catch{}return Array.from(u)}function c(l){try{if(!l||!(l instanceof HTMLElement))return;l.dataset._mcDebugOutline="1",l.style.outline="3px solid rgba(255,0,0,0.9)",l.style.zIndex="999999"}catch{}}function m(){try{document.querySelectorAll("[data-_mcDebugOutline]").forEach(l=>{l.style.outline="",l.style.zIndex="",l.removeAttribute("data-_mcDebugOutline")})}catch{}}window.mcDebugFindOverlay=function(){try{let u=s();return console.info("[mc.debug] overlay candidates:",u.map(t)),u}catch(u){return console.warn("[mc.debug] find failed",u),[]}},console.info("[mc.debug] freeze detector enabled \u2014 use `mcDebugFindOverlay()` or click to highlight blockers"),document.addEventListener("click",function(l){try{console.info("[mc.debug] click target:",t(l.target)),m();let u=s();u.slice(0,6).forEach(c),console.info("[mc.debug] highlighted candidates:",u.map(t)),setTimeout(m,2500)}catch(u){console.warn("[mc.debug] click handler failed",u)}},!0)})();var je=()=>{je._initialised||(je._initialised=!0,Vt({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(o=>{console.error("Failed to initialise reminders:",o)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",je,{once:!0}):je();var Zt=()=>{let o=document.getElementById("notifHeaderBtn"),t=document.getElementById("notifBtn");o&&t&&o.addEventListener("click",()=>{t.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Zt,{once:!0}):Zt();var en=()=>{if(typeof document>"u")return;let o=document.getElementById("noteTitleMobile"),t=document.getElementById("notebook-editor-body"),s=document.getElementById("noteSaveMobile"),c=document.getElementById("noteNewMobile"),m=document.getElementById("notesListMobile"),l=document.getElementById("notesCountMobile"),u=document.getElementById("notebook-search-input"),g=document.getElementById("savedNotesSheet"),B=document.getElementById("openSavedNotesSheet"),F=document.querySelector('[data-action="close-saved-notes"]'),C=document.getElementById("moveFolderSheet"),E=document.getElementById("move-folder-list"),P=document.getElementById("move-folder-create"),z=document.getElementById("move-folder-cancel"),k=C?.querySelector(".sheet-panel"),j="shadow-[0_0_0_3px_var(--accent-color)]",H=({ModalController:e,saveFolders:n,getFolders:r,getFolderNameById:d})=>{let a=document.getElementById("note-new-folder-button"),f=document.getElementById("newFolderModal"),y=document.getElementById("newFolderName"),D=document.getElementById("newFolderCreate"),A=document.getElementById("newFolderCancel"),v=document.getElementById("newFolderError");if(!a||!f)return!1;let p=null,S=null,_=()=>{v&&(v.classList.add("sr-only"),v.textContent="")},X=U=>{v&&(v.textContent=U,v.classList.remove("sr-only"))},ke=()=>{p||(p=new e({modalElement:f,closeButton:A,titleInput:y,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),_(),y&&(y.value=""),p.show()},ze=()=>{if(!y)return null;let U=String(y.value||"").trim();if(_(),!U.length)return X("Folder name can't be empty."),null;let V=[];try{let Be=r();V=Array.isArray(Be)?Be:[]}catch{V=[]}if(V.some(Be=>String(Be.name).toLowerCase()===U.toLowerCase()))return X("You already have a folder with this name."),null;let it=Date.now().toString(36),In=Math.random().toString(36).substring(2,8),Rt=`folder-${it}-${In}`,Tn={id:Rt,name:U},Cn=[...V.filter(Boolean),Tn];if(!n(Cn))return X("Unable to create folder. Please try again."),null;try{p.requestClose("created")}catch{}return{id:Rt,name:U}},Ve=()=>{let U=ze();if(U&&typeof S=="function"){try{S(U)}catch(V){console.warn("[notebook] folder callback failed",V)}S=null}};return a.addEventListener("click",U=>{U.preventDefault(),S=V=>{if(!V)return;let rt=document.getElementById("note-folder-label");rt&&(rt.textContent=d(V.id)||V.name||"Unsorted");try{document.dispatchEvent(new CustomEvent("memoryCue:folderCreatedFromEditor",{detail:{folderId:V.id,folderName:V.name}}))}catch(it){console.warn("[notebook] failed to dispatch folder created event",it)}},ke()}),D&&D.addEventListener("click",U=>{U.preventDefault(),Ve()}),y&&y.addEventListener("keydown",U=>{U.key==="Enter"&&(U.preventDefault(),Ve())}),A&&A.addEventListener("click",()=>{S=null}),!0},R=(()=>{if(!t)return null;let e=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return e?new e("#notebook-editor-body",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(t.setAttribute("contenteditable","true"),t.setAttribute("role","textbox"),t.setAttribute("aria-multiline","true"),t.dataset.placeholder="Start typing your note\u2026",{element:t,setContent(n=""){t.innerHTML=n||""},getHTML(){return t.innerHTML||""},getText(){return t.textContent||""},focus(){try{t.focus()}catch{}}})})();if(!o||!R||!t||!s)return;let O=e=>{e&&document.execCommand(e,!1,null)},G=document.getElementById("scratchNotesToolbar");G&&G.addEventListener("click",e=>{let n=e.target.closest("button[data-format]");if(!n)return;switch(n.getAttribute("data-format")){case"bold":O("bold");break;case"italic":O("italic");break;case"underline":O("underline");break;case"bullet-list":O("insertUnorderedList");break;case"numbered-list":O("insertOrderedList");break;default:break}});let K=(e="")=>{let n=typeof e=="string"?e:"";if(R&&typeof R.setContent=="function"){R.setContent(n||"");return}let r=/<\/?[a-z][\s\S]*>/i.test(n);t.innerHTML="",r?t.innerHTML=n||"":t.textContent=n||""},T=()=>R&&typeof R.getHTML=="function"?R.getHTML()||"":t.innerHTML||"",Q=()=>R&&typeof R.getText=="function"?R.getText()||"":t.textContent||"",$=e=>{let n=e;for(;n&&n!==t;){if(n.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(n.tagName?.toLowerCase()))return n;n=n.parentNode}return t},i=e=>{if(typeof e!="string")return null;let n=e.replace(/\u00a0/g," ");return/^\s*[\*-]\s*$/.test(n)?"ul":/^\s*1\.?\s*$/.test(n)?"ol":null},h=e=>{e.key===" "&&setTimeout(()=>{let n=window.getSelection();if(!n||n.rangeCount===0)return;let r=n.getRangeAt(0);if(!t.contains(r.startContainer))return;let d=$(r.startContainer),a=r.cloneRange();a.selectNodeContents(d),a.setEnd(r.startContainer,r.startOffset);let f=a.toString(),y=i(f);y&&(e.preventDefault(),a.deleteContents(),O(y==="ul"?"insertUnorderedList":"insertOrderedList"))},0)},I=e=>{if(!e||e.altKey||!(e.ctrlKey||e.metaKey))return;let n=(e.key||"").toLowerCase(),r=null;n==="b"?r="bold":n==="i"?r="italic":n==="u"&&(r="underline"),r&&(e.preventDefault(),O(r))},M=(e,n=200)=>{let r;return(...d)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...d)},n)}},L=null,w=[],b="all",N="unsorted",ue=null,Y=null,xe=null,Ne="",Le=!1,fe=null,Ge=()=>{Ne="",u&&(u.value="")},ft=()=>g?.dataset.open==="true",tn=()=>{if(g){fe&&(clearTimeout(fe),fe=null),g.classList.remove("hidden"),g.dataset.open="true",g.setAttribute("aria-hidden","false");try{ee()}catch{}try{ae()}catch{}}},Me=()=>{g&&(g.dataset.open="false",g.setAttribute("aria-hidden","true"),fe&&clearTimeout(fe),fe=setTimeout(()=>{g?.classList.add("hidden")},200))};(()=>{g&&(B?.addEventListener("click",e=>{e.preventDefault(),tn();let n=document.getElementById("notesListMobile");n&&(n.scrollTop=0)}),F?.addEventListener("click",e=>{e.preventDefault(),Me()}),g.addEventListener("click",e=>{e.target===g&&Me()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ft()&&Me()}))})();let mt=()=>typeof Ne=="string"?Ne.trim().toLowerCase():"",nn=(e=w)=>{if(!Array.isArray(e))return[];let n=mt();return n?e.filter(r=>{let d=typeof r?.title=="string"?r.title.toLowerCase():"",a=rn(r).toLowerCase();return d.includes(n)||a.includes(n)}):[...e]},yt=(e=w)=>{if(!Array.isArray(e))return[];let n;return b===null||b==="all"?n=[...e]:b==="unsorted"?n=e.filter(r=>!r.folderId||r.folderId==="unsorted"):n=e.filter(r=>r.folderId===b),nn(n)},on=(e=[],n=[])=>{let r={all:Array.isArray(e)?e.length:0,unsorted:0};return(Array.isArray(n)?n:[]).forEach(d=>{d&&d.id&&d.id!=="unsorted"&&(r[d.id]=0)}),(Array.isArray(e)?e:[]).forEach(d=>{let a=d?.folderId||"unsorted";!a||a==="unsorted"?r.unsorted+=1:Object.prototype.hasOwnProperty.call(r,a)?r[a]+=1:r.unsorted+=1}),r},ne=e=>{if(!e){L=null,o&&(o.value=""),K(""),o&&delete o.dataset.noteOriginalTitle,t&&(t.dataset.noteOriginalBody="");let a=document.getElementById("note-folder-label");a&&(a.textContent=J(N||"unsorted"));return}if(L===e.id)return;L=e.id;let n=e.title||"",r=(typeof e.bodyHtml=="string"&&e.bodyHtml.trim().length?e.bodyHtml:typeof e.body=="string"?e.body:"")||"";o&&(o.value=n),K(r),o&&(o.dataset.noteOriginalTitle=n),t&&(t.dataset.noteOriginalBody=r),N=e.folderId&&typeof e.folderId=="string"?e.folderId:"unsorted";let d=document.getElementById("note-folder-label");d&&(d.textContent=J(N))},Je=(e="")=>{let n=document.createElement("div");return n.innerHTML=typeof e=="string"?e:"",(n.textContent||n.innerText||"").trim()},rn=e=>{if(!e)return"";if(typeof e.bodyText=="string"&&e.bodyText.trim().length)return e.bodyText.trim();let n=typeof e.bodyHtml=="string"&&e.bodyHtml.trim().length?e.bodyHtml:typeof e.body=="string"?e.body:"";return Je(n)},sn=()=>{let e=t.innerHTML||"",n=Je(e);return{title:typeof o.value=="string"?o.value.trim():"",bodyHtml:e,bodyText:n}},we=()=>{if(!m)return;m.querySelectorAll('[data-role="open-note"][data-note-id]').forEach(n=>{if(!(n instanceof HTMLElement))return;let r=n.getAttribute("data-note-id")===L;r?n.setAttribute("data-state","active"):n.removeAttribute("data-state"),n.classList.toggle("active",r),n.classList.toggle("outline",r),n.classList.toggle("outline-2",r),n.classList.toggle("outline-accent",r),n.classList.toggle(j,r),n.setAttribute("aria-current",r?"true":"false")})},zn=e=>{if(!e)return"";let n=new Date(e);if(Number.isNaN(n.getTime()))return"";let r=new Date,d=n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()&&n.getDate()===r.getDate(),a=n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return d?`Today \xB7 ${a}`:`${n.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${a}`},Qe=()=>{let e=typeof o.value=="string"?o.value:"",n=T(),r=o.dataset.noteOriginalTitle??"",d=t.dataset.noteOriginalBody??"";return e!==r||n!==d},pt=e=>{if(!e)return 0;let n=[e.updatedAt,e.modifiedAt,e.createdAt];for(let r of n){let d=Date.parse(r||"");if(!Number.isNaN(d))return d}return 0},ln=()=>{let e=te();return Array.isArray(e)?[...e].sort((n,r)=>pt(r)-pt(n)):[]},Xe=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(Fe)}catch{return null}},Ae=Xe(),De=()=>(Ae=Xe(),Ae),me=({preserveDraft:e=!0}={})=>{let n=ln();w=Array.isArray(n)?[...n]:[];try{ee()}catch{}let r=e&&Qe(),d=w.length>0,a=yt();if(Ze(a),!d)return r||ne(null),we(),De(),Le=!1,a;if(L){let f=w.find(y=>y.id===L)||null;f?r||ne(f):(L=null,!r&&!Le&&w[0]&&ne(w[0]))}else!r&&!Le&&w[0]&&ne(w[0]);return Le=!1,we(),De(),a},dn=160,an=e=>{let n=e||"folder",r=document.createElement("div");r.className="note-toast",r.textContent=`Moved to ${n}`,document.body.appendChild(r),setTimeout(()=>{r&&r.parentNode&&r.parentNode.removeChild(r)},2800)},cn=typeof requestAnimationFrame=="function"?requestAnimationFrame:e=>setTimeout(e,0),un=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:e=>clearTimeout(e),He=null,Oe=null,fn=e=>{if(typeof e=="function"){if(!m){e();return}He&&(clearTimeout(He),He=null),Oe&&(un(Oe),Oe=null),m.classList.remove("notebook-list-transition-in","notebook-list-transition-in-active"),m.classList.add("notebook-list-transition-out"),He=setTimeout(()=>{e(),m.classList.remove("notebook-list-transition-out"),m.classList.add("notebook-list-transition-in"),Oe=cn(()=>{m.classList.add("notebook-list-transition-in-active")})},dn)}},mn=e=>{if(!e)return;let n=te();if(!Array.isArray(n))return;let r=n.filter(d=>d.id!==e);r.length!==n.length&&(Z(r),De(),L===e&&(ne(null),Le=!0),me({preserveDraft:!1}))},Ze=(e=[],{withTransition:n=!0}={})=>{if(n)return fn(()=>Ze(e,{withTransition:!1})),e;if(!m)return e;if(m.innerHTML="",l){let r=w.length,d=e.length;l.textContent=r?`${d} of ${r} saved`:"No saved notes yet"}if(!e.length){let r=!!mt(),f=r?"No notes match this filter":!b||b==="all"?"You don't have any notes yet.":b&&b!=="all"&&b!=="unsorted"?"Empty folder":"No notes here yet",y=r?"Try adjusting your search or filters.":"Create your first note in this folder to get started.";return m.innerHTML=`
        <div class="notebook-empty-state">
          <div class="notebook-empty-illustration" aria-hidden="true">\u{1F4C2}</div>
          <h3 class="notebook-empty-title">${f}</h3>
          <p class="notebook-empty-body">${y}</p>
        </div>
      `,e}return e.forEach(r=>{let d=document.createElement("article");d.className="premium-note-card note-item-mobile notebook-note-card",d.dataset.noteId=r.id,d.dataset.role="open-note",d.setAttribute("role","button"),d.tabIndex=0;let a=document.createElement("div");a.className="notebook-note-row";let f=r.title||"Untitled",y=document.createElement("h4");y.className="note-card-title line-clamp-2",y.textContent=f,y.setAttribute("title",f);let D=r.folderId&&typeof r.folderId=="string"?r.folderId:"unsorted",A=document.createElement("span");A.className="note-card-folder";let v=J(D)||"Unsorted";A.textContent=v;let p=document.createElement("button");p.type="button",p.dataset.noteId=r.id,p.dataset.role="note-menu",p.className="note-card-action",p.setAttribute("aria-label","Note actions"),p.innerHTML=`
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="5" cy="12" r="1.5" />
          <circle cx="12" cy="12" r="1.5" />
          <circle cx="19" cy="12" r="1.5" />
        </svg>
      `,a.appendChild(y),a.appendChild(A),a.appendChild(p),d.appendChild(a),m.appendChild(d)}),we(),e},gt=()=>document.getElementById("notebook-folder-bar"),ht=e=>{let n=gt();if(!n)return;n.querySelectorAll(".notebook-folder-chip").forEach(d=>{let a=String(d.dataset.folderId)===String(e);if(d.classList.toggle("notebook-folder-chip--active",a),d.classList.toggle("active",a),a)try{d.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}catch{try{d.scrollIntoView()}catch{}}})},ee=()=>{let e=gt();if(!e)return;e.innerHTML="";let n=document.createElement("div");n.className="notebook-folder-filter-bar";let r=[];try{r=Array.isArray(q())?q():[]}catch{r=[]}let d=Array.isArray(r)?r.filter(Boolean):[],a=d.find(S=>S&&S.id==="unsorted")||{id:"unsorted",name:"Unsorted"},f=d.filter(S=>S&&S.id!=="unsorted").sort((S,_)=>String(S.name||"").localeCompare(String(_.name||""),void 0,{sensitivity:"base"})),y=[a,...f],D=on(w,y),A=[{id:"all",name:"All notes",isVirtual:!0},{...a,isVirtual:!1},...f.map(S=>({...S,isVirtual:!1}))],v=S=>{let _=document.createElement("button");_.type="button",_.className="folder-chip notebook-folder-chip",_.dataset.folderId=S.id;let X=document.createElement("span");X.className="notebook-folder-chip-label",X.textContent=S.name,_.appendChild(X);let ke=document.createElement("span");ke.className="notebook-folder-chip-count";let ze=S.id==="all"?"all":S.id||"unsorted",Ve=typeof D[ze]=="number"?D[ze]:0;if(ke.textContent=Ve,_.appendChild(ke),_.addEventListener("click",()=>{b=S.id==="all"?"all":S.id,ht(b),Ge(),ae()}),S.id!=="all"&&S.id!=="unsorted"){let U=document.createElement("button");U.type="button",U.className="notebook-folder-chip-overflow",U.setAttribute("aria-label","Folder options"),U.innerHTML="\u22EF",U.addEventListener("click",V=>{V.stopPropagation(),bn(S.id,_)}),_.appendChild(U)}return _};A.forEach(S=>{n.appendChild(v(S))});let p=document.createElement("button");p.type="button",p.className="folder-chip outlined notebook-folder-chip notebook-folder-chip--new",p.dataset.folderId="new-folder",p.innerHTML='<span class="notebook-folder-chip-icon">+</span><span>New folder</span>',p.addEventListener("click",S=>{S.preventDefault();try{vt()}catch(_){console.warn("[notebook] failed to open new folder dialog",_)}}),n.appendChild(p),e.appendChild(n),ht(b)},Vn=()=>{try{ee()}catch(e){console.warn("[notebook] Unable to build folder bar",e)}},bt=document.getElementById("newFolderModal"),oe=document.getElementById("newFolderName"),ye=document.getElementById("newFolderError"),Et=document.getElementById("newFolderCreate"),et=document.getElementById("newFolderCancel"),_e=null,pe=null,St=()=>{ye&&(ye.classList.add("sr-only"),ye.textContent="")},tt=e=>{ye&&(ye.textContent=e,ye.classList.remove("sr-only"))},vt=()=>{bt&&(_e||(_e=new be({modalElement:bt,closeButton:et,titleInput:oe,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),St(),oe&&(oe.value=""),_e.show())},Lt=()=>{if(!oe)return;let n=String(oe.value||"").trim();if(St(),!n.length){tt("Folder name can't be empty.");return}let r=[];try{r=Array.isArray(q())?q():[]}catch{r=[]}if(r.some(A=>String(A.name).toLowerCase()===n.toLowerCase())){tt("You already have a folder with this name.");return}let a=`folder-${Date.now().toString(36)}`,f={id:a,name:n},y=[...r.filter(Boolean),f];if(!Se(y))return tt("Unable to create folder. Please try again."),null;try{_e.requestClose("created")}catch{}b=a,Ge();try{ee()}catch(A){console.warn("[notebook] rebuild folder chips failed",A)}if(ae(),typeof pe=="function"){try{pe(a,n)}catch(A){console.warn("[notebook] post-create handler failed",A)}pe=null}return a};Et&&Et.addEventListener("click",e=>{e.preventDefault(),Lt()}),oe&&oe.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Lt())}),et&&et.addEventListener("click",()=>{pe=null});let wt=document.getElementById("pickFolderModal"),Ue=document.getElementById("pickFolderList"),At=document.getElementById("pickFolderConfirm"),yn=document.getElementById("pickFolderCancel"),Re=null,re=null,Ie=null,It=e=>{if(e){if(Ie){try{Ie(e)}catch(n){console.warn("[notebook] folder pick handler failed",n)}Ie=null}else{N=e==="unsorted"?"unsorted":e;let n=document.getElementById("note-folder-label");n&&(n.textContent=J(N))}try{Re?.requestClose("selected")}catch{}}},Kn=(e={})=>{let{initialFolderId:n=null,onConfirm:r=null}=e||{};if(!wt||!Ue)return;re=(n&&typeof n=="string"?n:N)||"unsorted",Ie=typeof r=="function"?r:null,Ue.innerHTML="";let d=[];try{d=Array.isArray(q())?q():[]}catch{d=[]}d.some(a=>a&&a.id==="unsorted")||d.unshift({id:"unsorted",name:"Unsorted"}),d.forEach(a=>{let f=document.createElement("div");f.className="pick-folder-row";let y=document.createElement("input");y.type="radio",y.name="pick-folder",y.value=a.id,y.id=`pick-folder-${a.id}`,(String(a.id)===String(re)||!re&&a.id==="unsorted")&&(y.checked=!0,re=a.id,f.classList.add("is-active")),y.addEventListener("change",()=>{re=y.value,(Ue?.querySelectorAll(".pick-folder-row")||[]).forEach(p=>{p instanceof HTMLElement&&p.classList.toggle("is-active",p===f)})});let A=document.createElement("label");A.setAttribute("for",y.id),A.textContent=a.name,f.appendChild(y),f.appendChild(A),f.addEventListener("click",v=>{v.preventDefault(),y.checked=!0,y.dispatchEvent(new Event("change")),Ie&&It(y.value)}),Ue.appendChild(f)}),Re||(Re=new be({modalElement:wt,closeButton:yn,titleInput:null,autoFocus:!0})),Re.show()};At&&At.addEventListener("click",e=>{e.preventDefault(),re&&It(re)});let ie=document.getElementById("note-folder-button");ie&&ie.addEventListener("click",e=>{e.preventDefault(),Ft(L,{initialFolderId:N,triggerEl:ie})});let se=null,W=()=>{se&&se.parentNode&&se.parentNode.removeChild(se),se=null,document.removeEventListener("click",W),document.removeEventListener("keydown",nt)},nt=e=>{e.key==="Escape"&&W()},Tt=(e,n)=>{if(!e)return;let r=n==="unsorted"?null:n;if(Jt(e,r)){try{me({preserveDraft:!0})}catch(a){console.warn("[notebook] failed to refresh notes after move",a)}try{ee()}catch(a){console.warn("[notebook] failed to refresh folder chips after move",a)}try{let a=J(r||"unsorted")||"Unsorted";an(a)}catch{}if(e===L){N=r||"unsorted";let a=document.getElementById("note-folder-label");a&&(a.textContent=J(N))}W()}},pn='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Ct=()=>{if(!k)return[];let e=k.querySelectorAll(pn);return Array.from(e).filter(n=>n instanceof HTMLElement&&!n.hasAttribute("disabled")&&n.tabIndex!==-1&&n.offsetParent!==null)},gn=()=>{let e=Ct();if(e.length){try{e[0].focus({preventScroll:!0})}catch{}return}if(k)try{k.focus({preventScroll:!0})}catch{}},kt=e=>{if(!C||C.classList.contains("hidden"))return;if(e.key==="Escape"){e.preventDefault(),ge();return}if(e.key!=="Tab")return;let n=Ct();if(!n.length)return;let r=n[0],d=n[n.length-1],a=document.activeElement;e.shiftKey&&a===r?(e.preventDefault(),d.focus()):!e.shiftKey&&a===d&&(e.preventDefault(),r.focus())},Bt=e=>{let n=e||"unsorted";if(Y)Y(n);else if(ue)Tt(ue,n);else{N=n;let r=document.getElementById("note-folder-label");r&&(r.textContent=J(N))}ge()},ge=(e={})=>{let{preserveCreateHandler:n=!1}=e||{};if(C&&(C.classList.add("hidden"),C.setAttribute("aria-hidden","true")),E&&(E.innerHTML=""),ue=null,Y=null,n||(pe=null),document.removeEventListener("keydown",kt),ie&&ie.setAttribute("aria-expanded","false"),xe instanceof HTMLElement)try{xe.focus({preventScroll:!0})}catch{}xe=null},Ft=(e,n={})=>{if(!C||!E)return;let{onSelect:r=null,initialFolderId:d=null,triggerEl:a=null}=n;ue=e||null,Y=typeof r=="function"?r:null,xe=a||document.activeElement,E.innerHTML="";let f=[];try{f=Array.isArray(q())?q():[]}catch{f=[]}f.some(A=>A&&A.id==="unsorted")||f.unshift({id:"unsorted",name:"Unsorted"});let y=e&&w.find(A=>A.id===e)||null,D=d||(y&&typeof y.folderId=="string"&&y.folderId?y.folderId:N||"unsorted");if(f.forEach(A=>{if(!A||typeof A.id>"u")return;let v=document.createElement("li");v.className="folder-select-row",v.dataset.folderId=A.id,v.setAttribute("role","option"),v.tabIndex=0,String(A.id)===String(D)?(v.classList.add("active"),v.setAttribute("aria-selected","true")):v.setAttribute("aria-selected","false"),v.textContent=A.name||String(A.id),E.appendChild(v)}),C.classList.remove("hidden"),C.setAttribute("aria-hidden","false"),k)try{k.focus({preventScroll:!0})}catch{}a===ie&&ie.setAttribute("aria-expanded","true"),document.addEventListener("keydown",kt),gn()};E&&(E.addEventListener("click",e=>{let n=e.target instanceof HTMLElement?e.target.closest(".folder-select-row"):null;!n||!E.contains(n)||(e.preventDefault(),Bt(n.dataset.folderId||"unsorted"))}),E.addEventListener("keydown",e=>{if(e.key!=="Enter"&&e.key!==" ")return;let n=e.target instanceof HTMLElement?e.target.closest(".folder-select-row"):null;!n||!E.contains(n)||(e.preventDefault(),Bt(n.dataset.folderId||"unsorted"))})),C&&C.addEventListener("click",e=>{e.target===C&&(e.preventDefault(),ge())}),z&&z.addEventListener("click",e=>{e.preventDefault(),ge()}),P&&P.addEventListener("click",e=>{e.preventDefault();let n=ue||L,r=Y;pe=d=>{if(r)r(d);else if(n)Tt(n,d);else{N=d||"unsorted";let a=document.getElementById("note-folder-label");a&&(a.textContent=J(N))}ge()},ge({preserveCreateHandler:!0}),vt()});let hn=(e,n)=>{if(!e||!n)return;W();let r=document.createElement("div");r.className="memory-glass-card p-2 rounded-2xl shadow-xl backdrop-blur-md border border-base-200/80",r.style.position="absolute",r.style.zIndex=1200,r.style.minWidth="180px";let d=document.createElement("button");d.type="button",d.className="w-full text-left px-3 py-2 btn-ghost rounded-xl",d.textContent="Move to folder\u2026",d.addEventListener("click",f=>{f.preventDefault(),W(),Ft(e.id,{initialFolderId:e.folderId&&typeof e.folderId=="string"?e.folderId:"unsorted",triggerEl:d})});let a=document.createElement("button");a.type="button",a.className="w-full text-left px-3 py-2 btn-ghost text-error rounded-xl",a.textContent="Delete note",a.addEventListener("click",f=>{f.preventDefault();let y=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(y?y("Delete this note? This cannot be undone."):!0)&&mn(e.id),W()}),r.appendChild(d),r.appendChild(a),document.body.appendChild(r),se=r;try{let f=n.getBoundingClientRect(),y=f.bottom+window.scrollY+6,D=f.right+window.scrollX-r.offsetWidth;r.style.top=`${y}px`,r.style.left=`${D}px`}catch{r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}document.addEventListener("click",W),document.addEventListener("keydown",nt)},xt=(e,n)=>{if(!e||n!==-1&&n!==1)return;let r=[];try{r=Array.isArray(q())?q().slice():[]}catch{r=[]}if(!r.length)return;let d=r.filter(p=>p&&p.id!=="unsorted");d.sort((p,S)=>(Number(p.order)||0)-(Number(S.order)||0));let a=d.findIndex(p=>String(p.id)===String(e));if(a===-1)return;let f=a+n;if(f<0||f>=d.length)return;let y=d[a].order;d[a].order=d[f].order,d[f].order=y;let v=[r.find(p=>p&&p.id==="unsorted")||{id:"unsorted",name:"Unsorted",order:-1},...d].map((p,S)=>({id:p.id,name:p.name,order:S}));try{if(Se(v)){try{ee()}catch{}try{ae()}catch{}}}catch(p){console.warn("[notebook] reorder save failed",p)}},bn=(e,n)=>{if(!e||e==="all"||e==="unsorted")return;W();let r=document.createElement("div");r.className="memory-glass-card p-2 rounded shadow-lg",r.style.position="absolute",r.style.zIndex=1200,r.style.minWidth="160px";let d=!1,a=!1;try{let p=(Array.isArray(q())?q().filter(Boolean):[]).filter(_=>_&&_.id!=="unsorted").sort((_,X)=>(Number(_.order)||0)-(Number(X.order)||0)),S=p.findIndex(_=>String(_.id)===String(e));d=S===0,a=S===-1?!0:S===p.length-1}catch{d=!1,a=!1}let f=document.createElement("button");f.type="button",f.className="w-full text-left px-3 py-2 btn-ghost",f.textContent="Move up",d&&(f.setAttribute("disabled",""),f.classList.add("opacity-50","cursor-not-allowed")),f.addEventListener("click",v=>{v.preventDefault();try{xt(e,-1)}catch(p){console.warn("[notebook] reorder move up failed",p)}W()});let y=document.createElement("button");y.type="button",y.className="w-full text-left px-3 py-2 btn-ghost",y.textContent="Move down",a&&(y.setAttribute("disabled",""),y.classList.add("opacity-50","cursor-not-allowed")),y.addEventListener("click",v=>{v.preventDefault();try{xt(e,1)}catch(p){console.warn("[notebook] reorder move down failed",p)}W()});let D=document.createElement("button");D.type="button",D.className="w-full text-left px-3 py-2 btn-ghost",D.textContent="Rename folder",D.addEventListener("click",v=>{v.preventDefault(),Sn(e),W()});let A=document.createElement("button");A.type="button",A.className="w-full text-left px-3 py-2 btn-ghost text-accent",A.textContent="Delete folder",A.addEventListener("click",v=>{v.preventDefault(),Ln(e),W()}),r.appendChild(f),r.appendChild(y),r.appendChild(D),r.appendChild(A),document.body.appendChild(r),se=r;try{let v=n.getBoundingClientRect(),p=v.bottom+window.scrollY+6,S=v.left+window.scrollX;r.style.top=`${p}px`,r.style.left=`${S}px`}catch{r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}document.addEventListener("click",W),document.addEventListener("keydown",nt)},Nt=document.getElementById("renameFolderModal"),le=document.getElementById("renameFolderName"),he=document.getElementById("renameFolderError"),Mt=document.getElementById("renameFolderSave"),En=document.getElementById("renameFolderCancel"),qe=null,Te=null,Dt=()=>{he&&(he.classList.add("sr-only"),he.textContent="")},ot=e=>{he&&(he.textContent=e,he.classList.remove("sr-only"))},Sn=e=>{if(!Nt||e==="all"||e==="unsorted")return;Te=e;let r=(Array.isArray(q())?q():[]).find(d=>d&&String(d.id)===String(e));r&&(qe||(qe=new be({modalElement:Nt,closeButton:En,titleInput:le,modalTitle:document.getElementById("renameFolderTitle"),autoFocus:!0})),Dt(),le&&(le.value=r.name||""),qe.show())},Ht=()=>{if(!Te||!le)return;let n=String(le.value||"").trim();if(Dt(),!n.length){ot("Folder name can't be empty.");return}let r=[];try{r=Array.isArray(q())?q():[]}catch{r=[]}if(r.some(y=>String(y.name).toLowerCase()===n.toLowerCase()&&String(y.id)!==String(Te))){ot("You already have a folder with this name.");return}let a=r.map(y=>String(y.id)===String(Te)?{...y,name:n}:y);if(!Se(a)){ot("Unable to rename folder. Please try again.");return}try{qe.requestClose("saved")}catch{}Te=null;try{ee()}catch{}ae()};Mt&&Mt.addEventListener("click",e=>{e.preventDefault(),Ht()}),le&&le.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Ht())});let Ot=document.getElementById("deleteFolderModal"),_t=document.getElementById("deleteFolderConfirm"),vn=document.getElementById("deleteFolderCancel"),Ce=null,de=null,Ln=e=>{!Ot||e==="all"||e==="unsorted"||(de=e,Ce||(Ce=new be({modalElement:Ot,closeButton:vn,titleInput:null,modalTitle:document.getElementById("deleteFolderTitle"),autoFocus:!1})),Ce.show())},wn=()=>{if(!de)return;let e=[];try{e=Array.isArray(q())?q():[]}catch{e=[]}let n=e.filter(f=>String(f.id)!==String(de));if(n.some(f=>f&&f.id==="unsorted")||n.unshift({id:"unsorted",name:"Unsorted"}),!Se(n)){try{Ce.requestClose("failed")}catch{}de=null;return}let d=te(),a=(Array.isArray(d)?d:[]).map(f=>f&&String(f.folderId)===String(de)?{...f,folderId:"unsorted",updatedAt:new Date().toISOString()}:f);Z(a),String(b)===String(de)&&(b="unsorted",Ge()),de=null;try{Ce.requestClose("deleted")}catch{}ee(),ae()};_t&&_t.addEventListener("click",e=>{e.preventDefault(),wn()}),m&&m.addEventListener("click",e=>{let n=e.target;if(!(n instanceof HTMLElement))return;let r=n.closest('button[data-role="note-menu"]');if(r&&m.contains(r)){e.preventDefault();let a=r.getAttribute("data-note-id");if(!a)return;let f=w.find(y=>y.id===a);f&&hn(f,r);return}let d=n.closest('[data-role="open-note"]');if(d&&m.contains(d)){e.preventDefault();let a=d.getAttribute("data-note-id");if(!a)return;let f=w.find(y=>y.id===a);f&&(ne(f),we(),ft()&&Me())}});let ae=()=>{Ze(yt())};if(u){let e=M(()=>{Ne=typeof u.value=="string"?u.value:"",ae()},180);u.addEventListener("input",e),u.addEventListener("search",e)}let An=()=>{me({preserveDraft:!1})};s.addEventListener("click",()=>{let e=te(),n=Array.isArray(e)?[...e]:[],{title:r,bodyHtml:d,bodyText:a}=sn(),f=d||"",y=a||Je(f),D=r||"Untitled note",A=new Date().toISOString(),v=N&&N!=="all"?N:"unsorted";if(L){let p=n.findIndex(S=>S.id===L);if(p>=0)n[p]={...n[p],title:D,body:f,bodyHtml:f,bodyText:y,updatedAt:A,folderId:v};else{let S=ce(D,f,{updatedAt:A,folderId:v,bodyHtml:f,bodyText:y});L=S.id,n.unshift(S)}}else{let p=ce(D,f,{folderId:v,bodyHtml:f,bodyText:y});L=p.id,n.unshift(p)}Z(n),De(),me({preserveDraft:!1})});let Ut=()=>{ne(null),N=b&&b!=="all"?b:"unsorted";let e=document.getElementById("note-folder-label");if(e&&(e.textContent=J(N)),we(),typeof o.focus=="function")try{o.focus()}catch{}};c&&c.addEventListener("click",e=>{e.preventDefault(),Ut()});let Pe=document.getElementById("mobile-footer-new-note");Pe&&Pe.addEventListener("click",e=>{e.preventDefault();try{Pe.getAttribute("data-nav-target")&&(document.querySelectorAll("[data-nav-target]").forEach(d=>d.classList.remove("active")),Pe.classList.add("active"))}catch{}Ut()});let $e=M(()=>{try{if(!Qe())return;s instanceof HTMLElement&&!s.matches(":disabled")&&s.click()}catch{}},1500);try{o.addEventListener("input",$e)}catch{}try{t.addEventListener("input",$e),t.addEventListener("keydown",h),t.addEventListener("keydown",I),t.addEventListener("blur",()=>{$e()}),o.addEventListener("blur",()=>$e())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",e=>{try{Qe()&&s instanceof HTMLElement&&!s.matches(":disabled")&&s.click()}catch{}}),An(),typeof window<"u"&&(window.addEventListener("storage",e=>{e.key===Fe&&(Ae=e.newValue??null,me({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let e=Xe();e!==Ae&&(Ae=e,me({preserveDraft:!0}))},2e3))),H({ModalController:be,saveFolders:Se,getFolders:q,getFolderNameById:J})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",en,{once:!0}):en();var ut=Qt(),ct=zt({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:o=>{ut?.handleSessionChange(o)}});if(ct?.supabase){ut?.setSupabaseClient(ct.supabase);try{ct.supabase.auth.getSession().then(({data:o})=>{ut?.handleSessionChange(o?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let o=document.getElementById("overflowMenuBtn"),t=document.getElementById("overflowMenu");if(!(o instanceof HTMLElement)||!(t instanceof HTMLElement))return;let s='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',c=o,m=E=>{if(!(E instanceof HTMLElement)||E.getAttribute("aria-hidden")==="true"||E.hasAttribute("disabled")||E.tabIndex<0)return!1;let P=E.getBoundingClientRect();return P.width>0||P.height>0},l=()=>Array.from(t.querySelectorAll(s)).filter(m),u=()=>{let E=t.classList.contains("hidden");t.setAttribute("aria-hidden",E?"true":"false")};u();let g=E=>{!t.contains(E.target)&&E.target!==o&&C({restoreFocus:!1})},B=()=>{let[E]=l();if(E instanceof HTMLElement)try{E.focus()}catch{}},F=()=>{t.classList.contains("hidden")&&(c=document.activeElement instanceof HTMLElement?document.activeElement:o,t.classList.remove("hidden"),o.setAttribute("aria-expanded","true"),u(),document.addEventListener("focusin",g),!t.contains(document.activeElement)&&B())},C=({restoreFocus:E=!0}={})=>{if(!t.classList.contains("hidden")&&(t.classList.add("hidden"),o.setAttribute("aria-expanded","false"),u(),document.removeEventListener("focusin",g),E&&c instanceof HTMLElement))try{c.focus()}catch{}};o.addEventListener("click",E=>{E.stopPropagation(),t.classList.contains("hidden")?F():C()}),document.addEventListener("click",E=>{E.target===o||t.contains(E.target)||C({restoreFocus:!1})}),document.addEventListener("keydown",E=>{if(E.key==="Escape"){C();return}E.key==="ArrowDown"&&!t.classList.contains("hidden")&&(E.preventDefault(),B())}),t.addEventListener("click",E=>{E.stopPropagation(),E.target instanceof HTMLElement&&E.target.closest("button")&&C({restoreFocus:!1})}),t.addEventListener("keydown",E=>{if(E.key!=="Tab")return;let P=l();if(!P.length)return;let z=P.indexOf(document.activeElement),k=P.length-1,j=z;E.shiftKey?j=z<=0?k:z-1:j=z===k?0:z+1,E.preventDefault();let H=P[j]||P[0];if(H instanceof HTMLElement)try{H.focus()}catch{}})})();(()=>{let o=document.getElementById("voiceAddBtn");if(!(o instanceof HTMLElement))return;let t=()=>{let m=document.getElementById("voiceBtn");return m instanceof HTMLElement?m:null},s=()=>{let m=t();if(!m)return;let l=()=>{m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true"?(o.setAttribute("disabled","true"),o.setAttribute("aria-disabled","true")):(o.removeAttribute("disabled"),o.removeAttribute("aria-disabled"));let g=m.getAttribute("title");g&&o.setAttribute("title",g)};l(),typeof MutationObserver=="function"&&new MutationObserver(l).observe(m,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s,{once:!0}):s();let c=()=>{let m=t();if(m&&!(m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true")){try{m.focus({preventScroll:!0})}catch{try{m.focus()}catch{}}try{m.click()}catch(l){console.warn("Voice add trigger failed",l)}}};o.addEventListener("click",m=>{m.preventDefault();let l=!1,u=null,g=()=>{l||(l=!0,document.removeEventListener("reminder:sheet-opened",B),c())},B=C=>{if(C?.detail?.trigger!==o)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&u&&(window.clearTimeout(u),u=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(g,150)};document.addEventListener("reminder:sheet-opened",B);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:o}}))}catch(C){document.removeEventListener("reminder:sheet-opened",B),typeof window<"u"&&typeof window.clearTimeout=="function"&&u&&(window.clearTimeout(u),u=null),console.warn("Voice add open failed",C);return}let F=document.getElementById("create-sheet");F instanceof HTMLElement&&F.classList.contains("open")&&(u=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(g,120))})})();(()=>{let o=document.getElementById("toggleReminderFilters"),t=document.getElementById("reminderFilters");if(!(o instanceof HTMLElement)||!(t instanceof HTMLElement))return;let s=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],c=()=>{let l=t.hasAttribute("open");o.setAttribute("aria-expanded",String(l)),o.classList.toggle("btn-active",l)},m=()=>{for(let l of s){let u=t.querySelector(l);if(u instanceof HTMLElement&&!u.hasAttribute("disabled")){try{u.focus({preventScroll:!0})}catch{u.focus()}return}}};o.addEventListener("click",()=>{let l=t.hasAttribute("open");t.open=!l,l||m(),c()}),t.addEventListener("toggle",c),c()})();(()=>{let o=document.getElementById("create-sheet");if(!(o instanceof HTMLElement))return;function t(){!o.classList.contains("open")&&o.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",o=>{let t=document.getElementById("totalCount");if(!t)return;let s=Array.isArray(o?.detail?.items)?o.detail.items.length:0;t.textContent=String(s)});document.addEventListener("click",o=>{try{let t=o.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let s=document.createElement("div");s.textContent="Save clicked",s.style.position="fixed",s.style.right="16px",s.style.bottom="16px",s.style.background="rgba(34,197,94,0.95)",s.style.color="#fff",s.style.padding="8px 12px",s.style.borderRadius="8px",s.style.zIndex="99999",document.body.appendChild(s),setTimeout(()=>s.remove(),900)}catch{}}}catch{}});(function(){let o=document.getElementById("reminderList");if(!o)return;let t=Array.from(o.children);if(t.length<=30)return;let s=20;o.innerHTML="";let c=0;function m(){let g=t.slice(c,c+s);g.forEach(B=>o.appendChild(B)),c+=g.length}m();let l=document.createElement("div");l.id="listSentinel",o.appendChild(l);let u=new IntersectionObserver(g=>{g.some(B=>B.isIntersecting)&&c<t.length&&(m(),c>=t.length&&u.disconnect())});u.observe(l)})();(function(){let o=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(l=>l instanceof HTMLElement),t=document.getElementById("settingsModal"),s=document.getElementById("closeSettings");if(!o.length||!t||!s)return;function c(){t.classList.remove("hidden")}function m(){t.classList.add("hidden")}o.forEach(l=>{l.addEventListener("click",c)}),s.addEventListener("click",m),t.addEventListener("click",l=>{l.target instanceof HTMLElement&&l.target.matches("[data-close]")&&m()}),t.addEventListener("keydown",l=>{l.key==="Escape"&&m()})})();(function(){let o=document.getElementById("syncStatus"),t=document.getElementById("mcStatus"),s=document.getElementById("mcStatusText"),c=document.getElementById("syncUrl"),m=document.getElementById("saveSyncSettings"),l=document.getElementById("testSync"),u=document.getElementById("syncAll"),g="syncUrl";if(!s)return;let B=["online","offline","error"],F=["online","offline"],C={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},E={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},P=null;function z(i){if(!t)return;F.forEach(I=>t.classList.remove(I));let h=i!=="offline"&&i!=="error";t.classList.add(h?"online":"offline"),t.setAttribute("aria-label",h?"Online":"Offline")}function k(i,h){P=i,B.forEach(w=>s.classList.remove(w)),o&&B.forEach(w=>o.classList.remove(w)),i==="online"?(s.classList.add("online"),o&&o.classList.add("online")):i==="error"?(s.classList.add("error"),o&&o.classList.add("error")):(s.classList.add("offline"),o&&o.classList.add("offline"));let I=typeof h=="string"&&h.trim()?h.trim():C[i]||"",M=typeof h=="string"&&h.trim()?h.trim():E[i]||I,L=I||M||"";s.textContent=L,L?(s.setAttribute("title",L),s.setAttribute("aria-label",L)):(s.removeAttribute("title"),s.removeAttribute("aria-label")),z(i),s.dataset.state=i}function j(){P!=="syncing"&&k(navigator.onLine?"online":"offline")}function H(i){typeof localStorage>"u"||(i?localStorage.setItem(g,i):localStorage.removeItem(g))}function x(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(g)||""}catch{return""}}function R(i){if(!i||typeof i!="object")return null;let h=i.id||i.uid||i.key||i.slug||i.uuid,I=typeof i.title=="string"&&i.title.trim()?i.title.trim():typeof i.name=="string"?i.name.trim():"";if(!I)return null;let M=typeof i.dueIso=="string"&&i.dueIso?i.dueIso:typeof i.due=="string"?i.due:null,L=typeof i.priority=="string"&&i.priority.trim()?i.priority.trim():i.level||i.importance||"Medium",w=typeof i.category=="string"&&i.category.trim()?i.category.trim():i.group||i.bucket||"General",b=typeof i.done=="boolean"?i.done:!!(i.completed||i.isDone||i.status==="done");return{id:h||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:I,dueIso:M&&M.trim()?M.trim():null,priority:L,category:w,done:b}}function O(){let i=Array.from(document.querySelectorAll("[data-reminder]"));return i.length?i.map(h=>{let I=h.dataset||{},M=null;if(I.reminder)try{M=JSON.parse(I.reminder)}catch{M=null}let L=M||{id:I.id||I.reminderId||h.getAttribute("data-id")||null,title:I.title||I.reminderTitle||"",dueIso:I.due||I.reminderDue||h.getAttribute("data-due")||null,priority:I.priority||I.reminderPriority||h.getAttribute("data-priority")||"",category:I.category||I.reminderCategory||h.getAttribute("data-category")||"",done:I.done==="true"||I.reminderDone==="true"||h.getAttribute("data-done")==="true"};if(!L.title){let w=h.querySelector("[data-reminder-title], [data-title], h3, h4, strong");w&&(L.title=w.textContent.trim())}if(!L.dueIso){let w=h.querySelector("[data-due], time");if(w){let b=w.getAttribute("datetime")||w.getAttribute("data-due");L.dueIso=b||w.textContent.trim()}}return R(L)}).filter(Boolean):[]}function G(){if(typeof localStorage>"u")return[];let i=[],h=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(M=>{if(!h.has(M)){h.add(M);try{let L=localStorage.getItem(M);if(!L)return;let w=JSON.parse(L);Array.isArray(w)?w.forEach(b=>i.push(b)):w&&typeof w=="object"&&(Array.isArray(w.items)&&w.items.forEach(b=>i.push(b)),Array.isArray(w.reminders)&&w.reminders.forEach(b=>i.push(b)))}catch{}}}),!i.length)for(let M=0;M<localStorage.length;M+=1){let L=localStorage.key(M);if(!(!L||h.has(L)||!/remind/i.test(L))){h.add(L);try{let w=localStorage.getItem(L);if(!w)continue;let b=JSON.parse(w);Array.isArray(b)?b.forEach(N=>i.push(N)):b&&typeof b=="object"&&(Array.isArray(b.items)&&b.items.forEach(N=>i.push(N)),Array.isArray(b.reminders)&&b.reminders.forEach(N=>i.push(N)))}catch{}}}return i.map(R).filter(Boolean)}function K(){let i=O();return i.length?i:G()}function T(i){i?(u?.setAttribute("aria-busy","true"),u?.setAttribute("disabled","disabled"),l?.setAttribute("aria-busy","true"),l?.setAttribute("disabled","disabled")):(u?.removeAttribute("aria-busy"),l?.removeAttribute("aria-busy"),Q())}function Q(){!!((c?.value||"").trim()||x())?(u?.removeAttribute("disabled"),l?.removeAttribute("disabled")):(u?.setAttribute("disabled","disabled"),l?.setAttribute("disabled","disabled"))}let $=x();c&&$&&(c.value=$),Q(),k(navigator.onLine?"online":"offline"),window.addEventListener("online",j),window.addEventListener("offline",j),c?.addEventListener("input",Q),m?.addEventListener("click",()=>{let i=(c?.value||"").trim();if(!i){H(""),k("info","Sync URL cleared. Add one to enable sync."),Q();return}try{let h=new URL(i);if(!/^https?:/.test(h.protocol))throw new Error("Invalid protocol")}catch{k("error","Enter a valid sync URL before saving.");return}H(i),k("online","Sync settings saved."),Q()}),l?.addEventListener("click",async()=>{let i=(c?.value||x()).trim();if(!i){k("error","Add your sync URL in Settings first.");return}T(!0),k("syncing","Testing connection\u2026");try{(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?k("online","Connection looks good."):k("error","Test failed. Check your Apps Script deployment.")}catch(h){console.error("Test sync failed",h),k("error","Test failed. Check your Apps Script deployment.")}finally{T(!1)}}),u?.addEventListener("click",async()=>{let i=(c?.value||x()).trim();if(!i){k("error","Add your sync URL in Settings first.");return}let h=K();if(!h.length){k("info","Nothing to sync right now.");return}T(!0),k("syncing",`Syncing ${h.length} reminder${h.length===1?"":"s"}\u2026`);let I=20,M=0,L=0,w=b=>({id:b.id,title:b.title,dueIso:b.dueIso||null,priority:b.priority||"Medium",category:b.category||"General",done:!!b.done,source:"memory-cue-mobile"});try{for(let b=0;b<h.length;b+=I){let N=h.slice(b,b+I);(await Promise.allSettled(N.map(Y=>fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w(Y))})))).forEach(Y=>{Y.status==="fulfilled"&&Y.value?.ok?M+=1:(Y.status,L+=1)}),await new Promise(Y=>setTimeout(Y,300))}L?M?k("error",`Partial sync: ${M} success, ${L} failed.`):k("error","Sync failed. Check your sync URL and retry."):k("online",`Sync complete. ${M} updated.`)}catch(b){console.error("Sync failed",b),k("error","Sync failed. Try again soon.")}finally{T(!1)}})})()});export default Pn();
