import{a as Nt,b as no,c as Ae,d as oo,f as Je,g as xe,h as Xe,i as ro,j as Ht,k as so}from"./chunk-K4LZ4PFQ.js";import{a as Pt,b as to}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as Qe,c as eo}from"./chunk-GUVSRPRW.js";function Ot(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let r of o){if(typeof r!="string"||!r)continue;let s=t.getElementById(r);if(s)return{key:n,element:s}}return null}).filter(n=>!!(n&&n.element))}function Z(e,t){if(!e||typeof e!="object")return"";let n=ao[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let r=e[o];return r==null?"":typeof r=="string"?r:String(r)}return""}function io(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function lo(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function qt(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let r=e&&typeof e=="object"?Z(e,n):"";io(o,r)})}function Ut(e,t,n,o){Array.isArray(e)&&e.forEach(({element:r})=>{r instanceof HTMLInputElement?["checkbox","radio"].includes(r.type)?r.checked=!1:r.value="":(r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement)&&(r.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function $t(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let r=lo(o);if(typeof r=="boolean"){t[n]=r;return}let s=typeof r=="string"?r.trim():r;t[n]=s??""}),t}function w(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Rt,ao,Ze,et,_t=Qe(()=>{Rt=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],ao={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Ze="Create Cue",et="Edit Cue"});function Wt(e){return new tt(e)}var co,uo,tt,jt=Qe(()=>{co=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),uo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},tt=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...uo,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let o=n[0],r=n[n.length-1],s=document.activeElement;t.shiftKey&&s===o?(t.preventDefault(),r.focus()):!t.shiftKey&&s===r&&(t.preventDefault(),o.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(co)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let o=this.events[t];if(!o||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let r=new CustomEvent(o,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(r)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Vt,Kt,Yt,ot,nt,fo,te,rt,mo,Gt,zt,Qt,po,Jt,st,Xt,Zt,en,De,fe,tn,yo,ho,go,nn,at,Ce,ue,ke,ee,de,bo,Eo,$,on,Be,rn,sn,Ie,wo,ce,Fe,an,K,Me,it,ln,Y,cn,dn,un,fn,me,mn,lt,pn,yn=Qe(()=>{Vt="memoryCue:plannerPlans",Kt="memoryCue:plannerTemplates",Yt="memoryCue:lastPlannerTemplate",ot="memoryCue:plannerUpdated",nt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],fo=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],te=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},rt=e=>{if(!te()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},mo=(e,t)=>{if(!(!te()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch{}},Gt=e=>{try{return JSON.parse(e)}catch{return null}},zt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Qt=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,po=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),o=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t},Jt=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`},st=e=>{if(typeof e!="string")return null;let[t,n,o]=e.split("-"),r=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(o,10);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(a))return null;let i=new Date(r,s-1,a);return Number.isNaN(i.getTime())?null:(i.setHours(0,0,0,0),i)},Xt=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=nt.findIndex(o=>o.toLowerCase()===t);return n>=0?n:0},Zt=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:zt(),badge:n,text:t}},en=(e,t={})=>{let n=typeof t=="object"&&t?t:{},o=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:Xt(e?.dayName||n.dayName||n.dayLabel),r=Qt(o),s=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():nt[r],a=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",d=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(y=>Zt(y)).filter(Boolean);return{id:typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:zt(),dayIndex:r,dayLabel:nt[r]||"Lesson",title:s,summary:a,details:d}},De=e=>[...e].sort((t,n)=>t.dayIndex!==n.dayIndex?t.dayIndex-n.dayIndex:t.title.localeCompare(n.title)),fe=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,o=st(n),r=Array.isArray(e?.lessons)?e.lessons.map(a=>en(a)).filter(Boolean):[],s=typeof e?.templateId=="string"?e.templateId.trim():"";return{weekId:n,startDate:o?o.toISOString():"",lessons:De(r),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString(),templateId:s}},tn=()=>{if(!te())return{};try{let e=rt(Vt);if(typeof e!="string"||!e.length)return{};let t=Gt(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},yo=e=>{if(te())try{window.localStorage.setItem(Vt,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},ho=()=>{if(!te())return{};try{let e=rt(Kt);if(typeof e!="string"||!e.length)return{};let t=Gt(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},go=e=>{if(te())try{window.localStorage.setItem(Kt,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},nn=e=>{if(!e)return null;let n=tn()[e];return n?fe(n,e):null},at=(e,t)=>{if(!e||!t)return t;let n=tn();return n[e]=t,yo(n),t},Ce=new Map,ue=null,ke=null,ee=!1,de=null,bo=()=>{if(typeof de=="string")return de;let e=rt(Yt);return de=typeof e=="string"?e:"",de},Eo=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();de=t,mo(Yt,t)},$=e=>{e?.templateId&&Eo(e.templateId)},on=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},Be=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(ot,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},rn=async()=>ue?ke||(ke=ue().then(e=>{let{db:t,getCollection:n}=e||{},o=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),ke):null,sn=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:o,db:r}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(r,"plannerPlans",t)},Ie=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Ce.set(e.weekId,e),e),wo=e=>{let t=K();return fe({weekId:e,lessons:e===t?fo:[]},e)},ce=e=>{let t=nn(e);if(t)return Ie(t),t;let n=wo(e);return at(e,n),Ie(n),n},Fe=async e=>{if(!e?.weekId)return e;let t=fe(e,e.weekId);if(at(t.weekId,t),Ie(t),$(t),ee||!ue)return t;try{let n=await rn();if(!n)return t;let o=sn(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(o,t,{merge:!0}):await n.updateDoc(o,t),t}catch(n){return on(n)?(console.warn("Persisting planner data locally due to permission issue",n),ee=!0,t):(console.error("Failed to persist planner plan",n),t)}},an=(e={})=>{typeof e.ensureFirestore=="function"&&(ue=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(ee=e.forceLocal)},K=(e=new Date)=>{let t=po(e);return Jt(t)},Me=(e,t=0)=>{let n=st(e);if(!n||!Number.isFinite(t))return e;let o=new Date(n);return o.setDate(n.getDate()+t*7),Jt(o)},it=(e,{short:t=!1}={})=>{let n=st(e);if(!n)return"";let o=new Date(n);o.setDate(n.getDate()+6);let r=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),s=r.format(n),a=r.format(o),i=n.getFullYear()===o.getFullYear();if(t)return`Week of ${s}`;let d=i?n.getFullYear():`${n.getFullYear()} \u2013 ${o.getFullYear()}`;return`${s} \u2013 ${a}, ${d}`},ln=(e=K())=>{if(!e)return[];let t=Ce.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=nn(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},Y=async(e=K())=>{if(!e)return null;if(Ce.has(e)){let t=Ce.get(e);return $(t),t}if(ee||!ue){let t=ce(e);return $(t),t}try{let t=await rn();if(!t){let s=ce(e);return $(s),s}let n=sn(t,e),o=await t.getDoc(n);if(o.exists()){let s=o.data(),a=fe({...s,weekId:e},e);return at(e,a),Ie(a),ee=!1,$(a),a}let r=ce(e);return typeof t.setDoc=="function"&&await t.setDoc(n,r,{merge:!0}),$(r),r}catch(t){if(on(t)){console.warn("Falling back to local planner data due to permission issue",t),ee=!0;let o=ce(e);return $(o),o}console.error("Failed to load planner data",t);let n=ce(e);return $(n),n}},cn=async(e,t)=>{if(!e)return null;let n=await Y(e),o=en(t),r={...n,lessons:De([...n?.lessons||[],o]),updatedAt:new Date().toISOString()},s=await Fe(r);return Be(s),s},dn=async(e,t)=>{if(!e||!t)return null;let n=await Y(e),o=(n?.lessons||[]).filter(a=>a.id!==t),r={...n,lessons:De(o),updatedAt:new Date().toISOString()},s=await Fe(r);return Be(s),s},un=async(e,t,n)=>{if(!e||!t)return null;let o=await Y(e),r=[...o?.lessons||[]],s=r.findIndex(p=>p.id===t);if(s===-1)return o;let a=Zt(n);if(!a)return o;let i=r[s],d={...i,details:[...i.details||[],a]};r[s]=d;let l={...o,lessons:De(r),updatedAt:new Date().toISOString()},y=await Fe(l);return Be(y),y},fn=e=>{if(!e||typeof e!="object")return null;let t=Qt(Number.isFinite(e.dayIndex)?e.dayIndex:Xt(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",o=typeof e.summary=="string"?e.summary:"",r=Array.isArray(e.details)?e.details.map(s=>{if(!s||typeof s!="object")return null;let a=typeof s.badge=="string"?s.badge:"",i=typeof s.text=="string"?s.text:"";return i.trim()?{badge:a,text:i}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:o,details:r}},me=()=>{let e=ho(),t={};return Object.keys(e).forEach(n=>{let o=e[n];if(!o||typeof o!="object")return;let r=typeof o.name=="string"&&o.name.trim()?o.name.trim():n,s=Array.isArray(o.lessons)?o.lessons.map(a=>fn(a)).filter(Boolean):[];t[r]={name:r,lessons:s,updatedAt:typeof o.updatedAt=="string"?o.updatedAt:""}}),t},mn=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let o=me(),r=Array.isArray(t.lessons)?t.lessons.map(s=>fn(s)).filter(Boolean):[];return o[n]={name:n,lessons:r,updatedAt:new Date().toISOString()},go(o),o[n]},lt=()=>bo(),pn=async(e,t)=>{if(!e||!t)return null;let o=me()[t];if(!o)return Y(e);let r=Array.isArray(o.lessons)?o.lessons.map(i=>({dayIndex:i.dayIndex,title:i.title,summary:i.summary,details:Array.isArray(i.details)?i.details.map(d=>({badge:d.badge,text:d.text})):[]})):[],s=fe({weekId:e,lessons:r,templateId:t},e);s.updatedAt=new Date().toISOString();let a=await Fe(s);return Be(a),a}});var Cr=eo(()=>{to();oo();_t();jt();no();ro();so();yn();Pt();function vo(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!t||!n)return;let o=document.querySelectorAll("[data-open-reminder-modal]");if(!o.length)return;let r=e.querySelector("[data-reminder-modal-backdrop]"),s=e.querySelectorAll("[data-close-modal]"),a=document.getElementById("mainContent"),i=document.querySelector('nav[aria-label="Primary"]'),d=[a,i],l=e.querySelector('[role="dialog"]')??e,y=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],p=null,u=()=>{if(!(l instanceof HTMLElement))return[];let c=l.querySelectorAll(y.join(","));return Array.from(c).filter(m=>{let x=m instanceof HTMLElement,j=typeof SVGElement<"u"&&m instanceof SVGElement;if(!x&&!j||m.getAttribute("aria-hidden")==="true"||"disabled"in m&&m.disabled||m.hidden||m.closest("[hidden]"))return!1;let V=m.getBoundingClientRect();return V.width>0&&V.height>0})},f=()=>{let c=u(),m=c.find(x=>x.hasAttribute("data-autofocus")||x.hasAttribute("autofocus"))||(n&&c.includes(n)?n:null)||c[0];if(m&&typeof m.focus=="function"){m.focus({preventScroll:!0});return}l instanceof HTMLElement&&typeof l.focus=="function"&&l.focus({preventScroll:!0})},h=c=>{l instanceof HTMLElement&&(!(c.target instanceof Node)||!l.contains(c.target))&&(c.stopPropagation(),f())},b=c=>{if(c.key!=="Tab")return;let m=u();if(!m.length){c.preventDefault(),l instanceof HTMLElement&&l.focus({preventScroll:!0});return}let x=m[0],j=m[m.length-1],V=document.activeElement;if(c.shiftKey){(!l.contains(V)||V===x)&&(c.preventDefault(),j.focus());return}(!l.contains(V)||V===j)&&(c.preventDefault(),x.focus())},g=c=>{d.forEach(m=>{m&&(c?m.setAttribute("inert",""):m.removeAttribute("inert"))})},I=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),g(!1),document.removeEventListener("keydown",H,!0),e.removeEventListener("keydown",b,!0),e.removeEventListener("focusin",h,!0),p&&typeof p.focus=="function"&&p.focus(),p=null},H=c=>{c.key==="Escape"&&(c.preventDefault(),I())},le=({triggerElement:c}={})=>{c&&typeof c.focus=="function"?p=c:p=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),g(!0),document.addEventListener("keydown",H,!0),e.addEventListener("keydown",b,!0),e.addEventListener("focusin",h,!0),window.requestAnimationFrame(()=>{f()})},A=(c,m={})=>{try{document.dispatchEvent(new CustomEvent(c,{detail:m}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let x=document.createEvent("CustomEvent");x.initCustomEvent(c,!0,!0,m),document.dispatchEvent(x)}}},C=(c={})=>{A("cue:cancelled",c)};o.forEach(c=>{c.addEventListener("click",m=>{m.preventDefault();let j={trigger:m.currentTarget instanceof HTMLElement?m.currentTarget:null,mode:"create"};A("cue:prepare",j),A("cue:open",j)})}),s.forEach(c=>{c.addEventListener("click",m=>{m.preventDefault(),C({trigger:c,reason:"button"})})}),e.addEventListener("click",c=>{c.target===e&&C({reason:"backdrop"})}),r?.addEventListener("click",c=>{c.target===r&&C({reason:"backdrop"})}),document.addEventListener("cue:open",c=>{let m=c?.detail?.trigger,x=m instanceof HTMLElement?m:null;le({triggerElement:x})});let R=()=>{I()};document.addEventListener("cue:close",R),document.addEventListener("cue:cancelled",R);let M=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&M instanceof HTMLElement&&t.addEventListener("submit",c=>{c.preventDefault(),!M.matches(":disabled")&&M.click()}),M instanceof HTMLElement&&document.addEventListener("reminder:save",c=>{let m=c?.detail?.trigger;m&&m!==M||M.matches(":disabled")||M.click()})}vo();var hn=null;function Mn(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Lo(e){typeof document>"u"||!e||(window.clearTimeout(hn),hn=window.setTimeout(()=>{let t=document.querySelector(`[data-route="${e}"]`);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function ye(e){let t=e||Mn();t&&Lo(t)}function To(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{ye()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{if(!(o.currentTarget instanceof HTMLAnchorElement))return;let r=o.currentTarget.getAttribute("href")||"";if(!r.startsWith("#"))return;o.preventDefault();let s=r||"#dashboard",a=s.replace("#","")||"dashboard";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),ye(a)})}),typeof window.renderRoute=="function"&&window.renderRoute(),ye()}To();var Pn="memoryCue:accountPanelCollapsed";function So(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem(Pn);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function Ao(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem(Pn,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function xo(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let o=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",r=(t.getAttribute("data-expanded-label")||"").trim()||o,s=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",a=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",i=t.querySelector("[data-account-toggle-label]"),d=t.querySelector("[data-account-toggle-a11y]"),l=So();typeof l!="boolean"&&(l=!0);let y=(p,{persist:u=!0}={})=>{l=!!p,e.setAttribute("data-account-collapsed",l?"true":"false"),t.setAttribute("aria-expanded",l?"false":"true");let f=l?o:r,h=l?s:a;i?i.textContent=f:t.textContent=f,t.setAttribute("aria-label",h),d&&(d.textContent=h),l?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),l||n.removeAttribute("hidden"),u&&Ao(l)};y(l,{persist:!1}),t.addEventListener("click",p=>{p.preventDefault(),y(!l)})}xo();var gn=document.getElementById("settings-save-button"),Pe=document.getElementById("settings-save-confirmation"),se=document.getElementById("live-status"),ct=null,G=document.getElementById("resourcePlannerStatus"),dt=null;gn&&Pe&&gn.addEventListener("click",e=>{e.preventDefault(),Pe.classList.remove("hidden"),Pe.textContent="Settings saved!",se&&(se.textContent="Settings saved!"),ct&&window.clearTimeout(ct),ct=window.setTimeout(()=>{Pe.classList.add("hidden")},3e3)});function ko(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),ye(t),se&&(se.textContent="Opening planner to add a new lesson."),Ge(),window.requestAnimationFrame(()=>{let o=jn();o&&typeof o.catch=="function"&&o.catch(r=>{console.error("Planner quick action failed to start new lesson flow",r)})})}function Co(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",ko)})}Co();function ut(e,{tone:t="success"}={}){G&&(G.textContent=e,G.classList.remove("hidden"),G.classList.remove("text-success","text-error"),G.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(dt&&window.clearTimeout(dt),dt=window.setTimeout(()=>{G.classList.add("hidden"),G.textContent=""},4e3))),se&&(se.textContent=e)}function Io(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function Do(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let o=n.getAttribute("data-resource-title")?.trim(),r=n.getAttribute("data-resource-link")?.trim();if(!o||!r)return;let s="#planner";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),ye("planner"),Ge(),await sr();let a=`${o} \u2014 ${r}`,i=or(),d=null;try{if(i)d=await un(v,i,{badge:"Resource",text:a});else{let l=Io("lesson"),y=L?.lessons?.[0]?.dayLabel||"Monday";d=await cn(v,{id:l,dayName:y,title:o,summary:`Resource link: ${r}`,details:[{badge:"Resource",text:a}]}),d&&(S=l)}if(d){L=d,Se(d),ae(d,v),Te(d);let l=i?`Added "${o}" to your selected lesson.`:`Created a lesson for "${o}" in this week's planner.`;ut(l);return}ut("Unable to save that resource to the planner right now.",{tone:"error"})}catch(l){console.error("Failed to save resource to planner",l),ut("Unable to save that resource to the planner right now.",{tone:"error"})}}function Bo(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",Do)})}Bo();var Nn=document.getElementById("reminder-title"),Fo=document.getElementById("reminderText"),N=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),o=e.querySelector(".modal-backdrop button"),r=document.getElementById("modal-title");return Wt({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:o instanceof HTMLElement?o:null,titleInput:Nn,modalTitle:r instanceof HTMLElement?r:null,defaultTitle:Ze,editTitle:et})})();N?.setEditMode(!1);var Mo=()=>{let e=!!Nn;if(!!Fo)return Ae({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0};return e?Ae(n):Ae({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Mo().catch(e=>{console.error("Failed to initialise reminders",e)});var gt=Ht(),ft=Nt({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{gt?.handleSessionChange(e)}});if(ft?.supabase){gt?.setSupabaseClient(ft.supabase);try{ft.supabase.auth.getSession().then(({data:e})=>{gt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var U=document.getElementById("cues-list"),mt=document.getElementById("pinnedNotesCard"),oe=document.getElementById("pinnedNotesList"),X=document.getElementById("cue-form"),P=X?.querySelector("#cue-id-input"),Po=N?.defaultTitle||N?.modalTitle?.textContent?.trim()||Ze,_r=N?.editTitle||et,We=document.getElementById("tab-cues"),je=document.getElementById("tab-daily"),ge=document.getElementById("cues-view"),be=document.getElementById("daily-list-view"),bn=document.getElementById("daily-list-header"),Hn=document.getElementById("quick-add-form"),k=document.getElementById("quick-add-input"),D=document.getElementById("daily-voice-btn"),z=document.getElementById("daily-tasks-container"),bt=document.getElementById("clear-completed-btn"),Ve=document.getElementById("daily-list-permission-notice"),B=document.getElementById("plannerCards")||document.getElementById("planner-grid"),En=document.getElementById("planner-week"),No=document.getElementById("planner-prev"),Ho=document.getElementById("planner-next"),Ro=document.getElementById("planner-today"),Oo=document.getElementById("planner-duplicate-btn"),qo=document.getElementById("planner-new-lesson-btn"),_=document.getElementById("planner-template-select"),Rn=document.getElementById("planner-template-save-btn"),wn=document.getElementById("remindersCount"),vn=document.getElementById("plannerCount"),Ln=document.getElementById("plannerSubtitle"),Wr=document.getElementById("resourcesCount"),jr=document.getElementById("templatesCount"),Ne=document.getElementById("dailySnapshotList"),He=document.getElementById("todaysFocusList"),O=document.getElementById("weekAtAGlanceList"),q=null;O&&(q=document.createElement("li"),q.dataset.emptyState="week",q.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",q.textContent="No upcoming events this week.");var Tn=()=>{if(!O||!q)return;O.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?O.contains(q)||O.appendChild(q):O.contains(q)&&O.removeChild(q)};O&&(Tn(),new MutationObserver(Tn).observe(O,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var pt=e=>{mt&&(e?mt.classList.remove("hidden"):mt.classList.add("hidden"))},Ee={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Sn=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),An=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),Ue=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",xt=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},Uo=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),On=e=>{if(!e)return"";if(Sn)try{return Sn.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},$o=e=>{if(!e)return"";if(An)try{return An.format(e)}catch{}return e.toLocaleDateString()},qn=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Ee,t)?t:"medium"},xn=e=>{let t=qn(e);return Ee[t]?.rank??Ee.medium.rank},_o=e=>{let t=qn(e);return Ee[t]??Ee.medium},kn=e=>{let t=xt(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Un(e=[]){if(!Ne)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(o=>({reminder:o,date:xt(o)})).filter(({date:o})=>o&&Uo(o,t)).sort((o,r)=>o.date.getTime()-r.date.getTime());if(!n.length){Ne.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Ne.innerHTML="",n.forEach(({reminder:o,date:r})=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=Ue(o),s.appendChild(a);let i=On(r),d=document.createElement("p");d.className="text-xs text-base-content/70",d.textContent=i?`Due ${i}`:"Due today",s.appendChild(d),Ne.appendChild(s)})}function $n(e=[]){if(!He)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,o)=>{let r=xn(n)-xn(o);if(r!==0)return r;let s=kn(n)-kn(o);return s!==0?s:Ue(n).localeCompare(Ue(o),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){He.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}He.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let r=document.createElement("div");r.className="flex items-center justify-between gap-3";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=Ue(n),r.appendChild(s);let a=_o(n),i=document.createElement("span");i.className=a.badgeClass,i.textContent=a.badgeLabel,r.appendChild(i),o.appendChild(r);let d=xt(n),l=document.createElement("p");if(l.className="text-xs text-base-content/70",d){let y=On(d),p=$o(d),u=[];y&&u.push(`Due ${y}`),p&&u.push(p),l.textContent=u.length?u.join(" \u2022 "):"Due soon"}else l.textContent="No due date";o.appendChild(l),He.appendChild(o)})}var Wo=e=>{if(!wn)return;let t=Array.isArray(e)?e.length:0;wn.textContent=String(t)},jo=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Wo(t),Un(t),$n(t)};document.addEventListener("memoryCue:remindersUpdated",jo);Un();$n();var Et=Ot(Rt),Vo={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},Re=null,Ko=3,Cn=120;function Yo(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Cn?t:`${t.slice(0,Cn-1)}\u2026`:""}function Go(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let o=n.trim().toLowerCase();return o==="true"||o==="1"||o==="yes"}return!1})}function In(e){if(!oe)return;let t=Array.isArray(e)?e:[];if(!t.length){oe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',pt(!1);return}let n=t.filter(s=>Go(s));if(!n.length){oe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',pt(!1);return}pt(!0);let r=n.slice(0,Ko).map(s=>{let a=w(Z(s,"title")||"Untitled Cue"),i=Z(s,"details"),d=w(Yo(i)),l=d?`<p class="mt-1 text-sm text-base-content/70">${d}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${a}</p>
          ${l}
        </li>
      `}).join("");oe.innerHTML=r}function wt(e,{tone:t="muted"}={}){if(!U)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),U.innerHTML=`<p class="${n.join(" ")}">${w(e)}</p>`}function zo(e){if(!U)return;if(!Array.isArray(e)||e.length===0){wt("No cues yet.");return}let t=e.map(n=>{let o=w(Z(n,"title")||"Untitled Cue"),r=w(Z(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${r?`<p>${r}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${w(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${w(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");U.innerHTML=t}async function Le(){return Re||(Re=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:r,collection:s,doc:a,getDoc:i,addDoc:d,updateDoc:l,getDocs:y,query:p,orderBy:u,serverTimestamp:f,setDoc:h,arrayUnion:b}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),g=t(),I=g&&g.length?g[0]:e(Vo),H=n(I);(function(){let C=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;C&&(C.__persistenceInitialized__||(C.__persistenceInitialized__=!0,(async()=>{try{await o(H),console.info("[Firestore] Persistence: multi-tab enabled")}catch(R){if(R&&R.code==="failed-precondition")try{await r(H),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(M){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",M?.code||M)}else R&&R.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",R?.code||R)}})()))})();let le=s(H,"cues");return{db:H,cuesCollection:le,getCollection:s,doc:a,getDoc:i,addDoc:d,updateDoc:l,getDocs:y,query:p,orderBy:u,serverTimestamp:f,setDoc:h,arrayUnion:b}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),Re)}async function Qo(){let e=await Le(),{getDocs:t,cuesCollection:n,query:o,orderBy:r}=e,s=o&&r?o(n,r("createdAt","desc")):n;return(await t(s)).docs.map(i=>({id:i.id,...i.data()}))}async function Jo(e){if(!e)return null;let t=await Le(),{db:n,doc:o,getDoc:r}=t,s=o(n,"cues",e),a=await r(s);return a.exists()?{id:a.id,...a.data()}:null}async function _n(){if(!(!U&&!oe))try{let e=await Qo();zo(e),In(e)}catch(e){console.error("Failed to load cues",e),ze(e)?wt("Sign in to view your cues.",{tone:"muted"}):wt("Unable to load cues right now.",{tone:"error"}),In([])}}function Xo(e){!X||!P||(qt(e,Et),P.value=e?.id||"",N?.setEditMode(!0),N?.show({mode:"edit"}))}async function Zo(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await Jo(n);if(!o)return;Xo(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function er(e){if(e.preventDefault(),!X||!P)return;let t=P.value.trim(),n=$t(Et);try{let o=await Le(),{db:r,doc:s,addDoc:a,updateDoc:i,cuesCollection:d,serverTimestamp:l}=o,y=typeof l=="function"?l():null;if(t){let p=s(r,"cues",t),u={...n};y&&(u.updatedAt=y),await i(p,u)}else{let p={...n};y&&(p.createdAt=y,p.updatedAt=y),await a(d,p)}await _n(),Ut(Et,P,N?.modalTitle??null,Po),await N?.hide({reason:"form-submit"})}catch(o){console.error("Failed to save cue",o)}}async function tr(){!X||!P||!U||(U.addEventListener("click",Zo),X.addEventListener("submit",er))}X&&P&&(document.addEventListener("cue:prepare",()=>{P.value="",N?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{P.value="",N?.setEditMode(!1)}));X&&P&&U&&tr().catch(e=>{console.error("Failed to initialise cue editing",e)});(U||oe)&&_n();var E=[],Oe=null,Q=!1,we=K(),he=!1,v=we,L=null,pe=null,S=null,yt=me(),nr=e=>{if(!vn)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=ln(we),vn.textContent=String(t.length)};function ae(e,t){if(nr(e),Ln){let n=it(e?.weekId||t,{short:!0});Ln.textContent=n||""}}function vt(e,{tone:t="muted"}={}){if(!B)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),B.innerHTML=`<p class="${n.join(" ")}">${w(e)}</p>`}function Wn(e){if(!En)return;let t=it(e);En.textContent=t||""}function Ye(e){if(!_)return;yt=me();let t=Object.values(yt).sort((s,a)=>s.name.localeCompare(a.name)),n=t.length>0,r=[`<option value="">${w(n?"Select template":"No templates saved")}</option>`];t.forEach(s=>{let a=s.name;r.push(`<option value="${w(a)}">${w(a)}</option>`)}),_.innerHTML=r.join(""),_.disabled=!n,e&&yt[e]?_.value=e:_.value=""}function Te(e){let t=e?.templateId||lt();Ye(t)}function Se(e){if(!B)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){vt("No lessons saved for this week yet."),S=null;return}let n=t.map(r=>typeof r.id=="string"&&r.id?r.id:"").filter(r=>!!r);S&&!n.includes(S)&&(S=null);let o=t.map(r=>{let s=Array.isArray(r.details)?r.details.map(p=>`
                <li class="flex items-center gap-2">
                  ${p.badge?`<span class="badge badge-outline badge-sm text-secondary">${w(p.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${w(p.text)}</span>
                </li>
              `).join(""):"",a=s?`<ul class="space-y-2 text-sm text-base-content/70">${s}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',i=typeof r.id=="string"?r.id:"",d=!!(S&&i&&S===i),l=["data-planner-lesson",i?`data-lesson-id="${i}"`:"",d?'data-planner-selected="true"':""].filter(Boolean).join(" "),y=r.summary?`<p class="text-sm text-base-content/70">${w(r.summary)}</p>`:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${l}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${w(r.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${w(r.title||r.dayLabel||"Lesson")}</h2>
                ${y}
              </div>
              <div class="flex items-center gap-1">
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${i}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${i}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${a}
            <div>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${i}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");B.innerHTML=o,Lt(S||null)}function Lt(e){if(S=e||null,!B)return;B.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function or(){return S&&(Array.isArray(L?.lessons)?L.lessons:[]).some(t=>t.id===S)?S:null}function rr(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===S||Lt(n)}function ne(e){if(!B)return pe=null,Promise.resolve();let t=e||K();v=t,Wn(t),vt("Loading plan\u2026");let n=(async()=>{try{let o=await Y(t);L=o,Se(o),ae(o,t),Te(o)}catch(o){console.error("Failed to load planner week",o),vt("Unable to load this week's planner.",{tone:"error"})}})();return pe=n,n.finally(()=>{pe===n&&(pe=null)})}async function sr(){if(!B)return;he||Ge();let e=pe;if(!e&&(!L||L.weekId!==v)&&(e=ne(v)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}function ar(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),o=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":dr(o,t);break;case"edit":ur(o,t);break;case"delete":fr(o);break;default:break}}async function jn(e){if(typeof document>"u"||!plannerLessonModalController)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=L?.lessons?.[0]?.dayLabel||"Monday";plannerLessonModalController.openAddLesson({defaultDay:n,trigger:t})}async function ir(e){if(!plannerLessonModalController)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Me(v,1);plannerLessonModalController.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function lr(e){if(!_)return;let t=e?.currentTarget instanceof HTMLSelectElement?e.currentTarget:_,n=t.value?.trim();if(n){t.disabled=!0;try{let o=await pn(v,n);o&&(L=o,Se(o),ae(o,v),Te(o))}catch(o){console.error("Failed to apply planner template",o),window.alert("Unable to apply that template right now.")}finally{Ye(n)}}}async function cr(e){if(e?.preventDefault?.(),!Rn)return;let t=L||await Y(v),n=Array.isArray(t?.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let o=typeof window<"u"?window.prompt("Name this template:",t?.templateId||""):null,r=typeof o=="string"?o.trim():"";if(r)try{mn(r,{lessons:n}),Ye(r)}catch(s){console.error("Failed to save planner template",s),window.alert("Unable to save that template right now.")}}async function dr(e,t){if(!e||!plannerLessonModalController)return;let n=L?.lessons?.find(r=>r.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;plannerLessonModalController.openAddDetail({lesson:n,trigger:o})}async function ur(e,t){if(!e||!plannerLessonModalController)return;let n=L?.lessons?.find(r=>r.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;plannerLessonModalController.openEditLesson({lesson:n,trigger:o})}async function fr(e){if(!e||typeof window>"u")return;let t=L?.lessons?.find(o=>o.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let o=await dn(v,e);o&&(L=o,Se(o),ae(o,v),Te(o))}catch(o){console.error("Failed to delete planner lesson",o),window.alert("Unable to delete that lesson right now.")}}function Ge(){if(he||!B){he&&ne(v);return}he=!0,an({ensureFirestore:Le}),B.addEventListener("click",rr),B.addEventListener("click",ar),qo?.addEventListener("click",jn),Oo?.addEventListener("click",ir),_?.addEventListener("change",lr),Rn?.addEventListener("click",cr),No?.addEventListener("click",()=>{let e=Me(v,-1);ne(e)}),Ho?.addEventListener("click",()=>{let e=Me(v,1);ne(e)}),Ro?.addEventListener("click",()=>{ne(K())}),Ye(lt()),ne(v)}function Dn(){typeof window>"u"||Mn()==="planner"&&Ge()}function mr(e){let t=e?.detail?.plan;t&&(he&&t.weekId===v&&(L=t,Se(t),Wn(t.weekId),Te(t)),t.weekId===we&&ae(t,we))}ae(null,we);typeof document<"u"&&document.addEventListener(ot,mr);typeof window<"u"&&(window.addEventListener("hashchange",Dn),window.addEventListener("DOMContentLoaded",Dn));var Vn="dailyTasksByDate",qe=null;function kt(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function pr(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),r=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(o,10);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(a))return e;let i=new Date(r,s-1,a);return Number.isNaN(i.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(i)}function ve(e){if(!bt)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);bt.disabled=!t}function J(e){if(!z)return;if(!Array.isArray(e)||e.length===0){z.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',ve([]);return}let t=e.map((n,o)=>{let r=w(n?.text||""),s=!!n?.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return s&&a.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${r}" ${s?"checked":""} />
          <span class="${a.join(" ")}">${r}</span>
        </div>
      `}).join("");z.innerHTML=t,ve(e)}function Ke(){Ve&&Ve.classList.remove("hidden")}function yr(){Ve&&Ve.classList.add("hidden")}function Ct(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function ie(e){return Array.isArray(e)?e.map(t=>Ct(t)):[]}function It(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Vn);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function Kn(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Vn,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Bn(e){let t=It(),n=t&&typeof t=="object"?t[e]:[];return ie(n)}function $e(e,t){let n=It(),o=ie(t);return n[e]=o,Kn(n),o}function ht(e,t){let n=It(),o=ie(n[e]);return o.push(Ct(t)),n[e]=o,Kn(n),o}function ze(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Dt(){return qe||(qe=Le().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),qe)}function Bt(e,t){let{doc:n,dailyListsCollection:o,db:r}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(r,"dailyLists",t)}async function Ft(){if(!bn||!z)return;let e=kt(),t=pr(e);if(bn.textContent=t?`Today's List - ${t}`:"Today's List",Q){Ke();let n=Bn(e);return E=n,J(n),Promise.resolve(n)}return Oe||(z.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',ve([]),Oe=(async()=>{try{let n=await Dt(),o=Bt(n,e),r=await n.getDoc(o),s=r.exists()?r.data()?.tasks:[];return E=ie(s),J(E),$e(e,E),Q=!1,yr(),E}catch(n){if(ze(n)){console.warn("Falling back to local daily tasks due to permission issue",n),Q=!0,Ke();let o=Bn(e);return E=o,J(o),o}return console.error("Failed to load daily list",n),z.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',E=[],ve(E),E}})().finally(()=>{Oe=null})),Oe}async function hr(e){let t=kt(),n=Ct(e);if(Q){ht(t,n);return}try{let o=await Dt(),r=Bt(o,t),s=await o.getDoc(r);if(s.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(r,{tasks:o.arrayUnion(n)});else{let a=s.exists()?s.data()?.tasks:[],i=Array.isArray(a)?ie(a):[];i.push(n),typeof o.setDoc=="function"?await o.setDoc(r,{tasks:i},{merge:!0}):await o.updateDoc(r,{tasks:i})}ht(t,n)}catch(o){if(ze(o)){console.warn("Saving task locally because cloud sync is unavailable",o),Q=!0,Ke(),ht(t,n);return}throw o}}async function Yn(e){let t=kt(),n=ie(e);if(Q){$e(t,n);return}try{let o=await Dt(),r=Bt(o,t);typeof o.setDoc=="function"?await o.setDoc(r,{tasks:n},{merge:!0}):await o.updateDoc(r,{tasks:n}),$e(t,n)}catch(o){if(ze(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),Q=!0,Ke(),$e(t,n);return}throw o}}function Gn(e){[We,je].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function gr(){!ge||!be||(ge.classList.remove("hidden"),be.classList.add("hidden"),Gn(We))}function br(){!ge||!be||(ge.classList.add("hidden"),be.classList.remove("hidden"),Gn(je),Ft())}We&&je&&ge&&be&&(We.addEventListener("click",e=>{e.preventDefault(),gr()}),je.addEventListener("click",e=>{e.preventDefault(),br()}));var T=null,F=!1,_e=null;function re(e){if(!D)return;D.setAttribute("aria-pressed",e?"true":"false");let t=D.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":D.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function Er(){F&&(window.clearTimeout(_e),_e=window.setTimeout(()=>{_e=null,F&&zn(!0)},400))}function zn(e=!1){if(!T)return!1;if(F&&!e)return!0;try{return T.start(),F=!0,re(!0),!0}catch{return F=!1,re(!1),!1}}function Mt(){if(T){F=!1,window.clearTimeout(_e);try{T.stop()}catch{}re(!1)}}function wr(){if(D)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){D.setAttribute("disabled","true"),D.setAttribute("aria-disabled","true"),D.title="Voice input is not supported in this browser.";return}T=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(T.lang=t,T.interimResults=!1,"continuous"in T)try{T.continuous=!0}catch{}T.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&k){k.value=o.trim();try{k.focus({preventScroll:!0})}catch{k.focus()}try{let r=k.value.length;k.setSelectionRange(r,r)}catch{}}},T.onend=()=>{if(!F){re(!1);return}Er()},T.onerror=()=>{F=!1,re(!1)}}catch{T=null,re(!1),D.setAttribute("disabled","true"),D.setAttribute("aria-disabled","true")}}wr();D?.addEventListener("click",()=>{T&&(F?Mt():zn())});Hn?.addEventListener("submit",()=>{F&&Mt()});window.addEventListener("pagehide",()=>{F&&Mt()});Hn?.addEventListener("submit",async e=>{if(e.preventDefault(),!k)return;let t=k.value.trim();if(!t){k.focus();return}let n={text:t,completed:!1};k.value="",k.focus();try{await hr(n),await Ft()}catch(o){console.error("Failed to add task to the daily list",o),k.value=t,k.focus()}});z?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(E)||Number.isNaN(n)||!E[n])return;let o=E.map(s=>({...s})),r=o.map((s,a)=>a===n?{...s,completed:t.checked}:s);E=r,J(r);try{await Yn(r)}catch(s){console.error("Failed to update task completion state",s),E=o,J(o)}});bt?.addEventListener("click",async()=>{if(!Array.isArray(E)||E.length===0)return;let e=E.filter(n=>!n.completed);if(e.length===E.length)return;let t=E.map(n=>({...n}));E=e,J(e);try{await Yn(e)}catch(n){console.error("Failed to clear completed tasks",n),E=t,J(t)}});ve(E);Ft();function vr(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),o=document.getElementById("noteNewBtn"),r=document.getElementById("notesList");if(!e||!t||!n||!o)return;let s=null,a=u=>{if(!u){s=null,e.value="",t.value="";return}s=u.id,e.value=u.title||"",t.value=u.body||""},i=()=>{if(!r)return;r.querySelectorAll("button[data-note-id]").forEach(f=>{if(!(f instanceof HTMLElement))return;let h=f.getAttribute("data-note-id")===s;f.classList.toggle("bg-base-200/80",h),f.classList.toggle("border-base-300",!h),f.classList.toggle("border-primary",h),f.classList.toggle("font-medium",h),f.setAttribute("aria-current",h?"true":"false")})},d=()=>{let u=xe();return Array.isArray(u)?[...u].sort((f,h)=>{let b=Date.parse(f?.updatedAt||""),g=Date.parse(h?.updatedAt||"");return(Number.isNaN(g)?0:g)-(Number.isNaN(b)?0:b)}):[]},l=u=>{if(!u)return;let f=xe();if(!Array.isArray(f))return;let h=f.filter(g=>g.id!==u);if(h.length===f.length)return;Xe(h),s===u&&(s=null);let b=y();if(s){let g=b.find(I=>I.id===s)||null;a(g)}else b.length?a(b[0]):a(null);i()},y=(u=d())=>{if(!r)return u;if(r.innerHTML="",!u.length){let f=document.createElement("li");return f.className="text-sm italic text-base-content/60",f.textContent="No saved notes yet.",r.appendChild(f),u}return u.forEach(f=>{let h=document.createElement("li");h.className="flex items-center gap-2";let b=document.createElement("button");b.type="button",b.dataset.noteId=f.id,b.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",b.textContent=f.title||"Untitled note",b.addEventListener("click",()=>{a(f),i()});let g=document.createElement("button");g.type="button",g.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",g.setAttribute("aria-label",`Delete note "${f.title||"Untitled note"}"`),g.textContent="Delete",g.addEventListener("click",I=>{I.stopPropagation(),l(f.id)}),h.appendChild(b),h.appendChild(g),r.appendChild(h)}),i(),u},p=()=>{let u=y();if(!u.length){a(null),i();return}let f=s?u.find(h=>h.id===s):null;a(f||u[0]),i()};n.addEventListener("click",()=>{let u=xe(),f=Array.isArray(u)?[...u]:[],h=typeof e.value=="string"?e.value.trim():"",b=typeof t.value=="string"?t.value:"",g=h||"Untitled note",I=new Date().toISOString();if(s){let A=f.findIndex(C=>C.id===s);if(A>=0)f[A]={...f[A],title:g,body:b,updatedAt:I};else{let C=Je(g,b,{updatedAt:I});s=C.id,f.unshift(C)}}else{let A=Je(g,b);s=A.id,f.unshift(A)}Xe(f);let H=y(),le=s?H.find(A=>A.id===s):null;a(le||null),i()}),o.addEventListener("click",()=>{s=null,e.value="",t.value="",i(),typeof e.focus=="function"&&e.focus()}),p()}vr();var Qn="theme",Lr="professional",Tt="memoryCue:theme-change",Tr="professional",St=document.getElementById("theme-menu"),Jn="[data-theme-name],[data-theme-option]",Sr=new Set(["dark","dracula","synthwave"]);function W(e){return typeof e=="string"?e.trim():""}function Xn(e){return e instanceof HTMLElement?W(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Ar(e){let t=W(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Sr.has(t)))}function Fn(e){let t=W(e);if(t)try{localStorage.setItem(Qn,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Zn(e){if(!St)return;let t=W(e);St.querySelectorAll(Jn).forEach(o=>{if(!(o instanceof HTMLElement))return;let r=Xn(o),s=t&&r===t;o.setAttribute("aria-checked",s?"true":"false"),o.classList.toggle("active",s)})}function xr(e){let t=W(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(Tt,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent(Tt,!0,!0,{theme:t}),window.dispatchEvent(o)}}}function At(e,{persist:t=!0,notify:n=!0}={}){let o=W(e);if(!o)return;W(document.documentElement.getAttribute("data-theme"))!==o&&Ar(o),t&&Fn(o),Zn(o),n&&xr(o)}function kr(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){At(Tr,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Qn)||""}catch(o){console.warn("Unable to load theme preference",o)}let n=t||document.documentElement.getAttribute("data-theme")||Lr;n&&At(n,{persist:!1,notify:!0})}St?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(Jn):null;if(!t)return;e.preventDefault();let n=Xn(t);n&&At(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(Tt,e=>{let t=W(e?.detail?.theme);t&&Zn(t)});kr()});export default Cr();
