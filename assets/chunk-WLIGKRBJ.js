import{a as xi}from"./chunk-RCZ4YZVR.js";function En(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Ln(){let s=En(),l=s&&s.TimestampTrigger;return typeof l=="function"?l:null}function be(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Ln()}function Mi(){if(typeof window>"u"||!window.location)return jt;try{return new URL(jt,window.location.href).href}catch{return jt}}async function Fe(){return pt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(pt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Mi()),await navigator.serviceWorker.ready}catch(s){return console.warn("Service worker registration failed",s),null}})(),pt))}async function qt(s,l){if(be())try{let Se=l||await Fe();if(!Se)return;let pe=[];try{pe=await Se.getNotifications({tag:s,includeTriggered:!0})}catch{pe=await Se.getNotifications({tag:s})}for(let b of pe)try{b.close()}catch{}}catch{}}function An(){for(let s of Array.from(ee.values()))try{s.close()}catch{}ee.clear()}function Ri(){if(Sn||typeof window>"u"||typeof window.addEventListener!="function")return;let s=()=>An();["pagehide","beforeunload"].forEach(l=>{try{window.addEventListener(l,s)}catch{}}),Sn=!0}function D(s){if(typeof s=="string"){let l=s.replace(/\s+/g," ").trim();if(l)return l}return H}async function Bi(s={}){let l=e=>e?document.querySelector(e):null,Se=e=>e?Array.from(document.querySelectorAll(e)):[],pe=l(s.qSel),b=l(s.titleSel),G=l(s.dateSel),q=l(s.timeSel),_=l(s.detailsSel),re=l(s.prioritySel),k=l(s.categorySel),Ee=l(s.saveBtnSel),yt=l(s.cancelEditBtnSel),U=l(s.listSel),mt=l(s.googleSignInBtnSel),gt=l(s.googleSignOutBtnSel),ht=l(s.statusSel),C=l(s.syncStatusSel),Dn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."};function vt(e,t){if(!C)return;let n=["online","offline","error"];n.forEach(c=>C.classList.remove(c)),n.includes(e)&&C.classList.add(e),C.dataset.state=e;let i=typeof t=="string"?t:Dn[e]||"";e==="online"||e==="offline"?(C.textContent="",C.dataset.compact="true",i?(C.setAttribute("aria-label",i),C.setAttribute("title",i)):(C.removeAttribute("aria-label"),C.removeAttribute("title"))):(C.textContent=i,C.removeAttribute("data-compact"),i?(C.setAttribute("aria-label",i),C.setAttribute("title",i)):(C.removeAttribute("aria-label"),C.removeAttribute("title")))}let x=l(s.notesSel),Cn=l(s.saveNotesBtnSel),kn=l(s.loadNotesBtnSel),ae=l(s.sortSel),wt=Se(s.filterBtnsSel),_t=e=>typeof e=="string"?e.trim().toLowerCase():"",$e=new Map;wt.forEach(e=>{let t=e?.getAttribute("data-filter"),n=_t(t);n&&!$e.has(n)&&$e.set(n,t)});let Oe=_t(s.defaultFilter),Tn=Oe&&$e.get(Oe)||(Oe&&!$e.size?Oe:null),Vt=l(s.countTodaySel),Wt=l(s.countWeekSel),Jt=l(s.countOverdueSel),zt=l(s.countTotalSel),Gt=l(s.countCompletedSel),Be=l(s.googleUserNameSel),se=l(s.dateFeedbackSel),R=l(s.voiceBtnSel),In=l(s.notifBtnSel),Le=l(s.moreBtnSel),Ae=l(s.moreMenuSel),xn=l(s.copyMtlBtnSel),bt=l(s.importFileSel),Nn=l(s.exportBtnSel),Mn=l(s.syncAllBtnSel),ye=l(s.syncUrlInputSel),Rn=l(s.saveSettingsSel),Fn=l(s.testSyncSel),$n=l(s.openSettingsSel),Pe=l(s.settingsSectionSel),Q=l(s.emptyStateSel),Qt=l(s.listWrapperSel),V=l(s.categoryFilterSel),St=l(s.categoryOptionsSel),Z=typeof document<"u"?document.getElementById("categoryFilterModal"):null,ce=s.variant||"mobile",Zt="mc:lastDefaults";function Et(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Zt)||"{}")||{}}catch{return{}}}function On(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Zt,JSON.stringify(e))}catch{}}function Yt(e){let t=Et(),n={category:D(e?.category||t.category||H),priority:e?.priority||t.priority||"Medium"};On(n)}let Kt='fieldset#priorityChips input[name="priority"]';function Lt(){try{let e=document.querySelector(`${Kt}:checked`);if(e&&e.value)return e.value}catch{}return re&&typeof re.value=="string"&&re.value?re.value:"Medium"}function He(e){let t=e||"Medium";re&&typeof re.value<"u"&&(re.value=t);try{let n=Array.from(document.querySelectorAll(Kt));if(!n.length)return;let i=!1;if(n.forEach(a=>{let c=a.value===t;a.checked=c,i=i||c}),!i){let a=n.find(c=>c.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function Xt(){let e=Et();e.category&&k&&(k.value=e.category),e.priority&&He(e.priority)}Xt();let F=typeof document<"u"?document.getElementById("quickAddInput"):null,Bn=typeof document<"u"?document.getElementById("quickAddSubmit"):null,$=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,At=null;function Pn(e,t){let n=Date.now(),i=Et(),a=typeof t=="string"&&t?t:null;return{id:rt(),title:(e||"").trim(),priority:i.priority||Lt(),category:D(i.category||k?.value||H),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!B}}async function Dt(){if(!F)return;if(typeof At=="function")try{At()}catch{}let e=(F.value||"").trim();if(!e)return;let t=null;try{let i=st(e);i&&i.time&&(t=new Date(`${i.date}T${i.time}:00`).toISOString())}catch{t=null}let n=Pn(e,t);g.unshift(n),xe=!0,A(),P(),fe(n),dt(n),ve(n),ie(),Yt(n),Ct();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:g}}))}catch{}Y({action:"created",label:`Reminder added \xB7 ${n.title}`}),F.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Dt),Bn?.addEventListener("click",()=>{Dt()}),F?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Dt())});function Hn(){if(typeof HTMLElement>"u"||!($ instanceof HTMLElement)||!(F instanceof HTMLInputElement)||$.dataset.voiceBound==="true")return;if($.dataset.voiceBound="true",typeof window>"u"){$.setAttribute("disabled","true"),$.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){$.setAttribute("disabled","true"),$.setAttribute("aria-disabled","true"),$.getAttribute("title")||($.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=p=>{n=p,$.setAttribute("aria-pressed",p?"true":"false"),$.dataset.listening=p?"true":"false",$.classList.toggle("is-listening",p)},a=()=>{if(t)return t;t=new e;let p=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=p,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",u=>{let y=u?.results?.[0]?.[0]?.transcript?.trim()||"";if(y){F.value=y;try{F.focus({preventScroll:!0})}catch{F.focus()}try{let w=F.value.length;typeof F.setSelectionRange=="function"&&F.setSelectionRange(w,w)}catch{}}});let d=()=>{i(!1)};return t.addEventListener("end",d),t.addEventListener("error",d),t},c=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};At=c,$.addEventListener("click",()=>{let p=a();if(p){if(n){c();return}try{p.start(),i(!0)}catch(d){console.warn("Quick add voice error:",d),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",c),i(!1)}Hn(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&F&&(e.preventDefault(),F.focus())})));try{ce==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let en=s.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",tn=s.emptyStateFilteredText||"No reminders match the current filter. Adjust your filters or add a new cue.",je=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,jn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Un=s.reminderLandingPath||(ce==="desktop"?"index.html#reminders":"mobile.html"),me=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function nn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ct(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:g}}))}catch{}}k&&!k.value&&(k.value=H),be()&&Fe();function Y(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(bn,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(bn,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function qn(){if(typeof HTMLElement>"u"||!(R instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&b instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&b instanceof HTMLTextAreaElement;if(!e&&!t||R.dataset.voiceBound==="true")return;if(R.dataset.voiceBound="true",typeof window>"u"){R.setAttribute("disabled","true"),R.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){R.setAttribute("disabled","true"),R.setAttribute("aria-disabled","true"),R.getAttribute("title")||(R.title="Voice input is not supported in this browser.");return}let i=null,a=!1,c=y=>{a=y,R.setAttribute("aria-pressed",y?"true":"false"),R.dataset.listening=y?"true":"false",R.classList.toggle("is-listening",y)},p=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",w=>{let S=w.results?.[0]?.[0]?.transcript?.trim()||"";if(S){b.value=S;try{b.focus({preventScroll:!0})}catch{try{b.focus()}catch{}}try{let E=b.value.length;typeof b.setSelectionRange=="function"&&b.setSelectionRange(E,E)}catch{}Y({action:"dictated",label:`Voice input captured \xB7 ${S}`})}});let y=()=>{c(!1)};return i.addEventListener("end",y),i.addEventListener("error",y),i},d=()=>{if(!(!a||!i)){try{i.stop()}catch{}c(!1)}};R.addEventListener("click",()=>{let y=p();if(y){if(a){d();return}try{y.start(),c(!0)}catch(w){console.warn("Speech recognition error:",w),c(!1)}}});let u=()=>{d()};typeof document<"u"&&(document.addEventListener("cue:close",u),document.addEventListener("reminders:updated",u)),c(!1)}Ri(),qn();let Ue,qe,_e,Ve,ge,We,Je,ze,Ge,Qe,Ze,De,Ce,Ye,Ke,Xe,et,tt,nt,on=s.firebaseDeps,kt=typeof s.importModule=="function"?s.importModule:e=>import(e),ke=En(),Te=!1,W=!1,Tt=null,K=null,de=null,g=[],Ie=Tn||"all",O=V?.value||"all",It=[],xt=[],Nt="memoryCue:sortPreference",it=new Set(["dueDate","priority","category","recent","date-desc","title-asc","title-desc"]),Mt=new Map([["due","dueDate"],["date-asc","dueDate"],["date-desc","date-desc"],["title-asc","title-asc"],["title-desc","title-desc"]]),T="dueDate",xe=!1,B=null,Ne=null,Me=null,le={},N={};if(typeof localStorage<"u")try{let e=localStorage.getItem(Nt),t=Mt.get(e)||e;t&&it.has(t)&&(T=t)}catch{}if(ae&&T)try{ae.value=it.has(T)?T:"dueDate"}catch{}function rn(){B=null,vt("offline"),mt?.classList.remove("hidden"),gt?.classList.add("hidden"),Be&&(Be.textContent=""),Ne?.(),Ne=null,Ft(),A(),P(),ie()}function Rt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Ut);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:i;return{id:typeof n.id=="string"&&n.id?n.id:rt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:D(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function _n(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Ut);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:D(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem(Ut,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function P(){_n(g)}function Ft(){g=Rt()}Ft();async function Vn(){if(!B){g=Rt();return}let e=Rt();if(!e.length){g=[],P();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await fe(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}g=e.map(n=>({...n,pendingSync:!1})),P(),A(),ie()}try{N=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{N={}}N&&typeof N=="object"&&Object.values(N).forEach(e=>{e&&typeof e=="object"&&(e.category=D(e.category))});let ot=e=>{if(!ke)return;let t=[ke];ke.window&&!t.includes(ke.window)&&t.push(ke.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Wn(){if(!x)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",c=()=>"value"in x?x.value:x.innerHTML,p=w=>{if("value"in x){x.value=w;return}if(typeof w!="string"||w.length===0){x.innerHTML="";return}let S=w.trim();if(/<\/?[a-z][\s\S]*>/i.test(S)){x.innerHTML=w;return}let j=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");x.innerHTML=j},d=w=>{w?x.classList.add("notes-editor--columns"):x.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!w))},u="";try{u=localStorage.getItem(n)||""}catch{m("Unable to access saved notes")}p(u);let y=!1;try{y=localStorage.getItem(i)==="1"}catch{y=!1}d(y),x.addEventListener("input",()=>{u=c();try{localStorage.setItem(n,u)}catch{m("Notes saved for this session only")}}),Cn?.addEventListener("click",()=>{u=c();try{localStorage.setItem(n,u),m("Notes saved")}catch{m("Notes saved for this session only")}}),kn?.addEventListener("click",()=>{let w=u;try{w=localStorage.getItem(n)||u}catch{m("Unable to load saved notes")}u=w,p(u)}),e?.addEventListener("click",w=>{let S=w.target;if(!(S instanceof Element))return;let E=S.closest("button[data-action]");if(!E)return;let j=E.getAttribute("data-action");if(j==="columns"){let oe=!x.classList.contains("notes-editor--columns");d(oe);try{localStorage.setItem(i,oe?"1":"0")}catch{m("Column preference saved for this session only")}return}if(!a){m("Formatting controls are not supported in this browser");return}x.focus(),j==="bullets"?document.execCommand("insertUnorderedList"):j==="numbers"&&document.execCommand("insertOrderedList")})}if(Wn(),Ee?.addEventListener("click",gn),on)({initializeApp:Ue,getFirestore:qe,enableMultiTabIndexedDbPersistence:_e,enableIndexedDbPersistence:Ve,doc:ge,setDoc:We,deleteDoc:Je,onSnapshot:ze,collection:Ge,query:Qe,orderBy:Ze,serverTimestamp:De,getAuth:Ce,onAuthStateChanged:Ye,GoogleAuthProvider:Ke,signInWithPopup:Xe,signInWithRedirect:et,getRedirectResult:tt,signOut:nt}=on),Te=!0;else try{({initializeApp:Ue}=await kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:qe,enableMultiTabIndexedDbPersistence:_e,enableIndexedDbPersistence:Ve,doc:ge,setDoc:We,deleteDoc:Je,onSnapshot:ze,collection:Ge,query:Qe,orderBy:Ze,serverTimestamp:De}=await kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ce,onAuthStateChanged:Ye,GoogleAuthProvider:Ke,signInWithPopup:Xe,signInWithRedirect:et,getRedirectResult:tt,signOut:nt}=await kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Te=!0}catch(e){Te=!1,console.warn("Firebase modules failed to load:",e),m("Firebase failed to load; notes available offline"),ot(!1)}if(Te&&typeof Ue=="function"&&typeof qe=="function"&&typeof Ce=="function")try{Tt=Ue({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),K=qe(Tt),W=!0,ot(!0)}catch(e){W=!1,console.warn("Firebase initialization failed:",e),m("Firebase failed to load; notes available offline"),ot(!1)}else Te?(W=!1,ot(!1)):W=!1;W&&typeof _e=="function"&&typeof Ve=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await _e(K),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Ve(K),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),W&&typeof Ce=="function"&&(de=Ce(Tt));function Jn(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let zn=typeof navigator<"u"&&navigator.language?navigator.language:"",an=Jn(zn),he=an||"en-US",X="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(X=e.timeZone),!an&&e.locale&&(he=e.locale)}catch{}let Gn=new Intl.DateTimeFormat(he,{timeZone:X,hour:"2-digit",minute:"2-digit"}),Qn=new Intl.DateTimeFormat(he,{timeZone:X,weekday:"long",day:"numeric",month:"long"}),Zn=new Intl.DateTimeFormat("en-CA",{timeZone:X,year:"numeric",month:"2-digit",day:"2-digit"}),Yn=new Intl.DateTimeFormat(he,{timeZone:X,weekday:"long"}),Kn=new Intl.DateTimeFormat(he,{timeZone:X,month:"short",day:"numeric"});function te(e){let t=Zn.formatToParts(e),n=t.find(c=>c.type==="year").value,i=t.find(c=>c.type==="month").value,a=t.find(c=>c.type==="day").value;return`${n}-${i}-${a}`}function sn(e,t){let[n,i,a]=e.split("-").map(u=>parseInt(u,10)),[c,p]=t.split(":").map(u=>parseInt(u,10)),d=new Date;return d.setFullYear(n,(i||1)-1,a||1),d.setHours(c||0,p||0,0,0),d.toISOString()}let Xn=new Intl.DateTimeFormat("en-CA",{timeZone:X,year:"numeric",month:"2-digit",day:"2-digit"}),ei=new Intl.DateTimeFormat("en-CA",{timeZone:X,hour:"2-digit",minute:"2-digit",hour12:!1});function ti(e){try{let t=new Date(e),n=Xn.formatToParts(t),i=n.find(p=>p.type==="year")?.value||"0000",a=n.find(p=>p.type==="month")?.value||"00",c=n.find(p=>p.type==="day")?.value||"00";return`${i}-${a}-${c}`}catch{return""}}function ni(e){try{let t=new Date(e),n=ei.formatToParts(t),i=n.find(c=>c.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(c=>c.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${a}`}catch{return""}}function rt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function at(){return te(new Date)}function cn(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function ii(e){let t=cn(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function ne(e){return e==="High"?3:e==="Medium"?2:1}function $i(e,t){let n=ne(t.priority)-ne(e.priority);if(n)return n;let i=+new Date(e.due||0),a=+new Date(t.due||0);return i!==a?i-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function $t(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Qn.format(t)}catch{return e}}function Ot(e){return Gn.format(e)}function ue(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function dn(e){return e?ue(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function m(e){ht&&(ht.textContent=e,clearTimeout(m._t),m._t=setTimeout(()=>ht.textContent="",2500))}function ln(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function st(e){e=String(e||"").toLowerCase();let t={date:at(),time:""},n=d=>{let u=new Date,y=u.getDay(),w=(d-y+7)%7,S=new Date(u);return S.setDate(u.getDate()+(w===0?7:w)),S},i=d=>{let u=new Date,y=u.getDay(),w=(d-y+7)%7,S=new Date(u);return S.setDate(u.getDate()+w),S},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},c={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let d=new Date;d.setDate(d.getDate()+1),t.date=te(d)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let d=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=a[d[1]],y=n(u);t.date=te(y)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let d=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=a[d[1]],y=i(u);t.date=te(y)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let d=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=a[d[1]],y=n(u);t.date=te(y)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let d=e.match(/\bin\s+(\d+)\s+days?\b/),u=parseInt(d[1],10),y=new Date;y.setDate(y.getDate()+u),t.date=te(y)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let d=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),u=parseInt(d[1],10),y=parseInt(d[2],10)-1,w=d[3]?parseInt(d[3],10):new Date().getFullYear(),S=new Date(w,y,u);t.date=te(S)}else for(let[d,u]of Object.entries(c)){let y=new RegExp(`\\b${d}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(y.test(e)){let w=e.match(y),S=parseInt(w[1],10),E=new Date().getFullYear(),j=new Date(E,u,S);t.date=te(j);break}}let p=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(p){let d=parseInt(p[1],10),u=p[2]?parseInt(p[2],10):0,y=p[3];y&&(y==="pm"&&d<12&&(d+=12),y==="am"&&d===12&&(d=0)),t.time=`${String(d).padStart(2,"0")}:${String(u).padStart(2,"0")}`}return t}let ct=W&&de&&typeof Ke=="function";mt?.addEventListener("click",async()=>{if(!ct||typeof Xe!="function"||typeof et!="function"){m("Sign-in unavailable offline");return}let e=new Ke;try{await Xe(de,e)}catch{try{await et(de,e)}catch{m("Google sign-in failed")}}}),ct&&typeof tt=="function"&&tt(de).catch(()=>{}),gt?.addEventListener("click",async()=>{if(!ct||typeof nt!="function"){m("Sign-out unavailable offline");return}try{await nt(de),m("Signed out")}catch{m("Sign-out failed")}}),ct&&typeof Ye=="function"?Ye(de,async e=>{e?(B=e.uid,vt("online"),mt?.classList.add("hidden"),gt?.classList.remove("hidden"),Be&&(Be.textContent=e.displayName||e.email||""),oi(),await Vn()):rn()}):rn();function oi(){if(!W||!K||typeof Ge!="function"||typeof Qe!="function"||typeof Ze!="function"||typeof ze!="function")return;if(!B){Ft(),A(),P(),ie();return}Ne&&Ne();let e=Ge(K,"users",B,"reminders"),t=Qe(e,Ze("updatedAt","desc"));Ne=ze(t,n=>{let i=[];n.forEach(a=>{let c=a.data();i.push({id:a.id,title:c.title,priority:c.priority,notes:c.notes||"",done:!!c.done,due:c.due||null,category:D(c.category),createdAt:c.createdAt?.toMillis?.()||0,updatedAt:c.updatedAt?.toMillis?.()||0,pendingSync:!1})}),g=i,A(),P(),ie()},n=>{console.error("Firestore sync error:",n),C&&vt("error","Sync Error")})}async function fe(e){if(!(!W||!B||!K||typeof ge!="function"||typeof We!="function"||typeof De!="function"))try{await We(ge(K,"users",B,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||H,createdAt:e.createdAt?new Date(e.createdAt):De(),updatedAt:De()},{merge:!0})}catch(t){console.error("Save failed:",t),m("Save queued (offline)")}}async function ri(e){if(!(!W||!B||!K||typeof ge!="function"||typeof Je!="function"))try{await Je(ge(K,"users",B,"reminders",e))}catch{m("Delete queued (offline)")}}async function dt(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||H,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Re(){b&&(b.value=""),G&&(G.value=""),q&&(q.value=""),_&&(_.value=""),He("Medium"),k&&(k.value=H),Xt(),Me=null,Ee&&(Ee.textContent="Save Cue"),yt?.classList.add("hidden")}function un(e){let t=g.find(n=>n.id===e);t&&(b&&(b.value=t.title||""),G&&q&&(t.due?(G.value=ti(t.due),q.value=ni(t.due)):(G.value="",q.value="")),He(t?.priority||"Medium"),k&&(k.value=D(t.category)),_&&(_.value=typeof t.notes=="string"?t.notes:""),Me=e,Ee&&(Ee.textContent="Update Cue"),yt?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),b?.focus(),me("cue:open",{mode:"edit"}))}function ai(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=D(e.category??(k?k.value:"")),a={id:rt(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!B};return g=[a,...g],xe=!0,A(),P(),Yt(a),fe(a),dt(a),ve(a),Ct(),me("memoryCue:remindersUpdated",{items:g}),nn(),Y({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function si(e,t){if(!B)return m("Sign in to add notes"),null;if(!e)return null;let n=g.find(p=>p.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let c=typeof n.notes=="string"?n.notes:"";return n.notes=c?`${c}
${a}`:a,n.updatedAt=Date.now(),fe(n),A(),P(),Y({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function fn(e){let t=g.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),fe(t),dt(t),A(),P(),t.done?(ut(e),Y({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(ve(t),Y({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function pn(e){let t=g.find(n=>n.id===e);g=g.filter(n=>n.id!==e),A(),P(),ri(e),ut(e),Y(t?{action:"deleted",label:`Reminder removed \xB7 ${t.title}`}:{action:"deleted",label:"Reminder removed"})}function Bt(){localStorage.setItem("scheduledReminders",JSON.stringify(N))}function lt(e,{closeNotification:t=!0}={}){if(t){let n=ee.get(e);if(n){try{n.close()}catch{}ee.delete(e)}}le[e]&&(clearTimeout(le[e]),delete le[e]),qt(e),N[e]&&(delete N[e],Bt())}function ut(e){lt(e)}function yn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ee.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:"Due now",tag:e.id});ee.set(e.id,n);let i=()=>{ee.get(e.id)===n&&ee.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function ci(e){if(!be())return!1;let t=Ln();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Fe();if(!i)return!1;await qt(e.id,i);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||H,urlPath:Un},c=typeof e.notes=="string"&&e.notes.split(/\r?\n/).find(u=>u.trim())||"",p=c||"Due now";try{let u=new Date(e.due);if(!Number.isNaN(u.getTime())){let y=Ot(u);y&&(p=c?`${c} \u2022 ${y}`:`Due ${y}`)}}catch{}let d={body:p,tag:e.id,data:a,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function ve(e){if(!e||!e.id)return;if(e.category=D(e.category),!e.due||e.done){ut(e.id);return}let t={id:e.id,title:e.title,due:e.due,category:e.category||H};if(N[e.id]=t,Bt(),le[e.id]&&(clearTimeout(le[e.id]),delete le[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return;let i=n-Date.now();if(i<=0){if(N[e.id]?.viaTrigger){lt(e.id,{closeNotification:!1});return}yn(e),lt(e.id,{closeNotification:!1});return}let a=be();a&&(t.viaTrigger=!1,ci(e).then(c=>{c&&N[e.id]&&(N[e.id]={...N[e.id],viaTrigger:!0},Bt())})),le[e.id]=setTimeout(()=>{a&&qt(e.id),yn(e),lt(e.id,{closeNotification:!1})},i)}function ie(){Object.values(N).forEach(e=>ve({...e,category:D(e?.category)}))}let mn={High:"bg-rose-400/80 dark:bg-rose-300/80",Medium:"bg-amber-400/80 dark:bg-amber-300/80",Low:"bg-emerald-400/80 dark:bg-emerald-300/80"};function di(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Yn.format(t),i=Kn.format(t),a=Ot(t);return`${n}, ${i}${a?` at ${a}`:""}`}catch{return"No due date"}}function A(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let a=cn(t),c=ii(t),p=g.filter(o=>{if(!o.due||o.done)return!1;let r=new Date(o.due);return r>=n&&r<=i}),d=g.filter(o=>{if(!o.due||o.done)return!1;let r=new Date(o.due);return r>=a&&r<=c}),u=g.filter(o=>o.done||!o.due?!1:new Date(o.due)<t).length,y=g.filter(o=>o.done).length;Vt&&(Vt.textContent=String(p.length)),Wt&&(Wt.textContent=String(d.length)),Jt&&(Jt.textContent=String(u)),zt&&(zt.textContent=String(g.length)),Gt&&(Gt.textContent=String(y)),g.forEach(o=>{o&&typeof o=="object"&&(o.category=D(o.category))});let w=new Set(Ni.map(o=>D(o)));g.forEach(o=>{o&&typeof o=="object"&&w.add(D(o.category))});let S=Array.from(w).sort((o,r)=>o.localeCompare(r,void 0,{sensitivity:"base"}));if(V){let o=O;V.replaceChildren();let r=document.createElement("option");r.value="all",r.textContent="All categories",V.appendChild(r),S.forEach(f=>{let h=document.createElement("option");h.value=f,h.textContent=f,V.appendChild(h)}),o!=="all"&&!S.includes(o)&&(O="all"),V.value=O}if(Z){let o=Z.value;Z.replaceChildren();let r=(L,M)=>{let v=document.createElement("option");v.value=L,v.textContent=M,Z.appendChild(v)};r("all","All Categories"),S.forEach(L=>r(L,L));let h=o!=="all"&&!S.includes(o)?"all":O;Z.value=h}if(St){let o=new Set;Array.from(St.querySelectorAll("option")).forEach(r=>{o.add(r.value.trim().toLowerCase())}),S.forEach(r=>{let f=r.toLowerCase();if(!o.has(f)){let h=document.createElement("option");h.value=r,St.appendChild(h),o.add(f)}})}if(xe)xe=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let o=g.map(r=>({...r}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:o}}));else if(document.createEvent){let r=document.createEvent("CustomEvent");r&&r.initCustomEvent&&(r.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:o}),document.dispatchEvent(r))}}catch{}}let E=g.slice(),j=pe?.value.trim().toLowerCase()||"";if(j&&(E=E.filter(o=>o.title.toLowerCase().includes(j)||(o.notes||"").toLowerCase().includes(j)||(o.category||"").toLowerCase().includes(j))),O&&O!=="all"&&(E=E.filter(o=>D(o.category)===O)),It.length){let o=new Set(It.map(r=>r.toLowerCase()));E=E.filter(r=>{let f=typeof r.priority=="string"?r.priority.toLowerCase():"";return o.has(f)})}if(xt.length){let o=new Set(xt.map(h=>h.toLowerCase())),r=o.has("pending"),f=o.has("done")||o.has("completed");E=E.filter(h=>r&&f?!0:f?h.done:r?!h.done:!1)}E=E.filter(o=>{if(Ie==="done")return o.done;if(Ie==="overdue")return!o.done&&o.due&&new Date(o.due)<t;if(Ie==="today"){if(o.done||!o.due)return!1;let r=new Date(o.due);return r>=n&&r<=i}return!0});let oe=(o,r)=>{let f=o.done?1:0,h=r.done?1:0;if(f!==h)return f-h;let L=o.due?new Date(o.due).getTime():1/0,M=r.due?new Date(r.due).getTime():1/0;if(L!==M)return L-M;let v=ne(r.priority)-ne(o.priority);return v||(r.updatedAt||0)-(o.updatedAt||0)},fi=(o,r)=>{let f=ne(r.priority)-ne(o.priority);return f||oe(o,r)},pi=(o,r)=>{let f=D(o.category||""),h=D(r.category||""),L=f.localeCompare(h,void 0,{sensitivity:"base"});return L||oe(o,r)},yi=(o,r)=>{let f=(r.createdAt||0)-(o.createdAt||0);return f||(r.updatedAt||0)-(o.updatedAt||0)},mi=(o,r)=>{let f=o.done?1:0,h=r.done?1:0;if(f!==h)return f-h;let L=o.due?new Date(o.due).getTime():-1/0,M=r.due?new Date(r.due).getTime():-1/0;if(L!==M)return M-L;let v=ne(r.priority)-ne(o.priority);return v||(r.updatedAt||0)-(o.updatedAt||0)},hn=(o,r)=>{let f=o.done?1:0,h=r.done?1:0;if(f!==h)return f-h;let L=(o.title||"").trim(),M=(r.title||"").trim(),v=L.localeCompare(M,void 0,{sensitivity:"base"});return v||oe(o,r)},gi=(o,r)=>hn(r,o),hi=T==="dueDate",vi={dueDate:oe,priority:fi,category:pi,recent:yi,"date-desc":mi,"title-asc":hn,"title-desc":gi}[T]||oe;E.sort(vi),wt.forEach(o=>{let r=o.getAttribute("data-filter")===Ie;o.classList.toggle("active",r),o.setAttribute("aria-pressed",String(r)),o.classList.contains("tab")?(o.classList.toggle("tab-active",r),o.setAttribute("aria-selected",String(r))):o.classList.contains("btn-ghost")||(o.classList.toggle("bg-gray-900",r),o.classList.toggle("text-white",r),o.classList.toggle("border-gray-900",r),o.classList.toggle("dark:bg-gray-100",r),o.classList.toggle("dark:text-gray-900",r),o.classList.toggle("dark:border-gray-100",r),o.classList.toggle("bg-white",!r),o.classList.toggle("text-gray-600",!r),o.classList.toggle("border-gray-200",!r),o.classList.toggle("dark:bg-gray-800",!r),o.classList.toggle("dark:text-gray-400",!r),o.classList.toggle("dark:border-gray-700",!r))});let wi=g.length>0,Pt=E.length>0;if(Q&&(wi?Pt?Q.classList.add("hidden"):(je?je(Q,{icon:"sparkles",title:"No reminders match this view",description:tn}):Q.textContent=tn,Q.classList.remove("hidden")):(je?je(Q,{icon:"bell",title:"Create your first cue",description:en,action:`<button type="button" class="${jn}" data-trigger="open-cue">Create reminder</button>`}):Q.textContent=en,Q.classList.remove("hidden"))),Qt&&Qt.classList.toggle("has-items",Pt),!U)return;if(!Pt){Q?(U.innerHTML="",U.classList.add("hidden")):(U.innerHTML='<div class="text-muted">No reminders found.</div>',U.classList.remove("hidden"));return}U.classList.remove("hidden"),U.replaceChildren();let we=document.createDocumentFragment(),Ht=U.tagName==="UL"||U.tagName==="OL",bi=!0,vn=(o,r)=>{let f=document.createElement("div");f.className="task-item"+(o.done?" completed":"");let h={id:o.id,title:o.title,dueIso:o.due||null,priority:o.priority||"Medium",category:r,done:!!o.done};f.dataset.category=r,f.dataset.reminder=JSON.stringify(h),f.dataset.id=h.id,f.dataset.title=h.title,f.dataset.priority=h.priority,f.dataset.done=String(h.done),h.dueIso&&(f.dataset.due=h.dueIso);let L=h.dueIso?new Date(h.dueIso):null;hi&&L&&L>=n&&L<=i&&(f.classList.add("is-today"),f.dataset.today="true");let v=o.due?`${Ot(new Date(o.due))} \u2022 ${$t(o.due.slice(0,10))}`:"No due date",I=`priority-${(o.priority||"Medium").toLowerCase()}`,z=o.notes?`<div class="task-notes">${dn(o.notes)}</div>`:"";return f.innerHTML=`
        <input type="checkbox" ${o.done?"checked":""} aria-label="Mark complete" />
        <div class="task-content">
          <div class="task-title"><strong>${ue(o.title)}</strong></div>
          <div class="task-meta">
            <div class="task-meta-row" style="gap:8px; flex-wrap:wrap;">
              <span>${v}</span>
              <span class="priority-badge ${I}">${o.priority}</span>
              <span class="priority-badge" style="background:rgba(56,189,248,.14);color:#0284c7;border-color:rgba(56,189,248,.26);">${ue(r)}</span>
            </div>
          </div>
          ${z}
        </div>
        <div class="task-actions">
          <button class="btn-ghost" data-edit type="button">Edit</button>
          <button class="btn-ghost" data-del type="button">Del</button>
        </div>`,f.querySelector("input").addEventListener("change",()=>fn(o.id)),f.querySelector("[data-edit]").addEventListener("click",()=>un(o.id)),f.querySelector("[data-del]").addEventListener("click",()=>pn(o.id)),f};if(ce!=="desktop"&&!bi){E.forEach(o=>{let r=o.category||H;we.appendChild(vn(o,r))}),U.appendChild(we);return}let ft=new Map;E.forEach(o=>{let r=o.category||H;ft.has(r)||ft.set(r,[]),ft.get(r).push(o)});let Si=Array.from(ft.entries()).sort((o,r)=>o[0].localeCompare(r[0],void 0,{sensitivity:"base"})),wn=!0;Si.forEach(([o,r])=>{let f=document.createElement(Ht?"li":"div");f.dataset.categoryHeading=o,Ht&&(f.setAttribute("role","presentation"),f.style.listStyle="none"),f.className=ce==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",wn||(f.style.marginTop=ce==="desktop"?"1.25rem":"1rem");let h=document.createElement("div");h.setAttribute("role","heading"),h.setAttribute("aria-level","3"),h.className=ce==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let L=document.createElement("span");L.textContent=o;let M=document.createElement("span");M.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",M.textContent=`${r.length} ${r.length===1?"item":"items"}`,h.append(L,M),f.appendChild(h),we.appendChild(f),r.forEach(v=>{if(ce==="desktop"){let I=document.createElement(Ht?"li":"div"),z={id:v.id,title:v.title,dueIso:v.due||null,priority:v.priority||"Medium",category:o,done:!!v.done};I.dataset.id=z.id,I.dataset.category=z.category,I.dataset.title=z.title,I.dataset.priority=z.priority,I.dataset.done=String(z.done),z.dueIso&&(I.dataset.due=z.dueIso),I.dataset.reminder=JSON.stringify(z),I.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let Ei=di(v),Li=mn[v.priority]||mn.Medium,Ai=v.done?"line-through text-base-content/50":"text-base-content",Di=v.done?"Completed":"Active",Ci=v.priority==="High"?"badge badge-outline border-error text-error":v.priority==="Medium"?"badge badge-outline border-warning text-warning":"badge badge-outline border-success text-success",ki=v.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Ti=v.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",Ii=v.notes?`<p class="text-sm leading-relaxed text-base-content/70">${dn(v.notes)}</p>`:"";I.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${Ai}">${ue(v.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ue(Ei)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ue(o)}
            </span>
            <span class="${Ci} gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full ${Li}"></span>
              ${ue(v.priority)} priority
            </span>
            <span class="${ki} text-[0.7rem] sm:text-xs">${Di}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${Ii}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Ti}">${v.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,I.querySelector('[data-action="toggle"]').addEventListener("click",()=>fn(v.id)),I.querySelector('[data-action="edit"]').addEventListener("click",()=>un(v.id)),I.querySelector('[data-action="delete"]').addEventListener("click",()=>pn(v.id)),we.appendChild(I);return}we.appendChild(vn(v,o))}),wn=!1}),U.appendChild(we)}function J(){Le?.setAttribute("aria-expanded","false"),Ae?.classList.add("hidden")}function li(){Le?.setAttribute("aria-expanded","true"),Ae?.classList.remove("hidden")}Le?.addEventListener("click",e=>{e.stopPropagation(),Le.getAttribute("aria-expanded")==="true"?J():li()}),document.addEventListener("click",e=>{Ae&&!Ae.classList.contains("hidden")&&!Ae.contains(e.target)&&e.target!==Le&&J()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&J()}),$n?.addEventListener("click",()=>{let e=Pe?.classList.contains("hidden");Pe?.classList.toggle("hidden"),e&&Pe?.scrollIntoView({behavior:"smooth",block:"start"}),J()}),document.addEventListener("DOMContentLoaded",()=>{Pe?.classList.add("hidden")});function gn(){try{console.log("handleSaveAction invoked",{editingId:Me,title:b?.value})}catch{}if(Me){let i=g.find(d=>d.id===Me);if(!i){Re();return}let a=b.value.trim();if(!a){m("Add a reminder title");return}let c=null;if(G.value||q.value){let d=G.value||at(),u=q.value||"09:00";c=sn(d,u)}else{let d=st(a);d.time&&(c=new Date(`${d.date}T${d.time}:00`).toISOString())}i.title=a;let p=Lt();i.priority=p,He(p),k&&(i.category=D(k.value)),i.due=c,_&&(i.notes=_.value.trim()),i.updatedAt=Date.now(),fe(i),dt(i),xe=!0,A(),ve(i),P(),Ct(),me("memoryCue:remindersUpdated",{items:g}),nn(),Y({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Re(),m("Reminder updated"),me("cue:close",{reason:"updated"});return}let e=b.value.trim();if(!e){m("Add a reminder title");return}let t=_?_.value.trim():"",n=null;if(G.value||q.value){let i=G.value||at(),a=q.value||"09:00";n=sn(i,a)}else{let i=st(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}ai({title:e,priority:Lt(),category:k?k.value:"",due:n,notes:t}),b.value="",q.value="",_&&(_.value=""),me("cue:close",{reason:"created"})}b?.addEventListener("keydown",e=>{e.key==="Enter"&&gn()});function ui(){if(!b||!se)return;let e=b.value.trim();if(!e){se.style.display="none";return}try{let t=st(e),n=at();if(t.date!==n||t.time){let i="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${$t(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(se.textContent=`Parsed: ${i}`,se.style.display="block"):se.style.display="none"}else se.style.display="none"}catch{se.style.display="none"}}return b?.addEventListener("input",ln(ui,300)),yt?.addEventListener("click",()=>{Re(),m("Edit cancelled"),me("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Re()}),document.addEventListener("cue:prepare",()=>{Re()}),window.addEventListener("load",()=>b?.focus()),pe?.addEventListener("input",ln(A,150)),ae?.addEventListener("change",()=>{let e=ae.value;if(T=Mt.get(e)||e||"dueDate",it.has(T)||(T="dueDate"),typeof localStorage<"u")try{localStorage.setItem(Nt,T)}catch{}A()}),document.addEventListener("reminders:sort",e=>{let t=e?.detail?.type;if(!t)return;let n=Mt.get(t)||t;if(it.has(n)||(n="dueDate"),T===n){document.activeElement instanceof HTMLElement&&document.activeElement.blur?.();return}if(T=n,ae)try{let i=ae.querySelector(`option[value="${T}"]`);ae.value=i?T:"dueDate"}catch{}if(typeof localStorage<"u")try{localStorage.setItem(Nt,T)}catch{}A()}),document.addEventListener("reminders:filter",e=>{let t=e?.detail||{},n=typeof t.category=="string"?t.category.trim():"";if(n?O=n.toLowerCase()==="all"?"all":D(n):O="all",It=Array.isArray(t.priorities)?Array.from(new Set(t.priorities.map(i=>typeof i=="string"?i.trim():"").filter(Boolean).map(i=>i.toLowerCase()))):[],xt=Array.isArray(t.statuses)?Array.from(new Set(t.statuses.map(i=>typeof i=="string"?i.trim().toLowerCase():"").filter(Boolean))):[],V)try{V.value=O}catch{}if(Z)try{Z.value=O}catch{}A()}),V?.addEventListener("change",()=>{if(O=V.value||"all",Z)try{Z.value=O}catch{}A()}),wt.forEach(e=>e.addEventListener("click",()=>{Ie=e.getAttribute("data-filter"),A()})),xn?.addEventListener("click",()=>{let e=g.filter(t=>!t.done).map(t=>{let n=t.due?$t(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(he,{hour:"2-digit",minute:"2-digit",timeZone:X}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){m("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>m("Copied for Master Task List")).catch(()=>m("Copy failed")),J()}),bt?.addEventListener("change",()=>{let e=bt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(i=>{i.id=rt(),i.category=D(i.category),i.pendingSync=!B,g=[i,...g],fe(i)}),A(),P(),m("Import successful")}catch{m("Invalid JSON")}},t.readAsText(e),bt.value="",J()}),Nn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),J()}),Mn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){m("Add your Apps Script URL in Settings first"),J();return}if(!g.length){m("No tasks to sync"),J();return}m("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<g.length;i+=t){let a=g.slice(i,i+t),c=await Promise.allSettled(a.map(p=>{let d={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:p.category||H,done:!!p.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})}));n+=c.filter(p=>p.status==="rejected").length,await new Promise(p=>setTimeout(p,400))}m(`Sync complete: ${g.length-n} ok${n?`, ${n} failed`:""}`),J()}),ye&&(ye.value=localStorage.getItem("syncUrl")||""),Rn?.addEventListener("click",()=>{ye&&(localStorage.setItem("syncUrl",ye.value.trim()),m("Settings saved"))}),Fn?.addEventListener("click",async()=>{if(!ye)return;let e=ye.value.trim();if(!e){m("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});m(t.ok?"Test ok":"Test failed")}catch{m("Test failed")}}),In?.addEventListener("click",async()=>{if(!("Notification"in window)){m("Notifications not supported");return}if(Notification.permission==="granted"){m("Notifications enabled"),be()&&Fe(),ie();return}try{await Notification.requestPermission()==="granted"?(m("Notifications enabled"),be()&&Fe(),ie()):m("Notifications blocked")}catch{m("Notifications blocked")}}),ie(),A(),P(),{cancelReminder:ut,scheduleReminder:ve,closeActiveNotifications:An,getActiveNotifications:()=>ee,addNoteToReminder:si,__testing:{setItems(e=[]){g=Array.isArray(e)?e.map(t=>({...t,category:D(t?.category)})):[],A()},render:A,getItems:()=>g.map(e=>({...e}))}}}var bn,ee,Sn,jt,pt,H,Ni,Ut,Fi=xi(()=>{bn="memoryCue:activity",ee=new Map,Sn=!1,jt="service-worker.js",pt=null,H="General",Ni=Object.freeze([H,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Ut="memoryCue:offlineReminders"});export{Bi as a,Fi as b};
