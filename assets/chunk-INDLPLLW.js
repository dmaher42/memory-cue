import{b as Ke,c as mi}from"./chunk-KX65DZXT.js";import{a as pi,b as Kt,c as Gr}from"./chunk-GUVSRPRW.js";function yi(i={}){try{Object.assign($,i||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function hi(i={}){try{if($&&typeof $.signInWithPopup=="function"&&$.auth&&typeof $.GoogleAuthProvider=="function")return $.signInWithPopup($.auth,new $.GoogleAuthProvider);if($&&typeof $.signInWithRedirect=="function"&&$.auth&&typeof $.GoogleAuthProvider=="function")return $.signInWithRedirect($.auth,new $.GoogleAuthProvider);let r=Ke();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...i});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{$?.toast?.("Sign-in failed")}catch(s){console.warn("[supabase-auth] toast handler failed",s)}throw r}return Promise.resolve(null)}async function bi(){try{if($&&typeof $.signOut=="function")return $.signOut($.auth);let i=Ke();if(i&&i.auth&&typeof i.auth.signOut=="function")return i.auth.signOut()}catch(i){throw console.error("[supabase-auth] startSignOutFlow error",i),i}return Promise.resolve(null)}function qr(i){return i?Array.isArray(i)?i:[i]:[]}function bt(i){return Array.from(new Set(i.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function pe(i,r){let s=qr(r).filter(Boolean);if(!s.length)return[];let c=s.flatMap(w=>Array.from(i.querySelectorAll(w)));return bt(c)}function zr(i,r=document){let s=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:pe(s,i.authForm),emailInputs:pe(s,i.emailInput),signInButtons:pe(s,i.signInButtons),signOutButtons:pe(s,i.signOutButtons),userBadges:pe(s,i.userBadge),userBadgeEmails:pe(s,i.userBadgeEmail),userBadgeInitials:pe(s,i.userBadgeInitial),userNameEls:pe(s,i.userName),syncStatusEls:pe(s,i.syncStatus),syncStatusTextEls:pe(s,i.syncStatusText),statusIndicatorEls:pe(s,i.statusIndicator),feedbackEls:pe(s,i.feedback)}}function gt(i,r){bt(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.classList.toggle("hidden",!r),r?s.removeAttribute("hidden"):s.setAttribute("hidden",""))})}function Oe(i,r){bt(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.textContent=r||"")})}function Xr(i,r){bt(i).forEach(s=>{s instanceof HTMLElement&&(s.dataset.state=r,s.classList.toggle("online",r==="online"),s.classList.toggle("offline",r!=="online"))})}function ht(i,r){bt(i).forEach(s=>{if(!(s instanceof HTMLElement))return;s.textContent=r||"";let c=!!r;s.classList.toggle("hidden",!c),c?s.removeAttribute("hidden"):s.setAttribute("hidden","")})}function Si(i={}){let r={...gi.syncStatusText,...i.syncStatusText||{}};return{...gi,...i,syncStatusText:r}}function yt(i,{user:r,messages:s}={}){let c=Si(s),w=!!r;gt(i.signInButtons,!w),gt(i.authForms,!w),gt(i.signOutButtons,w),gt(i.userBadges,w);let A=typeof r?.email=="string"?r.email:"",T=A?A.charAt(0).toUpperCase():"U";w?(Oe(i.userBadgeEmails,A),Oe(i.userBadgeInitials,T),Oe(i.userNameEls,A)):(Oe(i.userBadgeEmails,""),Oe(i.userBadgeInitials,""),Oe(i.userNameEls,""));let j=typeof c.signedIn=="function"?c.signedIn(r):c.signedIn,L=typeof c.signedOut=="function"?c.signedOut(r):c.signedOut,X=w?j:L,te=!w;i.syncStatusEls.length&&(Oe(i.syncStatusEls,X),i.syncStatusEls.forEach(ne=>{ne instanceof HTMLElement&&(ne.classList.toggle("online",w),ne.dataset.state=w?"online":"offline")}),gt(i.syncStatusEls,te));let E=w?c.syncStatusText?.signedIn:c.syncStatusText?.signedOut;Oe(i.syncStatusTextEls,E||""),Xr(i.statusIndicatorEls,w?"online":"offline"),ht(i.feedbackEls,"")}function Kr(i,r){r.authForms.forEach(s=>{!(s instanceof HTMLFormElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("submit",async c=>{c.preventDefault();let w=r.emailInputs.find(T=>s.contains(T))||s.querySelector('input[type="email"]'),A=typeof w?.value=="string"?w.value.trim():"";if(!A){ht(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:T}=await i.auth.signInWithOtp({email:A});T?ht(r.feedbackEls,T.message||"Unable to send magic link."):ht(r.feedbackEls,"Magic link sent. Check your email.")}catch(T){ht(r.feedbackEls,T?.message||"Unable to send magic link.")}}))})}function Jr(i,r){r.signOutButtons.forEach(s=>{!(s instanceof HTMLElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("click",async()=>{try{await i.auth.signOut()}catch(c){console.error("[supabase] Sign-out failed.",c)}}))})}function wo(i={}){let{supabase:r,scope:s=document,selectors:c={},messages:w={},disableButtonBinding:A=!1,onSessionChange:T}=i,j={...Vr,...c},L=zr(j,s),X=Si(w);yt(L,{user:null,messages:X});let te=r||Ke()||(typeof window<"u"?window.supabase:null);if(!te)return{supabase:null,elements:L,applyAuthState:Q=>yt(L,{...Q,messages:X}),destroy(){}};Kr(te,L),A||Jr(te,L);let E=[],{data:ne}=te.auth.onAuthStateChange((Q,P)=>{if(yt(L,{user:P?.user??null,messages:X}),typeof T=="function")try{T(P?.user??null,P)}catch(Y){console.error("[supabase] onSessionChange handler failed.",Y)}});return ne?.subscription&&E.push(()=>{try{ne.subscription.unsubscribe()}catch{}}),te.auth.getSession().then(({data:Q,error:P})=>{P||yt(L,{user:Q?.session?.user??null,messages:X})}).catch(Q=>{console.error("[supabase] getSession failed.",Q)}),{supabase:te,elements:L,applyAuthState:Q=>yt(L,{...Q,messages:X}),destroy(){E.forEach(Q=>{try{Q()}catch{}})}}}var $,Vr,gi,wi=Kt(()=>{mi();$={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};Vr={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},gi={signedOut:"",signedIn:i=>`Reminders syncing for ${i?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Ai=Gr((Eo,St)=>{var Jt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function vi(i){if(!i||typeof i!="object")return null;let r=Object.entries(i).filter(([s,c])=>typeof c=="string"&&c.trim()!=="");return r.length?Object.fromEntries(r):null}function Qr(){let i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=vi(i?.__FIREBASE_CONFIG);if(r)return r;let s=vi(i?.__ENV?.FIREBASE_CONFIG);if(s)return s;let w=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((A,[T,j])=>{let L=i?.__ENV?.[T]??i?.[T];return typeof L=="string"&&L.trim()!==""&&(A[j]=L),A},{});return Object.keys(w).length?w:null}function Ii(){let i=Qr();return i?{...Jt,...i}:{...Jt}}var Ei={DEFAULT_FIREBASE_CONFIG:Jt,getFirebaseConfig:Ii};if(typeof globalThis<"u"){let i=globalThis;i.memoryCueFirebase=i.memoryCueFirebase||{},i.memoryCueFirebase.getFirebaseConfig=Ii,i.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Jt}typeof St<"u"&&St.exports&&(St.exports=Ei,St.exports.default=Ei)});function to(){if(Ee)return{...Ee};let r=_n()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return Ee=r.getFirebaseConfig(),{...Ee};if(typeof pi=="function")try{let s=Ai();if(s){let c=typeof s.getFirebaseConfig=="function"?s.getFirebaseConfig:typeof s.default?.getFirebaseConfig=="function"?s.default.getFirebaseConfig:null;if(c)return Ee=c(),{...Ee}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(Ee={...r.DEFAULT_FIREBASE_CONFIG},{...Ee}):(Ee={...eo},{...Ee})}function _n(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Di(){let i=_n(),r=i&&i.TimestampTrigger;return typeof r=="function"?r:null}function Ce(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Di()}function no(){if(typeof window>"u"||!window.location)return kn;try{return new URL(kn,window.location.href).href}catch{return kn}}async function Me(){return Qt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Qt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(no()),await navigator.serviceWorker.ready}catch(i){return console.warn("Service worker registration failed",i),null}})(),Qt))}async function xi(i){if(!i||typeof i!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await Me();if(!r)return!1;let s=new Set;navigator.serviceWorker.controller&&s.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(w=>{let A=r[w];A&&s.add(A)});let c=!1;return s.forEach(w=>{try{w.postMessage(i),c=!0}catch(A){console.warn("Failed posting message to service worker",A)}}),c}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function Zt(){if(Ce())return!1;if(Rn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(wt)try{return await wt}catch{}wt=(async()=>{let i=await Me();if(!i)return!1;let r=!1;if("periodicSync"in i)try{let s=await i.periodicSync.getTags();(!Array.isArray(s)||!s.includes(Fn))&&await i.periodicSync.register(Fn,{minInterval:15*60*1e3}),r=!0}catch(s){console.warn("Periodic background sync unavailable",s)}if(!r&&"sync"in i)try{await i.sync.register(Fn),r=!0}catch(s){console.warn("Background sync unavailable",s)}return r})();try{let i=await wt;return i&&(Rn=!0),i}catch(i){return console.warn("Background reminder sync setup failed",i),Rn=!1,!1}finally{wt=null}}async function On(i=[],{requestCheck:r=!1}={}){if(!Ce()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let s=await Me();if(!s)return;let c=await xi({type:Ci.updateScheduledReminders,reminders:Array.isArray(i)?i:[]});if(r&&await xi({type:Ci.checkScheduledReminders}),!c&&typeof s.update=="function")try{await s.update()}catch{}}catch(s){console.warn("Failed syncing reminders with service worker",s)}}async function Mn(i,r){if(Ce())try{let s=r||await Me();if(!s)return;let c=[];try{c=await s.getNotifications({tag:i,includeTriggered:!0})}catch{c=await s.getNotifications({tag:i})}for(let w of c)try{w.close()}catch{}}catch{}}function Ni(){for(let i of Array.from(Le.values()))try{i.close()}catch{}Le.clear()}function io(){if(Li||typeof window>"u"||typeof window.addEventListener!="function")return;let i=()=>Ni();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,i)}catch{}}),Li=!0}function J(i){if(typeof i=="string"){let r=i.replace(/\s+/g," ").trim();if(r)return r}return z}async function Ao(i={}){let r=e=>e?document.querySelector(e):null,s=e=>e?Array.from(document.querySelectorAll(e)):[],c=r(i.titleSel),w=r(i.dateSel),A=r(i.timeSel),T=r(i.detailsSel),j=r(i.prioritySel),L=r(i.categorySel),X=r(i.saveBtnSel),te=r(i.cancelEditBtnSel),E=r(i.listSel),ne=r(i.detailPanelSel),Q=r(i.detailEmptySel),P=r(i.detailContentSel),Y=r(i.detailTitleSel),xe=r(i.detailDueSel),me=r(i.detailPrioritySel),he=r(i.detailCategorySel),K=r(i.detailNotesSel),M=K?.dataset?.placeholder||"No notes added yet.",sn=r(i.detailClearSel),ge=s(i.googleSignInBtnSel),vt=s(i.googleSignOutBtnSel),U=r(i.statusSel),G=r(i.syncStatusSel),Pi={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Ui=6e3,ue=null,Et=null;function We(e,{clearMessage:t=!0}={}){ue&&(e&&ue.tokenId!==e||(ue.timeoutId&&clearTimeout(ue.timeoutId),t&&U&&U.dataset.undoToken===ue.tokenId&&(typeof U.replaceChildren=="function"?U.replaceChildren():U.textContent="",delete U.dataset.undoToken,delete U.dataset.statusKind),ue=null))}function $i(e){if(!U)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),o=document.createElement("button");o.type="button",o.textContent="Undo",o.className="status-undo",o.addEventListener("click",()=>Ur(e.tokenId)),e.button=o,typeof U.replaceChildren=="function"?U.replaceChildren(t,n,o):(U.textContent="",U.append(t,n,o)),U.dataset.statusKind="undo",U.dataset.undoToken=e.tokenId}function Je(e){if(!ne)return;let t=!!e;if(ne.dataset.state=t?"active":"empty",ne.dataset.selectedId=t&&e?.id?e.id:"",Q&&(Q.classList.toggle("hidden",t),Q.setAttribute("aria-hidden",t?"true":"false")),P&&(P.classList.toggle("hidden",!t),P.setAttribute("aria-hidden",t?"false":"true")),!t){Y&&(Y.textContent=""),xe&&(xe.textContent=""),me&&(me.textContent=""),he&&(he.textContent=""),K&&(K.textContent=M,K.dataset.empty="true");return}if(Y&&(Y.textContent=e.title||"Untitled reminder"),xe&&(xe.textContent=di(e)),me&&(me.textContent=e.priority||"Medium"),he&&(he.textContent=e.category||z),K){let n=typeof e.notes=="string"?e.notes.trim():"";n?(K.textContent=n,K.dataset.empty="false"):(K.textContent=M,K.dataset.empty="true")}}function Un(){Et=null,Je(null)}function Hi(e){Et=e?.id||null,Je(e||null)}function ji(){if(!ne)return;if(!Et){Je(null);return}let e=u.find(t=>t?.id===Et);if(e){Je(e);return}Un()}Je(null);function dn(e,t){if(!G)return;let n=["online","offline","error"];n.forEach(d=>G.classList.remove(d)),n.includes(e)&&G.classList.add(e),G.dataset.state=e;let o=typeof t=="string"?t:Pi[e]||"";e==="online"||e==="offline"?(G.textContent="",G.dataset.compact="true",o?(G.setAttribute("aria-label",o),G.setAttribute("title",o)):(G.removeAttribute("aria-label"),G.removeAttribute("title"))):(G.textContent=o,G.removeAttribute("data-compact"),o?(G.setAttribute("aria-label",o),G.setAttribute("title",o)):(G.removeAttribute("aria-label"),G.removeAttribute("title")))}let ie=r(i.notesSel),Wi=r(i.saveNotesBtnSel),Yi=r(i.loadNotesBtnSel),$n=r(i.countTotalSel),It=r(i.googleUserNameSel),_e=r(i.dateFeedbackSel),se=r(i.voiceBtnSel),Gi=r(i.notifBtnSel),Qe=r(i.moreBtnSel),Ze=r(i.moreMenuSel),Vi=r(i.copyMtlBtnSel),cn=r(i.importFileSel),qi=r(i.exportBtnSel),zi=r(i.syncAllBtnSel),Ye=r(i.syncUrlInputSel),Xi=r(i.saveSettingsSel),Ki=r(i.testSyncSel),Ji=s(i.openSettingsSel),At=r(i.settingsSectionSel),Ge=r(i.emptyStateSel),Hn=r(i.listWrapperSel),ln=r(i.categoryOptionsSel),re=r(i.plannerContextSel),H=r(i.plannerLessonInputSel),De=i.variant||"mobile",Qi=typeof i.autoWireAuthButtons=="boolean"?i.autoWireAuthButtons:De!=="desktop",jn="mc:lastDefaults",un=()=>{re&&(re.classList.add("hidden"),re.setAttribute("aria-hidden","true"),typeof re.replaceChildren=="function"?re.replaceChildren():re.textContent=""),H&&(H.value="",H.dataset&&(delete H.dataset.lessonDayLabel,delete H.dataset.lessonTitle,delete H.dataset.lessonSummary))},Zi=(e={})=>{if(!re)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",o=typeof e.summary=="string"?e.summary.trim():"",a=document.createElement("p");a.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",a.textContent=t?`${t} lesson`:"Planner lesson";let d=document.createElement("p");d.className="text-sm font-semibold text-base-content",d.textContent=n||o||"Planner reminder";let l=o?document.createElement("p"):null;l&&(l.className="text-sm text-base-content/70",l.textContent=o),typeof re.replaceChildren=="function"?re.replaceChildren(...[a,d,l].filter(Boolean)):(re.textContent="",re.append(a,d),l&&re.append(l)),re.classList.remove("hidden"),re.removeAttribute("aria-hidden")},er=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";c&&typeof e.reminderTitle=="string"&&(c.value=e.reminderTitle),T&&typeof e.reminderNotes=="string"&&(T.value=e.reminderNotes),w&&typeof e.dueDate=="string"&&(w.value=e.dueDate),H&&(H.value=t,H.dataset&&(H.dataset.lessonDayLabel=dayLabel,H.dataset.lessonTitle=lessonTitle,H.dataset.lessonSummary=summary)),Zi(e)};function fn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(jn)||"{}")||{}}catch{return{}}}function tr(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(jn,JSON.stringify(e))}catch{}}function Wn(e){let t=fn(),n={category:J(e?.category||t.category||z),priority:e?.priority||t.priority||"Medium"};tr(n)}let Yn='fieldset#priorityChips input[name="priority"]';function pn(){try{let e=document.querySelector(`${Yn}:checked`);if(e&&e.value)return e.value}catch{}return j&&typeof j.value=="string"&&j.value?j.value:"Medium"}function Tt(e){let t=e||"Medium";j&&typeof j.value<"u"&&(j.value=t);try{let n=Array.from(document.querySelectorAll(Yn));if(!n.length)return;let o=!1;if(n.forEach(a=>{let d=a.value===t;a.checked=d,o=o||d}),!o){let a=n.find(d=>d.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function Gn(){let e=fn();e.category&&L&&(L.value=e.category),e.priority&&Tt(e.priority)}Gn();let de=typeof document<"u"?document.getElementById("quickAddInput"):null,nr=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ce=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,mn=null;function ir(e,t){let n=Date.now(),o=fn(),a=typeof t=="string"&&t?t:null;return{id:jt(),title:(e||"").trim(),priority:o.priority||pn(),category:J(o.category||L?.value||z),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!Z}}async function gn(){if(!de)return;if(typeof mn=="function")try{mn()}catch{}let e=(de.value||"").trim();if(!e)return;let t=null;try{let a=Gt(e);a&&a.time&&(t=new Date(`${a.date}T${a.time}:00`).toISOString())}catch{t=null}let n=ir(e,t);vn(n,{position:"start"}),u.unshift(n),fe(u);let o=dt(u);Pe=!0,W(),ee(),o?u.forEach(a=>oe(a)):oe(n),lt(n),He(n),Fe(),Wn(n),et();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}be({action:"created",label:`Reminder added \xB7 ${n.title}`}),de.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=gn),nr?.addEventListener("click",()=>{gn()}),de?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),gn())});function rr(){if(typeof HTMLElement>"u"||!(ce instanceof HTMLElement)||!(de instanceof HTMLInputElement)||ce.dataset.voiceBound==="true")return;if(ce.dataset.voiceBound="true",typeof window>"u"){ce.setAttribute("disabled","true"),ce.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ce.setAttribute("disabled","true"),ce.setAttribute("aria-disabled","true"),ce.getAttribute("title")||(ce.title="Voice input is not supported in this browser.");return}let t=null,n=!1,o=l=>{n=l,ce.setAttribute("aria-pressed",l?"true":"false"),ce.dataset.listening=l?"true":"false",ce.classList.toggle("is-listening",l)},a=()=>{if(t)return t;t=new e;let l=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=l,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",y=>{let f=y?.results?.[0]?.[0]?.transcript?.trim()||"";if(f){de.value=f;try{de.focus({preventScroll:!0})}catch{de.focus()}try{let S=de.value.length;typeof de.setSelectionRange=="function"&&de.setSelectionRange(S,S)}catch{}}});let p=()=>{o(!1)};return t.addEventListener("end",p),t.addEventListener("error",p),t},d=()=>{if(!(!n||!t)){try{t.stop()}catch{}o(!1)}};mn=d,ce.addEventListener("click",()=>{let l=a();if(l){if(n){d();return}try{l.start(),o(!0)}catch(p){console.warn("Quick add voice error:",p),o(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",d),o(!1)}rr(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&de&&(e.preventDefault(),de.focus())})));try{De==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let or=i.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Vn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,ar=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Lt=i.reminderLandingPath||(De==="desktop"?"index.html#reminders":"mobile.html"),Ie=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function qn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function et(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}L&&!L.value&&(L.value=z),Ce()&&Me();function be(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let o=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),o=!0)}catch{o=!1}if(!o){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Ti,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(Ti,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function sr(){if(typeof HTMLElement>"u"||!(se instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&c instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&c instanceof HTMLTextAreaElement;if(!e&&!t||se.dataset.voiceBound==="true")return;if(se.dataset.voiceBound="true",typeof window>"u"){se.setAttribute("disabled","true"),se.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){se.setAttribute("disabled","true"),se.setAttribute("aria-disabled","true"),se.getAttribute("title")||(se.title="Voice input is not supported in this browser.");return}let o=null,a=!1,d=f=>{a=f,se.setAttribute("aria-pressed",f?"true":"false"),se.dataset.listening=f?"true":"false",se.classList.toggle("is-listening",f)},l=()=>{if(o)return o;o=new n,o.lang="en-US",o.interimResults=!1,o.maxAlternatives=1,o.addEventListener("result",S=>{let C=S.results?.[0]?.[0]?.transcript?.trim()||"";if(C){c.value=C;try{c.focus({preventScroll:!0})}catch{try{c.focus()}catch{}}try{let x=c.value.length;typeof c.setSelectionRange=="function"&&c.setSelectionRange(x,x)}catch{}be({action:"dictated",label:`Voice input captured \xB7 ${C}`})}});let f=()=>{d(!1)};return o.addEventListener("end",f),o.addEventListener("error",f),o},p=()=>{if(!(!a||!o)){try{o.stop()}catch{}d(!1)}};se.addEventListener("click",()=>{let f=l();if(f){if(a){p();return}try{f.start(),d(!0)}catch(S){console.warn("Speech recognition error:",S),d(!1)}}});let y=()=>{p()};typeof document<"u"&&(document.addEventListener("cue:close",y),document.addEventListener("reminders:updated",y)),d(!1)}io(),sr();let Ct,xt,Dt,Nt,Ve,kt,Ft,Rt,Bt,Ot,Mt,tt,nt,_t,Pt,yn,hn,Ut,bn,zn=i.firebaseDeps,Sn=typeof i.importModule=="function"?i.importModule:e=>import(e),it=_n(),rt=!1,Se=!1,wn=null,Ae=null,ot=null,u=[],Pe=!1,Z=null,at=null,qe=null,Ue={},V={};function fe(e=u){Array.isArray(e)&&e.sort((t,n)=>{let o=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,a=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return o===a?ei(t||{},n||{}):a-o})}function dr(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(o=>{let a=Number.isFinite(o?.orderIndex)?o.orderIndex:null;a!=null&&(a<t&&(t=a),a>n&&(n=a))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function st(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(o=>Number.isFinite(o?.orderIndex)),n;if(t)n=e.slice(),fe(n);else{n=e.slice().sort(ei);let o=n.length;n.forEach((a,d)=>{a.orderIndex=(o-d)*ve})}return e===u&&(u=n),n}function vn(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:o}=dr();if(t==="end"){let a=Number.isFinite(n)?n:0;e.orderIndex=a-ve||ve}else{let a=Number.isFinite(o)?o:0;e.orderIndex=a+ve||ve}}function dt(e=u){if(!Array.isArray(e)||e.length<2)return!1;fe(e);let t=!1;for(let n=1;n<e.length;n+=1){let o=e[n-1],a=e[n],d=Number.isFinite(o?.orderIndex)?o.orderIndex:null,l=Number.isFinite(a?.orderIndex)?a.orderIndex:null;if(d==null||l==null||d<=l||d-l<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*ve;return e===u&&fe(u),!0}let k={draggingId:null,dropTargetId:null,dropBefore:!0},Xn=!1,m={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function cr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function ct(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Ne(){E&&(E.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),E.classList.remove("drag-over-list"))}function En(){if(!E)return;let e=E.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Ne(),k.draggingId=null,k.dropTargetId=null,k.dropBefore=!0}function Kn(e,t,n){if(!e||e===t)return;let o=u.findIndex(x=>x?.id===e);if(o<0)return;let[a]=u.splice(o,1),d;if(!t)d=u.length;else{let x=u.findIndex(q=>q?.id===t);if(x<0){u.splice(o,0,a);return}d=n?x:x+1}u.splice(d,0,a);let l=u[d-1],p=u[d+1],y=Number.isFinite(l?.orderIndex)?l.orderIndex:null,f=Number.isFinite(p?.orderIndex)?p.orderIndex:null,S;y!=null&&f!=null?S=(y+f)/2:y!=null?S=y-ve:f!=null?S=f+ve:S=ve,Number.isFinite(S)||(S=ve*(u.length+1)),a.orderIndex=S,fe(u);let C=dt(u);Pe=!0,W(),ee(),C?u.forEach(x=>oe(x)):oe(a),et(),Ie("memoryCue:remindersUpdated",{items:u}),be({action:"reordered",label:"Reminders reordered"})}function lr(e){let t=ct(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let o=t.dataset.id;if(o&&(k.draggingId=o,k.dropTargetId=null,k.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",o)}catch{}}function ur(e){if(!k.draggingId)return;let t=ct(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),k.dropTargetId=null,k.dropBefore=!1,Ne(),E?.classList.add("drag-over-list");return}if(t.dataset.id===k.draggingId){e.preventDefault(),Ne();return}e.preventDefault();let n=t.getBoundingClientRect(),o=n.top+n.height/2,a=e.clientY<o;(k.dropTargetId!==t.dataset.id||k.dropBefore!==a)&&(Ne(),t.classList.add(a?"drag-over-before":"drag-over-after"),k.dropTargetId=t.dataset.id,k.dropBefore=a)}function fr(e){let t=ct(e.target);if(!t){E?.contains(e.relatedTarget)||Ne();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),E?.contains(e.relatedTarget)||E?.classList.remove("drag-over-list"))}function pr(e){if(!k.draggingId)return;e.preventDefault();let t=ct(e.target),n=t?.dataset.id||null,o=k.dropBefore;if(t){let a=t.getBoundingClientRect(),d=a.top+a.height/2;o=e.clientY<d}else n=null,o=!1;Kn(k.draggingId,n,o),En()}function mr(){En()}function gr(){!E||Xn||(Xn=!0,E.addEventListener("dragstart",lr),E.addEventListener("dragover",ur),E.addEventListener("drop",pr),E.addEventListener("dragend",mr),E.addEventListener("dragleave",fr),$t())}function $t(){if(!E||$t._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){$t._bound=!0;return}let t=6,n=160;function o(){m.longPressTimer&&(clearTimeout(m.longPressTimer),m.longPressTimer=null)}function a(){E&&(m.initialTouchAction!=null?E.style.touchAction=m.initialTouchAction:E.style.removeProperty("touch-action"))}function d({keepHighlights:v=!1}={}){if(o(),m.item&&m.pointerId!=null)try{m.item.hasPointerCapture?.(m.pointerId)&&m.item.releasePointerCapture(m.pointerId)}catch{}if(m.placeholder?.parentNode)try{m.placeholder.parentNode.removeChild(m.placeholder)}catch{}m.item&&(m.item.classList.remove("is-dragging"),m.originalStyles?m.item.setAttribute("style",m.originalStyles):m.item.removeAttribute("style")),a(),v||Ne(),Object.assign(m,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function l(v){return E?Array.from(E.querySelectorAll("[data-reminder-item]")).filter(h=>h!==v):[]}function p(v){let h=m.item;if(!h||m.ready)return;let D=h.getBoundingClientRect(),_=window.getComputedStyle(h);m.ready=!0,k.draggingId=h.dataset.id||null,m.offsetY=v.clientY-D.top,m.fixedX=D.left;let F=document.createElement("div");F.className="touch-drag-placeholder",F.setAttribute("aria-hidden","true"),F.style.height=`${D.height}px`,F.style.boxSizing="border-box",F.style.marginTop=_.marginTop,F.style.marginBottom=_.marginBottom,F.style.marginLeft=_.marginLeft,F.style.marginRight=_.marginRight,F.style.borderRadius=_.borderRadius,F.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",F.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",F.style.pointerEvents="none",F.style.display="block",F.style.width="100%",h.parentNode?.insertBefore(F,h),m.placeholder=F,m.longPressTimer=null,m.originalStyles=h.getAttribute("style")||"",h.classList.add("is-dragging"),h.style.position="fixed",h.style.left=`${D.left}px`,h.style.top=`${D.top}px`,h.style.width=`${D.width}px`,h.style.zIndex="999",h.style.pointerEvents="none",h.style.touchAction="none",m.initialTouchAction=E.style.touchAction||"",E.style.touchAction="none"}function y(v){let h=m.item;if(!h||!m.ready)return;let D=v-m.offsetY;h.style.top=`${D}px`,h.style.left=`${m.fixedX}px`}function f(v){if(!m.ready||!E)return;let h=m.item,D=l(h);if(Ne(),!D.length){k.dropTargetId=null,k.dropBefore=!1;return}let _=null,F=!1;for(let b of D){let R=b.getBoundingClientRect(),B=R.top+R.height/2;if(v<B){_=b,F=!0;break}}if(!_){_=D[D.length-1];let b=_.getBoundingClientRect(),R=b.top+b.height/2;F=v<R,F||(F=!1)}if(!_){k.dropTargetId=null,k.dropBefore=!1;return}let je=_.getBoundingClientRect(),zt=je.top+je.height/2,g=v<zt;_.classList.add(g?"drag-over-before":"drag-over-after"),k.dropTargetId=_.dataset.id||null,k.dropBefore=g}function S(v){let h=k.draggingId,D=m.moved;if(!m.ready){d();return}d(),!v&&D&&h&&Kn(h,k.dropTargetId,k.dropBefore),En()}function C(v){let h=v.pointerType||"";if(h&&h!=="touch"&&h!=="pen"||m.active)return;let D=ct(v.target);if(!D)return;let _=cr(v.target);if(!(_&&_!==D)){m.active=!0,m.pointerId=v.pointerId,m.item=D,m.startX=v.clientX,m.startY=v.clientY,m.lastClientX=v.clientX,m.lastClientY=v.clientY,m.moved=!1,m.ready=!1,m.originalStyles=D.getAttribute("style")||"",m.startTime=v.timeStamp||Date.now(),k.dropTargetId=null,k.dropBefore=!0,k.draggingId=null,o(),m.longPressTimer=setTimeout(()=>{p({clientY:m.lastClientY})},n);try{D.setPointerCapture(v.pointerId)}catch{}}}function x(v){if(!m.active||v.pointerId!==m.pointerId)return;let h=v.pointerType||"";if(!(h&&h!=="touch"&&h!=="pen")){if(m.lastClientX=v.clientX,m.lastClientY=v.clientY,!m.ready){let D=Math.abs(v.clientX-m.startX),_=Math.abs(v.clientY-m.startY);if(D>t||_>t){let F=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(F-m.startTime)>=n?(o(),p({clientY:m.lastClientY})):d()}return}v.preventDefault(),m.moved=!0,y(v.clientY),f(v.clientY)}}function q(v){!m.active||v.pointerId!==m.pointerId||S(!1)}function ye(v){!m.active||v.pointerId!==m.pointerId||S(!0)}E.addEventListener("pointerdown",C),window.addEventListener("pointermove",x),window.addEventListener("pointerup",q),window.addEventListener("pointercancel",ye),$t._bound=!0}function Jn(){Z=null,dn("offline"),ge.forEach(e=>e.classList.remove("hidden")),vt.forEach(e=>e.classList.add("hidden")),It&&(It.textContent=""),at?.(),at=null,An(),W(),ee(),Fe()}function In(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Bn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let o=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:o,d=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:jt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:J(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:o,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function yr(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Bn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:J(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null}));localStorage.setItem(Bn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function ee(){fe(u),yr(u)}function An(){u=st(In())}An();async function hr(){if(!Z){u=In();return}let e=st(In());if(!e.length){u=[],ee();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await oe(n),n.pendingSync=!1}catch(o){console.warn("Failed to sync offline reminder",o)}u=st(e.map(n=>({...n,pendingSync:!1}))),ee(),W(),Fe()}try{V=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{V={}}if(V&&typeof V=="object"&&Object.values(V).forEach(e=>{e&&typeof e=="object"&&(e.category=J(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:ut(e),e.urlPath=e.urlPath||Lt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Ce()){let e=ai();typeof Notification<"u"&&Notification.permission==="granted"?(Zt(),e.length&&On(e,{requestCheck:!0})):e.length&&On(e)}let Ht=e=>{if(!it)return;let t=[it];it.window&&!t.includes(it.window)&&t.push(it.window);let n=!e;t.forEach(o=>{try{o.__memoryCueFirebaseUnavailable__=n}catch{}})};function br(){if(!ie)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",o="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",d=()=>"value"in ie?ie.value:ie.innerHTML,l=S=>{if("value"in ie){ie.value=S;return}if(typeof S!="string"||S.length===0){ie.innerHTML="";return}let C=S.trim();if(/<\/?[a-z][\s\S]*>/i.test(C)){ie.innerHTML=S;return}let q=S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");ie.innerHTML=q},p=S=>{S?ie.classList.add("notes-editor--columns"):ie.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!S))},y="";try{y=localStorage.getItem(n)||""}catch{I("Unable to access saved notes")}l(y);let f=!1;try{f=localStorage.getItem(o)==="1"}catch{f=!1}p(f),ie.addEventListener("input",()=>{y=d();try{localStorage.setItem(n,y)}catch{I("Notes saved for this session only")}}),Wi?.addEventListener("click",()=>{y=d();try{localStorage.setItem(n,y),I("Notes saved")}catch{I("Notes saved for this session only")}}),Yi?.addEventListener("click",()=>{let S=y;try{S=localStorage.getItem(n)||y}catch{I("Unable to load saved notes")}y=S,l(y)}),e?.addEventListener("click",S=>{let C=S.target;if(!(C instanceof Element))return;let x=C.closest("button[data-action]");if(!x)return;let q=x.getAttribute("data-action");if(q==="columns"){let ye=!ie.classList.contains("notes-editor--columns");p(ye);try{localStorage.setItem(o,ye?"1":"0")}catch{I("Column preference saved for this session only")}return}if(!a){I("Formatting controls are not supported in this browser");return}ie.focus(),q==="bullets"?document.execCommand("insertUnorderedList"):q==="numbers"&&document.execCommand("insertOrderedList")})}if(br(),X?.addEventListener("click",ci),zn)({initializeApp:Ct,getFirestore:xt,enableMultiTabIndexedDbPersistence:Dt,enableIndexedDbPersistence:Nt,doc:Ve,setDoc:kt,deleteDoc:Ft,onSnapshot:Rt,collection:Bt,query:Ot,orderBy:Mt,serverTimestamp:tt,getAuth:nt,onAuthStateChanged:_t,GoogleAuthProvider:Pt,signInWithPopup:yn,signInWithRedirect:hn,getRedirectResult:Ut,signOut:bn}=zn),rt=!0;else try{({initializeApp:Ct}=await Sn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:xt,enableMultiTabIndexedDbPersistence:Dt,enableIndexedDbPersistence:Nt,doc:Ve,setDoc:kt,deleteDoc:Ft,onSnapshot:Rt,collection:Bt,query:Ot,orderBy:Mt,serverTimestamp:tt}=await Sn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:nt,onAuthStateChanged:_t,GoogleAuthProvider:Pt,signInWithPopup:yn,signInWithRedirect:hn,getRedirectResult:Ut,signOut:bn}=await Sn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),rt=!0}catch(e){rt=!1,console.warn("Firebase modules failed to load:",e),I("Firebase failed to load; notes available offline"),Ht(!1)}if(rt&&typeof Ct=="function"&&typeof xt=="function"&&typeof nt=="function")try{let e=to();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),wn=Ct(e),Ae=xt(wn),Se=!0,console.info("[Firebase] Firestore initialised",e.projectId),Ht(!0)}catch(e){Se=!1,console.warn("Firebase initialization failed:",e),I("Firebase failed to load; notes available offline"),Ht(!1)}else rt?(Se=!1,Ht(!1)):Se=!1;Se&&typeof Dt=="function"&&typeof Nt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Dt(Ae),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Nt(Ae),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(o){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",o?.code||o)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),Se&&typeof nt=="function"&&(ot=nt(wn));function Sr(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let wr=typeof navigator<"u"&&navigator.language?navigator.language:"",Qn=Sr(wr),ze=Qn||"en-US",Te="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Te=e.timeZone),!Qn&&e.locale&&(ze=e.locale)}catch{}let vr=new Intl.DateTimeFormat(ze,{timeZone:Te,hour:"2-digit",minute:"2-digit"}),Er=new Intl.DateTimeFormat(ze,{timeZone:Te,weekday:"long",day:"numeric",month:"long"}),Ir=new Intl.DateTimeFormat("en-CA",{timeZone:Te,year:"numeric",month:"2-digit",day:"2-digit"}),Ar=new Intl.DateTimeFormat(ze,{timeZone:Te,weekday:"long"}),Tr=new Intl.DateTimeFormat(ze,{timeZone:Te,month:"short",day:"numeric"});function ke(e){let t=Ir.formatToParts(e),n=t.find(d=>d.type==="year").value,o=t.find(d=>d.type==="month").value,a=t.find(d=>d.type==="day").value;return`${n}-${o}-${a}`}function Zn(e,t){let[n,o,a]=e.split("-").map(y=>parseInt(y,10)),[d,l]=t.split(":").map(y=>parseInt(y,10)),p=new Date;return p.setFullYear(n,(o||1)-1,a||1),p.setHours(d||0,l||0,0,0),p.toISOString()}let Lr=new Intl.DateTimeFormat("en-CA",{timeZone:Te,year:"numeric",month:"2-digit",day:"2-digit"}),Cr=new Intl.DateTimeFormat("en-CA",{timeZone:Te,hour:"2-digit",minute:"2-digit",hour12:!1});function xr(e){try{let t=new Date(e),n=Lr.formatToParts(t),o=n.find(l=>l.type==="year")?.value||"0000",a=n.find(l=>l.type==="month")?.value||"00",d=n.find(l=>l.type==="day")?.value||"00";return`${o}-${a}-${d}`}catch{return""}}function Dr(e){try{let t=new Date(e),n=Cr.formatToParts(t),o=n.find(d=>d.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(d=>d.type==="minute")?.value?.padStart(2,"0")||"00";return`${o}:${a}`}catch{return""}}function jt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Wt(){return ke(new Date)}function Nr(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function mo(e){let t=Nr(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Yt(e){return e==="High"?3:e==="Medium"?2:1}function ei(e,t){let n=e?.done?1:0,o=t?.done?1:0;if(n!==o)return n-o;let a=e?.due?new Date(e.due).getTime():1/0,d=t?.due?new Date(t.due).getTime():1/0;if(a!==d)return a-d;let l=Yt(t?.priority)-Yt(e?.priority);return l||(t?.updatedAt||0)-(e?.updatedAt||0)}function go(e,t){let n=Yt(t.priority)-Yt(e.priority);if(n)return n;let o=+new Date(e.due||0),a=+new Date(t.due||0);return o!==a?o-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function ti(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Er.format(t)}catch{return e}}function Tn(e){return vr.format(e)}function kr(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function yo(e){return e?kr(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function I(e){U&&(We(),U.dataset.statusKind="toast",U.textContent=e,clearTimeout(I._t),I._t=setTimeout(()=>{U&&U.dataset.statusKind==="toast"&&(U.textContent="",delete U.dataset.statusKind)},2500))}function Fr(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}function Gt(e){e=String(e||"").toLowerCase();let t={date:Wt(),time:""},n=p=>{let y=new Date,f=y.getDay(),S=(p-f+7)%7,C=new Date(y);return C.setDate(y.getDate()+(S===0?7:S)),C},o=p=>{let y=new Date,f=y.getDay(),S=(p-f+7)%7,C=new Date(y);return C.setDate(y.getDate()+S),C},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},d={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let p=new Date;p.setDate(p.getDate()+1),t.date=ke(p)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[p[1]],f=n(y);t.date=ke(f)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[p[1]],f=o(y);t.date=ke(f)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let p=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[p[1]],f=n(y);t.date=ke(f)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let p=e.match(/\bin\s+(\d+)\s+days?\b/),y=parseInt(p[1],10),f=new Date;f.setDate(f.getDate()+y),t.date=ke(f)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let p=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),y=parseInt(p[1],10),f=parseInt(p[2],10)-1,S=p[3]?parseInt(p[3],10):new Date().getFullYear(),C=new Date(S,f,y);t.date=ke(C)}else for(let[p,y]of Object.entries(d)){let f=new RegExp(`\\b${p}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(f.test(e)){let S=e.match(f),C=parseInt(S[1],10),x=new Date().getFullYear(),q=new Date(x,y,C);t.date=ke(q);break}}let l=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(l){let p=parseInt(l[1],10),y=l[2]?parseInt(l[2],10):0,f=l[3];f&&(f==="pm"&&p<12&&(p+=12),f==="am"&&p===12&&(p=0)),t.time=`${String(p).padStart(2,"0")}:${String(y).padStart(2,"0")}`}return t}let Ln=Se&&ot&&typeof Pt=="function";yi({authReady:Ln,auth:ot,GoogleAuthProvider:Pt,signInWithPopup:yn,signInWithRedirect:hn,signOut:bn,toast:I});let ni=Qi,ii=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let o=t(n);o&&typeof o.then=="function"&&o.catch(a=>{console.error("Auth handler error:",a)})}catch(o){console.error("Auth handler error:",o)}}),e._authWired=!0)};ni&&ge.length&&ge.forEach(e=>ii(e,hi)),Ln&&typeof Ut=="function"&&Ut(ot).catch(()=>{}),ni&&vt.length&&vt.forEach(e=>ii(e,bi)),Ln&&typeof _t=="function"?_t(ot,async e=>{e?(Z=e.uid,dn("online"),ge.forEach(t=>t.classList.add("hidden")),vt.forEach(t=>t.classList.remove("hidden")),It&&(It.textContent=e.displayName||e.email||""),Rr(),await hr()):Jn()}):Jn();function Rr(){if(!Se||!Ae||typeof Bt!="function"||typeof Ot!="function"||typeof Mt!="function"||typeof Rt!="function")return;if(!Z){An(),W(),ee(),Fe();return}at&&at();let e=Bt(Ae,"users",Z,"reminders"),t=Ot(e,Mt("updatedAt","desc"));at=Rt(t,n=>{let o=[];n.forEach(a=>{let d=a.data(),l=Number(d.orderIndex),p=typeof d.plannerLessonId=="string"&&d.plannerLessonId?d.plannerLessonId:null;o.push({id:a.id,title:d.title,priority:d.priority,notes:d.notes||"",done:!!d.done,due:d.due||null,category:J(d.category),createdAt:d.createdAt?.toMillis?.()||0,updatedAt:d.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(l)?l:null,plannerLessonId:p})}),u=st(o),W(),ee(),Fe()},n=>{console.error("Firestore sync error:",n),G&&dn("error","Sync Error")})}async function oe(e){if(!(!Se||!Z||!Ae||typeof Ve!="function"||typeof kt!="function"||typeof tt!="function"))try{await kt(Ve(Ae,"users",Z,"reminders",e.id),{ownerUid:Z,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||z,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,createdAt:e.createdAt?new Date(e.createdAt):tt(),updatedAt:tt()},{merge:!0})}catch(t){console.error("Save failed:",t),I("Save queued (offline)")}}async function Br(e){if(!(!Se||!Z||!Ae||typeof Ve!="function"||typeof Ft!="function"))try{await Ft(Ve(Ae,"users",Z,"reminders",e))}catch{I("Delete queued (offline)")}}async function lt(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||z,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function $e({preserveDetail:e=!1}={}){c&&(c.value=""),w&&(w.value=""),A&&(A.value=""),T&&(T.value=""),Tt("Medium"),L&&(L.value=z),Gn(),qe=null,X&&(X.textContent="Save"),te?.classList.add("hidden"),un(),e||Un()}function Or(e){let t=u.find(n=>n.id===e);t&&(c&&(c.value=t.title||""),w&&A&&(t.due?(w.value=xr(t.due),A.value=Dr(t.due)):(w.value="",A.value="")),Tt(t?.priority||"Medium"),L&&(L.value=J(t.category)),T&&(T.value=typeof t.notes=="string"?t.notes:""),H&&(H.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),un(),Hi(t),qe=e,X&&(X.textContent="Update"),te?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),c?.focus(),Ie("cue:open",{mode:"edit"}))}function Mr(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),o=J(e.category??(L?L.value:"")),a={id:jt(),title:e.title.trim(),priority:e.priority||"Medium",category:o,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!Z,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null};vn(a,{position:"start"}),u=[a,...u],fe(u);let d=dt(u);return Pe=!0,W(),ee(),Wn(a),d?u.forEach(l=>oe(l)):oe(a),lt(a),He(a),et(),Ie("memoryCue:remindersUpdated",{items:u}),qn(),be({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function _r(e,t){if(!Z)return I("Sign in to add notes"),null;if(!e)return null;let n=u.find(l=>l.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let d=typeof n.notes=="string"?n.notes:"";return n.notes=d?`${d}
${a}`:a,n.updatedAt=Date.now(),oe(n),W(),ee(),be({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Pr(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),oe(t),lt(t),W(),ee(),t.done?(qt(e),be({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(He(t),be({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Ur(e){if(!ue||ue.tokenId!==e)return;let{item:t,index:n}=ue;if(!t){We(e);return}We(e);let o=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!Z,t.updatedAt=Date.now(),u.splice(o,0,t),fe(u);let a=dt(u);Pe=!0,W(),ee(),He(t),a?u.forEach(d=>oe(d)):oe(t),lt(t),et(),Ie("memoryCue:remindersUpdated",{items:u}),be({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),I("Reminder restored")}function ri(e){let t=u.findIndex(a=>a.id===e),n=t>=0?u.splice(t,1)[0]:null;n&&qe===e&&$e(),W(),ee(),Br(e),qt(e);let o=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(be({action:"deleted",label:o}),n&&U){We();let a=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ue={tokenId:a,item:n,index:t,timeoutId:null},$i(ue),ue.timeoutId=setTimeout(()=>{We(a)},Ui)}else n&&We()}function $r(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,o=48,a=800,d='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',l=null,p=!1,y=0,f=0,S=0,C=()=>{if(p){if(p=!1,l!=null&&e.hasPointerCapture?.(l))try{e.releasePointerCapture(l)}catch{}l=null,e.removeEventListener("pointermove",q),e.removeEventListener("pointerup",ye),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",ye),window.removeEventListener("pointercancel",v)}},x=h=>{if(h.pointerType==="mouse"&&h.button!==0)return;p&&C();let D=h.target;D instanceof Element&&D.closest(d)||(l=h.pointerId,y=h.clientX,f=h.clientY,S=typeof h.timeStamp=="number"?h.timeStamp:Date.now(),p=!0,e.addEventListener("pointermove",q),e.addEventListener("pointerup",ye),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",ye),window.addEventListener("pointercancel",v))},q=h=>{if(!p||h.pointerId!==l)return;Math.abs(h.clientY-f)>o&&C()},ye=h=>{if(!p||h.pointerId!==l)return;let D=h.clientX-y,_=Math.abs(h.clientY-f),F=(typeof h.timeStamp=="number"?h.timeStamp:Date.now())-S;if(C(),D<=-n&&_<=o&&F<=a){h.preventDefault(),h.stopPropagation();try{t()}catch(je){console.warn("Swipe delete handler failed",je)}}},v=h=>{p&&(typeof h.pointerId=="number"&&h.pointerId!==l||C())};e.addEventListener("pointerdown",x)}function ut(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(o=>o.trim()).find(Boolean);if(n){if(e.due)try{let o=new Date(e.due);if(!Number.isNaN(o.getTime())){let a=Tn(o);if(a)return`${n} \u2022 ${a}`}}catch{}return n}if(e.due)try{let o=new Date(e.due);if(!Number.isNaN(o.getTime())){let a=Tn(o);if(a)return`Due ${a}`}}catch{}return"Due now"}function oi(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}I("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function ai(){return Object.values(V||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||z,notes:typeof e.notes=="string"?e.notes:"",body:ut(e),urlPath:e.urlPath||Lt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Cn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(V))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=ai(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Zt(),On(e,{requestCheck:t})}function Vt(e,{closeNotification:t=!0}={}){if(t){let n=Le.get(e);if(n){try{n.close()}catch{}Le.delete(e)}}Ue[e]&&(clearTimeout(Ue[e]),delete Ue[e]),Mn(e),V[e]&&(delete V[e],Cn())}function qt(e){Vt(e)}function si(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Le.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:ut(e),tag:e.id});Le.set(e.id,n);let o=()=>{Le.get(e.id)===n&&Le.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",o),n.addEventListener("click",o)),n.onclose=o,n.onclick=o}catch{}}async function Hr(e){if(!Ce())return!1;let t=Di();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let o=await Me();if(!o)return!1;await Mn(e.id,o);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||z,body:d,urlPath:Lt},d=ut(e),l={body:d,tag:e.id,data:a,renotify:!0};n>Date.now()&&(l.showTrigger=new t(n));try{return await o.showNotification(e.title,l),!0}catch(p){return console.warn("Failed to schedule persistent notification",p),!1}}function He(e){if(!e||!e.id)return;if(e.category=J(e.category),!e.due||e.done){qt(e.id);return}let t=V[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||z,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:ut(e),urlPath:Lt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let l=typeof t.due=="string"?t.due:null,p=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return l===e.due?p:null})()};if(V[e.id]=n,Cn(),Ue[e.id]&&(clearTimeout(Ue[e.id]),delete Ue[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let o=new Date(e.due).getTime();if(!Number.isFinite(o))return;let a=o-Date.now();if(a<=0){if(V[e.id]?.viaTrigger){Vt(e.id,{closeNotification:!1});return}si(e),Vt(e.id,{closeNotification:!1});return}let d=Ce();d&&(n.viaTrigger=!1,Hr(e).then(l=>{l&&V[e.id]&&(V[e.id]={...V[e.id],viaTrigger:!0},Cn())})),Ue[e.id]=setTimeout(()=>{d&&Mn(e.id),si(e),Vt(e.id,{closeNotification:!1})},a)}function Fe(){Object.values(V).forEach(e=>He({...e,category:J(e?.category)}))}function di(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Ar.format(t),o=Tr.format(t),a=Tn(t);return`${n}, ${o}${a?` at ${a}`:""}`}catch{return"No due date"}}function W(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let o=new Date(t);if(o.setHours(23,59,59,999),Ne(),fe(u),$n)try{$n.textContent=String(u.length)}catch{}u.forEach(g=>{g&&typeof g=="object"&&(g.category=J(g.category))});let a=new Set(Zr.map(g=>J(g)));u.forEach(g=>{g&&typeof g=="object"&&a.add(J(g.category))});let d=Array.from(a).sort((g,b)=>g.localeCompare(b,void 0,{sensitivity:"base"}));if(ln){let g=new Set;Array.from(ln.querySelectorAll("option")).forEach(b=>{g.add(b.value.trim().toLowerCase())}),d.forEach(b=>{let R=b.toLowerCase();if(!g.has(R)){let B=document.createElement("option");B.value=b,ln.appendChild(B),g.add(R)}})}if(Pe)Pe=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let g=u.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:g}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:g}),document.dispatchEvent(b))}}catch{}}let l=u.slice();fe(l);let p=!0,y=u.length>0,f=l.length>0,S=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let g=Object.values(V||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(g.map(b=>b.id))})();if(Ge)if(f)Ge.classList.add("hidden");else{let g=y?"No reminders to show right now.":or;Vn?Vn(Ge,{icon:y?"sparkles":"bell",title:y?"Nothing to display":"Create your first cue",description:g,action:y?void 0:`<button type="button" class="${ar}" data-trigger="open-cue">Create reminder</button>`}):Ge.textContent=g,Ge.classList.remove("hidden")}if(Hn&&Hn.classList.toggle("has-items",f),!E)return;if(!f){Ge?(E.innerHTML="",E.classList.add("hidden")):(E.innerHTML='<div class="text-muted">No reminders found.</div>',E.classList.remove("hidden"));return}E.classList.remove("hidden"),E.replaceChildren();let C=document.createDocumentFragment(),x=E.tagName==="UL"||E.tagName==="OL",q=!0,ye=["priority-high","priority-medium","priority-low"],v=(g,b)=>{if(!(g instanceof HTMLElement))return;g.classList.remove(...ye);let R=typeof b=="string"?b.trim().toLowerCase():"";R.startsWith("h")?g.classList.add("priority-high"):R.startsWith("m")?g.classList.add("priority-medium"):R.startsWith("l")&&g.classList.add("priority-low")},h=(g,b="neutral")=>{let R=document.createElement("span");R.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",R.title=g,R.dataset.tone=b;let B=document.createElement("span");B.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?B.classList.add("bg-error"):b==="priority-medium"?B.classList.add("bg-warning"):b==="priority-low"?B.classList.add("bg-secondary"):b==="category"?B.classList.add("bg-primary"):B.classList.add("bg-base-content","opacity-40");let O=document.createElement("span");return O.className="truncate",O.textContent=g,R.append(B,O),R},D=(g,b,{elementTag:R,isMobile:B})=>{let O={id:g.id,title:g.title,dueIso:g.due||null,priority:g.priority||"Medium",category:b,done:!!g.done},ft="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",Yr="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",N=document.createElement(R);N.className=B?Yr:ft,N.dataset.id=O.id,N.dataset.category=O.category,N.dataset.title=O.title;let li=O.priority&&String(O.priority).trim();li?N.dataset.priority=li:delete N.dataset.priority,N.dataset.done=String(O.done),O.dueIso?N.dataset.due=O.dueIso:delete N.dataset.due,N.dataset.reminder=JSON.stringify(O),N.dataset.orderIndex=Number.isFinite(g.orderIndex)?String(g.orderIndex):"",N.dataset.reminderItem="true",N.dataset.compact="true",N.classList.add("reminder-draggable"),N.setAttribute("draggable","true"),N.setAttribute("role","button"),N.tabIndex=0,N.setAttribute("aria-label",`Edit reminder: ${g.title}`),v(N,O.priority),S.has(O.id)?N.dataset.notificationActive="true":delete N.dataset.notificationActive;let xn=O.dueIso?new Date(O.dueIso):null;p&&xn&&xn>=n&&xn<=o?(N.classList.add("is-today"),N.dataset.today="true"):(N.classList.remove("is-today"),delete N.dataset.today);let pt=document.createElement("div");pt.className="flex min-w-0 flex-1 flex-col gap-2",B&&pt.classList.add("text-sm","text-base-content");let Re=document.createElement("p");Re.className=B?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",Re.classList.add("desktop-reminder-title"),B||Re.classList.add("sm:text-[0.95rem]"),O.done&&Re.classList.add("line-through","text-base-content/60"),B&&(Re.dataset.reminderTitle="true"),Re.textContent=g.title;let Xt=Re;B&&(Xt=document.createElement("div"),Xt.className="reminder-title-slot",Xt.appendChild(Re)),pt.appendChild(Xt);let mt=document.createElement("div");mt.className=B?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let Dn=di(g),ui=Dn&&Dn!=="No due date"?Dn:"";ui&&mt.appendChild(h(ui,"due")),!!(b&&b!==z)&&mt.appendChild(h(b,"category")),mt.children.length&&pt.appendChild(mt),N.appendChild(pt);let Xe=document.createElement("div");Xe.className="task-toolbar flex items-start gap-1",Xe.setAttribute("role","toolbar"),Xe.setAttribute("aria-label","Reminder actions"),B&&Xe.classList.add("flex-shrink-0");let le=document.createElement("button");le.type="button",le.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn",O.done?(le.classList.add("text-base-content/60"),le.innerHTML='<span aria-hidden="true">\u21BA</span>',le.setAttribute("aria-label",`Mark reminder as active: ${g.title}`)):(le.classList.add("text-success"),le.innerHTML='<span aria-hidden="true">\u2713</span>',le.setAttribute("aria-label",`Mark reminder as done: ${g.title}`)),le.setAttribute("aria-pressed",O.done?"true":"false"),le.setAttribute("data-reminder-control","toggle"),le.setAttribute("data-no-swipe","true"),le.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),Pr(O.id)});let Be=document.createElement("button");Be.type="button",Be.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn",Be.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',Be.setAttribute("aria-label",`Delete reminder: ${g.title}`),Be.setAttribute("data-reminder-control","delete"),Be.setAttribute("data-no-swipe","true"),Be.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),ri(O.id)}),Xe.append(le,Be),N.appendChild(Xe);let fi=()=>Or(O.id);return N.addEventListener("click",ae=>{if(ae.defaultPrevented)return;let Nn=ae.target;Nn&&typeof Nn.closest=="function"&&Nn.closest("[data-reminder-control]")||fi()}),N.addEventListener("keydown",ae=>{ae.defaultPrevented||ae.target===N&&(ae.key==="Enter"||ae.key===" ")&&(ae.preventDefault(),fi())}),B&&$r(N,()=>ri(O.id)),N},_=(g,b)=>D(g,b,{elementTag:"div",isMobile:!0});if(De!=="desktop"&&!q){l.forEach(g=>{let b=g.category||z;C.appendChild(_(g,b))}),E.appendChild(C);return}let F=new Map;l.forEach(g=>{let b=g.category||z;F.has(b)||F.set(b,[]),F.get(b).push(g)});let je=Array.from(F.entries()).sort((g,b)=>g[0].localeCompare(b[0],void 0,{sensitivity:"base"})),zt=!0;je.forEach(([g,b])=>{if(g!==z){let R=document.createElement(x?"li":"div");R.dataset.categoryHeading=g,x&&(R.setAttribute("role","presentation"),R.style.listStyle="none"),R.className=De==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",zt||(R.style.marginTop=De==="desktop"?"1.25rem":"1rem");let B=document.createElement("div");B.setAttribute("role","heading"),B.setAttribute("aria-level","3"),B.className=De==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let O=document.createElement("span");O.textContent=g;let ft=document.createElement("span");ft.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",ft.textContent=`${b.length} ${b.length===1?"item":"items"}`,B.append(O,ft),R.appendChild(B),C.appendChild(R)}b.forEach(R=>{if(De==="desktop"){let B=D(R,g,{elementTag:x?"li":"div",isMobile:!1});C.appendChild(B);return}C.appendChild(_(R,g))}),zt=!1}),E.appendChild(C),ji()}function we(){Qe?.setAttribute("aria-expanded","false"),Ze?.classList.add("hidden")}function jr(){Qe?.setAttribute("aria-expanded","true"),Ze?.classList.remove("hidden")}Qe?.addEventListener("click",e=>{e.stopPropagation(),Qe.getAttribute("aria-expanded")==="true"?we():jr()}),document.addEventListener("click",e=>{Ze&&!Ze.classList.contains("hidden")&&!Ze.contains(e.target)&&e.target!==Qe&&we()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&we()}),Ji.forEach(e=>{e.addEventListener("click",()=>{let t=At?.classList.contains("hidden");At?.classList.toggle("hidden"),t&&At?.scrollIntoView({behavior:"smooth",block:"start"}),we()})}),document.addEventListener("DOMContentLoaded",()=>{At?.classList.add("hidden")});function ci(){try{console.log("handleSaveAction invoked",{editingId:qe,title:c?.value})}catch{}let t=(typeof c?.value=="string"?c.value:"").trim(),n=typeof w?.value=="string"?w.value:"",o=typeof A?.value=="string"?A.value:"",a=typeof H?.value=="string"?H.value.trim():"";if(qe){let f=u.find(x=>x.id===qe);if(!f){$e();return}if(!t){I("Add a reminder title");return}let S=null;if(n||o){let x=n||Wt();S=Zn(x,o||"09:00")}else{let x=Gt(t);x.time&&(S=new Date(`${x.date}T${x.time}:00`).toISOString())}f.title=t;let C=pn();f.priority=C,Tt(C),L&&(f.category=J(L.value)),f.due=S,T&&(f.notes=T.value.trim()),f.plannerLessonId=a||null,f.updatedAt=Date.now(),oe(f),lt(f),Pe=!0,W(),He(f),ee(),et(),Ie("memoryCue:remindersUpdated",{items:u}),qn(),be({action:"updated",label:`Reminder updated \xB7 ${f.title}`}),$e(),I("Reminder updated"),Ie("cue:close",{reason:"updated"});return}if(!t){I("Add a reminder title");return}let d=T?T.value.trim():"",l=null;if(n||o){let f=n||Wt();l=Zn(f,o||"09:00")}else{let f=Gt(t);f.time&&(l=new Date(`${f.date}T${f.time}:00`).toISOString())}let p=a?{lessonId:a,dayLabel:H?.dataset?.lessonDayLabel||"",lessonTitle:H?.dataset?.lessonTitle||"",summary:H?.dataset?.lessonSummary||""}:null,y=Mr({title:t,priority:pn(),category:L?L.value:"",due:l,notes:d,plannerLessonId:a||null});y&&(p?(I("Planner reminder created"),Ie("planner:reminderCreated",{lessonId:p.lessonId,dayLabel:p.dayLabel,lessonTitle:p.lessonTitle,summary:p.summary,reminderId:y.id,reminderTitle:y.title,reminderDue:y.due||null})):I("Reminder created")),c&&(c.value=""),A&&(A.value=""),T&&(T.value=""),un(),Ie("cue:close",{reason:"created"})}c?.addEventListener("keydown",e=>{e.key==="Enter"&&ci()});function Wr(){if(!c||!_e)return;let e=c.value.trim();if(!e){_e.style.display="none";return}try{let t=Gt(e),n=Wt();if(t.date!==n||t.time){let o="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");o+=`\u{1F4C5} ${ti(t.date)}`}t.time&&(o+=`${o?" ":""}\u{1F550} ${t.time}`),o?(_e.textContent=`Parsed: ${o}`,_e.style.display="block"):_e.style.display="none"}else _e.style.display="none"}catch{_e.style.display="none"}}return c?.addEventListener("input",Fr(Wr,300)),te?.addEventListener("click",()=>{$e(),I("Edit cancelled"),Ie("cue:close",{reason:"edit-cancelled"})}),sn?.addEventListener("click",()=>{$e()}),document.addEventListener("cue:cancelled",()=>{$e()}),document.addEventListener("cue:prepare",()=>{$e()}),document.addEventListener("planner:prefillReminder",e=>{er(e?.detail||{})}),window.addEventListener("load",()=>c?.focus()),Vi?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?ti(t.due.slice(0,10)):"",o=t.due?new Date(t.due).toLocaleTimeString(ze,{hour:"2-digit",minute:"2-digit",timeZone:Te}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${o}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){I("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>I("Copied for Master Task List")).catch(()=>I("Copy failed")),we()}),cn?.addEventListener("change",()=>{let e=cn.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),o=[];n.forEach(d=>{let l={...d,id:jt(),category:J(d.category),pendingSync:!Z,orderIndex:null};vn(l,{position:"start"}),u=[l,...u],o.push(l)}),fe(u);let a=dt(u);W(),ee(),a?u.forEach(d=>oe(d)):o.forEach(d=>oe(d)),I("Import successful")}catch{I("Invalid JSON")}},t.readAsText(e),cn.value="",we()}),qi?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),we()}),zi?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){I("Add your Apps Script URL in Settings first"),we();return}if(!u.length){I("No tasks to sync"),we();return}I("Syncing all tasks\u2026");let t=20,n=0;for(let o=0;o<u.length;o+=t){let a=u.slice(o,o+t),d=await Promise.allSettled(a.map(l=>{let p={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:l.category||z,done:!!l.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})}));n+=d.filter(l=>l.status==="rejected").length,await new Promise(l=>setTimeout(l,400))}I(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),we()}),Ye&&(Ye.value=localStorage.getItem("syncUrl")||""),Xi?.addEventListener("click",()=>{Ye&&(localStorage.setItem("syncUrl",Ye.value.trim()),I("Settings saved"))}),Ki?.addEventListener("click",async()=>{if(!Ye)return;let e=Ye.value.trim();if(!e){I("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});I(t.ok?"Test ok":"Test failed")}catch{I("Test failed")}}),Gi?.addEventListener("click",async()=>{if(!("Notification"in window)){I("Notifications not supported");return}if(Notification.permission==="granted"){I("Notifications enabled"),Ce()?Me():(Zt(),oi()),Fe(),W();return}try{await Notification.requestPermission()==="granted"?(I("Notifications enabled"),Ce()?Me():(Zt(),oi()),Fe(),W()):I("Notifications blocked")}catch{I("Notifications blocked")}}),gr(),Fe(),W(),ee(),{cancelReminder:qt,scheduleReminder:He,closeActiveNotifications:Ni,getActiveNotifications:()=>Le,addNoteToReminder:_r,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:J(t?.category)})):[],u=st(u),fe(u),W()},render:W,getItems:()=>u.map(e=>({...e}))}}}var Ti,Le,Li,kn,Fn,Ci,Qt,wt,Rn,z,Zr,Bn,ve,eo,Ee,ro=Kt(()=>{wi();Ti="memoryCue:activity",Le=new Map,Li=!1,kn="service-worker.js",Fn="memory-cue-reminder-sync",Ci=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Qt=null,wt=null,Rn=!1,z="General",Zr=Object.freeze([z,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Bn="memoryCue:offlineReminders",ve=1024,eo=Object.freeze({}),Ee=null});var Fi,oo,on,Pn,Ri,Bi,en,Oi,nn,tn,ki,ao,Mi,rn,_i=Kt(()=>{Fi="memoryCueNotes",oo=["mobileNotes"],on=()=>typeof localStorage<"u",Pn=null,Ri=i=>{Pn=typeof i=="function"?i:null},Bi=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,en=i=>{if(typeof i!="string")return"";let r=i.trim();if(!r.length)return"";if(!/[<>]/.test(r))return i;try{if(typeof document<"u"){let s=document.createElement("div");return s.innerHTML=r,(typeof s.innerText=="string"&&s.innerText.length?s.innerText:s.textContent||"").replace(/\r?\n/g,`
`)}}catch{}return r.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},Oi=i=>{if(typeof i!="string")return!1;let r=Date.parse(i);return!Number.isNaN(r)},nn=(i,r,s={})=>{let c=typeof i=="string"?i.trim():"";return{id:s.id&&typeof s.id=="string"?s.id:Bi(),title:c||"Untitled note",body:typeof r=="string"?en(r):"",updatedAt:s.updatedAt&&Oi(s.updatedAt)?s.updatedAt:new Date().toISOString()}},tn=i=>{if(Array.isArray(i))return i.map(r=>{if(!r||typeof r!="object")return null;let s=typeof r.title=="string"?r.title.trim():"",c=typeof r.body=="string"?en(r.body):"",w=typeof r.id=="string"&&r.id.trim()?r.id:Bi(),A=Oi(r.updatedAt)?r.updatedAt:new Date().toISOString();return!s&&!c?null:{id:w,title:s||"Untitled note",body:c,updatedAt:A}}).filter(Boolean);if(i&&typeof i=="object"){let r=typeof i.title=="string"?i.title:"",s=typeof i.body=="string"?en(i.body):"";return!r&&!s?[]:[nn(r,s,{id:typeof i.id=="string"?i.id:void 0,updatedAt:typeof i.updatedAt=="string"?i.updatedAt:void 0})]}return typeof i=="string"&&i.trim().length?[nn("Notebook (legacy)",en(i))]:[]},ki=i=>{if(!on())return null;try{return localStorage.getItem(i)}catch{return null}},ao=i=>{if(on())try{localStorage.removeItem(i)}catch{}},Mi=()=>{if(!on())return[];let i=ki(Fi);if(typeof i=="string")try{let r=JSON.parse(i),s=tn(r);if(s.length)return s}catch{let r=tn(i);if(r.length)return rn(r),r}for(let r of oo){let s=ki(r);if(typeof s=="string"&&s.trim().length){let c=tn(s);if(c.length)return rn(c),ao(r),c}}return[]},rn=(i,r={})=>{if(!on()||!Array.isArray(i))return!1;let s=i.map(c=>tn([c])[0]).filter(Boolean);try{if(localStorage.setItem(Fi,JSON.stringify(s)),!r.skipRemoteSync&&typeof Pn=="function")try{let c=Pn(s);c&&typeof c.then=="function"&&c.catch(w=>{console.error("[notes-storage] Remote sync failed.",w)})}catch(c){console.error("[notes-storage] Remote sync handler threw.",c)}return!0}catch{return!1}}});var so,co,lo,an,uo,fo,No,po=Kt(()=>{mi();_i();so="notes",co="user_id",lo="updated_at",an=i=>{if(typeof i!="string")return 0;let r=Date.parse(i);return Number.isNaN(r)?0:r},uo=(i=[],r=[])=>{let s=new Map;return r.forEach(c=>{c&&typeof c.id=="string"&&s.set(c.id,c)}),i.forEach(c=>{if(!c||typeof c.id!="string")return;let w=s.get(c.id);if(!w){s.set(c.id,c);return}let A=an(c.updatedAt),T=an(w.updatedAt);A>T&&s.set(c.id,c)}),Array.from(s.values()).sort((c,w)=>an(w?.updatedAt)-an(c?.updatedAt))},fo=i=>r=>{if(!r||typeof r!="object")return null;let s={id:typeof r.id=="string"&&r.id?r.id:void 0,updatedAt:typeof r[i]=="string"?r[i]:void 0};return nn(r.title,r.body,s)},No=(i={})=>{let{tableName:r=so,userColumn:s=co,updatedAtColumn:c=lo,supabase:w=null}=i,A=w||null,T=null,j=!1,L=new Set,X=()=>A||(A=Ke(),A),te=fo(c),E=async P=>{let Y=X();if(!Y||!T)return;let me=(Array.isArray(P)?P.filter(M=>M&&typeof M.id=="string"):[]).map(M=>({id:M.id,[s]:T,title:M.title,body:M.body,[c]:typeof M.updatedAt=="string"&&M.updatedAt?M.updatedAt:new Date().toISOString()})),he=new Set(me.map(M=>M.id));if(me.length){let{error:M}=await Y.from(r).upsert(me);if(M)throw M}let K=[...L].filter(M=>M&&!he.has(M));if(K.length){let{error:M}=await Y.from(r).delete().in("id",K).eq(s,T);if(M)throw M}L=new Set(he)},ne=async()=>{let P=X();if(!(!P||!T))try{let{data:Y,error:xe}=await P.from(r).select(`id,title,body,${c}`).eq(s,T);if(xe)throw xe;let me=Array.isArray(Y)?Y:[];L=new Set(me.map(ge=>typeof ge.id=="string"?ge.id:null).filter(Boolean));let he=me.map(te).filter(Boolean),K=Mi();if(!he.length){if(K.length)try{await E(K)}catch(ge){console.error("[notes-sync] Failed to upload local notes to Supabase.",ge)}return}let M=uo(K,he);j=!0;let sn=rn(M,{skipRemoteSync:!0});j=!1,sn||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await E(M)}catch(ge){console.error("[notes-sync] Failed to reconcile notes with Supabase.",ge)}}catch(Y){console.error("[notes-sync] Failed to fetch notes from Supabase.",Y)}finally{j=!1}};return Ri(async P=>{if(!j)try{await E(P)}catch(Y){console.error("[notes-sync] Failed to sync notes to Supabase.",Y)}}),{setSupabaseClient(P){P&&(A=P)},handleSessionChange:async P=>{if(T=typeof P?.id=="string"?P.id:null,!T){L=new Set;return}await ne()},syncFromRemote:ne}}});export{wo as a,wi as b,Ao as c,ro as d,Fi as e,nn as f,Mi as g,rn as h,_i as i,No as j,po as k};
