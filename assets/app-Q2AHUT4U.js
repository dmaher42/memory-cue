import{a as Ke,b as Rt,c as ee,d as Ot,f as ge,g as te,h as be,i as qt,j as Ge,k as _t}from"./chunk-K4LZ4PFQ.js";import{a as je,b as Ht}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as $e,c as Mt}from"./chunk-GUVSRPRW.js";function ze(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:i})=>{if(!Array.isArray(i))return null;for(let o of i){if(typeof o!="string"||!o)continue;let s=t.getElementById(o);if(s)return{key:n,element:s}}return null}).filter(n=>!!(n&&n.element))}function K(e,t){if(!e||typeof e!="object")return"";let n=Pt[t]||[t];for(let i of n)if(Object.prototype.hasOwnProperty.call(e,i)){let o=e[i];return o==null?"":typeof o=="string"?o:String(o)}return""}function Ut(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function Vt(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function We(e,t){Array.isArray(t)&&t.forEach(({key:n,element:i})=>{let o=e&&typeof e=="object"?K(e,n):"";Ut(i,o)})}function Qe(e,t,n,i){Array.isArray(e)&&e.forEach(({element:o})=>{o instanceof HTMLInputElement?["checkbox","radio"].includes(o.type)?o.checked=!1:o.value="":(o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement)&&(o.value="")}),t&&(t.value=""),n&&(n.textContent=i)}function Je(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:i})=>{let o=Vt(i);if(typeof o=="boolean"){t[n]=o;return}let s=typeof o=="string"?o.trim():o;t[n]=s??""}),t}function M(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Ye,Pt,Ee,ve,Xe=$e(()=>{Ye=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],Pt={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Ee="Create Cue",ve="Edit Cue"});function Ze(e){return new Te(e)}var $t,jt,Te,et=$e(()=>{$t=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),jt={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Te=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...jt,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let i=n[0],o=n[n.length-1],s=document.activeElement;t.shiftKey&&s===i?(t.preventDefault(),o.focus()):!t.shiftKey&&s===o&&(t.preventDefault(),i.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll($t)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let i=this.events[t];if(!i||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let o=new CustomEvent(i,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(o)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Fn=Mt(()=>{Ht();Ot();Xe();et();Rt();qt();_t();je();function Kt(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!t||!n)return;let i=document.querySelectorAll("[data-open-reminder-modal]");if(!i.length)return;let o=e.querySelector("[data-reminder-modal-backdrop]"),s=e.querySelectorAll("[data-close-modal]"),a=document.getElementById("mainContent"),f=document.querySelector('nav[aria-label="Primary"]'),g=[a,f],d=e.querySelector('[role="dialog"]')??e,E=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],y=null,l=()=>{if(!(d instanceof HTMLElement))return[];let r=d.querySelectorAll(E.join(","));return Array.from(r).filter(u=>{let w=u instanceof HTMLElement,_=typeof SVGElement<"u"&&u instanceof SVGElement;if(!w&&!_||u.getAttribute("aria-hidden")==="true"||"disabled"in u&&u.disabled||u.hidden||u.closest("[hidden]"))return!1;let P=u.getBoundingClientRect();return P.width>0&&P.height>0})},c=()=>{let r=l(),u=r.find(w=>w.hasAttribute("data-autofocus")||w.hasAttribute("autofocus"))||(n&&r.includes(n)?n:null)||r[0];if(u&&typeof u.focus=="function"){u.focus({preventScroll:!0});return}d instanceof HTMLElement&&typeof d.focus=="function"&&d.focus({preventScroll:!0})},h=r=>{d instanceof HTMLElement&&(!(r.target instanceof Node)||!d.contains(r.target))&&(r.stopPropagation(),c())},b=r=>{if(r.key!=="Tab")return;let u=l();if(!u.length){r.preventDefault(),d instanceof HTMLElement&&d.focus({preventScroll:!0});return}let w=u[0],_=u[u.length-1],P=document.activeElement;if(r.shiftKey){(!d.contains(P)||P===w)&&(r.preventDefault(),_.focus());return}(!d.contains(P)||P===_)&&(r.preventDefault(),w.focus())},p=r=>{g.forEach(u=>{u&&(r?u.setAttribute("inert",""):u.removeAttribute("inert"))})},A=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),p(!1),document.removeEventListener("keydown",F,!0),e.removeEventListener("keydown",b,!0),e.removeEventListener("focusin",h,!0),y&&typeof y.focus=="function"&&y.focus(),y=null},F=r=>{r.key==="Escape"&&(r.preventDefault(),A())},W=({triggerElement:r}={})=>{r&&typeof r.focus=="function"?y=r:y=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),p(!0),document.addEventListener("keydown",F,!0),e.addEventListener("keydown",b,!0),e.addEventListener("focusin",h,!0),window.requestAnimationFrame(()=>{c()})},S=(r,u={})=>{try{document.dispatchEvent(new CustomEvent(r,{detail:u}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let w=document.createEvent("CustomEvent");w.initCustomEvent(r,!0,!0,u),document.dispatchEvent(w)}}},L=(r={})=>{S("cue:cancelled",r)};i.forEach(r=>{r.addEventListener("click",u=>{u.preventDefault();let _={trigger:u.currentTarget instanceof HTMLElement?u.currentTarget:null,mode:"create"};S("cue:prepare",_),S("cue:open",_)})}),s.forEach(r=>{r.addEventListener("click",u=>{u.preventDefault(),L({trigger:r,reason:"button"})})}),e.addEventListener("click",r=>{r.target===e&&L({reason:"backdrop"})}),o?.addEventListener("click",r=>{r.target===o&&L({reason:"backdrop"})}),document.addEventListener("cue:open",r=>{let u=r?.detail?.trigger,w=u instanceof HTMLElement?u:null;W({triggerElement:w})});let N=()=>{A()};document.addEventListener("cue:close",N),document.addEventListener("cue:cancelled",N);let D=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&D instanceof HTMLElement&&t.addEventListener("submit",r=>{r.preventDefault(),!D.matches(":disabled")&&D.click()}),D instanceof HTMLElement&&document.addEventListener("reminder:save",r=>{let u=r?.detail?.trigger;u&&u!==D||D.matches(":disabled")||D.click()})}Kt();var tt=null;function Gt(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Yt(e){typeof document>"u"||!e||(window.clearTimeout(tt),tt=window.setTimeout(()=>{let t=document.querySelector(`[data-route="${e}"]`);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Se(e){let t=e||Gt();t&&Yt(t)}function zt(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Se()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",i=>{if(!(i.currentTarget instanceof HTMLAnchorElement))return;let o=i.currentTarget.getAttribute("href")||"";if(!o.startsWith("#"))return;i.preventDefault();let s=o||"#dashboard",a=s.replace("#","")||"dashboard";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),Se(a)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Se()}zt();var yt="memoryCue:accountPanelCollapsed";function Wt(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem(yt);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function Qt(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem(yt,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function Jt(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let i=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",o=(t.getAttribute("data-expanded-label")||"").trim()||i,s=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",a=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",f=t.querySelector("[data-account-toggle-label]"),g=t.querySelector("[data-account-toggle-a11y]"),d=Wt();typeof d!="boolean"&&(d=!0);let E=(y,{persist:l=!0}={})=>{d=!!y,e.setAttribute("data-account-collapsed",d?"true":"false"),t.setAttribute("aria-expanded",d?"false":"true");let c=d?i:o,h=d?s:a;f?f.textContent=c:t.textContent=c,t.setAttribute("aria-label",h),g&&(g.textContent=h),d?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),d||n.removeAttribute("hidden"),l&&Qt(d)};E(d,{persist:!1}),t.addEventListener("click",y=>{y.preventDefault(),E(!d)})}Jt();var nt=document.getElementById("settings-save-button"),ne=document.getElementById("settings-save-confirmation"),it=document.getElementById("live-status"),we=null;nt&&ne&&nt.addEventListener("click",e=>{e.preventDefault(),ne.classList.remove("hidden"),ne.textContent="Settings saved!",it&&(it.textContent="Settings saved!"),we&&window.clearTimeout(we),we=window.setTimeout(()=>{ne.classList.add("hidden")},3e3)});var gt=document.getElementById("reminder-title"),Xt=document.getElementById("reminderText"),B=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),i=e.querySelector(".modal-backdrop button"),o=document.getElementById("modal-title");return Ze({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:i instanceof HTMLElement?i:null,titleInput:gt,modalTitle:o instanceof HTMLElement?o:null,defaultTitle:Ee,editTitle:ve})})();B?.setEditMode(!1);var Zt=()=>{let e=!!gt;if(!!Xt)return ee({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0};return e?ee(n):ee({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Zt().catch(e=>{console.error("Failed to initialise reminders",e)});var xe=Ge(),ke=Ke({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{xe?.handleSessionChange(e)}});if(ke?.supabase){xe?.setSupabaseClient(ke.supabase);try{ke.supabase.auth.getSession().then(({data:e})=>{xe?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var O=document.getElementById("cues-list"),Le=document.getElementById("pinnedNotesCard"),G=document.getElementById("pinnedNotesList"),j=document.getElementById("cue-form"),I=j?.querySelector("#cue-id-input"),en=B?.defaultTitle||B?.modalTitle?.textContent?.trim()||Ee,Vn=B?.editTitle||ve,ue=document.getElementById("tab-cues"),fe=document.getElementById("tab-daily"),Q=document.getElementById("cues-view"),J=document.getElementById("daily-list-view"),ot=document.getElementById("daily-list-header"),bt=document.getElementById("quick-add-form"),k=document.getElementById("quick-add-input"),C=document.getElementById("daily-voice-btn"),U=document.getElementById("daily-tasks-container"),De=document.getElementById("clear-completed-btn"),me=document.getElementById("daily-list-permission-notice"),st=document.getElementById("remindersCount"),rt=document.getElementById("plannerCount"),$n=document.getElementById("resourcesCount"),jn=document.getElementById("templatesCount"),ie=document.getElementById("dailySnapshotList"),oe=document.getElementById("todaysFocusList"),H=document.getElementById("weekAtAGlanceList"),R=null;H&&(R=document.createElement("li"),R.dataset.emptyState="week",R.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",R.textContent="No upcoming events this week.");var at=()=>{if(!H||!R)return;H.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?H.contains(R)||H.appendChild(R):H.contains(R)&&H.removeChild(R)};H&&(at(),new MutationObserver(at).observe(H,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var Ae=e=>{Le&&(e?Le.classList.remove("hidden"):Le.classList.add("hidden"))},X={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},lt=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),ct=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),le=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",He=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},tn=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Et=e=>{if(!e)return"";if(lt)try{return lt.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},nn=e=>{if(!e)return"";if(ct)try{return ct.format(e)}catch{}return e.toLocaleDateString()},vt=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(X,t)?t:"medium"},dt=e=>{let t=vt(e);return X[t]?.rank??X.medium.rank},on=e=>{let t=vt(e);return X[t]??X.medium},ut=e=>{let t=He(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Tt(e=[]){if(!ie)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(i=>({reminder:i,date:He(i)})).filter(({date:i})=>i&&tn(i,t)).sort((i,o)=>i.date.getTime()-o.date.getTime());if(!n.length){ie.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}ie.innerHTML="",n.forEach(({reminder:i,date:o})=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=le(i),s.appendChild(a);let f=Et(o),g=document.createElement("p");g.className="text-xs text-base-content/70",g.textContent=f?`Due ${f}`:"Due today",s.appendChild(g),ie.appendChild(s)})}function St(e=[]){if(!oe)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,i)=>{let o=dt(n)-dt(i);if(o!==0)return o;let s=ut(n)-ut(i);return s!==0?s:le(n).localeCompare(le(i),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){oe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}oe.innerHTML="",t.forEach(n=>{let i=document.createElement("li");i.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let o=document.createElement("div");o.className="flex items-center justify-between gap-3";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=le(n),o.appendChild(s);let a=on(n),f=document.createElement("span");f.className=a.badgeClass,f.textContent=a.badgeLabel,o.appendChild(f),i.appendChild(o);let g=He(n),d=document.createElement("p");if(d.className="text-xs text-base-content/70",g){let E=Et(g),y=nn(g),l=[];E&&l.push(`Due ${E}`),y&&l.push(y),d.textContent=l.length?l.join(" \u2022 "):"Due soon"}else d.textContent="No due date";i.appendChild(d),oe.appendChild(i)})}var sn=e=>{if(!st)return;let t=Array.isArray(e)?e.length:0;st.textContent=String(t)},rn=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];sn(t),Tt(t),St(t)};document.addEventListener("memoryCue:remindersUpdated",rn);Tt();St();var Ie=ze(Ye),an={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},se=null,ln=3,ft=120;function cn(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=ft?t:`${t.slice(0,ft-1)}\u2026`:""}function dn(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let i=n.trim().toLowerCase();return i==="true"||i==="1"||i==="yes"}return!1})}function mt(e){if(!G)return;let t=Array.isArray(e)?e:[];if(!t.length){G.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Ae(!1);return}let n=t.filter(s=>dn(s));if(!n.length){G.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Ae(!1);return}Ae(!0);let o=n.slice(0,ln).map(s=>{let a=M(K(s,"title")||"Untitled Cue"),f=K(s,"details"),g=M(cn(f)),d=g?`<p class="mt-1 text-sm text-base-content/70">${g}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${a}</p>
          ${d}
        </li>
      `}).join("");G.innerHTML=o}function Be(e,{tone:t="muted"}={}){if(!O)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),O.innerHTML=`<p class="${n.join(" ")}">${M(e)}</p>`}function un(e){if(!O)return;if(!Array.isArray(e)||e.length===0){Be("No cues yet.");return}let t=e.map(n=>{let i=M(K(n,"title")||"Untitled Cue"),o=M(K(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${i}</h2>
            ${o?`<p>${o}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${M(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${M(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");O.innerHTML=t}async function pe(){return se||(se=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:i,enableIndexedDbPersistence:o,collection:s,doc:a,getDoc:f,addDoc:g,updateDoc:d,getDocs:E,query:y,orderBy:l,serverTimestamp:c,setDoc:h,arrayUnion:b}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),p=t(),A=p&&p.length?p[0]:e(an),F=n(A);(function(){let L=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;L&&(L.__persistenceInitialized__||(L.__persistenceInitialized__=!0,(async()=>{try{await i(F),console.info("[Firestore] Persistence: multi-tab enabled")}catch(N){if(N&&N.code==="failed-precondition")try{await o(F),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(D){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",D?.code||D)}else N&&N.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",N?.code||N)}})()))})();let W=s(F,"cues");return{db:F,cuesCollection:W,getCollection:s,doc:a,getDoc:f,addDoc:g,updateDoc:d,getDocs:E,query:y,orderBy:l,serverTimestamp:c,setDoc:h,arrayUnion:b}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),se)}async function fn(){let e=await pe(),{getDocs:t,cuesCollection:n,query:i,orderBy:o}=e,s=i&&o?i(n,o("createdAt","desc")):n;return(await t(s)).docs.map(f=>({id:f.id,...f.data()}))}async function mn(e){if(!e)return null;let t=await pe(),{db:n,doc:i,getDoc:o}=t,s=i(n,"cues",e),a=await o(s);return a.exists()?{id:a.id,...a.data()}:null}async function wt(){if(!(!O&&!G))try{let e=await fn();un(e),mt(e)}catch(e){console.error("Failed to load cues",e),ye(e)?Be("Sign in to view your cues.",{tone:"muted"}):Be("Unable to load cues right now.",{tone:"error"}),mt([])}}function hn(e){!j||!I||(We(e,Ie),I.value=e?.id||"",B?.setEditMode(!0),B?.show({mode:"edit"}))}async function pn(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let i=await mn(n);if(!i)return;hn(i)}catch(i){console.error("Failed to prepare cue for editing",i)}}async function yn(e){if(e.preventDefault(),!j||!I)return;let t=I.value.trim(),n=Je(Ie);try{let i=await pe(),{db:o,doc:s,addDoc:a,updateDoc:f,cuesCollection:g,serverTimestamp:d}=i,E=typeof d=="function"?d():null;if(t){let y=s(o,"cues",t),l={...n};E&&(l.updatedAt=E),await f(y,l)}else{let y={...n};E&&(y.createdAt=E,y.updatedAt=E),await a(g,y)}await wt(),Qe(Ie,I,B?.modalTitle??null,en),await B?.hide({reason:"form-submit"})}catch(i){console.error("Failed to save cue",i)}}async function gn(){!j||!I||!O||(O.addEventListener("click",pn),j.addEventListener("submit",yn))}j&&I&&(document.addEventListener("cue:prepare",()=>{I.value="",B?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{I.value="",B?.setEditMode(!1)}));j&&I&&O&&gn().catch(e=>{console.error("Failed to initialise cue editing",e)});(O||G)&&wt();var m=[],re=null,V=!1,T=e=>{if(!rt)return;let t=Array.isArray(e)?e:[];rt.textContent=String(t.length)},kt=e=>{if(!e||typeof e.then!="function"){T(m);return}e.then(t=>{if(Array.isArray(t)){T(t);return}T(m)}).catch(()=>{T(m)})},Lt="dailyTasksByDate",ae=null;function Re(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${i}`}function bn(e){if(typeof e!="string")return"";let[t,n,i]=e.split("-"),o=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(i,10);if(!Number.isFinite(o)||!Number.isFinite(s)||!Number.isFinite(a))return e;let f=new Date(o,s-1,a);return Number.isNaN(f.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(f)}function Z(e){if(!De)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);De.disabled=!t}function $(e){if(!U)return;if(!Array.isArray(e)||e.length===0){U.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',Z([]);return}let t=e.map((n,i)=>{let o=M(n?.text||""),s=!!n?.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return s&&a.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${i}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${i}" data-task-text="${o}" ${s?"checked":""} />
          <span class="${a.join(" ")}">${o}</span>
        </div>
      `}).join("");U.innerHTML=t,Z(e)}function he(){me&&me.classList.remove("hidden")}function En(){me&&me.classList.add("hidden")}function Oe(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function z(e){return Array.isArray(e)?e.map(t=>Oe(t)):[]}function qe(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Lt);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function At(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Lt,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function ht(e){let t=qe(),n=t&&typeof t=="object"?t[e]:[];return z(n)}function ce(e,t){let n=qe(),i=z(t);return n[e]=i,At(n),i}function Ce(e,t){let n=qe(),i=z(n[e]);return i.push(Oe(t)),n[e]=i,At(n),i}function ye(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function _e(){return ae||(ae=pe().then(e=>{let{db:t,getCollection:n}=e,i=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:i}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),ae)}function Pe(e,t){let{doc:n,dailyListsCollection:i,db:o}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return i?n(i,t):n(o,"dailyLists",t)}async function Ue(){if(!ot||!U)return;let e=Re(),t=bn(e);if(ot.textContent=t?`Today's List - ${t}`:"Today's List",V){he();let n=ht(e);return m=n,$(n),T(n),Promise.resolve(n)}return re||(U.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',Z([]),re=(async()=>{try{let n=await _e(),i=Pe(n,e),o=await n.getDoc(i),s=o.exists()?o.data()?.tasks:[];return m=z(s),$(m),ce(e,m),V=!1,En(),T(m),m}catch(n){if(ye(n)){console.warn("Falling back to local daily tasks due to permission issue",n),V=!0,he();let i=ht(e);return m=i,$(i),T(i),i}return console.error("Failed to load daily list",n),U.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',m=[],Z(m),T(m),m}})().finally(()=>{re=null})),re}async function vn(e){let t=Re(),n=Oe(e);if(V){Ce(t,n);return}try{let i=await _e(),o=Pe(i,t),s=await i.getDoc(o);if(s.exists()&&typeof i.arrayUnion=="function")await i.updateDoc(o,{tasks:i.arrayUnion(n)});else{let a=s.exists()?s.data()?.tasks:[],f=Array.isArray(a)?z(a):[];f.push(n),typeof i.setDoc=="function"?await i.setDoc(o,{tasks:f},{merge:!0}):await i.updateDoc(o,{tasks:f})}Ce(t,n)}catch(i){if(ye(i)){console.warn("Saving task locally because cloud sync is unavailable",i),V=!0,he(),Ce(t,n);return}throw i}}async function Ct(e){let t=Re(),n=z(e);if(V){ce(t,n);return}try{let i=await _e(),o=Pe(i,t);typeof i.setDoc=="function"?await i.setDoc(o,{tasks:n},{merge:!0}):await i.updateDoc(o,{tasks:n}),ce(t,n)}catch(i){if(ye(i)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",i),V=!0,he(),ce(t,n);return}throw i}}function xt(e){[ue,fe].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function Tn(){!Q||!J||(Q.classList.remove("hidden"),J.classList.add("hidden"),xt(ue))}function Sn(){!Q||!J||(Q.classList.add("hidden"),J.classList.remove("hidden"),xt(fe),kt(Ue()))}ue&&fe&&Q&&J&&(ue.addEventListener("click",e=>{e.preventDefault(),Tn()}),fe.addEventListener("click",e=>{e.preventDefault(),Sn()}));var v=null,x=!1,de=null;function Y(e){if(!C)return;C.setAttribute("aria-pressed",e?"true":"false");let t=C.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":C.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function wn(){x&&(window.clearTimeout(de),de=window.setTimeout(()=>{de=null,x&&Dt(!0)},400))}function Dt(e=!1){if(!v)return!1;if(x&&!e)return!0;try{return v.start(),x=!0,Y(!0),!0}catch{return x=!1,Y(!1),!1}}function Ve(){if(v){x=!1,window.clearTimeout(de);try{v.stop()}catch{}Y(!1)}}function kn(){if(C)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){C.setAttribute("disabled","true"),C.setAttribute("aria-disabled","true"),C.title="Voice input is not supported in this browser.";return}v=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(v.lang=t,v.interimResults=!1,"continuous"in v)try{v.continuous=!0}catch{}v.onresult=n=>{let i=n?.results?.[0]?.[0]?.transcript||"";if(i&&k){k.value=i.trim();try{k.focus({preventScroll:!0})}catch{k.focus()}try{let o=k.value.length;k.setSelectionRange(o,o)}catch{}}},v.onend=()=>{if(!x){Y(!1);return}wn()},v.onerror=()=>{x=!1,Y(!1)}}catch{v=null,Y(!1),C.setAttribute("disabled","true"),C.setAttribute("aria-disabled","true")}}kn();C?.addEventListener("click",()=>{v&&(x?Ve():Dt())});bt?.addEventListener("submit",()=>{x&&Ve()});window.addEventListener("pagehide",()=>{x&&Ve()});bt?.addEventListener("submit",async e=>{if(e.preventDefault(),!k)return;let t=k.value.trim();if(!t){k.focus();return}let n={text:t,completed:!1};k.value="",k.focus();try{await vn(n);let i=await Ue();T(i??m)}catch(i){console.error("Failed to add task to the daily list",i),k.value=t,k.focus()}});U?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(m)||Number.isNaN(n)||!m[n])return;let i=m.map(s=>({...s})),o=i.map((s,a)=>a===n?{...s,completed:t.checked}:s);m=o,$(o),T(o);try{await Ct(o)}catch(s){console.error("Failed to update task completion state",s),m=i,$(i),T(i)}});De?.addEventListener("click",async()=>{if(!Array.isArray(m)||m.length===0)return;let e=m.filter(n=>!n.completed);if(e.length===m.length)return;let t=m.map(n=>({...n}));m=e,$(e),T(e);try{await Ct(e)}catch(n){console.error("Failed to clear completed tasks",n),m=t,$(t),T(t)}});Z(m);T(m);kt(Ue());function Ln(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),i=document.getElementById("noteNewBtn"),o=document.getElementById("notesList");if(!e||!t||!n||!i)return;let s=null,a=l=>{if(!l){s=null,e.value="",t.value="";return}s=l.id,e.value=l.title||"",t.value=l.body||""},f=()=>{if(!o)return;o.querySelectorAll("button[data-note-id]").forEach(c=>{if(!(c instanceof HTMLElement))return;let h=c.getAttribute("data-note-id")===s;c.classList.toggle("bg-base-200/80",h),c.classList.toggle("border-base-300",!h),c.classList.toggle("border-primary",h),c.classList.toggle("font-medium",h),c.setAttribute("aria-current",h?"true":"false")})},g=()=>{let l=te();return Array.isArray(l)?[...l].sort((c,h)=>{let b=Date.parse(c?.updatedAt||""),p=Date.parse(h?.updatedAt||"");return(Number.isNaN(p)?0:p)-(Number.isNaN(b)?0:b)}):[]},d=l=>{if(!l)return;let c=te();if(!Array.isArray(c))return;let h=c.filter(p=>p.id!==l);if(h.length===c.length)return;be(h),s===l&&(s=null);let b=E();if(s){let p=b.find(A=>A.id===s)||null;a(p)}else b.length?a(b[0]):a(null);f()},E=(l=g())=>{if(!o)return l;if(o.innerHTML="",!l.length){let c=document.createElement("li");return c.className="text-sm italic text-base-content/60",c.textContent="No saved notes yet.",o.appendChild(c),l}return l.forEach(c=>{let h=document.createElement("li");h.className="flex items-center gap-2";let b=document.createElement("button");b.type="button",b.dataset.noteId=c.id,b.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",b.textContent=c.title||"Untitled note",b.addEventListener("click",()=>{a(c),f()});let p=document.createElement("button");p.type="button",p.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",p.setAttribute("aria-label",`Delete note "${c.title||"Untitled note"}"`),p.textContent="Delete",p.addEventListener("click",A=>{A.stopPropagation(),d(c.id)}),h.appendChild(b),h.appendChild(p),o.appendChild(h)}),f(),l},y=()=>{let l=E();if(!l.length){a(null),f();return}let c=s?l.find(h=>h.id===s):null;a(c||l[0]),f()};n.addEventListener("click",()=>{let l=te(),c=Array.isArray(l)?[...l]:[],h=typeof e.value=="string"?e.value.trim():"",b=typeof t.value=="string"?t.value:"",p=h||"Untitled note",A=new Date().toISOString();if(s){let S=c.findIndex(L=>L.id===s);if(S>=0)c[S]={...c[S],title:p,body:b,updatedAt:A};else{let L=ge(p,b,{updatedAt:A});s=L.id,c.unshift(L)}}else{let S=ge(p,b);s=S.id,c.unshift(S)}be(c);let F=E(),W=s?F.find(S=>S.id===s):null;a(W||null),f()}),i.addEventListener("click",()=>{s=null,e.value="",t.value="",f(),typeof e.focus=="function"&&e.focus()}),y()}Ln();var It="theme",An="professional",Fe="memoryCue:theme-change",Cn="professional",Ne=document.getElementById("theme-menu"),Bt="[data-theme-name],[data-theme-option]",xn=new Set(["dark","dracula","synthwave"]);function q(e){return typeof e=="string"?e.trim():""}function Ft(e){return e instanceof HTMLElement?q(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Dn(e){let t=q(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",xn.has(t)))}function pt(e){let t=q(e);if(t)try{localStorage.setItem(It,t)}catch(n){console.warn("Unable to save theme preference",n)}}function Nt(e){if(!Ne)return;let t=q(e);Ne.querySelectorAll(Bt).forEach(i=>{if(!(i instanceof HTMLElement))return;let o=Ft(i),s=t&&o===t;i.setAttribute("aria-checked",s?"true":"false"),i.classList.toggle("active",s)})}function In(e){let t=q(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(Fe,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let i=document.createEvent("CustomEvent");i.initCustomEvent(Fe,!0,!0,{theme:t}),window.dispatchEvent(i)}}}function Me(e,{persist:t=!0,notify:n=!0}={}){let i=q(e);if(!i)return;q(document.documentElement.getAttribute("data-theme"))!==i&&Dn(i),t&&pt(i),Nt(i),n&&In(i)}function Bn(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){Me(Cn,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(It)||""}catch(i){console.warn("Unable to load theme preference",i)}let n=t||document.documentElement.getAttribute("data-theme")||An;n&&Me(n,{persist:!1,notify:!0})}Ne?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(Bt):null;if(!t)return;e.preventDefault();let n=Ft(t);n&&Me(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(Fe,e=>{let t=q(e?.detail?.theme);t&&Nt(t)});Bn()});export default Fn();
