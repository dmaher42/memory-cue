import{a as yo}from"./chunk-RCZ4YZVR.js";function mn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function yn(){let a=mn(),d=a&&a.TimestampTrigger;return typeof d=="function"?d:null}function he(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!yn()}function ho(){if(typeof window>"u"||!window.location)return Mt;try{return new URL(Mt,window.location.href).href}catch{return Mt}}async function Fe(){return yt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(yt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(ho()),await navigator.serviceWorker.ready}catch(a){return console.warn("Service worker registration failed",a),null}})(),yt))}async function Rt(a,d){if(he())try{let k=d||await Fe();if(!k)return;let U=[];try{U=await k.getNotifications({tag:a,includeTriggered:!0})}catch{U=await k.getNotifications({tag:a})}for(let v of U)try{v.close()}catch{}}catch{}}function gn(){for(let a of Array.from(G.values()))try{a.close()}catch{}G.clear()}function vo(){if(fn||typeof window>"u"||typeof window.addEventListener!="function")return;let a=()=>gn();["pagehide","beforeunload"].forEach(d=>{try{window.addEventListener(d,a)}catch{}}),fn=!0}function wo(){if(pn||(pn=!0,typeof document>"u"))return;let a=document.getElementById("voiceAddBtn"),d=document.getElementById("quickAddMic"),k=document.getElementById("voiceStatus"),U=document.getElementById("quickAddInput"),v=document.getElementById("reminderText"),E=U||v;if(!a||!E)return;if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){k&&(k.textContent="Speech not supported",k.hidden=!1);return}let T=window.SpeechRecognition||window.webkitSpeechRecognition,b=new T;b.lang="en-US",b.interimResults=!1,b.maxAlternatives=1;let H=E;function C(P){if(!P)return E;let S=P.getAttribute?.("data-voice-target");if(S){let O=document.getElementById(S);if(O)return O}return P===d&&U?U:P===a&&v?v:E}function Z(P){let S=C(P);if(S){H=S;try{k&&(k.hidden=!1,k.textContent="Listening\u2026"),b.start()}catch(O){console.warn("Speech recognition error:",O)}}}a.addEventListener("click",()=>Z(a)),d?.addEventListener("click",()=>Z(d)),b.addEventListener("result",P=>{let S=P.results?.[0]?.[0]?.transcript?.trim()||"";if(!S){k&&(k.hidden=!0);return}let O=H||E;if(O&&(O.value=S,k&&(k.textContent="Added: "+S,k.hidden=!0),O&&O.id==="quickAddInput"))try{(typeof window<"u"?window.memoryCueQuickAddNow:null)?.()}catch{}}),b.addEventListener("end",()=>{k&&(k.hidden=!0)})}function I(a){if(typeof a=="string"){let d=a.replace(/\s+/g," ").trim();if(d)return d}return R}async function So(a={}){let d=e=>e?document.querySelector(e):null,k=e=>e?Array.from(document.querySelectorAll(e)):[],U=d(a.qSel),v=d(a.titleSel),E=d(a.dateSel),T=d(a.timeSel),b=d(a.detailsSel),H=d(a.prioritySel),C=d(a.categorySel),Z=d(a.saveBtnSel),P=d(a.cancelEditBtnSel),S=d(a.listSel),O=d(a.googleSignInBtnSel),Me=d(a.googleSignOutBtnSel),gt=d(a.statusSel),q=d(a.syncStatusSel),N=d(a.notesSel),hn=d(a.saveNotesBtnSel),vn=d(a.loadNotesBtnSel),Ot=d(a.sortSel),$e=k(a.filterBtnsSel),Bt=e=>typeof e=="string"?e.trim().toLowerCase():"",Re=new Map;$e.forEach(e=>{let t=e?.getAttribute("data-filter"),n=Bt(t);n&&!Re.has(n)&&Re.set(n,t)});let Oe=Bt(a.defaultFilter),wn=Oe&&Re.get(Oe)||(Oe&&!Re.size?Oe:null),Pt=d(a.countTodaySel),jt=d(a.countWeekSel),qt=d(a.countOverdueSel),Ut=d(a.countTotalSel),Ht=d(a.countCompletedSel),K=d(a.googleAvatarSel),Be=d(a.googleUserNameSel),ae=d(a.dateFeedbackSel),_t=d(a.addQuickBtnSel),bn=d(a.notifBtnSel),ve=d(a.moreBtnSel),we=d(a.moreMenuSel),Sn=d(a.copyMtlBtnSel),ht=d(a.importFileSel),En=d(a.exportBtnSel),Ln=d(a.syncAllBtnSel),ue=d(a.syncUrlInputSel),kn=d(a.saveSettingsSel),Cn=d(a.testSyncSel),An=d(a.openSettingsSel),Pe=d(a.settingsSectionSel),V=d(a.emptyStateSel),Wt=d(a.listWrapperSel),Y=d(a.categoryFilterSel),vt=d(a.categoryOptionsSel),z=a.variant||"mobile",Vt="mc:lastDefaults";function wt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Vt)||"{}")||{}}catch{return{}}}function Dn(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Vt,JSON.stringify(e))}catch{}}function bt(e){let t=wt(),n={category:I(e?.category||t.category||R),priority:e?.priority||t.priority||"Medium"};Dn(n)}let zt='fieldset#priorityChips input[name="priority"]';function je(){try{let e=document.querySelector(`${zt}:checked`);if(e&&e.value)return e.value}catch{}return H&&typeof H.value=="string"&&H.value?H.value:"Medium"}function qe(e){let t=e||"Medium";H&&typeof H.value<"u"&&(H.value=t);try{let n=Array.from(document.querySelectorAll(zt));if(!n.length)return;let i=!1;if(n.forEach(r=>{let c=r.value===t;r.checked=c,i=i||c}),!i){let r=n.find(c=>c.value==="Medium")||n[0];r&&(r.checked=!0)}}catch{}}function Jt(){let e=wt();e.category&&C&&(C.value=e.category),e.priority&&qe(e.priority)}Jt();let fe=typeof document<"u"?document.getElementById("quickAddInput"):null,In=typeof document<"u"?document.getElementById("quickAddMic"):null,Tn=typeof document<"u"?document.getElementById("quickAddSubmit"):null;function xn(e){let t=Date.now(),n=wt();return{id:De(),title:(e||"").trim(),priority:n.priority||je(),category:I(n.category||C?.value||R),notes:"",done:!1,createdAt:t,updatedAt:t,due:null,pendingSync:!F}}async function St(){if(!fe)return;let e=(fe.value||"").trim();if(!e)return;let t=xn(e);f.unshift(t),me=!0,A(),$(),ne(t),Te(t),le(t),oe(),bt(t),He();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:f}}))}catch{}ee({action:"created",label:`Reminder added \xB7 ${t.title}`}),fe.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=St),Tn?.addEventListener("click",()=>{St()}),fe?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),St())}),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q"?fe&&(e.preventDefault(),fe.focus()):(e.key==="m"||e.key==="M")&&e.altKey&&(e.preventDefault(),In?.click()))})));try{z==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Qt=a.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Gt=a.emptyStateFilteredText||"No reminders match the current filter. Adjust your filters or add a new cue.",Ue=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Nn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Fn=a.reminderLandingPath||(z==="desktop"?"index.html#reminders":"mobile.html"),X=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Et(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function He(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:f}}))}catch{}}_t&&v&&_t.addEventListener("click",()=>{let e=(v.value||"").trim();if(!e){try{v.focus()}catch{}return}let t=Date.now(),n=typeof E?.value=="string"&&E.value,i=typeof T?.value=="string"&&T.value,r=null;if(n||i)r=It(n?E.value:Ie(),i?T.value:"09:00");else try{let m=st(e);m?.time&&(r=new Date(`${m.date}T${m.time}:00`).toISOString())}catch{}let c={id:De(),title:e,notes:typeof b?.value=="string"?b.value.trim():"",priority:je(),category:I(C?.value||R),done:!1,createdAt:t,updatedAt:t,due:r,pendingSync:!F};f.unshift(c),me=!0,A(),$(),bt(c),ne(c),Te(c),le(c),He(),X("memoryCue:remindersUpdated",{items:f}),Et(),X("cue:close",{reason:"created"}),v.value="",typeof b?.value<"u"&&(b.value=""),typeof E?.value<"u"&&(E.value=""),typeof T?.value<"u"&&(T.value="")}),C&&!C.value&&(C.value=R),he()&&Fe();function ee(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let r=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(r.push(n);r.length>20;)r.shift();window.memoryCueActivityQueue=r}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(un,{detail:n}));else if(document.createEvent){let r=document.createEvent("CustomEvent");r&&r.initCustomEvent&&(r.initCustomEvent(un,!1,!1,n),document.dispatchEvent(r))}}catch{}}}vo(),wo();let _e,We,Ve,ze,pe,Je,Qe,Ge,Ze,Ke,Ye,be,Se,Xe,et,tt,nt,ot,it,Zt=a.firebaseDeps,Lt=typeof a.importModule=="function"?a.importModule:e=>import(e),Ee=mn(),Le=!1,_=!1,kt=null,J=null,re=null,f=[],ke=wn||($e.length?"today":"all"),se=Y?.value||"all",Ct="smart",me=!1,F=null,Ce=null,Ae=null,de={},M={};function Kt(){F=null,q?.classList.remove("online","error"),q&&(q.classList.add("offline"),q.textContent="Offline"),O?.classList.remove("hidden"),Me?.classList.add("hidden"),K&&(K.classList.add("hidden"),K.src=""),Be&&(Be.textContent=""),Ce?.(),Ce=null,Dt(),A(),$(),oe()}function At(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem($t);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),r=Number.isFinite(n.updatedAt)?n.updatedAt:i;return{id:typeof n.id=="string"&&n.id?n.id:De(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:I(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:r,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Mn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem($t);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:I(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem($t,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function $(){Mn(f)}function Dt(){f=At()}Dt();async function $n(){if(!F){f=At();return}let e=At();if(!e.length){f=[],$();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await ne(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}f=e.map(n=>({...n,pendingSync:!1})),$(),A(),oe()}try{M=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{M={}}M&&typeof M=="object"&&Object.values(M).forEach(e=>{e&&typeof e=="object"&&(e.category=I(e.category))});let at=e=>{if(!Ee)return;let t=[Ee];Ee.window&&!t.includes(Ee.window)&&t.push(Ee.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Rn(){if(!N)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",r=typeof document<"u"&&typeof document.execCommand=="function",c=()=>"value"in N?N.value:N.innerHTML,m=h=>{if("value"in N){N.value=h;return}if(typeof h!="string"||h.length===0){N.innerHTML="";return}let D=h.trim();if(/<\/?[a-z][\s\S]*>/i.test(D)){N.innerHTML=h;return}let j=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");N.innerHTML=j},l=h=>{h?N.classList.add("notes-editor--columns"):N.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!h))},u="";try{u=localStorage.getItem(n)||""}catch{p("Unable to access saved notes")}m(u);let y=!1;try{y=localStorage.getItem(i)==="1"}catch{y=!1}l(y),N.addEventListener("input",()=>{u=c();try{localStorage.setItem(n,u)}catch{p("Notes saved for this session only")}}),hn?.addEventListener("click",()=>{u=c();try{localStorage.setItem(n,u),p("Notes saved")}catch{p("Notes saved for this session only")}}),vn?.addEventListener("click",()=>{let h=u;try{h=localStorage.getItem(n)||u}catch{p("Unable to load saved notes")}u=h,m(u)}),e?.addEventListener("click",h=>{let D=h.target;if(!(D instanceof Element))return;let x=D.closest("button[data-action]");if(!x)return;let j=x.getAttribute("data-action");if(j==="columns"){let ut=!N.classList.contains("notes-editor--columns");l(ut);try{localStorage.setItem(i,ut?"1":"0")}catch{p("Column preference saved for this session only")}return}if(!r){p("Formatting controls are not supported in this browser");return}N.focus(),j==="bullets"?document.execCommand("insertUnorderedList"):j==="numbers"&&document.execCommand("insertOrderedList")})}if(Rn(),Z?.addEventListener("click",dn),Zt)({initializeApp:_e,getFirestore:We,enableMultiTabIndexedDbPersistence:Ve,enableIndexedDbPersistence:ze,doc:pe,setDoc:Je,deleteDoc:Qe,onSnapshot:Ge,collection:Ze,query:Ke,orderBy:Ye,serverTimestamp:be,getAuth:Se,onAuthStateChanged:Xe,GoogleAuthProvider:et,signInWithPopup:tt,signInWithRedirect:nt,getRedirectResult:ot,signOut:it}=Zt),Le=!0;else try{({initializeApp:_e}=await Lt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:We,enableMultiTabIndexedDbPersistence:Ve,enableIndexedDbPersistence:ze,doc:pe,setDoc:Je,deleteDoc:Qe,onSnapshot:Ge,collection:Ze,query:Ke,orderBy:Ye,serverTimestamp:be}=await Lt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Se,onAuthStateChanged:Xe,GoogleAuthProvider:et,signInWithPopup:tt,signInWithRedirect:nt,getRedirectResult:ot,signOut:it}=await Lt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Le=!0}catch(e){Le=!1,console.warn("Firebase modules failed to load:",e),p("Firebase failed to load; notes available offline"),at(!1)}if(Le&&typeof _e=="function"&&typeof We=="function"&&typeof Se=="function")try{kt=_e({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),J=We(kt),_=!0,at(!0)}catch(e){_=!1,console.warn("Firebase initialization failed:",e),p("Firebase failed to load; notes available offline"),at(!1)}else Le?(_=!1,at(!1)):_=!1;_&&typeof Ve=="function"&&typeof ze=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ve(J),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await ze(J),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),_&&typeof Se=="function"&&(re=Se(kt));function On(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Bn=typeof navigator<"u"&&navigator.language?navigator.language:"",Yt=On(Bn),ye=Yt||"en-US",Q="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Q=e.timeZone),!Yt&&e.locale&&(ye=e.locale)}catch{}let Pn=new Intl.DateTimeFormat(ye,{timeZone:Q,hour:"2-digit",minute:"2-digit"}),jn=new Intl.DateTimeFormat(ye,{timeZone:Q,weekday:"long",day:"numeric",month:"long"}),qn=new Intl.DateTimeFormat("en-CA",{timeZone:Q,year:"numeric",month:"2-digit",day:"2-digit"}),Un=new Intl.DateTimeFormat(ye,{timeZone:Q,weekday:"long"}),Hn=new Intl.DateTimeFormat(ye,{timeZone:Q,month:"short",day:"numeric"});function te(e){let t=qn.formatToParts(e),n=t.find(c=>c.type==="year").value,i=t.find(c=>c.type==="month").value,r=t.find(c=>c.type==="day").value;return`${n}-${i}-${r}`}function It(e,t){let[n,i,r]=e.split("-").map(u=>parseInt(u,10)),[c,m]=t.split(":").map(u=>parseInt(u,10)),l=new Date;return l.setFullYear(n,(i||1)-1,r||1),l.setHours(c||0,m||0,0,0),l.toISOString()}let _n=new Intl.DateTimeFormat("en-CA",{timeZone:Q,year:"numeric",month:"2-digit",day:"2-digit"}),Wn=new Intl.DateTimeFormat("en-CA",{timeZone:Q,hour:"2-digit",minute:"2-digit",hour12:!1});function Vn(e){try{let t=new Date(e),n=_n.formatToParts(t),i=n.find(m=>m.type==="year")?.value||"0000",r=n.find(m=>m.type==="month")?.value||"00",c=n.find(m=>m.type==="day")?.value||"00";return`${i}-${r}-${c}`}catch{return""}}function zn(e){try{let t=new Date(e),n=Wn.formatToParts(t),i=n.find(c=>c.type==="hour")?.value?.padStart(2,"0")||"00",r=n.find(c=>c.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${r}`}catch{return""}}function De(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Ie(){return te(new Date)}function Xt(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Jn(e){let t=Xt(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function rt(e){return e==="High"?3:e==="Medium"?2:1}function Qn(e,t){let n=rt(t.priority)-rt(e.priority);if(n)return n;let i=+new Date(e.due||0),r=+new Date(t.due||0);return i!==r?i-r:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Tt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return jn.format(t)}catch{return e}}function xt(e){return Pn.format(e)}function ce(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function en(e){return e?ce(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function p(e){gt&&(gt.textContent=e,clearTimeout(p._t),p._t=setTimeout(()=>gt.textContent="",2500))}function tn(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function st(e){e=String(e||"").toLowerCase();let t={date:Ie(),time:""},n=l=>{let u=new Date,y=u.getDay(),h=(l-y+7)%7,D=new Date(u);return D.setDate(u.getDate()+(h===0?7:h)),D},i=l=>{let u=new Date,y=u.getDay(),h=(l-y+7)%7,D=new Date(u);return D.setDate(u.getDate()+h),D},r={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},c={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let l=new Date;l.setDate(l.getDate()+1),t.date=te(l)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[l[1]],y=n(u);t.date=te(y)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[l[1]],y=i(u);t.date=te(y)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),u=r[l[1]],y=n(u);t.date=te(y)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let l=e.match(/\bin\s+(\d+)\s+days?\b/),u=parseInt(l[1],10),y=new Date;y.setDate(y.getDate()+u),t.date=te(y)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let l=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),u=parseInt(l[1],10),y=parseInt(l[2],10)-1,h=l[3]?parseInt(l[3],10):new Date().getFullYear(),D=new Date(h,y,u);t.date=te(D)}else for(let[l,u]of Object.entries(c)){let y=new RegExp(`\\b${l}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(y.test(e)){let h=e.match(y),D=parseInt(h[1],10),x=new Date().getFullYear(),j=new Date(x,u,D);t.date=te(j);break}}let m=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(m){let l=parseInt(m[1],10),u=m[2]?parseInt(m[2],10):0,y=m[3];y&&(y==="pm"&&l<12&&(l+=12),y==="am"&&l===12&&(l=0)),t.time=`${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`}return t}let dt=_&&re&&typeof et=="function";O?.addEventListener("click",async()=>{if(!dt||typeof tt!="function"||typeof nt!="function"){p("Sign-in unavailable offline");return}let e=new et;try{await tt(re,e)}catch{try{await nt(re,e)}catch{p("Google sign-in failed")}}}),dt&&typeof ot=="function"&&ot(re).catch(()=>{}),Me?.addEventListener("click",async()=>{if(!dt||typeof it!="function"){p("Sign-out unavailable offline");return}try{await it(re),p("Signed out")}catch{p("Sign-out failed")}}),dt&&typeof Xe=="function"?Xe(re,async e=>{e?(F=e.uid,q?.classList.remove("offline","error"),q?.classList.add("online"),q&&(q.textContent="Online"),O?.classList.add("hidden"),Me?.classList.remove("hidden"),K&&(e.photoURL?(K.classList.remove("hidden"),K.src=e.photoURL):(K.classList.add("hidden"),K.src="")),Be&&(Be.textContent=e.displayName||e.email||""),Gn(),await $n()):Kt()}):Kt();function Gn(){if(!_||!J||typeof Ze!="function"||typeof Ke!="function"||typeof Ye!="function"||typeof Ge!="function")return;if(!F){Dt(),A(),$(),oe();return}Ce&&Ce();let e=Ze(J,"users",F,"reminders"),t=Ke(e,Ye("updatedAt","desc"));Ce=Ge(t,n=>{let i=[];n.forEach(r=>{let c=r.data();i.push({id:r.id,title:c.title,priority:c.priority,notes:c.notes||"",done:!!c.done,due:c.due||null,category:I(c.category),createdAt:c.createdAt?.toMillis?.()||0,updatedAt:c.updatedAt?.toMillis?.()||0,pendingSync:!1})}),f=i,A(),$(),oe()},n=>{console.error("Firestore sync error:",n),q&&(q.textContent="Sync Error",q.className="sync-status error")})}async function ne(e){if(!(!_||!F||!J||typeof pe!="function"||typeof Je!="function"||typeof be!="function"))try{await Je(pe(J,"users",F,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||R,createdAt:e.createdAt?new Date(e.createdAt):be(),updatedAt:be()},{merge:!0})}catch(t){console.error("Save failed:",t),p("Save queued (offline)")}}async function Zn(e){if(!(!_||!F||!J||typeof pe!="function"||typeof Qe!="function"))try{await Qe(pe(J,"users",F,"reminders",e))}catch{p("Delete queued (offline)")}}async function Te(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||R,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function xe(){v&&(v.value=""),E&&(E.value=""),T&&(T.value=""),b&&(b.value=""),qe("Medium"),C&&(C.value=R),Jt(),Ae=null,Z&&(Z.textContent="Save Cue"),P?.classList.add("hidden")}function nn(e){let t=f.find(n=>n.id===e);t&&(v&&(v.value=t.title||""),E&&T&&(t.due?(E.value=Vn(t.due),T.value=zn(t.due)):(E.value="",T.value="")),qe(t?.priority||"Medium"),C&&(C.value=I(t.category)),b&&(b.value=typeof t.notes=="string"?t.notes:""),Ae=e,Z&&(Z.textContent="Update Cue"),P?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),v?.focus(),X("cue:open",{mode:"edit"}))}function Kn(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=I(e.category??(C?C.value:"")),r={id:De(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!F};return f=[r,...f],me=!0,A(),$(),bt(r),ne(r),Te(r),le(r),He(),X("memoryCue:remindersUpdated",{items:f}),Et(),ee({action:"created",label:`Reminder added \xB7 ${r.title}`}),r}function Yn(e,t){if(!F)return p("Sign in to add notes"),null;if(!e)return null;let n=f.find(m=>m.id===e);if(!n)return null;let r=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!r)return n;let c=typeof n.notes=="string"?n.notes:"";return n.notes=c?`${c}
${r}`:r,n.updatedAt=Date.now(),ne(n),A(),$(),ee({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function on(e){let t=f.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),ne(t),Te(t),A(),$(),t.done?(lt(e),ee({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(le(t),ee({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function an(e){let t=f.find(n=>n.id===e);f=f.filter(n=>n.id!==e),A(),$(),Zn(e),lt(e),ee(t?{action:"deleted",label:`Reminder removed \xB7 ${t.title}`}:{action:"deleted",label:"Reminder removed"})}function Nt(){localStorage.setItem("scheduledReminders",JSON.stringify(M))}function ct(e,{closeNotification:t=!0}={}){if(t){let n=G.get(e);if(n){try{n.close()}catch{}G.delete(e)}}de[e]&&(clearTimeout(de[e]),delete de[e]),Rt(e),M[e]&&(delete M[e],Nt())}function lt(e){ct(e)}function rn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=G.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:"Due now",tag:e.id});G.set(e.id,n);let i=()=>{G.get(e.id)===n&&G.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Xn(e){if(!he())return!1;let t=yn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Fe();if(!i)return!1;await Rt(e.id,i);let r={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||R,urlPath:Fn},c=typeof e.notes=="string"&&e.notes.split(/\r?\n/).find(u=>u.trim())||"",m=c||"Due now";try{let u=new Date(e.due);if(!Number.isNaN(u.getTime())){let y=xt(u);y&&(m=c?`${c} \u2022 ${y}`:`Due ${y}`)}}catch{}let l={body:m,tag:e.id,data:r,renotify:!0};n>Date.now()&&(l.showTrigger=new t(n));try{return await i.showNotification(e.title,l),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function le(e){if(!e||!e.id)return;if(e.category=I(e.category),!e.due||e.done){lt(e.id);return}let t={id:e.id,title:e.title,due:e.due,category:e.category||R};if(M[e.id]=t,Nt(),de[e.id]&&(clearTimeout(de[e.id]),delete de[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return;let i=n-Date.now();if(i<=0){if(M[e.id]?.viaTrigger){ct(e.id,{closeNotification:!1});return}rn(e),ct(e.id,{closeNotification:!1});return}let r=he();r&&(t.viaTrigger=!1,Xn(e).then(c=>{c&&M[e.id]&&(M[e.id]={...M[e.id],viaTrigger:!0},Nt())})),de[e.id]=setTimeout(()=>{r&&Rt(e.id),rn(e),ct(e.id,{closeNotification:!1})},i)}function oe(){Object.values(M).forEach(e=>le({...e,category:I(e?.category)}))}let sn={High:"bg-rose-400/80 dark:bg-rose-300/80",Medium:"bg-amber-400/80 dark:bg-amber-300/80",Low:"bg-emerald-400/80 dark:bg-emerald-300/80"};function eo(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Un.format(t),i=Hn.format(t),r=xt(t);return`${n}, ${i}${r?` at ${r}`:""}`}catch{return"No due date"}}function A(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let r=Xt(t),c=Jn(t),m=f.filter(o=>{if(!o.due||o.done)return!1;let s=new Date(o.due);return s>=n&&s<=i}),l=f.filter(o=>{if(!o.due||o.done)return!1;let s=new Date(o.due);return s>=r&&s<=c}),u=f.filter(o=>o.done||!o.due?!1:new Date(o.due)<t).length,y=f.filter(o=>o.done).length;Pt&&(Pt.textContent=String(m.length)),jt&&(jt.textContent=String(l.length)),qt&&(qt.textContent=String(u)),Ut&&(Ut.textContent=String(f.length)),Ht&&(Ht.textContent=String(y)),f.forEach(o=>{o&&typeof o=="object"&&(o.category=I(o.category))});let h=new Set(go.map(o=>I(o)));f.forEach(o=>{o&&typeof o=="object"&&h.add(I(o.category))});let D=Array.from(h).sort((o,s)=>o.localeCompare(s,void 0,{sensitivity:"base"}));if(Y){let o=se;Y.replaceChildren();let s=document.createElement("option");s.value="all",s.textContent="All categories",Y.appendChild(s),D.forEach(g=>{let L=document.createElement("option");L.value=g,L.textContent=g,Y.appendChild(L)}),o!=="all"&&!D.includes(o)&&(se="all"),Y.value=se}if(vt){let o=new Set;Array.from(vt.querySelectorAll("option")).forEach(s=>{o.add(s.value.trim().toLowerCase())}),D.forEach(s=>{let g=s.toLowerCase();if(!o.has(g)){let L=document.createElement("option");L.value=s,vt.appendChild(L),o.add(g)}})}if(me)me=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let o=f.map(s=>({...s}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:o}}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:o}),document.dispatchEvent(s))}}catch{}}let x=f.slice(),j=U?.value.trim().toLowerCase()||"";j&&(x=x.filter(o=>o.title.toLowerCase().includes(j)||(o.notes||"").toLowerCase().includes(j)||(o.category||"").toLowerCase().includes(j))),se&&se!=="all"&&(x=x.filter(o=>I(o.category)===se)),x=x.filter(o=>{if(ke==="done")return o.done;if(ke==="overdue")return!o.done&&o.due&&new Date(o.due)<t;if(ke==="today"){if(!o.due)return!0;let s=new Date(o.due);return s>=n&&s<=i}return!0}),x.sort((o,s)=>Ct==="time"?+new Date(o.due||0)-+new Date(s.due||0):Ct==="priority"?rt(s.priority)-rt(o.priority):Qn(o,s)),$e.forEach(o=>{let s=o.getAttribute("data-filter")===ke;o.classList.toggle("active",s),o.setAttribute("aria-pressed",String(s)),o.classList.contains("btn-ghost")||(o.classList.toggle("bg-gray-900",s),o.classList.toggle("text-white",s),o.classList.toggle("border-gray-900",s),o.classList.toggle("dark:bg-gray-100",s),o.classList.toggle("dark:text-gray-900",s),o.classList.toggle("dark:border-gray-100",s),o.classList.toggle("bg-white",!s),o.classList.toggle("text-gray-600",!s),o.classList.toggle("border-gray-200",!s),o.classList.toggle("dark:bg-gray-800",!s),o.classList.toggle("dark:text-gray-400",!s),o.classList.toggle("dark:border-gray-700",!s))});let ut=f.length>0,Ft=x.length>0;if(V&&(ut?Ft?V.classList.add("hidden"):(Ue?Ue(V,{icon:"sparkles",title:"No reminders match this view",description:Gt}):V.textContent=Gt,V.classList.remove("hidden")):(Ue?Ue(V,{icon:"bell",title:"Create your first cue",description:Qt,action:`<button type="button" class="${Nn}" data-trigger="open-cue">Create reminder</button>`}):V.textContent=Qt,V.classList.remove("hidden"))),Wt&&Wt.classList.toggle("has-items",Ft),!S)return;if(!Ft){V?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden"));return}S.classList.remove("hidden"),S.replaceChildren();let ge=document.createDocumentFragment(),ft=S.tagName==="UL"||S.tagName==="OL",oo=(()=>{if(typeof document>"u")return!1;let o=document.body;return!o||typeof o.classList?.contains!="function"?!1:!o.classList.contains("show-full")})(),io=z==="desktop"||!oo||!ft&&z!=="desktop",cn=(o,s)=>{let g=document.createElement("div");g.className="task-item"+(o.done?" completed":"");let L={id:o.id,title:o.title,dueIso:o.due||null,priority:o.priority||"Medium",category:s,done:!!o.done};g.dataset.category=s,g.dataset.reminder=JSON.stringify(L),g.dataset.id=L.id,g.dataset.title=L.title,g.dataset.priority=L.priority,g.dataset.done=String(L.done),L.dueIso&&(g.dataset.due=L.dueIso);let mt=o.due?`${xt(new Date(o.due))} \u2022 ${Tt(o.due.slice(0,10))}`:"No due date",Ne=`priority-${(o.priority||"Medium").toLowerCase()}`,w=o.notes?`<div class="task-notes">${en(o.notes)}</div>`:"";return g.innerHTML=`
        <input type="checkbox" ${o.done?"checked":""} aria-label="Mark complete" />
        <div class="task-content">
          <div class="task-title">${ce(o.title)}</div>
          <div class="task-meta">
            <div class="task-meta-row" style="gap:8px; flex-wrap:wrap;">
              <span>${mt}</span>
              <span class="priority-badge ${Ne}">${o.priority}</span>
              <span class="priority-badge" style="background:rgba(56,189,248,.14);color:#0284c7;border-color:rgba(56,189,248,.26);">${ce(s)}</span>
            </div>
          </div>
          ${w}
        </div>
        <div class="task-actions">
          <button class="btn-ghost" data-edit type="button">Edit</button>
          <button class="btn-ghost" data-del type="button">Del</button>
        </div>`,g.querySelector("input").addEventListener("change",()=>on(o.id)),g.querySelector("[data-edit]").addEventListener("click",()=>nn(o.id)),g.querySelector("[data-del]").addEventListener("click",()=>an(o.id)),g};if(z!=="desktop"&&!io){x.forEach(o=>{let s=o.category||R;ge.appendChild(cn(o,s))}),S.appendChild(ge);return}let pt=new Map;x.forEach(o=>{let s=o.category||R;pt.has(s)||pt.set(s,[]),pt.get(s).push(o)});let ao=Array.from(pt.entries()).sort((o,s)=>o[0].localeCompare(s[0],void 0,{sensitivity:"base"})),ln=!0;ao.forEach(([o,s])=>{let g=document.createElement(ft?"li":"div");g.dataset.categoryHeading=o,ft&&(g.setAttribute("role","presentation"),g.style.listStyle="none"),g.className=z==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",ln||(g.style.marginTop=z==="desktop"?"1.25rem":"1rem");let L=document.createElement("div");L.setAttribute("role","heading"),L.setAttribute("aria-level","3"),L.className=z==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let mt=document.createElement("span");mt.textContent=o;let Ne=document.createElement("span");Ne.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",Ne.textContent=`${s.length} ${s.length===1?"item":"items"}`,L.append(mt,Ne),g.appendChild(L),ge.appendChild(g),s.forEach(w=>{if(z==="desktop"){let B=document.createElement(ft?"li":"div"),ie={id:w.id,title:w.title,dueIso:w.due||null,priority:w.priority||"Medium",category:o,done:!!w.done};B.dataset.id=ie.id,B.dataset.category=ie.category,B.dataset.title=ie.title,B.dataset.priority=ie.priority,B.dataset.done=String(ie.done),ie.dueIso&&(B.dataset.due=ie.dueIso),B.dataset.reminder=JSON.stringify(ie),B.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let ro=eo(w),so=sn[w.priority]||sn.Medium,co=w.done?"line-through text-base-content/50":"text-base-content",lo=w.done?"Completed":"Active",uo=w.priority==="High"?"badge badge-outline border-error text-error":w.priority==="Medium"?"badge badge-outline border-warning text-warning":"badge badge-outline border-success text-success",fo=w.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",po=w.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",mo=w.notes?`<p class="text-sm leading-relaxed text-base-content/70">${en(w.notes)}</p>`:"";B.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${co}">${ce(w.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ce(ro)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ce(o)}
            </span>
            <span class="${uo} gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full ${so}"></span>
              ${ce(w.priority)} priority
            </span>
            <span class="${fo} text-[0.7rem] sm:text-xs">${lo}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${mo}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${po}">${w.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,B.querySelector('[data-action="toggle"]').addEventListener("click",()=>on(w.id)),B.querySelector('[data-action="edit"]').addEventListener("click",()=>nn(w.id)),B.querySelector('[data-action="delete"]').addEventListener("click",()=>an(w.id)),ge.appendChild(B);return}ge.appendChild(cn(w,o))}),ln=!1}),S.appendChild(ge)}function W(){ve?.setAttribute("aria-expanded","false"),we?.classList.add("hidden")}function to(){ve?.setAttribute("aria-expanded","true"),we?.classList.remove("hidden")}ve?.addEventListener("click",e=>{e.stopPropagation(),ve.getAttribute("aria-expanded")==="true"?W():to()}),document.addEventListener("click",e=>{we&&!we.classList.contains("hidden")&&!we.contains(e.target)&&e.target!==ve&&W()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&W()}),An?.addEventListener("click",()=>{let e=Pe?.classList.contains("hidden");Pe?.classList.toggle("hidden"),e&&Pe?.scrollIntoView({behavior:"smooth",block:"start"}),W()}),document.addEventListener("DOMContentLoaded",()=>{Pe?.classList.add("hidden")});function dn(){try{console.log("handleSaveAction invoked",{editingId:Ae,title:v?.value})}catch{}if(Ae){let i=f.find(l=>l.id===Ae);if(!i){xe();return}let r=v.value.trim();if(!r){p("Add a reminder title");return}let c=null;if(E.value||T.value){let l=E.value||Ie(),u=T.value||"09:00";c=It(l,u)}else{let l=st(r);l.time&&(c=new Date(`${l.date}T${l.time}:00`).toISOString())}i.title=r;let m=je();i.priority=m,qe(m),C&&(i.category=I(C.value)),i.due=c,b&&(i.notes=b.value.trim()),i.updatedAt=Date.now(),ne(i),Te(i),me=!0,A(),le(i),$(),He(),X("memoryCue:remindersUpdated",{items:f}),Et(),ee({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),xe(),p("Reminder updated"),X("cue:close",{reason:"updated"});return}let e=v.value.trim();if(!e){p("Add a reminder title");return}let t=b?b.value.trim():"",n=null;if(E.value||T.value){let i=E.value||Ie(),r=T.value||"09:00";n=It(i,r)}else{let i=st(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}Kn({title:e,priority:je(),category:C?C.value:"",due:n,notes:t}),v.value="",T.value="",b&&(b.value=""),X("cue:close",{reason:"created"})}v?.addEventListener("keydown",e=>{e.key==="Enter"&&dn()});function no(){if(!v||!ae)return;let e=v.value.trim();if(!e){ae.style.display="none";return}try{let t=st(e),n=Ie();if(t.date!==n||t.time){let i="";if(t.date!==n){let r=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Tt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(ae.textContent=`Parsed: ${i}`,ae.style.display="block"):ae.style.display="none"}else ae.style.display="none"}catch{ae.style.display="none"}}return v?.addEventListener("input",tn(no,300)),P?.addEventListener("click",()=>{xe(),p("Edit cancelled"),X("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{xe()}),document.addEventListener("cue:prepare",()=>{xe()}),window.addEventListener("load",()=>v?.focus()),U?.addEventListener("input",tn(A,150)),Ot?.addEventListener("change",()=>{Ct=Ot.value,A()}),Y?.addEventListener("change",()=>{se=Y.value||"all",A()}),$e.forEach(e=>e.addEventListener("click",()=>{ke=e.getAttribute("data-filter"),A()})),Sn?.addEventListener("click",()=>{let e=f.filter(t=>!t.done).map(t=>{let n=t.due?Tt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(ye,{hour:"2-digit",minute:"2-digit",timeZone:Q}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){p("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>p("Copied for Master Task List")).catch(()=>p("Copy failed")),W()}),ht?.addEventListener("change",()=>{let e=ht.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(i=>{i.id=De(),i.category=I(i.category),i.pendingSync=!F,f=[i,...f],ne(i)}),A(),$(),p("Import successful")}catch{p("Invalid JSON")}},t.readAsText(e),ht.value="",W()}),En?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),W()}),Ln?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){p("Add your Apps Script URL in Settings first"),W();return}if(!f.length){p("No tasks to sync"),W();return}p("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<f.length;i+=t){let r=f.slice(i,i+t),c=await Promise.allSettled(r.map(m=>{let l={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:m.category||R,done:!!m.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}));n+=c.filter(m=>m.status==="rejected").length,await new Promise(m=>setTimeout(m,400))}p(`Sync complete: ${f.length-n} ok${n?`, ${n} failed`:""}`),W()}),ue&&(ue.value=localStorage.getItem("syncUrl")||""),kn?.addEventListener("click",()=>{ue&&(localStorage.setItem("syncUrl",ue.value.trim()),p("Settings saved"))}),Cn?.addEventListener("click",async()=>{if(!ue)return;let e=ue.value.trim();if(!e){p("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});p(t.ok?"Test ok":"Test failed")}catch{p("Test failed")}}),bn?.addEventListener("click",async()=>{if(!("Notification"in window)){p("Notifications not supported");return}if(Notification.permission==="granted"){p("Notifications enabled"),he()&&Fe(),oe();return}try{await Notification.requestPermission()==="granted"?(p("Notifications enabled"),he()&&Fe(),oe()):p("Notifications blocked")}catch{p("Notifications blocked")}}),oe(),A(),$(),{cancelReminder:lt,scheduleReminder:le,closeActiveNotifications:gn,getActiveNotifications:()=>G,addNoteToReminder:Yn,__testing:{setItems(e=[]){f=Array.isArray(e)?e.map(t=>({...t,category:I(t?.category)})):[],A()},render:A,getItems:()=>f.map(e=>({...e}))}}}var un,G,fn,Mt,yt,R,go,$t,pn,bo=yo(()=>{un="memoryCue:activity",G=new Map,fn=!1,Mt="service-worker.js",yt=null,R="General",go=Object.freeze([R,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),$t="memoryCue:offlineReminders";pn=!1});export{So as a,bo as b};
