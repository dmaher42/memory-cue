import{c as Me,d as ys}from"./chunk-CKP4A3FS.js";import{a as en,b as hs}from"./chunk-MG4MJA24.js";import"./chunk-CTK42JWW.js";import{b as it,c as ps}from"./chunk-GUVSRPRW.js";function nn(t,e=document){return!Array.isArray(t)||!e||typeof e.getElementById!="function"?[]:t.map(({key:n,ids:s})=>{if(!Array.isArray(s))return null;for(let i of s){if(typeof i!="string"||!i)continue;let a=e.getElementById(i);if(a)return{key:n,element:a}}return null}).filter(n=>!!(n&&n.element))}function ce(t,e){if(!t||typeof t!="object")return"";let n=bs[e]||[e];for(let s of n)if(Object.prototype.hasOwnProperty.call(t,s)){let i=t[s];return i==null?"":typeof i=="string"?i:String(i)}return""}function gs(t,e){if(!t)return;let n=e??"";if(t instanceof HTMLInputElement){t.type==="checkbox"?t.checked=!!n:t.value=typeof n=="string"?n:String(n);return}(t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)&&(t.value=typeof n=="string"?n:String(n))}function Es(t){return t?t instanceof HTMLInputElement?t.type==="checkbox"?t.checked:t.value:t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?t.value:"":""}function sn(t,e){Array.isArray(e)&&e.forEach(({key:n,element:s})=>{let i=t&&typeof t=="object"?ce(t,n):"";gs(s,i)})}function an(t,e,n,s){Array.isArray(t)&&t.forEach(({element:i})=>{i instanceof HTMLInputElement?["checkbox","radio"].includes(i.type)?i.checked=!1:i.value="":(i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value="")}),e&&(e.value=""),n&&(n.textContent=s)}function on(t){let e={};return Array.isArray(t)&&t.forEach(({key:n,element:s})=>{let i=Es(s);if(typeof i=="boolean"){e[n]=i;return}let a=typeof i=="string"?i.trim():i;e[n]=a??""}),e}function g(t){return t==null?"":String(t).replace(/[&<>'"]/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}var tn,bs,at,ot,rt=it(()=>{tn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],bs={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},at="Create Cue",ot="Edit Cue"});function rn(t){return new lt(t)}var Ts,ks,lt,ln=it(()=>{Ts=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),ks={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},lt=class t{static activeStack=[];constructor(e={}){this.modal=e.modalElement??null,this.openButton=e.openButton??null,this.closeButton=e.closeButton??null,this.backdropButton=e.backdropButton??null,this.titleInput=e.titleInput??null,this.modalTitle=e.modalTitle??null,this.defaultTitle=e.defaultTitle??"",this.editTitle=e.editTitle??e.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=e.manageAria!==!1,this.enableFocusTrap=e.focusTrap!==!1,this.shouldAutoFocus=e.autoFocus!==!1,this.eventTarget=e.eventTarget??document,this.events={...ks,...e.events||{}},this.animationHooks=e.animationHooks??{},this.enableStacking=e.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(e={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...e}),await this.runHook("onAfterShow")}}async hide(e={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...e}),await this.runHook("onAfterHide"))}focusTitleInput(){let e=this.titleInput||this.modal?.querySelector("[autofocus]");!e||typeof e.focus!="function"||window.setTimeout(()=>{try{e.focus({preventScroll:!0})}catch{e.focus()}},50)}async restoreFocus(){let e=this.previouslyFocusedElement||this.openButton;if(e&&typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(e={}){this.isDestroyed||(await this.hide(e),this.cleanup(),this.isDestroyed=!0)}setEditMode(e=!1){this.modalTitle&&(this.modalTitle.textContent=e?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",e?"edit":"create"),this.currentMode=e?"edit":"create"}handleOpenClick(e){e.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(e){e.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(e){e.preventDefault(),this.requestClose("backdrop")}handleCancel(e){e.preventDefault(),this.requestClose("keyboard")}handleKeydown(e){this.enableFocusTrap&&e.key==="Tab"&&this.maintainFocus(e),e.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(e){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){e.preventDefault(),this.modal.focus();return}let s=n[0],i=n[n.length-1],a=document.activeElement;e.shiftKey&&a===s?(e.preventDefault(),i.focus()):!e.shiftKey&&a===i&&(e.preventDefault(),s.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Ts)).filter(e=>!(e instanceof HTMLElement)||e.hasAttribute("disabled")?!1:e.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(e){if(!e||e.detail&&e.detail.controller&&e.detail.controller!==this)return;let n=e?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:e?.detail?.reason||"external-open",mode:e?.detail?.mode})}handleDocumentCloseRequest(e){if(!e||e.detail?.controller&&e.detail.controller!==this||e.detail?.initiatedBy==="controller")return;let n=e.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(e,n={}){let s=this.events[e];if(!s||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let i=new CustomEvent(s,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(i)}requestClose(e){let n={reason:e,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:e})}async runHook(e){let n=this.animationHooks?.[e];typeof n=="function"&&await n(this)}addToStack(){let e=t.activeStack,n=e.indexOf(this);n!==-1&&e.splice(n,1),e.push(this),this.stackIndex=e.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let e=t.activeStack,n=e.indexOf(this);n!==-1&&e.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});function dt(t=0){let e=Number.isFinite(t)?t:0;if(e<=0)return"0m";let n=Math.floor(e/1e3),s=Math.floor(n/3600),i=Math.floor(n%3600/60),a=n%60,o=[];return s&&o.push(`${s}h`),i&&o.push(`${i}m`),!s&&!i&&o.push(`${a}s`),o.join(" ")}function ct(){let t=new Date,e=String(t.getFullYear()),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${s}`}function Ls(t){if(typeof t!="string")return"";let[e,n,s]=t.split("-"),i=Number.parseInt(e,10),a=Number.parseInt(n,10),o=Number.parseInt(s,10);if(!Number.isFinite(i)||!Number.isFinite(a)||!Number.isFinite(o))return t;let l=new Date(i,a-1,o);return Number.isNaN(l.getTime())?t:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(l)}function un(t={}){let e=typeof t?.text=="string"?t.text.trim():"",n=typeof t?.priority=="string"?t.priority.toLowerCase():"",s=ue.includes(n)?n:"medium",i=typeof t?.category=="string"&&t.category.trim()?t.category.trim():cn,a=Date.now(),o=Number.isFinite(t?.createdAt)?Number(t.createdAt):a,l=Number.isFinite(t?.completedAt)?Number(t.completedAt):null,c=Number.isFinite(t?.timeTrackedMs)?Number(t.timeTrackedMs):0,u=Number.isFinite(t?.estimateMs)?Number(t.estimateMs):null,d=!!t?.completed;return{id:typeof t?.id=="string"&&t.id?t.id:typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${o}-${Math.random().toString(16).slice(2)}`,text:e,completed:d,priority:s,category:i,createdAt:o,completedAt:d?l??a:null,timeTrackedMs:d?c||Math.max(0,(l??a)-o):c,estimateMs:u}}function ye(t){return Array.isArray(t)?t.map(e=>un(e)):[]}function ws(t){let e={text:t,priority:"medium",category:cn,estimateMs:null};if(typeof t!="string")return e.text="",e;let n=t,s=t.match(/!(high|medium|low)/i);s&&(e.priority=s[1].toLowerCase(),n=n.replace(s[0],"").trim());let i=t.match(/#([a-z0-9_-]+)/i);i&&(e.category=i[1].toLowerCase(),n=n.replace(i[0],"").trim());let a=t.match(/@([0-9]+)(h|m)?/i);if(a){let o=Number.parseInt(a[1],10);if(Number.isFinite(o)){let c=(a[2]||"m").toLowerCase()==="h"?60:1;e.estimateMs=o*c*6e4}n=n.replace(a[0],"").trim()}return e.text=n.trim(),e.text||(e.text=t.trim()),e}function mn(t){return new ut(t)}var dn,ue,vs,cn,ut,fn=it(()=>{rt();dn="dailyTasksByDate",ue=["high","medium","low"],vs={high:"High",medium:"Medium",low:"Low"},cn="general";ut=class{constructor(e={}){this.dailyTab=e.dailyTab??null,this.dailyView=e.dailyView??null,this.dailyListHeader=e.dailyListHeader??null,this.quickAddForm=e.quickAddForm??null,this.quickAddInput=e.quickAddInput??null,this.quickAddVoiceButton=e.quickAddVoiceButton??null,this.dailyTasksContainer=e.dailyTasksContainer??null,this.clearCompletedButton=e.clearCompletedButton??null,this.dailyListPermissionNotice=e.dailyListPermissionNotice??null,this.cuesTab=e.cuesTab??null,this.cuesView=e.cuesView??null,this.ensureCueFirestore=typeof e.ensureCueFirestore=="function"?e.ensureCueFirestore:null,this.storage=e.storage??(typeof window<"u"?window.localStorage:void 0),this.window=e.window??window,this.document=e.document??document,this.forceLocalMode=!!e.forceLocalMode,this.tasks=[],this.dailyListLoadPromise=null,this.shouldUseLocalDailyList=this.forceLocalMode,this.firestoreDailyListContextPromise=null,this.activeTimers=new Map,this.undoStack=[],this.quickAddVoiceRecognition=null,this.quickAddVoiceListening=!1,this.quickAddVoiceRestartTimer=null,this.todayId=ct(),this.statsElement=null,this.undoButton=null,this.boundDailyTabClick=n=>{n.preventDefault(),this.switchToDailyView()},this.boundCuesTabClick=n=>{n.preventDefault(),this.switchToCuesView()},this.boundClearCompletedClick=()=>{this.clearCompleted()},this.boundQuickAddSubmit=n=>{n.preventDefault();let s=this.quickAddInput?.value?.trim()??"";if(!s){this.quickAddInput?.focus();return}this.quickAddInput.value="",this.handleQuickAdd(s)},this.boundQuickAddFormStopVoice=()=>{this.quickAddVoiceListening&&this.stopQuickAddVoiceRecognition()},this.boundVoiceButtonClick=()=>{this.quickAddVoiceRecognition&&(this.quickAddVoiceListening?this.stopQuickAddVoiceRecognition():this.startQuickAddVoiceRecognition())},this.boundPageHide=()=>{this.quickAddVoiceListening&&this.stopQuickAddVoiceRecognition()},this.boundTaskContainerChange=n=>{let s=n.target;if(!(s instanceof this.window.HTMLInputElement)||s.type!=="checkbox")return;let i=s.getAttribute("data-task-id");i&&this.completeTask(i,s.checked)},this.boundTaskContainerClick=n=>{let s=n.target instanceof this.window.HTMLElement?n.target:null;if(!s)return;let i=s.closest("[data-task-id]");if(!i)return;let a=i.getAttribute("data-task-id");if(!a)return;let o=s.getAttribute("data-action");if(o==="cycle-priority"){this.cycleTaskPriority(a);return}if(o==="delete-task"){this.deleteTask(a);return}},this.boundUndoClick=()=>{this.undoLastAction()},this.init()}init(){this.setupStatsElement(),this.setupUndoButton(),this.setupEventListeners(),this.initialiseQuickAddVoiceRecognition(),this.loadDailyTasks()}setupStatsElement(){if(!this.dailyTasksContainer||!this.document||this.statsElement)return;let e=this.document.createElement("div");e.className="text-sm text-base-content/70 mb-2 flex items-center gap-3",e.dataset.role="daily-task-stats",e.textContent="No tasks yet",this.dailyTasksContainer.insertAdjacentElement("beforebegin",e),this.statsElement=e}setupUndoButton(){if(!this.clearCompletedButton||!this.document||this.undoButton)return;let e=this.document.createElement("button");e.type="button",e.className="btn btn-ghost btn-sm ml-2 hidden",e.textContent="Undo",e.setAttribute("aria-label","Undo last daily task action"),this.clearCompletedButton.insertAdjacentElement("afterend",e),this.undoButton=e,this.undoButton.addEventListener("click",this.boundUndoClick)}setupEventListeners(){this.dailyTab?.addEventListener("click",this.boundDailyTabClick),this.cuesTab?.addEventListener("click",this.boundCuesTabClick),this.clearCompletedButton?.addEventListener("click",this.boundClearCompletedClick),this.quickAddForm?.addEventListener("submit",this.boundQuickAddSubmit),this.quickAddForm?.addEventListener("submit",this.boundQuickAddFormStopVoice),this.quickAddVoiceButton?.addEventListener("click",this.boundVoiceButtonClick),this.window?.addEventListener?.("pagehide",this.boundPageHide),this.dailyTasksContainer?.addEventListener("change",this.boundTaskContainerChange),this.dailyTasksContainer?.addEventListener("click",this.boundTaskContainerClick)}cleanup(){this.dailyTab?.removeEventListener("click",this.boundDailyTabClick),this.cuesTab?.removeEventListener("click",this.boundCuesTabClick),this.clearCompletedButton?.removeEventListener("click",this.boundClearCompletedClick),this.quickAddForm?.removeEventListener("submit",this.boundQuickAddSubmit),this.quickAddForm?.removeEventListener("submit",this.boundQuickAddFormStopVoice),this.quickAddVoiceButton?.removeEventListener("click",this.boundVoiceButtonClick),this.window?.removeEventListener?.("pagehide",this.boundPageHide),this.dailyTasksContainer?.removeEventListener("change",this.boundTaskContainerChange),this.dailyTasksContainer?.removeEventListener("click",this.boundTaskContainerClick),this.undoButton?.removeEventListener("click",this.boundUndoClick),this.stopQuickAddVoiceRecognition(),this.window?.clearTimeout?.(this.quickAddVoiceRestartTimer)}activateTab(e){[this.cuesTab,this.dailyTab].filter(Boolean).forEach(s=>{let i=s;if(!i)return;let a=s===e;i.classList.toggle("tab-active",a),i.setAttribute("aria-selected",a?"true":"false")})}switchToDailyView(){this.dailyView&&(this.cuesView?.classList.add("hidden"),this.dailyView.classList.remove("hidden"),this.activateTab(this.dailyTab??null),this.loadDailyTasks())}switchToCuesView(){!this.cuesView||!this.dailyView||(this.cuesView.classList.remove("hidden"),this.dailyView.classList.add("hidden"),this.activateTab(this.cuesTab??null))}setQuickAddVoiceButtonActive(e){let n=this.quickAddVoiceButton;if(!n)return;n.setAttribute("aria-pressed",e?"true":"false");let s=n.querySelector('[aria-hidden="true"]');if(s){s.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F";return}n.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}scheduleQuickAddVoiceRestart(){this.quickAddVoiceListening&&(this.window?.clearTimeout?.(this.quickAddVoiceRestartTimer),this.quickAddVoiceRestartTimer=this.window?.setTimeout?.(()=>{this.quickAddVoiceRestartTimer=null,this.quickAddVoiceListening&&this.startQuickAddVoiceRecognition(!0)},400))}startQuickAddVoiceRecognition(e=!1){if(!this.quickAddVoiceRecognition)return!1;if(this.quickAddVoiceListening&&!e)return!0;try{return this.quickAddVoiceRecognition.start(),this.quickAddVoiceListening=!0,this.setQuickAddVoiceButtonActive(!0),!0}catch{return this.quickAddVoiceListening=!1,this.setQuickAddVoiceButtonActive(!1),!1}}stopQuickAddVoiceRecognition(){if(this.quickAddVoiceRecognition){this.quickAddVoiceListening=!1,this.window?.clearTimeout?.(this.quickAddVoiceRestartTimer);try{this.quickAddVoiceRecognition.stop()}catch{}this.setQuickAddVoiceButtonActive(!1)}}initialiseQuickAddVoiceRecognition(){let e=this.quickAddVoiceButton;if(!(!e||!this.window))try{let n=this.window.SpeechRecognition||this.window.webkitSpeechRecognition||this.window.mozSpeechRecognition||this.window.msSpeechRecognition;if(!n){e.setAttribute("disabled","true"),e.setAttribute("aria-disabled","true"),e.title="Voice input is not supported in this browser.";return}this.quickAddVoiceRecognition=new n;let s=this.document?.documentElement?.lang||this.window.navigator?.language||"en-AU";if(this.quickAddVoiceRecognition.lang=s,this.quickAddVoiceRecognition.interimResults=!1,"continuous"in this.quickAddVoiceRecognition)try{this.quickAddVoiceRecognition.continuous=!0}catch{}this.quickAddVoiceRecognition.onresult=i=>{let a=i?.results?.[0]?.[0]?.transcript||"";if(a&&this.quickAddInput){this.quickAddInput.value=a.trim();try{this.quickAddInput.focus({preventScroll:!0})}catch{this.quickAddInput.focus()}try{let o=this.quickAddInput.value.length;this.quickAddInput.setSelectionRange(o,o)}catch{}}},this.quickAddVoiceRecognition.onend=()=>{if(!this.quickAddVoiceListening){this.setQuickAddVoiceButtonActive(!1);return}this.scheduleQuickAddVoiceRestart()},this.quickAddVoiceRecognition.onerror=()=>{this.quickAddVoiceListening=!1,this.setQuickAddVoiceButtonActive(!1)}}catch{this.quickAddVoiceRecognition=null,this.setQuickAddVoiceButtonActive(!1),e.setAttribute("disabled","true"),e.setAttribute("aria-disabled","true")}}showPermissionNotice(){this.dailyListPermissionNotice?.classList.remove("hidden")}hidePermissionNotice(){this.dailyListPermissionNotice?.classList.add("hidden")}updateClearCompletedButtonState(){if(!this.clearCompletedButton)return;let e=this.tasks.some(n=>!!n?.completed);this.clearCompletedButton.disabled=!e}updateStats(){if(!this.statsElement)return;if(!this.tasks.length){this.statsElement.textContent="No tasks yet";return}let e=this.tasks.filter(i=>i.completed).length,n=this.tasks.length-e,s=this.tasks.reduce((i,a)=>i+(a.timeTrackedMs||0),0);this.statsElement.textContent=`Tasks: ${this.tasks.length} \u2022 Completed: ${e} \u2022 Remaining: ${n} \u2022 Tracked: ${dt(s)}`}renderDailyTasks(){if(!this.dailyTasksContainer)return;if(!Array.isArray(this.tasks)||this.tasks.length===0){this.dailyTasksContainer.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',this.updateClearCompletedButtonState(),this.updateStats();return}let n=[...this.tasks].sort((s,i)=>{let a=ue.indexOf(s.priority)-ue.indexOf(i.priority);return a!==0?a:s.createdAt-i.createdAt}).map(s=>{let i=g(s.text||""),a=!!s.completed,o=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];a&&o.push("line-through","text-opacity-50");let l=vs[s.priority]??"Medium",c=[`Priority: ${l}`,`Category: ${g(s.category)}`];if(s.completedAt){let u=Math.max(0,s.completedAt-s.createdAt);c.push(`Time: ${dt(u)}`)}else s.estimateMs&&c.push(`Estimate: ${dt(s.estimateMs)}`);return`
        <div class="flex flex-col gap-1 p-3 border-b border-base-200" data-task-id="${s.id}">
          <div class="flex items-center gap-3">
            <input type="checkbox" class="checkbox checkbox-sm" data-task-id="${s.id}" ${a?"checked":""} />
            <span class="${o.join(" ")}">${i}</span>
          </div>
          <div class="flex items-center gap-3 text-xs text-base-content/70">
            <span>${c.join(" \u2022 ")}</span>
            <button type="button" class="btn btn-ghost btn-xs" data-action="cycle-priority">Priority: ${l}</button>
            <button type="button" class="btn btn-ghost btn-xs" data-action="delete-task">Delete</button>
          </div>
        </div>
      `}).join("");this.dailyTasksContainer.innerHTML=n,this.updateClearCompletedButtonState(),this.updateStats()}async loadDailyTasks(){if(!this.dailyListHeader||!this.dailyTasksContainer)return[];let e=ct();this.todayId=e;let n=Ls(e);if(this.dailyListHeader.textContent=n?`Today's List - ${n}`:"Today's List",this.shouldUseLocalDailyList){this.showPermissionNotice();let s=this.getLocalDailyTasks(e);return this.tasks=s,this.renderDailyTasks(),s}return this.dailyListLoadPromise||(this.dailyTasksContainer.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',this.updateClearCompletedButtonState(),this.dailyListLoadPromise=(async()=>{try{let s=await this.ensureDailyListFirestore();if(!s){this.shouldUseLocalDailyList=!0,this.showPermissionNotice();let l=this.getLocalDailyTasks(e);this.tasks=l,this.renderDailyTasks();return}let i=this.getDailyListDocRef(s,e),a=await s.getDoc(i),o=a.exists()?a.data()?.tasks:[];this.tasks=ye(o),this.renderDailyTasks(),this.setLocalDailyTasks(e,this.tasks),this.shouldUseLocalDailyList=!1,this.hidePermissionNotice()}catch(s){if(this.isPermissionDeniedError(s)){console.warn("Falling back to local daily tasks due to permission issue",s),this.shouldUseLocalDailyList=!0,this.showPermissionNotice();let i=this.getLocalDailyTasks(e);this.tasks=i,this.renderDailyTasks();return}console.error("Failed to load daily list",s),this.dailyTasksContainer.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',this.tasks=[],this.updateClearCompletedButtonState(),this.updateStats()}})().finally(()=>{this.dailyListLoadPromise=null})),await this.dailyListLoadPromise,this.tasks}async ensureDailyListFirestore(){return this.ensureCueFirestore?this.firestoreDailyListContextPromise?this.firestoreDailyListContextPromise:(this.firestoreDailyListContextPromise=this.ensureCueFirestore().then(e=>{let{db:n,getCollection:s}=e??{},i=typeof s=="function"&&n?s(n,"dailyLists"):null;return{...e,dailyListsCollection:i}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),this.firestoreDailyListContextPromise):null}getDailyListDocRef(e,n){let{doc:s,dailyListsCollection:i,db:a}=e??{};if(typeof s!="function")throw new Error("Firestore document helper is unavailable");return i?s(i,n):s(a,"dailyLists",n)}isPermissionDeniedError(e){let n=typeof e?.code=="string"?e.code.toLowerCase():"";if(n)return n.includes("permission-denied")||n.includes("insufficient-permission");let s=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(s&&s.includes("permission"))}getLocalDailyTasks(e){let n=this.readDailyTaskStorage(),s=n&&typeof n=="object"?n[e]:[];return ye(s)}setLocalDailyTasks(e,n){let s=this.readDailyTaskStorage(),i=ye(n);return s[e]=i,this.writeDailyTaskStorage(s),i}readDailyTaskStorage(){if(!this.storage||typeof this.storage.getItem!="function")return{};try{let e=this.storage.getItem(dn);if(!e)return{};let n=JSON.parse(e);return n&&typeof n=="object"?n:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}writeDailyTaskStorage(e){if(!(!this.storage||typeof this.storage.setItem!="function"))try{let n=e&&typeof e=="object"?e:{};this.storage.setItem(dn,JSON.stringify(n))}catch(n){console.warn("Unable to persist daily tasks locally",n)}}async handleQuickAdd(e){let{text:n,priority:s,category:i,estimateMs:a}=ws(e);if(!n){this.quickAddInput?.focus();return}let o={text:n,completed:!1,priority:s,category:i,estimateMs:a};this.quickAddInput&&(this.quickAddInput.value="",this.quickAddInput.focus());try{await this.addDailyTask(o)}catch(l){console.error("Failed to add task to the daily list",l),this.quickAddInput&&(this.quickAddInput.value=e,this.quickAddInput.focus())}}async addDailyTask(e){let n=un(e),s=[...this.tasks];this.tasks=[...this.tasks,n],this.renderDailyTasks();try{return await this.saveDailyTasks(this.tasks),n}catch(i){throw console.error("Failed to persist new daily task",i),this.tasks=s,this.renderDailyTasks(),i}}async completeTask(e,n){let s=this.tasks.map(a=>({...a})),i=!1;if(this.tasks=this.tasks.map(a=>{if(a.id!==e)return a;i=!0;let o=n?Date.now():null;return{...a,completed:n,completedAt:o,timeTrackedMs:n?Math.max(0,(o??Date.now())-a.createdAt):0}}),!!i){this.renderDailyTasks();try{await this.saveDailyTasks(this.tasks)}catch(a){console.error("Failed to update task completion state",a),this.tasks=s,this.renderDailyTasks()}}}async clearCompleted(){if(!this.tasks.length)return;let e=this.tasks.filter(s=>!s.completed);if(e.length===this.tasks.length)return;this.pushUndoState();let n=this.tasks;this.tasks=e,this.renderDailyTasks();try{await this.saveDailyTasks(this.tasks)}catch(s){console.error("Failed to clear completed tasks",s),this.tasks=n,this.renderDailyTasks(),this.popUndoState()}}cycleTaskPriority(e){let n=this.tasks.findIndex(o=>o.id===e);if(n===-1)return;let s=this.tasks[n],i=ue.indexOf(s.priority),a=ue[(i+1)%ue.length];this.tasks=this.tasks.map(o=>o.id===e?{...o,priority:a}:o),this.renderDailyTasks(),this.saveDailyTasks(this.tasks)}deleteTask(e){this.tasks.find(s=>s.id===e)&&(this.pushUndoState(),this.tasks=this.tasks.filter(s=>s.id!==e),this.renderDailyTasks(),this.saveDailyTasks(this.tasks).catch(s=>{console.error("Failed to delete daily task",s),this.undoLastAction()}))}pushUndoState(){this.undoStack.push({tasks:this.tasks.map(e=>({...e}))}),this.updateUndoButton()}popUndoState(){let e=this.undoStack.pop();return this.updateUndoButton(),e}undoLastAction(){let e=this.popUndoState();e&&(this.tasks=ye(e.tasks),this.renderDailyTasks(),this.saveDailyTasks(this.tasks))}updateUndoButton(){this.undoButton&&(this.undoStack.length?this.undoButton.classList.remove("hidden"):this.undoButton.classList.add("hidden"))}readTodayId(){return this.todayId||ct()}async saveDailyTasks(e){let n=this.readTodayId(),s=ye(e);if(this.shouldUseLocalDailyList){this.setLocalDailyTasks(n,s);return}try{let i=await this.ensureDailyListFirestore();if(!i){this.setLocalDailyTasks(n,s);return}let a=this.getDailyListDocRef(i,n);typeof i.setDoc=="function"?await i.setDoc(a,{tasks:s},{merge:!0}):await i.updateDoc(a,{tasks:s}),this.setLocalDailyTasks(n,s)}catch(i){if(this.isPermissionDeniedError(i)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",i),this.shouldUseLocalDailyList=!0,this.showPermissionNotice(),this.setLocalDailyTasks(n,s);return}throw i}}}});var ha=ps(()=>{hs();ys();rt();ln();fn();en();function Ss(){if(typeof document>"u")return;let t=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),e=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!n)return;let s=document.querySelectorAll("[data-open-reminder-modal]");if(!s.length)return;if(!t){let p=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};s.forEach(y=>{y.addEventListener("click",w=>{if(w.preventDefault(),typeof window<"u"){let H="#reminders";window.location.hash!==H&&(window.location.hash=H),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{p()})})});return}let i=t.querySelector("[data-reminder-modal-backdrop]"),a=t.querySelectorAll("[data-close-modal]"),o=document.getElementById("mainContent"),l=document.querySelector('nav[aria-label="Primary"]'),c=[o,l],u=t.querySelector('[role="dialog"]')??t,d=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],h=null,v=()=>{if(!(u instanceof HTMLElement))return[];let p=u.querySelectorAll(d.join(","));return Array.from(p).filter(y=>{let w=y instanceof HTMLElement,H=typeof SVGElement<"u"&&y instanceof SVGElement;if(!w&&!H||y.getAttribute("aria-hidden")==="true"||"disabled"in y&&y.disabled||y.hidden||y.closest("[hidden]"))return!1;let k=y.getBoundingClientRect();return k.width>0&&k.height>0})},b=()=>{let p=v(),y=p.find(w=>w.hasAttribute("data-autofocus")||w.hasAttribute("autofocus"))||(n&&p.includes(n)?n:null)||p[0];if(y&&typeof y.focus=="function"){y.focus({preventScroll:!0});return}u instanceof HTMLElement&&typeof u.focus=="function"&&u.focus({preventScroll:!0})},L=p=>{u instanceof HTMLElement&&(!(p.target instanceof Node)||!u.contains(p.target))&&(p.stopPropagation(),b())},C=p=>{if(p.key!=="Tab")return;let y=v();if(!y.length){p.preventDefault(),u instanceof HTMLElement&&u.focus({preventScroll:!0});return}let w=y[0],H=y[y.length-1],k=document.activeElement;if(p.shiftKey){(!u.contains(k)||k===w)&&(p.preventDefault(),H.focus());return}(!u.contains(k)||k===H)&&(p.preventDefault(),w.focus())},q=p=>{c.forEach(y=>{y&&(p?y.setAttribute("inert",""):y.removeAttribute("inert"))})},M=()=>{t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""),q(!1),document.removeEventListener("keydown",N,!0),t.removeEventListener("keydown",C,!0),t.removeEventListener("focusin",L,!0),h&&typeof h.focus=="function"&&h.focus(),h=null},N=p=>{p.key==="Escape"&&(p.preventDefault(),M())},U=({triggerElement:p}={})=>{p&&typeof p.focus=="function"?h=p:h=document.activeElement,t.classList.remove("hidden"),t.removeAttribute("aria-hidden"),t.removeAttribute("inert"),q(!0),document.addEventListener("keydown",N,!0),t.addEventListener("keydown",C,!0),t.addEventListener("focusin",L,!0),window.requestAnimationFrame(()=>{b()})},_=(p,y={})=>{try{document.dispatchEvent(new CustomEvent(p,{detail:y}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let w=document.createEvent("CustomEvent");w.initCustomEvent(p,!0,!0,y),document.dispatchEvent(w)}}},B=(p={})=>{_("cue:cancelled",p)};s.forEach(p=>{p.addEventListener("click",y=>{y.preventDefault();let H={trigger:y.currentTarget instanceof HTMLElement?y.currentTarget:null,mode:"create"};_("cue:prepare",H),_("cue:open",H)})}),a.forEach(p=>{p.addEventListener("click",y=>{y.preventDefault(),B({trigger:p,reason:"button"})})}),t.addEventListener("click",p=>{p.target===t&&B({reason:"backdrop"})}),i?.addEventListener("click",p=>{p.target===i&&B({reason:"backdrop"})}),document.addEventListener("cue:open",p=>{let y=p?.detail?.trigger,w=y instanceof HTMLElement?y:null;U({triggerElement:w})});let F=()=>{M()};document.addEventListener("cue:close",F),document.addEventListener("cue:cancelled",F);let P=t.querySelector("#saveReminder");e instanceof HTMLFormElement&&P instanceof HTMLElement&&e.addEventListener("submit",p=>{p.preventDefault(),!P.matches(":disabled")&&P.click()}),P instanceof HTMLElement&&document.addEventListener("reminder:save",p=>{let y=p?.detail?.trigger;y&&y!==P||P.matches(":disabled")||P.click()})}Ss();function mt(t,e={}){if(!(typeof document>"u"||!t))try{document.dispatchEvent(new CustomEvent(t,{detail:e}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(t,!0,!0,e),document.dispatchEvent(n)}}}var pn=null;function xs(t){return!t||typeof document>"u"?null:document.querySelector(`[data-route="${t}"]`)}function As(){if(typeof window>"u")return"";let t=window.location.hash||"#dashboard";return(t.startsWith("#")?t.slice(1):t)||"dashboard"}function Cs(t){typeof document>"u"||!t||(window.clearTimeout(pn),pn=window.setTimeout(()=>{let e=xs(t);if(!e)return;let n=e.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Te(t){let e=t||As();e&&Cs(e)}function Is(){if(typeof document>"u"||typeof window>"u")return;let t=()=>{Te()};window.addEventListener("hashchange",t),window.addEventListener("DOMContentLoaded",t),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",s=>{if(!(s.currentTarget instanceof HTMLAnchorElement))return;let i=s.currentTarget.getAttribute("href")||"";if(!i.startsWith("#"))return;s.preventDefault();let a=i||"#dashboard",o=a.replace("#","")||"dashboard";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Te(o)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Te()}Is();var hn=document.getElementById("settings-save-button"),Be=document.getElementById("settings-save-confirmation"),$=document.getElementById("live-status"),ft=null,se=document.getElementById("resourcePlannerStatus"),pt=null;document.addEventListener("planner:reminderCreated",t=>{if(!$)return;let e=t?.detail||{},n=typeof e.lessonTitle=="string"&&e.lessonTitle.trim()?e.lessonTitle.trim():"",s=typeof e.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():"",i=s?`Reminder saved for ${s}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";$.textContent=i});hn&&Be&&hn.addEventListener("click",t=>{t.preventDefault(),Be.classList.remove("hidden"),Be.textContent="Settings saved!",$&&($.textContent="Settings saved!"),ft&&window.clearTimeout(ft),ft=window.setTimeout(()=>{Be.classList.add("hidden")},3e3)});function Ds(t){if(typeof window>"u")return;t.preventDefault();let e="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Te(e),$&&($.textContent="Opening planner to add a new lesson."),Vt(),window.requestAnimationFrame(()=>{let s=ns();s&&typeof s.catch=="function"&&s.catch(i=>{console.error("Planner quick action failed to start new lesson flow",i)})})}function Ms(){if(typeof document>"u")return;let t=document.querySelectorAll('[data-quick-action="planner"]');t.length&&t.forEach(e=>{e.addEventListener("click",Ds)})}Ms();function ht(t,{tone:e="success"}={}){se&&(se.textContent=t,se.classList.remove("hidden"),se.classList.remove("text-success","text-error"),se.classList.add(e==="error"?"text-error":"text-success"),typeof window<"u"&&(pt&&window.clearTimeout(pt),pt=window.setTimeout(()=>{se.classList.add("hidden"),se.textContent=""},4e3))),$&&($.textContent=t)}function Ft(t="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${t}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function Bs(t){if(typeof document>"u"||typeof window>"u")return;t.preventDefault();let e=t.currentTarget instanceof Element?t.currentTarget:t.target instanceof Element?t.target.closest("[data-resource-planner]"):null;if(!e)return;let n=e.closest("[data-resource-title][data-resource-link]");if(!n)return;let s=n.getAttribute("data-resource-title")?.trim(),i=n.getAttribute("data-resource-link")?.trim();if(!s||!i)return;let a="#planner";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Te("planner"),Vt(),await et();let o=`${s} \u2014 ${i}`,l=Vi(),c=null;try{if(l)c=await addLessonDetail(f,l,{badge:"Resource",text:o});else{let u=Ft("lesson"),d=T?.lessons?.[0]?.dayLabel||"Monday";c=await addLessonToWeek(f,{id:u,dayName:d,title:s,summary:`Resource link: ${i}`,details:[{badge:"Resource",text:o}]}),c&&(A=u)}if(c){T=c,D(c),R(c,f);let u=l?`Added "${s}" to your selected lesson.`:`Created a lesson for "${s}" in this week's planner.`;ht(u);return}ht("Unable to save that resource to the planner right now.",{tone:"error"})}catch(u){console.error("Failed to save resource to planner",u),ht("Unable to save that resource to the planner right now.",{tone:"error"})}}function Ns(){if(typeof document>"u")return;let t=document.querySelectorAll("[data-resource-planner]");t.length&&t.forEach(e=>{e.addEventListener("click",Bs)})}Ns();var Nn=document.getElementById("reminder-title"),Fs=document.getElementById("reminderText"),z=(()=>{let t=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(t instanceof HTMLElement))return null;let e=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),s=t.querySelector(".modal-backdrop button"),i=document.getElementById("modal-title");return rn({modalElement:t,openButton:e instanceof HTMLElement?e:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:s instanceof HTMLElement?s:null,titleInput:Nn,modalTitle:i instanceof HTMLElement?i:null,defaultTitle:at,editTitle:ot})})();z?.setEditMode(!1);var Ps=()=>{let t=!!Nn;if(!!Fs)return Me({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return t?Me(n):Me({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Ps().catch(t=>{console.error("Failed to initialise reminders",t)});var Lt=initNotesSync(),yt=initSupabaseAuth({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:t=>{Lt?.handleSessionChange(t)}});if(yt?.supabase){Lt?.setSupabaseClient(yt.supabase);try{yt.supabase.auth.getSession().then(({data:t})=>{Lt?.handleSessionChange(t?.session?.user??null)}).catch(()=>{})}catch{}}var G=document.getElementById("cues-list"),bt=document.getElementById("pinnedNotesCard"),pe=document.getElementById("pinnedNotesList"),ae=document.getElementById("cue-form"),W=ae?.querySelector("#cue-id-input"),Hs=z?.defaultTitle||z?.modalTitle?.textContent?.trim()||at,Sa=z?.editTitle||ot,Rs=document.getElementById("tab-cues"),$s=document.getElementById("tab-daily"),qs=document.getElementById("cues-view"),Vs=document.getElementById("daily-list-view"),_s=document.getElementById("daily-list-header"),Os=document.getElementById("quick-add-form"),Us=document.getElementById("quick-add-input"),js=document.getElementById("daily-voice-btn"),Ws=document.getElementById("daily-tasks-container"),zs=document.getElementById("clear-completed-btn"),Qs=document.getElementById("daily-list-permission-notice"),x=document.getElementById("plannerCards")||document.getElementById("planner-grid"),yn=document.getElementById("plannerWeekRange"),Ks=document.getElementById("planner-prev"),Ys=document.getElementById("planner-next"),Gs=document.getElementById("planner-today"),Xs=document.getElementById("planner-copy-week"),Zs=document.getElementById("planner-clear-week"),Js=document.getElementById("planner-duplicate-btn"),ei=document.getElementById("planner-new-lesson-btn"),wt=document.getElementById("planner-list-view-toggle"),St=document.getElementById("planner-week-view-toggle"),ke=document.getElementById("plannerWeekView"),Oe=document.querySelector("[data-planner-text-size]"),gt=document.querySelector("[data-planner-card-panel]"),bn=document.getElementById("plannerSummaryCount"),Ue=document.getElementById("plannerSummaryRange"),gn=document.getElementById("plannerInsightsLessons"),En=document.getElementById("plannerInsightsSubjects"),Tn=document.getElementById("plannerInsightsNotes"),J=document.getElementById("plannerTeacherNotes"),Et=document.getElementById("plannerTeacherNotesStatus"),O=document.getElementById("planner-lesson-timetable"),xa=document.getElementById("timetable-form"),Aa=document.getElementById("timetable-list"),Ca=document.getElementById("timetable-day"),Ia=document.getElementById("timetable-period"),Da=document.getElementById("timetable-class"),Ma=document.getElementById("timetable-subject"),Ba=document.getElementById("timetable-submit"),Na=document.getElementById("timetable-reset"),Ne=document.querySelector("[data-mobile-notes-text-size]"),Tt=document.querySelector(".mobile-panel--notes"),Fn="plannerTextSizePreference",je="default",Ge=new Set(["small","default","large"]),ti=["planner-text-small","planner-text-default","planner-text-large"],Pn="mobileNotesTextSizePreference",We="default",Xe=new Set(["small","default","large"]),ni=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function xt(t){return typeof HTMLSelectElement<"u"&&t instanceof HTMLSelectElement}function si(){if(typeof localStorage>"u")return je;let t=localStorage.getItem(Fn);return t&&Ge.has(t)?t:je}function ii(t){typeof localStorage>"u"||!Ge.has(t)||localStorage.setItem(Fn,t)}function Hn(t){if(!gt)return;let e=Ge.has(t)?t:je;ti.forEach(n=>gt.classList.remove(n)),gt.classList.add(`planner-text-${e}`)}var Rn=si();Hn(Rn);xt(Oe)&&(Oe.value=Rn);function $n(){if(typeof localStorage>"u")return We;let t=localStorage.getItem(Pn);return t&&Xe.has(t)?t:We}function ai(t){typeof localStorage>"u"||!Xe.has(t)||localStorage.setItem(Pn,t)}function qn(t){if(!Tt)return;let e=Xe.has(t)?t:We;ni.forEach(n=>Tt.classList.remove(n)),Tt.classList.add(`mobile-panel--notes-size-${e}`)}var Vn=$n();qn(Vn);Ne instanceof HTMLSelectElement&&(Ne.value=Vn,Ne.addEventListener("change",t=>{let e=typeof t.target?.value=="string"?t.target.value:We;if(!Xe.has(e)){Ne.value=$n();return}ai(e),qn(e)}));var oi=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function ri(t){if(t&&Number.isFinite(t.dayIndex))return t.dayIndex;let e=typeof t?.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():typeof t?.dayName=="string"&&t.dayName.trim()?t.dayName.trim():"";if(!e)return 0;let n=oi.findIndex(s=>s.toLowerCase()===e.toLowerCase());return n>=0?n:0}function li(t){if(!(t instanceof Date)||Number.isNaN(t.getTime()))return"";let e=String(t.getFullYear()).padStart(4,"0"),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${s}`}function di(t){if(!t)return"";let e=[],n=typeof t.day=="string"?t.day.trim():"",s=typeof t.period=="string"?t.period.trim():"",i=typeof t.className=="string"?t.className.trim():"";return n&&e.push(n.charAt(0).toUpperCase()+n.slice(1)),s&&e.push(s),i&&e.push(i),e.join(" \u2013 ")}function ze(t){return Number.isFinite(t)?t<0?0:t>6?6:t:1}function Qe(t){if(typeof t!="string")return"Monday";let e=t.trim();return e?e.charAt(0).toUpperCase()+e.slice(1):"Monday"}function kt(t=""){if(!(O instanceof HTMLSelectElement))return;let e=['<option value="">No timetable link</option>'];Ht.forEach(n=>{let s=di(n)||"Timetable slot",i=t&&n.id===t?"selected":"";e.push(`<option value="${n.id}" ${i}>${g(s)}</option>`)}),O.innerHTML=e.join(""),t&&O.value!==t&&(O.value=t)}function ci(){if(typeof document>"u")return null;let t=document.getElementById("planner-lesson-modal"),e=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),s=document.getElementById("planner-modal-description"),i=document.getElementById("planner-modal-error"),a=document.getElementById("planner-modal-submit"),o=document.getElementById("planner-modal-submit-add-another"),l=document.getElementById("planner-lesson-day"),c=document.getElementById("planner-lesson-period"),u=document.getElementById("planner-lesson-title"),d=document.getElementById("planner-lesson-summary"),h=document.getElementById("planner-lesson-subject"),v=document.getElementById("planner-lesson-status"),b=document.getElementById("planner-detail-badge"),L=document.getElementById("planner-detail-text"),C=document.getElementById("planner-duplicate-week"),q=e?.querySelectorAll("[data-summary-template]")||[];if(!(t instanceof HTMLElement)||!(e instanceof HTMLFormElement)||!(a instanceof HTMLElement)||!(l instanceof HTMLSelectElement)||!(c instanceof HTMLInputElement)||!(u instanceof HTMLInputElement)||!(d instanceof HTMLTextAreaElement)||!(v instanceof HTMLSelectElement))return null;let M=e.querySelector("[data-planner-lesson-section]"),N=e.querySelector("[data-planner-summary-section]"),U=e.querySelector("[data-planner-detail-section]"),_=e.querySelector("[data-planner-duplicate-section]"),B=t.querySelector("[data-planner-modal-dialog]"),F=t.querySelector("[data-planner-modal-backdrop]"),P=t.querySelectorAll("[data-planner-modal-close]"),p=document.getElementById("mainContent"),y=document.querySelector('nav[aria-label="Primary"]'),w=(()=>{let r=[],m=t.parentElement;return y instanceof HTMLElement&&r.push(y),m instanceof HTMLElement?r.push(...Array.from(m.children).filter(E=>E instanceof HTMLElement&&E!==t)):p instanceof HTMLElement&&(p.contains(t)?r.push(...Array.from(p.children).filter(E=>E instanceof HTMLElement&&!E.contains(t))):r.push(p)),r})(),H=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],k={mode:"add",lessonId:null,trigger:null},oe=null,re=null,tt="",_t="",X="simple",we="save",ne=r=>{oe=r instanceof HTMLElement?r:null},Ot=r=>{we=r},he=r=>{if(!(v instanceof HTMLSelectElement))return;let m=V[r]?r:"not_started";v.value=m},Se=r=>{let m=typeof r=="string"&&r.trim()?r.trim():"Monday";l.value=m,l.value!==m&&(l.value="Monday")},rs=r=>{let m=ts(r||"simple");!m||typeof d.value=="string"&&d.value.trim()&&!window.confirm("Replace existing summary with this template?")||(d.value=m,X=r||"simple",d.focus())},Ut=r=>{w.forEach(m=>{m&&(r?m.setAttribute("inert",""):m.removeAttribute("inert"))})},jt=()=>{if(!(B instanceof HTMLElement))return[];let r=B.querySelectorAll(H.join(","));return Array.from(r).filter(m=>{if(m.closest('[aria-hidden="true"]')||"disabled"in m&&m.disabled)return!1;let E=m.getBoundingClientRect();return E.width>0&&E.height>0})},Wt=()=>{let r=jt(),m=(oe&&r.includes(oe)?oe:null)||r[0]||B;m&&typeof m.focus=="function"&&m.focus({preventScroll:!0})},zt=r=>{B instanceof HTMLElement&&(B.contains(r.target)||Wt())},ls=r=>{if(r.key!=="Tab")return;let m=jt();if(!m.length){r.preventDefault();return}let E=m[0],j=m[m.length-1];if(r.shiftKey&&document.activeElement===E){r.preventDefault(),j.focus();return}!r.shiftKey&&document.activeElement===j&&(r.preventDefault(),E.focus())},Qt=r=>{if(r.key==="Escape"){r.preventDefault(),Q();return}ls(r)},Kt=()=>{i&&(i.textContent="",i.classList.add("hidden"),i.setAttribute("aria-hidden","true"))},Z=r=>{i&&(i.textContent=r,i.classList.remove("hidden"),i.removeAttribute("aria-hidden"))},Yt=r=>{a.disabled=!!r,a.classList.toggle("loading",!!r),o instanceof HTMLButtonElement&&(o.disabled=!!r,o.classList.toggle("loading",!!r))},I=(r,m)=>{r instanceof HTMLElement&&(r.classList.toggle("hidden",!m),m?r.removeAttribute("aria-hidden"):r.setAttribute("aria-hidden","true"))},xe=r=>{[l,c,u,d,h,v,O].forEach(m=>{m instanceof HTMLElement&&(m.disabled=!!r,m.classList.toggle("opacity-60",!!r),m.classList.toggle("cursor-not-allowed",!!r))}),q.forEach(m=>{m instanceof HTMLButtonElement&&(m.disabled=!!r,m.classList.toggle("opacity-60",!!r),m.classList.toggle("cursor-not-allowed",!!r))})},le=()=>{e.reset(),Kt(),ne(null),xe(!1),kt(""),O instanceof HTMLSelectElement&&(O.value=""),h instanceof HTMLInputElement&&(h.value=""),c instanceof HTMLInputElement&&(c.value=""),b instanceof HTMLInputElement&&(b.value=""),(L instanceof HTMLTextAreaElement||L instanceof HTMLInputElement)&&(L.value=""),C instanceof HTMLInputElement&&(C.value=""),he("not_started"),X="simple",we="save"},Ae=({title:r,description:m,action:E})=>{n&&(n.textContent=r||"Plan lesson"),s&&(s.textContent=m||""),a.textContent=E||"Save lesson"},Ce=({trigger:r}={})=>{k.trigger=r instanceof HTMLElement?r:null,re=k.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),t.classList.remove("hidden"),t.removeAttribute("aria-hidden"),t.removeAttribute("inert"),Ut(!0),document.addEventListener("keydown",Qt,!0),t.addEventListener("focusin",zt,!0),window.requestAnimationFrame(()=>{Wt()})},Q=()=>{t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""),Ut(!1),document.removeEventListener("keydown",Qt,!0),t.removeEventListener("focusin",zt,!0);let r=k.trigger||re;k.mode="add",k.lessonId=null,k.trigger=null,ne(null),le(),r&&typeof r.focus=="function"&&r.focus({preventScroll:!0})},ds=({defaultDay:r="Monday",trigger:m,timetableEntry:E}={})=>{k.mode="add",k.lessonId=null,le(),I(M,!0),I(N,!0),I(U,!1),I(_,!1),xe(!1);let j=typeof E?.day=="string"&&E.day.trim()?E.day.charAt(0).toUpperCase()+E.day.slice(1):typeof r=="string"&&r.trim()?r.trim():"Monday";Se(j),u.value=E?.className&&E.className.trim()||(j?`${j} lesson`:""),d.value="",c instanceof HTMLInputElement&&(c.value=E?.period||""),h instanceof HTMLInputElement&&(h.value=E?.subject||""),kt(E?.id||""),he("not_started"),X="simple",Ae({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),ne(u),Ce({trigger:m})},cs=({lesson:r,trigger:m}={})=>{if(!r)return;k.mode="edit",k.lessonId=r.id,le(),I(M,!0),I(N,!0),I(U,!1),I(_,!1),xe(!1);let E=r.dayLabel||r.dayName||"Monday";Se(E),u.value=r.title||"",d.value=r.summary||"",c instanceof HTMLInputElement&&(c.value=r.period||""),h instanceof HTMLInputElement&&(h.value=r.subject||""),kt(r.timetableEntryId||""),O instanceof HTMLSelectElement&&(O.value=r.timetableEntryId||""),he(r.status||"not_started"),X=r.templateType||"simple",Ae({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),ne(u),Ce({trigger:m})},us=({lesson:r,trigger:m}={})=>{if(!r)return;k.mode="detail",k.lessonId=r.id,le(),I(M,!0),I(N,!0),I(U,!0),I(_,!1),xe(!0);let E=r.dayLabel||r.dayName||"Monday";Se(E),u.value=r.title||"",d.value=r.summary||"",c instanceof HTMLInputElement&&(c.value=r.period||""),h instanceof HTMLInputElement&&(h.value=r.subject||""),he(r.status||"not_started"),X=r.templateType||"simple",b instanceof HTMLInputElement&&(b.value=""),(L instanceof HTMLTextAreaElement||L instanceof HTMLInputElement)&&(L.value=""),Ae({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),ne(L instanceof HTMLElement?L:null),Ce({trigger:m})},ms=({suggestedWeekId:r="",trigger:m}={})=>{k.mode="duplicate",k.lessonId=null,le(),I(M,!1),I(N,!1),I(U,!1),I(_,!0),C instanceof HTMLInputElement&&(C.value=r),Ae({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),ne(C instanceof HTMLElement?C:null),Ce({trigger:m})},fs=async r=>{r.preventDefault(),Kt(),Yt(!0);let m=we==="add_another";try{if(k.mode==="duplicate"){let S=C?.value?.trim();if(!S){Z("Enter the Monday date for the destination week.");return}if(S===f){Z("Choose a different week to duplicate into.");return}let de=await duplicateWeekPlan(f,S);de&&(f=S,Gn(S),T=de,D(de),R(de,S),Q());return}if(k.mode==="detail"){if(!k.lessonId){Z("Select a lesson before adding details.");return}let S=L?.value?.trim();if(!S){Z("Add text for this detail.");return}let de=b?.value?.trim()||"",De=await addLessonDetail(f,k.lessonId,{badge:de,text:S});De&&(T=De,D(De),R(De,f),Q());return}let E=l.value.trim(),j=c?.value?.trim()||"",nt=u.value.trim(),Gt=d.value.trim(),st=h?.value?.trim()||"",Xt=V[v?.value]?v.value:"not_started",Zt=O instanceof HTMLSelectElement?O.value:"",Jt=(()=>{let S=getWeekDateForDayIndex(f,1);return S instanceof Date&&!Number.isNaN(S.getTime())?S.toISOString():""})();if(!E){Z("Choose a day for this lesson.");return}if(!nt){Z("Enter a lesson title.");return}if(k.mode==="edit"){if(!k.lessonId){Z("Select a lesson to edit.");return}let S=await updateLessonInWeek(f,k.lessonId,{dayName:E,title:nt,summary:Gt,subject:st,period:j,status:Xt,timetableEntryId:Zt,weekStartDate:Jt,templateType:X||"simple"});S&&(T=S,D(S),R(S,f),Q());return}let Ie=await addLessonToWeek(f,{dayName:E,title:nt,summary:Gt,subject:st,period:j,status:Xt,timetableEntryId:Zt,weekStartDate:Jt,templateType:X||"simple"});Ie&&(T=Ie,D(Ie),R(Ie,f),m?(tt=E,_t=st,le(),Se(tt||"Monday"),u.value=l.value?`${l.value} lesson`:"",h instanceof HTMLInputElement&&(h.value=_t||""),he("not_started"),X="simple",ne(u)):Q())}catch(E){console.error("Failed to save planner change",E),Z("Unable to save changes right now. Please try again.")}finally{Yt(!1),we="save"}};return o instanceof HTMLButtonElement&&o.addEventListener("click",()=>Ot("add_another")),a.addEventListener("click",()=>Ot("save")),q.forEach(r=>{r instanceof HTMLButtonElement&&r.addEventListener("click",m=>{m.preventDefault();let E=r.dataset.summaryTemplate||"simple";rs(E)})}),e.addEventListener("submit",fs),P.forEach(r=>{r.addEventListener("click",m=>{m.preventDefault(),Q()})}),t.addEventListener("click",r=>{r.target===t&&Q()}),F?.addEventListener("click",r=>{r.target===F&&Q()}),{openAddLesson:ds,openEditLesson:cs,openAddDetail:us,openDuplicatePlan:ms,close:Q}}var kn=document.getElementById("remindersCount"),ee=typeof document<"u"?ci():null,vn=document.getElementById("plannerCount"),Ln=document.getElementById("plannerSubtitle"),Fa=document.getElementById("resourcesCount"),Pa=document.getElementById("templatesCount"),Fe=document.getElementById("dailySnapshotList"),Pe=document.getElementById("todaysFocusList"),K=document.getElementById("weekAtAGlanceList"),Y=null;K&&(Y=document.createElement("li"),Y.dataset.emptyState="week",Y.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",Y.textContent="No upcoming events this week.");var wn=()=>{if(!K||!Y)return;K.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?K.contains(Y)||K.appendChild(Y):K.contains(Y)&&K.removeChild(Y)};K&&(wn(),new MutationObserver(wn).observe(K,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var vt=t=>{bt&&(t?bt.classList.remove("hidden"):bt.classList.add("hidden"))},ve={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Sn=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),xn=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),$e=t=>t?(typeof t.title=="string"?t.title.trim():"")||"Untitled reminder":"",Pt=t=>{if(!t?.due)return null;try{let e=new Date(t.due);return Number.isNaN(e.getTime())?null:e}catch{return null}},ui=(t,e)=>!t||!e?!1:t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),_n=t=>{if(!t)return"";if(Sn)try{return Sn.format(t)}catch{}let e=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return`${e}:${n}`},mi=t=>{if(!t)return"";if(xn)try{return xn.format(t)}catch{}return t.toLocaleDateString()},On=t=>{let e=typeof t?.priority=="string"?t.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(ve,e)?e:"medium"},An=t=>{let e=On(t);return ve[e]?.rank??ve.medium.rank},fi=t=>{let e=On(t);return ve[e]??ve.medium},Cn=t=>{let e=Pt(t);return e?e.getTime():Number.POSITIVE_INFINITY};function Un(t=[]){if(!Fe)return;let e=new Date,n=(Array.isArray(t)?t:[]).map(s=>({reminder:s,date:Pt(s)})).filter(({date:s})=>s&&ui(s,e)).sort((s,i)=>s.date.getTime()-i.date.getTime());if(!n.length){Fe.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Fe.innerHTML="",n.forEach(({reminder:s,date:i})=>{let a=document.createElement("li");a.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let o=document.createElement("p");o.className="font-semibold text-base-content",o.textContent=$e(s),a.appendChild(o);let l=_n(i),c=document.createElement("p");c.className="text-xs text-base-content/70",c.textContent=l?`Due ${l}`:"Due today",a.appendChild(c),Fe.appendChild(a)})}function jn(t=[]){if(!Pe)return;let e=(Array.isArray(t)?t:[]).filter(n=>n&&!n.done).sort((n,s)=>{let i=An(n)-An(s);if(i!==0)return i;let a=Cn(n)-Cn(s);return a!==0?a:$e(n).localeCompare($e(s),void 0,{sensitivity:"base"})}).slice(0,3);if(!e.length){Pe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}Pe.innerHTML="",e.forEach(n=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let i=document.createElement("div");i.className="flex items-center justify-between gap-3";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=$e(n),i.appendChild(a);let o=fi(n),l=document.createElement("span");l.className=o.badgeClass,l.textContent=o.badgeLabel,i.appendChild(l),s.appendChild(i);let c=Pt(n),u=document.createElement("p");if(u.className="text-xs text-base-content/70",c){let d=_n(c),h=mi(c),v=[];d&&v.push(`Due ${d}`),h&&v.push(h),u.textContent=v.length?v.join(" \u2022 "):"Due soon"}else u.textContent="No due date";s.appendChild(u),Pe.appendChild(s)})}var pi=t=>{if(!kn)return;let e=Array.isArray(t)?t.length:0;kn.textContent=String(e)},hi=t=>{let e=Array.isArray(t?.detail?.items)?t.detail.items:[];pi(e),Un(e),jn(e)};document.addEventListener("memoryCue:remindersUpdated",hi);Un();jn();var At=nn(tn),yi={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},He=null,bi=3,In=120;function gi(t){if(t==null)return"";let e=String(t).replace(/\s+/g," ").trim();return e?e.length<=In?e:`${e.slice(0,In-1)}\u2026`:""}function Ei(t){return!t||typeof t!="object"?!1:[t.pinned,t.isPinned,t.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let s=n.trim().toLowerCase();return s==="true"||s==="1"||s==="yes"}return!1})}function Dn(t){if(!pe)return;let e=Array.isArray(t)?t:[];if(!e.length){pe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',vt(!1);return}let n=e.filter(a=>Ei(a));if(!n.length){pe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',vt(!1);return}vt(!0);let i=n.slice(0,bi).map(a=>{let o=g(ce(a,"title")||"Untitled Cue"),l=ce(a,"details"),c=g(gi(l)),u=c?`<p class="mt-1 text-sm text-base-content/70">${c}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${o}</p>
          ${u}
        </li>
      `}).join("");pe.innerHTML=i}function Ct(t,{tone:e="muted"}={}){if(!G)return;let n=["text-sm"];n.push(e==="error"?"text-error":"text-base-content/60"),G.innerHTML=`<p class="${n.join(" ")}">${g(t)}</p>`}function Ti(t){if(!G)return;if(!Array.isArray(t)||t.length===0){Ct("No cues yet.");return}let e=t.map(n=>{let s=g(ce(n,"title")||"Untitled Cue"),i=g(ce(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${s}</h2>
            ${i?`<p>${i}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${g(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${g(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");G.innerHTML=e}async function Le(){return He||(He=(async()=>{let[{initializeApp:t,getApps:e},{getFirestore:n,enableMultiTabIndexedDbPersistence:s,enableIndexedDbPersistence:i,collection:a,doc:o,getDoc:l,addDoc:c,updateDoc:u,getDocs:d,query:h,orderBy:v,serverTimestamp:b,setDoc:L,arrayUnion:C}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),q=e(),M=q&&q.length?q[0]:t(yi),N=n(M);(function(){let B=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;B&&(B.__persistenceInitialized__||(B.__persistenceInitialized__=!0,(async()=>{try{await s(N),console.info("[Firestore] Persistence: multi-tab enabled")}catch(F){if(F&&F.code==="failed-precondition")try{await i(N),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(P){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",P?.code||P)}else F&&F.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",F?.code||F)}})()))})();let U=a(N,"cues");return{db:N,cuesCollection:U,getCollection:a,doc:o,getDoc:l,addDoc:c,updateDoc:u,getDocs:d,query:h,orderBy:v,serverTimestamp:b,setDoc:L,arrayUnion:C}})().catch(t=>{throw console.error("Failed to initialise Firestore for cues",t),t}),He)}async function ki(){let t=await Le(),{getDocs:e,cuesCollection:n,query:s,orderBy:i}=t,a=s&&i?s(n,i("createdAt","desc")):n;return(await e(a)).docs.map(l=>({id:l.id,...l.data()}))}async function vi(t){if(!t)return null;let e=await Le(),{db:n,doc:s,getDoc:i}=e,a=s(n,"cues",t),o=await i(a);return o.exists()?{id:o.id,...o.data()}:null}async function Wn(){if(!(!G&&!pe))try{let t=await ki();Ti(t),Dn(t)}catch(t){console.error("Failed to load cues",t),isPermissionDeniedError(t)?Ct("Sign in to view your cues.",{tone:"muted"}):Ct("Unable to load cues right now.",{tone:"error"}),Dn([])}}function Li(t){!ae||!W||(sn(t,At),W.value=t?.id||"",z?.setEditMode(!0),z?.show({mode:"edit"}))}async function wi(t){let e=t.target instanceof Element?t.target.closest(".edit-btn"):null;if(!e)return;t.preventDefault();let n=e.getAttribute("data-id");if(n)try{let s=await vi(n);if(!s)return;Li(s)}catch(s){console.error("Failed to prepare cue for editing",s)}}async function Si(t){if(t.preventDefault(),!ae||!W)return;let e=W.value.trim(),n=on(At);try{let s=await Le(),{db:i,doc:a,addDoc:o,updateDoc:l,cuesCollection:c,serverTimestamp:u}=s,d=typeof u=="function"?u():null;if(e){let h=a(i,"cues",e),v={...n};d&&(v.updatedAt=d),await l(h,v)}else{let h={...n};d&&(h.createdAt=d,h.updatedAt=d),await o(c,h)}await Wn(),an(At,W,z?.modalTitle??null,Hs),await z?.hide({reason:"form-submit"})}catch(s){console.error("Failed to save cue",s)}}async function xi(){!ae||!W||!G||(G.addEventListener("click",wi),ae.addEventListener("submit",Si))}ae&&W&&(document.addEventListener("cue:prepare",()=>{W.value="",z?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{W.value="",z?.setEditMode(!1)}));ae&&W&&G&&xi().catch(t=>{console.error("Failed to initialise cue editing",t)});(G||pe)&&Wn();var Ze=getPlannerWeekIdFromDate(),qe=!1,f=Ze,T=null,Ee=null,A=null,Ht=getTimetableEntries(),Ke=new Map,Ai=800,zn=1500,It={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},Qn=new Set(["saving","saved","error"]),Kn="plannerNotesOpenState",ie=Ii(),Re=null,Yn="list",Ci=800;function Ii(){if(typeof localStorage>"u")return{};try{let t=localStorage.getItem(Kn);if(!t)return{};let e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch(t){return console.warn("Unable to load planner notes state",t),{}}}function Di(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Kn,JSON.stringify(ie))}catch(t){console.warn("Unable to persist planner notes state",t)}}function Mi(t){return t?!!ie?.[t]:!1}function Bi(t,e){if(t){if(e)ie={...ie,[t]:!0};else if(ie?.[t]){let n={...ie};delete n[t],ie=n}Di()}}function Ni(t,e=Ze){return Array.isArray(t)?t:t&&typeof t=="object"&&Array.isArray(t.lessons)?t.lessons:typeof e=="string"&&e?getPlannerLessonsForWeek(e):[]}var Fi=(t=[])=>{if(!vn)return;let e=Array.isArray(t)?t.length:0;vn.textContent=String(e)};function Pi(t=[]){let e=Array.isArray(t)?t:[];if(gn&&(gn.textContent=String(e.length)),En){let n=new Set;e.forEach(s=>{let i=Rt(s);i&&n.add(i.toLowerCase())}),En.textContent=String(n.size)}if(Tn){let n=e.filter(s=>typeof s.notes=="string"&&s.notes.trim().length>0).length;Tn.textContent=String(n)}}function R(t,e){let n=Ni(t,e);Fi(n);let s=t?.weekId||e||Ze,i=getWeekLabel(s,{short:!0});Ln&&(Ln.textContent=i||""),bn&&(bn.textContent=String(n.length)),Ue&&(Ue.textContent=i||""),Pi(n)}function Ye(t,{tone:e="muted"}={}){if(!x)return;A=null;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(e==="error"?"text-error":"text-base-content/70"),x.innerHTML=`<p class="${n.join(" ")}">${g(t)}</p>`}function Gn(t){if(!yn)return;let e=getWeekLabel(t);yn.textContent=e||"",Ue&&(Ue.textContent=e||"")}function Xn(t=f){let e=getWeekDateForDayIndex(t,1);return e instanceof Date&&!Number.isNaN(e.getTime())?e.toISOString():""}function Rt(t){return!t||typeof t!="object"?"":typeof t.subject=="string"?t.subject.trim():""}function Zn(t){if(!t)return"badge-ghost";let e=t.toLowerCase();return e.includes("hpe")||e.includes("pe")?"badge-info":e.includes("english")?"badge-success":e.includes("civics")||e.includes("cac")?"badge-secondary":e.includes("geo")?"badge-warning":"badge-ghost"}var V={not_started:{label:"Not started",badge:"badge-ghost"},in_progress:{label:"In progress",badge:"badge-warning"},ready:{label:"Ready",badge:"badge-success"},taught:{label:"Taught",badge:"badge-neutral"}};function Hi(t){if(!t)return"";let e=Qe(t.day||"Monday"),n=t.period?t.period:"Lesson",s=t.subject?`<span class="badge badge-ghost badge-xs">${g(t.subject)}</span>`:"";return`
    <article
      class="flex h-full flex-col justify-between rounded-2xl border border-dashed border-base-300/80 bg-base-100/70 px-4 py-4 text-left text-base-content shadow-sm"
      data-planner-slot="true"
      data-timetable-entry="${t.id}"
    >
      <div class="space-y-2">
        <p class="label-text">${g(e)} \xB7 ${g(n)}</p>
        <p class="text-base font-semibold">${g(t.className||"Timetable slot")}</p>
        ${t.subject?`<p class="text-xs text-base-content/70">${g(t.subject)}</p>`:""}
      </div>
      <div class="flex flex-wrap items-center justify-between gap-2 pt-3">
        <div class="flex flex-wrap gap-2">${s}</div>
        <button
          type="button"
          class="btn btn-primary btn-xs"
          data-planner-action="create-slot"
          data-timetable-entry-id="${t.id}"
        >
          Plan lesson
        </button>
      </div>
    </article>
  `}function $t(t=[],e=f){let n=Array.isArray(t)?t:[],s=new Set,i=Xn(e),a=[];return Ht.forEach(o=>{let l=n.find(u=>u.timetableEntryId===o.id),c=ze(Number(o.dayIndex));l?(s.add(l.id),a.push({type:"lesson",entry:o,lesson:l,dayIndex:c})):a.push({type:"slot",entry:o,lesson:null,dayIndex:c,weekStartDate:i})}),n.forEach(o=>{if(s.has(o.id))return;let l=ze(Number(o.dayIndex));a.push({type:"lesson",entry:null,lesson:o,dayIndex:l,isLoose:!0})}),a.sort((o,l)=>{if(o.dayIndex!==l.dayIndex)return o.dayIndex-l.dayIndex;let c=o.entry?.period||o.lesson?.period||"",u=l.entry?.period||l.lesson?.period||"";if(c&&u&&c!==u)return c.localeCompare(u,void 0,{numeric:!0,sensitivity:"base"});let d=o.entry?.className||o.lesson?.title||"",h=l.entry?.className||l.lesson?.title||"";return d.localeCompare(h)})}function Ri(t,e){let n=V[e]?e:"not_started",s=Object.entries(V).map(([i,a])=>`<option value="${i}" ${i===n?"selected":""}>${g(a.label)}</option>`).join("");return`
    <label class="flex items-center gap-2 text-xs font-semibold text-base-content/80">
      <span>Status</span>
      <select class="select select-bordered select-xs" data-lesson-status="true" data-lesson-id="${t}">
        ${s}
      </select>
    </label>
  `}function $i(t=[],e=""){return t.length?`
    <ul class="space-y-2">
      ${t.map(n=>{let s=typeof n?.label=="string"&&n.label.trim()?n.label.trim():"Resource",i=typeof n?.url=="string"?n.url.trim():"",a=typeof n?.id=="string"?n.id:"",o=i?`<a class="link link-primary break-words" href="${i}" target="_blank" rel="noreferrer">${g(s)}</a>`:`<span class="text-base-content">${g(s)}</span>`,l=a?`<button class="btn btn-ghost btn-xs text-error" type="button" data-planner-action="remove-resource" data-lesson-id="${e}" data-resource-id="${a}">Remove</button>`:"";return`<li class="flex items-start justify-between gap-2 rounded-lg bg-base-200/70 px-2 py-1">${o}${l}</li>`}).join("")}
    </ul>
  `:'<p class="text-xs text-base-content/60">No resources added yet.</p>'}function D(t){if(!x)return;Ui(t);let e=Array.isArray(t?.lessons)?t.lessons:[],n=t?.weekId||f||Ze,s=$t(e,n),i=e,a=s.some(d=>d.type==="slot");if(!e.length&&!a){Ye("No lessons or timetable slots yet. Start by adding a timetable entry."),Ve([],s);return}let o=i.map(d=>typeof d.id=="string"&&d.id?d.id:"").filter(d=>!!d);A&&!o.includes(A)&&(A=null);let l=i.map(d=>{let h=Array.isArray(d.details)?d.details.map(re=>`
                <li class="flex items-center gap-2">
                  ${re.badge?`<span class="badge badge-outline badge-sm text-secondary">${g(re.badge)}</span>`:""}
                  <span class="text-sm text-base-content/80">${g(re.text)}</span>
                </li>
              `).join(""):"",v=h?`<ul class="space-y-2 text-sm text-base-content/80">${h}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',b=typeof d.id=="string"?d.id:"",L=!!(A&&b&&A===b),C=["data-planner-lesson",b?`data-lesson-id="${b}"`:"",L?'data-planner-selected="true"':""].filter(Boolean).join(" "),q=d.summary?`<p class="text-sm text-base-content/80">${g(d.summary)}</p>`:"",M=Rt(d),N=Zn(M),U=M?`<span class="badge ${N} badge-sm">${g(M)}</span>`:"",_=typeof d.notes=="string"?d.notes:"",B=Mi(b),F=b?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${b}"
              ${B?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${b}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${g(_)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${g(It.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",P=b?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${b}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${b}"
              >
                Move down
              </button>
            </div>
          `:"",p=b?Ri(b,d.status):"",y=$i(Array.isArray(d.resources)?d.resources:[],b),w=V[d.status]?.badge||V.not_started.badge,H=V[d.status]?.label||V.not_started.label,k=[d.weekDay||d.dayLabel||"Lesson"];d.period&&k.push(d.period);let oe=k.filter(Boolean).join(" \xB7 ");return`
        <article class="card border border-base-300 bg-base-100 shadow-lg transition hover:-translate-y-1 hover:shadow-xl" ${C}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-3">
              <div class="space-y-2">
                <div class="flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">
                  <span>${g(oe)}</span>
                  <span class="badge ${w} badge-xs">${g(H)}</span>
                </div>
                <div class="flex flex-wrap items-center gap-2">
                  <h2 class="text-lg font-semibold text-base-content">${g(d.title||d.dayLabel||"Lesson")}</h2>
                  ${U}
                </div>
                ${q}
                <div class="flex flex-wrap items-center gap-3">
                  ${p}
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                ${P}
                <div class="flex flex-wrap justify-end gap-1">
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="duplicate" data-lesson-id="${b}">Duplicate</button>
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${b}">
                    Edit
                  </button>
                  <button
                    type="button"
                    class="btn btn-ghost btn-xs text-error"
                    data-planner-action="delete"
                    data-lesson-id="${b}"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
            ${v}
            <div class="rounded-xl border border-base-200 bg-base-200/60 p-3">
              <div class="flex flex-wrap items-center justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold uppercase tracking-[0.2em] text-base-content/60">Resources</p>
                  <p class="text-xs text-base-content/70">Link slides, videos, and activity sheets.</p>
                </div>
                <span class="badge badge-outline badge-sm">${Array.isArray(d.resources)?d.resources.length:0} linked</span>
              </div>
              <div class="mt-2 space-y-2">
                ${y}
                <div class="grid gap-2 md:grid-cols-[1fr_1.5fr_auto]">
                  <input
                    type="text"
                    class="input input-bordered input-sm w-full"
                    placeholder="Label (e.g. Slides)"
                    data-resource-label="true"
                    data-lesson-id="${b}"
                  />
                  <input
                    type="url"
                    class="input input-bordered input-sm w-full"
                    placeholder="URL"
                    data-resource-url="true"
                    data-lesson-id="${b}"
                  />
                  <button
                    type="button"
                    class="btn btn-outline btn-sm"
                    data-planner-action="add-resource"
                    data-lesson-id="${b}"
                  >
                    Add resource
                  </button>
                </div>
              </div>
            </div>
            ${F}
            <div class="flex flex-wrap items-center gap-2">
              <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-xs">Add template</label>
                <ul tabindex="0" class="dropdown-content menu rounded-box z-[1] mt-2 w-64 bg-base-100 p-2 shadow">
                  <li><button type="button" data-planner-action="apply-template" data-template-type="simple" data-lesson-id="${b}">Simple lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="hpe" data-lesson-id="${b}">HPE lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="english" data-lesson-id="${b}">English lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="cac" data-lesson-id="${b}">CAC lesson template</button></li>
                </ul>
              </div>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${b}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${b}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join(""),c=s.filter(d=>d.type==="slot"&&d.entry).map(d=>Hi(d.entry)).join(""),u=[l,c].filter(Boolean).join("");if(!u){Ye("No lessons or timetable slots yet. Start by adding a timetable entry."),Ve([],s);return}x.innerHTML=u,qt(A),Ve(i,s)}function Ve(t=[],e=null){if(!ke)return;let n=Array.isArray(e)?e:$t(t,f),i=[{day:"Monday",index:1},{day:"Tuesday",index:2},{day:"Wednesday",index:3},{day:"Thursday",index:4},{day:"Friday",index:5}].map(o=>({...o,items:[]}));n.forEach(o=>{let l=ze(Number(o?.dayIndex)),c=i.find(u=>u.index===l);c&&c.items.push(o)});let a=i.map(({day:o,items:l})=>{let c=l.map(d=>{if(d.type==="slot"&&d.entry){let q=d.entry.period?` \xB7 ${g(d.entry.period)}`:"",M=d.entry.subject?`<span class="badge badge-ghost badge-xs">${g(d.entry.subject)}</span>`:"";return`
              <div class="rounded-xl border border-dashed border-base-200 bg-base-100 px-3 py-2">
                <div class="flex items-start justify-between gap-2">
                  <div>
                    <p class="text-xs font-semibold text-base-content/70">${g(d.entry.className||"Timetable slot")}</p>
                    <p class="text-xs text-base-content/60">${g(Qe(d.entry.day||o)+q)}</p>
                  </div>
                  ${M}
                </div>
                <div class="mt-2 flex flex-wrap justify-end">
                  <button class="btn btn-primary btn-ghost btn-xs" type="button" data-planner-action="create-slot" data-timetable-entry-id="${d.entry.id}">Plan lesson</button>
                </div>
              </div>
            `}let h=d.lesson||d,v=Rt(h),b=Zn(v),L=V[h.status]?.label||V.not_started.label,C=V[h.status]?.badge||V.not_started.badge;return`
            <button
              type="button"
              class="w-full text-left rounded-xl border border-base-200 bg-base-100 px-3 py-2 shadow-sm transition hover:-translate-y-[1px] hover:shadow"
              data-week-view-lesson="${h.id||""}"
            >
              <div class="flex items-start justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold text-base-content/70">${g(h.title||h.dayLabel||"Lesson")}</p>
                  <p class="text-xs text-base-content/60">${g(h.summary||"")}</p>
                </div>
                <div class="flex flex-col items-end gap-1">
                  ${v?`<span class="badge ${b} badge-xs">${g(v)}</span>`:""}
                  <span class="badge ${C} badge-xs">${g(L)}</span>
                </div>
              </div>
            </button>
          `}).join("");return`
        <div class="space-y-2 rounded-2xl border border-base-200 bg-base-200/50 p-3">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-base-content/70">${o}</p>
          <div class="space-y-2">${c||'<p class="text-xs text-base-content/60">No lessons yet.</p>'}</div>
        </div>
      `}).join("");ke.innerHTML=a}function _e(t="list"){let e=t==="week"?"week":"list";if(Yn=e,x&&x.classList.toggle("hidden",e==="week"),ke&&ke.classList.toggle("hidden",e!=="week"),wt instanceof HTMLElement&&wt.setAttribute("aria-pressed",e==="list"?"true":"false"),St instanceof HTMLElement&&St.setAttribute("aria-pressed",e==="week"?"true":"false"),e==="week"){let n=T?.lessons||[];Ve(n,$t(n,f))}}function qt(t){A=t||null,x&&x.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!t&&n.getAttribute("data-lesson-id")===t?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function qi(t){let e=t.target instanceof Element?t.target.closest("[data-week-view-lesson]"):null;if(!e)return;let n=e.getAttribute("data-week-view-lesson");if(!n)return;_e("list"),qt(n);let s=x?.querySelector(`[data-lesson-id="${n}"]`);s instanceof HTMLElement&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"center"})}function Vi(){return A&&(Array.isArray(T?.lessons)?T.lessons:[]).some(e=>e.id===A)?A:null}function _i(t){let e=t.target instanceof Element?t.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!e)return;let n=e.getAttribute("data-lesson-id");!n||n===A||qt(n)}function Oi(t){let e=xt(t?.currentTarget)?t.currentTarget:Oe;if(!xt(e))return;let n=e.value,s=Ge.has(n)?n:je;Hn(s),ii(s),e.value!==s&&(e.value=s)}function Je(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function Jn(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function es(t){if(!t)return;let e=Ke.get(t);if(!e)return;let n=Jn();n&&n(e),Ke.delete(t)}function be(t,e){if(!(t instanceof HTMLTextAreaElement))return;let n=typeof e=="string"&&Qn.has(e)?e:null;n?t.setAttribute("data-notes-status",n):t.removeAttribute("data-notes-status")}function ge(t,e){if(!(t instanceof HTMLTextAreaElement))return;let n=typeof e=="string"&&Qn.has(e)?e:null,s=t.parentElement instanceof HTMLElement?t.parentElement.querySelector("[data-notes-status-text]"):null;if(s instanceof HTMLElement){let i=n||"idle",a=It[i]||It.idle;s.textContent=a,s.setAttribute("data-status",i)}}function Ui(t){if(!(J instanceof HTMLTextAreaElement))return;me("idle");let e=typeof t?.teacherNotes=="string"?t.teacherNotes:"";J.value!==e&&(J.value=e)}function me(t="idle"){if(!(Et instanceof HTMLElement))return;let e={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},n=e[t]||e.idle;Et.textContent=n,Et.setAttribute("data-status",t)}async function ji(t){if(f){me("saving");try{let e=await updatePlannerTeacherNotes(f,t);e&&(T=e),me("saved");let n=Je();n?n(()=>me("idle"),zn):me("idle")}catch(e){console.error("Failed to save teacher notes",e),me("error")}}}function Wi(t){if(!(J instanceof HTMLTextAreaElement)||t?.target!==J)return;if(Re){let n=Jn();n&&n(Re)}let e=Je();e&&(Re=e(()=>{Re=null,ji(J.value)},Ci))}function ts(t="simple"){switch(t){case"hpe":return`Focus skill:
Warm-up:
Skill drill:
Modified game:
Reflection questions:`;case"english":return`Text focus:
Discussion questions:
Mentor sentence:
Writing task:
Reflection / exit ticket:`;case"cac":return`Civics topic:
Key terms:
Source / video:
Discussion questions:
Activity:
Reflection question:`;case"simple":default:return`Learning intention:
Success criteria:
Warm-up:
Main activity:
Exit task:`}}async function zi(t,e){if(!t)return;await et();let n=T?.lessons?.find(o=>o.id===t);if(!n)return;let s=ts(e),i=typeof n.notes=="string"?n.notes:"";if(i&&typeof window<"u"&&typeof window.confirm=="function"&&!window.confirm("Add this template to the existing notes?"))return;let a=i?`${i.trim()}

${s}`:s;try{let o=await updateLessonInWeek(f,t,{notes:a,templateType:e||"simple"});o&&(T=o,D(o),R(o,f))}catch(o){console.error("Failed to apply lesson template",o)}}async function Qi(t){let e=t.target instanceof HTMLSelectElement&&t.target.hasAttribute("data-lesson-status")?t.target:null;if(!e)return;let n=e.getAttribute("data-lesson-id"),s=e.value;if(n)try{let i=await updateLessonInWeek(f,n,{status:s});i&&(T=i,D(i),R(i,f))}catch(i){console.error("Failed to update lesson status",i)}}async function Ki(t,e,n){if(!t||!(e instanceof HTMLInputElement)||!(n instanceof HTMLInputElement))return;let s=e.value.trim(),i=n.value.trim();if(!s&&!i)return;let a=T?.lessons?.find(l=>l.id===t);if(!a)return;let o=Array.isArray(a.resources)?[...a.resources]:[];o.push({id:Ft("resource"),label:s,url:i});try{let l=await updateLessonInWeek(f,t,{resources:o});l&&(T=l,D(l)),e.value="",n.value=""}catch(l){console.error("Failed to add resource",l)}}async function Yi(t,e){if(!t||!e)return;let n=T?.lessons?.find(i=>i.id===t);if(!n)return;let s=(n.resources||[]).filter(i=>i?.id!==e);try{let i=await updateLessonInWeek(f,t,{resources:s});i&&(T=i,D(i))}catch(i){console.error("Failed to remove resource",i)}}async function Dt(t,e,n){if(!t||!f)return;let s=n instanceof HTMLTextAreaElement?n:null;s&&(be(s,"saving"),ge(s,"saving"));try{let i=await updateLessonInWeek(f,t,{notes:e});if(i&&(T=i),s){be(s,"saved"),ge(s,"saved");let a=Je();a?a(()=>{s.getAttribute("data-notes-status")==="saved"&&(be(s,null),ge(s,null))},zn):(be(s,null),ge(s,null))}}catch(i){console.error("Failed to save planner notes",i),s&&(be(s,"error"),ge(s,"error"))}}function Gi(t){let e=t.target instanceof HTMLTextAreaElement?t.target:null;if(!e||!e.hasAttribute("data-planner-notes"))return;let n=e.getAttribute("data-lesson-id");if(!n)return;es(n);let s=Je();if(!s){Dt(n,e.value,e);return}let i=s(()=>{Ke.delete(n),Dt(n,e.value,e)},Ai);Ke.set(n,i)}function Xi(t){let e=t.target instanceof HTMLTextAreaElement?t.target:null;if(!e||!e.hasAttribute("data-planner-notes"))return;let n=e.getAttribute("data-lesson-id");n&&(es(n),Dt(n,e.value,e))}function Zi(t){let e=t.target instanceof HTMLDetailsElement?t.target:null;if(!e||!e.hasAttribute("data-planner-notes-collapse"))return;let n=e.getAttribute("data-lesson-id");if(!n)return;let s=e.hasAttribute("open");Bi(n,s)}function fe(t){if(!x)return Ee=null,Promise.resolve();let e=t||getPlannerWeekIdFromDate();f=e,Gn(e),Ye("Loading plan\u2026");let n=(async()=>{try{let s=await loadWeekPlan(e);T=s,D(s),R(s,e)}catch(s){console.error("Failed to load planner week",s),Ye("Unable to load this week's planner.",{tone:"error"})}})();return Ee=n,n.finally(()=>{Ee===n&&(Ee=null)})}async function et(){if(!x)return;qe||Vt();let t=Ee;if(!t&&(!T||T.weekId!==f)&&(t=fe(f)),t&&typeof t.then=="function")try{await t}catch(e){console.error("Planner failed to load",e)}}async function Ji(t,e){if(!t)return;await et();let n=Array.isArray(T?.lessons)?T.lessons:[];if(!n.length)return;let s=n.find(b=>b?.id===t);if(!s)return;let i=typeof s.dayLabel=="string"&&s.dayLabel.trim()?s.dayLabel.trim():typeof s.dayName=="string"&&s.dayName.trim()?s.dayName.trim():"",a=typeof s.title=="string"&&s.title.trim()?s.title.trim():i||"Lesson",o=typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():"",l=o||a,c=i?`${i} \xB7 ${l}`:l,u=o||"",d=ri(s),h=li(getWeekDateForDayIndex(f,d)),v={reminderTitle:c,reminderNotes:u,dueDate:h,dayLabel:i,lessonTitle:a,summary:o,plannerLessonId:t};mt("cue:prepare",{trigger:e,source:"planner"}),mt("planner:prefillReminder",v),mt("cue:open",{trigger:e,source:"planner"})}async function ea(t,e){if(!t)return;await et();let s=(Array.isArray(T?.lessons)?T.lessons:[]).find(l=>l?.id===t);if(!s)return;let i=e instanceof HTMLElement?e:null;i&&i.setAttribute("disabled","true");let a=Ft("lesson"),o={id:a,dayIndex:s.dayIndex,dayLabel:s.dayLabel,dayName:s.dayName,title:s.title,summary:s.summary,subject:s.subject,notes:s.notes,period:s.period,templateType:s.templateType||"simple",status:"not_started",resources:Array.isArray(s.resources)?s.resources.map(l=>({label:l?.label||"",url:l?.url||""})):[],details:Array.isArray(s.details)?s.details.map(l=>({badge:l?.badge||"",text:l?.text||""})):[]};try{let l=await addLessonToWeek(f,o),c=l;l&&Number.isFinite(s.position)&&(c=await updateLessonInWeek(f,a,{position:s.position+.1})),c&&(T=c,A=a,D(c),R(c,f),$&&($.textContent=`Duplicated ${s.title||"lesson"} into this week.`))}catch(l){console.error("Failed to duplicate planner lesson",l),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{i&&i.removeAttribute("disabled")}}async function ta(t,e){if(!t||!f)return;let n=Ht.find(i=>i.id===t);if(!n)return;let s=e instanceof HTMLElement?e:null;s&&s.setAttribute("disabled","true");try{let i=Xn(f),a=await addLessonToWeek(f,{dayIndex:ze(Number(n.dayIndex)),dayName:Qe(n.day),title:n.className||Qe(n.day||"Monday"),summary:"",subject:n.subject||"",period:n.period||"",status:"not_started",timetableEntryId:n.id,weekStartDate:i});a&&(T=a,A=a.lessons?.find(l=>l.timetableEntryId===n.id&&(!l.weekStartDate||l.weekStartDate===i))?.id||A,D(a),R(a,f))}catch(i){console.error("Failed to create lesson from timetable slot",i)}finally{s&&s.removeAttribute("disabled")}}async function na(t){let e=t.target instanceof Element?t.target.closest("[data-planner-action]"):null;if(!e)return;t.preventDefault();let n=e.getAttribute("data-planner-action"),s=e.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":oa(s,e);break;case"edit":ra(s,e);break;case"delete":la(s);break;case"duplicate":await ea(s,e);break;case"apply-template":{let i=e.getAttribute("data-template-type")||"simple";zi(s,i);break}case"add-resource":{let i=e.closest("[data-planner-lesson]"),a=i?.querySelector("input[data-resource-label][data-lesson-id]"),o=i?.querySelector("input[data-resource-url][data-lesson-id]");await Ki(s,a,o);break}case"remove-resource":{let i=e.getAttribute("data-resource-id");await Yi(s,i);break}case"move-up":Mn(s,"up",e);break;case"move-down":Mn(s,"down",e);break;case"create-reminder":await Ji(s,e);break;case"create-slot":{let i=e.getAttribute("data-timetable-entry-id");await ta(i,e);break}default:break}}async function ns(t){if(typeof document>"u"||!ee)return;t?.preventDefault?.();let e=t?.currentTarget instanceof HTMLElement?t.currentTarget:null,n=T?.lessons?.[0]?.dayLabel||"Monday";ee.openAddLesson({defaultDay:n,trigger:e})}async function sa(t){if(!ee)return;t?.preventDefault?.();let e=t?.currentTarget instanceof HTMLElement?t.currentTarget:null,n=getWeekIdFromOffset(f,1);ee.openDuplicatePlan({suggestedWeekId:n,trigger:e})}async function ia(t){if(!f)return;t?.preventDefault?.();let e=t?.currentTarget instanceof HTMLElement?t.currentTarget:null,n=getWeekIdFromOffset(f,-1);if(n){e&&e.setAttribute("disabled","true");try{let s=await duplicateWeekPlan(n,f);s&&(T=s,A=null,D(s),R(s,f),$&&($.textContent="Copied last week into this plan."))}catch(s){console.error("Failed to copy previous planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{e&&e.removeAttribute("disabled")}}}async function aa(t){if(!f)return;t?.preventDefault?.();let e=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(e=window.confirm("Clear all lessons for this week?")),!e)return;let n=t?.currentTarget instanceof HTMLElement?t.currentTarget:null;n&&n.setAttribute("disabled","true");try{let s=await clearWeekPlan(f);s&&(T=s,A=null,D(s),R(s,f),$&&($.textContent="Cleared this week's plan."))}catch(s){console.error("Failed to clear planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function oa(t,e){if(!t||!ee)return;let n=T?.lessons?.find(i=>i.id===t);if(!n)return;let s=e instanceof HTMLElement?e:null;ee.openAddDetail({lesson:n,trigger:s})}async function ra(t,e){if(!t||!ee)return;let n=T?.lessons?.find(i=>i.id===t);if(!n)return;let s=e instanceof HTMLElement?e:null;ee.openEditLesson({lesson:n,trigger:s})}async function Mn(t,e,n){if(!t||!e)return;let s=f||getPlannerWeekIdFromDate();if(!s)return;let i=n instanceof HTMLElement?n:null;i&&i.setAttribute("disabled","true");try{let a=await movePlannerLesson(s,t,e);a&&(T=a,D(a),R(a,s))}catch(a){console.error("Failed to move planner lesson",a),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{i&&i.removeAttribute("disabled")}}async function la(t){if(!t||typeof window>"u")return;let e=T?.lessons?.find(s=>s.id===t);if(window.confirm(e?.title?`Delete "${e.title}" from this week?`:"Delete this lesson?"))try{let s=await deleteLessonFromWeek(f,t);s&&(T=s,D(s),R(s,f))}catch(s){console.error("Failed to delete planner lesson",s),window.alert("Unable to delete that lesson right now.")}}function Vt(){if(qe||!x){qe&&fe(f);return}qe=!0,initPlannerStore({ensureFirestore:Le}),x.addEventListener("click",_i),x.addEventListener("click",na),x.addEventListener("change",Qi),x.addEventListener("input",Gi),x.addEventListener("focusout",Xi),x.addEventListener("toggle",Zi),ke?.addEventListener("click",qi),J instanceof HTMLTextAreaElement&&J.addEventListener("input",Wi),ei?.addEventListener("click",ns),Js?.addEventListener("click",sa),Xs?.addEventListener("click",ia),Zs?.addEventListener("click",aa),Oe?.addEventListener("change",Oi),wt?.addEventListener("click",()=>_e("list")),St?.addEventListener("click",()=>_e("week")),Ks?.addEventListener("click",()=>{let t=getWeekIdFromOffset(f,-1);fe(t)}),Ys?.addEventListener("click",()=>{let t=getWeekIdFromOffset(f,1);fe(t)}),Gs?.addEventListener("click",()=>{fe(getPlannerWeekIdFromDate())}),_e(Yn),fe(f)}var Ha=mn({dailyTab:$s,dailyView:Vs,dailyListHeader:_s,quickAddForm:Os,quickAddInput:Us,quickAddVoiceButton:js,dailyTasksContainer:Ws,clearCompletedButton:zs,dailyListPermissionNotice:Qs,cuesTab:Rs,cuesView:qs,ensureCueFirestore:()=>Le()}),ss="theme",da="professional",Mt="memoryCue:theme-change",ca="professional",Bt=document.getElementById("theme-menu"),is="[data-theme-name],[data-theme-option]",ua=new Set(["dark","dracula","synthwave"]);function te(t){return typeof t=="string"?t.trim():""}function as(t){return t instanceof HTMLElement?te(t.getAttribute("data-theme-name")||t.getAttribute("data-theme-option")||""):""}function ma(t){let e=te(t);e&&(document.documentElement.setAttribute("data-theme",e),document.documentElement.classList.toggle("dark",ua.has(e)))}function Bn(t){let e=te(t);if(e)try{localStorage.setItem(ss,e)}catch(n){console.warn("Unable to save theme preference",n)}}function os(t){if(!Bt)return;let e=te(t);Bt.querySelectorAll(is).forEach(s=>{if(!(s instanceof HTMLElement))return;let i=as(s),a=e&&i===e;s.setAttribute("aria-checked",a?"true":"false"),s.classList.toggle("active",a)})}function fa(t){let e=te(t);if(!(typeof window>"u"||!e))try{window.dispatchEvent(new CustomEvent(Mt,{detail:{theme:e}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let s=document.createEvent("CustomEvent");s.initCustomEvent(Mt,!0,!0,{theme:e}),window.dispatchEvent(s)}}}function Nt(t,{persist:e=!0,notify:n=!0}={}){let s=te(t);if(!s)return;te(document.documentElement.getAttribute("data-theme"))!==s&&ma(s),e&&Bn(s),os(s),n&&fa(s)}function pa(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){Nt(ca,{persist:!0,notify:!0});return}let e="";try{e=localStorage.getItem(ss)||""}catch(s){console.warn("Unable to load theme preference",s)}let n=e||document.documentElement.getAttribute("data-theme")||da;n&&Nt(n,{persist:!1,notify:!0})}Bt?.addEventListener("click",t=>{let e=t.target instanceof HTMLElement?t.target.closest(is):null;if(!e)return;t.preventDefault();let n=as(e);n&&Nt(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(Mt,t=>{let e=te(t?.detail?.theme);e&&os(e)});pa()});export default ha();
