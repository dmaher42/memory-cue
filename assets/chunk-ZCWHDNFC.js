import{b as I,c as w}from"./chunk-CTK42JWW.js";import{b as v}from"./chunk-GUVSRPRW.js";function H(t={}){try{Object.assign(s,t||{})}catch(n){console.warn("[supabase-auth] setAuthContext failed",n)}}async function _(t={}){try{if(s&&typeof s.signInWithPopup=="function"&&s.auth&&typeof s.GoogleAuthProvider=="function")return s.signInWithPopup(s.auth,new s.GoogleAuthProvider);if(s&&typeof s.signInWithRedirect=="function"&&s.auth&&typeof s.GoogleAuthProvider=="function")return s.signInWithRedirect(s.auth,new s.GoogleAuthProvider);let n=I();if(n&&n.auth){if(typeof n.auth.signInWithOAuth=="function")return n.auth.signInWithOAuth({provider:"google",...t});if(typeof n.auth.signIn=="function")return n.auth.signIn({provider:"google"})}}catch(n){console.error("[supabase-auth] startSignInFlow error",n);try{s?.toast?.("Sign-in failed")}catch(e){console.warn("[supabase-auth] toast handler failed",e)}throw n}return Promise.resolve(null)}async function G(){try{if(s&&typeof s.signOut=="function")return s.signOut(s.auth);let t=I();if(t&&t.auth&&typeof t.auth.signOut=="function")return t.auth.signOut()}catch(t){throw console.error("[supabase-auth] startSignOutFlow error",t),t}return Promise.resolve(null)}function M(t){return t?Array.isArray(t)?t:[t]:[]}function A(t){return Array.from(new Set(t.filter(n=>n instanceof HTMLElement||typeof SVGElement<"u"&&n instanceof SVGElement)))}function i(t,n){let e=M(n).filter(Boolean);if(!e.length)return[];let a=e.flatMap(u=>Array.from(t.querySelectorAll(u)));return A(a)}function m(t,n=document){let e=n instanceof Document||n instanceof HTMLElement?n:document;return{authForms:i(e,t.authForm),emailInputs:i(e,t.emailInput),signInButtons:i(e,t.signInButtons),signOutButtons:i(e,t.signOutButtons),userBadges:i(e,t.userBadge),userBadgeEmails:i(e,t.userBadgeEmail),userBadgeInitials:i(e,t.userBadgeInitial),userNameEls:i(e,t.userName),syncStatusEls:i(e,t.syncStatus),syncStatusTextEls:i(e,t.syncStatusText),statusIndicatorEls:i(e,t.statusIndicator),feedbackEls:i(e,t.feedback)}}function y(t,n){A(Array.isArray(t)?t:[t]).forEach(e=>{e instanceof HTMLElement&&(e.classList.toggle("hidden",!n),n?e.removeAttribute("hidden"):e.setAttribute("hidden",""))})}function f(t,n){A(Array.isArray(t)?t:[t]).forEach(e=>{e instanceof HTMLElement&&(e.textContent=n||"")})}function F(t,n){A(t).forEach(e=>{e instanceof HTMLElement&&(e.dataset.state=n,e.classList.toggle("online",n==="online"),e.classList.toggle("offline",n!=="online"))})}function S(t,n){A(t).forEach(e=>{if(!(e instanceof HTMLElement))return;e.textContent=n||"";let a=!!n;e.classList.toggle("hidden",!a),a?e.removeAttribute("hidden"):e.setAttribute("hidden","")})}function x(t={}){let n={...O.syncStatusText,...t.syncStatusText||{}};return{...O,...t,syncStatusText:n}}function E(t,{user:n,messages:e}={}){let a=x(e),u=!!n;y(t.signInButtons,!u),y(t.authForms,!u),y(t.signOutButtons,u),y(t.userBadges,u);let l=typeof n?.email=="string"?n.email:"",o=l?l.charAt(0).toUpperCase():"U";u?(f(t.userBadgeEmails,l),f(t.userBadgeInitials,o),f(t.userNameEls,l)):(f(t.userBadgeEmails,""),f(t.userBadgeInitials,""),f(t.userNameEls,""));let B=typeof a.signedIn=="function"?a.signedIn(n):a.signedIn,r=typeof a.signedOut=="function"?a.signedOut(n):a.signedOut,g=u?B:r,d=!u;t.syncStatusEls.length&&(f(t.syncStatusEls,g),t.syncStatusEls.forEach(h=>{h instanceof HTMLElement&&(h.classList.toggle("online",u),h.dataset.state=u?"online":"offline")}),y(t.syncStatusEls,d));let b=u?a.syncStatusText?.signedIn:a.syncStatusText?.signedOut;f(t.syncStatusTextEls,b||""),F(t.statusIndicatorEls,u?"online":"offline"),S(t.feedbackEls,"")}function k(t,n){n.authForms.forEach(e=>{!(e instanceof HTMLFormElement)||e.dataset.supabaseAuthBound==="true"||(e.dataset.supabaseAuthBound="true",e.addEventListener("submit",async a=>{a.preventDefault();let u=n.emailInputs.find(o=>e.contains(o))||e.querySelector('input[type="email"]'),l=typeof u?.value=="string"?u.value.trim():"";if(!l){S(n.feedbackEls,"Enter an email address to continue.");return}try{let{error:o}=await t.auth.signInWithOtp({email:l});o?S(n.feedbackEls,o.message||"Unable to send magic link."):S(n.feedbackEls,"Magic link sent. Check your email.")}catch(o){S(n.feedbackEls,o?.message||"Unable to send magic link.")}}))})}function C(t,n){n.signOutButtons.forEach(e=>{!(e instanceof HTMLElement)||e.dataset.supabaseAuthBound==="true"||(e.dataset.supabaseAuthBound="true",e.addEventListener("click",async()=>{try{await t.auth.signOut()}catch(a){console.error("[supabase] Sign-out failed.",a)}}))})}function W(t={}){let{supabase:n,scope:e=document,selectors:a={},messages:u={},disableButtonBinding:l=!1,onSessionChange:o}=t,B={...T,...a},r=m(B,e),g=x(u);E(r,{user:null,messages:g});let d=n||I()||(typeof window<"u"?window.supabase:null);if(!d)return{supabase:null,elements:r,applyAuthState:c=>E(r,{...c,messages:g}),destroy(){}};k(d,r),l||C(d,r);let b=[],{data:h}=d.auth.onAuthStateChange((c,p)=>{if(E(r,{user:p?.user??null,messages:g}),typeof o=="function")try{o(p?.user??null,p)}catch(L){console.error("[supabase] onSessionChange handler failed.",L)}});return h?.subscription&&b.push(()=>{try{h.subscription.unsubscribe()}catch{}}),d.auth.getSession().then(({data:c,error:p})=>{p||E(r,{user:c?.session?.user??null,messages:g})}).catch(c=>{console.error("[supabase] getSession failed.",c)}),{supabase:d,elements:r,applyAuthState:c=>E(r,{...c,messages:g}),destroy(){b.forEach(c=>{try{c()}catch{}})}}}function R(t={},n=document){return m({...T,...t},n)}var s,T,O,U=v(()=>{w();s={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};T={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},O={signedOut:"",signedIn:t=>`Reminders syncing for ${t?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});export{H as a,_ as b,G as c,T as d,O as e,E as f,W as g,R as h,U as i};
