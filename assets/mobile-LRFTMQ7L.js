import{a as M,b as U}from"./chunk-IEEZHBDI.js";import{b as R}from"./chunk-RCZ4YZVR.js";var x=R(()=>{U();(function(){let i=()=>{let n=document.getElementById("create-sheet"),d=document.getElementById("closeCreateSheet");if(!(n instanceof HTMLElement)||!(d instanceof HTMLElement)){let t=typeof i._retryCount=="number"?i._retryCount:0;t<10&&(i._retryCount=t+1,setTimeout(i,50));return}if(i._initialised)return;i._initialised=!0;let m=n.querySelector("[data-dialog-content]"),f=n.querySelector(".sheet-backdrop"),u=document.getElementById("fabCreate"),S=document.getElementById("createReminderForm"),y=document.getElementById("saveReminder"),a=document.getElementById("priority"),A=document.getElementById("priorityChips"),L=A?Array.from(A.querySelectorAll('input[name="priority"]')):[],b=new Set([...u?[u]:[],...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),k=Array.from(b).filter(t=>t instanceof HTMLElement),I=()=>{n.classList.add("hidden"),n.setAttribute("hidden",""),n.setAttribute("aria-hidden","true"),n.removeAttribute("open"),n.classList.remove("open")};I();let p=null,B=(t,o)=>{try{document.dispatchEvent(new CustomEvent(t,{detail:o}))}catch(s){console.warn(`${t} dispatch failed`,s)}},g=()=>{let t=a?.value||"Medium";L.forEach(o=>{let s=o.value===t;o.checked=s,o.setAttribute("aria-checked",s?"true":"false")})},h=t=>{a&&(a.value!==t&&(a.value=t,a.dispatchEvent(new Event("change",{bubbles:!0}))),g())};L.forEach(t=>{t.addEventListener("change",()=>{t.checked&&h(t.value)})}),a?.addEventListener("change",g),g();let C=()=>{let t=n.querySelector('input, textarea, select, button, [contenteditable="true"]');t instanceof HTMLElement&&setTimeout(()=>{try{t.focus()}catch{}},0)},e=t=>{p=t instanceof HTMLElement?t:null,n.classList.remove("hidden"),n.removeAttribute("hidden"),n.setAttribute("aria-hidden","false"),n.setAttribute("open",""),n.classList.add("open"),u&&u.setAttribute("aria-expanded","true"),p&&p!==u&&p.setAttribute("aria-expanded","true"),g(),C(),B("reminder:sheet-opened",{trigger:p})},r=(t="dismissed")=>{let o=!n.classList.contains("hidden");I(),u&&u.setAttribute("aria-expanded","false"),p&&p!==u&&p.setAttribute("aria-expanded","false");let s=p&&document.body.contains(p)&&p||u;if(s&&typeof s.focus=="function")try{s.focus()}catch{}o&&B("reminder:sheet-closed",{reason:t,trigger:p}),p=null};k.forEach(t=>{t.addEventListener("click",o=>{o.preventDefault(),e(t)})}),d.addEventListener("click",t=>{t.preventDefault(),r("close-button")}),f?.addEventListener("click",t=>{t.target===f&&r("backdrop")}),n.addEventListener("keydown",t=>{t.key==="Escape"&&(t.stopPropagation(),r("escape"))}),m?.addEventListener("click",t=>{t.stopPropagation()}),n.addEventListener("click",t=>{t.target instanceof HTMLElement&&t.target.hasAttribute("data-close")&&r("backdrop")}),document.addEventListener("cue:open",t=>{g(),e(t?.detail?.trigger||null)}),document.addEventListener("cue:close",t=>{r(t?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{g()}),document.addEventListener("cue:cancelled",()=>{r("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=r),document.addEventListener("reminder:save",t=>{if(!(y instanceof HTMLElement))return;let o=t?.detail?.trigger;o&&o!==y||y.matches(":disabled")||y.click()}),S instanceof HTMLFormElement&&y instanceof HTMLElement&&S.addEventListener("submit",t=>{t.preventDefault(),!y.matches(":disabled")&&y.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i()})();var T=()=>{T._initialised||(T._initialised=!0,M({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(i=>{console.error("Failed to initialise reminders:",i)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T,{once:!0}):T();(()=>{let i=document.getElementById("create-sheet");if(!(i instanceof HTMLElement))return;function n(){!i.classList.contains("open")&&i.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",n),document.addEventListener("reminders:updated",n)})();document.addEventListener("memoryCue:remindersUpdated",i=>{let n=document.getElementById("totalCount");if(!n)return;let d=Array.isArray(i?.detail?.items)?i.detail.items.length:0;n.textContent=String(d)});document.addEventListener("click",i=>{try{let n=i.target;if(!n)return;if(n instanceof HTMLElement&&n.id==="saveReminder"||n instanceof Element&&n.closest&&n.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:n});try{let d=document.createElement("div");d.textContent="Save clicked",d.style.position="fixed",d.style.right="16px",d.style.bottom="16px",d.style.background="rgba(34,197,94,0.95)",d.style.color="#fff",d.style.padding="8px 12px",d.style.borderRadius="8px",d.style.zIndex="99999",document.body.appendChild(d),setTimeout(()=>d.remove(),900)}catch{}}}catch{}});(function(){let i=document.getElementById("reminderList");if(!i)return;let n=Array.from(i.children);if(n.length<=30)return;let d=20;i.innerHTML="";let m=0;function f(){let y=n.slice(m,m+d);y.forEach(a=>i.appendChild(a)),m+=y.length}f();let u=document.createElement("div");u.id="listSentinel",i.appendChild(u);let S=new IntersectionObserver(y=>{y.some(a=>a.isIntersecting)&&m<n.length&&(f(),m>=n.length&&S.disconnect())});S.observe(u)})();(function(){let i=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),n=document.getElementById("settingsModal"),d=document.getElementById("closeSettings");if(!i||!n||!d)return;function m(){n.classList.remove("hidden")}function f(){n.classList.add("hidden")}i.addEventListener("click",m),d.addEventListener("click",f),n.addEventListener("click",u=>{u.target instanceof HTMLElement&&u.target.matches("[data-close]")&&f()}),n.addEventListener("keydown",u=>{u.key==="Escape"&&f()})})();(function(){let i=document.getElementById("syncStatus"),n=document.getElementById("syncUrl"),d=document.getElementById("saveSyncSettings"),m=document.getElementById("testSync"),f=document.getElementById("syncAll"),u="syncUrl";if(!i)return;let S=["online","error"],y=null;function a(e,r){y=e,S.forEach(s=>i.classList.remove(s)),e==="online"?i.classList.add("online"):e==="error"&&i.classList.add("error");let t={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},o=typeof r=="string"&&r.trim()?r:t[e]||"";o&&(i.textContent=o),i.dataset.state=e}function A(){y!=="syncing"&&(navigator.onLine?y!=="online"&&a("online"):a("offline"))}function L(e){typeof localStorage>"u"||(e?localStorage.setItem(u,e):localStorage.removeItem(u))}function b(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(u)||""}catch{return""}}function k(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,t=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!t)return null;let o=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,s=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",l=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",c=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:t,dueIso:o&&o.trim()?o.trim():null,priority:s,category:l,done:c}}function I(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let t=r.dataset||{},o=null;if(t.reminder)try{o=JSON.parse(t.reminder)}catch{o=null}let s=o||{id:t.id||t.reminderId||r.getAttribute("data-id")||null,title:t.title||t.reminderTitle||"",dueIso:t.due||t.reminderDue||r.getAttribute("data-due")||null,priority:t.priority||t.reminderPriority||r.getAttribute("data-priority")||"",category:t.category||t.reminderCategory||r.getAttribute("data-category")||"",done:t.done==="true"||t.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!s.title){let l=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");l&&(s.title=l.textContent.trim())}if(!s.dueIso){let l=r.querySelector("[data-due], time");if(l){let c=l.getAttribute("datetime")||l.getAttribute("data-due");s.dueIso=c||l.textContent.trim()}}return k(s)}).filter(Boolean):[]}function p(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(o=>{if(!r.has(o)){r.add(o);try{let s=localStorage.getItem(o);if(!s)return;let l=JSON.parse(s);Array.isArray(l)?l.forEach(c=>e.push(c)):l&&typeof l=="object"&&(Array.isArray(l.items)&&l.items.forEach(c=>e.push(c)),Array.isArray(l.reminders)&&l.reminders.forEach(c=>e.push(c)))}catch{}}}),!e.length)for(let o=0;o<localStorage.length;o+=1){let s=localStorage.key(o);if(!(!s||r.has(s)||!/remind/i.test(s))){r.add(s);try{let l=localStorage.getItem(s);if(!l)continue;let c=JSON.parse(l);Array.isArray(c)?c.forEach(E=>e.push(E)):c&&typeof c=="object"&&(Array.isArray(c.items)&&c.items.forEach(E=>e.push(E)),Array.isArray(c.reminders)&&c.reminders.forEach(E=>e.push(E)))}catch{}}}return e.map(k).filter(Boolean)}function B(){let e=I();return e.length?e:p()}function g(e){e?(f?.setAttribute("aria-busy","true"),f?.setAttribute("disabled","disabled"),m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled")):(f?.removeAttribute("aria-busy"),m?.removeAttribute("aria-busy"),h())}function h(){!!((n?.value||"").trim()||b())?(f?.removeAttribute("disabled"),m?.removeAttribute("disabled")):(f?.setAttribute("disabled","disabled"),m?.setAttribute("disabled","disabled"))}let C=b();n&&C&&(n.value=C),h(),a(navigator.onLine?"online":"offline"),window.addEventListener("online",A),window.addEventListener("offline",A),n?.addEventListener("input",h),d?.addEventListener("click",()=>{let e=(n?.value||"").trim();if(!e){L(""),a("info","Sync URL cleared. Add a new one to enable syncing."),h();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{a("error","Enter a valid Apps Script URL before saving.");return}L(e),a("online","Sync settings saved."),h()}),m?.addEventListener("click",async()=>{let e=(n?.value||b()).trim();if(!e){a("error","Add your Apps Script URL in Settings first.");return}g(!0),a("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?a("online","Connection looks good."):a("error","Test failed. Please check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),a("error","Test failed. Please check your Apps Script deployment.")}finally{g(!1)}}),f?.addEventListener("click",async()=>{let e=(n?.value||b()).trim();if(!e){a("error","Add your Apps Script URL in Settings first.");return}let r=B();if(!r.length){a("info","No reminders to sync right now.");return}g(!0),a("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let t=20,o=0,s=0,l=c=>({id:c.id,title:c.title,dueIso:c.dueIso||null,priority:c.priority||"Medium",category:c.category||"General",done:!!c.done,source:"memory-cue-mobile"});try{for(let c=0;c<r.length;c+=t){let E=r.slice(c,c+t);(await Promise.allSettled(E.map(v=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l(v))})))).forEach(v=>{v.status==="fulfilled"&&v.value?.ok?o+=1:(v.status,s+=1)}),await new Promise(v=>setTimeout(v,300))}s?o?a("error",`Partial sync: ${o} success, ${s} failed.`):a("error","Sync failed. Please check your Apps Script URL and try again."):a("online",`Sync complete. ${o} reminder${o===1?"":"s"} updated.`)}catch(c){console.error("Sync failed",c),a("error","Sync failed. Please try again in a moment.")}finally{g(!1)}})})()});export default x();
