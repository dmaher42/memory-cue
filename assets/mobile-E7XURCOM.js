import{a as x,b as H}from"./chunk-F2LMWVRZ.js";import{a as M,b as U}from"./chunk-ERL7JLDU.js";import{b as R}from"./chunk-RCZ4YZVR.js";var O=R(()=>{U();H();M();(function(){let r=()=>{let n=document.getElementById("create-sheet"),u=document.getElementById("closeCreateSheet");if(!(n instanceof HTMLElement)||!(u instanceof HTMLElement)){let t=typeof r._retryCount=="number"?r._retryCount:0;t<10&&(r._retryCount=t+1,setTimeout(r,50));return}if(r._initialised)return;r._initialised=!0;let m=n.querySelector("[data-dialog-content]"),y=n.querySelector(".sheet-backdrop"),s=document.getElementById("fabCreate"),d=document.getElementById("createReminderForm"),g=document.getElementById("saveReminder"),l=document.getElementById("priority"),A=document.getElementById("priorityChips"),L=A?Array.from(A.querySelectorAll('input[name="priority"]')):[],v=new Set([...s?[s]:[],...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),k=Array.from(v).filter(t=>t instanceof HTMLElement),I=()=>{n.classList.add("hidden"),n.setAttribute("hidden",""),n.setAttribute("aria-hidden","true"),n.removeAttribute("open"),n.classList.remove("open")};I();let p=null,B=(t,i)=>{try{document.dispatchEvent(new CustomEvent(t,{detail:i}))}catch(c){console.warn(`${t} dispatch failed`,c)}},S=()=>{let t=l?.value||"Medium";L.forEach(i=>{let c=i.value===t;i.checked=c,i.setAttribute("aria-checked",c?"true":"false")})},h=t=>{l&&(l.value!==t&&(l.value=t,l.dispatchEvent(new Event("change",{bubbles:!0}))),S())};L.forEach(t=>{t.addEventListener("change",()=>{t.checked&&h(t.value)})}),l?.addEventListener("change",S),S();let C=()=>{let t=n.querySelector('input, textarea, select, button, [contenteditable="true"]');t instanceof HTMLElement&&setTimeout(()=>{try{t.focus()}catch{}},0)},e=t=>{p=t instanceof HTMLElement?t:null,n.classList.remove("hidden"),n.removeAttribute("hidden"),n.setAttribute("aria-hidden","false"),n.setAttribute("open",""),n.classList.add("open"),s&&s.setAttribute("aria-expanded","true"),p&&p!==s&&p.setAttribute("aria-expanded","true"),S(),C(),B("reminder:sheet-opened",{trigger:p})},o=(t="dismissed")=>{let i=!n.classList.contains("hidden");I(),s&&s.setAttribute("aria-expanded","false"),p&&p!==s&&p.setAttribute("aria-expanded","false");let c=p&&document.body.contains(p)&&p||s;if(c&&typeof c.focus=="function")try{c.focus()}catch{}i&&B("reminder:sheet-closed",{reason:t,trigger:p}),p=null};k.forEach(t=>{t.addEventListener("click",i=>{i.preventDefault(),e(t)})}),u.addEventListener("click",t=>{t.preventDefault(),o("close-button")}),y?.addEventListener("click",t=>{t.target===y&&o("backdrop")}),n.addEventListener("keydown",t=>{t.key==="Escape"&&(t.stopPropagation(),o("escape"))}),m?.addEventListener("click",t=>{t.stopPropagation()}),n.addEventListener("click",t=>{t.target instanceof HTMLElement&&t.target.hasAttribute("data-close")&&o("backdrop")}),document.addEventListener("cue:open",t=>{S(),e(t?.detail?.trigger||null)}),document.addEventListener("cue:close",t=>{o(t?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{S()}),document.addEventListener("cue:cancelled",()=>{o("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=o),document.addEventListener("reminder:save",t=>{if(!(g instanceof HTMLElement))return;let i=t?.detail?.trigger;i&&i!==g||g.matches(":disabled")||g.click()}),d instanceof HTMLFormElement&&g instanceof HTMLElement&&d.addEventListener("submit",t=>{t.preventDefault(),!g.matches(":disabled")&&g.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r()})();var T=()=>{T._initialised||(T._initialised=!0,x({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(r=>{console.error("Failed to initialise reminders:",r)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T,{once:!0}):T();(()=>{try{let r=document.getElementById("headerActionsToggle"),n=document.getElementById("headerActionsMenu");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;let u=["button","[href]",'[tabindex]:not([tabindex="-1"])'],m=()=>{for(let d of u){let g=n.querySelector(d);if(g instanceof HTMLElement&&!g.hasAttribute("disabled")){try{g.focus({preventScroll:!0})}catch{g.focus()}return}}},y=()=>{n.classList.remove("hidden"),r.setAttribute("aria-expanded","true"),m()},s=()=>{n.classList.contains("hidden")||(n.classList.add("hidden"),r.setAttribute("aria-expanded","false"))};r.addEventListener("click",d=>{d.stopPropagation(),n.classList.contains("hidden")?y():s()}),r.addEventListener("keydown",d=>{d.key==="Escape"?(s(),r.focus({preventScroll:!0})):(d.key==="ArrowDown"||d.key==="Enter"||d.key===" ")&&n.classList.contains("hidden")&&(d.preventDefault(),y())}),n.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.closest("button")&&s()}),document.addEventListener("click",d=>{d.target instanceof Node&&(n.contains(d.target)||d.target===r)||s()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&s()})}catch(r){console.error("[headerActions] init failed",r)}})();(()=>{let r=document.getElementById("toggleReminderFilters"),n=document.getElementById("reminderFilters");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;let u=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],m=()=>{let s=n.hasAttribute("open");r.setAttribute("aria-expanded",String(s)),r.classList.toggle("btn-active",s)},y=()=>{for(let s of u){let d=n.querySelector(s);if(d instanceof HTMLElement&&!d.hasAttribute("disabled")){try{d.focus({preventScroll:!0})}catch{d.focus()}return}}};r.addEventListener("click",()=>{let s=n.hasAttribute("open");n.open=!s,s||y(),m()}),n.addEventListener("toggle",m),m()})();(()=>{let r=document.getElementById("create-sheet");if(!(r instanceof HTMLElement))return;function n(){!r.classList.contains("open")&&r.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",n),document.addEventListener("reminders:updated",n)})();document.addEventListener("memoryCue:remindersUpdated",r=>{let n=document.getElementById("totalCount");if(!n)return;let u=Array.isArray(r?.detail?.items)?r.detail.items.length:0;n.textContent=String(u)});document.addEventListener("click",r=>{try{let n=r.target;if(!n)return;if(n instanceof HTMLElement&&n.id==="saveReminder"||n instanceof Element&&n.closest&&n.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:n});try{let u=document.createElement("div");u.textContent="Save clicked",u.style.position="fixed",u.style.right="16px",u.style.bottom="16px",u.style.background="rgba(34,197,94,0.95)",u.style.color="#fff",u.style.padding="8px 12px",u.style.borderRadius="8px",u.style.zIndex="99999",document.body.appendChild(u),setTimeout(()=>u.remove(),900)}catch{}}}catch{}});(function(){let r=document.getElementById("reminderList");if(!r)return;let n=Array.from(r.children);if(n.length<=30)return;let u=20;r.innerHTML="";let m=0;function y(){let g=n.slice(m,m+u);g.forEach(l=>r.appendChild(l)),m+=g.length}y();let s=document.createElement("div");s.id="listSentinel",r.appendChild(s);let d=new IntersectionObserver(g=>{g.some(l=>l.isIntersecting)&&m<n.length&&(y(),m>=n.length&&d.disconnect())});d.observe(s)})();(function(){let r=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),n=document.getElementById("settingsModal"),u=document.getElementById("closeSettings");if(!r||!n||!u)return;function m(){n.classList.remove("hidden")}function y(){n.classList.add("hidden")}r.addEventListener("click",m),u.addEventListener("click",y),n.addEventListener("click",s=>{s.target instanceof HTMLElement&&s.target.matches("[data-close]")&&y()}),n.addEventListener("keydown",s=>{s.key==="Escape"&&y()})})();(function(){let r=document.getElementById("syncStatus"),n=document.getElementById("syncUrl"),u=document.getElementById("saveSyncSettings"),m=document.getElementById("testSync"),y=document.getElementById("syncAll"),s="syncUrl";if(!r)return;let d=["online","error"],g=null;function l(e,o){g=e,d.forEach(c=>r.classList.remove(c)),e==="online"?r.classList.add("online"):e==="error"&&r.classList.add("error");let t={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},i=typeof o=="string"&&o.trim()?o:t[e]||"";i&&(r.textContent=i),r.dataset.state=e}function A(){g!=="syncing"&&(navigator.onLine?g!=="online"&&l("online"):l("offline"))}function L(e){typeof localStorage>"u"||(e?localStorage.setItem(s,e):localStorage.removeItem(s))}function v(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(s)||""}catch{return""}}function k(e){if(!e||typeof e!="object")return null;let o=e.id||e.uid||e.key||e.slug||e.uuid,t=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!t)return null;let i=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,c=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",f=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",a=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:o||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:t,dueIso:i&&i.trim()?i.trim():null,priority:c,category:f,done:a}}function I(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(o=>{let t=o.dataset||{},i=null;if(t.reminder)try{i=JSON.parse(t.reminder)}catch{i=null}let c=i||{id:t.id||t.reminderId||o.getAttribute("data-id")||null,title:t.title||t.reminderTitle||"",dueIso:t.due||t.reminderDue||o.getAttribute("data-due")||null,priority:t.priority||t.reminderPriority||o.getAttribute("data-priority")||"",category:t.category||t.reminderCategory||o.getAttribute("data-category")||"",done:t.done==="true"||t.reminderDone==="true"||o.getAttribute("data-done")==="true"};if(!c.title){let f=o.querySelector("[data-reminder-title], [data-title], h3, h4, strong");f&&(c.title=f.textContent.trim())}if(!c.dueIso){let f=o.querySelector("[data-due], time");if(f){let a=f.getAttribute("datetime")||f.getAttribute("data-due");c.dueIso=a||f.textContent.trim()}}return k(c)}).filter(Boolean):[]}function p(){if(typeof localStorage>"u")return[];let e=[],o=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(i=>{if(!o.has(i)){o.add(i);try{let c=localStorage.getItem(i);if(!c)return;let f=JSON.parse(c);Array.isArray(f)?f.forEach(a=>e.push(a)):f&&typeof f=="object"&&(Array.isArray(f.items)&&f.items.forEach(a=>e.push(a)),Array.isArray(f.reminders)&&f.reminders.forEach(a=>e.push(a)))}catch{}}}),!e.length)for(let i=0;i<localStorage.length;i+=1){let c=localStorage.key(i);if(!(!c||o.has(c)||!/remind/i.test(c))){o.add(c);try{let f=localStorage.getItem(c);if(!f)continue;let a=JSON.parse(f);Array.isArray(a)?a.forEach(E=>e.push(E)):a&&typeof a=="object"&&(Array.isArray(a.items)&&a.items.forEach(E=>e.push(E)),Array.isArray(a.reminders)&&a.reminders.forEach(E=>e.push(E)))}catch{}}}return e.map(k).filter(Boolean)}function B(){let e=I();return e.length?e:p()}function S(e){e?(y?.setAttribute("aria-busy","true"),y?.setAttribute("disabled","disabled"),m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled")):(y?.removeAttribute("aria-busy"),m?.removeAttribute("aria-busy"),h())}function h(){!!((n?.value||"").trim()||v())?(y?.removeAttribute("disabled"),m?.removeAttribute("disabled")):(y?.setAttribute("disabled","disabled"),m?.setAttribute("disabled","disabled"))}let C=v();n&&C&&(n.value=C),h(),l(navigator.onLine?"online":"offline"),window.addEventListener("online",A),window.addEventListener("offline",A),n?.addEventListener("input",h),u?.addEventListener("click",()=>{let e=(n?.value||"").trim();if(!e){L(""),l("info","Sync URL cleared. Add a new one to enable syncing."),h();return}try{let o=new URL(e);if(!/^https?:/.test(o.protocol))throw new Error("Invalid protocol")}catch{l("error","Enter a valid Apps Script URL before saving.");return}L(e),l("online","Sync settings saved."),h()}),m?.addEventListener("click",async()=>{let e=(n?.value||v()).trim();if(!e){l("error","Add your Apps Script URL in Settings first.");return}S(!0),l("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?l("online","Connection looks good."):l("error","Test failed. Please check your Apps Script deployment.")}catch(o){console.error("Test sync failed",o),l("error","Test failed. Please check your Apps Script deployment.")}finally{S(!1)}}),y?.addEventListener("click",async()=>{let e=(n?.value||v()).trim();if(!e){l("error","Add your Apps Script URL in Settings first.");return}let o=B();if(!o.length){l("info","No reminders to sync right now.");return}S(!0),l("syncing",`Syncing ${o.length} reminder${o.length===1?"":"s"}\u2026`);let t=20,i=0,c=0,f=a=>({id:a.id,title:a.title,dueIso:a.dueIso||null,priority:a.priority||"Medium",category:a.category||"General",done:!!a.done,source:"memory-cue-mobile"});try{for(let a=0;a<o.length;a+=t){let E=o.slice(a,a+t);(await Promise.allSettled(E.map(b=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f(b))})))).forEach(b=>{b.status==="fulfilled"&&b.value?.ok?i+=1:(b.status,c+=1)}),await new Promise(b=>setTimeout(b,300))}c?i?l("error",`Partial sync: ${i} success, ${c} failed.`):l("error","Sync failed. Please check your Apps Script URL and try again."):l("online",`Sync complete. ${i} reminder${i===1?"":"s"} updated.`)}catch(a){console.error("Sync failed",a),l("error","Sync failed. Please try again in a moment.")}finally{S(!1)}})})()});export default O();
