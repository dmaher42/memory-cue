import{b as wn,c as Mo}from"./chunk-QHE5AMPX.js";import{a as qi,b as Kn,c as Bo}from"./chunk-GUVSRPRW.js";function Wi(o={}){try{Object.assign(W,o||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function Vi(o={}){try{if(W&&typeof W.signInWithPopup=="function"&&W.auth&&typeof W.GoogleAuthProvider=="function")return W.signInWithPopup(W.auth,new W.GoogleAuthProvider);if(W&&typeof W.signInWithRedirect=="function"&&W.auth&&typeof W.GoogleAuthProvider=="function")return W.signInWithRedirect(W.auth,new W.GoogleAuthProvider);let r=wn();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...o});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{W?.toast?.("Sign-in failed")}catch(d){console.warn("[supabase-auth] toast handler failed",d)}throw r}return Promise.resolve(null)}async function Yi(){try{if(W&&typeof W.signOut=="function")return W.signOut(W.auth);let o=wn();if(o&&o.auth&&typeof o.auth.signOut=="function")return o.auth.signOut()}catch(o){throw console.error("[supabase-auth] startSignOutFlow error",o),o}return Promise.resolve(null)}function Po(o){return o?Array.isArray(o)?o:[o]:[]}function Dt(o){return Array.from(new Set(o.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function ye(o,r){let d=Po(r).filter(Boolean);if(!d.length)return[];let g=d.flatMap(L=>Array.from(o.querySelectorAll(L)));return Dt(g)}function _o(o,r=document){let d=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:ye(d,o.authForm),emailInputs:ye(d,o.emailInput),signInButtons:ye(d,o.signInButtons),signOutButtons:ye(d,o.signOutButtons),userBadges:ye(d,o.userBadge),userBadgeEmails:ye(d,o.userBadgeEmail),userBadgeInitials:ye(d,o.userBadgeInitial),userNameEls:ye(d,o.userName),syncStatusEls:ye(d,o.syncStatus),syncStatusTextEls:ye(d,o.syncStatusText),statusIndicatorEls:ye(d,o.statusIndicator),feedbackEls:ye(d,o.feedback)}}function Ct(o,r){Dt(Array.isArray(o)?o:[o]).forEach(d=>{d instanceof HTMLElement&&(d.classList.toggle("hidden",!r),r?d.removeAttribute("hidden"):d.setAttribute("hidden",""))})}function $e(o,r){Dt(Array.isArray(o)?o:[o]).forEach(d=>{d instanceof HTMLElement&&(d.textContent=r||"")})}function Ho(o,r){Dt(o).forEach(d=>{d instanceof HTMLElement&&(d.dataset.state=r,d.classList.toggle("online",r==="online"),d.classList.toggle("offline",r!=="online"))})}function kt(o,r){Dt(o).forEach(d=>{if(!(d instanceof HTMLElement))return;d.textContent=r||"";let g=!!r;d.classList.toggle("hidden",!g),g?d.removeAttribute("hidden"):d.setAttribute("hidden","")})}function Gi(o={}){let r={...ji.syncStatusText,...o.syncStatusText||{}};return{...ji,...o,syncStatusText:r}}function xt(o,{user:r,messages:d}={}){let g=Gi(d),L=!!r;Ct(o.signInButtons,!L),Ct(o.authForms,!L),Ct(o.signOutButtons,L),Ct(o.userBadges,L);let O=typeof r?.email=="string"?r.email:"",_=O?O.charAt(0).toUpperCase():"U";L?($e(o.userBadgeEmails,O),$e(o.userBadgeInitials,_),$e(o.userNameEls,O)):($e(o.userBadgeEmails,""),$e(o.userBadgeInitials,""),$e(o.userNameEls,""));let $=typeof g.signedIn=="function"?g.signedIn(r):g.signedIn,P=typeof g.signedOut=="function"?g.signedOut(r):g.signedOut,ae=L?$:P,fe=!L;o.syncStatusEls.length&&($e(o.syncStatusEls,ae),o.syncStatusEls.forEach(xe=>{xe instanceof HTMLElement&&(xe.classList.toggle("online",L),xe.dataset.state=L?"online":"offline")}),Ct(o.syncStatusEls,fe));let k=L?g.syncStatusText?.signedIn:g.syncStatusText?.signedOut;$e(o.syncStatusTextEls,k||""),Ho(o.statusIndicatorEls,L?"online":"offline"),kt(o.feedbackEls,"")}function Uo(o,r){r.authForms.forEach(d=>{!(d instanceof HTMLFormElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("submit",async g=>{g.preventDefault();let L=r.emailInputs.find(_=>d.contains(_))||d.querySelector('input[type="email"]'),O=typeof L?.value=="string"?L.value.trim():"";if(!O){kt(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:_}=await o.auth.signInWithOtp({email:O});_?kt(r.feedbackEls,_.message||"Unable to send magic link."):kt(r.feedbackEls,"Magic link sent. Check your email.")}catch(_){kt(r.feedbackEls,_?.message||"Unable to send magic link.")}}))})}function $o(o,r){r.signOutButtons.forEach(d=>{!(d instanceof HTMLElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("click",async()=>{try{await o.auth.signOut()}catch(g){console.error("[supabase] Sign-out failed.",g)}}))})}function rs(o={}){let{supabase:r,scope:d=document,selectors:g={},messages:L={},disableButtonBinding:O=!1,onSessionChange:_}=o,$={...Oo,...g},P=_o($,d),ae=Gi(L);xt(P,{user:null,messages:ae});let fe=r||wn()||(typeof window<"u"?window.supabase:null);if(!fe)return{supabase:null,elements:P,applyAuthState:me=>xt(P,{...me,messages:ae}),destroy(){}};Uo(fe,P),O||$o(fe,P);let k=[],{data:xe}=fe.auth.onAuthStateChange((me,we)=>{if(xt(P,{user:we?.user??null,messages:ae}),typeof _=="function")try{_(we?.user??null,we)}catch(at){console.error("[supabase] onSessionChange handler failed.",at)}});return xe?.subscription&&k.push(()=>{try{xe.subscription.unsubscribe()}catch{}}),fe.auth.getSession().then(({data:me,error:we})=>{we||xt(P,{user:me?.session?.user??null,messages:ae})}).catch(me=>{console.error("[supabase] getSession failed.",me)}),{supabase:fe,elements:P,applyAuthState:me=>xt(P,{...me,messages:ae}),destroy(){k.forEach(me=>{try{me()}catch{}})}}}var W,Oo,ji,Ki=Kn(()=>{Mo();W={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};Oo={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},ji={signedOut:"",signedIn:o=>`Reminders syncing for ${o?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Ji=Bo((ss,Nt)=>{var vn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function zi(o){if(!o||typeof o!="object")return null;let r=Object.entries(o).filter(([d,g])=>typeof g=="string"&&g.trim()!=="");return r.length?Object.fromEntries(r):null}function qo(){let o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=zi(o?.__FIREBASE_CONFIG);if(r)return r;let d=zi(o?.__ENV?.FIREBASE_CONFIG);if(d)return d;let L=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((O,[_,$])=>{let P=o?.__ENV?.[_]??o?.[_];return typeof P=="string"&&P.trim()!==""&&(O[$]=P),O},{});return Object.keys(L).length?L:null}function Xi(){let o=qo();return o?{...vn,...o}:{...vn}}var Qi={DEFAULT_FIREBASE_CONFIG:vn,getFirebaseConfig:Xi};if(typeof globalThis<"u"){let o=globalThis;o.memoryCueFirebase=o.memoryCueFirebase||{},o.memoryCueFirebase.getFirebaseConfig=Xi,o.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=vn}typeof Nt<"u"&&Nt.exports&&(Nt.exports=Qi,Nt.exports.default=Qi)});function J(o){if(!Array.isArray(o))return null;let r=o.map(d=>Number(d)).filter(d=>Number.isFinite(d));return r.length?r:null}async function rr(o){return typeof o=="string"?o.trim():"",null}function Wo(o,r){let d=J(o),g=J(r);if(!d||!g||d.length!==g.length)return 0;let L=0,O=0,_=0;for(let $=0;$<d.length;$+=1)L+=d[$]*g[$],O+=d[$]*d[$],_+=g[$]*g[$];return!O||!_?0:L/(Math.sqrt(O)*Math.sqrt(_))}async function nr(o){if(!o||typeof o!="object")return o;let r=J(o.semanticEmbedding);if(r)return o.semanticEmbedding=r,o;let d=[o.title,o.bodyText,o.body,o.notes].filter(L=>typeof L=="string"&&L.trim()).join(`
`).trim();if(!d)return o;let g=J(await rr(d));return g&&(o.semanticEmbedding=g),o}function Yo(){if(Ce)return{...Ce};let r=ti()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return Ce=r.getFirebaseConfig(),{...Ce};if(typeof qi=="function")try{let d=Ji();if(d){let g=typeof d.getFirebaseConfig=="function"?d.getFirebaseConfig:typeof d.default?.getFirebaseConfig=="function"?d.default.getFirebaseConfig:null;if(g)return Ce=g(),{...Ce}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(Ce={...r.DEFAULT_FIREBASE_CONFIG},{...Ce}):(Ce={...Vo},{...Ce})}function ti(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function or(){let o=ti(),r=o&&o.TimestampTrigger;return typeof r=="function"?r:null}function Me(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!or()}function Go(){if(typeof window>"u"||!window.location)return zn;try{return new URL(zn,window.location.href).href}catch{return zn}}async function qe(){return En||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(En=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Go()),await navigator.serviceWorker.ready}catch(o){return console.warn("Service worker registration failed",o),null}})(),En))}async function ir(o){if(!o||typeof o!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await qe();if(!r)return!1;let d=new Set;navigator.serviceWorker.controller&&d.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(L=>{let O=r[L];O&&d.add(O)});let g=!1;return d.forEach(L=>{try{L.postMessage(o),g=!0}catch(O){console.warn("Failed posting message to service worker",O)}}),g}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function Sn(){if(Me())return!1;if(Xn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Rt)try{return await Rt}catch{}Rt=(async()=>{let o=await qe();if(!o)return!1;let r=!1;if("periodicSync"in o)try{let d=await o.periodicSync.getTags();(!Array.isArray(d)||!d.includes(Qn))&&await o.periodicSync.register(Qn,{minInterval:15*60*1e3}),r=!0}catch(d){console.warn("Periodic background sync unavailable",d)}if(!r&&"sync"in o)try{await o.sync.register(Qn),r=!0}catch(d){console.warn("Background sync unavailable",d)}return r})();try{let o=await Rt;return o&&(Xn=!0),o}catch(o){return console.warn("Background reminder sync setup failed",o),Xn=!1,!1}finally{Rt=null}}async function Zn(o=[],{requestCheck:r=!1}={}){if(!Me()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let d=await qe();if(!d)return;let g=await ir({type:tr.updateScheduledReminders,reminders:Array.isArray(o)?o:[]});if(r&&await ir({type:tr.checkScheduledReminders}),!g&&typeof d.update=="function")try{await d.update()}catch{}}catch(d){console.warn("Failed syncing reminders with service worker",d)}}async function ei(o,r){if(Me())try{let d=r||await qe();if(!d)return;let g=[];try{g=await d.getNotifications({tag:o,includeTriggered:!0})}catch{g=await d.getNotifications({tag:o})}for(let L of g)try{L.close()}catch{}}catch{}}function sr(){for(let o of Array.from(Be.values()))try{o.close()}catch{}Be.clear()}function Ko(){if(er||typeof window>"u"||typeof window.addEventListener!="function")return;let o=()=>sr();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,o)}catch{}}),er=!0}function te(o){if(typeof o=="string"){let r=o.replace(/\s+/g," ").trim();if(r)return r}return z}async function ds(o={}){let r=e=>e?document.querySelector(e):null,d=e=>e?Array.from(document.querySelectorAll(e)):[],g=r(o.titleSel),L=r(o.dateSel),O=r(o.timeSel),_=r(o.detailsSel),$=r(o.prioritySel),P=r(o.categorySel),ae=r(o.saveBtnSel),fe=r(o.cancelEditBtnSel),k=r(o.listSel),xe="reminder-title-pinned",me="reminder-title-unpinned",we=r(o.detailPanelSel),at=r(o.detailEmptySel),An=r(o.detailContentSel),Ft=r(o.detailTitleSel),Bt=r(o.detailDueSel),Mt=r(o.detailPrioritySel),Ot=r(o.detailCategorySel),ke=r(o.detailNotesSel),ii=ke?.dataset?.placeholder||"No notes added yet.",ar=r(o.detailClearSel),Pt=d(o.googleSignInBtnSel),_t=d(o.googleSignOutBtnSel),q=r(o.statusSel),Q=r(o.syncStatusSel),dr={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},cr=6e3,pe=null,Ht=null;function Ke(e,{clearMessage:t=!0}={}){pe&&(e&&pe.tokenId!==e||(pe.timeoutId&&clearTimeout(pe.timeoutId),t&&q&&q.dataset.undoToken===pe.tokenId&&(typeof q.replaceChildren=="function"?q.replaceChildren():q.textContent="",delete q.dataset.undoToken,delete q.dataset.statusKind),pe=null))}function lr(e){if(!q)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Io(e.tokenId)),e.button=i,typeof q.replaceChildren=="function"?q.replaceChildren(t,n,i):(q.textContent="",q.append(t,n,i)),q.dataset.statusKind="undo",q.dataset.undoToken=e.tokenId}function dt(e){if(!we)return;let t=!!e;if(we.dataset.state=t?"active":"empty",we.dataset.selectedId=t&&e?.id?e.id:"",at&&(at.classList.toggle("hidden",t),at.setAttribute("aria-hidden",t?"true":"false")),An&&(An.classList.toggle("hidden",!t),An.setAttribute("aria-hidden",t?"false":"true")),!t){Ft&&(Ft.textContent=""),Bt&&(Bt.textContent=""),Mt&&(Mt.textContent=""),Ot&&(Ot.textContent=""),ke&&(ke.textContent=ii,ke.dataset.empty="true");return}if(Ft&&(Ft.textContent=e.title||"Untitled reminder"),Bt&&(Bt.textContent=Mi(e)),Mt&&(Mt.textContent=e.priority||"Medium"),Ot&&(Ot.textContent=e.category||z),ke){let n=typeof e.notes=="string"?e.notes.trim():"";n?(ke.textContent=n,ke.dataset.empty="false"):(ke.textContent=ii,ke.dataset.empty="true")}}function ri(){Ht=null,dt(null)}function ur(e){Ht=e?.id||null,dt(e||null)}function fr(){if(!we)return;if(!Ht){dt(null);return}let e=p.find(t=>t?.id===Ht);if(e){dt(e);return}ri()}dt(null);function Tn(e,t){if(!Q)return;let n=["online","offline","error"];n.forEach(a=>Q.classList.remove(a)),n.includes(e)&&Q.classList.add(e),Q.dataset.state=e;let i=typeof t=="string"?t:dr[e]||"";e==="online"||e==="offline"?(Q.textContent="",Q.dataset.compact="true",i?(Q.setAttribute("aria-label",i),Q.setAttribute("title",i)):(Q.removeAttribute("aria-label"),Q.removeAttribute("title"))):(Q.textContent=i,Q.removeAttribute("data-compact"),i?(Q.setAttribute("aria-label",i),Q.setAttribute("title",i)):(Q.removeAttribute("aria-label"),Q.removeAttribute("title")))}let ie=r(o.notesSel),mr=r(o.saveNotesBtnSel),pr=r(o.loadNotesBtnSel),oi=r(o.countTotalSel),Ut=r(o.googleUserNameSel),je=r(o.dateFeedbackSel),de=r(o.voiceBtnSel),gr=r(o.notifBtnSel),ct=r(o.moreBtnSel),lt=r(o.moreMenuSel),hr=r(o.copyMtlBtnSel),In=r(o.importFileSel),yr=r(o.exportBtnSel),br=r(o.syncAllBtnSel),ze=r(o.syncUrlInputSel),wr=r(o.saveSettingsSel),vr=r(o.testSyncSel),Er=d(o.openSettingsSel),$t=r(o.settingsSectionSel),Qe=r(o.emptyStateSel),si=r(o.listWrapperSel),Ln=r(o.categoryOptionsSel),re=r(o.plannerContextSel),V=r(o.plannerLessonInputSel),oe=o.variant||"mobile",Sr=typeof o.autoWireAuthButtons=="boolean"?o.autoWireAuthButtons:oe!=="desktop",ut="all",Cn=[],xn="";function Ar(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function Xe(){if(oe!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=Ar(),n;ut==="today"?n=`Today\u2019s reminders \u2022 ${t}`:ut==="completed"?n=`Completed reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,xn&&(n+=` \u2022 ${xn}`),e.textContent=n}function Tr(){oe==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(s=>{if(!s.ok)throw new Error("Weather request failed");return s.json()}).then(s=>{s&&s.current_weather&&typeof s.current_weather.temperature=="number"&&(xn=`${Math.round(s.current_weather.temperature)}\xB0C`,Xe())}).catch(s=>{console.warn("Failed to fetch current temperature",s)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let ai="mc:lastDefaults",kn=()=>{re&&(re.classList.add("hidden"),re.setAttribute("aria-hidden","true"),typeof re.replaceChildren=="function"?re.replaceChildren():re.textContent=""),V&&(V.value="",V.dataset&&(delete V.dataset.lessonDayLabel,delete V.dataset.lessonTitle,delete V.dataset.lessonSummary))},Ir=(e={})=>{if(!re)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",s=document.createElement("p");s.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",s.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let c=i?document.createElement("p"):null;c&&(c.className="text-sm text-base-content/70",c.textContent=i),typeof re.replaceChildren=="function"?re.replaceChildren(...[s,a,c].filter(Boolean)):(re.textContent="",re.append(s,a),c&&re.append(c)),re.classList.remove("hidden"),re.removeAttribute("aria-hidden")},Lr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";g&&typeof e.reminderTitle=="string"&&(g.value=e.reminderTitle),_&&typeof e.reminderNotes=="string"&&(_.value=e.reminderNotes),L&&typeof e.dueDate=="string"&&(L.value=e.dueDate),V&&(V.value=t,V.dataset&&(V.dataset.lessonDayLabel=dayLabel,V.dataset.lessonTitle=lessonTitle,V.dataset.lessonSummary=summary)),Ir(e)};function Dn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(ai)||"{}")||{}}catch{return{}}}function Cr(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(ai,JSON.stringify(e))}catch{}}function xr(e){let t=Dn(),n={category:te(e?.category||t.category||z),priority:e?.priority||t.priority||"Medium"};Cr(n)}let di='fieldset#priorityChips input[name="priority"]';function qt(){try{let e=document.querySelector(`${di}:checked`);if(e&&e.value)return e.value}catch{}return $&&typeof $.value=="string"&&$.value?$.value:"Medium"}function jt(e){let t=e||"Medium";$&&typeof $.value<"u"&&($.value=t);try{let n=Array.from(document.querySelectorAll(di));if(!n.length)return;let i=!1;if(n.forEach(s=>{let a=s.value===t;s.checked=a,i=i||a}),!i){let s=n.find(a=>a.value==="Medium")||n[0];s&&(s.checked=!0)}}catch{}}function ci(){let e=Dn();e.category&&P&&(P.value=e.category),e.priority&&jt(e.priority)}ci();let kr=typeof document<"u"?document.getElementById("quickAddForm"):null,Z=typeof document<"u"?document.getElementById("quickAddInput"):null,Dr=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ce=typeof document<"u"?document.getElementById("quickAddVoice")||document.getElementById("voiceBtn"):null,Oe=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,Nn=null,ft="memoryCueNotes",li="memoryCueFolders",ui="Lesson \u2013 Reflections";function Nr(e){let t=typeof e=="string"?e:"",n=[{kind:"footy-drill",pattern:/^\s*footy\s+drill\s*:\s*/i},{kind:"reflection",pattern:/^\s*reflection\s*:\s*/i},{kind:"task",pattern:/^\s*task\s*:\s*/i}];for(let i of n)if(i.pattern.test(t))return{kind:i.kind,text:t.replace(i.pattern,"").trim()};return{kind:"default",text:t.trim()}}function Rn(e,t=[]){if(typeof localStorage>"u")return Array.isArray(t)?[...t]:[];try{let n=localStorage.getItem(e);if(!n)return Array.isArray(t)?[...t]:[];let i=JSON.parse(n);return Array.isArray(i)?i:Array.isArray(t)?[...t]:[]}catch{return Array.isArray(t)?[...t]:[]}}function Rr(){let t=Rn(li,[{id:"unsorted",name:"Unsorted",order:0}]).filter(c=>c&&typeof c=="object"&&typeof c.id=="string"),n=t.find(c=>c.name===ui);if(n?.id)return n.id;let i=new Set(t.map(c=>c.id)),s="lesson-reflections",a=1;for(;i.has(s);)a+=1,s=`lesson-reflections-${a}`;t.push({id:s,name:ui,order:t.length});try{localStorage.setItem(li,JSON.stringify(t))}catch{}return s}function Fr(e){let t=typeof e=="string"?e.trim():"";if(!t||typeof localStorage>"u")return null;let n=Rr(),i=Rn(ft,[]),s=new Date().toISOString(),a={id:cn(),title:t,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:s,folderId:n,semanticEmbedding:null};i.unshift(a);try{localStorage.setItem(ft,JSON.stringify(i))}catch{return null}return a}function Br(e,t){let n=Dn(),i=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||qt(),category:te(n.category||P?.value||z),notes:"",due:i,pinToToday:!1,semanticEmbedding:null}}function fi(e,t=null){let n=typeof e=="string"?e.trim():"";if(!n)return{keywordQuery:"",timeRange:null};let i=t instanceof Date&&!Number.isNaN(t.getTime())?new Date(t):new Date,s=n.toLowerCase(),a=/\b(monday|mon|tuesday|tue|tues|wednesday|wed|thursday|thu|thur|thurs|friday|fri|saturday|sat|sunday|sun)\b/i,c=/\b(\d{1,2})(?::(\d{2}))?\s*(am|pm)?\b/i,f=/\btoday\b/i,m=/\byesterday\b/i,l=s.match(a),h=s.match(c),I=s.match(f),T=s.match(m),U=()=>{if(!h)return null;let E=Number.parseInt(h[1],10),B=Number.parseInt(h[2]||"0",10),j=h[3]?h[3].toLowerCase():null;return!Number.isFinite(E)||!Number.isFinite(B)||B>59||(j==="pm"&&E<12?E+=12:j==="am"&&E===12&&(E=0),E>23)?null:{hours:E,minutes:B}},K=E=>String(E).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),v=()=>{let E=n;return l&&(E=E.replace(new RegExp(`\\b${K(l[0])}\\b`,"i")," ")),I&&(E=E.replace(new RegExp(`\\b${K(I[0])}\\b`,"i")," ")),T&&(E=E.replace(new RegExp(`\\b${K(T[0])}\\b`,"i")," ")),h&&(E=E.replace(new RegExp(K(h[0]),"i")," ")),E.replace(/\s+/g," ").trim()},w=(E=0)=>{let B=new Date(i);B.setHours(0,0,0,0),B.setDate(B.getDate()+E);let j=new Date(B);return j.setHours(23,59,59,999),{start:B.getTime(),end:j.getTime()}},F=U();if(l&&F){let E=l[1].slice(0,3).toLowerCase(),j={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[E];if(typeof j=="number"){let A=new Date(i),M=(j-A.getDay()+7)%7;return A.setDate(A.getDate()+M),A.setHours(F.hours,F.minutes,0,0),{keywordQuery:v(),timeRange:{start:A.getTime()-60*60*1e3,end:A.getTime()+60*60*1e3}}}}if(I||T){if(F){let E=new Date(i);return T&&E.setDate(E.getDate()-1),E.setHours(F.hours,F.minutes,0,0),{keywordQuery:v(),timeRange:{start:E.getTime()-60*60*1e3,end:E.getTime()+60*60*1e3}}}return{keywordQuery:v(),timeRange:w(T?-1:0)}}return{keywordQuery:n,timeRange:null}}function Mr(){let e=typeof document<"u"?document.getElementById("inboxSearchInput"):null,t=typeof document<"u"?document.getElementById("inboxSearchResults"):null,n=typeof document<"u"?document.getElementById("inboxSearchClear"):null;if(!e||!t)return;let i=()=>{if(typeof localStorage>"u")return[];try{let A=localStorage.getItem(ft),M=A?JSON.parse(A):[];return Array.isArray(M)?M:[]}catch{return[]}},s=A=>{if(!Number.isFinite(A))return"No date";try{return new Date(A).toLocaleString()}catch{return"No date"}},a=A=>String(A||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),c=(A,M)=>{let u=String(A||"");if(!M)return a(u);let y=u.toLowerCase(),x=M.toLowerCase(),C=y.indexOf(x);if(C<0)return a(u);let N=a(u.slice(0,C)),R=a(u.slice(C,C+M.length)),ue=a(u.slice(C+M.length));return`${N}<mark class="inbox-search-match">${R}</mark>${ue}`},f=()=>{let A=(Array.isArray(p)?p:[]).map(u=>({type:"Reminder",title:u?.title||"",body:u?.notes||"",timestamp:Number.isFinite(u?.createdAt)?u.createdAt:null,semanticEmbedding:J(u?.semanticEmbedding)})),M=i().map(u=>{let y=typeof u?.updatedAt=="string"?Date.parse(u.updatedAt):Number.NaN,x=typeof u?.createdAt=="string"?Date.parse(u.createdAt):Number.NaN;return{type:"Note",title:u?.title||"",body:u?.bodyText||u?.body||"",timestamp:Number.isFinite(y)?y:Number.isFinite(x)?x:null,semanticEmbedding:J(u?.semanticEmbedding)}});return[...A,...M]},m=[],l=-1,h=null,I=null,T=()=>{m=[],l=-1,h=null,t.innerHTML="",t.dataset.mode=""},U=(A,M={})=>{let u=Number.isFinite(M.limit)?M.limit:20,y=M.query||"",x=Number.isInteger(M.selectedIndex)?M.selectedIndex:-1,C=M.mode||"";if(t.innerHTML="",t.dataset.mode=C,!A.length){if(C==="autocomplete"){let R=document.createElement("div");R.className="inbox-search-empty text-xs opacity-70 py-2 px-2",R.textContent="No matches",t.appendChild(R)}return}let N=document.createDocumentFragment();A.slice(0,u).forEach((R,ue)=>{let S=document.createElement("li");S.className="inbox-search-result-item text-xs py-1 border-b border-base-300/60",C==="autocomplete"&&(S.classList.add("inbox-search-result-item--autocomplete"),S.setAttribute("role","option"),S.tabIndex=-1,ue===x&&S.classList.add("is-active"));let Ae=document.createElement("span");Ae.className="badge badge-outline badge-xs mr-2",Ae.textContent=R.type;let Te=document.createElement("span");Te.className="inbox-search-result-title",C==="autocomplete"?Te.innerHTML=c(R.title||"(untitled)",y):Te.textContent=R.title||"(untitled)";let hn=document.createElement("div");hn.className="opacity-70",hn.textContent=s(R.timestamp);let Ye=document.createElement("div");Ye.className="opacity-60 italic",Ye.textContent="Related results",C==="autocomplete"&&S.addEventListener("mousedown",rt=>{rt.preventDefault(),e.value=R.title||"",v(),T()}),S.appendChild(Ae),S.appendChild(Te),S.appendChild(hn),R.isSemanticMatch&&C!=="autocomplete"&&S.appendChild(Ye),N.appendChild(S)}),t.appendChild(N)};async function K(A,M,u=[]){let y=J(await rr(A));if(!y)return[];let x=.72,C=new Set(u);return M.filter(R=>!C.has(R)).map(R=>({entry:R,score:Wo(y,R.semanticEmbedding)})).filter(R=>R.score>=x).sort((R,ue)=>ue.score-R.score).map(R=>({...R.entry,isSemanticMatch:!0}))}let v=async()=>{let M=(e.value||"").trim();if(n&&(n.hidden=!M),!M){t.innerHTML="";return}let u=fi(M),y=(u.keywordQuery||"").toLowerCase().split(/\s+/).map(R=>R.trim()).filter(Boolean),x=f(),C=x.filter(R=>{let ue=`${R.title} ${R.body}`.toLowerCase();return!y.length||y.every(Ae=>ue.includes(Ae))?u.timeRange?Number.isFinite(R.timestamp)?R.timestamp>=u.timeRange.start&&R.timestamp<=u.timeRange.end:!1:!0:!1});C.sort((R,ue)=>(ue.timestamp||0)-(R.timestamp||0));let N=[...C];if(C.length<5){let R=await K(u.keywordQuery||M,x,C);N.push(...R)}U(N)},w=A=>{let M=A.toLowerCase(),u=f().filter(y=>{let x=String(y.title||"").toLowerCase(),C=String(y.body||"").toLowerCase();return x.includes(M)||C.includes(M)});return u.sort((y,x)=>{let C=String(y.title||"").toLowerCase(),N=String(x.title||"").toLowerCase(),R=String(y.body||"").toLowerCase(),ue=String(x.body||"").toLowerCase(),S=C.startsWith(M)||R.startsWith(M),Ae=N.startsWith(M)||ue.startsWith(M);return S!==Ae?S?-1:1:(x.timestamp||0)-(y.timestamp||0)}),u.slice(0,8)},F=A=>{m=w(A),l=m.length?0:-1,U(m,{limit:8,query:A,selectedIndex:l,mode:"autocomplete"})},E=()=>{U(m,{limit:8,query:e.value.trim(),selectedIndex:l,mode:"autocomplete"})},B=()=>{let A=(e.value||"").trim();A!==h&&(I&&clearTimeout(I),I=setTimeout(()=>{if(h=A,!A){T();return}F(A)},120))},j=()=>{if(l<0||l>=m.length)return;let A=m[l];e.value=A.title||"",v(),T()};e.addEventListener("input",B),e.addEventListener("keydown",A=>{if(t.dataset.mode==="autocomplete")if(A.key==="ArrowDown"){if(A.preventDefault(),!m.length)return;l=Math.min(l+1,m.length-1),E()}else if(A.key==="ArrowUp"){if(A.preventDefault(),!m.length)return;l=Math.max(l-1,0),E()}else A.key==="Enter"?l>=0&&(A.preventDefault(),j()):A.key==="Escape"&&(A.preventDefault(),T())}),document.addEventListener("click",A=>{A.target instanceof Node&&(A.target===e||t.contains(A.target)||T())}),n&&n.addEventListener("click",()=>{e.value="",T(),n.hidden=!0,e.focus()}),document.addEventListener("memoryCue:remindersUpdated",v)}async function mt(e={}){if(!Z)return null;if(typeof Nn=="function")try{Nn()}catch{}let t=typeof e.text=="string"?e.text:(Z.value||"").trim(),n=Nr(t),i=n.text;if(!i)return null;if(n.kind==="reflection"){let l=Fr(i);return l?(Z.value="",l):null}let a=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,c=null;if(a)c=new Date(a).toISOString();else try{let l=fn(i);l&&l.time&&(c=new Date(`${l.date}T${l.time}:00`).toISOString())}catch{c=null}let f=Br(i,c);if(n.kind==="footy-drill"?f.category="Footy \u2013 Drills":n.kind==="task"&&(f.category="Tasks"),e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{f.notifyAt=new Date(e.notifyAt).toISOString()}catch{f.notifyAt=null}let m=Ni(f,{closeSheet:!1});if(m&&typeof document<"u"){Z.value="";try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:m}}))}catch{}}return m||null}typeof window<"u"&&(window.memoryCueQuickAddNow=mt),Dr?.addEventListener("click",()=>{mt()}),Z?.addEventListener("keydown",e=>{(e.key==="Enter"||e.key==="NumpadEnter")&&(e.preventDefault(),mt())}),kr?.addEventListener("submit",e=>{e.preventDefault(),mt()}),Mr();function Or(){if(typeof HTMLElement>"u"||!(ce instanceof HTMLElement)||!(Z instanceof HTMLInputElement)||ce.dataset.voiceBound==="true")return;if(ce.dataset.voiceBound="true",typeof window>"u"){ce.setAttribute("disabled","true"),ce.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ce.setAttribute("disabled","true"),ce.setAttribute("aria-disabled","true"),ce.getAttribute("title")||(ce.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=c=>{n=c,ce.setAttribute("aria-pressed",c?"true":"false"),ce.dataset.listening=c?"true":"false",ce.classList.toggle("is-listening",c)},s=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",m=>{let l=m?.results?.[0]?.[0]?.transcript?.trim()||"";if(l){Z.value=l;try{Z.focus({preventScroll:!0})}catch{Z.focus()}try{let h=Z.value.length;typeof Z.setSelectionRange=="function"&&Z.setSelectionRange(h,h)}catch{}}});let f=()=>{i(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};Nn=a,ce.addEventListener("click",()=>{let c=s();if(c){if(n){a();return}try{c.start(),i(!0)}catch(f){console.warn("Quick add voice error:",f),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}Or();let mi=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,ve=null,pi=!!mi;pi&&(ve=new mi,ve.lang="en-AU",ve.interimResults=!1,ve.maxAlternatives=1);function Pr(){try{if(typeof D=="function"){D("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}Oe&&(pi&&ve?Oe.addEventListener("click",()=>{try{ve.start(),Oe.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):Oe.addEventListener("click",()=>{Pr()})),ve&&(ve.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Ur(t)}),ve.addEventListener("end",()=>{Oe&&Oe.classList.remove("is-recording")}),ve.addEventListener("error",()=>{Oe&&Oe.classList.remove("is-recording")}));function _r(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function Hr(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,s=new Date(i);if(n.includes("tomorrow"))s.setDate(s.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let c=parseInt(a[1],10),f=a[2]?parseInt(a[2],10):0,m=a[3];m||(/\b(p\.?m\.?|p m)\b/.test(n)?m="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(m="am")),m==="pm"&&c<12&&(c+=12),m==="am"&&c===12&&(c=0),s.setHours(c,f,0,0);let l=new Date(s),h=new Date(l.getTime()-10*60*1e3);return t.dueDate=l,t.notifyAt=h,t}function Ur(e){if(!e||!Z)return;let t=_r(e),{dueDate:n,notifyAt:i}=Hr(e);Z.value=t,mt({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&Z&&(e.preventDefault(),Z.focus())})));try{oe==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let $r=o.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",gi=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,qr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Wt=o.reminderLandingPath||(oe==="desktop"?"index.html#reminders":"mobile.html"),ge=(e,t={})=>{let n=null;try{n=typeof CustomEvent<"u"?CustomEvent:null}catch{n=null}!n&&typeof window<"u"&&typeof window.CustomEvent<"u"&&(n=window.CustomEvent),n||(n=function(i,s){s=s||{bubbles:!1,cancelable:!1,detail:null};let a=new Event(i,s);return a.detail=s.detail,a}),document.dispatchEvent(new n(e,{detail:t}))};function hi(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function pt(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:p}}))}catch{}}P&&!P.value&&(P.value=z),Me()&&qe();function De(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let s=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(s.push(n);s.length>20;)s.shift();window.memoryCueActivityQueue=s}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Zi,{detail:n}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent(Zi,!1,!1,n),document.dispatchEvent(s))}}catch{}}}function jr(){if(typeof HTMLElement>"u"||!(de instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&g instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&g instanceof HTMLTextAreaElement;if(!e&&!t||de.dataset.voiceBound==="true")return;if(de.dataset.voiceBound="true",typeof window>"u"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true"),de.getAttribute("title")||(de.title="Voice input is not supported in this browser.");return}let i=null,s=!1,a=l=>{s=l,de.setAttribute("aria-pressed",l?"true":"false"),de.dataset.listening=l?"true":"false",de.classList.toggle("is-listening",l)},c=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",h=>{let I=h.results?.[0]?.[0]?.transcript?.trim()||"";if(I){g.value=I;try{g.focus({preventScroll:!0})}catch{try{g.focus()}catch{}}try{let T=g.value.length;typeof g.setSelectionRange=="function"&&g.setSelectionRange(T,T)}catch{}De({action:"dictated",label:`Voice input captured \xB7 ${I}`})}});let l=()=>{a(!1)};return i.addEventListener("end",l),i.addEventListener("error",l),i},f=()=>{if(!(!s||!i)){try{i.stop()}catch{}a(!1)}};de.addEventListener("click",()=>{let l=c();if(l){if(s){f();return}try{l.start(),a(!0)}catch(h){console.warn("Speech recognition error:",h),a(!1)}}});let m=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",m),document.addEventListener("reminders:updated",m)),a(!1)}Ko(),jr();let Vt,Yt,Gt,Kt,Je,zt,Qt,Xt,Jt,Zt,en,gt,ht,tn,nn,Fn,Bn,rn,Mn,yi=o.firebaseDeps,On=typeof o.importModule=="function"?o.importModule:e=>import(e),yt=ti(),bt=!1,Ee=!1,Pn=null,Ne=null,wt=null,p=[],Ze=!1,se=null,vt=null,et=null,Et=null,on=null,We={},Ve={},X={},bi=typeof document<"u"?document.getElementById("createSheetTitle"):null,wi=()=>{g instanceof HTMLElement&&setTimeout(()=>{try{g.focus()}catch{}},0)},tt=(e,t=null)=>{Et=e||null,on=t||null,et=Et==="edit"?on:null,bi instanceof HTMLElement&&(bi.textContent=Et==="edit"?"Edit reminder":"New reminder")};function be(e=p){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,s=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===s?Li(t||{},n||{}):s-i})}function Wr(e=p){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let s=Number.isFinite(i?.orderIndex)?i.orderIndex:null;s!=null&&(s<t&&(t=s),s>n&&(n=s))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function St(e=p){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),be(n);else{n=e.slice().sort(Li);let i=n.length;n.forEach((s,a)=>{s.orderIndex=(i-a)*Le})}return e===p&&(p=n),n}function vi(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Wr();if(t==="end"){let s=Number.isFinite(n)?n:0;e.orderIndex=s-Le||Le}else{let s=Number.isFinite(i)?i:0;e.orderIndex=s+Le||Le}}function sn(e=p){if(!Array.isArray(e)||e.length<2)return!1;be(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],s=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,c=Number.isFinite(s?.orderIndex)?s.orderIndex:null;if(a==null||c==null||a<=c||a-c<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Le;return e===p&&be(p),!0}let H={draggingId:null,dropTargetId:null,dropBefore:!0},Ei=!1,b={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Vr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function At(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Pe(){k&&(k.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),k.classList.remove("drag-over-list"))}function _n(){if(!k)return;let e=k.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Pe(),H.draggingId=null,H.dropTargetId=null,H.dropBefore=!0}function Si(e,t,n){if(!e||e===t)return;let i=p.findIndex(T=>T?.id===e);if(i<0)return;let[s]=p.splice(i,1),a;if(!t)a=p.length;else{let T=p.findIndex(U=>U?.id===t);if(T<0){p.splice(i,0,s);return}a=n?T:T+1}p.splice(a,0,s);let c=p[a-1],f=p[a+1],m=Number.isFinite(c?.orderIndex)?c.orderIndex:null,l=Number.isFinite(f?.orderIndex)?f.orderIndex:null,h;m!=null&&l!=null?h=(m+l)/2:m!=null?h=m-Le:l!=null?h=l+Le:h=Le,Number.isFinite(h)||(h=Le*(p.length+1)),s.orderIndex=h,be(p);let I=sn(p);Ze=!0,Y(),ee(),I?p.forEach(T=>le(T)):le(s),pt(),ge("memoryCue:remindersUpdated",{items:p}),De({action:"reordered",label:"Reminders reordered"})}function Yr(e){let t=At(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(H.draggingId=i,H.dropTargetId=null,H.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Gr(e){if(!H.draggingId)return;let t=At(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),H.dropTargetId=null,H.dropBefore=!1,Pe(),k?.classList.add("drag-over-list");return}if(t.dataset.id===H.draggingId){e.preventDefault(),Pe();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,s=e.clientY<i;(H.dropTargetId!==t.dataset.id||H.dropBefore!==s)&&(Pe(),t.classList.add(s?"drag-over-before":"drag-over-after"),H.dropTargetId=t.dataset.id,H.dropBefore=s)}function Kr(e){let t=At(e.target);if(!t){k?.contains(e.relatedTarget)||Pe();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),k?.contains(e.relatedTarget)||k?.classList.remove("drag-over-list"))}function zr(e){if(!H.draggingId)return;e.preventDefault();let t=At(e.target),n=t?.dataset.id||null,i=H.dropBefore;if(t){let s=t.getBoundingClientRect(),a=s.top+s.height/2;i=e.clientY<a}else n=null,i=!1;Si(H.draggingId,n,i),_n()}function Qr(){_n()}function Xr(){!k||Ei||(Ei=!0,k.addEventListener("dragstart",Yr),k.addEventListener("dragover",Gr),k.addEventListener("drop",zr),k.addEventListener("dragend",Qr),k.addEventListener("dragleave",Kr),an())}function an(){if(!k||an._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){an._bound=!0;return}let t=6,n=160;function i(){b.longPressTimer&&(clearTimeout(b.longPressTimer),b.longPressTimer=null)}function s(){k&&(b.initialTouchAction!=null?k.style.touchAction=b.initialTouchAction:k.style.removeProperty("touch-action"))}function a({keepHighlights:v=!1}={}){if(i(),b.item&&b.pointerId!=null)try{b.item.hasPointerCapture?.(b.pointerId)&&b.item.releasePointerCapture(b.pointerId)}catch{}if(b.placeholder?.parentNode)try{b.placeholder.parentNode.removeChild(b.placeholder)}catch{}b.item&&(b.item.classList.remove("is-dragging"),b.originalStyles?b.item.setAttribute("style",b.originalStyles):b.item.removeAttribute("style")),s(),v||Pe(),Object.assign(b,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function c(v){return k?Array.from(k.querySelectorAll("[data-reminder-item]")).filter(w=>w!==v):[]}function f(v){let w=b.item;if(!w||b.ready)return;let F=w.getBoundingClientRect(),E=window.getComputedStyle(w);b.ready=!0,H.draggingId=w.dataset.id||null,b.offsetY=v.clientY-F.top,b.fixedX=F.left;let B=document.createElement("div");B.className="touch-drag-placeholder",B.setAttribute("aria-hidden","true"),B.style.height=`${F.height}px`,B.style.boxSizing="border-box",B.style.marginTop=E.marginTop,B.style.marginBottom=E.marginBottom,B.style.marginLeft=E.marginLeft,B.style.marginRight=E.marginRight,B.style.borderRadius=E.borderRadius,B.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",B.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",B.style.pointerEvents="none",B.style.display="block",B.style.width="100%",w.parentNode?.insertBefore(B,w),b.placeholder=B,b.longPressTimer=null,b.originalStyles=w.getAttribute("style")||"",w.classList.add("is-dragging"),w.style.position="fixed",w.style.left=`${F.left}px`,w.style.top=`${F.top}px`,w.style.width=`${F.width}px`,w.style.zIndex="999",w.style.pointerEvents="none",w.style.touchAction="none",b.initialTouchAction=k.style.touchAction||"",k.style.touchAction="none"}function m(v){let w=b.item;if(!w||!b.ready)return;let F=v-b.offsetY;w.style.top=`${F}px`,w.style.left=`${b.fixedX}px`}function l(v){if(!b.ready||!k)return;let w=b.item,F=c(w);if(Pe(),!F.length){H.dropTargetId=null,H.dropBefore=!1;return}let E=null,B=!1;for(let u of F){let y=u.getBoundingClientRect(),x=y.top+y.height/2;if(v<x){E=u,B=!0;break}}if(!E){E=F[F.length-1];let u=E.getBoundingClientRect(),y=u.top+u.height/2;B=v<y,B||(B=!1)}if(!E){H.dropTargetId=null,H.dropBefore=!1;return}let j=E.getBoundingClientRect(),A=j.top+j.height/2,M=v<A;E.classList.add(M?"drag-over-before":"drag-over-after"),H.dropTargetId=E.dataset.id||null,H.dropBefore=M}function h(v){let w=H.draggingId,F=b.moved;if(!b.ready){a();return}a(),!v&&F&&w&&Si(w,H.dropTargetId,H.dropBefore),_n()}function I(v){let w=v.pointerType||"";if(w&&w!=="touch"&&w!=="pen"||b.active)return;let F=At(v.target);if(!F)return;let E=Vr(v.target);if(!(E&&E!==F)){b.active=!0,b.pointerId=v.pointerId,b.item=F,b.startX=v.clientX,b.startY=v.clientY,b.lastClientX=v.clientX,b.lastClientY=v.clientY,b.moved=!1,b.ready=!1,b.originalStyles=F.getAttribute("style")||"",b.startTime=v.timeStamp||Date.now(),H.dropTargetId=null,H.dropBefore=!0,H.draggingId=null,i(),b.longPressTimer=setTimeout(()=>{f({clientY:b.lastClientY})},n);try{F.setPointerCapture(v.pointerId)}catch{}}}function T(v){if(!b.active||v.pointerId!==b.pointerId)return;let w=v.pointerType||"";if(!(w&&w!=="touch"&&w!=="pen")){if(b.lastClientX=v.clientX,b.lastClientY=v.clientY,!b.ready){let F=Math.abs(v.clientX-b.startX),E=Math.abs(v.clientY-b.startY);if(F>t||E>t){let B=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(B-b.startTime)>=n?(i(),f({clientY:b.lastClientY})):a()}return}v.preventDefault(),b.moved=!0,m(v.clientY),l(v.clientY)}}function U(v){!b.active||v.pointerId!==b.pointerId||h(!1)}function K(v){!b.active||v.pointerId!==b.pointerId||h(!0)}k.addEventListener("pointerdown",I),window.addEventListener("pointermove",T),window.addEventListener("pointerup",U),window.addEventListener("pointercancel",K),an._bound=!0}function Ai(){se=null,Tn("offline"),Pt.forEach(e=>e.classList.remove("hidden")),_t.forEach(e=>e.classList.add("hidden")),Ut&&(Ut.textContent=""),vt?.(),vt=null,Un(),Y(),ee(),Ue()}function Hn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Jn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),s=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:cn(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:te(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:s,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0,semanticEmbedding:J(n.semanticEmbedding)}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Jr(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Jn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:te(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday,semanticEmbedding:J(n.semanticEmbedding)}));localStorage.setItem(Jn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function ee(){be(p),Jr(p)}function Un(){p=St(Hn())}Un();async function Zr(){let e=!1;for(let i of p){let s=J(i?.semanticEmbedding);await nr(i);let a=J(i?.semanticEmbedding);!s&&a&&(e=!0)}e&&ee();let t=Rn(ft,[]),n=!1;for(let i of t){let s=J(i?.semanticEmbedding);await nr(i);let a=J(i?.semanticEmbedding);!s&&a&&(n=!0)}if(n&&typeof localStorage<"u")try{localStorage.setItem(ft,JSON.stringify(t))}catch(i){console.warn("Failed to persist note embeddings",i)}}Zr();async function eo(){if(!se){p=Hn();return}let e=St(Hn());if(!e.length){p=[],ee();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await le(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}p=St(e.map(n=>({...n,pendingSync:!1}))),ee(),Y(),Ue()}try{X=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{X={}}if(X&&typeof X=="object"&&Object.values(X).forEach(e=>{e&&typeof e=="object"&&(e.category=te(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:Tt(e),e.urlPath=e.urlPath||Wt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null),e.semanticEmbedding=J(e.semanticEmbedding))}),!Me()){let e=Bi();typeof Notification<"u"&&Notification.permission==="granted"?(Sn(),e.length&&Zn(e,{requestCheck:!0})):e.length&&Zn(e)}let dn=e=>{if(!yt)return;let t=[yt];yt.window&&!t.includes(yt.window)&&t.push(yt.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function to(){if(!ie)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",s=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in ie?ie.value:ie.innerHTML,c=h=>{if("value"in ie){ie.value=h;return}if(typeof h!="string"||h.length===0){ie.innerHTML="";return}let I=h.trim();if(/<\/?[a-z][\s\S]*>/i.test(I)){ie.innerHTML=h;return}let U=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");ie.innerHTML=U},f=h=>{h?ie.classList.add("notes-editor--columns"):ie.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!h))},m="";try{m=localStorage.getItem(n)||""}catch{D("Unable to access saved notes")}c(m);let l=!1;try{l=localStorage.getItem(i)==="1"}catch{l=!1}f(l),ie.addEventListener("input",()=>{m=a();try{localStorage.setItem(n,m)}catch{D("Notes saved for this session only")}}),mr?.addEventListener("click",()=>{m=a();try{localStorage.setItem(n,m),D("Notes saved")}catch{D("Notes saved for this session only")}}),pr?.addEventListener("click",()=>{let h=m;try{h=localStorage.getItem(n)||m}catch{D("Unable to load saved notes")}m=h,c(m)}),e?.addEventListener("click",h=>{let I=h.target;if(!(I instanceof Element))return;let T=I.closest("button[data-action]");if(!T)return;let U=T.getAttribute("data-action");if(U==="columns"){let K=!ie.classList.contains("notes-editor--columns");f(K);try{localStorage.setItem(i,K?"1":"0")}catch{D("Column preference saved for this session only")}return}if(!s){D("Formatting controls are not supported in this browser");return}ie.focus(),U==="bullets"?document.execCommand("insertUnorderedList"):U==="numbers"&&document.execCommand("insertOrderedList")})}if(to(),ae?.addEventListener("click",$i),yi)({initializeApp:Vt,getFirestore:Yt,enableMultiTabIndexedDbPersistence:Gt,enableIndexedDbPersistence:Kt,doc:Je,setDoc:zt,deleteDoc:Qt,onSnapshot:Xt,collection:Jt,query:Zt,orderBy:en,serverTimestamp:gt,getAuth:ht,onAuthStateChanged:tn,GoogleAuthProvider:nn,signInWithPopup:Fn,signInWithRedirect:Bn,getRedirectResult:rn,signOut:Mn}=yi),bt=!0;else try{({initializeApp:Vt}=await On("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Yt,enableMultiTabIndexedDbPersistence:Gt,enableIndexedDbPersistence:Kt,doc:Je,setDoc:zt,deleteDoc:Qt,onSnapshot:Xt,collection:Jt,query:Zt,orderBy:en,serverTimestamp:gt}=await On("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:ht,onAuthStateChanged:tn,GoogleAuthProvider:nn,signInWithPopup:Fn,signInWithRedirect:Bn,getRedirectResult:rn,signOut:Mn}=await On("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),bt=!0}catch(e){bt=!1,console.warn("Firebase modules failed to load:",e),D("Firebase failed to load; notes available offline"),dn(!1)}if(bt&&typeof Vt=="function"&&typeof Yt=="function"&&typeof ht=="function")try{let e=Yo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Pn=Vt(e),Ne=Yt(Pn),Ee=!0,console.info("[Firebase] Firestore initialised",e.projectId),dn(!0)}catch(e){Ee=!1,console.warn("Firebase initialization failed:",e),D("Firebase failed to load; notes available offline"),dn(!1)}else bt?(Ee=!1,dn(!1)):Ee=!1;Ee&&typeof Gt=="function"&&typeof Kt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Gt(Ne),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Kt(Ne),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),Ee&&typeof ht=="function"&&(wt=ht(Pn));function no(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let io=typeof navigator<"u"&&navigator.language?navigator.language:"",Ti=no(io),nt=Ti||"en-US",Re="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Re=e.timeZone),!Ti&&e.locale&&(nt=e.locale)}catch{}let ro=new Intl.DateTimeFormat(nt,{timeZone:Re,hour:"2-digit",minute:"2-digit"}),oo=new Intl.DateTimeFormat(nt,{timeZone:Re,weekday:"long",day:"numeric",month:"long"}),so=new Intl.DateTimeFormat("en-CA",{timeZone:Re,year:"numeric",month:"2-digit",day:"2-digit"}),ao=new Intl.DateTimeFormat(nt,{timeZone:Re,weekday:"long"}),co=new Intl.DateTimeFormat(nt,{timeZone:Re,month:"short",day:"numeric"});function _e(e){let t=so.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,s=t.find(a=>a.type==="day").value;return`${n}-${i}-${s}`}function Ii(e,t){let[n,i,s]=e.split("-").map(m=>parseInt(m,10)),[a,c]=t.split(":").map(m=>parseInt(m,10)),f=new Date;return f.setFullYear(n,(i||1)-1,s||1),f.setHours(a||0,c||0,0,0),f.toISOString()}let lo=new Intl.DateTimeFormat("en-CA",{timeZone:Re,year:"numeric",month:"2-digit",day:"2-digit"}),uo=new Intl.DateTimeFormat("en-CA",{timeZone:Re,hour:"2-digit",minute:"2-digit",hour12:!1});function fo(e){try{let t=new Date(e),n=lo.formatToParts(t),i=n.find(c=>c.type==="year")?.value||"0000",s=n.find(c=>c.type==="month")?.value||"00",a=n.find(c=>c.type==="day")?.value||"00";return`${i}-${s}-${a}`}catch{return""}}function mo(e){try{let t=new Date(e),n=uo.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",s=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${s}`}catch{return""}}function cn(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function ln(){return _e(new Date)}function po(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Zo(e){let t=po(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function un(e){return e==="High"?3:e==="Medium"?2:1}function Li(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let s=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(s!==a)return s-a;let c=un(t?.priority)-un(e?.priority);return c||(t?.updatedAt||0)-(e?.updatedAt||0)}function es(e,t){let n=un(t.priority)-un(e.priority);if(n)return n;let i=+new Date(e.due||0),s=+new Date(t.due||0);return i!==s?i-s:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Ci(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return oo.format(t)}catch{return e}}function $n(e){return ro.format(e)}function go(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ts(e){return e?go(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function D(e){q&&(Ke(),q.dataset.statusKind="toast",q.textContent=e,clearTimeout(D._t),D._t=setTimeout(()=>{q&&q.dataset.statusKind==="toast"&&(q.textContent="",delete q.dataset.statusKind)},2500))}function ho(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function fn(e){e=String(e||"").toLowerCase();let t={date:ln(),time:""},n=f=>{let m=new Date,l=m.getDay(),h=(f-l+7)%7,I=new Date(m);return I.setDate(m.getDate()+(h===0?7:h)),I},i=f=>{let m=new Date,l=m.getDay(),h=(f-l+7)%7,I=new Date(m);return I.setDate(m.getDate()+h),I},s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=_e(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=s[f[1]],l=n(m);t.date=_e(l)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=s[f[1]],l=i(m);t.date=_e(l)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=s[f[1]],l=n(m);t.date=_e(l)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),m=parseInt(f[1],10),l=new Date;l.setDate(l.getDate()+m),t.date=_e(l)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),m=parseInt(f[1],10),l=parseInt(f[2],10)-1,h=f[3]?parseInt(f[3],10):new Date().getFullYear(),I=new Date(h,l,m);t.date=_e(I)}else for(let[f,m]of Object.entries(a)){let l=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(l.test(e)){let h=e.match(l),I=parseInt(h[1],10),T=new Date().getFullYear(),U=new Date(T,m,I);t.date=_e(U);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let f=parseInt(c[1],10),m=c[2]?parseInt(c[2],10):0,l=c[3];l&&(l==="pm"&&f<12&&(f+=12),l==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(m).padStart(2,"0")}`}return t}let qn=Ee&&wt&&typeof nn=="function";Wi({authReady:qn,auth:wt,GoogleAuthProvider:nn,signInWithPopup:Fn,signInWithRedirect:Bn,signOut:Mn,toast:D});let xi=Sr,ki=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(s=>{console.error("Auth handler error:",s)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};xi&&Pt.length&&Pt.forEach(e=>ki(e,Vi)),qn&&typeof rn=="function"&&rn(wt).catch(()=>{}),xi&&_t.length&&_t.forEach(e=>ki(e,Yi)),qn&&typeof tn=="function"?tn(wt,async e=>{e?(se=e.uid,Tn("online"),Pt.forEach(t=>t.classList.add("hidden")),_t.forEach(t=>t.classList.remove("hidden")),Ut&&(Ut.textContent=e.displayName||e.email||""),yo(),await eo()):Ai()}):Ai();function yo(){if(!Ee||!Ne||typeof Jt!="function"||typeof Zt!="function"||typeof en!="function"||typeof Xt!="function")return;if(!se){Un(),Y(),Xe(),ee(),Ue();return}vt&&vt();let e=Jt(Ne,"users",se,"reminders"),t=Zt(e,en("updatedAt","desc"));vt=Xt(t,n=>{let i=[];n.forEach(s=>{let a=s.data(),c=Number(a.orderIndex),f=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,m=a.pinToToday===!0;i.push({id:s.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:te(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(c)?c:null,plannerLessonId:f,pinToToday:m})}),p=St(i),Y(),Xe(),ee(),Ue()},n=>{console.error("Firestore sync error:",n),Q&&Tn("error","Sync Error")})}async function le(e){if(!(!Ee||!se||!Ne||typeof Je!="function"||typeof zt!="function"||typeof gt!="function"))try{await zt(Je(Ne,"users",se,"reminders",e.id),{ownerUid:se,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||z,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):gt(),updatedAt:gt()},{merge:!0})}catch(t){console.error("Save failed:",t),D("Save queued (offline)")}}async function bo(e){if(!(!Ee||!se||!Ne||typeof Je!="function"||typeof Qt!="function"))try{await Qt(Je(Ne,"users",se,"reminders",e))}catch{D("Delete queued (offline)")}}async function mn(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||z,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function He({preserveDetail:e=!1,resetMode:t=!0}={}){g&&(g.value=""),L&&(L.value=""),O&&(O.value=""),_&&(_.value=""),jt("Medium"),P&&(P.value=z),ci(),t?tt(null):et=Et==="edit"?on:null,ae&&(ae.textContent="Save"),fe?.classList.add("hidden"),kn(),e||ri()}function wo(e){let t=p.find(n=>n.id===e);t&&(tt("edit",e),g&&(g.value=t.title||""),L&&O&&(t.due?(L.value=fo(t.due),O.value=mo(t.due)):(L.value="",O.value="")),jt(t?.priority||"Medium"),P&&(P.value=te(t.category)),_&&(_.value=typeof t.notes=="string"?t.notes:""),V&&(V.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),kn(),ur(t),ae&&(ae.textContent="Update"),fe?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),wi(),ge("cue:open",{mode:"edit"}))}function Di(e){let t=e?.id||e;t&&(tt("edit",t),wo(t))}function vo(e=null){He({resetMode:!1}),tt("new");let t={mode:"create",trigger:e};ge("cue:prepare",t),ge("cue:open",t),wi()}typeof window<"u"&&(window.openNewReminderSheet=vo,window.openEditReminderSheet=Di);function Ni(e={},t={}){let{closeSheet:n=!0,activityAction:i="created",activityLabelPrefix:s="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let c=Date.now(),f=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),m=te(e.category??(P?P.value:z)),l=null;e.due instanceof Date?l=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(l=e.due);let h=null;e.notifyAt instanceof Date?h=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(h=e.notifyAt);let I={id:cn(),title:a,priority:e.priority||qt(),category:m,notes:f,done:!1,createdAt:c,updatedAt:c,due:l,pendingSync:!se,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:h,semanticEmbedding:J(e.semanticEmbedding)};vi(I,{position:"start"}),p=[I,...p],be(p);let T=sn(p);return Ze=!0,Y(),ee(),xr(I),T?p.forEach(U=>le(U)):le(I),mn(I),it(I),Ue(),pt(),ge("memoryCue:remindersUpdated",{items:p}),n&&hi(),De({action:i,label:`${s} \xB7 ${I.title}`}),I}function Eo(e){return Ni(e,{closeSheet:!0})}function So(e,t){if(!se)return D("Sign in to add notes"),null;if(!e)return null;let n=p.find(c=>c.id===e);if(!n)return null;let s=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!s)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${s}`:s,n.updatedAt=Date.now(),le(n),Y(),ee(),De({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Ao(e){let t=p.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),le(t),mn(t),Y(),ee(),t.done?(gn(e),De({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(it(t),De({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function To(e,t){let n=p.find(s=>s?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),le(n),Y(),ee(),pt(),ge("memoryCue:remindersUpdated",{items:p}))}function Io(e){if(!pe||pe.tokenId!==e)return;let{item:t,index:n}=pe;if(!t){Ke(e);return}Ke(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),p.length):p.length;t.pendingSync=!se,t.updatedAt=Date.now(),p.splice(i,0,t),be(p);let s=sn(p);Ze=!0,Y(),ee(),it(t),s?p.forEach(a=>le(a)):le(t),mn(t),pt(),ge("memoryCue:remindersUpdated",{items:p}),De({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),D("Reminder restored")}function jn(e){let t=p.findIndex(s=>s.id===e),n=t>=0?p.splice(t,1)[0]:null;n&&et===e&&He(),Y(),ee(),bo(e),gn(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(De({action:"deleted",label:i}),n&&q){Ke();let s=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;pe={tokenId:s,item:n,index:t,timeoutId:null},lr(pe),pe.timeoutId=setTimeout(()=>{Ke(s)},cr)}else n&&Ke()}function Ri(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,s=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',c=null,f=!1,m=0,l=0,h=0,I=()=>{if(f){if(f=!1,c!=null&&e.hasPointerCapture?.(c))try{e.releasePointerCapture(c)}catch{}c=null,e.removeEventListener("pointermove",U),e.removeEventListener("pointerup",K),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",K),window.removeEventListener("pointercancel",v)}},T=w=>{if(w.pointerType==="mouse"&&w.button!==0)return;f&&I();let F=w.target;F instanceof Element&&F.closest(a)||(c=w.pointerId,m=w.clientX,l=w.clientY,h=typeof w.timeStamp=="number"?w.timeStamp:Date.now(),f=!0,e.addEventListener("pointermove",U),e.addEventListener("pointerup",K),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",K),window.addEventListener("pointercancel",v))},U=w=>{if(!f||w.pointerId!==c)return;Math.abs(w.clientY-l)>i&&I()},K=w=>{if(!f||w.pointerId!==c)return;let F=w.clientX-m,E=Math.abs(w.clientY-l),B=(typeof w.timeStamp=="number"?w.timeStamp:Date.now())-h;if(I(),F<=-n&&E<=i&&B<=s){w.preventDefault(),w.stopPropagation();try{t()}catch(j){console.warn("Swipe delete handler failed",j)}}},v=w=>{f&&(typeof w.pointerId=="number"&&w.pointerId!==c||I())};e.addEventListener("pointerdown",T)}function Tt(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=$n(i);if(s)return`${n} \u2022 ${s}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=$n(i);if(s)return`Due ${s}`}}catch{}return"Due now"}function Fi(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}D("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Bi(){return Object.values(X||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||z,notes:typeof e.notes=="string"?e.notes:"",body:Tt(e),urlPath:e.urlPath||Wt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null,semanticEmbedding:J(e.semanticEmbedding)}))}function Wn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(X))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Bi(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Sn(),Zn(e,{requestCheck:t})}function pn(e,{closeNotification:t=!0}={}){if(t){let n=Be.get(e);if(n){try{n.close()}catch{}Be.delete(e)}}We[e]&&(clearTimeout(We[e]),delete We[e]),Ve[e]&&(clearTimeout(Ve[e]),delete Ve[e]),ei(e),X[e]&&(delete X[e],Wn())}function gn(e){pn(e)}function Vn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Be.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Tt(e),tag:e.id});Be.set(e.id,n);let i=()=>{Be.get(e.id)===n&&Be.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Lo(e){if(!Me())return!1;let t=or();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await qe();if(!i)return!1;await ei(e.id,i);let s={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||z,body:a,urlPath:Wt},a=Tt(e),c={body:a,tag:e.id,data:s,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await i.showNotification(e.title,c),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function it(e){if(!e||!e.id)return;if(e.category=te(e.category),!e.due||e.done){gn(e.id);return}let t=X[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||z,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Tt(e),urlPath:Wt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,semanticEmbedding:J(e.semanticEmbedding),notifiedAt:(()=>{let f=typeof t.due=="string"?t.due:null,m=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return f===e.due?m:null})()};if(X[e.id]=n,Wn(),We[e.id]&&(clearTimeout(We[e.id]),delete We[e.id]),Ve[e.id]&&(clearTimeout(Ve[e.id]),delete Ve[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let s=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(X[e.id]?.viaTrigger){pn(e.id,{closeNotification:!1});return}Vn(e),pn(e.id,{closeNotification:!1});return}let c=Me();if(Number.isFinite(s)&&s>Date.now()&&s<i){let f=s-Date.now();Ve[e.id]=setTimeout(()=>{Vn({...e,due:e.due||n.due})},f)}c&&(n.viaTrigger=!1,Lo(e).then(f=>{f&&X[e.id]&&(X[e.id]={...X[e.id],viaTrigger:!0},Wn())})),We[e.id]=setTimeout(()=>{c&&ei(e.id),Vn(e),pn(e.id,{closeNotification:!1})},a)}function Ue(){Object.values(X).forEach(e=>it({...e,category:te(e?.category)}))}function Mi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=ao.format(t),i=co.format(t),s=$n(t);return`${n}, ${i}${s?` at ${s}`:""}`}catch{return"No due date"}}let Oi="__mcPinToggleHandler";var Yn=!1;function It(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(xe,t),e.classList.toggle(me,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Pi(e){if(!(e instanceof HTMLElement)||e[Oi])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let s=i.currentTarget;if(!(s instanceof HTMLElement))return;let c=(typeof s.closest=="function"?s.closest("[data-reminder-item]"):null)?.dataset?.id;if(!c){It(s,!1);return}let f=!s.classList.contains(xe);await Promise.resolve(To(c,f)),It(s,f)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Oi]={click:t,keydown:n}}function Co(){if(!k)return;let e=k.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){It(t,!1),Pi(t);return}let a=!!p.find(c=>c?.id===i)?.pinToToday;It(t,a),Pi(t)})}function _i(){if(!k||Yn)return;Yn=!0;let e=()=>{Yn=!1,Co()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function xo(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function ko(e,t,n){if(!Array.isArray(e))return[];let s=t==="completed"?e.filter(a=>!!a?.done):e.filter(a=>!a?.done);return t==="today"?s.filter(a=>xo(a,n)):s}function Do(){let e=document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]");e.length&&e.forEach(t=>{let i=t.getAttribute("data-reminders-tab")===ut;t.setAttribute("aria-pressed",i?"true":"false"),i?t.classList.add("reminders-tab-active","active"):t.classList.remove("reminders-tab-active","active")})}function Hi(e){if(!e||e===ut)return!1;document.querySelectorAll("#reminders-slim-header [data-reminders-tab], #view-reminders [data-reminders-tab]").length&&(Array.isArray(Cn)&&Y(),Xe())}function Ui(){if(oe!=="mobile"||typeof document>"u"||Ui._wired)return;Do(),Xe(),document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]").forEach(t=>{t.addEventListener("click",()=>{let n=t.getAttribute("data-reminders-tab");Hi(n)})})}function Y(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let s={start:n,end:i};if(Pe(),be(p),oi)try{oi.textContent=String(p.length)}catch{}p.forEach(u=>{u&&typeof u=="object"&&(u.category=te(u.category))});let a=new Set(jo.map(u=>te(u)));p.forEach(u=>{u&&typeof u=="object"&&a.add(te(u.category))});let c=Array.from(a).sort((u,y)=>u.localeCompare(y,void 0,{sensitivity:"base"}));if(Ln){let u=new Set;Array.from(Ln.querySelectorAll("option")).forEach(y=>{u.add(y.value.trim().toLowerCase())}),c.forEach(y=>{let x=y.toLowerCase();if(!u.has(x)){let C=document.createElement("option");C.value=y,Ln.appendChild(C),u.add(x)}})}if(Ze)Ze=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let u=p.map(y=>({...y}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}));else if(document.createEvent){let y=document.createEvent("CustomEvent");y&&y.initCustomEvent&&(y.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:u}),document.dispatchEvent(y))}}catch{}}let f=p.slice();be(f),oe==="mobile"&&(Cn=f.slice(),f=ko(Cn,ut,s),Xe());let m=!0,l=p.length>0,h=f.length>0,I=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let u=Object.values(X||{}).filter(y=>y&&typeof y=="object"&&y.id);return new Set(u.map(y=>y.id))})();if(Qe)if(h)Qe.classList.add("hidden");else{let u=l?"No reminders to show right now.":$r;gi?gi(Qe,{icon:l?"sparkles":"bell",title:l?"Nothing to display":"Create your first cue",description:u,action:l?void 0:`<button type="button" class="${qr}" data-trigger="open-cue">Create reminder</button>`}):Qe.textContent=u,Qe.classList.remove("hidden")}if(si&&si.classList.toggle("has-items",h),!k)return;if(!h){Qe?(k.innerHTML="",k.classList.add("hidden")):(k.innerHTML='<div class="text-muted">No reminders found.</div>',k.classList.remove("hidden")),_i();return}k.classList.remove("hidden"),k.replaceChildren();let T=document.createDocumentFragment(),U=k.tagName==="UL"||k.tagName==="OL",K=!0,v=["priority-high","priority-medium","priority-low"],w=(u,y)=>{if(!(u instanceof HTMLElement))return;u.classList.remove(...v);let x=typeof y=="string"?y.trim().toLowerCase():"";x.startsWith("h")?u.classList.add("priority-high"):x.startsWith("m")?u.classList.add("priority-medium"):x.startsWith("l")&&u.classList.add("priority-low")},F=(u,y="neutral")=>{let x=document.createElement("span");x.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",x.title=u,x.dataset.tone=y;let C=document.createElement("span");C.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",y==="priority-high"?C.classList.add("bg-error"):y==="priority-medium"?C.classList.add("bg-warning"):y==="priority-low"?C.classList.add("bg-secondary"):y==="category"?C.classList.add("bg-primary"):C.classList.add("bg-base-content","opacity-40");let N=document.createElement("span");return N.className="truncate",N.textContent=u,x.append(C,N),x},E=(u,y,{elementTag:x,isMobile:C})=>{let N={id:u.id,title:u.title,dueIso:u.due||null,priority:u.priority||"Medium",category:y,done:!!u.done,pinToToday:u.pinToToday===!0},R="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",ue="task-item reminder-row reminder-card w-full text-base-content",S=document.createElement(x);S.className=C?ue:R,S.dataset.id=N.id,S.dataset.category=N.category,S.dataset.title=N.title;let Ae=N.priority&&String(N.priority).trim();Ae?S.dataset.priority=Ae:delete S.dataset.priority,S.dataset.done=String(N.done),N.dueIso?S.dataset.due=N.dueIso:delete S.dataset.due,N.pinToToday?S.dataset.pinToToday="true":delete S.dataset.pinToToday,S.dataset.reminder=JSON.stringify(N),S.dataset.orderIndex=Number.isFinite(u.orderIndex)?String(u.orderIndex):"",S.dataset.reminderItem="true",S.classList.add("reminder-draggable"),S.setAttribute("draggable","true"),S.setAttribute("role","button"),S.tabIndex=0,S.setAttribute("aria-label",`Edit reminder: ${u.title}`),w(S,N.priority),I.has(N.id)?S.dataset.notificationActive="true":delete S.dataset.notificationActive;let Te=N.dueIso?new Date(N.dueIso):null;m&&Te&&Te>=n&&Te<=i?(S.classList.add("is-today"),S.dataset.today="true"):(S.classList.remove("is-today"),delete S.dataset.today);let Ye=Mi(u),rt=Ye&&Ye!=="No due date"?Ye:"",ot=document.createElement("div");ot.className="task-toolbar flex items-start gap-1",ot.setAttribute("role","toolbar"),ot.setAttribute("aria-label","Reminder actions"),C&&ot.classList.add("flex-shrink-0");let ne=document.createElement("button");ne.type="button",ne.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",ne.classList.toggle("reminder-complete-toggle--active",N.done);let Fo=N.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";ne.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${Fo}"
          />
        </svg>`,N.done?(ne.classList.add("text-base-content/60"),ne.setAttribute("aria-label",`Mark reminder as active: ${u.title}`)):(ne.classList.add("text-success"),ne.setAttribute("aria-label",`Mark reminder as done: ${u.title}`)),ne.setAttribute("aria-pressed",N.done?"true":"false"),ne.setAttribute("data-reminder-control","toggle"),ne.setAttribute("data-no-swipe","true"),ne.addEventListener("click",G=>{G.preventDefault(),G.stopPropagation(),Ao(N.id)});let yn=()=>Di(u);if(C){let G=document.createElement("div");G.className="reminder-card-main reminder-row-main";let Ie=document.createElement("div");Ie.className="reminder-title reminder-row-title",Ie.dataset.reminderTitle="true";let Ge=document.createElement("span");if(Ge.dataset.role="reminder-today-toggle",Ge.className="reminder-title-toggle cursor-pointer",Ge.setAttribute("role","button"),Ge.tabIndex=0,Ge.textContent=u.title,It(Ge,N.pinToToday),Ie.appendChild(Ge),G.appendChild(Ie),rt){let he=document.createElement("div");he.className="reminder-date reminder-row-meta",he.textContent=rt,G.appendChild(he)}return N.done?S.classList.add("reminder-row-completed"):Te&&Te<e&&S.classList.add("reminder-row-overdue"),ne.classList.add("reminder-row-complete","reminder-complete-btn"),S.append(ne,G),S.addEventListener("click",he=>{if(he.defaultPrevented)return;let Gn=he.target;Gn&&typeof Gn.closest=="function"&&Gn.closest("[data-reminder-control]")||yn()}),S.addEventListener("keydown",he=>{he.defaultPrevented||he.target===S&&(he.key==="Enter"||he.key===" ")&&(he.preventDefault(),yn())}),C&&Ri(S,()=>jn(N.id)),S}let bn=document.createElement("div");bn.className="flex min-w-0 flex-1 flex-col gap-2";let st=document.createElement("p");st.className="text-lg font-bold leading-snug text-base-content",st.classList.add("desktop-reminder-title"),st.classList.add("sm:text-[0.95rem]"),N.done&&st.classList.add("line-through","text-base-content/60"),st.textContent=u.title,bn.appendChild(st);let Lt=document.createElement("div");Lt.className="desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70",rt&&Lt.appendChild(F(rt,"due")),!!(y&&y!==z)&&Lt.appendChild(F(y,"category")),Lt.children.length&&bn.appendChild(Lt),S.appendChild(bn);let Fe=document.createElement("button");return Fe.type="button",Fe.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Fe.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Fe.setAttribute("aria-label",`Delete reminder: ${u.title}`),Fe.setAttribute("data-action","delete"),Fe.setAttribute("data-reminder-control","delete"),Fe.setAttribute("data-no-swipe","true"),Fe.addEventListener("click",G=>{G.preventDefault(),G.stopPropagation();try{jn(N.id)}catch(Ie){console.warn("Delete handler failed",Ie)}}),ot.append(ne,Fe),S.appendChild(ot),S.addEventListener("click",G=>{if(G.defaultPrevented)return;let Ie=G.target;Ie&&typeof Ie.closest=="function"&&Ie.closest("[data-reminder-control]")||yn()}),S.addEventListener("keydown",G=>{G.defaultPrevented||G.target===S&&(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),yn())}),C&&Ri(S,()=>jn(N.id)),S},B=(u,y)=>E(u,y,{elementTag:"div",isMobile:!0});if(oe!=="desktop"&&!K){f.forEach(u=>{let y=u.category||z;T.appendChild(B(u,y))}),k.appendChild(T);return}let j=new Map;f.forEach(u=>{let y=u.category||z;j.has(y)||j.set(y,[]),j.get(y).push(u)});let A=Array.from(j.entries()).sort((u,y)=>u[0].localeCompare(y[0],void 0,{sensitivity:"base"})),M=!0;A.forEach(([u,y])=>{if(u!==z){let x=document.createElement(U?"li":"div");x.dataset.categoryHeading=u,U&&(x.setAttribute("role","presentation"),x.style.listStyle="none"),x.className=oe==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",M||(x.style.marginTop=oe==="desktop"?"1.25rem":"1rem");let C=document.createElement("div");C.setAttribute("role","heading"),C.setAttribute("aria-level","3"),C.className=oe==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let N=document.createElement("span");N.textContent=u;let R=document.createElement("span");R.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",R.textContent=`${y.length} ${y.length===1?"item":"items"}`,C.append(N,R),x.appendChild(C),T.appendChild(x)}y.forEach(x=>{if(oe==="desktop"){let C=E(x,u,{elementTag:U?"li":"div",isMobile:!1});T.appendChild(C);return}T.appendChild(B(x,u))}),M=!1}),k.appendChild(T),fr(),_i()}function Se(){ct?.setAttribute("aria-expanded","false"),lt?.classList.add("hidden")}function No(){ct?.setAttribute("aria-expanded","true"),lt?.classList.remove("hidden")}ct?.addEventListener("click",e=>{e.stopPropagation(),ct.getAttribute("aria-expanded")==="true"?Se():No()}),document.addEventListener("click",e=>{lt&&!lt.classList.contains("hidden")&&!lt.contains(e.target)&&e.target!==ct&&Se()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Se()}),Er.forEach(e=>{e.addEventListener("click",()=>{let t=$t?.classList.contains("hidden");$t?.classList.toggle("hidden"),t&&$t?.scrollIntoView({behavior:"smooth",block:"start"}),Se()})}),document.addEventListener("DOMContentLoaded",()=>{$t?.classList.add("hidden")});function $i(){try{console.log("handleSaveAction invoked",{editingId:et,title:g?.value})}catch{}let t=(typeof g?.value=="string"?g.value:"").trim(),n=typeof L?.value=="string"?L.value:"",i=typeof O?.value=="string"?O.value:"",s=typeof V?.value=="string"?V.value.trim():"";if(Et==="edit"&&et){let l=p.find(T=>T.id===et);if(!l){He();return}if(!t){D("Add a reminder title");return}let h=null;if(n||i){let T=n||ln();h=Ii(T,i||"09:00")}else{let T=fn(t);T.time&&(h=new Date(`${T.date}T${T.time}:00`).toISOString())}l.title=t;let I=qt();l.priority=I,jt(I),P&&(l.category=te(P.value)),l.due=h,_&&(l.notes=_.value.trim()),l.plannerLessonId=s||null,l.updatedAt=Date.now(),le(l),mn(l),Ze=!0,Y(),it(l),ee(),pt(),ge("memoryCue:remindersUpdated",{items:p}),hi(),De({action:"updated",label:`Reminder updated \xB7 ${l.title}`}),He(),D("Reminder updated"),ge("cue:close",{reason:"updated"});return}if(!t){D("Add a reminder title");return}let a=_?_.value.trim():"",c=null;if(n||i){let l=n||ln();c=Ii(l,i||"09:00")}else{let l=fn(t);l.time&&(c=new Date(`${l.date}T${l.time}:00`).toISOString())}let f=s?{lessonId:s,dayLabel:V?.dataset?.lessonDayLabel||"",lessonTitle:V?.dataset?.lessonTitle||"",summary:V?.dataset?.lessonSummary||""}:null,m=Eo({title:t,priority:qt(),category:P?P.value:"",due:c,notes:a,plannerLessonId:s||null});m&&(f?(D("Planner reminder created"),ge("planner:reminderCreated",{lessonId:f.lessonId,dayLabel:f.dayLabel,lessonTitle:f.lessonTitle,summary:f.summary,reminderId:m.id,reminderTitle:m.title,reminderDue:m.due||null})):D("Reminder created")),g&&(g.value=""),O&&(O.value=""),_&&(_.value=""),kn(),ge("cue:close",{reason:"created"})}g?.addEventListener("keydown",e=>{e.key==="Enter"&&$i()});function Ro(){if(!g||!je)return;let e=g.value.trim();if(!e){je.style.display="none";return}try{let t=fn(e),n=ln();if(t.date!==n||t.time){let i="";if(t.date!==n){let s=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Ci(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(je.textContent=`Parsed: ${i}`,je.style.display="block"):je.style.display="none"}else je.style.display="none"}catch{je.style.display="none"}}if(g?.addEventListener("input",ho(Ro,300)),fe?.addEventListener("click",()=>{He(),D("Edit cancelled"),ge("cue:close",{reason:"edit-cancelled"})}),ar?.addEventListener("click",()=>{He()}),document.addEventListener("cue:cancelled",()=>{He()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";He({resetMode:!1}),tt(t,t==="edit"?on:null)}),document.addEventListener("cue:close",()=>{tt(null)}),document.addEventListener("planner:prefillReminder",e=>{Lr(e?.detail||{})}),window.addEventListener("load",()=>g?.focus()),hr?.addEventListener("click",()=>{let e=p.filter(t=>!t.done).map(t=>{let n=t.due?Ci(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(nt,{hour:"2-digit",minute:"2-digit",timeZone:Re}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){D("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>D("Copied for Master Task List")).catch(()=>D("Copy failed")),Se()}),In?.addEventListener("change",()=>{let e=In.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let c={...a,id:cn(),category:te(a.category),pendingSync:!se,orderIndex:null};vi(c,{position:"start"}),p=[c,...p],i.push(c)}),be(p);let s=sn(p);Y(),ee(),s?p.forEach(a=>le(a)):i.forEach(a=>le(a)),D("Import successful")}catch{D("Invalid JSON")}},t.readAsText(e),In.value="",Se()}),yr?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Se()}),br?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){D("Add your Apps Script URL in Settings first"),Se();return}if(!p.length){D("No tasks to sync"),Se();return}D("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<p.length;i+=t){let s=p.slice(i,i+t),a=await Promise.allSettled(s.map(c=>{let f={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||z,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=a.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}D(`Sync complete: ${p.length-n} ok${n?`, ${n} failed`:""}`),Se()}),ze&&(ze.value=localStorage.getItem("syncUrl")||""),wr?.addEventListener("click",()=>{ze&&(localStorage.setItem("syncUrl",ze.value.trim()),D("Settings saved"))}),vr?.addEventListener("click",async()=>{if(!ze)return;let e=ze.value.trim();if(!e){D("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});D(t.ok?"Test ok":"Test failed")}catch{D("Test failed")}}),gr?.addEventListener("click",async()=>{if(!("Notification"in window)){D("Notifications not supported");return}if(Notification.permission==="granted"){D("Notifications enabled"),Me()?qe():(Sn(),Fi()),Ue(),Y();return}try{await Notification.requestPermission()==="granted"?(D("Notifications enabled"),Me()?qe():(Sn(),Fi()),Ue(),Y()):D("Notifications blocked")}catch{D("Notifications blocked")}}),Ui(),oe==="mobile"){let e=()=>{try{Tr()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return Xr(),Ue(),Y(),ee(),oe==="mobile"&&(window.setMobileRemindersFilter=Hi),{cancelReminder:gn,scheduleReminder:it,closeActiveNotifications:sr,getActiveNotifications:()=>Be,addNoteToReminder:So,__testing:{setItems(e=[]){p=Array.isArray(e)?e.map(t=>({...t,category:te(t?.category)})):[],p=St(p),be(p),Y()},render:Y,getItems:()=>p.map(e=>({...e})),parseInboxTimeQuery:fi}}}var Zi,Be,er,zn,Qn,tr,En,Rt,Xn,z,jo,Jn,Le,Vo,Ce,zo=Kn(()=>{Ki();Zi="memoryCue:activity",Be=new Map,er=!1,zn="service-worker.js",Qn="memory-cue-reminder-sync",tr=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),En=null,Rt=null,Xn=!1,z="General",jo=Object.freeze([z,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Jn="memoryCue:offlineReminders",Le=1024;Vo=Object.freeze({}),Ce=null});function us(o){return new ni(o)}var Qo,Xo,ni,Jo=Kn(()=>{Qo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Xo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},ni=class o{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...Xo,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let d=this.getFocusableElements();if(d.length===0){r.preventDefault(),this.modal.focus();return}let g=d[0],L=d[d.length-1],O=document.activeElement;r.shiftKey&&O===g?(r.preventDefault(),L.focus()):!r.shiftKey&&O===L&&(r.preventDefault(),g.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Qo)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let d=r?.detail?.mode==="edit";this.setEditMode(d),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let d=r.detail?.reason||"external-close";this.hide({reason:d})}dispatchEvent(r,d={}){let g=this.events[r];if(!g||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let L=new CustomEvent(g,{detail:d,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(L)}requestClose(r){let d={reason:r,controller:this};this.dispatchEvent("cancelled",d),this.dispatchEvent("closeRequest",{...d,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let d=this.animationHooks?.[r];typeof d=="function"&&await d(this)}addToStack(){let r=o.activeStack,d=r.indexOf(this);d!==-1&&r.splice(d,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=o.activeStack,d=r.indexOf(this);d!==-1&&r.splice(d,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{rs as a,Ki as b,ds as c,zo as d,ni as e,us as f,Jo as g};
