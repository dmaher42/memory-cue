import{a as ht,b as Gt,c as bt,d as Jt,e as Se,g as Kt}from"./chunk-NQOL4S2N.js";import{a as pt,b as jt}from"./chunk-MG4MJA24.js";import{b as gt,c as Wt}from"./chunk-CTK42JWW.js";import{b as yt,c as Yt}from"./chunk-GUVSRPRW.js";var ve,xe,Qt,fe,$e,St,vt,At,ze,Lt,ae,Fe,Et,Xt,Z,Q,Ve,U,me,Ae,wt,ye=yt(()=>{ve="memoryCueNotes",xe="memoryCueFolders",Qt=["mobileNotes"],fe=()=>typeof localStorage<"u",$e=null,St=n=>{$e=typeof n=="function"?n:null},vt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,At=n=>{if(typeof n!="string")return"";let e=n.trim();return e.length?(/[<>]/.test(e),n):""},ze=n=>{if(typeof n!="string")return"";let e=n.trim();return e.length?/[<>]/.test(e)?n:At(n):""},Lt=n=>{if(typeof n!="string")return!1;let e=Date.parse(n);return!Number.isNaN(e)},ae=(n,e,i={})=>{let l=typeof n=="string"?n.trim():"";return{id:i.id&&typeof i.id=="string"?i.id:vt(),title:l||"Untitled note",body:ze(e),updatedAt:i.updatedAt&&Lt(i.updatedAt)?i.updatedAt:new Date().toISOString(),folderId:i.folderId&&typeof i.folderId=="string"?i.folderId:null}},Fe=n=>{if(Array.isArray(n))return n.map(e=>{if(!e||typeof e!="object")return null;let i=typeof e.title=="string"?e.title.trim():"",l=ze(e.body),m=typeof e.id=="string"&&e.id.trim()?e.id:vt(),c=Lt(e.updatedAt)?e.updatedAt:new Date().toISOString();return!i&&!l&&!e.body?null:{id:m,title:i||"Untitled note",body:l,updatedAt:c,folderId:typeof e.folderId=="string"&&e.folderId?e.folderId:null}}).filter(Boolean);if(n&&typeof n=="object"){let e=typeof n.title=="string"?n.title:"",i=typeof n.body=="string"?n.body:"",l=ze(i);return!e&&!l?[]:[ae(e,l,{id:typeof n.id=="string"?n.id:void 0,updatedAt:typeof n.updatedAt=="string"?n.updatedAt:void 0,folderId:typeof n.folderId=="string"?n.folderId:void 0})]}return typeof n=="string"&&n.trim().length?[ae("Notebook (legacy)",At(n))]:[]},Et=n=>{if(!fe())return null;try{return localStorage.getItem(n)}catch{return null}},Xt=n=>{if(fe())try{localStorage.removeItem(n)}catch{}},Z=()=>{if(!fe())return[];let n=Et(ve);if(typeof n=="string")try{let e=JSON.parse(n),i=Fe(e);if(i.length)return i}catch{let e=Fe(n);if(e.length)return Q(e),e}for(let e of Qt){let i=Et(e);if(typeof i=="string"&&i.trim().length){let l=Fe(i);if(l.length)return Q(l),Xt(e),l}}return[]},Q=(n,e={})=>{if(!fe()||!Array.isArray(n))return!1;let i=n.map(l=>{let c=Fe([l])[0];return c&&(c.folderId=typeof l.folderId=="string"&&l.folderId?l.folderId:c.folderId||null),c}).filter(Boolean);try{if(localStorage.setItem(ve,JSON.stringify(i)),!e.skipRemoteSync&&typeof $e=="function")try{let l=$e(i);l&&typeof l.then=="function"&&l.catch(m=>{console.error("[notes-storage] Remote sync failed.",m)})}catch(l){console.error("[notes-storage] Remote sync handler threw.",l)}return!0}catch{return!1}},Ve=()=>[{id:"unsorted",name:"Unsorted"}],U=()=>{if(!fe())return Ve();try{let e=localStorage.getItem(xe);if(typeof e=="string"){let i=JSON.parse(e);if(Array.isArray(i)&&i.length){let l=!1,m=i.map((c,p)=>{let b=String(c.id),F=typeof c.name=="string"?c.name:String(c.id),H=typeof c.order=="number"?c.order:p;return typeof c.order!="number"&&(l=!0),{id:b,name:F,order:H}});if(l)try{localStorage.setItem(xe,JSON.stringify(m))}catch{}return m}}}catch{}let n=Ve();try{localStorage.setItem(xe,JSON.stringify(n))}catch{}return n},me=n=>{let i=U().find(l=>l&&String(l.id)===String(n));return i?String(i.name):"Unsorted"},Ae=n=>{if(!fe()||!Array.isArray(n))return!1;try{let e=n.filter(i=>i&&typeof i.id=="string"&&i.id.trim()).map((i,l)=>({id:i.id,name:typeof i.name=="string"?i.name:String(i.id),order:typeof i.order=="number"?i.order:l}));return e.length||e.push(...Ve()),localStorage.setItem(xe,JSON.stringify(e)),!0}catch{return!1}},wt=(n,e)=>{if(!n||typeof n!="string")return!1;let i=Z(),l=!1,m=i.map(p=>p.id===n?(l=!0,{...p,folderId:e&&typeof e=="string"?e:null,updatedAt:new Date().toISOString()}):p);return l?Q(m):!1}});var Zt,en,tn,De,nn,on,Ct,It=yt(()=>{Wt();ye();Zt="notes",en="user_id",tn="updated_at",De=n=>{if(typeof n!="string")return 0;let e=Date.parse(n);return Number.isNaN(e)?0:e},nn=(n=[],e=[])=>{let i=new Map;return e.forEach(l=>{l&&typeof l.id=="string"&&i.set(l.id,l)}),n.forEach(l=>{if(!l||typeof l.id!="string")return;let m=i.get(l.id);if(!m){i.set(l.id,l);return}let c=De(l.updatedAt),p=De(m.updatedAt);c>p&&i.set(l.id,l)}),Array.from(i.values()).sort((l,m)=>De(m?.updatedAt)-De(l?.updatedAt))},on=n=>e=>{if(!e||typeof e!="object")return null;let i={id:typeof e.id=="string"&&e.id?e.id:void 0,updatedAt:typeof e[n]=="string"?e[n]:void 0,folderId:typeof e.folder_id=="string"&&e.folder_id?e.folder_id:void 0};return ae(e.title,e.body,i)},Ct=(n={})=>{let{tableName:e=Zt,userColumn:i=en,updatedAtColumn:l=tn,supabase:m=null}=n,c=m||null,p=null,b=!1,F=new Set,H=()=>c||(c=gt(),c),O=on(l),S=async g=>{let D=H();if(!D||!p)return;let P=(Array.isArray(g)?g.filter(A=>A&&typeof A.id=="string"):[]).map(A=>({id:A.id,[i]:p,title:A.title,body:A.body,folder_id:typeof A.folderId=="string"&&A.folderId?A.folderId:null,[l]:typeof A.updatedAt=="string"&&A.updatedAt?A.updatedAt:new Date().toISOString()})),V=new Set(P.map(A=>A.id));if(P.length){let{error:A}=await D.from(e).upsert(P);if(A)throw A}let Y=[...F].filter(A=>A&&!V.has(A));if(Y.length){let{error:A}=await D.from(e).delete().in("id",Y).eq(i,p);if(A)throw A}F=new Set(V)},x=async()=>{let g=H();if(!(!g||!p))try{let{data:D,error:_}=await g.from(e).select(`id,title,body,folder_id,${l}`).eq(i,p);if(_)throw _;let P=Array.isArray(D)?D:[];F=new Set(P.map(L=>typeof L.id=="string"?L.id:null).filter(Boolean));let V=P.map(O).filter(Boolean),Y=Z();if(!V.length){if(Y.length)try{await S(Y)}catch(L){console.error("[notes-sync] Failed to upload local notes to Supabase.",L)}return}let A=nn(Y,V);b=!0;let f=Q(A,{skipRemoteSync:!0});b=!1,f||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await S(A)}catch(L){console.error("[notes-sync] Failed to reconcile notes with Supabase.",L)}}catch(D){console.error("[notes-sync] Failed to fetch notes from Supabase.",D)}finally{b=!1}};return St(async g=>{if(!b)try{await S(g)}catch(D){console.error("[notes-sync] Failed to sync notes to Supabase.",D)}}),{setSupabaseClient(g){g&&(c=g)},handleSessionChange:async g=>{if(p=typeof g?.id=="string"?g.id:null,!p){F=new Set;return}await x()},syncFromRemote:x}}});var rn=Yt(()=>{jt();Jt();Gt();ye();ye();ye();It();Kt();ye();pt();(function(){let n=()=>{let e=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(i instanceof HTMLElement)){let f=typeof n._retryCount=="number"?n._retryCount:0;f<10&&(n._retryCount=f+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let l=e.querySelector("[data-dialog-content]"),m=e.querySelector(".sheet-backdrop"),c=document.getElementById("createReminderForm"),p=document.getElementById("saveReminder"),b=document.getElementById("priority"),F=document.getElementById("priorityChips"),H=F?Array.from(F.querySelectorAll('input[name="priority"]')):[],O=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),S=Array.from(O).filter(f=>f instanceof HTMLElement),x=S[0]||null,$=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};$();let g=null,D=(f,L)=>{try{document.dispatchEvent(new CustomEvent(f,{detail:L}))}catch(w){console.warn(`${f} dispatch failed`,w)}},_=()=>{let f=b?.value||"Medium";H.forEach(L=>{let w=L.value===f;L.checked=w,L.setAttribute("aria-checked",w?"true":"false")})},P=f=>{b&&(b.value!==f&&(b.value=f,b.dispatchEvent(new Event("change",{bubbles:!0}))),_())};H.forEach(f=>{f.addEventListener("change",()=>{f.checked&&P(f.value)})}),b?.addEventListener("change",_),_();let V=()=>{let f=e.querySelector('input, textarea, select, button, [contenteditable="true"]');f instanceof HTMLElement&&setTimeout(()=>{try{f.focus()}catch{}},0)},Y=f=>{g=f instanceof HTMLElement?f:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),g&&g.setAttribute("aria-expanded","true"),_(),V(),D("reminder:sheet-opened",{trigger:g})},A=(f="dismissed")=>{let L=!e.classList.contains("hidden");$(),g&&g.setAttribute("aria-expanded","false");let w=g&&document.body.contains(g)&&g||x;if(w&&typeof w.focus=="function")try{w.focus()}catch{}L&&D("reminder:sheet-closed",{reason:f,trigger:g}),g=null};S.forEach(f=>{f.addEventListener("click",L=>{L.preventDefault();let w={mode:"create",trigger:f};D("cue:prepare",w),D("cue:open",w)})}),i.addEventListener("click",f=>{f.preventDefault(),A("close-button")}),m?.addEventListener("click",f=>{f.target===m&&A("backdrop")}),e.addEventListener("keydown",f=>{f.key==="Escape"&&(f.stopPropagation(),A("escape"))}),l?.addEventListener("click",f=>{f.stopPropagation()}),e.addEventListener("click",f=>{f.target instanceof HTMLElement&&f.target.hasAttribute("data-close")&&A("backdrop")}),document.addEventListener("cue:open",f=>{_(),Y(f?.detail?.trigger||null)}),document.addEventListener("cue:close",f=>{A(f?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{_()}),document.addEventListener("cue:cancelled",()=>{A("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=A),document.addEventListener("reminder:save",f=>{if(!(p instanceof HTMLElement))return;let L=f?.detail?.trigger;L&&L!==p||p.matches(":disabled")||p.click()}),c instanceof HTMLFormElement&&p instanceof HTMLElement&&c.addEventListener("submit",f=>{f.preventDefault(),!p.matches(":disabled")&&p.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var Me=()=>{Me._initialised||(Me._initialised=!0,bt({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Me,{once:!0}):Me();var Bt=()=>{let n=document.getElementById("notifHeaderBtn"),e=document.getElementById("notifBtn");n&&e&&n.addEventListener("click",()=>{e.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Bt,{once:!0}):Bt();var Nt=()=>{if(typeof document>"u")return;let n=document.getElementById("noteTitleMobile"),e=document.getElementById("scratchNotesEditor"),i=document.getElementById("noteSaveMobile"),l=document.getElementById("noteNewMobile"),m=document.getElementById("notesListMobile"),c=document.getElementById("notesCountMobile"),p=document.getElementById("notesSearchMobile"),b=document.getElementById("savedNotesSheet"),F=document.getElementById("openSavedNotesSheet"),H=document.querySelector('[data-action="close-saved-notes"]'),O="shadow-[0_0_0_3px_var(--accent-color)]",x=(()=>{if(!e)return null;let t=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return t?new t("#scratchNotesEditor",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.dataset.placeholder="Start typing your note\u2026",{element:e,setContent(o=""){e.innerHTML=o||""},getHTML(){return e.innerHTML||""},getText(){return e.textContent||""},focus(){try{e.focus()}catch{}}})})();if(!n||!x||!e||!i)return;let $=document.getElementById("scratchNotesToolbar");$&&e&&$.addEventListener("click",t=>{let o=t.target.closest("button[data-format]");if(!o)return;let r=o.getAttribute("data-format");try{e.focus()}catch{}switch(r){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"ul":document.execCommand("insertUnorderedList",!1,null);break;case"ol":document.execCommand("insertOrderedList",!1,null);break;default:break}});let g=(t="")=>{if(x&&typeof x.setContent=="function"){x.setContent(t||"");return}e.innerHTML=t||""},D=()=>x&&typeof x.getHTML=="function"?x.getHTML()||"":e.innerHTML||"",_=()=>x&&typeof x.getText=="function"?x.getText()||"":e.textContent||"",P=t=>{let o=t;for(;o&&o!==e;){if(o.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(o.tagName?.toLowerCase()))return o;o=o.parentNode}return e},V=t=>{if(typeof t!="string")return null;let o=t.replace(/\u00a0/g," ").trim();return o==="*"?"ul":o==="1"?"ol":null},Y=t=>{if(![" ","Enter"].includes(t.key))return;let o=window.getSelection();if(!o||o.rangeCount===0)return;let r=o.getRangeAt(0);if(!e.contains(r.startContainer))return;let s=P(r.startContainer),a=r.cloneRange();a.selectNodeContents(s),a.setEnd(r.startContainer,r.startOffset);let u=V(a.toString());if(!u)return;t.preventDefault();let T=(s.textContent||"").replace(/^\s*[\*1]\s?/,"");s.textContent=T;let C=s.firstChild||s,h=document.createRange();h.setStart(C,(C.nodeType===Node.TEXT_NODE,0)),h.collapse(!0),o.removeAllRanges(),o.addRange(h);try{e.focus()}catch{}document.execCommand(u==="ul"?"insertUnorderedList":"insertOrderedList",!1,null)},A=(t,o=200)=>{let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>{t(...s)},o)}},f=null,L=[],w="all",z="unsorted",d="",v=!1,I=null,M=()=>b?.dataset.open==="true",k=()=>{if(b){I&&(clearTimeout(I),I=null),b.classList.remove("hidden"),b.dataset.open="true",b.setAttribute("aria-hidden","false");try{X()}catch{}try{se()}catch{}}},N=()=>{b&&(b.dataset.open="false",b.setAttribute("aria-hidden","true"),I&&clearTimeout(I),I=setTimeout(()=>{b?.classList.add("hidden")},200))};(()=>{b&&(F?.addEventListener("click",t=>{t.preventDefault(),k();let o=document.getElementById("notesListMobile");o&&(o.scrollTop=0)}),H?.addEventListener("click",t=>{t.preventDefault(),N()}),b.addEventListener("click",t=>{t.target===b&&N()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&M()&&N()}))})();let G=()=>typeof d=="string"?d.trim().toLowerCase():"",We=(t=L)=>{if(!Array.isArray(t))return[];let o=G();return o?t.filter(r=>{let s=typeof r?.title=="string"?r.title.toLowerCase():"",a=typeof r?.body=="string"?r.body.toLowerCase():"";return s.includes(o)||a.includes(o)}):[...t]},J=(t=L)=>{if(!Array.isArray(t))return[];let o;return w===null||w==="all"?o=[...t]:w==="unsorted"?o=t.filter(r=>!r.folderId||r.folderId==="unsorted"):o=t.filter(r=>r.folderId===w),We(o)},Tt=(t=[],o=[])=>{let r={all:Array.isArray(t)?t.length:0,unsorted:0};return(Array.isArray(o)?o:[]).forEach(s=>{s&&s.id&&s.id!=="unsorted"&&(r[s.id]=0)}),(Array.isArray(t)?t:[]).forEach(s=>{let a=s?.folderId||"unsorted";!a||a==="unsorted"?r.unsorted+=1:Object.prototype.hasOwnProperty.call(r,a)?r[a]+=1:r.unsorted+=1}),r},ee=t=>{if(!t){f=null,n.value="",g(""),delete n.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;let a=document.getElementById("note-folder-label");a&&(a.textContent=me(z||"unsorted"));return}f=t.id;let o=t.title||"",r=t.body||"";n.value=o,g(r),n.dataset.noteOriginalTitle=o,e.dataset.noteOriginalBody=r,z=t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted";let s=document.getElementById("note-folder-label");s&&(s.textContent=me(z))},kt=()=>({title:typeof n.value=="string"?n.value.trim():"",body:D()}),pe=()=>{if(!m)return;m.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(o=>{if(!(o instanceof HTMLElement))return;let r=o.getAttribute("data-note-id")===f;r?o.setAttribute("data-state","active"):o.removeAttribute("data-state"),o.classList.toggle("active",r),o.classList.toggle("outline",r),o.classList.toggle("outline-2",r),o.classList.toggle("outline-accent",r),o.classList.toggle(O,r),o.setAttribute("aria-current",r?"true":"false")})},xt=t=>{if(!t)return"";let o=new Date(t);if(Number.isNaN(o.getTime()))return"";let r=new Date,s=o.getFullYear()===r.getFullYear()&&o.getMonth()===r.getMonth()&&o.getDate()===r.getDate(),a=o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return s?`Today \xB7 ${a}`:`${o.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${a}`},Oe=()=>{let t=typeof n.value=="string"?n.value:"",o=D(),r=n.dataset.noteOriginalTitle??"",s=e.dataset.noteOriginalBody??"";return t!==r||o!==s},Ft=()=>{let t=Z();return Array.isArray(t)?[...t].sort((o,r)=>{let s=Date.parse(o?.updatedAt||""),a=Date.parse(r?.updatedAt||"");return(Number.isNaN(a)?0:a)-(Number.isNaN(s)?0:s)}):[]},Re=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(ve)}catch{return null}},ge=Re(),Le=()=>(ge=Re(),ge),de=({preserveDraft:t=!0}={})=>{let o=Ft();L=Array.isArray(o)?[...o]:[];try{X()}catch{}let r=t&&Oe(),s=L.length>0,a=J();if(Je(a),!s)return r||ee(null),pe(),Le(),v=!1,a;if(f){let u=L.find(y=>y.id===f)||null;u?r||ee(u):(f=null,!r&&!v&&L[0]&&ee(L[0]))}else!r&&!v&&L[0]&&ee(L[0]);return v=!1,pe(),Le(),a},Ge=t=>{if(!t)return;let o=Z();if(!Array.isArray(o))return;let r=o.filter(s=>s.id!==t);r.length!==o.length&&(Q(r),Le(),f===t&&(ee(null),v=!0),de({preserveDraft:!1}))},Je=(t=[])=>{if(!m)return t;if(m.innerHTML="",c){let o=L.length,r=t.length;c.textContent=o?`${r} of ${o} saved`:"No saved notes yet"}if(!t.length){let o=!!G(),a=o?"No notes match this filter":!w||w==="all"?"You don't have any notes yet.":w&&w!=="all"&&w!=="unsorted"?"No notes in this folder yet.":"No notes here yet",u=o?"Try adjusting your search or filters.":"Create your first note in this folder to get started.";return m.innerHTML=`
        <div class="notebook-empty-state">
          <h3 class="notebook-empty-title">${a}</h3>
          <p class="notebook-empty-body">${u}</p>
        </div>
      `,t}return t.forEach(o=>{let r=document.createElement("li");r.className="note-item-mobile w-full";let s=document.createElement("button");s.type="button",s.dataset.noteId=o.id,s.dataset.role="open-note",s.className="saved-note-item note-list-item w-full text-left active:scale-[0.99] focus:outline-none";let a=document.createElement("div");a.className="flex items-center justify-between gap-2";let u=document.createElement("div");u.className="flex items-center gap-2";let y=document.createElement("span");y.className="saved-note-title note-list-title truncate";let T=o.title||"Untitled";y.textContent=T,y.setAttribute("title",T);let C=document.createElement("span");C.className="note-folder-badge";let h=o.folderId&&typeof o.folderId=="string"?o.folderId:"unsorted";C.textContent=me(h);let E=document.createElement("span");E.className="saved-note-meta note-list-meta";let q=o.updatedAt||o.modifiedAt||o.createdAt||"";E.textContent=q?xt(q):"";let R=document.createElement("button");R.type="button",R.dataset.noteId=o.id,R.dataset.role="note-menu",R.className="btn btn-ghost btn-xs rounded-full text-base-content/80 hover:bg-base-100",R.setAttribute("aria-label","Note actions"),R.textContent="\u22EF";let K=document.createElement("div");K.className="flex items-center gap-1",K.appendChild(E),K.appendChild(R),u.appendChild(y),u.appendChild(C),a.appendChild(u),a.appendChild(K);let Ee=document.createElement("p");Ee.className="saved-note-preview note-list-preview line-clamp-2";let W=o.body||"",Pe=String(W).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();Ee.textContent=Pe||"No content yet.",s.appendChild(a),s.appendChild(Ee);let le=document.createElement("button");le.type="button",le.dataset.noteId=o.id,le.dataset.role="delete-note",le.className="delete-note-btn btn btn-ghost btn-xs text-error shrink-0 focus-visible:outline-none focus-visible:ring-0",le.setAttribute("aria-label","Delete note"),le.textContent="\u2715";let ke=document.createElement("div");ke.className="flex items-start justify-between gap-3",ke.appendChild(s),ke.appendChild(le),r.appendChild(ke),m.appendChild(r)}),pe(),t},Ke=()=>document.getElementById("notebook-folder-bar"),Qe=t=>{let o=Ke();if(!o)return;o.querySelectorAll(".notebook-folder-chip").forEach(s=>{let a=String(s.dataset.folderId)===String(t);if(s.classList.toggle("notebook-folder-chip--active",a),s.classList.toggle("active",a),a)try{s.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}catch{try{s.scrollIntoView()}catch{}}})},X=()=>{let t=Ke();if(!t)return;t.innerHTML="";let o=[];try{o=Array.isArray(U())?U():[]}catch{o=[]}let r=Array.isArray(o)?o.filter(Boolean):[],s=r.find(h=>h&&h.id==="unsorted")||{id:"unsorted",name:"Unsorted"},a=r.filter(h=>h&&h.id!=="unsorted").sort((h,E)=>String(h.name||"").localeCompare(String(E.name||""),void 0,{sensitivity:"base"})),u=[s,...a],y=Tt(L,u);[{id:"all",name:"All",isVirtual:!0},{...s,isVirtual:!1},...a.map(h=>({...h,isVirtual:!1}))].forEach(h=>{let E=document.createElement("button");if(E.type="button",E.className="folder-chip notebook-folder-chip",E.dataset.folderId=h.id,h.id!=="all"&&h.id!=="unsorted"){let W=document.createElement("span");W.className="notebook-folder-chip-grip",W.setAttribute("aria-hidden","true"),E.appendChild(W)}let q=document.createElement("span");q.className="notebook-folder-chip-label",q.textContent=h.name,E.appendChild(q);let R=document.createElement("span");R.className="notebook-folder-chip-count";let K=h.id==="all"?"all":h.id||"unsorted",Ee=typeof y[K]=="number"?y[K]:0;if(R.textContent=Ee,E.appendChild(R),E.addEventListener("click",()=>{w=h.id==="all"?"all":h.id,Qe(w),se()}),h.id!=="all"&&h.id!=="unsorted"){let W=document.createElement("button");W.type="button",W.className="notebook-folder-chip-overflow",W.setAttribute("aria-label","Folder options"),W.innerHTML="\u22EF",W.addEventListener("click",Pe=>{Pe.stopPropagation(),_t(h.id,E)}),E.appendChild(W)}t.appendChild(E)});let C=document.createElement("button");C.type="button",C.className="folder-chip outlined notebook-folder-chip notebook-folder-chip--new",C.dataset.folderId="new-folder",C.textContent="+ New folder",C.addEventListener("click",h=>{h.preventDefault();try{Mt()}catch(E){console.warn("[notebook] failed to open new folder dialog",E)}}),t.appendChild(C),Qe(w)},sn=()=>{try{X()}catch(t){console.warn("[notebook] Unable to build folder bar",t)}},Xe=document.getElementById("newFolderModal"),te=document.getElementById("newFolderName"),ce=document.getElementById("newFolderError"),Ze=document.getElementById("newFolderCreate"),Dt=document.getElementById("newFolderCancel"),we=null,et=()=>{ce&&(ce.classList.add("sr-only"),ce.textContent="")},Ue=t=>{ce&&(ce.textContent=t,ce.classList.remove("sr-only"))},Mt=()=>{Xe&&(we||(we=new Se({modalElement:Xe,closeButton:Dt,titleInput:te,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),et(),te&&(te.value=""),we.show())},tt=()=>{if(!te)return;let o=String(te.value||"").trim();if(et(),!o.length){Ue("Folder name can't be empty.");return}let r=[];try{r=Array.isArray(U())?U():[]}catch{r=[]}if(r.some(C=>String(C.name).toLowerCase()===o.toLowerCase())){Ue("You already have a folder with this name.");return}let a=`folder-${Date.now().toString(36)}`,u={id:a,name:o},y=[...r.filter(Boolean),u];if(!Ae(y)){Ue("Unable to create folder. Please try again.");return}try{we.requestClose("created")}catch{}w=a;try{X()}catch(C){console.warn("[notebook] rebuild folder chips failed",C)}se()};Ze&&Ze.addEventListener("click",t=>{t.preventDefault(),tt()}),te&&te.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),tt())});let nt=document.getElementById("pickFolderModal"),_e=document.getElementById("pickFolderList"),ot=document.getElementById("pickFolderConfirm"),Ot=document.getElementById("pickFolderCancel"),Ce=null,ne=null,Ie=null,rt=(t={})=>{let{initialFolderId:o=null,onConfirm:r=null}=t||{};if(!nt||!_e)return;ne=(o&&typeof o=="string"?o:z)||"unsorted",Ie=typeof r=="function"?r:null,_e.innerHTML="";let s=[];try{s=Array.isArray(U())?U():[]}catch{s=[]}s.some(a=>a&&a.id==="unsorted")||s.unshift({id:"unsorted",name:"Unsorted"}),s.forEach(a=>{let u=document.createElement("div");u.className="flex items-center gap-3 p-2 rounded-md hover:bg-base-100";let y=document.createElement("input");y.type="radio",y.name="pick-folder",y.value=a.id,y.id=`pick-folder-${a.id}`,(String(a.id)===String(ne)||!ne&&a.id==="unsorted")&&(y.checked=!0,ne=a.id),y.addEventListener("change",()=>{ne=y.value});let C=document.createElement("label");C.setAttribute("for",y.id),C.textContent=a.name,u.appendChild(y),u.appendChild(C),_e.appendChild(u)}),Ce||(Ce=new Se({modalElement:nt,closeButton:Ot,titleInput:null,autoFocus:!0})),Ce.show()};ot&&ot.addEventListener("click",t=>{if(t.preventDefault(),!ne)return;let o=ne;if(Ie){try{Ie(o)}catch(r){console.warn("[notebook] folder pick handler failed",r)}Ie=null}else{z=o==="unsorted"?"unsorted":o;let r=document.getElementById("note-folder-label");r&&(r.textContent=me(z))}try{Ce.requestClose("selected")}catch{}});let it=document.getElementById("note-folder-button");it&&it.addEventListener("click",t=>{t.preventDefault(),rt()});let oe=null,j=()=>{oe&&oe.parentNode&&oe.parentNode.removeChild(oe),oe=null,document.removeEventListener("click",j),document.removeEventListener("keydown",He)},He=t=>{t.key==="Escape"&&j()},Rt=(t,o)=>{if(!(!t||!wt(t,o==="unsorted"?null:o))){try{de({preserveDraft:!0})}catch(a){console.warn("[notebook] failed to refresh notes after move",a)}try{X()}catch(a){console.warn("[notebook] failed to refresh folder chips after move",a)}j()}},Ut=(t,o)=>{if(!t||!o)return;j();let r=document.createElement("div");r.className="memory-glass-card p-2 rounded-2xl shadow-xl backdrop-blur-md border border-base-200/80",r.style.position="absolute",r.style.zIndex=1200,r.style.minWidth="180px";let s=document.createElement("button");s.type="button",s.className="w-full text-left px-3 py-2 btn-ghost rounded-xl",s.textContent="Move to folder\u2026",s.addEventListener("click",u=>{u.preventDefault(),rt({initialFolderId:t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted",onConfirm:y=>Rt(t.id,y)})});let a=document.createElement("button");a.type="button",a.className="w-full text-left px-3 py-2 btn-ghost text-error rounded-xl",a.textContent="Delete note",a.addEventListener("click",u=>{u.preventDefault();let y=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(y?y("Delete this note? This cannot be undone."):!0)&&Ge(t.id),j()}),r.appendChild(s),r.appendChild(a),document.body.appendChild(r),oe=r;try{let u=o.getBoundingClientRect(),y=u.bottom+window.scrollY+6,T=u.right+window.scrollX-r.offsetWidth;r.style.top=`${y}px`,r.style.left=`${T}px`}catch{r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}document.addEventListener("click",j),document.addEventListener("keydown",He)},st=(t,o)=>{if(!t||o!==-1&&o!==1)return;let r=[];try{r=Array.isArray(U())?U().slice():[]}catch{r=[]}if(!r.length)return;let s=r.filter(E=>E&&E.id!=="unsorted");s.sort((E,q)=>(Number(E.order)||0)-(Number(q.order)||0));let a=s.findIndex(E=>String(E.id)===String(t));if(a===-1)return;let u=a+o;if(u<0||u>=s.length)return;let y=s[a].order;s[a].order=s[u].order,s[u].order=y;let h=[r.find(E=>E&&E.id==="unsorted")||{id:"unsorted",name:"Unsorted",order:-1},...s].map((E,q)=>({id:E.id,name:E.name,order:q}));try{if(Ae(h)){try{X()}catch{}try{se()}catch{}}}catch(E){console.warn("[notebook] reorder save failed",E)}},_t=(t,o)=>{if(!t||t==="all"||t==="unsorted")return;j();let r=document.createElement("div");r.className="memory-glass-card p-2 rounded shadow-lg",r.style.position="absolute",r.style.zIndex=1200,r.style.minWidth="160px";let s=!1,a=!1;try{let E=(Array.isArray(U())?U().filter(Boolean):[]).filter(R=>R&&R.id!=="unsorted").sort((R,K)=>(Number(R.order)||0)-(Number(K.order)||0)),q=E.findIndex(R=>String(R.id)===String(t));s=q===0,a=q===-1?!0:q===E.length-1}catch{s=!1,a=!1}let u=document.createElement("button");u.type="button",u.className="w-full text-left px-3 py-2 btn-ghost",u.textContent="Move up",s&&(u.setAttribute("disabled",""),u.classList.add("opacity-50","cursor-not-allowed")),u.addEventListener("click",h=>{h.preventDefault();try{st(t,-1)}catch(E){console.warn("[notebook] reorder move up failed",E)}j()});let y=document.createElement("button");y.type="button",y.className="w-full text-left px-3 py-2 btn-ghost",y.textContent="Move down",a&&(y.setAttribute("disabled",""),y.classList.add("opacity-50","cursor-not-allowed")),y.addEventListener("click",h=>{h.preventDefault();try{st(t,1)}catch(E){console.warn("[notebook] reorder move down failed",E)}j()});let T=document.createElement("button");T.type="button",T.className="w-full text-left px-3 py-2 btn-ghost",T.textContent="Rename folder",T.addEventListener("click",h=>{h.preventDefault(),qt(t),j()});let C=document.createElement("button");C.type="button",C.className="w-full text-left px-3 py-2 btn-ghost text-accent",C.textContent="Delete folder",C.addEventListener("click",h=>{h.preventDefault(),$t(t),j()}),r.appendChild(u),r.appendChild(y),r.appendChild(T),r.appendChild(C),document.body.appendChild(r),oe=r;try{let h=o.getBoundingClientRect(),E=h.bottom+window.scrollY+6,q=h.left+window.scrollX;r.style.top=`${E}px`,r.style.left=`${q}px`}catch{r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}document.addEventListener("click",j),document.addEventListener("keydown",He)},lt=document.getElementById("renameFolderModal"),re=document.getElementById("renameFolderName"),ue=document.getElementById("renameFolderError"),at=document.getElementById("renameFolderSave"),Ht=document.getElementById("renameFolderCancel"),Be=null,he=null,dt=()=>{ue&&(ue.classList.add("sr-only"),ue.textContent="")},qe=t=>{ue&&(ue.textContent=t,ue.classList.remove("sr-only"))},qt=t=>{if(!lt||t==="all"||t==="unsorted")return;he=t;let r=(Array.isArray(U())?U():[]).find(s=>s&&String(s.id)===String(t));r&&(Be||(Be=new Se({modalElement:lt,closeButton:Ht,titleInput:re,modalTitle:document.getElementById("renameFolderTitle"),autoFocus:!0})),dt(),re&&(re.value=r.name||""),Be.show())},ct=()=>{if(!he||!re)return;let o=String(re.value||"").trim();if(dt(),!o.length){qe("Folder name can't be empty.");return}let r=[];try{r=Array.isArray(U())?U():[]}catch{r=[]}if(r.some(y=>String(y.name).toLowerCase()===o.toLowerCase()&&String(y.id)!==String(he))){qe("You already have a folder with this name.");return}let a=r.map(y=>String(y.id)===String(he)?{...y,name:o}:y);if(!Ae(a)){qe("Unable to rename folder. Please try again.");return}try{Be.requestClose("saved")}catch{}he=null;try{X()}catch{}se()};at&&at.addEventListener("click",t=>{t.preventDefault(),ct()}),re&&re.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),ct())});let ut=document.getElementById("deleteFolderModal"),ft=document.getElementById("deleteFolderConfirm"),Pt=document.getElementById("deleteFolderCancel"),be=null,ie=null,$t=t=>{!ut||t==="all"||t==="unsorted"||(ie=t,be||(be=new Se({modalElement:ut,closeButton:Pt,titleInput:null,modalTitle:document.getElementById("deleteFolderTitle"),autoFocus:!1})),be.show())},zt=()=>{if(!ie)return;let t=[];try{t=Array.isArray(U())?U():[]}catch{t=[]}let o=t.filter(u=>String(u.id)!==String(ie));if(o.some(u=>u&&u.id==="unsorted")||o.unshift({id:"unsorted",name:"Unsorted"}),!Ae(o)){try{be.requestClose("failed")}catch{}ie=null;return}let s=Z(),a=(Array.isArray(s)?s:[]).map(u=>u&&String(u.folderId)===String(ie)?{...u,folderId:"unsorted",updatedAt:new Date().toISOString()}:u);Q(a),String(w)===String(ie)&&(w="unsorted"),ie=null;try{be.requestClose("deleted")}catch{}X(),se()};ft&&ft.addEventListener("click",t=>{t.preventDefault(),zt()}),m&&m.addEventListener("click",t=>{let o=t.target;if(!(o instanceof HTMLElement))return;let r=o.closest('button[data-role="delete-note"]');if(r&&m.contains(r)){t.preventDefault();let u=r.getAttribute("data-note-id");if(!u)return;let y=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(y?y("Delete this note? This cannot be undone."):!0)&&Ge(u);return}let s=o.closest('button[data-role="note-menu"]');if(s&&m.contains(s)){t.preventDefault();let u=s.getAttribute("data-note-id");if(!u)return;let y=L.find(T=>T.id===u);y&&Ut(y,s);return}let a=o.closest('button[data-role="open-note"]');if(a&&m.contains(a)){t.preventDefault();let u=a.getAttribute("data-note-id");if(!u)return;let y=L.find(T=>T.id===u);y&&(ee(y),pe(),M()&&N())}});let se=()=>{Je(J())};if(p){let t=A(()=>{d=typeof p.value=="string"?p.value:"",se()},180);p.addEventListener("input",t),p.addEventListener("search",t)}let Vt=()=>{de({preserveDraft:!1})};i.addEventListener("click",()=>{let t=Z(),o=Array.isArray(t)?[...t]:[],{title:r,body:s}=kt(),a=r||"Untitled note",u=new Date().toISOString(),y=z&&z!=="all"?z:"unsorted";if(f){let T=o.findIndex(C=>C.id===f);if(T>=0)o[T]={...o[T],title:a,body:s,updatedAt:u,folderId:y};else{let C=ae(a,s,{updatedAt:u,folderId:y});f=C.id,o.unshift(C)}}else{let T=ae(a,s,{folderId:y});f=T.id,o.unshift(T)}Q(o),Le(),de({preserveDraft:!1})});let mt=()=>{ee(null),z=w&&w!=="all"?w:"unsorted";let t=document.getElementById("note-folder-label");if(t&&(t.textContent=me(z)),pe(),typeof n.focus=="function")try{n.focus()}catch{}};l&&l.addEventListener("click",t=>{t.preventDefault(),mt()});let Ne=document.getElementById("mobile-footer-new-note");Ne&&Ne.addEventListener("click",t=>{t.preventDefault();try{Ne.getAttribute("data-nav-target")&&(document.querySelectorAll("[data-nav-target]").forEach(s=>s.classList.remove("active")),Ne.classList.add("active"))}catch{}mt()});let Te=A(()=>{try{if(!Oe())return;i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}},1500);try{n.addEventListener("input",Te)}catch{}try{e.addEventListener("input",Te),e.addEventListener("keydown",Y),e.addEventListener("blur",()=>{Te()}),n.addEventListener("blur",()=>Te())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",t=>{try{Oe()&&i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}}),Vt(),typeof window<"u"&&(window.addEventListener("storage",t=>{t.key===ve&&(ge=t.newValue??null,de({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let t=Re();t!==ge&&(ge=t,de({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Nt,{once:!0}):Nt();var je=Ct(),Ye=ht({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:n=>{je?.handleSessionChange(n)}});if(Ye?.supabase){je?.setSupabaseClient(Ye.supabase);try{Ye.supabase.auth.getSession().then(({data:n})=>{je?.handleSessionChange(n?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let n=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let i='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',l=n,m=S=>{if(!(S instanceof HTMLElement)||S.getAttribute("aria-hidden")==="true"||S.hasAttribute("disabled")||S.tabIndex<0)return!1;let x=S.getBoundingClientRect();return x.width>0||x.height>0},c=()=>Array.from(e.querySelectorAll(i)).filter(m),p=()=>{let S=e.classList.contains("hidden");e.setAttribute("aria-hidden",S?"true":"false")};p();let b=S=>{!e.contains(S.target)&&S.target!==n&&O({restoreFocus:!1})},F=()=>{let[S]=c();if(S instanceof HTMLElement)try{S.focus()}catch{}},H=()=>{e.classList.contains("hidden")&&(l=document.activeElement instanceof HTMLElement?document.activeElement:n,e.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),p(),document.addEventListener("focusin",b),!e.contains(document.activeElement)&&F())},O=({restoreFocus:S=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),n.setAttribute("aria-expanded","false"),p(),document.removeEventListener("focusin",b),S&&l instanceof HTMLElement))try{l.focus()}catch{}};n.addEventListener("click",S=>{S.stopPropagation(),e.classList.contains("hidden")?H():O()}),document.addEventListener("click",S=>{S.target===n||e.contains(S.target)||O({restoreFocus:!1})}),document.addEventListener("keydown",S=>{if(S.key==="Escape"){O();return}S.key==="ArrowDown"&&!e.classList.contains("hidden")&&(S.preventDefault(),F())}),e.addEventListener("click",S=>{S.stopPropagation(),S.target instanceof HTMLElement&&S.target.closest("button")&&O({restoreFocus:!1})}),e.addEventListener("keydown",S=>{if(S.key!=="Tab")return;let x=c();if(!x.length)return;let $=x.indexOf(document.activeElement),g=x.length-1,D=$;S.shiftKey?D=$<=0?g:$-1:D=$===g?0:$+1,S.preventDefault();let _=x[D]||x[0];if(_ instanceof HTMLElement)try{_.focus()}catch{}})})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let e=()=>{let m=document.getElementById("voiceBtn");return m instanceof HTMLElement?m:null},i=()=>{let m=e();if(!m)return;let c=()=>{m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let b=m.getAttribute("title");b&&n.setAttribute("title",b)};c(),typeof MutationObserver=="function"&&new MutationObserver(c).observe(m,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i();let l=()=>{let m=e();if(m&&!(m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true")){try{m.focus({preventScroll:!0})}catch{try{m.focus()}catch{}}try{m.click()}catch(c){console.warn("Voice add trigger failed",c)}}};n.addEventListener("click",m=>{m.preventDefault();let c=!1,p=null,b=()=>{c||(c=!0,document.removeEventListener("reminder:sheet-opened",F),l())},F=O=>{if(O?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&p&&(window.clearTimeout(p),p=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,150)};document.addEventListener("reminder:sheet-opened",F);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(O){document.removeEventListener("reminder:sheet-opened",F),typeof window<"u"&&typeof window.clearTimeout=="function"&&p&&(window.clearTimeout(p),p=null),console.warn("Voice add open failed",O);return}let H=document.getElementById("create-sheet");H instanceof HTMLElement&&H.classList.contains("open")&&(p=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let i=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],l=()=>{let c=e.hasAttribute("open");n.setAttribute("aria-expanded",String(c)),n.classList.toggle("btn-active",c)},m=()=>{for(let c of i){let p=e.querySelector(c);if(p instanceof HTMLElement&&!p.hasAttribute("disabled")){try{p.focus({preventScroll:!0})}catch{p.focus()}return}}};n.addEventListener("click",()=>{let c=e.hasAttribute("open");e.open=!c,c||m(),l()}),e.addEventListener("toggle",l),l()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function e(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let e=document.getElementById("totalCount");if(!e)return;let i=Array.isArray(n?.detail?.items)?n.detail.items.length:0;e.textContent=String(i)});document.addEventListener("click",n=>{try{let e=n.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let e=Array.from(n.children);if(e.length<=30)return;let i=20;n.innerHTML="";let l=0;function m(){let b=e.slice(l,l+i);b.forEach(F=>n.appendChild(F)),l+=b.length}m();let c=document.createElement("div");c.id="listSentinel",n.appendChild(c);let p=new IntersectionObserver(b=>{b.some(F=>F.isIntersecting)&&l<e.length&&(m(),l>=e.length&&p.disconnect())});p.observe(c)})();(function(){let n=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(c=>c instanceof HTMLElement),e=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!n.length||!e||!i)return;function l(){e.classList.remove("hidden")}function m(){e.classList.add("hidden")}n.forEach(c=>{c.addEventListener("click",l)}),i.addEventListener("click",m),e.addEventListener("click",c=>{c.target instanceof HTMLElement&&c.target.matches("[data-close]")&&m()}),e.addEventListener("keydown",c=>{c.key==="Escape"&&m()})})();(function(){let n=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),i=document.getElementById("mcStatusText"),l=document.getElementById("syncUrl"),m=document.getElementById("saveSyncSettings"),c=document.getElementById("testSync"),p=document.getElementById("syncAll"),b="syncUrl";if(!i)return;let F=["online","offline","error"],H=["online","offline"],O={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},S={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},x=null;function $(d){if(!e)return;H.forEach(I=>e.classList.remove(I));let v=d!=="offline"&&d!=="error";e.classList.add(v?"online":"offline"),e.setAttribute("aria-label",v?"Online":"Offline")}function g(d,v){x=d,F.forEach(N=>i.classList.remove(N)),n&&F.forEach(N=>n.classList.remove(N)),d==="online"?(i.classList.add("online"),n&&n.classList.add("online")):d==="error"?(i.classList.add("error"),n&&n.classList.add("error")):(i.classList.add("offline"),n&&n.classList.add("offline"));let I=typeof v=="string"&&v.trim()?v.trim():O[d]||"",M=typeof v=="string"&&v.trim()?v.trim():S[d]||I,k=I||M||"";i.textContent=k,k?(i.setAttribute("title",k),i.setAttribute("aria-label",k)):(i.removeAttribute("title"),i.removeAttribute("aria-label")),$(d),i.dataset.state=d}function D(){x!=="syncing"&&g(navigator.onLine?"online":"offline")}function _(d){typeof localStorage>"u"||(d?localStorage.setItem(b,d):localStorage.removeItem(b))}function P(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(b)||""}catch{return""}}function V(d){if(!d||typeof d!="object")return null;let v=d.id||d.uid||d.key||d.slug||d.uuid,I=typeof d.title=="string"&&d.title.trim()?d.title.trim():typeof d.name=="string"?d.name.trim():"";if(!I)return null;let M=typeof d.dueIso=="string"&&d.dueIso?d.dueIso:typeof d.due=="string"?d.due:null,k=typeof d.priority=="string"&&d.priority.trim()?d.priority.trim():d.level||d.importance||"Medium",N=typeof d.category=="string"&&d.category.trim()?d.category.trim():d.group||d.bucket||"General",B=typeof d.done=="boolean"?d.done:!!(d.completed||d.isDone||d.status==="done");return{id:v||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:I,dueIso:M&&M.trim()?M.trim():null,priority:k,category:N,done:B}}function Y(){let d=Array.from(document.querySelectorAll("[data-reminder]"));return d.length?d.map(v=>{let I=v.dataset||{},M=null;if(I.reminder)try{M=JSON.parse(I.reminder)}catch{M=null}let k=M||{id:I.id||I.reminderId||v.getAttribute("data-id")||null,title:I.title||I.reminderTitle||"",dueIso:I.due||I.reminderDue||v.getAttribute("data-due")||null,priority:I.priority||I.reminderPriority||v.getAttribute("data-priority")||"",category:I.category||I.reminderCategory||v.getAttribute("data-category")||"",done:I.done==="true"||I.reminderDone==="true"||v.getAttribute("data-done")==="true"};if(!k.title){let N=v.querySelector("[data-reminder-title], [data-title], h3, h4, strong");N&&(k.title=N.textContent.trim())}if(!k.dueIso){let N=v.querySelector("[data-due], time");if(N){let B=N.getAttribute("datetime")||N.getAttribute("data-due");k.dueIso=B||N.textContent.trim()}}return V(k)}).filter(Boolean):[]}function A(){if(typeof localStorage>"u")return[];let d=[],v=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(M=>{if(!v.has(M)){v.add(M);try{let k=localStorage.getItem(M);if(!k)return;let N=JSON.parse(k);Array.isArray(N)?N.forEach(B=>d.push(B)):N&&typeof N=="object"&&(Array.isArray(N.items)&&N.items.forEach(B=>d.push(B)),Array.isArray(N.reminders)&&N.reminders.forEach(B=>d.push(B)))}catch{}}}),!d.length)for(let M=0;M<localStorage.length;M+=1){let k=localStorage.key(M);if(!(!k||v.has(k)||!/remind/i.test(k))){v.add(k);try{let N=localStorage.getItem(k);if(!N)continue;let B=JSON.parse(N);Array.isArray(B)?B.forEach(G=>d.push(G)):B&&typeof B=="object"&&(Array.isArray(B.items)&&B.items.forEach(G=>d.push(G)),Array.isArray(B.reminders)&&B.reminders.forEach(G=>d.push(G)))}catch{}}}return d.map(V).filter(Boolean)}function f(){let d=Y();return d.length?d:A()}function L(d){d?(p?.setAttribute("aria-busy","true"),p?.setAttribute("disabled","disabled"),c?.setAttribute("aria-busy","true"),c?.setAttribute("disabled","disabled")):(p?.removeAttribute("aria-busy"),c?.removeAttribute("aria-busy"),w())}function w(){!!((l?.value||"").trim()||P())?(p?.removeAttribute("disabled"),c?.removeAttribute("disabled")):(p?.setAttribute("disabled","disabled"),c?.setAttribute("disabled","disabled"))}let z=P();l&&z&&(l.value=z),w(),g(navigator.onLine?"online":"offline"),window.addEventListener("online",D),window.addEventListener("offline",D),l?.addEventListener("input",w),m?.addEventListener("click",()=>{let d=(l?.value||"").trim();if(!d){_(""),g("info","Sync URL cleared. Add one to enable sync."),w();return}try{let v=new URL(d);if(!/^https?:/.test(v.protocol))throw new Error("Invalid protocol")}catch{g("error","Enter a valid sync URL before saving.");return}_(d),g("online","Sync settings saved."),w()}),c?.addEventListener("click",async()=>{let d=(l?.value||P()).trim();if(!d){g("error","Add your sync URL in Settings first.");return}L(!0),g("syncing","Testing connection\u2026");try{(await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?g("online","Connection looks good."):g("error","Test failed. Check your Apps Script deployment.")}catch(v){console.error("Test sync failed",v),g("error","Test failed. Check your Apps Script deployment.")}finally{L(!1)}}),p?.addEventListener("click",async()=>{let d=(l?.value||P()).trim();if(!d){g("error","Add your sync URL in Settings first.");return}let v=f();if(!v.length){g("info","Nothing to sync right now.");return}L(!0),g("syncing",`Syncing ${v.length} reminder${v.length===1?"":"s"}\u2026`);let I=20,M=0,k=0,N=B=>({id:B.id,title:B.title,dueIso:B.dueIso||null,priority:B.priority||"Medium",category:B.category||"General",done:!!B.done,source:"memory-cue-mobile"});try{for(let B=0;B<v.length;B+=I){let G=v.slice(B,B+I);(await Promise.allSettled(G.map(J=>fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N(J))})))).forEach(J=>{J.status==="fulfilled"&&J.value?.ok?M+=1:(J.status,k+=1)}),await new Promise(J=>setTimeout(J,300))}k?M?g("error",`Partial sync: ${M} success, ${k} failed.`):g("error","Sync failed. Check your sync URL and retry."):g("online",`Sync complete. ${M} updated.`)}catch(B){console.error("Sync failed",B),g("error","Sync failed. Try again soon.")}finally{L(!1)}})})()});export default rn();
