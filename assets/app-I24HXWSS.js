import{a as Pn,b as go,c as Xe,d as bo,f as Ct,g as Qe,h as Nt,i as Eo,j as Mn,k as wo}from"./chunk-SY5PWNTR.js";import{a as Nn,b as ho}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as Dt,c as yo}from"./chunk-GUVSRPRW.js";function Fn(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:r})=>{if(!Array.isArray(r))return null;for(let o of r){if(typeof o!="string"||!o)continue;let a=t.getElementById(o);if(a)return{key:n,element:a}}return null}).filter(n=>!!(n&&n.element))}function Ee(e,t){if(!e||typeof e!="object")return"";let n=vo[t]||[t];for(let r of n)if(Object.prototype.hasOwnProperty.call(e,r)){let o=e[r];return o==null?"":typeof o=="string"?o:String(o)}return""}function Lo(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function So(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Hn(e,t){Array.isArray(t)&&t.forEach(({key:n,element:r})=>{let o=e&&typeof e=="object"?Ee(e,n):"";Lo(r,o)})}function Rn(e,t,n,r){Array.isArray(e)&&e.forEach(({element:o})=>{o instanceof HTMLInputElement?["checkbox","radio"].includes(o.type)?o.checked=!1:o.value="":(o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement)&&(o.value="")}),t&&(t.value=""),n&&(n.textContent=r)}function On(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:r})=>{let o=So(r);if(typeof o=="boolean"){t[n]=o;return}let a=typeof o=="string"?o.trim():o;t[n]=a??""}),t}function A(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Bn,vo,Pt,Mt,_n=Dt(()=>{Bn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],vo={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Pt="Create Cue",Mt="Edit Cue"});function $n(e){return new Bt(e)}var To,Ao,Bt,Un=Dt(()=>{To=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Ao={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Bt=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...Ao,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let r=n[0],o=n[n.length-1],a=document.activeElement;t.shiftKey&&a===r?(t.preventDefault(),o.focus()):!t.shiftKey&&a===o&&(t.preventDefault(),r.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(To)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let r=this.events[t];if(!r||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let o=new CustomEvent(r,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(o)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var qn,jn,Wn,Ht,Ft,xo,ve,Rt,ko,Vn,zn,Ot,Io,Kn,nt,Yn,Gn,_t,ce,Do,Jn,Le,Xn,Co,No,Po,Qn,$t,et,Fe,Ze,we,Be,Mo,Zn,ne,er,de,tr,nr,tt,Bo,Me,ue,rr,X,rt,or,Ut,ar,U,qt,jt,sr,ir,Wt,lr,cr,Se,dr,ot,Vt,ur=Dt(()=>{qn="memoryCue:plannerPlans",jn="memoryCue:plannerTemplates",Wn="memoryCue:lastPlannerTemplate",Ht="memoryCue:plannerUpdated",Ft=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],xo=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],ve=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},Rt=e=>{if(!ve()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},ko=(e,t)=>{if(!(!ve()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch{}},Vn=e=>{try{return JSON.parse(e)}catch{return null}},zn=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Ot=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,Io=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),r=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-r),t},Kn=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`},nt=e=>{if(typeof e!="string")return null;let[t,n,r]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),s=Number.parseInt(r,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(s))return null;let i=new Date(o,a-1,s);return Number.isNaN(i.getTime())?null:(i.setHours(0,0,0,0),i)},Yn=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=Ft.findIndex(r=>r.toLowerCase()===t);return n>=0?n:0},Gn=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:zn(),badge:n,text:t}},_t=(e,t={})=>{let n=typeof t=="object"&&t?t:{},r=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:Yn(e?.dayName||n.dayName||n.dayLabel),o=Ot(r),a=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():Ft[o],s=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",l=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(m=>Gn(m)).filter(Boolean),d=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:zn(),y=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,p=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",f=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"";return{id:d,dayIndex:o,dayLabel:Ft[o]||"Lesson",title:a,summary:s,details:l,notes:p,subject:f,position:Number.isFinite(y)?y:null}},ce=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let r=Number.isFinite(t.position),o=Number.isFinite(n.position);return r&&o&&t.position!==n.position?t.position-n.position:r&&!o?-1:!r&&o?1:t.title.localeCompare(n.title)}),Do=e=>{let t=new Map;return e.forEach(n=>{let r=String(n.dayIndex),o=t.get(r)??0;Number.isFinite(n.position)?t.set(r,Math.max(o,n.position+1)):(n.position=o,t.set(r,o+1))}),e},Jn=(e,t,n)=>{let r=e.filter(o=>!(o.dayIndex!==t||n&&o.id===n));return r.length?r.reduce((o,a)=>Number.isFinite(a.position)?Math.max(o,a.position):o,-1)+1:0},Le=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,r=nt(n),o=Array.isArray(e?.lessons)?Do(e.lessons.map(s=>_t(s)).filter(Boolean)):[],a=typeof e?.templateId=="string"?e.templateId.trim():"";return{weekId:n,startDate:r?r.toISOString():"",lessons:ce(o),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString(),templateId:a}},Xn=()=>{if(!ve())return{};try{let e=Rt(qn);if(typeof e!="string"||!e.length)return{};let t=Vn(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Co=e=>{if(ve())try{window.localStorage.setItem(qn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},No=()=>{if(!ve())return{};try{let e=Rt(jn);if(typeof e!="string"||!e.length)return{};let t=Vn(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},Po=e=>{if(ve())try{window.localStorage.setItem(jn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},Qn=e=>{if(!e)return null;let n=Xn()[e];return n?Le(n,e):null},$t=(e,t)=>{if(!e||!t)return t;let n=Xn();return n[e]=t,Co(n),t},et=new Map,Fe=null,Ze=null,we=!1,Be=null,Mo=()=>{if(typeof Be=="string")return Be;let e=Rt(Wn);return Be=typeof e=="string"?e:"",Be},Zn=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();Be=t,ko(Wn,t)},ne=e=>{e?.templateId&&Zn(e.templateId)},er=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},de=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(Ht,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},tr=async()=>Fe?Ze||(Ze=Fe().then(e=>{let{db:t,getCollection:n}=e||{},r=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),Ze):null,nr=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:r,db:o}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(o,"plannerPlans",t)},tt=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&et.set(e.weekId,e),e),Bo=e=>{let t=X();return Le({weekId:e,lessons:e===t?xo:[]},e)},Me=e=>{let t=Qn(e);if(t)return tt(t),t;let n=Bo(e);return $t(e,n),tt(n),n},ue=async e=>{if(!e?.weekId)return e;let t=Le(e,e.weekId);if($t(t.weekId,t),tt(t),ne(t),we||!Fe)return t;try{let n=await tr();if(!n)return t;let r=nr(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(r,t,{merge:!0}):await n.updateDoc(r,t),t}catch(n){return er(n)?(console.warn("Persisting planner data locally due to permission issue",n),we=!0,t):(console.error("Failed to persist planner plan",n),t)}},rr=(e={})=>{typeof e.ensureFirestore=="function"&&(Fe=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(we=e.forceLocal)},X=(e=new Date)=>{let t=Io(e);return Kn(t)},rt=(e,t=0)=>{let n=nt(e);if(!n||!Number.isFinite(t))return e;let r=new Date(n);return r.setDate(n.getDate()+t*7),Kn(r)},or=(e=X(),t=0)=>{let n=nt(e);if(!n)return null;let r=Number.isFinite(t)?t:0,o=Ot(r),a=new Date(n);return a.setDate(n.getDate()+o),a},Ut=(e,{short:t=!1}={})=>{let n=nt(e);if(!n)return"";let r=new Date(n);r.setDate(n.getDate()+6);let o=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),a=o.format(n),s=o.format(r),i=n.getFullYear()===r.getFullYear();if(t)return`Week of ${a}`;let l=i?n.getFullYear():`${n.getFullYear()} \u2013 ${r.getFullYear()}`;return`${a} \u2013 ${s}, ${l}`},ar=(e=X())=>{if(!e)return[];let t=et.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=Qn(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},U=async(e=X())=>{if(!e)return null;if(et.has(e)){let t=et.get(e);return ne(t),t}if(we||!Fe){let t=Me(e);return ne(t),t}try{let t=await tr();if(!t){let a=Me(e);return ne(a),a}let n=nr(t,e),r=await t.getDoc(n);if(r.exists()){let a=r.data(),s=Le({...a,weekId:e},e);return $t(e,s),tt(s),we=!1,ne(s),s}let o=Me(e);return typeof t.setDoc=="function"&&await t.setDoc(n,o,{merge:!0}),ne(o),o}catch(t){if(er(t)){console.warn("Falling back to local planner data due to permission issue",t),we=!0;let r=Me(e);return ne(r),r}console.error("Failed to load planner data",t);let n=Me(e);return ne(n),n}},qt=async(e,t)=>{if(!e)return null;let n=await U(e),r=_t(t);r.position=Jn(n?.lessons||[],r.dayIndex);let o={...n,lessons:ce([...n?.lessons||[],r]),updatedAt:new Date().toISOString()},a=await ue(o);return de(a),a},jt=async(e,t,n={})=>{if(!e||!t)return null;let r=await U(e),o=[...r?.lessons||[]],a=o.findIndex(y=>y.id===t);if(a===-1)return r;let s=o[a],i=_t({...s,...n,id:t},s);if(i.dayIndex!==s.dayIndex){let y=o.filter((p,f)=>f!==a);i.position=Jn(y,i.dayIndex)}o[a]=i;let l={...r,lessons:ce(o),updatedAt:new Date().toISOString()},d=await ue(l);return de(d),d},sr=async(e,t)=>{if(!e||!t)return null;let n=await U(e),r=(n?.lessons||[]).filter(s=>s.id!==t),o={...n,lessons:ce(r),updatedAt:new Date().toISOString()},a=await ue(o);return de(a),a},ir=async(e,t,n)=>{if(!e||!t||!n)return null;let r=n==="up"?-1:n==="down"?1:0;if(!r)return U(e);let o=await U(e),a=[...o?.lessons||[]],s=a.findIndex(L=>L.id===t);if(s===-1)return o;let i=a[s],l=a.filter(L=>L.dayIndex===i.dayIndex);if(l.length<=1)return o;let y=ce(l).map(L=>L.id),p=y.indexOf(t);if(p===-1)return o;let f=p+r;if(f<0||f>=y.length)return o;let[m]=y.splice(p,1);y.splice(f,0,m);let b=new Map(y.map((L,N)=>[L,N])),w=a.map(L=>{if(L.dayIndex!==i.dayIndex)return L;let N=b.get(L.id);return typeof N=="number"?{...L,position:N}:L}),E={...o,lessons:ce(w),updatedAt:new Date().toISOString()},x=await ue(E);return de(x),x},Wt=async(e,t,n)=>{if(!e||!t)return null;let r=await U(e),o=[...r?.lessons||[]],a=o.findIndex(p=>p.id===t);if(a===-1)return r;let s=Gn(n);if(!s)return r;let i=o[a],l={...i,details:[...i.details||[],s]};o[a]=l;let d={...r,lessons:ce(o),updatedAt:new Date().toISOString()},y=await ue(d);return de(y),y},lr=async(e,t)=>{if(!e||!t)return null;let n=await U(e),r=(n?.lessons||[]).map(s=>({title:s.title,summary:s.summary,dayIndex:s.dayIndex,notes:typeof s.notes=="string"?s.notes:"",subject:typeof s.subject=="string"?s.subject:"",details:(s.details||[]).map(i=>({badge:i.badge,text:i.text}))})),o=Le({weekId:t,lessons:r,templateId:typeof n?.templateId=="string"?n.templateId:""},t);o.updatedAt=new Date().toISOString();let a=await ue(o);return de(a),a},cr=e=>{if(!e||typeof e!="object")return null;let t=Ot(Number.isFinite(e.dayIndex)?e.dayIndex:Yn(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",r=typeof e.summary=="string"?e.summary:"",o=typeof e.notes=="string"?e.notes:"",a=typeof e.subject=="string"?e.subject.trim():"",s=Array.isArray(e.details)?e.details.map(i=>{if(!i||typeof i!="object")return null;let l=typeof i.badge=="string"?i.badge:"",d=typeof i.text=="string"?i.text:"";return d.trim()?{badge:l,text:d}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:r,details:s,notes:o,subject:a}},Se=()=>{let e=No(),t={};return Object.keys(e).forEach(n=>{let r=e[n];if(!r||typeof r!="object")return;let o=typeof r.name=="string"&&r.name.trim()?r.name.trim():n,a=Array.isArray(r.lessons)?r.lessons.map(s=>cr(s)).filter(Boolean):[];t[o]={name:o,lessons:a,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:""}}),t},dr=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let r=Se(),o=Array.isArray(t.lessons)?t.lessons.map(a=>cr(a)).filter(Boolean):[];return r[n]={name:n,lessons:o,updatedAt:new Date().toISOString()},Po(r),r[n]},ot=()=>Mo(),Vt=async(e,t)=>{if(!e||!t)return null;let r=Se()[t];if(!r)return U(e);Zn(t);let o=Array.isArray(r.lessons)?r.lessons.map(i=>({dayIndex:i.dayIndex,title:i.title,summary:i.summary,notes:typeof i.notes=="string"?i.notes:"",subject:typeof i.subject=="string"?i.subject:"",details:Array.isArray(i.details)?i.details.map(l=>({badge:l.badge,text:l.text})):[]})):[],a=Le({weekId:e,lessons:o,templateId:t},e);a.updatedAt=new Date().toISOString();let s=await ue(a);return de(s),s}});var hs=yo(()=>{ho();bo();_n();Un();go();Eo();wo();ur();Nn();function Fo(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let r=document.querySelectorAll("[data-open-reminder-modal]");if(!r.length)return;if(!e){let u=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};r.forEach(g=>{g.addEventListener("click",D=>{if(D.preventDefault(),typeof window<"u"){let C="#reminders";window.location.hash!==C&&(window.location.hash=C),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{u()})})});return}let o=e.querySelector("[data-reminder-modal-backdrop]"),a=e.querySelectorAll("[data-close-modal]"),s=document.getElementById("mainContent"),i=document.querySelector('nav[aria-label="Primary"]'),l=[s,i],d=e.querySelector('[role="dialog"]')??e,y=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],p=null,f=()=>{if(!(d instanceof HTMLElement))return[];let u=d.querySelectorAll(y.join(","));return Array.from(u).filter(g=>{let D=g instanceof HTMLElement,C=typeof SVGElement<"u"&&g instanceof SVGElement;if(!D&&!C||g.getAttribute("aria-hidden")==="true"||"disabled"in g&&g.disabled||g.hidden||g.closest("[hidden]"))return!1;let z=g.getBoundingClientRect();return z.width>0&&z.height>0})},m=()=>{let u=f(),g=u.find(D=>D.hasAttribute("data-autofocus")||D.hasAttribute("autofocus"))||(n&&u.includes(n)?n:null)||u[0];if(g&&typeof g.focus=="function"){g.focus({preventScroll:!0});return}d instanceof HTMLElement&&typeof d.focus=="function"&&d.focus({preventScroll:!0})},b=u=>{d instanceof HTMLElement&&(!(u.target instanceof Node)||!d.contains(u.target))&&(u.stopPropagation(),m())},w=u=>{if(u.key!=="Tab")return;let g=f();if(!g.length){u.preventDefault(),d instanceof HTMLElement&&d.focus({preventScroll:!0});return}let D=g[0],C=g[g.length-1],z=document.activeElement;if(u.shiftKey){(!d.contains(z)||z===D)&&(u.preventDefault(),C.focus());return}(!d.contains(z)||z===C)&&(u.preventDefault(),D.focus())},E=u=>{l.forEach(g=>{g&&(u?g.setAttribute("inert",""):g.removeAttribute("inert"))})},x=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),E(!1),document.removeEventListener("keydown",L,!0),e.removeEventListener("keydown",w,!0),e.removeEventListener("focusin",b,!0),p&&typeof p.focus=="function"&&p.focus(),p=null},L=u=>{u.key==="Escape"&&(u.preventDefault(),x())},N=({triggerElement:u}={})=>{u&&typeof u.focus=="function"?p=u:p=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),E(!0),document.addEventListener("keydown",L,!0),e.addEventListener("keydown",w,!0),e.addEventListener("focusin",b,!0),window.requestAnimationFrame(()=>{m()})},I=(u,g={})=>{try{document.dispatchEvent(new CustomEvent(u,{detail:g}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let D=document.createEvent("CustomEvent");D.initCustomEvent(u,!0,!0,g),document.dispatchEvent(D)}}},M=(u={})=>{I("cue:cancelled",u)};r.forEach(u=>{u.addEventListener("click",g=>{g.preventDefault();let C={trigger:g.currentTarget instanceof HTMLElement?g.currentTarget:null,mode:"create"};I("cue:prepare",C),I("cue:open",C)})}),a.forEach(u=>{u.addEventListener("click",g=>{g.preventDefault(),M({trigger:u,reason:"button"})})}),e.addEventListener("click",u=>{u.target===e&&M({reason:"backdrop"})}),o?.addEventListener("click",u=>{u.target===o&&M({reason:"backdrop"})}),document.addEventListener("cue:open",u=>{let g=u?.detail?.trigger,D=g instanceof HTMLElement?g:null;N({triggerElement:D})});let $=()=>{x()};document.addEventListener("cue:close",$),document.addEventListener("cue:cancelled",$);let _=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&_ instanceof HTMLElement&&t.addEventListener("submit",u=>{u.preventDefault(),!_.matches(":disabled")&&_.click()}),_ instanceof HTMLElement&&document.addEventListener("reminder:save",u=>{let g=u?.detail?.trigger;g&&g!==_||_.matches(":disabled")||_.click()})}Fo();function zt(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var fr=null,Ho=new Set(["reminders","planner","notes"]);function Ro(e){if(!e||typeof document>"u")return null;if(Ho.has(e)){let t=document.querySelector('[data-route="workspace"]');return t?t.querySelector(`[data-workspace-panel="${e}"]`)??t:null}return document.querySelector(`[data-route="${e}"]`)}function Cr(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Oo(e){typeof document>"u"||!e||(window.clearTimeout(fr),fr=window.setTimeout(()=>{let t=Ro(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function $e(e){let t=e||Cr();t&&Oo(t)}function _o(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{$e()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",r=>{if(!(r.currentTarget instanceof HTMLAnchorElement))return;let o=r.currentTarget.getAttribute("href")||"";if(!o.startsWith("#"))return;r.preventDefault();let a=o||"#dashboard",s=a.replace("#","")||"dashboard";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),$e(s)})}),typeof window.renderRoute=="function"&&window.renderRoute(),$e()}_o();var Nr="memoryCue:accountPanelCollapsed";function $o(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem(Nr);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function Uo(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem(Nr,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function qo(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let r=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",o=(t.getAttribute("data-expanded-label")||"").trim()||r,a=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",s=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",i=t.querySelector("[data-account-toggle-label]"),l=t.querySelector("[data-account-toggle-a11y]"),d=$o();typeof d!="boolean"&&(d=!0);let y=(p,{persist:f=!0}={})=>{d=!!p,e.setAttribute("data-account-collapsed",d?"true":"false"),t.setAttribute("aria-expanded",d?"false":"true");let m=d?r:o,b=d?a:s;i?i.textContent=m:t.textContent=m,t.setAttribute("aria-label",b),l&&(l.textContent=b),d?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),d||n.removeAttribute("hidden"),f&&Uo(d)};y(d,{persist:!1}),t.addEventListener("click",p=>{p.preventDefault(),y(!d)})}qo();var mr=document.getElementById("settings-save-button"),at=document.getElementById("settings-save-confirmation"),ae=document.getElementById("live-status"),Kt=null,fe=document.getElementById("resourcePlannerStatus"),Yt=null;document.addEventListener("planner:reminderCreated",e=>{if(!ae)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",r=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",o=r?`Reminder saved for ${r}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";ae.textContent=o});mr&&at&&mr.addEventListener("click",e=>{e.preventDefault(),at.classList.remove("hidden"),at.textContent="Settings saved!",ae&&(ae.textContent="Settings saved!"),Kt&&window.clearTimeout(Kt),Kt=window.setTimeout(()=>{at.classList.add("hidden")},3e3)});function jo(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),$e(t),ae&&(ae.textContent="Opening planner to add a new lesson."),kt(),window.requestAnimationFrame(()=>{let r=Qr();r&&typeof r.catch=="function"&&r.catch(o=>{console.error("Planner quick action failed to start new lesson flow",o)})})}function Wo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",jo)})}Wo();function Gt(e,{tone:t="success"}={}){fe&&(fe.textContent=e,fe.classList.remove("hidden"),fe.classList.remove("text-success","text-error"),fe.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(Yt&&window.clearTimeout(Yt),Yt=window.setTimeout(()=>{fe.classList.add("hidden"),fe.textContent=""},4e3))),ae&&(ae.textContent=e)}function Vo(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function zo(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let r=n.getAttribute("data-resource-title")?.trim(),o=n.getAttribute("data-resource-link")?.trim();if(!r||!o)return;let a="#planner";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),$e("planner"),kt(),await Xr();let s=`${r} \u2014 ${o}`,i=_a(),l=null;try{if(i)l=await Wt(v,i,{badge:"Resource",text:s});else{let d=Vo("lesson"),y=T?.lessons?.[0]?.dayLabel||"Monday";l=await qt(v,{id:d,dayName:y,title:r,summary:`Resource link: ${o}`,details:[{badge:"Resource",text:s}]}),l&&(F=d)}if(l){T=l,W(l),j(l,v),K(l);let d=i?`Added "${r}" to your selected lesson.`:`Created a lesson for "${r}" in this week's planner.`;Gt(d);return}Gt("Unable to save that resource to the planner right now.",{tone:"error"})}catch(d){console.error("Failed to save resource to planner",d),Gt("Unable to save that resource to the planner right now.",{tone:"error"})}}function Ko(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",zo)})}Ko();var Pr=document.getElementById("reminder-title"),Yo=document.getElementById("reminderText"),G=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),r=e.querySelector(".modal-backdrop button"),o=document.getElementById("modal-title");return $n({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:r instanceof HTMLElement?r:null,titleInput:Pr,modalTitle:o instanceof HTMLElement?o:null,defaultTitle:Pt,editTitle:Mt})})();G?.setEditMode(!1);var Go=()=>{let e=!!Pr;if(!!Yo)return Xe({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id"};return e?Xe(n):Xe({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Go().catch(e=>{console.error("Failed to initialise reminders",e)});var nn=Mn(),Jt=Pn({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{nn?.handleSessionChange(e)}});if(Jt?.supabase){nn?.setSupabaseClient(Jt.supabase);try{Jt.supabase.auth.getSession().then(({data:e})=>{nn?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var ee=document.getElementById("cues-list"),Xt=document.getElementById("pinnedNotesCard"),Ae=document.getElementById("pinnedNotesList"),be=document.getElementById("cue-form"),Y=be?.querySelector("#cue-id-input"),Jo=G?.defaultTitle||G?.modalTitle?.textContent?.trim()||Pt,Is=G?.editTitle||Mt,yt=document.getElementById("tab-cues"),ht=document.getElementById("tab-daily"),qe=document.getElementById("cues-view"),je=document.getElementById("daily-list-view"),pr=document.getElementById("daily-list-header"),Mr=document.getElementById("quick-add-form"),O=document.getElementById("quick-add-input"),q=document.getElementById("daily-voice-btn"),ye=document.getElementById("daily-tasks-container"),rn=document.getElementById("clear-completed-btn"),gt=document.getElementById("daily-list-permission-notice"),R=document.getElementById("plannerCards")||document.getElementById("planner-grid"),yr=document.getElementById("planner-week"),Xo=document.getElementById("planner-prev"),Qo=document.getElementById("planner-next"),Zo=document.getElementById("planner-today"),ea=document.getElementById("planner-duplicate-btn"),ta=document.getElementById("planner-new-lesson-btn"),re=document.getElementById("planner-template-select"),Br=document.getElementById("planner-template-save-btn"),bt=document.querySelector("[data-planner-text-size]"),Oe=document.getElementById("planner-subject-filter"),Qt=document.querySelector(".desktop-panel--planner"),st=document.querySelector("[data-mobile-notes-text-size]"),Zt=document.querySelector(".mobile-panel--notes"),Fr="plannerTextSizePreference",Et="default",Tt=new Set(["small","default","large"]),na=["planner-text-small","planner-text-default","planner-text-large"],Hr="mobileNotesTextSizePreference",wt="default",At=new Set(["small","default","large"]),ra=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function on(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function oa(){if(typeof localStorage>"u")return Et;let e=localStorage.getItem(Fr);return e&&Tt.has(e)?e:Et}function aa(e){typeof localStorage>"u"||!Tt.has(e)||localStorage.setItem(Fr,e)}function Rr(e){if(!Qt)return;let t=Tt.has(e)?e:Et;na.forEach(n=>Qt.classList.remove(n)),Qt.classList.add(`planner-text-${t}`)}var Or=oa();Rr(Or);on(bt)&&(bt.value=Or);function _r(){if(typeof localStorage>"u")return wt;let e=localStorage.getItem(Hr);return e&&At.has(e)?e:wt}function sa(e){typeof localStorage>"u"||!At.has(e)||localStorage.setItem(Hr,e)}function $r(e){if(!Zt)return;let t=At.has(e)?e:wt;ra.forEach(n=>Zt.classList.remove(n)),Zt.classList.add(`mobile-panel--notes-size-${t}`)}var Ur=_r();$r(Ur);st instanceof HTMLSelectElement&&(st.value=Ur,st.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:wt;if(!At.has(t)){st.value=_r();return}sa(t),$r(t)}));var ia=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function la(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=ia.findIndex(r=>r.toLowerCase()===t.toLowerCase());return n>=0?n:0}function ca(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function da(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),r=document.getElementById("planner-modal-description"),o=document.getElementById("planner-modal-error"),a=document.getElementById("planner-modal-submit"),s=document.getElementById("planner-lesson-day"),i=document.getElementById("planner-lesson-title"),l=document.getElementById("planner-lesson-summary"),d=document.getElementById("planner-lesson-subject"),y=document.getElementById("planner-detail-badge"),p=document.getElementById("planner-detail-text"),f=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(a instanceof HTMLElement)||!(s instanceof HTMLSelectElement)||!(i instanceof HTMLInputElement)||!(l instanceof HTMLTextAreaElement))return null;let m=t.querySelector("[data-planner-lesson-section]"),b=t.querySelector("[data-planner-summary-section]"),w=t.querySelector("[data-planner-detail-section]"),E=t.querySelector("[data-planner-duplicate-section]"),x=e.querySelector("[data-planner-modal-dialog]"),L=e.querySelector("[data-planner-modal-backdrop]"),N=e.querySelectorAll("[data-planner-modal-close]"),I=document.getElementById("mainContent"),M=document.querySelector('nav[aria-label="Primary"]'),$=(()=>{let c=[],h=e.parentElement;return M instanceof HTMLElement&&c.push(M),h instanceof HTMLElement?c.push(...Array.from(h.children).filter(S=>S instanceof HTMLElement&&S!==e)):I instanceof HTMLElement&&(I.contains(e)?c.push(...Array.from(I.children).filter(S=>S instanceof HTMLElement&&!S.contains(e))):c.push(I)),c})(),_=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],u={mode:"add",lessonId:null,trigger:null},g=null,D=null,C=c=>{g=c instanceof HTMLElement?c:null},z=c=>{$.forEach(h=>{h&&(c?h.setAttribute("inert",""):h.removeAttribute("inert"))})},Tn=()=>{if(!(x instanceof HTMLElement))return[];let c=x.querySelectorAll(_.join(","));return Array.from(c).filter(h=>{if(h.closest('[aria-hidden="true"]')||"disabled"in h&&h.disabled)return!1;let S=h.getBoundingClientRect();return S.width>0&&S.height>0})},An=()=>{let c=Tn(),h=(g&&c.includes(g)?g:null)||c[0]||x;h&&typeof h.focus=="function"&&h.focus({preventScroll:!0})},xn=c=>{x instanceof HTMLElement&&(x.contains(c.target)||An())},lo=c=>{if(c.key!=="Tab")return;let h=Tn();if(!h.length){c.preventDefault();return}let S=h[0],Ce=h[h.length-1];if(c.shiftKey&&document.activeElement===S){c.preventDefault(),Ce.focus();return}!c.shiftKey&&document.activeElement===Ce&&(c.preventDefault(),S.focus())},kn=c=>{if(c.key==="Escape"){c.preventDefault(),J();return}lo(c)},In=()=>{o&&(o.textContent="",o.classList.add("hidden"),o.setAttribute("aria-hidden","true"))},te=c=>{o&&(o.textContent=c,o.classList.remove("hidden"),o.removeAttribute("aria-hidden"))},Dn=c=>{a.disabled=!!c,a.classList.toggle("loading",!!c)},P=(c,h)=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!h),h?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"))},Ye=c=>{[s,i,l,d].forEach(h=>{h instanceof HTMLElement&&(h.disabled=!!c,h.classList.toggle("opacity-60",!!c),h.classList.toggle("cursor-not-allowed",!!c))})},De=()=>{t.reset(),In(),C(null),Ye(!1),d instanceof HTMLInputElement&&(d.value=""),y instanceof HTMLInputElement&&(y.value=""),(p instanceof HTMLTextAreaElement||p instanceof HTMLInputElement)&&(p.value=""),f instanceof HTMLInputElement&&(f.value="")},Ge=({title:c,description:h,action:S})=>{n&&(n.textContent=c||"Plan lesson"),r&&(r.textContent=h||""),a.textContent=S||"Save lesson"},Je=({trigger:c}={})=>{u.trigger=c instanceof HTMLElement?c:null,D=u.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),z(!0),document.addEventListener("keydown",kn,!0),e.addEventListener("focusin",xn,!0),window.requestAnimationFrame(()=>{An()})},J=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),z(!1),document.removeEventListener("keydown",kn,!0),e.removeEventListener("focusin",xn,!0);let c=u.trigger||D;u.mode="add",u.lessonId=null,u.trigger=null,C(null),De(),c&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},co=({defaultDay:c="Monday",trigger:h}={})=>{u.mode="add",u.lessonId=null,De(),P(m,!0),P(b,!0),P(w,!1),P(E,!1),Ye(!1);let S=typeof c=="string"&&c.trim()?c.trim():"Monday";s.value=S,s.value!==S&&(s.value="Monday"),i.value=S?`${S} lesson`:"",l.value="",d instanceof HTMLInputElement&&(d.value=""),Ge({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),C(i),Je({trigger:h})},uo=({lesson:c,trigger:h}={})=>{if(!c)return;u.mode="edit",u.lessonId=c.id,De(),P(m,!0),P(b,!0),P(w,!1),P(E,!1),Ye(!1);let S=c.dayLabel||c.dayName||"Monday";s.value=S,s.value!==S&&(s.value="Monday"),i.value=c.title||"",l.value=c.summary||"",d instanceof HTMLInputElement&&(d.value=c.subject||""),Ge({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),C(i),Je({trigger:h})},fo=({lesson:c,trigger:h}={})=>{if(!c)return;u.mode="detail",u.lessonId=c.id,De(),P(m,!0),P(b,!0),P(w,!0),P(E,!1),Ye(!0);let S=c.dayLabel||c.dayName||"Monday";s.value=S,s.value!==S&&(s.value="Monday"),i.value=c.title||"",l.value=c.summary||"",d instanceof HTMLInputElement&&(d.value=c.subject||""),y instanceof HTMLInputElement&&(y.value=""),(p instanceof HTMLTextAreaElement||p instanceof HTMLInputElement)&&(p.value=""),Ge({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),C(p instanceof HTMLElement?p:null),Je({trigger:h})},mo=({suggestedWeekId:c="",trigger:h}={})=>{u.mode="duplicate",u.lessonId=null,De(),P(m,!1),P(b,!1),P(w,!1),P(E,!0),f instanceof HTMLInputElement&&(f.value=c),Ge({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),C(f instanceof HTMLElement?f:null),Je({trigger:h})},po=async c=>{c.preventDefault(),In(),Dn(!0);try{if(u.mode==="duplicate"){let B=f?.value?.trim();if(!B){te("Enter the Monday date for the destination week.");return}if(B===v){te("Choose a different week to duplicate into.");return}let le=await lr(v,B);le&&(v=B,T=le,W(le),yn(B),j(le,B),K(le),J());return}if(u.mode==="detail"){if(!u.lessonId){te("Select a lesson before adding details.");return}let B=p?.value?.trim();if(!B){te("Add text for this detail.");return}let le=y?.value?.trim()||"",Pe=await Wt(v,u.lessonId,{badge:le,text:B});Pe&&(T=Pe,W(Pe),j(Pe,v),K(Pe),J());return}let h=s.value.trim(),S=i.value.trim(),Ce=l.value.trim(),Cn=d?.value?.trim()||"";if(!h){te("Choose a day for this lesson.");return}if(!S){te("Enter a lesson title.");return}if(u.mode==="edit"){if(!u.lessonId){te("Select a lesson to edit.");return}let B=await jt(v,u.lessonId,{dayName:h,title:S,summary:Ce,subject:Cn});B&&(T=B,W(B),j(B,v),K(B),J());return}let Ne=await qt(v,{dayName:h,title:S,summary:Ce,subject:Cn});Ne&&(T=Ne,W(Ne),j(Ne,v),K(Ne),J())}catch(h){console.error("Failed to save planner change",h),te("Unable to save changes right now. Please try again.")}finally{Dn(!1)}};return t.addEventListener("submit",po),N.forEach(c=>{c.addEventListener("click",h=>{h.preventDefault(),J()})}),e.addEventListener("click",c=>{c.target===e&&J()}),L?.addEventListener("click",c=>{c.target===L&&J()}),{openAddLesson:co,openEditLesson:uo,openAddDetail:fo,openDuplicatePlan:mo,close:J}}var hr=document.getElementById("remindersCount"),se=typeof document<"u"?da():null,gr=document.getElementById("plannerCount"),br=document.getElementById("plannerSubtitle"),pe="all",oe=pe,Ds=document.getElementById("resourcesCount"),Cs=document.getElementById("templatesCount"),it=document.getElementById("dailySnapshotList"),lt=document.getElementById("todaysFocusList"),Q=document.getElementById("weekAtAGlanceList"),Z=null;Q&&(Z=document.createElement("li"),Z.dataset.emptyState="week",Z.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",Z.textContent="No upcoming events this week.");var Er=()=>{if(!Q||!Z)return;Q.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?Q.contains(Z)||Q.appendChild(Z):Q.contains(Z)&&Q.removeChild(Z)};Q&&(Er(),new MutationObserver(Er).observe(Q,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var en=e=>{Xt&&(e?Xt.classList.remove("hidden"):Xt.classList.add("hidden"))},We={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},wr=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),vr=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),ft=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",pn=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},ua=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),qr=e=>{if(!e)return"";if(wr)try{return wr.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},fa=e=>{if(!e)return"";if(vr)try{return vr.format(e)}catch{}return e.toLocaleDateString()},jr=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(We,t)?t:"medium"},Lr=e=>{let t=jr(e);return We[t]?.rank??We.medium.rank},ma=e=>{let t=jr(e);return We[t]??We.medium},Sr=e=>{let t=pn(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Wr(e=[]){if(!it)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(r=>({reminder:r,date:pn(r)})).filter(({date:r})=>r&&ua(r,t)).sort((r,o)=>r.date.getTime()-o.date.getTime());if(!n.length){it.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}it.innerHTML="",n.forEach(({reminder:r,date:o})=>{let a=document.createElement("li");a.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=ft(r),a.appendChild(s);let i=qr(o),l=document.createElement("p");l.className="text-xs text-base-content/70",l.textContent=i?`Due ${i}`:"Due today",a.appendChild(l),it.appendChild(a)})}function Vr(e=[]){if(!lt)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,r)=>{let o=Lr(n)-Lr(r);if(o!==0)return o;let a=Sr(n)-Sr(r);return a!==0?a:ft(n).localeCompare(ft(r),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){lt.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}lt.innerHTML="",t.forEach(n=>{let r=document.createElement("li");r.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let o=document.createElement("div");o.className="flex items-center justify-between gap-3";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=ft(n),o.appendChild(a);let s=ma(n),i=document.createElement("span");i.className=s.badgeClass,i.textContent=s.badgeLabel,o.appendChild(i),r.appendChild(o);let l=pn(n),d=document.createElement("p");if(d.className="text-xs text-base-content/70",l){let y=qr(l),p=fa(l),f=[];y&&f.push(`Due ${y}`),p&&f.push(p),d.textContent=f.length?f.join(" \u2022 "):"Due soon"}else d.textContent="No due date";r.appendChild(d),lt.appendChild(r)})}var pa=e=>{if(!hr)return;let t=Array.isArray(e)?e.length:0;hr.textContent=String(t)},ya=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];pa(t),Wr(t),Vr(t)};document.addEventListener("memoryCue:remindersUpdated",ya);Wr();Vr();var an=Fn(Bn),ha={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},ct=null,ga=3,Tr=120;function ba(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Tr?t:`${t.slice(0,Tr-1)}\u2026`:""}function Ea(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let r=n.trim().toLowerCase();return r==="true"||r==="1"||r==="yes"}return!1})}function Ar(e){if(!Ae)return;let t=Array.isArray(e)?e:[];if(!t.length){Ae.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',en(!1);return}let n=t.filter(a=>Ea(a));if(!n.length){Ae.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',en(!1);return}en(!0);let o=n.slice(0,ga).map(a=>{let s=A(Ee(a,"title")||"Untitled Cue"),i=Ee(a,"details"),l=A(ba(i)),d=l?`<p class="mt-1 text-sm text-base-content/70">${l}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${s}</p>
          ${d}
        </li>
      `}).join("");Ae.innerHTML=o}function sn(e,{tone:t="muted"}={}){if(!ee)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),ee.innerHTML=`<p class="${n.join(" ")}">${A(e)}</p>`}function wa(e){if(!ee)return;if(!Array.isArray(e)||e.length===0){sn("No cues yet.");return}let t=e.map(n=>{let r=A(Ee(n,"title")||"Untitled Cue"),o=A(Ee(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${r}</h2>
            ${o?`<p>${o}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${A(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${A(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");ee.innerHTML=t}async function Ke(){return ct||(ct=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:r,enableIndexedDbPersistence:o,collection:a,doc:s,getDoc:i,addDoc:l,updateDoc:d,getDocs:y,query:p,orderBy:f,serverTimestamp:m,setDoc:b,arrayUnion:w}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),E=t(),x=E&&E.length?E[0]:e(ha),L=n(x);(function(){let M=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;M&&(M.__persistenceInitialized__||(M.__persistenceInitialized__=!0,(async()=>{try{await r(L),console.info("[Firestore] Persistence: multi-tab enabled")}catch($){if($&&$.code==="failed-precondition")try{await o(L),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(_){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",_?.code||_)}else $&&$.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",$?.code||$)}})()))})();let N=a(L,"cues");return{db:L,cuesCollection:N,getCollection:a,doc:s,getDoc:i,addDoc:l,updateDoc:d,getDocs:y,query:p,orderBy:f,serverTimestamp:m,setDoc:b,arrayUnion:w}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),ct)}async function va(){let e=await Ke(),{getDocs:t,cuesCollection:n,query:r,orderBy:o}=e,a=r&&o?r(n,o("createdAt","desc")):n;return(await t(a)).docs.map(i=>({id:i.id,...i.data()}))}async function La(e){if(!e)return null;let t=await Ke(),{db:n,doc:r,getDoc:o}=t,a=r(n,"cues",e),s=await o(a);return s.exists()?{id:s.id,...s.data()}:null}async function zr(){if(!(!ee&&!Ae))try{let e=await va();wa(e),Ar(e)}catch(e){console.error("Failed to load cues",e),It(e)?sn("Sign in to view your cues.",{tone:"muted"}):sn("Unable to load cues right now.",{tone:"error"}),Ar([])}}function Sa(e){!be||!Y||(Hn(e,an),Y.value=e?.id||"",G?.setEditMode(!0),G?.show({mode:"edit"}))}async function Ta(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let r=await La(n);if(!r)return;Sa(r)}catch(r){console.error("Failed to prepare cue for editing",r)}}async function Aa(e){if(e.preventDefault(),!be||!Y)return;let t=Y.value.trim(),n=On(an);try{let r=await Ke(),{db:o,doc:a,addDoc:s,updateDoc:i,cuesCollection:l,serverTimestamp:d}=r,y=typeof d=="function"?d():null;if(t){let p=a(o,"cues",t),f={...n};y&&(f.updatedAt=y),await i(p,f)}else{let p={...n};y&&(p.createdAt=y,p.updatedAt=y),await s(l,p)}await zr(),Rn(an,Y,G?.modalTitle??null,Jo),await G?.hide({reason:"form-submit"})}catch(r){console.error("Failed to save cue",r)}}async function xa(){!be||!Y||!ee||(ee.addEventListener("click",Ta),be.addEventListener("submit",Aa))}be&&Y&&(document.addEventListener("cue:prepare",()=>{Y.value="",G?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{Y.value="",G?.setEditMode(!1)}));be&&Y&&ee&&xa().catch(e=>{console.error("Failed to initialise cue editing",e)});(ee||Ae)&&zr();var k=[],dt=null,he=!1,Ve=X(),Ue=!1,v=Ve,T=null,_e=null,F=null,xe=Se(),vt=new Map,ka=800,Ia=1500,ln={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},Kr=new Set(["saving","saved","error"]),Yr="plannerNotesOpenState",me=Da();function Da(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Yr);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function Ca(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Yr,JSON.stringify(me))}catch(e){console.warn("Unable to persist planner notes state",e)}}function Na(e){return e?!!me?.[e]:!1}function Pa(e,t){if(e){if(t)me={...me,[e]:!0};else if(me?.[e]){let n={...me};delete n[e],me=n}Ca()}}var Ma=e=>{if(!gr)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=ar(Ve),gr.textContent=String(t.length)};function j(e,t){if(Ma(e),br){let n=Ut(e?.weekId||t,{short:!0});br.textContent=n||""}}function Lt(e,{tone:t="muted"}={}){if(!R)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),R.innerHTML=`<p class="${n.join(" ")}">${A(e)}</p>`}function yn(e){if(!yr)return;let t=Ut(e);yr.textContent=t||""}function xt(e){if(!re)return;xe=Se();let t=Object.values(xe).sort((a,s)=>a.name.localeCompare(s.name)),n=t.length>0,o=[`<option value="">${A(n?"Select template":"No templates saved")}</option>`];t.forEach(a=>{let s=a.name;o.push(`<option value="${A(s)}">${A(s)}</option>`)}),re.innerHTML=o.join(""),re.disabled=!n,e&&xe[e]?re.value=e:re.value=""}function K(e){let t=e?.templateId||ot();xt(t)}function hn(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function Ba(e){let t=hn(e);return t?t.toLowerCase():""}function Fa(e){if(!Oe)return;let t=new Map;e.forEach(r=>{let o=hn(r);if(!o)return;let a=o.toLowerCase();t.has(a)||t.set(a,o)}),(t.size===0||oe!==pe&&!t.has(oe))&&(oe=pe);let n=[`<option value="${pe}">All subjects</option>`];t.forEach((r,o)=>{n.push(`<option value="${A(o)}">${A(r)}</option>`)}),Oe.innerHTML=n.join(""),Oe.value=oe,Oe.disabled=t.size===0}function Ha(e){return Array.isArray(e)?oe===pe?e:e.filter(t=>Ba(t)===oe):[]}function Ra(e){oe=typeof e?.target?.value=="string"?e.target.value:pe,W(T)}async function Oa(e,t){let r=(Array.isArray(e?.lessons)?e.lessons:[]).length>0,o=typeof e?.templateId=="string"&&e.templateId.trim().length>0;if(r||o)return e;let a=ot();if(!a||(xe[a]||(xe=Se()),!xe[a]))return e;try{return await Vt(t,a)||e}catch(s){return console.error("Failed to auto apply preferred planner template",s),e}}function W(e){if(!R)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(Fa(t),!t.length){Lt("No lessons saved for this week yet."),F=null;return}let n=Ha(t);if(!n.length){Lt("No lessons saved for this subject yet."),F=null;return}let r=n.map(a=>typeof a.id=="string"&&a.id?a.id:"").filter(a=>!!a);F&&!r.includes(F)&&(F=null);let o=n.map(a=>{let s=Array.isArray(a.details)?a.details.map(N=>`
                <li class="flex items-center gap-2">
                  ${N.badge?`<span class="badge badge-outline badge-sm text-secondary">${A(N.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${A(N.text)}</span>
                </li>
              `).join(""):"",i=s?`<ul class="space-y-2 text-sm text-base-content/70">${s}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',l=typeof a.id=="string"?a.id:"",d=!!(F&&l&&F===l),y=["data-planner-lesson",l?`data-lesson-id="${l}"`:"",d?'data-planner-selected="true"':""].filter(Boolean).join(" "),p=a.summary?`<p class="text-sm text-base-content/70">${A(a.summary)}</p>`:"",f=hn(a),m=f?`<span class="badge badge-outline badge-sm text-base-content/70">${A(f)}</span>`:"",b=m?`<div class="mt-2 flex flex-wrap gap-1">${m}</div>`:"",w=typeof a.notes=="string"?a.notes:"",E=Na(l),x=l?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${l}"
              ${E?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${l}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${A(w)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${A(ln.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",L=l?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${l}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${l}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${y}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${A(a.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${A(a.title||a.dayLabel||"Lesson")}</h2>
                ${p}
                ${b}
              </div>
              <div class="flex flex-wrap items-center justify-end gap-1">
                ${L}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${l}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${l}"
                >
                  Delete
                </button>
            </div>
          </div>
          ${i}
          ${x}
          <div class="flex flex-wrap gap-2">
            <button
              type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${l}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${l}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");R.innerHTML=o,cn(F||null)}function cn(e){if(F=e||null,!R)return;R.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function _a(){return F&&(Array.isArray(T?.lessons)?T.lessons:[]).some(t=>t.id===F)?F:null}function $a(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===F||cn(n)}function Ua(e){let t=on(e?.currentTarget)?e.currentTarget:bt;if(!on(t))return;let n=t.value,r=Tt.has(n)?n:Et;Rr(r),aa(r),t.value!==r&&(t.value=r)}function Gr(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function qa(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function Jr(e){if(!e)return;let t=vt.get(e);if(!t)return;let n=qa();n&&n(t),vt.delete(e)}function He(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&Kr.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Re(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&Kr.has(t)?t:null,r=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(r instanceof HTMLElement){let o=n||"idle",a=ln[o]||ln.idle;r.textContent=a,r.setAttribute("data-status",o)}}async function dn(e,t,n){if(!e||!v)return;let r=n instanceof HTMLTextAreaElement?n:null;r&&(He(r,"saving"),Re(r,"saving"));try{let o=await jt(v,e,{notes:t});if(o&&(T=o),r){He(r,"saved"),Re(r,"saved");let a=Gr();a?a(()=>{r.getAttribute("data-notes-status")==="saved"&&(He(r,null),Re(r,null))},Ia):(He(r,null),Re(r,null))}}catch(o){console.error("Failed to save planner notes",o),r&&(He(r,"error"),Re(r,"error"))}}function ja(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;Jr(n);let r=Gr();if(!r){dn(n,t.value,t);return}let o=r(()=>{vt.delete(n),dn(n,t.value,t)},ka);vt.set(n,o)}function Wa(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(Jr(n),dn(n,t.value,t))}function Va(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let r=t.hasAttribute("open");Pa(n,r)}function Te(e){if(!R)return _e=null,Promise.resolve();let t=e||X();v=t,yn(t),Lt("Loading plan\u2026");let n=(async()=>{try{let r=await U(t);r=await Oa(r,t),T=r,W(r),j(r,t),K(r)}catch(r){console.error("Failed to load planner week",r),Lt("Unable to load this week's planner.",{tone:"error"})}})();return _e=n,n.finally(()=>{_e===n&&(_e=null)})}async function Xr(){if(!R)return;Ue||kt();let e=_e;if(!e&&(!T||T.weekId!==v)&&(e=Te(v)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function za(e,t){if(!e)return;await Xr();let n=Array.isArray(T?.lessons)?T.lessons:[];if(!n.length)return;let r=n.find(m=>m?.id===e);if(!r)return;let o=typeof r.dayLabel=="string"&&r.dayLabel.trim()?r.dayLabel.trim():typeof r.dayName=="string"&&r.dayName.trim()?r.dayName.trim():"",a=typeof r.title=="string"&&r.title.trim()?r.title.trim():o||"Lesson",s=typeof r.summary=="string"&&r.summary.trim()?r.summary.trim():"",i=s||a,l=o?`${o} \xB7 ${i}`:i,d=s||"",y=la(r),p=ca(or(v,y)),f={reminderTitle:l,reminderNotes:d,dueDate:p,dayLabel:o,lessonTitle:a,summary:s,plannerLessonId:e};zt("cue:prepare",{trigger:t,source:"planner"}),zt("planner:prefillReminder",f),zt("cue:open",{trigger:t,source:"planner"})}async function Ka(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),r=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":Xa(r,t);break;case"edit":Qa(r,t);break;case"delete":Za(r);break;case"move-up":xr(r,"up",t);break;case"move-down":xr(r,"down",t);break;case"create-reminder":await za(r,t);break;default:break}}async function Qr(e){if(typeof document>"u"||!se)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=T?.lessons?.[0]?.dayLabel||"Monday";se.openAddLesson({defaultDay:n,trigger:t})}async function Ya(e){if(!se)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=rt(v,1);se.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function Ga(e){if(!re)return;let t=e?.currentTarget instanceof HTMLSelectElement?e.currentTarget:re,n=t.value?.trim();if(n){t.disabled=!0;try{let r=await Vt(v,n);r&&(T=r,W(r),j(r,v),K(r))}catch(r){console.error("Failed to apply planner template",r),window.alert("Unable to apply that template right now.")}finally{xt(n)}}}async function Ja(e){if(e?.preventDefault?.(),!Br)return;let t=T||await U(v),n=Array.isArray(t?.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let r=typeof window<"u"?window.prompt("Name this template:",t?.templateId||""):null,o=typeof r=="string"?r.trim():"";if(o)try{dr(o,{lessons:n}),xt(o)}catch(a){console.error("Failed to save planner template",a),window.alert("Unable to save that template right now.")}}async function Xa(e,t){if(!e||!se)return;let n=T?.lessons?.find(o=>o.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;se.openAddDetail({lesson:n,trigger:r})}async function Qa(e,t){if(!e||!se)return;let n=T?.lessons?.find(o=>o.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;se.openEditLesson({lesson:n,trigger:r})}async function xr(e,t,n){if(!e||!t)return;let r=v||X();if(!r)return;let o=n instanceof HTMLElement?n:null;o&&o.setAttribute("disabled","true");try{let a=await ir(r,e,t);a&&(T=a,W(a),j(a,r),K(a))}catch(a){console.error("Failed to move planner lesson",a),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function Za(e){if(!e||typeof window>"u")return;let t=T?.lessons?.find(r=>r.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let r=await sr(v,e);r&&(T=r,W(r),j(r,v),K(r))}catch(r){console.error("Failed to delete planner lesson",r),window.alert("Unable to delete that lesson right now.")}}function kt(){if(Ue||!R){Ue&&Te(v);return}Ue=!0,rr({ensureFirestore:Ke}),R.addEventListener("click",$a),R.addEventListener("click",Ka),R.addEventListener("input",ja),R.addEventListener("focusout",Wa),R.addEventListener("toggle",Va),ta?.addEventListener("click",Qr),ea?.addEventListener("click",Ya),re?.addEventListener("change",Ga),Oe?.addEventListener("change",Ra),bt?.addEventListener("change",Ua),Br?.addEventListener("click",Ja),Xo?.addEventListener("click",()=>{let e=rt(v,-1);Te(e)}),Qo?.addEventListener("click",()=>{let e=rt(v,1);Te(e)}),Zo?.addEventListener("click",()=>{Te(X())}),xt(ot()),Te(v)}function kr(){typeof window>"u"||Cr()==="planner"&&kt()}function es(e){let t=e?.detail?.plan;t&&(Ue&&t.weekId===v&&(T=t,W(t),yn(t.weekId),K(t)),t.weekId===Ve&&j(t,Ve))}j(null,Ve);typeof document<"u"&&document.addEventListener(Ht,es);typeof window<"u"&&(window.addEventListener("hashchange",kr),window.addEventListener("DOMContentLoaded",kr));var Zr="dailyTasksByDate",ut=null;function gn(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function ts(e){if(typeof e!="string")return"";let[t,n,r]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),s=Number.parseInt(r,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(s))return e;let i=new Date(o,a-1,s);return Number.isNaN(i.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(i)}function ze(e){if(!rn)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);rn.disabled=!t}function ge(e){if(!ye)return;if(!Array.isArray(e)||e.length===0){ye.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',ze([]);return}let t=e.map((n,r)=>{let o=A(n?.text||""),a=!!n?.completed,s=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return a&&s.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${r}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${r}" data-task-text="${o}" ${a?"checked":""} />
          <span class="${s.join(" ")}">${o}</span>
        </div>
      `}).join("");ye.innerHTML=t,ze(e)}function St(){gt&&gt.classList.remove("hidden")}function ns(){gt&&gt.classList.add("hidden")}function bn(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Ie(e){return Array.isArray(e)?e.map(t=>bn(t)):[]}function En(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Zr);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function eo(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Zr,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Ir(e){let t=En(),n=t&&typeof t=="object"?t[e]:[];return Ie(n)}function mt(e,t){let n=En(),r=Ie(t);return n[e]=r,eo(n),r}function tn(e,t){let n=En(),r=Ie(n[e]);return r.push(bn(t)),n[e]=r,eo(n),r}function It(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function wn(){return ut||(ut=Ke().then(e=>{let{db:t,getCollection:n}=e,r=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),ut)}function vn(e,t){let{doc:n,dailyListsCollection:r,db:o}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(o,"dailyLists",t)}async function Ln(){if(!pr||!ye)return;let e=gn(),t=ts(e);if(pr.textContent=t?`Today's List - ${t}`:"Today's List",he){St();let n=Ir(e);return k=n,ge(n),Promise.resolve(n)}return dt||(ye.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',ze([]),dt=(async()=>{try{let n=await wn(),r=vn(n,e),o=await n.getDoc(r),a=o.exists()?o.data()?.tasks:[];return k=Ie(a),ge(k),mt(e,k),he=!1,ns(),k}catch(n){if(It(n)){console.warn("Falling back to local daily tasks due to permission issue",n),he=!0,St();let r=Ir(e);return k=r,ge(r),r}return console.error("Failed to load daily list",n),ye.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',k=[],ze(k),k}})().finally(()=>{dt=null})),dt}async function rs(e){let t=gn(),n=bn(e);if(he){tn(t,n);return}try{let r=await wn(),o=vn(r,t),a=await r.getDoc(o);if(a.exists()&&typeof r.arrayUnion=="function")await r.updateDoc(o,{tasks:r.arrayUnion(n)});else{let s=a.exists()?a.data()?.tasks:[],i=Array.isArray(s)?Ie(s):[];i.push(n),typeof r.setDoc=="function"?await r.setDoc(o,{tasks:i},{merge:!0}):await r.updateDoc(o,{tasks:i})}tn(t,n)}catch(r){if(It(r)){console.warn("Saving task locally because cloud sync is unavailable",r),he=!0,St(),tn(t,n);return}throw r}}async function to(e){let t=gn(),n=Ie(e);if(he){mt(t,n);return}try{let r=await wn(),o=vn(r,t);typeof r.setDoc=="function"?await r.setDoc(o,{tasks:n},{merge:!0}):await r.updateDoc(o,{tasks:n}),mt(t,n)}catch(r){if(It(r)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",r),he=!0,St(),mt(t,n);return}throw r}}function no(e){[yt,ht].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function os(){!qe||!je||(qe.classList.remove("hidden"),je.classList.add("hidden"),no(yt))}function as(){!qe||!je||(qe.classList.add("hidden"),je.classList.remove("hidden"),no(ht),Ln())}function ss(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),r=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!r.length)return;let o=i=>{n.forEach(l=>{if(!l)return;let d=l.getAttribute("data-dashboard-tab")===i;l.classList.toggle("tab-active",d),l.setAttribute("aria-selected",d?"true":"false")}),r.forEach(l=>{if(!l)return;let d=l.getAttribute("data-dashboard-panel")===i;l.classList.toggle("hidden",!d),l.setAttribute("aria-hidden",d?"false":"true")})},s=(n.find(i=>i.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");s&&o(s),n.forEach(i=>{i.addEventListener("click",()=>{let l=i.getAttribute("data-dashboard-tab");l&&o(l)})})})}window.addEventListener("DOMContentLoaded",ss);yt&&ht&&qe&&je&&(yt.addEventListener("click",e=>{e.preventDefault(),os()}),ht.addEventListener("click",e=>{e.preventDefault(),as()}));var H=null,V=!1,pt=null;function ke(e){if(!q)return;q.setAttribute("aria-pressed",e?"true":"false");let t=q.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":q.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function is(){V&&(window.clearTimeout(pt),pt=window.setTimeout(()=>{pt=null,V&&ro(!0)},400))}function ro(e=!1){if(!H)return!1;if(V&&!e)return!0;try{return H.start(),V=!0,ke(!0),!0}catch{return V=!1,ke(!1),!1}}function Sn(){if(H){V=!1,window.clearTimeout(pt);try{H.stop()}catch{}ke(!1)}}function ls(){if(q)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){q.setAttribute("disabled","true"),q.setAttribute("aria-disabled","true"),q.title="Voice input is not supported in this browser.";return}H=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(H.lang=t,H.interimResults=!1,"continuous"in H)try{H.continuous=!0}catch{}H.onresult=n=>{let r=n?.results?.[0]?.[0]?.transcript||"";if(r&&O){O.value=r.trim();try{O.focus({preventScroll:!0})}catch{O.focus()}try{let o=O.value.length;O.setSelectionRange(o,o)}catch{}}},H.onend=()=>{if(!V){ke(!1);return}is()},H.onerror=()=>{V=!1,ke(!1)}}catch{H=null,ke(!1),q.setAttribute("disabled","true"),q.setAttribute("aria-disabled","true")}}ls();q?.addEventListener("click",()=>{H&&(V?Sn():ro())});Mr?.addEventListener("submit",()=>{V&&Sn()});window.addEventListener("pagehide",()=>{V&&Sn()});Mr?.addEventListener("submit",async e=>{if(e.preventDefault(),!O)return;let t=O.value.trim();if(!t){O.focus();return}let n={text:t,completed:!1};O.value="",O.focus();try{await rs(n),await Ln()}catch(r){console.error("Failed to add task to the daily list",r),O.value=t,O.focus()}});ye?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(k)||Number.isNaN(n)||!k[n])return;let r=k.map(a=>({...a})),o=r.map((a,s)=>s===n?{...a,completed:t.checked}:a);k=o,ge(o);try{await to(o)}catch(a){console.error("Failed to update task completion state",a),k=r,ge(r)}});rn?.addEventListener("click",async()=>{if(!Array.isArray(k)||k.length===0)return;let e=k.filter(n=>!n.completed);if(e.length===k.length)return;let t=k.map(n=>({...n}));k=e,ge(e);try{await to(e)}catch(n){console.error("Failed to clear completed tasks",n),k=t,ge(t)}});ze(k);Ln();function cs(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),r=document.getElementById("noteNewBtn"),o=document.getElementById("notesList");if(!e||!t||!n||!r)return;let a=null,s=f=>{if(!f){a=null,e.value="",t.value="";return}a=f.id,e.value=f.title||"",t.value=f.body||""},i=()=>{if(!o)return;o.querySelectorAll("button[data-note-id]").forEach(m=>{if(!(m instanceof HTMLElement))return;let b=m.getAttribute("data-note-id")===a;m.classList.toggle("bg-base-200/80",b),m.classList.toggle("border-base-300",!b),m.classList.toggle("border-primary",b),m.classList.toggle("font-medium",b),m.setAttribute("aria-current",b?"true":"false")})},l=()=>{let f=Qe();return Array.isArray(f)?[...f].sort((m,b)=>{let w=Date.parse(m?.updatedAt||""),E=Date.parse(b?.updatedAt||"");return(Number.isNaN(E)?0:E)-(Number.isNaN(w)?0:w)}):[]},d=f=>{if(!f)return;let m=Qe();if(!Array.isArray(m))return;let b=m.filter(E=>E.id!==f);if(b.length===m.length)return;Nt(b),a===f&&(a=null);let w=y();if(a){let E=w.find(x=>x.id===a)||null;s(E)}else w.length?s(w[0]):s(null);i()},y=(f=l())=>{if(!o)return f;if(o.innerHTML="",!f.length){let m=document.createElement("li");return m.className="text-sm italic text-base-content/60",m.textContent="No saved notes yet.",o.appendChild(m),f}return f.forEach(m=>{let b=document.createElement("li");b.className="flex items-center gap-2";let w=document.createElement("button");w.type="button",w.dataset.noteId=m.id,w.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",w.textContent=m.title||"Untitled note",w.addEventListener("click",()=>{s(m),i()});let E=document.createElement("button");E.type="button",E.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",E.setAttribute("aria-label",`Delete note "${m.title||"Untitled note"}"`),E.textContent="Delete",E.addEventListener("click",x=>{x.stopPropagation(),d(m.id)}),b.appendChild(w),b.appendChild(E),o.appendChild(b)}),i(),f},p=()=>{let f=y();if(!f.length){s(null),i();return}let m=a?f.find(b=>b.id===a):null;s(m||f[0]),i()};n.addEventListener("click",()=>{let f=Qe(),m=Array.isArray(f)?[...f]:[],b=typeof e.value=="string"?e.value.trim():"",w=typeof t.value=="string"?t.value:"",E=b||"Untitled note",x=new Date().toISOString();if(a){let I=m.findIndex(M=>M.id===a);if(I>=0)m[I]={...m[I],title:E,body:w,updatedAt:x};else{let M=Ct(E,w,{updatedAt:x});a=M.id,m.unshift(M)}}else{let I=Ct(E,w);a=I.id,m.unshift(I)}Nt(m);let L=y(),N=a?L.find(I=>I.id===a):null;s(N||null),i()}),r.addEventListener("click",()=>{a=null,e.value="",t.value="",i(),typeof e.focus=="function"&&e.focus()}),p()}cs();var oo="theme",ds="professional",un="memoryCue:theme-change",us="professional",fn=document.getElementById("theme-menu"),ao="[data-theme-name],[data-theme-option]",fs=new Set(["dark","dracula","synthwave"]);function ie(e){return typeof e=="string"?e.trim():""}function so(e){return e instanceof HTMLElement?ie(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function ms(e){let t=ie(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",fs.has(t)))}function Dr(e){let t=ie(e);if(t)try{localStorage.setItem(oo,t)}catch(n){console.warn("Unable to save theme preference",n)}}function io(e){if(!fn)return;let t=ie(e);fn.querySelectorAll(ao).forEach(r=>{if(!(r instanceof HTMLElement))return;let o=so(r),a=t&&o===t;r.setAttribute("aria-checked",a?"true":"false"),r.classList.toggle("active",a)})}function ps(e){let t=ie(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(un,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let r=document.createEvent("CustomEvent");r.initCustomEvent(un,!0,!0,{theme:t}),window.dispatchEvent(r)}}}function mn(e,{persist:t=!0,notify:n=!0}={}){let r=ie(e);if(!r)return;ie(document.documentElement.getAttribute("data-theme"))!==r&&ms(r),t&&Dr(r),io(r),n&&ps(r)}function ys(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){mn(us,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(oo)||""}catch(r){console.warn("Unable to load theme preference",r)}let n=t||document.documentElement.getAttribute("data-theme")||ds;n&&mn(n,{persist:!1,notify:!0})}fn?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(ao):null;if(!t)return;e.preventDefault();let n=so(t);n&&mn(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(un,e=>{let t=ie(e?.detail?.theme);t&&io(t)});ys()});export default hs();
