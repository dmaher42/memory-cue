import{a as O,b as U}from"./chunk-WLIGKRBJ.js";import{a as x,b as H}from"./chunk-ERL7JLDU.js";import{b as R}from"./chunk-RCZ4YZVR.js";var D=R(()=>{H();U();x();(function(){let n=()=>{let t=document.getElementById("create-sheet"),a=document.getElementById("closeCreateSheet");if(!(t instanceof HTMLElement)||!(a instanceof HTMLElement)){let e=typeof n._retryCount=="number"?n._retryCount:0;e<10&&(n._retryCount=e+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let u=t.querySelector("[data-dialog-content]"),r=t.querySelector(".sheet-backdrop"),s=document.getElementById("createReminderForm"),i=document.getElementById("saveReminder"),f=document.getElementById("priority"),h=document.getElementById("priorityChips"),b=h?Array.from(h.querySelectorAll('input[name="priority"]')):[],l=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),T=Array.from(l).filter(e=>e instanceof HTMLElement),I=T[0]||null,A=()=>{t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open")};A();let p=null,C=(e,o)=>{try{document.dispatchEvent(new CustomEvent(e,{detail:o}))}catch(c){console.warn(`${e} dispatch failed`,c)}},E=()=>{let e=f?.value||"Medium";b.forEach(o=>{let c=o.value===e;o.checked=c,o.setAttribute("aria-checked",c?"true":"false")})},w=e=>{f&&(f.value!==e&&(f.value=e,f.dispatchEvent(new Event("change",{bubbles:!0}))),E())};b.forEach(e=>{e.addEventListener("change",()=>{e.checked&&w(e.value)})}),f?.addEventListener("change",E),E();let B=()=>{let e=t.querySelector('input, textarea, select, button, [contenteditable="true"]');e instanceof HTMLElement&&setTimeout(()=>{try{e.focus()}catch{}},0)},v=e=>{p=e instanceof HTMLElement?e:null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),p&&p.setAttribute("aria-expanded","true"),E(),B(),C("reminder:sheet-opened",{trigger:p})},S=(e="dismissed")=>{let o=!t.classList.contains("hidden");A(),p&&p.setAttribute("aria-expanded","false");let c=p&&document.body.contains(p)&&p||I;if(c&&typeof c.focus=="function")try{c.focus()}catch{}o&&C("reminder:sheet-closed",{reason:e,trigger:p}),p=null};T.forEach(e=>{e.addEventListener("click",o=>{o.preventDefault(),v(e)})}),a.addEventListener("click",e=>{e.preventDefault(),S("close-button")}),r?.addEventListener("click",e=>{e.target===r&&S("backdrop")}),t.addEventListener("keydown",e=>{e.key==="Escape"&&(e.stopPropagation(),S("escape"))}),u?.addEventListener("click",e=>{e.stopPropagation()}),t.addEventListener("click",e=>{e.target instanceof HTMLElement&&e.target.hasAttribute("data-close")&&S("backdrop")}),document.addEventListener("cue:open",e=>{E(),v(e?.detail?.trigger||null)}),document.addEventListener("cue:close",e=>{S(e?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{E()}),document.addEventListener("cue:cancelled",()=>{S("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=S),document.addEventListener("reminder:save",e=>{if(!(i instanceof HTMLElement))return;let o=e?.detail?.trigger;o&&o!==i||i.matches(":disabled")||i.click()}),s instanceof HTMLFormElement&&i instanceof HTMLElement&&s.addEventListener("submit",e=>{e.preventDefault(),!i.matches(":disabled")&&i.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var M=()=>{M._initialised||(M._initialised=!0,O({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M,{once:!0}):M();(()=>{try{let n=document.getElementById("headerMenuBtn"),t=document.getElementById("headerMenu");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let a=["button","[href]",'[tabindex]:not([tabindex="-1"])'],u=()=>{for(let i of a){let f=t.querySelector(i);if(f instanceof HTMLElement&&!f.hasAttribute("disabled")){try{f.focus({preventScroll:!0})}catch{f.focus()}return}}},r=()=>{t.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),u()},s=()=>{t.classList.contains("hidden")||(t.classList.add("hidden"),n.setAttribute("aria-expanded","false"))};n.addEventListener("click",i=>{i.stopPropagation(),t.classList.contains("hidden")?r():s()}),n.addEventListener("keydown",i=>{i.key==="Escape"?(s(),n.focus({preventScroll:!0})):(i.key==="ArrowDown"||i.key==="Enter"||i.key===" ")&&t.classList.contains("hidden")&&(i.preventDefault(),r())}),t.addEventListener("click",i=>{i.target instanceof HTMLElement&&i.target.closest("button")&&s()}),document.addEventListener("click",i=>{i.target instanceof Node&&(t.contains(i.target)||i.target===n)||s()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&s()})}catch(n){console.error("[headerActions] init failed",n)}})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let t=()=>{let r=document.getElementById("voiceBtn");return r instanceof HTMLElement?r:null},a=()=>{let r=t();if(!r)return;let s=()=>{r.hasAttribute("disabled")||r.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let f=r.getAttribute("title");f&&n.setAttribute("title",f)};s(),typeof MutationObserver=="function"&&new MutationObserver(s).observe(r,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a,{once:!0}):a();let u=()=>{let r=t();if(r&&!(r.hasAttribute("disabled")||r.getAttribute("aria-disabled")==="true")){try{r.focus({preventScroll:!0})}catch{try{r.focus()}catch{}}try{r.click()}catch(s){console.warn("Voice add trigger failed",s)}}};n.addEventListener("click",r=>{r.preventDefault();let s=!1,i=null,f=()=>{s||(s=!0,document.removeEventListener("reminder:sheet-opened",h),u())},h=l=>{if(l?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&i&&(window.clearTimeout(i),i=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(f,150)};document.addEventListener("reminder:sheet-opened",h);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(l){document.removeEventListener("reminder:sheet-opened",h),typeof window<"u"&&typeof window.clearTimeout=="function"&&i&&(window.clearTimeout(i),i=null),console.warn("Voice add open failed",l);return}let b=document.getElementById("create-sheet");b instanceof HTMLElement&&b.classList.contains("open")&&(i=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(f,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),t=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let a=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],u=()=>{let s=t.hasAttribute("open");n.setAttribute("aria-expanded",String(s)),n.classList.toggle("btn-active",s)},r=()=>{for(let s of a){let i=t.querySelector(s);if(i instanceof HTMLElement&&!i.hasAttribute("disabled")){try{i.focus({preventScroll:!0})}catch{i.focus()}return}}};n.addEventListener("click",()=>{let s=t.hasAttribute("open");t.open=!s,s||r(),u()}),t.addEventListener("toggle",u),u()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let a=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(a)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let a=document.createElement("div");a.textContent="Save clicked",a.style.position="fixed",a.style.right="16px",a.style.bottom="16px",a.style.background="rgba(34,197,94,0.95)",a.style.color="#fff",a.style.padding="8px 12px",a.style.borderRadius="8px",a.style.zIndex="99999",document.body.appendChild(a),setTimeout(()=>a.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let a=20;n.innerHTML="";let u=0;function r(){let f=t.slice(u,u+a);f.forEach(h=>n.appendChild(h)),u+=f.length}r();let s=document.createElement("div");s.id="listSentinel",n.appendChild(s);let i=new IntersectionObserver(f=>{f.some(h=>h.isIntersecting)&&u<t.length&&(r(),u>=t.length&&i.disconnect())});i.observe(s)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),a=document.getElementById("closeSettings");if(!n||!t||!a)return;function u(){t.classList.remove("hidden")}function r(){t.classList.add("hidden")}n.addEventListener("click",u),a.addEventListener("click",r),t.addEventListener("click",s=>{s.target instanceof HTMLElement&&s.target.matches("[data-close]")&&r()}),t.addEventListener("keydown",s=>{s.key==="Escape"&&r()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),a=document.getElementById("saveSyncSettings"),u=document.getElementById("testSync"),r=document.getElementById("syncAll"),s="syncUrl";if(!n)return;let i=["online","error"],f={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},h={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},b=null;function l(e,o){b=e,i.forEach(y=>n.classList.remove(y)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let c=typeof o=="string"&&o.trim()?o.trim():f[e]||"",m=typeof o=="string"&&o.trim()?o.trim():h[e]||c;n.textContent=m,c?(n.setAttribute("title",c),m!==c?n.setAttribute("aria-label",c):n.removeAttribute("aria-label")):(n.removeAttribute("title"),n.removeAttribute("aria-label")),n.dataset.state=e}function T(){b!=="syncing"&&(navigator.onLine?b!=="online"&&l("online"):l("offline"))}function I(e){typeof localStorage>"u"||(e?localStorage.setItem(s,e):localStorage.removeItem(s))}function A(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(s)||""}catch{return""}}function p(e){if(!e||typeof e!="object")return null;let o=e.id||e.uid||e.key||e.slug||e.uuid,c=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!c)return null;let m=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,y=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",g=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",d=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:o||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:c,dueIso:m&&m.trim()?m.trim():null,priority:y,category:g,done:d}}function C(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(o=>{let c=o.dataset||{},m=null;if(c.reminder)try{m=JSON.parse(c.reminder)}catch{m=null}let y=m||{id:c.id||c.reminderId||o.getAttribute("data-id")||null,title:c.title||c.reminderTitle||"",dueIso:c.due||c.reminderDue||o.getAttribute("data-due")||null,priority:c.priority||c.reminderPriority||o.getAttribute("data-priority")||"",category:c.category||c.reminderCategory||o.getAttribute("data-category")||"",done:c.done==="true"||c.reminderDone==="true"||o.getAttribute("data-done")==="true"};if(!y.title){let g=o.querySelector("[data-reminder-title], [data-title], h3, h4, strong");g&&(y.title=g.textContent.trim())}if(!y.dueIso){let g=o.querySelector("[data-due], time");if(g){let d=g.getAttribute("datetime")||g.getAttribute("data-due");y.dueIso=d||g.textContent.trim()}}return p(y)}).filter(Boolean):[]}function E(){if(typeof localStorage>"u")return[];let e=[],o=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(m=>{if(!o.has(m)){o.add(m);try{let y=localStorage.getItem(m);if(!y)return;let g=JSON.parse(y);Array.isArray(g)?g.forEach(d=>e.push(d)):g&&typeof g=="object"&&(Array.isArray(g.items)&&g.items.forEach(d=>e.push(d)),Array.isArray(g.reminders)&&g.reminders.forEach(d=>e.push(d)))}catch{}}}),!e.length)for(let m=0;m<localStorage.length;m+=1){let y=localStorage.key(m);if(!(!y||o.has(y)||!/remind/i.test(y))){o.add(y);try{let g=localStorage.getItem(y);if(!g)continue;let d=JSON.parse(g);Array.isArray(d)?d.forEach(L=>e.push(L)):d&&typeof d=="object"&&(Array.isArray(d.items)&&d.items.forEach(L=>e.push(L)),Array.isArray(d.reminders)&&d.reminders.forEach(L=>e.push(L)))}catch{}}}return e.map(p).filter(Boolean)}function w(){let e=C();return e.length?e:E()}function B(e){e?(r?.setAttribute("aria-busy","true"),r?.setAttribute("disabled","disabled"),u?.setAttribute("aria-busy","true"),u?.setAttribute("disabled","disabled")):(r?.removeAttribute("aria-busy"),u?.removeAttribute("aria-busy"),v())}function v(){!!((t?.value||"").trim()||A())?(r?.removeAttribute("disabled"),u?.removeAttribute("disabled")):(r?.setAttribute("disabled","disabled"),u?.setAttribute("disabled","disabled"))}let S=A();t&&S&&(t.value=S),v(),l(navigator.onLine?"online":"offline"),window.addEventListener("online",T),window.addEventListener("offline",T),t?.addEventListener("input",v),a?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){I(""),l("info","Sync URL cleared. Add one to enable sync."),v();return}try{let o=new URL(e);if(!/^https?:/.test(o.protocol))throw new Error("Invalid protocol")}catch{l("error","Enter a valid sync URL before saving.");return}I(e),l("online","Sync settings saved."),v()}),u?.addEventListener("click",async()=>{let e=(t?.value||A()).trim();if(!e){l("error","Add your sync URL in Settings first.");return}B(!0),l("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?l("online","Connection looks good."):l("error","Test failed. Check your Apps Script deployment.")}catch(o){console.error("Test sync failed",o),l("error","Test failed. Check your Apps Script deployment.")}finally{B(!1)}}),r?.addEventListener("click",async()=>{let e=(t?.value||A()).trim();if(!e){l("error","Add your sync URL in Settings first.");return}let o=w();if(!o.length){l("info","Nothing to sync right now.");return}B(!0),l("syncing",`Syncing ${o.length} reminder${o.length===1?"":"s"}\u2026`);let c=20,m=0,y=0,g=d=>({id:d.id,title:d.title,dueIso:d.dueIso||null,priority:d.priority||"Medium",category:d.category||"General",done:!!d.done,source:"memory-cue-mobile"});try{for(let d=0;d<o.length;d+=c){let L=o.slice(d,d+c);(await Promise.allSettled(L.map(k=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g(k))})))).forEach(k=>{k.status==="fulfilled"&&k.value?.ok?m+=1:(k.status,y+=1)}),await new Promise(k=>setTimeout(k,300))}y?m?l("error",`Partial sync: ${m} success, ${y} failed.`):l("error","Sync failed. Check your sync URL and retry."):l("online",`Sync complete. ${m} updated.`)}catch(d){console.error("Sync failed",d),l("error","Sync failed. Try again soon.")}finally{B(!1)}})})()});export default D();
