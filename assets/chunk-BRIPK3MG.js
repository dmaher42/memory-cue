import{b as Ue,c as Qn}from"./chunk-KX65DZXT.js";import{a as Jn,b as Pt,c as Er}from"./chunk-GUVSRPRW.js";function ei(i={}){try{Object.assign(j,i||{})}catch(o){console.warn("[supabase-auth] setAuthContext failed",o)}}async function ti(i={}){try{if(j&&typeof j.signInWithPopup=="function"&&j.auth&&typeof j.GoogleAuthProvider=="function")return j.signInWithPopup(j.auth,new j.GoogleAuthProvider);if(j&&typeof j.signInWithRedirect=="function"&&j.auth&&typeof j.GoogleAuthProvider=="function")return j.signInWithRedirect(j.auth,new j.GoogleAuthProvider);let o=Ue();if(o&&o.auth){if(typeof o.auth.signInWithOAuth=="function")return o.auth.signInWithOAuth({provider:"google",...i});if(typeof o.auth.signIn=="function")return o.auth.signIn({provider:"google"})}}catch(o){console.error("[supabase-auth] startSignInFlow error",o);try{j?.toast?.("Sign-in failed")}catch(s){console.warn("[supabase-auth] toast handler failed",s)}throw o}return Promise.resolve(null)}async function ni(){try{if(j&&typeof j.signOut=="function")return j.signOut(j.auth);let i=Ue();if(i&&i.auth&&typeof i.auth.signOut=="function")return i.auth.signOut()}catch(i){throw console.error("[supabase-auth] startSignOutFlow error",i),i}return Promise.resolve(null)}function Ir(i){return i?Array.isArray(i)?i:[i]:[]}function ct(i){return Array.from(new Set(i.filter(o=>o instanceof HTMLElement||typeof SVGElement<"u"&&o instanceof SVGElement)))}function de(i,o){let s=Ir(o).filter(Boolean);if(!s.length)return[];let l=s.flatMap(S=>Array.from(i.querySelectorAll(S)));return ct(l)}function Tr(i,o=document){let s=o instanceof Document||o instanceof HTMLElement?o:document;return{authForms:de(s,i.authForm),emailInputs:de(s,i.emailInput),signInButtons:de(s,i.signInButtons),signOutButtons:de(s,i.signOutButtons),userBadges:de(s,i.userBadge),userBadgeEmails:de(s,i.userBadgeEmail),userBadgeInitials:de(s,i.userBadgeInitial),userNameEls:de(s,i.userName),syncStatusEls:de(s,i.syncStatus),syncStatusTextEls:de(s,i.syncStatusText),statusIndicatorEls:de(s,i.statusIndicator),feedbackEls:de(s,i.feedback)}}function ot(i,o){ct(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.classList.toggle("hidden",!o),o?s.removeAttribute("hidden"):s.setAttribute("hidden",""))})}function Ce(i,o){ct(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.textContent=o||"")})}function Lr(i,o){ct(i).forEach(s=>{s instanceof HTMLElement&&(s.dataset.state=o,s.classList.toggle("online",o==="online"),s.classList.toggle("offline",o!=="online"))})}function st(i,o){ct(i).forEach(s=>{if(!(s instanceof HTMLElement))return;s.textContent=o||"";let l=!!o;s.classList.toggle("hidden",!l),l?s.removeAttribute("hidden"):s.setAttribute("hidden","")})}function ii(i={}){let o={...Zn.syncStatusText,...i.syncStatusText||{}};return{...Zn,...i,syncStatusText:o}}function at(i,{user:o,messages:s}={}){let l=ii(s),S=!!o;ot(i.signInButtons,!S),ot(i.authForms,!S),ot(i.signOutButtons,S),ot(i.userBadges,S);let T=typeof o?.email=="string"?o.email:"",D=T?T.charAt(0).toUpperCase():"U";S?(Ce(i.userBadgeEmails,T),Ce(i.userBadgeInitials,D),Ce(i.userNameEls,T)):(Ce(i.userBadgeEmails,""),Ce(i.userBadgeInitials,""),Ce(i.userNameEls,""));let H=typeof l.signedIn=="function"?l.signedIn(o):l.signedIn,L=typeof l.signedOut=="function"?l.signedOut(o):l.signedOut,V=S?H:L,Z=!S;i.syncStatusEls.length&&(Ce(i.syncStatusEls,V),i.syncStatusEls.forEach(ee=>{ee instanceof HTMLElement&&(ee.classList.toggle("online",S),ee.dataset.state=S?"online":"offline")}),ot(i.syncStatusEls,Z));let E=S?l.syncStatusText?.signedIn:l.syncStatusText?.signedOut;Ce(i.syncStatusTextEls,E||""),Lr(i.statusIndicatorEls,S?"online":"offline"),st(i.feedbackEls,"")}function Cr(i,o){o.authForms.forEach(s=>{!(s instanceof HTMLFormElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("submit",async l=>{l.preventDefault();let S=o.emailInputs.find(D=>s.contains(D))||s.querySelector('input[type="email"]'),T=typeof S?.value=="string"?S.value.trim():"";if(!T){st(o.feedbackEls,"Enter an email address to continue.");return}try{let{error:D}=await i.auth.signInWithOtp({email:T});D?st(o.feedbackEls,D.message||"Unable to send magic link."):st(o.feedbackEls,"Magic link sent. Check your email.")}catch(D){st(o.feedbackEls,D?.message||"Unable to send magic link.")}}))})}function Dr(i,o){o.signOutButtons.forEach(s=>{!(s instanceof HTMLElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("click",async()=>{try{await i.auth.signOut()}catch(l){console.error("[supabase] Sign-out failed.",l)}}))})}function Kr(i={}){let{supabase:o,scope:s=document,selectors:l={},messages:S={},disableButtonBinding:T=!1,onSessionChange:D}=i,H={...Ar,...l},L=Tr(H,s),V=ii(S);at(L,{user:null,messages:V});let Z=o||Ue()||(typeof window<"u"?window.supabase:null);if(!Z)return{supabase:null,elements:L,applyAuthState:q=>at(L,{...q,messages:V}),destroy(){}};Cr(Z,L),T||Dr(Z,L);let E=[],{data:ee}=Z.auth.onAuthStateChange((q,A)=>{if(at(L,{user:A?.user??null,messages:V}),typeof D=="function")try{D(A?.user??null,A)}catch(k){console.error("[supabase] onSessionChange handler failed.",k)}});return ee?.subscription&&E.push(()=>{try{ee.subscription.unsubscribe()}catch{}}),Z.auth.getSession().then(({data:q,error:A})=>{A||at(L,{user:q?.session?.user??null,messages:V})}).catch(q=>{console.error("[supabase] getSession failed.",q)}),{supabase:Z,elements:L,applyAuthState:q=>at(L,{...q,messages:V}),destroy(){E.forEach(q=>{try{q()}catch{}})}}}var j,Ar,Zn,ri=Pt(()=>{Qn();j={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};Ar={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},Zn={signedOut:"",signedIn:i=>`Reminders syncing for ${i?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var ci=Er((Qr,dt)=>{var Ut=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function oi(i){if(!i||typeof i!="object")return null;let o=Object.entries(i).filter(([s,l])=>typeof l=="string"&&l.trim()!=="");return o.length?Object.fromEntries(o):null}function xr(){let i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},o=oi(i?.__FIREBASE_CONFIG);if(o)return o;let s=oi(i?.__ENV?.FIREBASE_CONFIG);if(s)return s;let S=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((T,[D,H])=>{let L=i?.__ENV?.[D]??i?.[D];return typeof L=="string"&&L.trim()!==""&&(T[H]=L),T},{});return Object.keys(S).length?S:null}function si(){let i=xr();return i?{...Ut,...i}:{...Ut}}var ai={DEFAULT_FIREBASE_CONFIG:Ut,getFirebaseConfig:si};if(typeof globalThis<"u"){let i=globalThis;i.memoryCueFirebase=i.memoryCueFirebase||{},i.memoryCueFirebase.getFirebaseConfig=si,i.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Ut}typeof dt<"u"&&dt.exports&&(dt.exports=ai,dt.exports.default=ai)});function Fr(){if(ge)return{...ge};let o=An()?.memoryCueFirebase;if(o&&typeof o.getFirebaseConfig=="function")return ge=o.getFirebaseConfig(),{...ge};if(typeof Jn=="function")try{let s=ci();if(s){let l=typeof s.getFirebaseConfig=="function"?s.getFirebaseConfig:typeof s.default?.getFirebaseConfig=="function"?s.default.getFirebaseConfig:null;if(l)return ge=l(),{...ge}}}catch{}return o&&o.DEFAULT_FIREBASE_CONFIG?(ge={...o.DEFAULT_FIREBASE_CONFIG},{...ge}):(ge={...kr},{...ge})}function An(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function pi(){let i=An(),o=i&&i.TimestampTrigger;return typeof o=="function"?o:null}function we(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!pi()}function Rr(){if(typeof window>"u"||!window.location)return hn;try{return new URL(hn,window.location.href).href}catch{return hn}}async function De(){return $t||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:($t=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Rr()),await navigator.serviceWorker.ready}catch(i){return console.warn("Service worker registration failed",i),null}})(),$t))}async function fi(i){if(!i||typeof i!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let o=await De();if(!o)return!1;let s=new Set;navigator.serviceWorker.controller&&s.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(S=>{let T=o[S];T&&s.add(T)});let l=!1;return s.forEach(S=>{try{S.postMessage(i),l=!0}catch(T){console.warn("Failed posting message to service worker",T)}}),l}catch(o){return console.warn("Unable to reach service worker",o),!1}}async function jt(){if(we())return!1;if(wn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(lt)try{return await lt}catch{}lt=(async()=>{let i=await De();if(!i)return!1;let o=!1;if("periodicSync"in i)try{let s=await i.periodicSync.getTags();(!Array.isArray(s)||!s.includes(bn))&&await i.periodicSync.register(bn,{minInterval:15*60*1e3}),o=!0}catch(s){console.warn("Periodic background sync unavailable",s)}if(!o&&"sync"in i)try{await i.sync.register(bn),o=!0}catch(s){console.warn("Background sync unavailable",s)}return o})();try{let i=await lt;return i&&(wn=!0),i}catch(i){return console.warn("Background reminder sync setup failed",i),wn=!1,!1}finally{lt=null}}async function vn(i=[],{requestCheck:o=!1}={}){if(!we()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let s=await De();if(!s)return;let l=await fi({type:ui.updateScheduledReminders,reminders:Array.isArray(i)?i:[]});if(o&&await fi({type:ui.checkScheduledReminders}),!l&&typeof s.update=="function")try{await s.update()}catch{}}catch(s){console.warn("Failed syncing reminders with service worker",s)}}async function En(i,o){if(we())try{let s=o||await De();if(!s)return;let l=[];try{l=await s.getNotifications({tag:i,includeTriggered:!0})}catch{l=await s.getNotifications({tag:i})}for(let S of l)try{S.close()}catch{}}catch{}}function mi(){for(let i of Array.from(be.values()))try{i.close()}catch{}be.clear()}function Br(){if(li||typeof window>"u"||typeof window.addEventListener!="function")return;let i=()=>mi();["pagehide","beforeunload"].forEach(o=>{try{window.addEventListener(o,i)}catch{}}),li=!0}function X(i){if(typeof i=="string"){let o=i.replace(/\s+/g," ").trim();if(o)return o}return K}async function eo(i={}){let o=e=>e?document.querySelector(e):null,s=e=>e?Array.from(document.querySelectorAll(e)):[],l=o(i.titleSel),S=o(i.dateSel),T=o(i.timeSel),D=o(i.detailsSel),H=o(i.prioritySel),L=o(i.categorySel),V=o(i.saveBtnSel),Z=o(i.cancelEditBtnSel),E=o(i.listSel),ee=s(i.googleSignInBtnSel),q=s(i.googleSignOutBtnSel),A=o(i.statusSel),k=o(i.syncStatusSel),$e={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Se=6e3,W=null;function ie(e,{clearMessage:t=!0}={}){W&&(e&&W.tokenId!==e||(W.timeoutId&&clearTimeout(W.timeoutId),t&&A&&A.dataset.undoToken===W.tokenId&&(typeof A.replaceChildren=="function"?A.replaceChildren():A.textContent="",delete A.dataset.undoToken,delete A.dataset.statusKind),W=null))}function M(e){if(!A)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),r=document.createElement("button");r.type="button",r.textContent="Undo",r.className="status-undo",r.addEventListener("click",()=>yr(e.tokenId)),e.button=r,typeof A.replaceChildren=="function"?A.replaceChildren(t,n,r):(A.textContent="",A.append(t,n,r)),A.dataset.statusKind="undo",A.dataset.undoToken=e.tokenId}function je(e,t){if(!k)return;let n=["online","offline","error"];n.forEach(d=>k.classList.remove(d)),n.includes(e)&&k.classList.add(e),k.dataset.state=e;let r=typeof t=="string"?t:$e[e]||"";e==="online"||e==="offline"?(k.textContent="",k.dataset.compact="true",r?(k.setAttribute("aria-label",r),k.setAttribute("title",r)):(k.removeAttribute("aria-label"),k.removeAttribute("title"))):(k.textContent=r,k.removeAttribute("data-compact"),r?(k.setAttribute("aria-label",r),k.setAttribute("title",r)):(k.removeAttribute("aria-label"),k.removeAttribute("title")))}let $=o(i.notesSel),Ei=o(i.saveNotesBtnSel),Ai=o(i.loadNotesBtnSel),Tn=o(i.countTotalSel),ut=o(i.googleUserNameSel),xe=o(i.dateFeedbackSel),re=o(i.voiceBtnSel),Ii=o(i.notifBtnSel),He=o(i.moreBtnSel),We=o(i.moreMenuSel),Ti=o(i.copyMtlBtnSel),zt=o(i.importFileSel),Li=o(i.exportBtnSel),Ci=o(i.syncAllBtnSel),Be=o(i.syncUrlInputSel),Di=o(i.saveSettingsSel),xi=o(i.testSyncSel),Ni=s(i.openSettingsSel),ft=o(i.settingsSectionSel),Oe=o(i.emptyStateSel),Ln=o(i.listWrapperSel),Xt=o(i.categoryOptionsSel),ve=i.variant||"mobile",ki=typeof i.autoWireAuthButtons=="boolean"?i.autoWireAuthButtons:ve!=="desktop",Cn="mc:lastDefaults";function Kt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Cn)||"{}")||{}}catch{return{}}}function Fi(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Cn,JSON.stringify(e))}catch{}}function Dn(e){let t=Kt(),n={category:X(e?.category||t.category||K),priority:e?.priority||t.priority||"Medium"};Fi(n)}let xn='fieldset#priorityChips input[name="priority"]';function Jt(){try{let e=document.querySelector(`${xn}:checked`);if(e&&e.value)return e.value}catch{}return H&&typeof H.value=="string"&&H.value?H.value:"Medium"}function pt(e){let t=e||"Medium";H&&typeof H.value<"u"&&(H.value=t);try{let n=Array.from(document.querySelectorAll(xn));if(!n.length)return;let r=!1;if(n.forEach(a=>{let d=a.value===t;a.checked=d,r=r||d}),!r){let a=n.find(d=>d.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function Nn(){let e=Kt();e.category&&L&&(L.value=e.category),e.priority&&pt(e.priority)}Nn();let oe=typeof document<"u"?document.getElementById("quickAddInput"):null,Ri=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ae=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,Qt=null;function Bi(e,t){let n=Date.now(),r=Kt(),a=typeof t=="string"&&t?t:null;return{id:Nt(),title:(e||"").trim(),priority:r.priority||Jt(),category:X(r.category||L?.value||K),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!J}}async function Zt(){if(!oe)return;if(typeof Qt=="function")try{Qt()}catch{}let e=(oe.value||"").trim();if(!e)return;let t=null;try{let a=Rt(e);a&&a.time&&(t=new Date(`${a.date}T${a.time}:00`).toISOString())}catch{t=null}let n=Bi(e,t);an(n,{position:"start"}),u.unshift(n),ce(u);let r=Ze(u);Ne=!0,Y(),Q(),r?u.forEach(a=>te(a)):te(n),tt(n),Fe(n),Te(),Dn(n),Ye();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}ue({action:"created",label:`Reminder added \xB7 ${n.title}`}),oe.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Zt),Ri?.addEventListener("click",()=>{Zt()}),oe?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Zt())});function Oi(){if(typeof HTMLElement>"u"||!(ae instanceof HTMLElement)||!(oe instanceof HTMLInputElement)||ae.dataset.voiceBound==="true")return;if(ae.dataset.voiceBound="true",typeof window>"u"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true"),ae.getAttribute("title")||(ae.title="Voice input is not supported in this browser.");return}let t=null,n=!1,r=c=>{n=c,ae.setAttribute("aria-pressed",c?"true":"false"),ae.dataset.listening=c?"true":"false",ae.classList.toggle("is-listening",c)},a=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",h=>{let g=h?.results?.[0]?.[0]?.transcript?.trim()||"";if(g){oe.value=g;try{oe.focus({preventScroll:!0})}catch{oe.focus()}try{let v=oe.value.length;typeof oe.setSelectionRange=="function"&&oe.setSelectionRange(v,v)}catch{}}});let f=()=>{r(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},d=()=>{if(!(!n||!t)){try{t.stop()}catch{}r(!1)}};Qt=d,ae.addEventListener("click",()=>{let c=a();if(c){if(n){d();return}try{c.start(),r(!0)}catch(f){console.warn("Quick add voice error:",f),r(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",d),r(!1)}Oi(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&oe&&(e.preventDefault(),oe.focus())})));try{ve==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Mi=i.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",kn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,_i=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",mt=i.reminderLandingPath||(ve==="desktop"?"index.html#reminders":"mobile.html"),Ee=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Fn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ye(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}L&&!L.value&&(L.value=K),we()&&De();function ue(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let r=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),r=!0)}catch{r=!1}if(!r){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(di,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(di,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function Pi(){if(typeof HTMLElement>"u"||!(re instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&l instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&l instanceof HTMLTextAreaElement;if(!e&&!t||re.dataset.voiceBound==="true")return;if(re.dataset.voiceBound="true",typeof window>"u"){re.setAttribute("disabled","true"),re.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){re.setAttribute("disabled","true"),re.setAttribute("aria-disabled","true"),re.getAttribute("title")||(re.title="Voice input is not supported in this browser.");return}let r=null,a=!1,d=g=>{a=g,re.setAttribute("aria-pressed",g?"true":"false"),re.dataset.listening=g?"true":"false",re.classList.toggle("is-listening",g)},c=()=>{if(r)return r;r=new n,r.lang="en-US",r.interimResults=!1,r.maxAlternatives=1,r.addEventListener("result",v=>{let x=v.results?.[0]?.[0]?.transcript?.trim()||"";if(x){l.value=x;try{l.focus({preventScroll:!0})}catch{try{l.focus()}catch{}}try{let _=l.value.length;typeof l.setSelectionRange=="function"&&l.setSelectionRange(_,_)}catch{}ue({action:"dictated",label:`Voice input captured \xB7 ${x}`})}});let g=()=>{d(!1)};return r.addEventListener("end",g),r.addEventListener("error",g),r},f=()=>{if(!(!a||!r)){try{r.stop()}catch{}d(!1)}};re.addEventListener("click",()=>{let g=c();if(g){if(a){f();return}try{g.start(),d(!0)}catch(v){console.warn("Speech recognition error:",v),d(!1)}}});let h=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",h),document.addEventListener("reminders:updated",h)),d(!1)}Br(),Pi();let gt,yt,ht,bt,Me,wt,St,vt,Et,At,It,Ge,Ve,Tt,Lt,en,tn,Ct,nn,Rn=i.firebaseDeps,rn=typeof i.importModule=="function"?i.importModule:e=>import(e),qe=An(),ze=!1,fe=!1,on=null,ye=null,Xe=null,u=[],Ne=!1,J=null,Ke=null,Je=null,ke={},G={};function ce(e=u){Array.isArray(e)&&e.sort((t,n)=>{let r=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,a=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return r===a?Un(t||{},n||{}):a-r})}function Ui(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(r=>{let a=Number.isFinite(r?.orderIndex)?r.orderIndex:null;a!=null&&(a<t&&(t=a),a>n&&(n=a))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function Qe(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(r=>Number.isFinite(r?.orderIndex)),n;if(t)n=e.slice(),ce(n);else{n=e.slice().sort(Un);let r=n.length;n.forEach((a,d)=>{a.orderIndex=(r-d)*me})}return e===u&&(u=n),n}function an(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:r}=Ui();if(t==="end"){let a=Number.isFinite(n)?n:0;e.orderIndex=a-me||me}else{let a=Number.isFinite(r)?r:0;e.orderIndex=a+me||me}}function Ze(e=u){if(!Array.isArray(e)||e.length<2)return!1;ce(e);let t=!1;for(let n=1;n<e.length;n+=1){let r=e[n-1],a=e[n],d=Number.isFinite(r?.orderIndex)?r.orderIndex:null,c=Number.isFinite(a?.orderIndex)?a.orderIndex:null;if(d==null||c==null||d<=c||d-c<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*me;return e===u&&ce(u),!0}let F={draggingId:null,dropTargetId:null,dropBefore:!0},Bn=!1,p={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function $i(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function et(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Ae(){E&&(E.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),E.classList.remove("drag-over-list"))}function sn(){if(!E)return;let e=E.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Ae(),F.draggingId=null,F.dropTargetId=null,F.dropBefore=!0}function On(e,t,n){if(!e||e===t)return;let r=u.findIndex(_=>_?.id===e);if(r<0)return;let[a]=u.splice(r,1),d;if(!t)d=u.length;else{let _=u.findIndex(z=>z?.id===t);if(_<0){u.splice(r,0,a);return}d=n?_:_+1}u.splice(d,0,a);let c=u[d-1],f=u[d+1],h=Number.isFinite(c?.orderIndex)?c.orderIndex:null,g=Number.isFinite(f?.orderIndex)?f.orderIndex:null,v;h!=null&&g!=null?v=(h+g)/2:h!=null?v=h-me:g!=null?v=g+me:v=me,Number.isFinite(v)||(v=me*(u.length+1)),a.orderIndex=v,ce(u);let x=Ze(u);Ne=!0,Y(),Q(),x?u.forEach(_=>te(_)):te(a),Ye(),Ee("memoryCue:remindersUpdated",{items:u}),ue({action:"reordered",label:"Reminders reordered"})}function ji(e){let t=et(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let r=t.dataset.id;if(r&&(F.draggingId=r,F.dropTargetId=null,F.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",r)}catch{}}function Hi(e){if(!F.draggingId)return;let t=et(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),F.dropTargetId=null,F.dropBefore=!1,Ae(),E?.classList.add("drag-over-list");return}if(t.dataset.id===F.draggingId){e.preventDefault(),Ae();return}e.preventDefault();let n=t.getBoundingClientRect(),r=n.top+n.height/2,a=e.clientY<r;(F.dropTargetId!==t.dataset.id||F.dropBefore!==a)&&(Ae(),t.classList.add(a?"drag-over-before":"drag-over-after"),F.dropTargetId=t.dataset.id,F.dropBefore=a)}function Wi(e){let t=et(e.target);if(!t){E?.contains(e.relatedTarget)||Ae();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),E?.contains(e.relatedTarget)||E?.classList.remove("drag-over-list"))}function Yi(e){if(!F.draggingId)return;e.preventDefault();let t=et(e.target),n=t?.dataset.id||null,r=F.dropBefore;if(t){let a=t.getBoundingClientRect(),d=a.top+a.height/2;r=e.clientY<d}else n=null,r=!1;On(F.draggingId,n,r),sn()}function Gi(){sn()}function Vi(){!E||Bn||(Bn=!0,E.addEventListener("dragstart",ji),E.addEventListener("dragover",Hi),E.addEventListener("drop",Yi),E.addEventListener("dragend",Gi),E.addEventListener("dragleave",Wi),Dt())}function Dt(){if(!E||Dt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Dt._bound=!0;return}let t=6,n=160;function r(){p.longPressTimer&&(clearTimeout(p.longPressTimer),p.longPressTimer=null)}function a(){E&&(p.initialTouchAction!=null?E.style.touchAction=p.initialTouchAction:E.style.removeProperty("touch-action"))}function d({keepHighlights:w=!1}={}){if(r(),p.item&&p.pointerId!=null)try{p.item.hasPointerCapture?.(p.pointerId)&&p.item.releasePointerCapture(p.pointerId)}catch{}if(p.placeholder?.parentNode)try{p.placeholder.parentNode.removeChild(p.placeholder)}catch{}p.item&&(p.item.classList.remove("is-dragging"),p.originalStyles?p.item.setAttribute("style",p.originalStyles):p.item.removeAttribute("style")),a(),w||Ae(),Object.assign(p,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function c(w){return E?Array.from(E.querySelectorAll("[data-reminder-item]")).filter(y=>y!==w):[]}function f(w){let y=p.item;if(!y||p.ready)return;let N=y.getBoundingClientRect(),P=window.getComputedStyle(y);p.ready=!0,F.draggingId=y.dataset.id||null,p.offsetY=w.clientY-N.top,p.fixedX=N.left;let R=document.createElement("div");R.className="touch-drag-placeholder",R.setAttribute("aria-hidden","true"),R.style.height=`${N.height}px`,R.style.boxSizing="border-box",R.style.marginTop=P.marginTop,R.style.marginBottom=P.marginBottom,R.style.marginLeft=P.marginLeft,R.style.marginRight=P.marginRight,R.style.borderRadius=P.borderRadius,R.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",R.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",R.style.pointerEvents="none",R.style.display="block",R.style.width="100%",y.parentNode?.insertBefore(R,y),p.placeholder=R,p.longPressTimer=null,p.originalStyles=y.getAttribute("style")||"",y.classList.add("is-dragging"),y.style.position="fixed",y.style.left=`${N.left}px`,y.style.top=`${N.top}px`,y.style.width=`${N.width}px`,y.style.zIndex="999",y.style.pointerEvents="none",y.style.touchAction="none",p.initialTouchAction=E.style.touchAction||"",E.style.touchAction="none"}function h(w){let y=p.item;if(!y||!p.ready)return;let N=w-p.offsetY;y.style.top=`${N}px`,y.style.left=`${p.fixedX}px`}function g(w){if(!p.ready||!E)return;let y=p.item,N=c(y);if(Ae(),!N.length){F.dropTargetId=null,F.dropBefore=!1;return}let P=null,R=!1;for(let b of N){let B=b.getBoundingClientRect(),U=B.top+B.height/2;if(w<U){P=b,R=!0;break}}if(!P){P=N[N.length-1];let b=P.getBoundingClientRect(),B=b.top+b.height/2;R=w<B,R||(R=!1)}if(!P){F.dropTargetId=null,F.dropBefore=!1;return}let Re=P.getBoundingClientRect(),Mt=Re.top+Re.height/2,m=w<Mt;P.classList.add(m?"drag-over-before":"drag-over-after"),F.dropTargetId=P.dataset.id||null,F.dropBefore=m}function v(w){let y=F.draggingId,N=p.moved;if(!p.ready){d();return}d(),!w&&N&&y&&On(y,F.dropTargetId,F.dropBefore),sn()}function x(w){let y=w.pointerType||"";if(y&&y!=="touch"&&y!=="pen"||p.active)return;let N=et(w.target);if(!N)return;let P=$i(w.target);if(!(P&&P!==N)){p.active=!0,p.pointerId=w.pointerId,p.item=N,p.startX=w.clientX,p.startY=w.clientY,p.lastClientX=w.clientX,p.lastClientY=w.clientY,p.moved=!1,p.ready=!1,p.originalStyles=N.getAttribute("style")||"",p.startTime=w.timeStamp||Date.now(),F.dropTargetId=null,F.dropBefore=!0,F.draggingId=null,r(),p.longPressTimer=setTimeout(()=>{f({clientY:p.lastClientY})},n);try{N.setPointerCapture(w.pointerId)}catch{}}}function _(w){if(!p.active||w.pointerId!==p.pointerId)return;let y=w.pointerType||"";if(!(y&&y!=="touch"&&y!=="pen")){if(p.lastClientX=w.clientX,p.lastClientY=w.clientY,!p.ready){let N=Math.abs(w.clientX-p.startX),P=Math.abs(w.clientY-p.startY);if(N>t||P>t){let R=typeof w.timeStamp=="number"?w.timeStamp:Date.now();Math.abs(R-p.startTime)>=n?(r(),f({clientY:p.lastClientY})):d()}return}w.preventDefault(),p.moved=!0,h(w.clientY),g(w.clientY)}}function z(w){!p.active||w.pointerId!==p.pointerId||v(!1)}function le(w){!p.active||w.pointerId!==p.pointerId||v(!0)}E.addEventListener("pointerdown",x),window.addEventListener("pointermove",_),window.addEventListener("pointerup",z),window.addEventListener("pointercancel",le),Dt._bound=!0}function Mn(){J=null,je("offline"),ee.forEach(e=>e.classList.remove("hidden")),q.forEach(e=>e.classList.add("hidden")),ut&&(ut.textContent=""),Ke?.(),Ke=null,dn(),Y(),Q(),Te()}function cn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Sn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let r=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:r,d=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:Nt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:X(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:r,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(d)?d:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function qi(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Sn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:X(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(Sn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function Q(){ce(u),qi(u)}function dn(){u=Qe(cn())}dn();async function zi(){if(!J){u=cn();return}let e=Qe(cn());if(!e.length){u=[],Q();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await te(n),n.pendingSync=!1}catch(r){console.warn("Failed to sync offline reminder",r)}u=Qe(e.map(n=>({...n,pendingSync:!1}))),Q(),Y(),Te()}try{G=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{G={}}if(G&&typeof G=="object"&&Object.values(G).forEach(e=>{e&&typeof e=="object"&&(e.category=X(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:it(e),e.urlPath=e.urlPath||mt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!we()){let e=Gn();typeof Notification<"u"&&Notification.permission==="granted"?(jt(),e.length&&vn(e,{requestCheck:!0})):e.length&&vn(e)}let xt=e=>{if(!qe)return;let t=[qe];qe.window&&!t.includes(qe.window)&&t.push(qe.window);let n=!e;t.forEach(r=>{try{r.__memoryCueFirebaseUnavailable__=n}catch{}})};function Xi(){if(!$)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",r="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",d=()=>"value"in $?$.value:$.innerHTML,c=v=>{if("value"in $){$.value=v;return}if(typeof v!="string"||v.length===0){$.innerHTML="";return}let x=v.trim();if(/<\/?[a-z][\s\S]*>/i.test(x)){$.innerHTML=v;return}let z=v.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");$.innerHTML=z},f=v=>{v?$.classList.add("notes-editor--columns"):$.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!v))},h="";try{h=localStorage.getItem(n)||""}catch{I("Unable to access saved notes")}c(h);let g=!1;try{g=localStorage.getItem(r)==="1"}catch{g=!1}f(g),$.addEventListener("input",()=>{h=d();try{localStorage.setItem(n,h)}catch{I("Notes saved for this session only")}}),Ei?.addEventListener("click",()=>{h=d();try{localStorage.setItem(n,h),I("Notes saved")}catch{I("Notes saved for this session only")}}),Ai?.addEventListener("click",()=>{let v=h;try{v=localStorage.getItem(n)||h}catch{I("Unable to load saved notes")}h=v,c(h)}),e?.addEventListener("click",v=>{let x=v.target;if(!(x instanceof Element))return;let _=x.closest("button[data-action]");if(!_)return;let z=_.getAttribute("data-action");if(z==="columns"){let le=!$.classList.contains("notes-editor--columns");f(le);try{localStorage.setItem(r,le?"1":"0")}catch{I("Column preference saved for this session only")}return}if(!a){I("Formatting controls are not supported in this browser");return}$.focus(),z==="bullets"?document.execCommand("insertUnorderedList"):z==="numbers"&&document.execCommand("insertOrderedList")})}if(Xi(),V?.addEventListener("click",qn),Rn)({initializeApp:gt,getFirestore:yt,enableMultiTabIndexedDbPersistence:ht,enableIndexedDbPersistence:bt,doc:Me,setDoc:wt,deleteDoc:St,onSnapshot:vt,collection:Et,query:At,orderBy:It,serverTimestamp:Ge,getAuth:Ve,onAuthStateChanged:Tt,GoogleAuthProvider:Lt,signInWithPopup:en,signInWithRedirect:tn,getRedirectResult:Ct,signOut:nn}=Rn),ze=!0;else try{({initializeApp:gt}=await rn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:yt,enableMultiTabIndexedDbPersistence:ht,enableIndexedDbPersistence:bt,doc:Me,setDoc:wt,deleteDoc:St,onSnapshot:vt,collection:Et,query:At,orderBy:It,serverTimestamp:Ge}=await rn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ve,onAuthStateChanged:Tt,GoogleAuthProvider:Lt,signInWithPopup:en,signInWithRedirect:tn,getRedirectResult:Ct,signOut:nn}=await rn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),ze=!0}catch(e){ze=!1,console.warn("Firebase modules failed to load:",e),I("Firebase failed to load; notes available offline"),xt(!1)}if(ze&&typeof gt=="function"&&typeof yt=="function"&&typeof Ve=="function")try{let e=Fr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),on=gt(e),ye=yt(on),fe=!0,console.info("[Firebase] Firestore initialised",e.projectId),xt(!0)}catch(e){fe=!1,console.warn("Firebase initialization failed:",e),I("Firebase failed to load; notes available offline"),xt(!1)}else ze?(fe=!1,xt(!1)):fe=!1;fe&&typeof ht=="function"&&typeof bt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await ht(ye),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await bt(ye),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(r){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",r?.code||r)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),fe&&typeof Ve=="function"&&(Xe=Ve(on));function Ki(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Ji=typeof navigator<"u"&&navigator.language?navigator.language:"",_n=Ki(Ji),_e=_n||"en-US",he="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(he=e.timeZone),!_n&&e.locale&&(_e=e.locale)}catch{}let Qi=new Intl.DateTimeFormat(_e,{timeZone:he,hour:"2-digit",minute:"2-digit"}),Zi=new Intl.DateTimeFormat(_e,{timeZone:he,weekday:"long",day:"numeric",month:"long"}),er=new Intl.DateTimeFormat("en-CA",{timeZone:he,year:"numeric",month:"2-digit",day:"2-digit"}),tr=new Intl.DateTimeFormat(_e,{timeZone:he,weekday:"long"}),nr=new Intl.DateTimeFormat(_e,{timeZone:he,month:"short",day:"numeric"});function Ie(e){let t=er.formatToParts(e),n=t.find(d=>d.type==="year").value,r=t.find(d=>d.type==="month").value,a=t.find(d=>d.type==="day").value;return`${n}-${r}-${a}`}function Pn(e,t){let[n,r,a]=e.split("-").map(h=>parseInt(h,10)),[d,c]=t.split(":").map(h=>parseInt(h,10)),f=new Date;return f.setFullYear(n,(r||1)-1,a||1),f.setHours(d||0,c||0,0,0),f.toISOString()}let ir=new Intl.DateTimeFormat("en-CA",{timeZone:he,year:"numeric",month:"2-digit",day:"2-digit"}),rr=new Intl.DateTimeFormat("en-CA",{timeZone:he,hour:"2-digit",minute:"2-digit",hour12:!1});function or(e){try{let t=new Date(e),n=ir.formatToParts(t),r=n.find(c=>c.type==="year")?.value||"0000",a=n.find(c=>c.type==="month")?.value||"00",d=n.find(c=>c.type==="day")?.value||"00";return`${r}-${a}-${d}`}catch{return""}}function ar(e){try{let t=new Date(e),n=rr.formatToParts(t),r=n.find(d=>d.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(d=>d.type==="minute")?.value?.padStart(2,"0")||"00";return`${r}:${a}`}catch{return""}}function Nt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function kt(){return Ie(new Date)}function sr(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Yr(e){let t=sr(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Ft(e){return e==="High"?3:e==="Medium"?2:1}function Un(e,t){let n=e?.done?1:0,r=t?.done?1:0;if(n!==r)return n-r;let a=e?.due?new Date(e.due).getTime():1/0,d=t?.due?new Date(t.due).getTime():1/0;if(a!==d)return a-d;let c=Ft(t?.priority)-Ft(e?.priority);return c||(t?.updatedAt||0)-(e?.updatedAt||0)}function Gr(e,t){let n=Ft(t.priority)-Ft(e.priority);if(n)return n;let r=+new Date(e.due||0),a=+new Date(t.due||0);return r!==a?r-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function $n(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Zi.format(t)}catch{return e}}function ln(e){return Qi.format(e)}function cr(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Vr(e){return e?cr(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function I(e){A&&(ie(),A.dataset.statusKind="toast",A.textContent=e,clearTimeout(I._t),I._t=setTimeout(()=>{A&&A.dataset.statusKind==="toast"&&(A.textContent="",delete A.dataset.statusKind)},2500))}function dr(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)}}function Rt(e){e=String(e||"").toLowerCase();let t={date:kt(),time:""},n=f=>{let h=new Date,g=h.getDay(),v=(f-g+7)%7,x=new Date(h);return x.setDate(h.getDate()+(v===0?7:v)),x},r=f=>{let h=new Date,g=h.getDay(),v=(f-g+7)%7,x=new Date(h);return x.setDate(h.getDate()+v),x},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},d={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=Ie(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=a[f[1]],g=n(h);t.date=Ie(g)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=a[f[1]],g=r(h);t.date=Ie(g)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=a[f[1]],g=n(h);t.date=Ie(g)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),h=parseInt(f[1],10),g=new Date;g.setDate(g.getDate()+h),t.date=Ie(g)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),h=parseInt(f[1],10),g=parseInt(f[2],10)-1,v=f[3]?parseInt(f[3],10):new Date().getFullYear(),x=new Date(v,g,h);t.date=Ie(x)}else for(let[f,h]of Object.entries(d)){let g=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(g.test(e)){let v=e.match(g),x=parseInt(v[1],10),_=new Date().getFullYear(),z=new Date(_,h,x);t.date=Ie(z);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let f=parseInt(c[1],10),h=c[2]?parseInt(c[2],10):0,g=c[3];g&&(g==="pm"&&f<12&&(f+=12),g==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(h).padStart(2,"0")}`}return t}let un=fe&&Xe&&typeof Lt=="function";ei({authReady:un,auth:Xe,GoogleAuthProvider:Lt,signInWithPopup:en,signInWithRedirect:tn,signOut:nn,toast:I});let jn=ki,Hn=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let r=t(n);r&&typeof r.then=="function"&&r.catch(a=>{console.error("Auth handler error:",a)})}catch(r){console.error("Auth handler error:",r)}}),e._authWired=!0)};jn&&ee.length&&ee.forEach(e=>Hn(e,ti)),un&&typeof Ct=="function"&&Ct(Xe).catch(()=>{}),jn&&q.length&&q.forEach(e=>Hn(e,ni)),un&&typeof Tt=="function"?Tt(Xe,async e=>{e?(J=e.uid,je("online"),ee.forEach(t=>t.classList.add("hidden")),q.forEach(t=>t.classList.remove("hidden")),ut&&(ut.textContent=e.displayName||e.email||""),lr(),await zi()):Mn()}):Mn();function lr(){if(!fe||!ye||typeof Et!="function"||typeof At!="function"||typeof It!="function"||typeof vt!="function")return;if(!J){dn(),Y(),Q(),Te();return}Ke&&Ke();let e=Et(ye,"users",J,"reminders"),t=At(e,It("updatedAt","desc"));Ke=vt(t,n=>{let r=[];n.forEach(a=>{let d=a.data(),c=Number(d.orderIndex);r.push({id:a.id,title:d.title,priority:d.priority,notes:d.notes||"",done:!!d.done,due:d.due||null,category:X(d.category),createdAt:d.createdAt?.toMillis?.()||0,updatedAt:d.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(c)?c:null})}),u=Qe(r),Y(),Q(),Te()},n=>{console.error("Firestore sync error:",n),k&&je("error","Sync Error")})}async function te(e){if(!(!fe||!J||!ye||typeof Me!="function"||typeof wt!="function"||typeof Ge!="function"))try{await wt(Me(ye,"users",J,"reminders",e.id),{ownerUid:J,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||K,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):Ge(),updatedAt:Ge()},{merge:!0})}catch(t){console.error("Save failed:",t),I("Save queued (offline)")}}async function ur(e){if(!(!fe||!J||!ye||typeof Me!="function"||typeof St!="function"))try{await St(Me(ye,"users",J,"reminders",e))}catch{I("Delete queued (offline)")}}async function tt(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||K,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function nt(){l&&(l.value=""),S&&(S.value=""),T&&(T.value=""),D&&(D.value=""),pt("Medium"),L&&(L.value=K),Nn(),Je=null,V&&(V.textContent="Save"),Z?.classList.add("hidden")}function fr(e){let t=u.find(n=>n.id===e);t&&(l&&(l.value=t.title||""),S&&T&&(t.due?(S.value=or(t.due),T.value=ar(t.due)):(S.value="",T.value="")),pt(t?.priority||"Medium"),L&&(L.value=X(t.category)),D&&(D.value=typeof t.notes=="string"?t.notes:""),Je=e,V&&(V.textContent="Update"),Z?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),l?.focus(),Ee("cue:open",{mode:"edit"}))}function pr(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),r=X(e.category??(L?L.value:"")),a={id:Nt(),title:e.title.trim(),priority:e.priority||"Medium",category:r,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!J};an(a,{position:"start"}),u=[a,...u],ce(u);let d=Ze(u);return Ne=!0,Y(),Q(),Dn(a),d?u.forEach(c=>te(c)):te(a),tt(a),Fe(a),Ye(),Ee("memoryCue:remindersUpdated",{items:u}),Fn(),ue({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function mr(e,t){if(!J)return I("Sign in to add notes"),null;if(!e)return null;let n=u.find(c=>c.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let d=typeof n.notes=="string"?n.notes:"";return n.notes=d?`${d}
${a}`:a,n.updatedAt=Date.now(),te(n),Y(),Q(),ue({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function gr(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),te(t),tt(t),Y(),Q(),t.done?(Ot(e),ue({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Fe(t),ue({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function yr(e){if(!W||W.tokenId!==e)return;let{item:t,index:n}=W;if(!t){ie(e);return}ie(e);let r=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!J,t.updatedAt=Date.now(),u.splice(r,0,t),ce(u);let a=Ze(u);Ne=!0,Y(),Q(),Fe(t),a?u.forEach(d=>te(d)):te(t),tt(t),Ye(),Ee("memoryCue:remindersUpdated",{items:u}),ue({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),I("Reminder restored")}function Wn(e){let t=u.findIndex(a=>a.id===e),n=t>=0?u.splice(t,1)[0]:null;Y(),Q(),ur(e),Ot(e);let r=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(ue({action:"deleted",label:r}),n&&A){ie();let a=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;W={tokenId:a,item:n,index:t,timeoutId:null},M(W),W.timeoutId=setTimeout(()=>{ie(a)},Se)}else n&&ie()}function hr(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,r=48,a=800,d='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',c=null,f=!1,h=0,g=0,v=0,x=()=>{if(f){if(f=!1,c!=null&&e.hasPointerCapture?.(c))try{e.releasePointerCapture(c)}catch{}c=null,e.removeEventListener("pointermove",z),e.removeEventListener("pointerup",le),e.removeEventListener("pointercancel",w),e.removeEventListener("pointerleave",w),window.removeEventListener("pointerup",le),window.removeEventListener("pointercancel",w)}},_=y=>{if(y.pointerType==="mouse"&&y.button!==0)return;f&&x();let N=y.target;N instanceof Element&&N.closest(d)||(c=y.pointerId,h=y.clientX,g=y.clientY,v=typeof y.timeStamp=="number"?y.timeStamp:Date.now(),f=!0,e.addEventListener("pointermove",z),e.addEventListener("pointerup",le),e.addEventListener("pointercancel",w),e.addEventListener("pointerleave",w),window.addEventListener("pointerup",le),window.addEventListener("pointercancel",w))},z=y=>{if(!f||y.pointerId!==c)return;Math.abs(y.clientY-g)>r&&x()},le=y=>{if(!f||y.pointerId!==c)return;let N=y.clientX-h,P=Math.abs(y.clientY-g),R=(typeof y.timeStamp=="number"?y.timeStamp:Date.now())-v;if(x(),N<=-n&&P<=r&&R<=a){y.preventDefault(),y.stopPropagation();try{t()}catch(Re){console.warn("Swipe delete handler failed",Re)}}},w=y=>{f&&(typeof y.pointerId=="number"&&y.pointerId!==c||x())};e.addEventListener("pointerdown",_)}function it(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(r=>r.trim()).find(Boolean);if(n){if(e.due)try{let r=new Date(e.due);if(!Number.isNaN(r.getTime())){let a=ln(r);if(a)return`${n} \u2022 ${a}`}}catch{}return n}if(e.due)try{let r=new Date(e.due);if(!Number.isNaN(r.getTime())){let a=ln(r);if(a)return`Due ${a}`}}catch{}return"Due now"}function Yn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}I("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Gn(){return Object.values(G||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||K,notes:typeof e.notes=="string"?e.notes:"",body:it(e),urlPath:e.urlPath||mt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function fn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(G))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Gn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&jt(),vn(e,{requestCheck:t})}function Bt(e,{closeNotification:t=!0}={}){if(t){let n=be.get(e);if(n){try{n.close()}catch{}be.delete(e)}}ke[e]&&(clearTimeout(ke[e]),delete ke[e]),En(e),G[e]&&(delete G[e],fn())}function Ot(e){Bt(e)}function Vn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=be.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:it(e),tag:e.id});be.set(e.id,n);let r=()=>{be.get(e.id)===n&&be.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",r),n.addEventListener("click",r)),n.onclose=r,n.onclick=r}catch{}}async function br(e){if(!we())return!1;let t=pi();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let r=await De();if(!r)return!1;await En(e.id,r);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||K,body:d,urlPath:mt},d=it(e),c={body:d,tag:e.id,data:a,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await r.showNotification(e.title,c),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function Fe(e){if(!e||!e.id)return;if(e.category=X(e.category),!e.due||e.done){Ot(e.id);return}let t=G[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||K,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:it(e),urlPath:mt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?f:null})()};if(G[e.id]=n,fn(),ke[e.id]&&(clearTimeout(ke[e.id]),delete ke[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let r=new Date(e.due).getTime();if(!Number.isFinite(r))return;let a=r-Date.now();if(a<=0){if(G[e.id]?.viaTrigger){Bt(e.id,{closeNotification:!1});return}Vn(e),Bt(e.id,{closeNotification:!1});return}let d=we();d&&(n.viaTrigger=!1,br(e).then(c=>{c&&G[e.id]&&(G[e.id]={...G[e.id],viaTrigger:!0},fn())})),ke[e.id]=setTimeout(()=>{d&&En(e.id),Vn(e),Bt(e.id,{closeNotification:!1})},a)}function Te(){Object.values(G).forEach(e=>Fe({...e,category:X(e?.category)}))}function wr(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=tr.format(t),r=nr.format(t),a=ln(t);return`${n}, ${r}${a?` at ${a}`:""}`}catch{return"No due date"}}function Y(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let r=new Date(t);if(r.setHours(23,59,59,999),Ae(),ce(u),Tn)try{Tn.textContent=String(u.length)}catch{}u.forEach(m=>{m&&typeof m=="object"&&(m.category=X(m.category))});let a=new Set(Nr.map(m=>X(m)));u.forEach(m=>{m&&typeof m=="object"&&a.add(X(m.category))});let d=Array.from(a).sort((m,b)=>m.localeCompare(b,void 0,{sensitivity:"base"}));if(Xt){let m=new Set;Array.from(Xt.querySelectorAll("option")).forEach(b=>{m.add(b.value.trim().toLowerCase())}),d.forEach(b=>{let B=b.toLowerCase();if(!m.has(B)){let U=document.createElement("option");U.value=b,Xt.appendChild(U),m.add(B)}})}if(Ne)Ne=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=u.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(b))}}catch{}}let c=u.slice();ce(c);let f=!0,h=u.length>0,g=c.length>0,v=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(G||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(m.map(b=>b.id))})();if(Oe)if(g)Oe.classList.add("hidden");else{let m=h?"No reminders to show right now.":Mi;kn?kn(Oe,{icon:h?"sparkles":"bell",title:h?"Nothing to display":"Create your first cue",description:m,action:h?void 0:`<button type="button" class="${_i}" data-trigger="open-cue">Create reminder</button>`}):Oe.textContent=m,Oe.classList.remove("hidden")}if(Ln&&Ln.classList.toggle("has-items",g),!E)return;if(!g){Oe?(E.innerHTML="",E.classList.add("hidden")):(E.innerHTML='<div class="text-muted">No reminders found.</div>',E.classList.remove("hidden"));return}E.classList.remove("hidden"),E.replaceChildren();let x=document.createDocumentFragment(),_=E.tagName==="UL"||E.tagName==="OL",z=!0,le=["priority-high","priority-medium","priority-low"],w=(m,b)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...le);let B=typeof b=="string"?b.trim().toLowerCase():"";B.startsWith("h")?m.classList.add("priority-high"):B.startsWith("m")?m.classList.add("priority-medium"):B.startsWith("l")&&m.classList.add("priority-low")},y=(m,b="neutral")=>{let B=document.createElement("span");B.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",B.title=m,B.dataset.tone=b;let U=document.createElement("span");U.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?U.classList.add("bg-error"):b==="priority-medium"?U.classList.add("bg-warning"):b==="priority-low"?U.classList.add("bg-secondary"):b==="category"?U.classList.add("bg-primary"):U.classList.add("bg-base-content","opacity-40");let O=document.createElement("span");return O.className="truncate",O.textContent=m,B.append(U,O),B},N=(m,b,{elementTag:B,isMobile:U})=>{let O={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:b,done:!!m.done},C=document.createElement(B);C.className="task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",U&&C.classList.add("w-full"),C.dataset.id=O.id,C.dataset.category=O.category,C.dataset.title=O.title;let zn=O.priority&&String(O.priority).trim();zn?C.dataset.priority=zn:delete C.dataset.priority,C.dataset.done=String(O.done),O.dueIso?C.dataset.due=O.dueIso:delete C.dataset.due,C.dataset.reminder=JSON.stringify(O),C.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",C.dataset.reminderItem="true",C.dataset.compact="true",C.classList.add("reminder-draggable"),C.setAttribute("draggable","true"),C.setAttribute("role","button"),C.tabIndex=0,C.setAttribute("aria-label",`Edit reminder: ${m.title}`),w(C,O.priority),v.has(O.id)?C.dataset.notificationActive="true":delete C.dataset.notificationActive;let pn=O.dueIso?new Date(O.dueIso):null;f&&pn&&pn>=n&&pn<=r?(C.classList.add("is-today"),C.dataset.today="true"):(C.classList.remove("is-today"),delete C.dataset.today);let _t=document.createElement("div");_t.className="flex min-w-0 flex-col gap-2";let Pe=document.createElement("p");Pe.className="text-lg font-bold leading-snug text-base-content",Pe.classList.add("desktop-reminder-title"),U||Pe.classList.add("sm:text-[0.95rem]"),O.done&&Pe.classList.add("line-through","text-base-content/60"),Pe.textContent=m.title,_t.appendChild(Pe);let rt=document.createElement("div");rt.className="desktop-reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let mn=wr(m),Xn=mn&&mn!=="No due date"?mn:"";Xn&&rt.appendChild(y(Xn,"due")),!!(b&&b!==K)&&rt.appendChild(y(b,"category")),rt.children.length&&_t.appendChild(rt),C.appendChild(_t);let gn=document.createElement("div");gn.className="flex items-start gap-1";let se=document.createElement("button");se.type="button",se.className="btn btn-ghost btn-circle btn-xs",O.done?(se.classList.add("text-base-content/60"),se.innerHTML='<span aria-hidden="true">\u21BA</span>',se.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(se.classList.add("text-success"),se.innerHTML='<span aria-hidden="true">\u2713</span>',se.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),se.setAttribute("aria-pressed",O.done?"true":"false"),se.setAttribute("data-reminder-control","toggle"),se.setAttribute("data-no-swipe","true"),se.addEventListener("click",ne=>{ne.preventDefault(),ne.stopPropagation(),gr(O.id)});let Le=document.createElement("button");Le.type="button",Le.className="btn btn-ghost btn-circle btn-xs text-error",Le.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',Le.setAttribute("aria-label",`Delete reminder: ${m.title}`),Le.setAttribute("data-reminder-control","delete"),Le.setAttribute("data-no-swipe","true"),Le.addEventListener("click",ne=>{ne.preventDefault(),ne.stopPropagation(),Wn(O.id)}),gn.append(se,Le),C.appendChild(gn);let Kn=()=>fr(O.id);return C.addEventListener("click",ne=>{if(ne.defaultPrevented)return;let yn=ne.target;yn&&typeof yn.closest=="function"&&yn.closest("[data-reminder-control]")||Kn()}),C.addEventListener("keydown",ne=>{ne.defaultPrevented||ne.target===C&&(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),Kn())}),U&&hr(C,()=>Wn(O.id)),C},P=(m,b)=>N(m,b,{elementTag:"div",isMobile:!0});if(ve!=="desktop"&&!z){c.forEach(m=>{let b=m.category||K;x.appendChild(P(m,b))}),E.appendChild(x);return}let R=new Map;c.forEach(m=>{let b=m.category||K;R.has(b)||R.set(b,[]),R.get(b).push(m)});let Re=Array.from(R.entries()).sort((m,b)=>m[0].localeCompare(b[0],void 0,{sensitivity:"base"})),Mt=!0;Re.forEach(([m,b])=>{if(m!==K){let B=document.createElement(_?"li":"div");B.dataset.categoryHeading=m,_&&(B.setAttribute("role","presentation"),B.style.listStyle="none"),B.className=ve==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",Mt||(B.style.marginTop=ve==="desktop"?"1.25rem":"1rem");let U=document.createElement("div");U.setAttribute("role","heading"),U.setAttribute("aria-level","3"),U.className=ve==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let O=document.createElement("span");O.textContent=m;let C=document.createElement("span");C.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",C.textContent=`${b.length} ${b.length===1?"item":"items"}`,U.append(O,C),B.appendChild(U),x.appendChild(B)}b.forEach(B=>{if(ve==="desktop"){let U=N(B,m,{elementTag:_?"li":"div",isMobile:!1});x.appendChild(U);return}x.appendChild(P(B,m))}),Mt=!1}),E.appendChild(x)}function pe(){He?.setAttribute("aria-expanded","false"),We?.classList.add("hidden")}function Sr(){He?.setAttribute("aria-expanded","true"),We?.classList.remove("hidden")}He?.addEventListener("click",e=>{e.stopPropagation(),He.getAttribute("aria-expanded")==="true"?pe():Sr()}),document.addEventListener("click",e=>{We&&!We.classList.contains("hidden")&&!We.contains(e.target)&&e.target!==He&&pe()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&pe()}),Ni.forEach(e=>{e.addEventListener("click",()=>{let t=ft?.classList.contains("hidden");ft?.classList.toggle("hidden"),t&&ft?.scrollIntoView({behavior:"smooth",block:"start"}),pe()})}),document.addEventListener("DOMContentLoaded",()=>{ft?.classList.add("hidden")});function qn(){try{console.log("handleSaveAction invoked",{editingId:Je,title:l?.value})}catch{}let t=(typeof l?.value=="string"?l.value:"").trim(),n=typeof S?.value=="string"?S.value:"",r=typeof T?.value=="string"?T.value:"";if(Je){let c=u.find(g=>g.id===Je);if(!c){nt();return}if(!t){I("Add a reminder title");return}let f=null;if(n||r){let g=n||kt();f=Pn(g,r||"09:00")}else{let g=Rt(t);g.time&&(f=new Date(`${g.date}T${g.time}:00`).toISOString())}c.title=t;let h=Jt();c.priority=h,pt(h),L&&(c.category=X(L.value)),c.due=f,D&&(c.notes=D.value.trim()),c.updatedAt=Date.now(),te(c),tt(c),Ne=!0,Y(),Fe(c),Q(),Ye(),Ee("memoryCue:remindersUpdated",{items:u}),Fn(),ue({action:"updated",label:`Reminder updated \xB7 ${c.title}`}),nt(),I("Reminder updated"),Ee("cue:close",{reason:"updated"});return}if(!t){I("Add a reminder title");return}let a=D?D.value.trim():"",d=null;if(n||r){let c=n||kt();d=Pn(c,r||"09:00")}else{let c=Rt(t);c.time&&(d=new Date(`${c.date}T${c.time}:00`).toISOString())}pr({title:t,priority:Jt(),category:L?L.value:"",due:d,notes:a}),l&&(l.value=""),T&&(T.value=""),D&&(D.value=""),Ee("cue:close",{reason:"created"})}l?.addEventListener("keydown",e=>{e.key==="Enter"&&qn()});function vr(){if(!l||!xe)return;let e=l.value.trim();if(!e){xe.style.display="none";return}try{let t=Rt(e),n=kt();if(t.date!==n||t.time){let r="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");r+=`\u{1F4C5} ${$n(t.date)}`}t.time&&(r+=`${r?" ":""}\u{1F550} ${t.time}`),r?(xe.textContent=`Parsed: ${r}`,xe.style.display="block"):xe.style.display="none"}else xe.style.display="none"}catch{xe.style.display="none"}}return l?.addEventListener("input",dr(vr,300)),Z?.addEventListener("click",()=>{nt(),I("Edit cancelled"),Ee("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{nt()}),document.addEventListener("cue:prepare",()=>{nt()}),window.addEventListener("load",()=>l?.focus()),Ti?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?$n(t.due.slice(0,10)):"",r=t.due?new Date(t.due).toLocaleTimeString(_e,{hour:"2-digit",minute:"2-digit",timeZone:he}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${r}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){I("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>I("Copied for Master Task List")).catch(()=>I("Copy failed")),pe()}),zt?.addEventListener("change",()=>{let e=zt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),r=[];n.forEach(d=>{let c={...d,id:Nt(),category:X(d.category),pendingSync:!J,orderIndex:null};an(c,{position:"start"}),u=[c,...u],r.push(c)}),ce(u);let a=Ze(u);Y(),Q(),a?u.forEach(d=>te(d)):r.forEach(d=>te(d)),I("Import successful")}catch{I("Invalid JSON")}},t.readAsText(e),zt.value="",pe()}),Li?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),pe()}),Ci?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){I("Add your Apps Script URL in Settings first"),pe();return}if(!u.length){I("No tasks to sync"),pe();return}I("Syncing all tasks\u2026");let t=20,n=0;for(let r=0;r<u.length;r+=t){let a=u.slice(r,r+t),d=await Promise.allSettled(a.map(c=>{let f={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||K,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=d.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}I(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),pe()}),Be&&(Be.value=localStorage.getItem("syncUrl")||""),Di?.addEventListener("click",()=>{Be&&(localStorage.setItem("syncUrl",Be.value.trim()),I("Settings saved"))}),xi?.addEventListener("click",async()=>{if(!Be)return;let e=Be.value.trim();if(!e){I("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});I(t.ok?"Test ok":"Test failed")}catch{I("Test failed")}}),Ii?.addEventListener("click",async()=>{if(!("Notification"in window)){I("Notifications not supported");return}if(Notification.permission==="granted"){I("Notifications enabled"),we()?De():(jt(),Yn()),Te(),Y();return}try{await Notification.requestPermission()==="granted"?(I("Notifications enabled"),we()?De():(jt(),Yn()),Te(),Y()):I("Notifications blocked")}catch{I("Notifications blocked")}}),Vi(),Te(),Y(),Q(),{cancelReminder:Ot,scheduleReminder:Fe,closeActiveNotifications:mi,getActiveNotifications:()=>be,addNoteToReminder:mr,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:X(t?.category)})):[],u=Qe(u),ce(u),Y()},render:Y,getItems:()=>u.map(e=>({...e}))}}}var di,be,li,hn,bn,ui,$t,lt,wn,K,Nr,Sn,me,kr,ge,Or=Pt(()=>{ri();di="memoryCue:activity",be=new Map,li=!1,hn="service-worker.js",bn="memory-cue-reminder-sync",ui=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),$t=null,lt=null,wn=!1,K="General",Nr=Object.freeze([K,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Sn="memoryCue:offlineReminders",me=1024,kr=Object.freeze({}),ge=null});var yi,Mr,Vt,In,hi,bi,Ht,wi,Yt,Wt,gi,_r,Si,Gt,vi=Pt(()=>{yi="memoryCueNotes",Mr=["mobileNotes"],Vt=()=>typeof localStorage<"u",In=null,hi=i=>{In=typeof i=="function"?i:null},bi=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Ht=i=>{if(typeof i!="string")return"";let o=i.trim();if(!o.length)return"";if(!/[<>]/.test(o))return i;try{if(typeof document<"u"){let s=document.createElement("div");return s.innerHTML=o,(typeof s.innerText=="string"&&s.innerText.length?s.innerText:s.textContent||"").replace(/\r?\n/g,`
`)}}catch{}return o.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},wi=i=>{if(typeof i!="string")return!1;let o=Date.parse(i);return!Number.isNaN(o)},Yt=(i,o,s={})=>{let l=typeof i=="string"?i.trim():"";return{id:s.id&&typeof s.id=="string"?s.id:bi(),title:l||"Untitled note",body:typeof o=="string"?Ht(o):"",updatedAt:s.updatedAt&&wi(s.updatedAt)?s.updatedAt:new Date().toISOString()}},Wt=i=>{if(Array.isArray(i))return i.map(o=>{if(!o||typeof o!="object")return null;let s=typeof o.title=="string"?o.title.trim():"",l=typeof o.body=="string"?Ht(o.body):"",S=typeof o.id=="string"&&o.id.trim()?o.id:bi(),T=wi(o.updatedAt)?o.updatedAt:new Date().toISOString();return!s&&!l?null:{id:S,title:s||"Untitled note",body:l,updatedAt:T}}).filter(Boolean);if(i&&typeof i=="object"){let o=typeof i.title=="string"?i.title:"",s=typeof i.body=="string"?Ht(i.body):"";return!o&&!s?[]:[Yt(o,s,{id:typeof i.id=="string"?i.id:void 0,updatedAt:typeof i.updatedAt=="string"?i.updatedAt:void 0})]}return typeof i=="string"&&i.trim().length?[Yt("Notebook (legacy)",Ht(i))]:[]},gi=i=>{if(!Vt())return null;try{return localStorage.getItem(i)}catch{return null}},_r=i=>{if(Vt())try{localStorage.removeItem(i)}catch{}},Si=()=>{if(!Vt())return[];let i=gi(yi);if(typeof i=="string")try{let o=JSON.parse(i),s=Wt(o);if(s.length)return s}catch{let o=Wt(i);if(o.length)return Gt(o),o}for(let o of Mr){let s=gi(o);if(typeof s=="string"&&s.trim().length){let l=Wt(s);if(l.length)return Gt(l),_r(o),l}}return[]},Gt=(i,o={})=>{if(!Vt()||!Array.isArray(i))return!1;let s=i.map(l=>Wt([l])[0]).filter(Boolean);try{if(localStorage.setItem(yi,JSON.stringify(s)),!o.skipRemoteSync&&typeof In=="function")try{let l=In(s);l&&typeof l.then=="function"&&l.catch(S=>{console.error("[notes-storage] Remote sync failed.",S)})}catch(l){console.error("[notes-storage] Remote sync handler threw.",l)}return!0}catch{return!1}}});var Pr,Ur,$r,qt,jr,Hr,ao,Wr=Pt(()=>{Qn();vi();Pr="notes",Ur="user_id",$r="updated_at",qt=i=>{if(typeof i!="string")return 0;let o=Date.parse(i);return Number.isNaN(o)?0:o},jr=(i=[],o=[])=>{let s=new Map;return o.forEach(l=>{l&&typeof l.id=="string"&&s.set(l.id,l)}),i.forEach(l=>{if(!l||typeof l.id!="string")return;let S=s.get(l.id);if(!S){s.set(l.id,l);return}let T=qt(l.updatedAt),D=qt(S.updatedAt);T>D&&s.set(l.id,l)}),Array.from(s.values()).sort((l,S)=>qt(S?.updatedAt)-qt(l?.updatedAt))},Hr=i=>o=>{if(!o||typeof o!="object")return null;let s={id:typeof o.id=="string"&&o.id?o.id:void 0,updatedAt:typeof o[i]=="string"?o[i]:void 0};return Yt(o.title,o.body,s)},ao=(i={})=>{let{tableName:o=Pr,userColumn:s=Ur,updatedAtColumn:l=$r,supabase:S=null}=i,T=S||null,D=null,H=!1,L=new Set,V=()=>T||(T=Ue(),T),Z=Hr(l),E=async A=>{let k=V();if(!k||!D)return;let Se=(Array.isArray(A)?A.filter(M=>M&&typeof M.id=="string"):[]).map(M=>({id:M.id,[s]:D,title:M.title,body:M.body,[l]:typeof M.updatedAt=="string"&&M.updatedAt?M.updatedAt:new Date().toISOString()})),W=new Set(Se.map(M=>M.id));if(Se.length){let{error:M}=await k.from(o).upsert(Se);if(M)throw M}let ie=[...L].filter(M=>M&&!W.has(M));if(ie.length){let{error:M}=await k.from(o).delete().in("id",ie).eq(s,D);if(M)throw M}L=new Set(W)},ee=async()=>{let A=V();if(!(!A||!D))try{let{data:k,error:$e}=await A.from(o).select(`id,title,body,${l}`).eq(s,D);if($e)throw $e;let Se=Array.isArray(k)?k:[];L=new Set(Se.map($=>typeof $.id=="string"?$.id:null).filter(Boolean));let W=Se.map(Z).filter(Boolean),ie=Si();if(!W.length){if(ie.length)try{await E(ie)}catch($){console.error("[notes-sync] Failed to upload local notes to Supabase.",$)}return}let M=jr(ie,W);H=!0;let je=Gt(M,{skipRemoteSync:!0});H=!1,je||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await E(M)}catch($){console.error("[notes-sync] Failed to reconcile notes with Supabase.",$)}}catch(k){console.error("[notes-sync] Failed to fetch notes from Supabase.",k)}finally{H=!1}};return hi(async A=>{if(!H)try{await E(A)}catch(k){console.error("[notes-sync] Failed to sync notes to Supabase.",k)}}),{setSupabaseClient(A){A&&(T=A)},handleSessionChange:async A=>{if(D=typeof A?.id=="string"?A.id:null,!D){L=new Set;return}await ee()},syncFromRemote:ee}}});export{Kr as a,ri as b,eo as c,Or as d,Yt as e,Si as f,Gt as g,vi as h,ao as i,Wr as j};
