import{b as Qe,c as Tr}from"./chunk-KX65DZXT.js";import{a as Ir,b as Qt,c as co}from"./chunk-GUVSRPRW.js";function Lr(r={}){try{Object.assign(H,r||{})}catch(o){console.warn("[supabase-auth] setAuthContext failed",o)}}async function Cr(r={}){try{if(H&&typeof H.signInWithPopup=="function"&&H.auth&&typeof H.GoogleAuthProvider=="function")return H.signInWithPopup(H.auth,new H.GoogleAuthProvider);if(H&&typeof H.signInWithRedirect=="function"&&H.auth&&typeof H.GoogleAuthProvider=="function")return H.signInWithRedirect(H.auth,new H.GoogleAuthProvider);let o=Qe();if(o&&o.auth){if(typeof o.auth.signInWithOAuth=="function")return o.auth.signInWithOAuth({provider:"google",...r});if(typeof o.auth.signIn=="function")return o.auth.signIn({provider:"google"})}}catch(o){console.error("[supabase-auth] startSignInFlow error",o);try{H?.toast?.("Sign-in failed")}catch(s){console.warn("[supabase-auth] toast handler failed",s)}throw o}return Promise.resolve(null)}async function xr(){try{if(H&&typeof H.signOut=="function")return H.signOut(H.auth);let r=Qe();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function uo(r){return r?Array.isArray(r)?r:[r]:[]}function vt(r){return Array.from(new Set(r.filter(o=>o instanceof HTMLElement||typeof SVGElement<"u"&&o instanceof SVGElement)))}function me(r,o){let s=uo(o).filter(Boolean);if(!s.length)return[];let c=s.flatMap(v=>Array.from(r.querySelectorAll(v)));return vt(c)}function fo(r,o=document){let s=o instanceof Document||o instanceof HTMLElement?o:document;return{authForms:me(s,r.authForm),emailInputs:me(s,r.emailInput),signInButtons:me(s,r.signInButtons),signOutButtons:me(s,r.signOutButtons),userBadges:me(s,r.userBadge),userBadgeEmails:me(s,r.userBadgeEmail),userBadgeInitials:me(s,r.userBadgeInitial),userNameEls:me(s,r.userName),syncStatusEls:me(s,r.syncStatus),syncStatusTextEls:me(s,r.syncStatusText),statusIndicatorEls:me(s,r.statusIndicator),feedbackEls:me(s,r.feedback)}}function bt(r,o){vt(Array.isArray(r)?r:[r]).forEach(s=>{s instanceof HTMLElement&&(s.classList.toggle("hidden",!o),o?s.removeAttribute("hidden"):s.setAttribute("hidden",""))})}function Oe(r,o){vt(Array.isArray(r)?r:[r]).forEach(s=>{s instanceof HTMLElement&&(s.textContent=o||"")})}function po(r,o){vt(r).forEach(s=>{s instanceof HTMLElement&&(s.dataset.state=o,s.classList.toggle("online",o==="online"),s.classList.toggle("offline",o!=="online"))})}function St(r,o){vt(r).forEach(s=>{if(!(s instanceof HTMLElement))return;s.textContent=o||"";let c=!!o;s.classList.toggle("hidden",!c),c?s.removeAttribute("hidden"):s.setAttribute("hidden","")})}function Dr(r={}){let o={...Ar.syncStatusText,...r.syncStatusText||{}};return{...Ar,...r,syncStatusText:o}}function wt(r,{user:o,messages:s}={}){let c=Dr(s),v=!!o;bt(r.signInButtons,!v),bt(r.authForms,!v),bt(r.signOutButtons,v),bt(r.userBadges,v);let T=typeof o?.email=="string"?o.email:"",A=T?T.charAt(0).toUpperCase():"U";v?(Oe(r.userBadgeEmails,T),Oe(r.userBadgeInitials,A),Oe(r.userNameEls,T)):(Oe(r.userBadgeEmails,""),Oe(r.userBadgeInitials,""),Oe(r.userNameEls,""));let Y=typeof c.signedIn=="function"?c.signedIn(o):c.signedIn,L=typeof c.signedOut=="function"?c.signedOut(o):c.signedOut,X=v?Y:L,ne=!v;r.syncStatusEls.length&&(Oe(r.syncStatusEls,X),r.syncStatusEls.forEach(re=>{re instanceof HTMLElement&&(re.classList.toggle("online",v),re.dataset.state=v?"online":"offline")}),bt(r.syncStatusEls,ne));let S=v?c.syncStatusText?.signedIn:c.syncStatusText?.signedOut;Oe(r.syncStatusTextEls,S||""),po(r.statusIndicatorEls,v?"online":"offline"),St(r.feedbackEls,"")}function mo(r,o){o.authForms.forEach(s=>{!(s instanceof HTMLFormElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("submit",async c=>{c.preventDefault();let v=o.emailInputs.find(A=>s.contains(A))||s.querySelector('input[type="email"]'),T=typeof v?.value=="string"?v.value.trim():"";if(!T){St(o.feedbackEls,"Enter an email address to continue.");return}try{let{error:A}=await r.auth.signInWithOtp({email:T});A?St(o.feedbackEls,A.message||"Unable to send magic link."):St(o.feedbackEls,"Magic link sent. Check your email.")}catch(A){St(o.feedbackEls,A?.message||"Unable to send magic link.")}}))})}function go(r,o){o.signOutButtons.forEach(s=>{!(s instanceof HTMLElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(c){console.error("[supabase] Sign-out failed.",c)}}))})}function _o(r={}){let{supabase:o,scope:s=document,selectors:c={},messages:v={},disableButtonBinding:T=!1,onSessionChange:A}=r,Y={...lo,...c},L=fo(Y,s),X=Dr(v);wt(L,{user:null,messages:X});let ne=o||Qe()||(typeof window<"u"?window.supabase:null);if(!ne)return{supabase:null,elements:L,applyAuthState:Z=>wt(L,{...Z,messages:X}),destroy(){}};mo(ne,L),T||go(ne,L);let S=[],{data:re}=ne.auth.onAuthStateChange((Z,P)=>{if(wt(L,{user:P?.user??null,messages:X}),typeof A=="function")try{A(P?.user??null,P)}catch(q){console.error("[supabase] onSessionChange handler failed.",q)}});return re?.subscription&&S.push(()=>{try{re.subscription.unsubscribe()}catch{}}),ne.auth.getSession().then(({data:Z,error:P})=>{P||wt(L,{user:Z?.session?.user??null,messages:X})}).catch(Z=>{console.error("[supabase] getSession failed.",Z)}),{supabase:ne,elements:L,applyAuthState:Z=>wt(L,{...Z,messages:X}),destroy(){S.forEach(Z=>{try{Z()}catch{}})}}}var H,lo,Ar,Nr=Qt(()=>{Tr();H={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};lo={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},Ar={signedOut:"",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Br=co((Uo,Et)=>{var Zt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function kr(r){if(!r||typeof r!="object")return null;let o=Object.entries(r).filter(([s,c])=>typeof c=="string"&&c.trim()!=="");return o.length?Object.fromEntries(o):null}function yo(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},o=kr(r?.__FIREBASE_CONFIG);if(o)return o;let s=kr(r?.__ENV?.FIREBASE_CONFIG);if(s)return s;let v=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((T,[A,Y])=>{let L=r?.__ENV?.[A]??r?.[A];return typeof L=="string"&&L.trim()!==""&&(T[Y]=L),T},{});return Object.keys(v).length?v:null}function Fr(){let r=yo();return r?{...Zt,...r}:{...Zt}}var Rr={DEFAULT_FIREBASE_CONFIG:Zt,getFirebaseConfig:Fr};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=Fr,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Zt}typeof Et<"u"&&Et.exports&&(Et.exports=Rr,Et.exports.default=Rr)});function wo(){if(Ae)return{...Ae};let o=Yn()?.memoryCueFirebase;if(o&&typeof o.getFirebaseConfig=="function")return Ae=o.getFirebaseConfig(),{...Ae};if(typeof Ir=="function")try{let s=Br();if(s){let c=typeof s.getFirebaseConfig=="function"?s.getFirebaseConfig:typeof s.default?.getFirebaseConfig=="function"?s.default.getFirebaseConfig:null;if(c)return Ae=c(),{...Ae}}}catch{}return o&&o.DEFAULT_FIREBASE_CONFIG?(Ae={...o.DEFAULT_FIREBASE_CONFIG},{...Ae}):(Ae={...bo},{...Ae})}function Yn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Ur(){let r=Yn(),o=r&&r.TimestampTrigger;return typeof o=="function"?o:null}function De(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Ur()}function So(){if(typeof window>"u"||!window.location)return Pn;try{return new URL(Pn,window.location.href).href}catch{return Pn}}async function _e(){return en||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(en=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(So()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),en))}async function Pr(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let o=await _e();if(!o)return!1;let s=new Set;navigator.serviceWorker.controller&&s.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(v=>{let T=o[v];T&&s.add(T)});let c=!1;return s.forEach(v=>{try{v.postMessage(r),c=!0}catch(T){console.warn("Failed posting message to service worker",T)}}),c}catch(o){return console.warn("Unable to reach service worker",o),!1}}async function tn(){if(De())return!1;if($n)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(It)try{return await It}catch{}It=(async()=>{let r=await _e();if(!r)return!1;let o=!1;if("periodicSync"in r)try{let s=await r.periodicSync.getTags();(!Array.isArray(s)||!s.includes(Un))&&await r.periodicSync.register(Un,{minInterval:15*60*1e3}),o=!0}catch(s){console.warn("Periodic background sync unavailable",s)}if(!o&&"sync"in r)try{await r.sync.register(Un),o=!0}catch(s){console.warn("Background sync unavailable",s)}return o})();try{let r=await It;return r&&($n=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),$n=!1,!1}finally{It=null}}async function jn(r=[],{requestCheck:o=!1}={}){if(!De()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let s=await _e();if(!s)return;let c=await Pr({type:_r.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(o&&await Pr({type:_r.checkScheduledReminders}),!c&&typeof s.update=="function")try{await s.update()}catch{}}catch(s){console.warn("Failed syncing reminders with service worker",s)}}async function Wn(r,o){if(De())try{let s=o||await _e();if(!s)return;let c=[];try{c=await s.getNotifications({tag:r,includeTriggered:!0})}catch{c=await s.getNotifications({tag:r})}for(let v of c)try{v.close()}catch{}}catch{}}function $r(){for(let r of Array.from(xe.values()))try{r.close()}catch{}xe.clear()}function vo(){if(Or||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>$r();["pagehide","beforeunload"].forEach(o=>{try{window.addEventListener(o,r)}catch{}}),Or=!0}function Q(r){if(typeof r=="string"){let o=r.replace(/\s+/g," ").trim();if(o)return o}return z}async function Ho(r={}){let o=e=>e?document.querySelector(e):null,s=e=>e?Array.from(document.querySelectorAll(e)):[],c=o(r.titleSel),v=o(r.dateSel),T=o(r.timeSel),A=o(r.detailsSel),Y=o(r.prioritySel),L=o(r.categorySel),X=o(r.saveBtnSel),ne=o(r.cancelEditBtnSel),S=o(r.listSel);S&&S.addEventListener("change",Ji);let re=o(r.detailPanelSel),Z=o(r.detailEmptySel),P=o(r.detailContentSel),q=o(r.detailTitleSel),Ne=o(r.detailDueSel),ge=o(r.detailPrioritySel),be=o(r.detailCategorySel),K=o(r.detailNotesSel),O=K?.dataset?.placeholder||"No notes added yet.",cn=o(r.detailClearSel),ye=s(r.googleSignInBtnSel),Tt=s(r.googleSignOutBtnSel),U=o(r.statusSel),G=o(r.syncStatusSel),zr={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Xr=6e3,fe=null,At=null;function We(e,{clearMessage:t=!0}={}){fe&&(e&&fe.tokenId!==e||(fe.timeoutId&&clearTimeout(fe.timeoutId),t&&U&&U.dataset.undoToken===fe.tokenId&&(typeof U.replaceChildren=="function"?U.replaceChildren():U.textContent="",delete U.dataset.undoToken,delete U.dataset.statusKind),fe=null))}function Kr(e){if(!U)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Qi(e.tokenId)),e.button=i,typeof U.replaceChildren=="function"?U.replaceChildren(t,n,i):(U.textContent="",U.append(t,n,i)),U.dataset.statusKind="undo",U.dataset.undoToken=e.tokenId}function Ze(e){if(!re)return;let t=!!e;if(re.dataset.state=t?"active":"empty",re.dataset.selectedId=t&&e?.id?e.id:"",Z&&(Z.classList.toggle("hidden",t),Z.setAttribute("aria-hidden",t?"true":"false")),P&&(P.classList.toggle("hidden",!t),P.setAttribute("aria-hidden",t?"false":"true")),!t){q&&(q.textContent=""),Ne&&(Ne.textContent=""),ge&&(ge.textContent=""),be&&(be.textContent=""),K&&(K.textContent=O,K.dataset.empty="true");return}if(q&&(q.textContent=e.title||"Untitled reminder"),Ne&&(Ne.textContent=yr(e)),ge&&(ge.textContent=e.priority||"Medium"),be&&(be.textContent=e.category||z),K){let n=typeof e.notes=="string"?e.notes.trim():"";n?(K.textContent=n,K.dataset.empty="false"):(K.textContent=O,K.dataset.empty="true")}}function Gn(){At=null,Ze(null)}function Jr(e){At=e?.id||null,Ze(e||null)}function Qr(){if(!re)return;if(!At){Ze(null);return}let e=u.find(t=>t?.id===At);if(e){Ze(e);return}Gn()}Ze(null);function ln(e,t){if(!G)return;let n=["online","offline","error"];n.forEach(d=>G.classList.remove(d)),n.includes(e)&&G.classList.add(e),G.dataset.state=e;let i=typeof t=="string"?t:zr[e]||"";e==="online"||e==="offline"?(G.textContent="",G.dataset.compact="true",i?(G.setAttribute("aria-label",i),G.setAttribute("title",i)):(G.removeAttribute("aria-label"),G.removeAttribute("title"))):(G.textContent=i,G.removeAttribute("data-compact"),i?(G.setAttribute("aria-label",i),G.setAttribute("title",i)):(G.removeAttribute("aria-label"),G.removeAttribute("title")))}let ie=o(r.notesSel),Zr=o(r.saveNotesBtnSel),ei=o(r.loadNotesBtnSel),Vn=o(r.countTotalSel),Lt=o(r.googleUserNameSel),Pe=o(r.dateFeedbackSel),se=o(r.voiceBtnSel),ti=o(r.notifBtnSel),et=o(r.moreBtnSel),tt=o(r.moreMenuSel),ni=o(r.copyMtlBtnSel),un=o(r.importFileSel),ri=o(r.exportBtnSel),ii=o(r.syncAllBtnSel),Ye=o(r.syncUrlInputSel),oi=o(r.saveSettingsSel),ai=o(r.testSyncSel),si=s(r.openSettingsSel),Ct=o(r.settingsSectionSel),qe=o(r.emptyStateSel),zn=o(r.listWrapperSel),fn=o(r.categoryOptionsSel),oe=o(r.plannerContextSel),j=o(r.plannerLessonInputSel),de=r.variant||"mobile",di=typeof r.autoWireAuthButtons=="boolean"?r.autoWireAuthButtons:de!=="desktop",nt="all",pn=[],mn="";function ci(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function Ge(){if(de!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=ci(),n;nt==="today"?n=`Today\u2019s reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,mn&&(n+=` \u2022 ${mn}`),e.textContent=n}function li(){de==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(a=>{if(!a.ok)throw new Error("Weather request failed");return a.json()}).then(a=>{a&&a.current_weather&&typeof a.current_weather.temperature=="number"&&(mn=`${Math.round(a.current_weather.temperature)}\xB0C`,Ge())}).catch(a=>{console.warn("Failed to fetch current temperature",a)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let Xn="mc:lastDefaults",gn=()=>{oe&&(oe.classList.add("hidden"),oe.setAttribute("aria-hidden","true"),typeof oe.replaceChildren=="function"?oe.replaceChildren():oe.textContent=""),j&&(j.value="",j.dataset&&(delete j.dataset.lessonDayLabel,delete j.dataset.lessonTitle,delete j.dataset.lessonSummary))},ui=(e={})=>{if(!oe)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",a=document.createElement("p");a.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",a.textContent=t?`${t} lesson`:"Planner lesson";let d=document.createElement("p");d.className="text-sm font-semibold text-base-content",d.textContent=n||i||"Planner reminder";let l=i?document.createElement("p"):null;l&&(l.className="text-sm text-base-content/70",l.textContent=i),typeof oe.replaceChildren=="function"?oe.replaceChildren(...[a,d,l].filter(Boolean)):(oe.textContent="",oe.append(a,d),l&&oe.append(l)),oe.classList.remove("hidden"),oe.removeAttribute("aria-hidden")},fi=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";c&&typeof e.reminderTitle=="string"&&(c.value=e.reminderTitle),A&&typeof e.reminderNotes=="string"&&(A.value=e.reminderNotes),v&&typeof e.dueDate=="string"&&(v.value=e.dueDate),j&&(j.value=t,j.dataset&&(j.dataset.lessonDayLabel=dayLabel,j.dataset.lessonTitle=lessonTitle,j.dataset.lessonSummary=summary)),ui(e)};function yn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Xn)||"{}")||{}}catch{return{}}}function pi(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Xn,JSON.stringify(e))}catch{}}function Kn(e){let t=yn(),n={category:Q(e?.category||t.category||z),priority:e?.priority||t.priority||"Medium"};pi(n)}let Jn='fieldset#priorityChips input[name="priority"]';function hn(){try{let e=document.querySelector(`${Jn}:checked`);if(e&&e.value)return e.value}catch{}return Y&&typeof Y.value=="string"&&Y.value?Y.value:"Medium"}function xt(e){let t=e||"Medium";Y&&typeof Y.value<"u"&&(Y.value=t);try{let n=Array.from(document.querySelectorAll(Jn));if(!n.length)return;let i=!1;if(n.forEach(a=>{let d=a.value===t;a.checked=d,i=i||d}),!i){let a=n.find(d=>d.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function Qn(){let e=yn();e.category&&L&&(L.value=e.category),e.priority&&xt(e.priority)}Qn();let ce=typeof document<"u"?document.getElementById("quickAddInput"):null,mi=typeof document<"u"?document.getElementById("quickAddSubmit"):null,le=typeof document<"u"?document.getElementById("quickAddVoice"):null,bn=null;function gi(e,t){let n=Date.now(),i=yn(),a=typeof t=="string"&&t?t:null;return{id:qt(),title:(e||"").trim(),priority:i.priority||hn(),category:Q(i.category||L?.value||z),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!ee,pinToToday:!1}}async function wn(){if(!ce)return;if(typeof bn=="function")try{bn()}catch{}let e=(ce.value||"").trim();if(!e)return;let t=null;try{let a=zt(e);a&&a.time&&(t=new Date(`${a.date}T${a.time}:00`).toISOString())}catch{t=null}let n=gi(e,t);An(n,{position:"start"}),u.unshift(n),pe(u);let i=lt(u);Ue=!0,$(),J(),i?u.forEach(a=>te(a)):te(n),ft(n),je(n),Fe(),Kn(n),Ve();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}if(Se({action:"created",label:`Reminder added \xB7 ${n.title}`}),ce.value="",typeof document<"u")try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:n}}))}catch{}}typeof window<"u"&&(window.memoryCueQuickAddNow=wn),mi?.addEventListener("click",()=>{wn()}),ce?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),wn())});function yi(){if(typeof HTMLElement>"u"||!(le instanceof HTMLElement)||!(ce instanceof HTMLInputElement)||le.dataset.voiceBound==="true")return;if(le.dataset.voiceBound="true",typeof window>"u"){le.setAttribute("disabled","true"),le.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){le.setAttribute("disabled","true"),le.setAttribute("aria-disabled","true"),le.getAttribute("title")||(le.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=l=>{n=l,le.setAttribute("aria-pressed",l?"true":"false"),le.dataset.listening=l?"true":"false",le.classList.toggle("is-listening",l)},a=()=>{if(t)return t;t=new e;let l=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=l,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",y=>{let p=y?.results?.[0]?.[0]?.transcript?.trim()||"";if(p){ce.value=p;try{ce.focus({preventScroll:!0})}catch{ce.focus()}try{let b=ce.value.length;typeof ce.setSelectionRange=="function"&&ce.setSelectionRange(b,b)}catch{}}});let f=()=>{i(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},d=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};bn=d,le.addEventListener("click",()=>{let l=a();if(l){if(n){d();return}try{l.start(),i(!0)}catch(f){console.warn("Quick add voice error:",f),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",d),i(!1)}yi(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&ce&&(e.preventDefault(),ce.focus())})));try{de==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let hi=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Zn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,bi=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Dt=r.reminderLandingPath||(de==="desktop"?"index.html#reminders":"mobile.html"),we=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function er(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ve(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}L&&!L.value&&(L.value=z),De()&&_e();function Se(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Mr,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(Mr,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function wi(){if(typeof HTMLElement>"u"||!(se instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&c instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&c instanceof HTMLTextAreaElement;if(!e&&!t||se.dataset.voiceBound==="true")return;if(se.dataset.voiceBound="true",typeof window>"u"){se.setAttribute("disabled","true"),se.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){se.setAttribute("disabled","true"),se.setAttribute("aria-disabled","true"),se.getAttribute("title")||(se.title="Voice input is not supported in this browser.");return}let i=null,a=!1,d=p=>{a=p,se.setAttribute("aria-pressed",p?"true":"false"),se.dataset.listening=p?"true":"false",se.classList.toggle("is-listening",p)},l=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",b=>{let D=b.results?.[0]?.[0]?.transcript?.trim()||"";if(D){c.value=D;try{c.focus({preventScroll:!0})}catch{try{c.focus()}catch{}}try{let C=c.value.length;typeof c.setSelectionRange=="function"&&c.setSelectionRange(C,C)}catch{}Se({action:"dictated",label:`Voice input captured \xB7 ${D}`})}});let p=()=>{d(!1)};return i.addEventListener("end",p),i.addEventListener("error",p),i},f=()=>{if(!(!a||!i)){try{i.stop()}catch{}d(!1)}};se.addEventListener("click",()=>{let p=l();if(p){if(a){f();return}try{p.start(),d(!0)}catch(b){console.warn("Speech recognition error:",b),d(!1)}}});let y=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",y),document.addEventListener("reminders:updated",y)),d(!1)}vo(),wi();let Nt,kt,Rt,Ft,ze,Bt,Mt,Ot,_t,Pt,Ut,rt,it,$t,Ht,Sn,vn,jt,En,tr=r.firebaseDeps,In=typeof r.importModule=="function"?r.importModule:e=>import(e),ot=Yn(),at=!1,ve=!1,Tn=null,Le=null,st=null,u=[],Ue=!1,ee=null,dt=null,Xe=null,$e={},V={};function pe(e=u){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,a=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===a?sr(t||{},n||{}):a-i})}function Si(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let a=Number.isFinite(i?.orderIndex)?i.orderIndex:null;a!=null&&(a<t&&(t=a),a>n&&(n=a))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function ct(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),pe(n);else{n=e.slice().sort(sr);let i=n.length;n.forEach((a,d)=>{a.orderIndex=(i-d)*Te})}return e===u&&(u=n),n}function An(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Si();if(t==="end"){let a=Number.isFinite(n)?n:0;e.orderIndex=a-Te||Te}else{let a=Number.isFinite(i)?i:0;e.orderIndex=a+Te||Te}}function lt(e=u){if(!Array.isArray(e)||e.length<2)return!1;pe(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],a=e[n],d=Number.isFinite(i?.orderIndex)?i.orderIndex:null,l=Number.isFinite(a?.orderIndex)?a.orderIndex:null;if(d==null||l==null||d<=l||d-l<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Te;return e===u&&pe(u),!0}let k={draggingId:null,dropTargetId:null,dropBefore:!0},nr=!1,g={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function vi(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function ut(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function ke(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function Ln(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),ke(),k.draggingId=null,k.dropTargetId=null,k.dropBefore=!0}function rr(e,t,n){if(!e||e===t)return;let i=u.findIndex(C=>C?.id===e);if(i<0)return;let[a]=u.splice(i,1),d;if(!t)d=u.length;else{let C=u.findIndex(W=>W?.id===t);if(C<0){u.splice(i,0,a);return}d=n?C:C+1}u.splice(d,0,a);let l=u[d-1],f=u[d+1],y=Number.isFinite(l?.orderIndex)?l.orderIndex:null,p=Number.isFinite(f?.orderIndex)?f.orderIndex:null,b;y!=null&&p!=null?b=(y+p)/2:y!=null?b=y-Te:p!=null?b=p+Te:b=Te,Number.isFinite(b)||(b=Te*(u.length+1)),a.orderIndex=b,pe(u);let D=lt(u);Ue=!0,$(),J(),D?u.forEach(C=>te(C)):te(a),Ve(),we("memoryCue:remindersUpdated",{items:u}),Se({action:"reordered",label:"Reminders reordered"})}function Ei(e){let t=ut(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(k.draggingId=i,k.dropTargetId=null,k.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Ii(e){if(!k.draggingId)return;let t=ut(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),k.dropTargetId=null,k.dropBefore=!1,ke(),S?.classList.add("drag-over-list");return}if(t.dataset.id===k.draggingId){e.preventDefault(),ke();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,a=e.clientY<i;(k.dropTargetId!==t.dataset.id||k.dropBefore!==a)&&(ke(),t.classList.add(a?"drag-over-before":"drag-over-after"),k.dropTargetId=t.dataset.id,k.dropBefore=a)}function Ti(e){let t=ut(e.target);if(!t){S?.contains(e.relatedTarget)||ke();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function Ai(e){if(!k.draggingId)return;e.preventDefault();let t=ut(e.target),n=t?.dataset.id||null,i=k.dropBefore;if(t){let a=t.getBoundingClientRect(),d=a.top+a.height/2;i=e.clientY<d}else n=null,i=!1;rr(k.draggingId,n,i),Ln()}function Li(){Ln()}function Ci(){!S||nr||(nr=!0,S.addEventListener("dragstart",Ei),S.addEventListener("dragover",Ii),S.addEventListener("drop",Ai),S.addEventListener("dragend",Li),S.addEventListener("dragleave",Ti),Wt())}function Wt(){if(!S||Wt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Wt._bound=!0;return}let t=6,n=160;function i(){g.longPressTimer&&(clearTimeout(g.longPressTimer),g.longPressTimer=null)}function a(){S&&(g.initialTouchAction!=null?S.style.touchAction=g.initialTouchAction:S.style.removeProperty("touch-action"))}function d({keepHighlights:E=!1}={}){if(i(),g.item&&g.pointerId!=null)try{g.item.hasPointerCapture?.(g.pointerId)&&g.item.releasePointerCapture(g.pointerId)}catch{}if(g.placeholder?.parentNode)try{g.placeholder.parentNode.removeChild(g.placeholder)}catch{}g.item&&(g.item.classList.remove("is-dragging"),g.originalStyles?g.item.setAttribute("style",g.originalStyles):g.item.removeAttribute("style")),a(),E||ke(),Object.assign(g,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function l(E){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(h=>h!==E):[]}function f(E){let h=g.item;if(!h||g.ready)return;let N=h.getBoundingClientRect(),_=window.getComputedStyle(h);g.ready=!0,k.draggingId=h.dataset.id||null,g.offsetY=E.clientY-N.top,g.fixedX=N.left;let R=document.createElement("div");R.className="touch-drag-placeholder",R.setAttribute("aria-hidden","true"),R.style.height=`${N.height}px`,R.style.boxSizing="border-box",R.style.marginTop=_.marginTop,R.style.marginBottom=_.marginBottom,R.style.marginLeft=_.marginLeft,R.style.marginRight=_.marginRight,R.style.borderRadius=_.borderRadius,R.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",R.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",R.style.pointerEvents="none",R.style.display="block",R.style.width="100%",h.parentNode?.insertBefore(R,h),g.placeholder=R,g.longPressTimer=null,g.originalStyles=h.getAttribute("style")||"",h.classList.add("is-dragging"),h.style.position="fixed",h.style.left=`${N.left}px`,h.style.top=`${N.top}px`,h.style.width=`${N.width}px`,h.style.zIndex="999",h.style.pointerEvents="none",h.style.touchAction="none",g.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function y(E){let h=g.item;if(!h||!g.ready)return;let N=E-g.offsetY;h.style.top=`${N}px`,h.style.left=`${g.fixedX}px`}function p(E){if(!g.ready||!S)return;let h=g.item,N=l(h);if(ke(),!N.length){k.dropTargetId=null,k.dropBefore=!1;return}let _=null,R=!1;for(let m of N){let w=m.getBoundingClientRect(),M=w.top+w.height/2;if(E<M){_=m,R=!0;break}}if(!_){_=N[N.length-1];let m=_.getBoundingClientRect(),w=m.top+m.height/2;R=E<w,R||(R=!1)}if(!_){k.dropTargetId=null,k.dropBefore=!1;return}let Ie=_.getBoundingClientRect(),Bn=Ie.top+Ie.height/2,mt=E<Bn;_.classList.add(mt?"drag-over-before":"drag-over-after"),k.dropTargetId=_.dataset.id||null,k.dropBefore=mt}function b(E){let h=k.draggingId,N=g.moved;if(!g.ready){d();return}d(),!E&&N&&h&&rr(h,k.dropTargetId,k.dropBefore),Ln()}function D(E){let h=E.pointerType||"";if(h&&h!=="touch"&&h!=="pen"||g.active)return;let N=ut(E.target);if(!N)return;let _=vi(E.target);if(!(_&&_!==N)){g.active=!0,g.pointerId=E.pointerId,g.item=N,g.startX=E.clientX,g.startY=E.clientY,g.lastClientX=E.clientX,g.lastClientY=E.clientY,g.moved=!1,g.ready=!1,g.originalStyles=N.getAttribute("style")||"",g.startTime=E.timeStamp||Date.now(),k.dropTargetId=null,k.dropBefore=!0,k.draggingId=null,i(),g.longPressTimer=setTimeout(()=>{f({clientY:g.lastClientY})},n);try{N.setPointerCapture(E.pointerId)}catch{}}}function C(E){if(!g.active||E.pointerId!==g.pointerId)return;let h=E.pointerType||"";if(!(h&&h!=="touch"&&h!=="pen")){if(g.lastClientX=E.clientX,g.lastClientY=E.clientY,!g.ready){let N=Math.abs(E.clientX-g.startX),_=Math.abs(E.clientY-g.startY);if(N>t||_>t){let R=typeof E.timeStamp=="number"?E.timeStamp:Date.now();Math.abs(R-g.startTime)>=n?(i(),f({clientY:g.lastClientY})):d()}return}E.preventDefault(),g.moved=!0,y(E.clientY),p(E.clientY)}}function W(E){!g.active||E.pointerId!==g.pointerId||b(!1)}function he(E){!g.active||E.pointerId!==g.pointerId||b(!0)}S.addEventListener("pointerdown",D),window.addEventListener("pointermove",C),window.addEventListener("pointerup",W),window.addEventListener("pointercancel",he),Wt._bound=!0}function ir(){ee=null,ln("offline"),ye.forEach(e=>e.classList.remove("hidden")),Tt.forEach(e=>e.classList.add("hidden")),Lt&&(Lt.textContent=""),dt?.(),dt=null,xn(),$(),J(),Fe()}function Cn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Hn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:i,d=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:qt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:Q(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function xi(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Hn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:Q(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(Hn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function J(){pe(u),xi(u)}function xn(){u=ct(Cn())}xn();async function Di(){if(!ee){u=Cn();return}let e=ct(Cn());if(!e.length){u=[],J();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await te(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}u=ct(e.map(n=>({...n,pendingSync:!1}))),J(),$(),Fe()}try{V=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{V={}}if(V&&typeof V=="object"&&Object.values(V).forEach(e=>{e&&typeof e=="object"&&(e.category=Q(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:pt(e),e.urlPath=e.urlPath||Dt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!De()){let e=mr();typeof Notification<"u"&&Notification.permission==="granted"?(tn(),e.length&&jn(e,{requestCheck:!0})):e.length&&jn(e)}let Yt=e=>{if(!ot)return;let t=[ot];ot.window&&!t.includes(ot.window)&&t.push(ot.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Ni(){if(!ie)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",d=()=>"value"in ie?ie.value:ie.innerHTML,l=b=>{if("value"in ie){ie.value=b;return}if(typeof b!="string"||b.length===0){ie.innerHTML="";return}let D=b.trim();if(/<\/?[a-z][\s\S]*>/i.test(D)){ie.innerHTML=b;return}let W=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");ie.innerHTML=W},f=b=>{b?ie.classList.add("notes-editor--columns"):ie.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!b))},y="";try{y=localStorage.getItem(n)||""}catch{I("Unable to access saved notes")}l(y);let p=!1;try{p=localStorage.getItem(i)==="1"}catch{p=!1}f(p),ie.addEventListener("input",()=>{y=d();try{localStorage.setItem(n,y)}catch{I("Notes saved for this session only")}}),Zr?.addEventListener("click",()=>{y=d();try{localStorage.setItem(n,y),I("Notes saved")}catch{I("Notes saved for this session only")}}),ei?.addEventListener("click",()=>{let b=y;try{b=localStorage.getItem(n)||y}catch{I("Unable to load saved notes")}y=b,l(y)}),e?.addEventListener("click",b=>{let D=b.target;if(!(D instanceof Element))return;let C=D.closest("button[data-action]");if(!C)return;let W=C.getAttribute("data-action");if(W==="columns"){let he=!ie.classList.contains("notes-editor--columns");f(he);try{localStorage.setItem(i,he?"1":"0")}catch{I("Column preference saved for this session only")}return}if(!a){I("Formatting controls are not supported in this browser");return}ie.focus(),W==="bullets"?document.execCommand("insertUnorderedList"):W==="numbers"&&document.execCommand("insertOrderedList")})}if(Ni(),X?.addEventListener("click",wr),tr)({initializeApp:Nt,getFirestore:kt,enableMultiTabIndexedDbPersistence:Rt,enableIndexedDbPersistence:Ft,doc:ze,setDoc:Bt,deleteDoc:Mt,onSnapshot:Ot,collection:_t,query:Pt,orderBy:Ut,serverTimestamp:rt,getAuth:it,onAuthStateChanged:$t,GoogleAuthProvider:Ht,signInWithPopup:Sn,signInWithRedirect:vn,getRedirectResult:jt,signOut:En}=tr),at=!0;else try{({initializeApp:Nt}=await In("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:kt,enableMultiTabIndexedDbPersistence:Rt,enableIndexedDbPersistence:Ft,doc:ze,setDoc:Bt,deleteDoc:Mt,onSnapshot:Ot,collection:_t,query:Pt,orderBy:Ut,serverTimestamp:rt}=await In("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:it,onAuthStateChanged:$t,GoogleAuthProvider:Ht,signInWithPopup:Sn,signInWithRedirect:vn,getRedirectResult:jt,signOut:En}=await In("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),at=!0}catch(e){at=!1,console.warn("Firebase modules failed to load:",e),I("Firebase failed to load; notes available offline"),Yt(!1)}if(at&&typeof Nt=="function"&&typeof kt=="function"&&typeof it=="function")try{let e=wo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Tn=Nt(e),Le=kt(Tn),ve=!0,console.info("[Firebase] Firestore initialised",e.projectId),Yt(!0)}catch(e){ve=!1,console.warn("Firebase initialization failed:",e),I("Firebase failed to load; notes available offline"),Yt(!1)}else at?(ve=!1,Yt(!1)):ve=!1;ve&&typeof Rt=="function"&&typeof Ft=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Rt(Le),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Ft(Le),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ve&&typeof it=="function"&&(st=it(Tn));function ki(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Ri=typeof navigator<"u"&&navigator.language?navigator.language:"",or=ki(Ri),Ke=or||"en-US",Ce="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Ce=e.timeZone),!or&&e.locale&&(Ke=e.locale)}catch{}let Fi=new Intl.DateTimeFormat(Ke,{timeZone:Ce,hour:"2-digit",minute:"2-digit"}),Bi=new Intl.DateTimeFormat(Ke,{timeZone:Ce,weekday:"long",day:"numeric",month:"long"}),Mi=new Intl.DateTimeFormat("en-CA",{timeZone:Ce,year:"numeric",month:"2-digit",day:"2-digit"}),Oi=new Intl.DateTimeFormat(Ke,{timeZone:Ce,weekday:"long"}),_i=new Intl.DateTimeFormat(Ke,{timeZone:Ce,month:"short",day:"numeric"});function Re(e){let t=Mi.formatToParts(e),n=t.find(d=>d.type==="year").value,i=t.find(d=>d.type==="month").value,a=t.find(d=>d.type==="day").value;return`${n}-${i}-${a}`}function ar(e,t){let[n,i,a]=e.split("-").map(y=>parseInt(y,10)),[d,l]=t.split(":").map(y=>parseInt(y,10)),f=new Date;return f.setFullYear(n,(i||1)-1,a||1),f.setHours(d||0,l||0,0,0),f.toISOString()}let Pi=new Intl.DateTimeFormat("en-CA",{timeZone:Ce,year:"numeric",month:"2-digit",day:"2-digit"}),Ui=new Intl.DateTimeFormat("en-CA",{timeZone:Ce,hour:"2-digit",minute:"2-digit",hour12:!1});function $i(e){try{let t=new Date(e),n=Pi.formatToParts(t),i=n.find(l=>l.type==="year")?.value||"0000",a=n.find(l=>l.type==="month")?.value||"00",d=n.find(l=>l.type==="day")?.value||"00";return`${i}-${a}-${d}`}catch{return""}}function Hi(e){try{let t=new Date(e),n=Ui.formatToParts(t),i=n.find(d=>d.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(d=>d.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${a}`}catch{return""}}function qt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Gt(){return Re(new Date)}function ji(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function ko(e){let t=ji(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Vt(e){return e==="High"?3:e==="Medium"?2:1}function sr(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let a=e?.due?new Date(e.due).getTime():1/0,d=t?.due?new Date(t.due).getTime():1/0;if(a!==d)return a-d;let l=Vt(t?.priority)-Vt(e?.priority);return l||(t?.updatedAt||0)-(e?.updatedAt||0)}function Ro(e,t){let n=Vt(t.priority)-Vt(e.priority);if(n)return n;let i=+new Date(e.due||0),a=+new Date(t.due||0);return i!==a?i-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function dr(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Bi.format(t)}catch{return e}}function Dn(e){return Fi.format(e)}function Wi(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Fo(e){return e?Wi(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function I(e){U&&(We(),U.dataset.statusKind="toast",U.textContent=e,clearTimeout(I._t),I._t=setTimeout(()=>{U&&U.dataset.statusKind==="toast"&&(U.textContent="",delete U.dataset.statusKind)},2500))}function Yi(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function zt(e){e=String(e||"").toLowerCase();let t={date:Gt(),time:""},n=f=>{let y=new Date,p=y.getDay(),b=(f-p+7)%7,D=new Date(y);return D.setDate(y.getDate()+(b===0?7:b)),D},i=f=>{let y=new Date,p=y.getDay(),b=(f-p+7)%7,D=new Date(y);return D.setDate(y.getDate()+b),D},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},d={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=Re(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[f[1]],p=n(y);t.date=Re(p)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[f[1]],p=i(y);t.date=Re(p)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=a[f[1]],p=n(y);t.date=Re(p)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),y=parseInt(f[1],10),p=new Date;p.setDate(p.getDate()+y),t.date=Re(p)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),y=parseInt(f[1],10),p=parseInt(f[2],10)-1,b=f[3]?parseInt(f[3],10):new Date().getFullYear(),D=new Date(b,p,y);t.date=Re(D)}else for(let[f,y]of Object.entries(d)){let p=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(p.test(e)){let b=e.match(p),D=parseInt(b[1],10),C=new Date().getFullYear(),W=new Date(C,y,D);t.date=Re(W);break}}let l=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(l){let f=parseInt(l[1],10),y=l[2]?parseInt(l[2],10):0,p=l[3];p&&(p==="pm"&&f<12&&(f+=12),p==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(y).padStart(2,"0")}`}return t}let Nn=ve&&st&&typeof Ht=="function";Lr({authReady:Nn,auth:st,GoogleAuthProvider:Ht,signInWithPopup:Sn,signInWithRedirect:vn,signOut:En,toast:I});let cr=di,lr=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(a=>{console.error("Auth handler error:",a)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};cr&&ye.length&&ye.forEach(e=>lr(e,Cr)),Nn&&typeof jt=="function"&&jt(st).catch(()=>{}),cr&&Tt.length&&Tt.forEach(e=>lr(e,xr)),Nn&&typeof $t=="function"?$t(st,async e=>{e?(ee=e.uid,ln("online"),ye.forEach(t=>t.classList.add("hidden")),Tt.forEach(t=>t.classList.remove("hidden")),Lt&&(Lt.textContent=e.displayName||e.email||""),qi(),await Di()):ir()}):ir();function qi(){if(!ve||!Le||typeof _t!="function"||typeof Pt!="function"||typeof Ut!="function"||typeof Ot!="function")return;if(!ee){xn(),$(),Ge(),J(),Fe();return}dt&&dt();let e=_t(Le,"users",ee,"reminders"),t=Pt(e,Ut("updatedAt","desc"));dt=Ot(t,n=>{let i=[];n.forEach(a=>{let d=a.data(),l=Number(d.orderIndex),f=typeof d.plannerLessonId=="string"&&d.plannerLessonId?d.plannerLessonId:null,y=d.pinToToday===!0;i.push({id:a.id,title:d.title,priority:d.priority,notes:d.notes||"",done:!!d.done,due:d.due||null,category:Q(d.category),createdAt:d.createdAt?.toMillis?.()||0,updatedAt:d.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(l)?l:null,plannerLessonId:f,pinToToday:y})}),u=ct(i),$(),Ge(),J(),Fe()},n=>{console.error("Firestore sync error:",n),G&&ln("error","Sync Error")})}async function te(e){if(!(!ve||!ee||!Le||typeof ze!="function"||typeof Bt!="function"||typeof rt!="function"))try{await Bt(ze(Le,"users",ee,"reminders",e.id),{ownerUid:ee,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||z,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):rt(),updatedAt:rt()},{merge:!0})}catch(t){console.error("Save failed:",t),I("Save queued (offline)")}}async function Gi(e){if(!(!ve||!ee||!Le||typeof ze!="function"||typeof Mt!="function"))try{await Mt(ze(Le,"users",ee,"reminders",e))}catch{I("Delete queued (offline)")}}async function ft(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||z,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function He({preserveDetail:e=!1}={}){c&&(c.value=""),v&&(v.value=""),T&&(T.value=""),A&&(A.value=""),xt("Medium"),L&&(L.value=z),Qn(),Xe=null,X&&(X.textContent="Save"),ne?.classList.add("hidden"),gn(),e||Gn()}function Vi(e){let t=u.find(n=>n.id===e);t&&(c&&(c.value=t.title||""),v&&T&&(t.due?(v.value=$i(t.due),T.value=Hi(t.due)):(v.value="",T.value="")),xt(t?.priority||"Medium"),L&&(L.value=Q(t.category)),A&&(A.value=typeof t.notes=="string"?t.notes:""),j&&(j.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),gn(),Jr(t),Xe=e,X&&(X.textContent="Update"),ne?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),c?.focus(),we("cue:open",{mode:"edit"}))}function zi(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=Q(e.category??(L?L.value:"")),a={id:qt(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!ee,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday};An(a,{position:"start"}),u=[a,...u],pe(u);let d=lt(u);return Ue=!0,$(),J(),Kn(a),d?u.forEach(l=>te(l)):te(a),ft(a),je(a),Ve(),we("memoryCue:remindersUpdated",{items:u}),er(),Se({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function Xi(e,t){if(!ee)return I("Sign in to add notes"),null;if(!e)return null;let n=u.find(l=>l.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let d=typeof n.notes=="string"?n.notes:"";return n.notes=d?`${d}
${a}`:a,n.updatedAt=Date.now(),te(n),$(),J(),Se({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Ki(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),te(t),ft(t),$(),J(),t.done?(Kt(e),Se({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(je(t),Se({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function ur(e,t){let n=u.find(a=>a?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),te(n),$(),J(),Ve(),we("memoryCue:remindersUpdated",{items:u}))}function Ji(e){let t=e?.target;if(!(t instanceof HTMLInputElement)||t.dataset.role!=="reminder-today-toggle")return;e.stopPropagation();let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;i&&ur(i,t.checked)}function Qi(e){if(!fe||fe.tokenId!==e)return;let{item:t,index:n}=fe;if(!t){We(e);return}We(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!ee,t.updatedAt=Date.now(),u.splice(i,0,t),pe(u);let a=lt(u);Ue=!0,$(),J(),je(t),a?u.forEach(d=>te(d)):te(t),ft(t),Ve(),we("memoryCue:remindersUpdated",{items:u}),Se({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),I("Reminder restored")}function fr(e){let t=u.findIndex(a=>a.id===e),n=t>=0?u.splice(t,1)[0]:null;n&&Xe===e&&He(),$(),J(),Gi(e),Kt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Se({action:"deleted",label:i}),n&&U){We();let a=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;fe={tokenId:a,item:n,index:t,timeoutId:null},Kr(fe),fe.timeoutId=setTimeout(()=>{We(a)},Xr)}else n&&We()}function Zi(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,a=800,d='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',l=null,f=!1,y=0,p=0,b=0,D=()=>{if(f){if(f=!1,l!=null&&e.hasPointerCapture?.(l))try{e.releasePointerCapture(l)}catch{}l=null,e.removeEventListener("pointermove",W),e.removeEventListener("pointerup",he),e.removeEventListener("pointercancel",E),e.removeEventListener("pointerleave",E),window.removeEventListener("pointerup",he),window.removeEventListener("pointercancel",E)}},C=h=>{if(h.pointerType==="mouse"&&h.button!==0)return;f&&D();let N=h.target;N instanceof Element&&N.closest(d)||(l=h.pointerId,y=h.clientX,p=h.clientY,b=typeof h.timeStamp=="number"?h.timeStamp:Date.now(),f=!0,e.addEventListener("pointermove",W),e.addEventListener("pointerup",he),e.addEventListener("pointercancel",E),e.addEventListener("pointerleave",E),window.addEventListener("pointerup",he),window.addEventListener("pointercancel",E))},W=h=>{if(!f||h.pointerId!==l)return;Math.abs(h.clientY-p)>i&&D()},he=h=>{if(!f||h.pointerId!==l)return;let N=h.clientX-y,_=Math.abs(h.clientY-p),R=(typeof h.timeStamp=="number"?h.timeStamp:Date.now())-b;if(D(),N<=-n&&_<=i&&R<=a){h.preventDefault(),h.stopPropagation();try{t()}catch(Ie){console.warn("Swipe delete handler failed",Ie)}}},E=h=>{f&&(typeof h.pointerId=="number"&&h.pointerId!==l||D())};e.addEventListener("pointerdown",C)}function pt(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let a=Dn(i);if(a)return`${n} \u2022 ${a}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let a=Dn(i);if(a)return`Due ${a}`}}catch{}return"Due now"}function pr(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}I("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function mr(){return Object.values(V||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||z,notes:typeof e.notes=="string"?e.notes:"",body:pt(e),urlPath:e.urlPath||Dt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function kn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(V))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=mr(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&tn(),jn(e,{requestCheck:t})}function Xt(e,{closeNotification:t=!0}={}){if(t){let n=xe.get(e);if(n){try{n.close()}catch{}xe.delete(e)}}$e[e]&&(clearTimeout($e[e]),delete $e[e]),Wn(e),V[e]&&(delete V[e],kn())}function Kt(e){Xt(e)}function gr(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=xe.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:pt(e),tag:e.id});xe.set(e.id,n);let i=()=>{xe.get(e.id)===n&&xe.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function eo(e){if(!De())return!1;let t=Ur();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await _e();if(!i)return!1;await Wn(e.id,i);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||z,body:d,urlPath:Dt},d=pt(e),l={body:d,tag:e.id,data:a,renotify:!0};n>Date.now()&&(l.showTrigger=new t(n));try{return await i.showNotification(e.title,l),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function je(e){if(!e||!e.id)return;if(e.category=Q(e.category),!e.due||e.done){Kt(e.id);return}let t=V[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||z,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:pt(e),urlPath:Dt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let l=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return l===e.due?f:null})()};if(V[e.id]=n,kn(),$e[e.id]&&(clearTimeout($e[e.id]),delete $e[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let a=i-Date.now();if(a<=0){if(V[e.id]?.viaTrigger){Xt(e.id,{closeNotification:!1});return}gr(e),Xt(e.id,{closeNotification:!1});return}let d=De();d&&(n.viaTrigger=!1,eo(e).then(l=>{l&&V[e.id]&&(V[e.id]={...V[e.id],viaTrigger:!0},kn())})),$e[e.id]=setTimeout(()=>{d&&Wn(e.id),gr(e),Xt(e.id,{closeNotification:!1})},a)}function Fe(){Object.values(V).forEach(e=>je({...e,category:Q(e?.category)}))}function yr(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Oi.format(t),i=_i.format(t),a=Dn(t);return`${n}, ${i}${a?` at ${a}`:""}`}catch{return"No due date"}}let hr="__mcPinToggleHandler",Rn=!1;function to(e){if(!(e instanceof HTMLInputElement)||e[hr])return;let t=n=>{if(n?.defaultPrevented)return;n.stopPropagation();let i=n.currentTarget;if(!(i instanceof HTMLInputElement))return;let d=(typeof i.closest=="function"?i.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){i.checked=!1,i.setAttribute("aria-pressed","false");return}ur(d,i.checked)};e.addEventListener("change",t),e[hr]=t}function no(){if(!S)return;let e=S.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLInputElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){t.checked=!1;return}let d=!!u.find(l=>l?.id===i)?.pinToToday;t.checked=d,t.setAttribute("aria-pressed",d?"true":"false"),to(t)})}function br(){if(!S||Rn)return;Rn=!0;let e=()=>{Rn=!1,no()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function ro(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function io(e,t,n){return t!=="today"?e:Array.isArray(e)?e.filter(i=>ro(i,n)):[]}function Fn(){if(de!=="mobile"||typeof document>"u"||Fn._wired)return;let e=document.querySelectorAll("#view-reminders [data-reminders-tab]");if(!e.length)return;Fn._wired=!0;let t=()=>{e.forEach(n=>{let a=n.getAttribute("data-reminders-tab")===nt;n.setAttribute("aria-pressed",a?"true":"false"),a?n.classList.add("reminders-tab-active"):n.classList.remove("reminders-tab-active")})};t(),Ge(),e.forEach(n=>{n.addEventListener("click",()=>{let i=n.getAttribute("data-reminders-tab");!i||i===nt||(nt=i,t(),Array.isArray(pn)&&$(),Ge())})})}function $(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let a={start:n,end:i};if(ke(),pe(u),Vn)try{Vn.textContent=String(u.length)}catch{}u.forEach(m=>{m&&typeof m=="object"&&(m.category=Q(m.category))});let d=new Set(ho.map(m=>Q(m)));u.forEach(m=>{m&&typeof m=="object"&&d.add(Q(m.category))});let l=Array.from(d).sort((m,w)=>m.localeCompare(w,void 0,{sensitivity:"base"}));if(fn){let m=new Set;Array.from(fn.querySelectorAll("option")).forEach(w=>{m.add(w.value.trim().toLowerCase())}),l.forEach(w=>{let M=w.toLowerCase();if(!m.has(M)){let F=document.createElement("option");F.value=w,fn.appendChild(F),m.add(M)}})}if(Ue)Ue=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=u.map(w=>({...w}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let w=document.createEvent("CustomEvent");w&&w.initCustomEvent&&(w.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(w))}}catch{}}let f=u.slice();pe(f),de==="mobile"&&(pn=f.slice(),f=io(pn,nt,a),Ge());let y=!0,p=u.length>0,b=f.length>0,D=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(V||{}).filter(w=>w&&typeof w=="object"&&w.id);return new Set(m.map(w=>w.id))})();if(qe)if(b)qe.classList.add("hidden");else{let m=p?"No reminders to show right now.":hi;Zn?Zn(qe,{icon:p?"sparkles":"bell",title:p?"Nothing to display":"Create your first cue",description:m,action:p?void 0:`<button type="button" class="${bi}" data-trigger="open-cue">Create reminder</button>`}):qe.textContent=m,qe.classList.remove("hidden")}if(zn&&zn.classList.toggle("has-items",b),!S)return;if(!b){qe?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden")),br();return}S.classList.remove("hidden"),S.replaceChildren();let C=document.createDocumentFragment(),W=S.tagName==="UL"||S.tagName==="OL",he=!0,E=["priority-high","priority-medium","priority-low"],h=(m,w)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...E);let M=typeof w=="string"?w.trim().toLowerCase():"";M.startsWith("h")?m.classList.add("priority-high"):M.startsWith("m")?m.classList.add("priority-medium"):M.startsWith("l")&&m.classList.add("priority-low")},N=(m,w="neutral")=>{let M=document.createElement("span");M.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",M.title=m,M.dataset.tone=w;let F=document.createElement("span");F.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",w==="priority-high"?F.classList.add("bg-error"):w==="priority-medium"?F.classList.add("bg-warning"):w==="priority-low"?F.classList.add("bg-secondary"):w==="category"?F.classList.add("bg-primary"):F.classList.add("bg-base-content","opacity-40");let B=document.createElement("span");return B.className="truncate",B.textContent=m,M.append(F,B),M},_=(m,w,{elementTag:M,isMobile:F})=>{let B={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:w,done:!!m.done,pinToToday:m.pinToToday===!0},gt="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",so="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",x=document.createElement(M);x.className=F?so:gt,x.dataset.id=B.id,x.dataset.category=B.category,x.dataset.title=B.title;let Sr=B.priority&&String(B.priority).trim();Sr?x.dataset.priority=Sr:delete x.dataset.priority,x.dataset.done=String(B.done),B.dueIso?x.dataset.due=B.dueIso:delete x.dataset.due,B.pinToToday?x.dataset.pinToToday="true":delete x.dataset.pinToToday,x.dataset.reminder=JSON.stringify(B),x.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",x.dataset.reminderItem="true",x.dataset.compact="true",x.classList.add("reminder-draggable"),x.setAttribute("draggable","true"),x.setAttribute("role","button"),x.tabIndex=0,x.setAttribute("aria-label",`Edit reminder: ${m.title}`),h(x,B.priority),D.has(B.id)?x.dataset.notificationActive="true":delete x.dataset.notificationActive;let Mn=B.dueIso?new Date(B.dueIso):null;y&&Mn&&Mn>=n&&Mn<=i?(x.classList.add("is-today"),x.dataset.today="true"):(x.classList.remove("is-today"),delete x.dataset.today);let yt=document.createElement("div");yt.className="flex min-w-0 flex-1 flex-col gap-2",F&&yt.classList.add("text-sm","text-base-content");let Be=document.createElement("p");Be.className=F?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",Be.classList.add("desktop-reminder-title"),F||Be.classList.add("sm:text-[0.95rem]"),B.done&&Be.classList.add("line-through","text-base-content/60"),F&&(Be.dataset.reminderTitle="true"),Be.textContent=m.title;let Jt=Be;F&&(Jt=document.createElement("div"),Jt.className="reminder-title-slot",Jt.appendChild(Be)),yt.appendChild(Jt);let ht=document.createElement("div");ht.className=F?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let On=yr(m),vr=On&&On!=="No due date"?On:"";vr&&ht.appendChild(N(vr,"due")),!!(w&&w!==z)&&ht.appendChild(N(w,"category")),ht.children.length&&yt.appendChild(ht),x.appendChild(yt);let Je=document.createElement("div");Je.className="task-toolbar flex items-start gap-1",Je.setAttribute("role","toolbar"),Je.setAttribute("aria-label","Reminder actions"),F&&Je.classList.add("flex-shrink-0");let ue=document.createElement("button");ue.type="button",ue.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn",B.done?(ue.classList.add("text-base-content/60"),ue.innerHTML='<span aria-hidden="true">\u21BA</span>',ue.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(ue.classList.add("text-success"),ue.innerHTML='<span aria-hidden="true">\u2713</span>',ue.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),ue.setAttribute("aria-pressed",B.done?"true":"false"),ue.setAttribute("data-reminder-control","toggle"),ue.setAttribute("data-no-swipe","true"),ue.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),Ki(B.id)});let Me=document.createElement("button");Me.type="button",Me.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn",Me.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',Me.setAttribute("aria-label",`Delete reminder: ${m.title}`),Me.setAttribute("data-reminder-control","delete"),Me.setAttribute("data-no-swipe","true"),Me.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),fr(B.id)}),Je.append(ue,Me),x.appendChild(Je);let Er=()=>Vi(B.id);return x.addEventListener("click",ae=>{if(ae.defaultPrevented)return;let _n=ae.target;_n&&typeof _n.closest=="function"&&_n.closest("[data-reminder-control]")||Er()}),x.addEventListener("keydown",ae=>{ae.defaultPrevented||ae.target===x&&(ae.key==="Enter"||ae.key===" ")&&(ae.preventDefault(),Er())}),F&&Zi(x,()=>fr(B.id)),x},R=(m,w)=>_(m,w,{elementTag:"div",isMobile:!0});if(de!=="desktop"&&!he){f.forEach(m=>{let w=m.category||z;C.appendChild(R(m,w))}),S.appendChild(C);return}let Ie=new Map;f.forEach(m=>{let w=m.category||z;Ie.has(w)||Ie.set(w,[]),Ie.get(w).push(m)});let Bn=Array.from(Ie.entries()).sort((m,w)=>m[0].localeCompare(w[0],void 0,{sensitivity:"base"})),mt=!0;Bn.forEach(([m,w])=>{if(m!==z){let M=document.createElement(W?"li":"div");M.dataset.categoryHeading=m,W&&(M.setAttribute("role","presentation"),M.style.listStyle="none"),M.className=de==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",mt||(M.style.marginTop=de==="desktop"?"1.25rem":"1rem");let F=document.createElement("div");F.setAttribute("role","heading"),F.setAttribute("aria-level","3"),F.className=de==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let B=document.createElement("span");B.textContent=m;let gt=document.createElement("span");gt.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",gt.textContent=`${w.length} ${w.length===1?"item":"items"}`,F.append(B,gt),M.appendChild(F),C.appendChild(M)}w.forEach(M=>{if(de==="desktop"){let F=_(M,m,{elementTag:W?"li":"div",isMobile:!1});C.appendChild(F);return}C.appendChild(R(M,m))}),mt=!1}),S.appendChild(C),Qr(),br()}function Ee(){et?.setAttribute("aria-expanded","false"),tt?.classList.add("hidden")}function oo(){et?.setAttribute("aria-expanded","true"),tt?.classList.remove("hidden")}et?.addEventListener("click",e=>{e.stopPropagation(),et.getAttribute("aria-expanded")==="true"?Ee():oo()}),document.addEventListener("click",e=>{tt&&!tt.classList.contains("hidden")&&!tt.contains(e.target)&&e.target!==et&&Ee()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Ee()}),si.forEach(e=>{e.addEventListener("click",()=>{let t=Ct?.classList.contains("hidden");Ct?.classList.toggle("hidden"),t&&Ct?.scrollIntoView({behavior:"smooth",block:"start"}),Ee()})}),document.addEventListener("DOMContentLoaded",()=>{Ct?.classList.add("hidden")});function wr(){try{console.log("handleSaveAction invoked",{editingId:Xe,title:c?.value})}catch{}let t=(typeof c?.value=="string"?c.value:"").trim(),n=typeof v?.value=="string"?v.value:"",i=typeof T?.value=="string"?T.value:"",a=typeof j?.value=="string"?j.value.trim():"";if(Xe){let p=u.find(C=>C.id===Xe);if(!p){He();return}if(!t){I("Add a reminder title");return}let b=null;if(n||i){let C=n||Gt();b=ar(C,i||"09:00")}else{let C=zt(t);C.time&&(b=new Date(`${C.date}T${C.time}:00`).toISOString())}p.title=t;let D=hn();p.priority=D,xt(D),L&&(p.category=Q(L.value)),p.due=b,A&&(p.notes=A.value.trim()),p.plannerLessonId=a||null,p.updatedAt=Date.now(),te(p),ft(p),Ue=!0,$(),je(p),J(),Ve(),we("memoryCue:remindersUpdated",{items:u}),er(),Se({action:"updated",label:`Reminder updated \xB7 ${p.title}`}),He(),I("Reminder updated"),we("cue:close",{reason:"updated"});return}if(!t){I("Add a reminder title");return}let d=A?A.value.trim():"",l=null;if(n||i){let p=n||Gt();l=ar(p,i||"09:00")}else{let p=zt(t);p.time&&(l=new Date(`${p.date}T${p.time}:00`).toISOString())}let f=a?{lessonId:a,dayLabel:j?.dataset?.lessonDayLabel||"",lessonTitle:j?.dataset?.lessonTitle||"",summary:j?.dataset?.lessonSummary||""}:null,y=zi({title:t,priority:hn(),category:L?L.value:"",due:l,notes:d,plannerLessonId:a||null});y&&(f?(I("Planner reminder created"),we("planner:reminderCreated",{lessonId:f.lessonId,dayLabel:f.dayLabel,lessonTitle:f.lessonTitle,summary:f.summary,reminderId:y.id,reminderTitle:y.title,reminderDue:y.due||null})):I("Reminder created")),c&&(c.value=""),T&&(T.value=""),A&&(A.value=""),gn(),we("cue:close",{reason:"created"})}c?.addEventListener("keydown",e=>{e.key==="Enter"&&wr()});function ao(){if(!c||!Pe)return;let e=c.value.trim();if(!e){Pe.style.display="none";return}try{let t=zt(e),n=Gt();if(t.date!==n||t.time){let i="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${dr(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Pe.textContent=`Parsed: ${i}`,Pe.style.display="block"):Pe.style.display="none"}else Pe.style.display="none"}catch{Pe.style.display="none"}}return c?.addEventListener("input",Yi(ao,300)),ne?.addEventListener("click",()=>{He(),I("Edit cancelled"),we("cue:close",{reason:"edit-cancelled"})}),cn?.addEventListener("click",()=>{He()}),document.addEventListener("cue:cancelled",()=>{He()}),document.addEventListener("cue:prepare",()=>{He()}),document.addEventListener("planner:prefillReminder",e=>{fi(e?.detail||{})}),window.addEventListener("load",()=>c?.focus()),ni?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?dr(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Ke,{hour:"2-digit",minute:"2-digit",timeZone:Ce}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){I("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>I("Copied for Master Task List")).catch(()=>I("Copy failed")),Ee()}),un?.addEventListener("change",()=>{let e=un.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(d=>{let l={...d,id:qt(),category:Q(d.category),pendingSync:!ee,orderIndex:null};An(l,{position:"start"}),u=[l,...u],i.push(l)}),pe(u);let a=lt(u);$(),J(),a?u.forEach(d=>te(d)):i.forEach(d=>te(d)),I("Import successful")}catch{I("Invalid JSON")}},t.readAsText(e),un.value="",Ee()}),ri?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Ee()}),ii?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){I("Add your Apps Script URL in Settings first"),Ee();return}if(!u.length){I("No tasks to sync"),Ee();return}I("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<u.length;i+=t){let a=u.slice(i,i+t),d=await Promise.allSettled(a.map(l=>{let f={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:l.category||z,done:!!l.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=d.filter(l=>l.status==="rejected").length,await new Promise(l=>setTimeout(l,400))}I(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),Ee()}),Ye&&(Ye.value=localStorage.getItem("syncUrl")||""),oi?.addEventListener("click",()=>{Ye&&(localStorage.setItem("syncUrl",Ye.value.trim()),I("Settings saved"))}),ai?.addEventListener("click",async()=>{if(!Ye)return;let e=Ye.value.trim();if(!e){I("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});I(t.ok?"Test ok":"Test failed")}catch{I("Test failed")}}),ti?.addEventListener("click",async()=>{if(!("Notification"in window)){I("Notifications not supported");return}if(Notification.permission==="granted"){I("Notifications enabled"),De()?_e():(tn(),pr()),Fe(),$();return}try{await Notification.requestPermission()==="granted"?(I("Notifications enabled"),De()?_e():(tn(),pr()),Fe(),$()):I("Notifications blocked")}catch{I("Notifications blocked")}}),Fn(),de==="mobile"&&li(),Ci(),Fe(),$(),J(),{cancelReminder:Kt,scheduleReminder:je,closeActiveNotifications:$r,getActiveNotifications:()=>xe,addNoteToReminder:Xi,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:Q(t?.category)})):[],u=ct(u),pe(u),$()},render:$,getItems:()=>u.map(e=>({...e}))}}}var Mr,xe,Or,Pn,Un,_r,en,It,$n,z,ho,Hn,Te,bo,Ae,Eo=Qt(()=>{Nr();Mr="memoryCue:activity",xe=new Map,Or=!1,Pn="service-worker.js",Un="memory-cue-reminder-sync",_r=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),en=null,It=null,$n=!1,z="General",ho=Object.freeze([z,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Hn="memoryCue:offlineReminders",Te=1024,bo=Object.freeze({}),Ae=null});var jr,Io,sn,qn,Wr,Yr,nn,qr,on,rn,Hr,To,Gr,an,Vr=Qt(()=>{jr="memoryCueNotes",Io=["mobileNotes"],sn=()=>typeof localStorage<"u",qn=null,Wr=r=>{qn=typeof r=="function"?r:null},Yr=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,nn=r=>{if(typeof r!="string")return"";let o=r.trim();if(!o.length)return"";if(!/[<>]/.test(o))return r;try{if(typeof document<"u"){let s=document.createElement("div");return s.innerHTML=o,(typeof s.innerText=="string"&&s.innerText.length?s.innerText:s.textContent||"").replace(/\r?\n/g,`
`)}}catch{}return o.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},qr=r=>{if(typeof r!="string")return!1;let o=Date.parse(r);return!Number.isNaN(o)},on=(r,o,s={})=>{let c=typeof r=="string"?r.trim():"";return{id:s.id&&typeof s.id=="string"?s.id:Yr(),title:c||"Untitled note",body:typeof o=="string"?nn(o):"",updatedAt:s.updatedAt&&qr(s.updatedAt)?s.updatedAt:new Date().toISOString()}},rn=r=>{if(Array.isArray(r))return r.map(o=>{if(!o||typeof o!="object")return null;let s=typeof o.title=="string"?o.title.trim():"",c=typeof o.body=="string"?nn(o.body):"",v=typeof o.id=="string"&&o.id.trim()?o.id:Yr(),T=qr(o.updatedAt)?o.updatedAt:new Date().toISOString();return!s&&!c?null:{id:v,title:s||"Untitled note",body:c,updatedAt:T}}).filter(Boolean);if(r&&typeof r=="object"){let o=typeof r.title=="string"?r.title:"",s=typeof r.body=="string"?nn(r.body):"";return!o&&!s?[]:[on(o,s,{id:typeof r.id=="string"?r.id:void 0,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:void 0})]}return typeof r=="string"&&r.trim().length?[on("Notebook (legacy)",nn(r))]:[]},Hr=r=>{if(!sn())return null;try{return localStorage.getItem(r)}catch{return null}},To=r=>{if(sn())try{localStorage.removeItem(r)}catch{}},Gr=()=>{if(!sn())return[];let r=Hr(jr);if(typeof r=="string")try{let o=JSON.parse(r),s=rn(o);if(s.length)return s}catch{let o=rn(r);if(o.length)return an(o),o}for(let o of Io){let s=Hr(o);if(typeof s=="string"&&s.trim().length){let c=rn(s);if(c.length)return an(c),To(o),c}}return[]},an=(r,o={})=>{if(!sn()||!Array.isArray(r))return!1;let s=r.map(c=>rn([c])[0]).filter(Boolean);try{if(localStorage.setItem(jr,JSON.stringify(s)),!o.skipRemoteSync&&typeof qn=="function")try{let c=qn(s);c&&typeof c.then=="function"&&c.catch(v=>{console.error("[notes-storage] Remote sync failed.",v)})}catch(c){console.error("[notes-storage] Remote sync handler threw.",c)}return!0}catch{return!1}}});var Ao,Lo,Co,dn,xo,Do,Vo,No=Qt(()=>{Tr();Vr();Ao="notes",Lo="user_id",Co="updated_at",dn=r=>{if(typeof r!="string")return 0;let o=Date.parse(r);return Number.isNaN(o)?0:o},xo=(r=[],o=[])=>{let s=new Map;return o.forEach(c=>{c&&typeof c.id=="string"&&s.set(c.id,c)}),r.forEach(c=>{if(!c||typeof c.id!="string")return;let v=s.get(c.id);if(!v){s.set(c.id,c);return}let T=dn(c.updatedAt),A=dn(v.updatedAt);T>A&&s.set(c.id,c)}),Array.from(s.values()).sort((c,v)=>dn(v?.updatedAt)-dn(c?.updatedAt))},Do=r=>o=>{if(!o||typeof o!="object")return null;let s={id:typeof o.id=="string"&&o.id?o.id:void 0,updatedAt:typeof o[r]=="string"?o[r]:void 0};return on(o.title,o.body,s)},Vo=(r={})=>{let{tableName:o=Ao,userColumn:s=Lo,updatedAtColumn:c=Co,supabase:v=null}=r,T=v||null,A=null,Y=!1,L=new Set,X=()=>T||(T=Qe(),T),ne=Do(c),S=async P=>{let q=X();if(!q||!A)return;let ge=(Array.isArray(P)?P.filter(O=>O&&typeof O.id=="string"):[]).map(O=>({id:O.id,[s]:A,title:O.title,body:O.body,[c]:typeof O.updatedAt=="string"&&O.updatedAt?O.updatedAt:new Date().toISOString()})),be=new Set(ge.map(O=>O.id));if(ge.length){let{error:O}=await q.from(o).upsert(ge);if(O)throw O}let K=[...L].filter(O=>O&&!be.has(O));if(K.length){let{error:O}=await q.from(o).delete().in("id",K).eq(s,A);if(O)throw O}L=new Set(be)},re=async()=>{let P=X();if(!(!P||!A))try{let{data:q,error:Ne}=await P.from(o).select(`id,title,body,${c}`).eq(s,A);if(Ne)throw Ne;let ge=Array.isArray(q)?q:[];L=new Set(ge.map(ye=>typeof ye.id=="string"?ye.id:null).filter(Boolean));let be=ge.map(ne).filter(Boolean),K=Gr();if(!be.length){if(K.length)try{await S(K)}catch(ye){console.error("[notes-sync] Failed to upload local notes to Supabase.",ye)}return}let O=xo(K,be);Y=!0;let cn=an(O,{skipRemoteSync:!0});Y=!1,cn||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await S(O)}catch(ye){console.error("[notes-sync] Failed to reconcile notes with Supabase.",ye)}}catch(q){console.error("[notes-sync] Failed to fetch notes from Supabase.",q)}finally{Y=!1}};return Wr(async P=>{if(!Y)try{await S(P)}catch(q){console.error("[notes-sync] Failed to sync notes to Supabase.",q)}}),{setSupabaseClient(P){P&&(T=P)},handleSessionChange:async P=>{if(A=typeof P?.id=="string"?P.id:null,!A){L=new Set;return}await re()},syncFromRemote:re}}});export{_o as a,Nr as b,Ho as c,Eo as d,jr as e,on as f,Gr as g,an as h,Vr as i,Vo as j,No as k};
