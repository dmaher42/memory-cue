import{a as Yn,b as Po,c as Je,d as Fo,f as Ht,g as et,h as Rt,i as Ho,j as Gn,k as Ro}from"./chunk-P37YOGFR.js";import{a as Kn,b as Bo}from"./chunk-MG4MJA24.js";import"./chunk-CTK42JWW.js";import{b as Ft,c as Mo}from"./chunk-GUVSRPRW.js";function Qn(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:s})=>{if(!Array.isArray(s))return null;for(let o of s){if(typeof o!="string"||!o)continue;let a=t.getElementById(o);if(a)return{key:n,element:a}}return null}).filter(n=>!!(n&&n.element))}function ve(e,t){if(!e||typeof e!="object")return"";let n=_o[t]||[t];for(let s of n)if(Object.prototype.hasOwnProperty.call(e,s)){let o=e[s];return o==null?"":typeof o=="string"?o:String(o)}return""}function $o(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function Oo(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Zn(e,t){Array.isArray(t)&&t.forEach(({key:n,element:s})=>{let o=e&&typeof e=="object"?ve(e,n):"";$o(s,o)})}function Jn(e,t,n,s){Array.isArray(e)&&e.forEach(({element:o})=>{o instanceof HTMLInputElement?["checkbox","radio"].includes(o.type)?o.checked=!1:o.value="":(o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement)&&(o.value="")}),t&&(t.value=""),n&&(n.textContent=s)}function es(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:s})=>{let o=Oo(s);if(typeof o=="boolean"){t[n]=o;return}let a=typeof o=="string"?o.trim():o;t[n]=a??""}),t}function C(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Xn,_o,_t,$t,ts=Ft(()=>{Xn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],_o={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},_t="Create Cue",$t="Edit Cue"});function ns(e){return new Ot(e)}var qo,Uo,Ot,ss=Ft(()=>{qo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Uo={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Ot=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...Uo,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let s=n[0],o=n[n.length-1],a=document.activeElement;t.shiftKey&&a===s?(t.preventDefault(),o.focus()):!t.shiftKey&&a===o&&(t.preventDefault(),s.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(qo)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let s=this.events[t];if(!s||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let o=new CustomEvent(s,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(o)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var os,qt,nt,Ut,jo,Vo,jt,as,Wo,rs,at,zo,Ko,Yo,is,Go,Vt,fe,Xo,ls,Me,cs,Qo,ds,Wt,st,Ne,tt,Se,us,se,fs,ms,ot,Zo,De,oe,ps,ae,Be,ys,zt,gs,z,rt,re,hs,bs,Es,Kt,Yt,ws,vs=Ft(()=>{os="memoryCue:plannerPlans",qt="memoryCue:plannerUpdated",nt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ut=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},jo=e=>{if(!Ut()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},Vo=e=>{try{return JSON.parse(e)}catch{return null}},jt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,as=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,Wo=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),s=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-s),t},rs=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},at=e=>{if(typeof e!="string")return null;let[t,n,s]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),i=Number.parseInt(s,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(i))return null;let r=new Date(o,a-1,i);return Number.isNaN(r.getTime())?null:(r.setHours(0,0,0,0),r)},zo=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=nt.findIndex(s=>s.toLowerCase()===t);return n>=0?n:0},Ko=new Set(["not_started","in_progress","ready","taught"]),Yo=new Set(["simple","hpe","english","cac","custom"]),is=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:jt(),badge:n,text:t}},Go=e=>{if(!e||typeof e!="object")return null;let t=typeof e.label=="string"?e.label.trim():"",n=typeof e.url=="string"?e.url.trim():"";return!t&&!n?null:{id:typeof e.id=="string"&&e.id.trim()?e.id:jt(),label:t,url:n}},Vt=(e,t={})=>{let n=typeof t=="object"&&t?t:{},s=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:zo(e?.dayName||n.dayName||n.dayLabel),o=as(s),a=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():nt[o],i=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",l=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(b=>is(b)).filter(Boolean),d=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:jt(),y=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,g=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",w=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"",I=typeof e?.status=="string"?e.status.trim().toLowerCase():"",k=Ko.has(I)?I:"not_started",N=typeof e?.templateType=="string"?e.templateType.trim().toLowerCase():"",H=Yo.has(N)?N:"simple",x=(Array.isArray(e?.resources)?e.resources:Array.isArray(n.resources)?n.resources:[]).map(b=>Go(b)).filter(Boolean),m=typeof e?.weekDay=="string"?e.weekDay.trim():typeof n.weekDay=="string"?n.weekDay.trim():nt[o],p=typeof e?.period=="string"?e.period.trim():typeof n.period=="string"?n.period.trim():"";return{id:d,dayIndex:o,dayLabel:nt[o]||"Lesson",title:a,summary:i,details:l,notes:g,subject:w,status:k,templateType:H,resources:x,weekDay:m,period:p,position:Number.isFinite(y)?y:null}},fe=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let s=Number.isFinite(t.position),o=Number.isFinite(n.position);return s&&o&&t.position!==n.position?t.position-n.position:s&&!o?-1:!s&&o?1:t.title.localeCompare(n.title)}),Xo=e=>{let t=new Map;return e.forEach(n=>{let s=String(n.dayIndex),o=t.get(s)??0;Number.isFinite(n.position)?t.set(s,Math.max(o,n.position+1)):(n.position=o,t.set(s,o+1))}),e},ls=(e,t,n)=>{let s=e.filter(o=>!(o.dayIndex!==t||n&&o.id===n));return s.length?s.reduce((o,a)=>Number.isFinite(a.position)?Math.max(o,a.position):o,-1)+1:0},Me=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,s=at(n),o=Array.isArray(e?.lessons)?Xo(e.lessons.map(a=>Vt(a)).filter(Boolean)):[];return{weekId:n,startDate:s?s.toISOString():"",lessons:fe(o),teacherNotes:typeof e?.teacherNotes=="string"?e.teacherNotes:"",updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString()}},cs=()=>{if(!Ut())return{};try{let e=jo(os);if(typeof e!="string"||!e.length)return{};let t=Vo(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Qo=e=>{if(Ut())try{window.localStorage.setItem(os,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},ds=e=>{if(!e)return null;let n=cs()[e];return n?Me(n,e):null},Wt=(e,t)=>{if(!e||!t)return t;let n=cs();return n[e]=t,Qo(n),t},st=new Map,Ne=null,tt=null,Se=!1,us=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},se=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(qt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},fs=async()=>Ne?tt||(tt=Ne().then(e=>{let{db:t,getCollection:n}=e||{},s=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:s}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),tt):null,ms=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:s,db:o}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return s?n(s,t):n(o,"plannerPlans",t)},ot=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&st.set(e.weekId,e),e),Zo=e=>Me({weekId:e,lessons:[]},e),De=e=>{let t=ds(e);if(t)return ot(t),t;let n=Zo(e);return Wt(e,n),ot(n),n},oe=async e=>{if(!e?.weekId)return e;let t=Me(e,e.weekId);if(Wt(t.weekId,t),ot(t),Se||!Ne)return t;try{let n=await fs();if(!n)return t;let s=ms(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(s,t,{merge:!0}):await n.updateDoc(s,t),t}catch(n){return us(n)?(console.warn("Persisting planner data locally due to permission issue",n),Se=!0,t):(console.error("Failed to persist planner plan",n),t)}},ps=(e={})=>{typeof e.ensureFirestore=="function"&&(Ne=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(Se=e.forceLocal)},ae=(e=new Date)=>{let t=Wo(e);return rs(t)},Be=(e,t=0)=>{let n=at(e);if(!n||!Number.isFinite(t))return e;let s=new Date(n);return s.setDate(n.getDate()+t*7),rs(s)},ys=(e=ae(),t=0)=>{let n=at(e);if(!n)return null;let s=Number.isFinite(t)?t:0,o=as(s),a=new Date(n);return a.setDate(n.getDate()+o),a},zt=(e,{short:t=!1}={})=>{let n=at(e);if(!n)return"";let s=new Date(n);s.setDate(n.getDate()+6);let o=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),a=o.format(n),i=o.format(s),r=n.getFullYear()===s.getFullYear();if(t)return`Week of ${a}`;let l=r?n.getFullYear():`${n.getFullYear()} \u2013 ${s.getFullYear()}`;return`${a} \u2013 ${i}, ${l}`},gs=(e=ae())=>{if(!e)return[];let t=st.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=ds(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},z=async(e=ae())=>{if(!e)return null;if(st.has(e))return st.get(e);if(Se||!Ne)return De(e);try{let t=await fs();if(!t)return De(e);let n=ms(t,e),s=await t.getDoc(n);if(s.exists()){let a=s.data(),i=Me({...a,weekId:e},e);return Wt(e,i),ot(i),Se=!1,i}let o=De(e);return typeof t.setDoc=="function"&&await t.setDoc(n,o,{merge:!0}),o}catch(t){return us(t)?(console.warn("Falling back to local planner data due to permission issue",t),Se=!0,De(e)):(console.error("Failed to load planner data",t),De(e))}},rt=async(e,t)=>{if(!e)return null;let n=await z(e),s=Vt(t);s.position=ls(n?.lessons||[],s.dayIndex);let o={...n,lessons:fe([...n?.lessons||[],s]),updatedAt:new Date().toISOString()},a=await oe(o);return se(a),a},re=async(e,t,n={})=>{if(!e||!t)return null;let s=await z(e),o=[...s?.lessons||[]],a=o.findIndex(y=>y.id===t);if(a===-1)return s;let i=o[a],r=Vt({...i,...n,id:t},i);if(r.dayIndex!==i.dayIndex){let y=o.filter((g,w)=>w!==a);r.position=ls(y,r.dayIndex)}o[a]=r;let l={...s,lessons:fe(o),updatedAt:new Date().toISOString()},d=await oe(l);return se(d),d},hs=async(e,t="")=>{if(!e)return null;let n=await z(e),s={...n,teacherNotes:typeof t=="string"?t:n?.teacherNotes||"",updatedAt:new Date().toISOString()},o=await oe(s);return se(o),o},bs=async(e,t)=>{if(!e||!t)return null;let n=await z(e),s=(n?.lessons||[]).filter(i=>i.id!==t),o={...n,lessons:fe(s),updatedAt:new Date().toISOString()},a=await oe(o);return se(a),a},Es=async(e,t,n)=>{if(!e||!t||!n)return null;let s=n==="up"?-1:n==="down"?1:0;if(!s)return z(e);let o=await z(e),a=[...o?.lessons||[]],i=a.findIndex(x=>x.id===t);if(i===-1)return o;let r=a[i],l=a.filter(x=>x.dayIndex===r.dayIndex);if(l.length<=1)return o;let y=fe(l).map(x=>x.id),g=y.indexOf(t);if(g===-1)return o;let w=g+s;if(w<0||w>=y.length)return o;let[I]=y.splice(g,1);y.splice(w,0,I);let k=new Map(y.map((x,m)=>[x,m])),N=a.map(x=>{if(x.dayIndex!==r.dayIndex)return x;let m=k.get(x.id);return typeof m=="number"?{...x,position:m}:x}),H={...o,lessons:fe(N),updatedAt:new Date().toISOString()},P=await oe(H);return se(P),P},Kt=async(e,t,n)=>{if(!e||!t)return null;let s=await z(e),o=[...s?.lessons||[]],a=o.findIndex(g=>g.id===t);if(a===-1)return s;let i=is(n);if(!i)return s;let r=o[a],l={...r,details:[...r.details||[],i]};o[a]=l;let d={...s,lessons:fe(o),updatedAt:new Date().toISOString()},y=await oe(d);return se(y),y},Yt=async(e,t)=>{if(!e||!t)return null;let n=await z(e),s=(n?.lessons||[]).map(i=>({title:i.title,summary:i.summary,dayIndex:i.dayIndex,notes:typeof i.notes=="string"?i.notes:"",subject:typeof i.subject=="string"?i.subject:"",period:typeof i.period=="string"?i.period:"",weekDay:typeof i.weekDay=="string"?i.weekDay:"",templateType:typeof i.templateType=="string"?i.templateType:"simple",status:"not_started",resources:Array.isArray(i.resources)?i.resources.map(r=>({label:r?.label||"",url:r?.url||""})):[],details:(i.details||[]).map(r=>({badge:r.badge,text:r.text}))})),o=Me({weekId:t,lessons:s,teacherNotes:typeof n?.teacherNotes=="string"?n.teacherNotes:""},t);o.updatedAt=new Date().toISOString();let a=await oe(o);return se(a),a},ws=async e=>{if(!e)return null;let t=await z(e);if(!t)return null;let n={...t,lessons:[],updatedAt:new Date().toISOString()},s=await oe(n);return se(s),s}});var Rr=Mo(()=>{Bo();Fo();ts();ss();Po();Ho();Ro();vs();Kn();function Jo(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let s=document.querySelectorAll("[data-open-reminder-modal]");if(!s.length)return;if(!e){let u=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};s.forEach(h=>{h.addEventListener("click",B=>{if(B.preventDefault(),typeof window<"u"){let M="#reminders";window.location.hash!==M&&(window.location.hash=M),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{u()})})});return}let o=e.querySelector("[data-reminder-modal-backdrop]"),a=e.querySelectorAll("[data-close-modal]"),i=document.getElementById("mainContent"),r=document.querySelector('nav[aria-label="Primary"]'),l=[i,r],d=e.querySelector('[role="dialog"]')??e,y=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],g=null,w=()=>{if(!(d instanceof HTMLElement))return[];let u=d.querySelectorAll(y.join(","));return Array.from(u).filter(h=>{let B=h instanceof HTMLElement,M=typeof SVGElement<"u"&&h instanceof SVGElement;if(!B&&!M||h.getAttribute("aria-hidden")==="true"||"disabled"in h&&h.disabled||h.hidden||h.closest("[hidden]"))return!1;let L=h.getBoundingClientRect();return L.width>0&&L.height>0})},I=()=>{let u=w(),h=u.find(B=>B.hasAttribute("data-autofocus")||B.hasAttribute("autofocus"))||(n&&u.includes(n)?n:null)||u[0];if(h&&typeof h.focus=="function"){h.focus({preventScroll:!0});return}d instanceof HTMLElement&&typeof d.focus=="function"&&d.focus({preventScroll:!0})},k=u=>{d instanceof HTMLElement&&(!(u.target instanceof Node)||!d.contains(u.target))&&(u.stopPropagation(),I())},N=u=>{if(u.key!=="Tab")return;let h=w();if(!h.length){u.preventDefault(),d instanceof HTMLElement&&d.focus({preventScroll:!0});return}let B=h[0],M=h[h.length-1],L=document.activeElement;if(u.shiftKey){(!d.contains(L)||L===B)&&(u.preventDefault(),M.focus());return}(!d.contains(L)||L===M)&&(u.preventDefault(),B.focus())},H=u=>{l.forEach(h=>{h&&(u?h.setAttribute("inert",""):h.removeAttribute("inert"))})},P=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),H(!1),document.removeEventListener("keydown",x,!0),e.removeEventListener("keydown",N,!0),e.removeEventListener("focusin",k,!0),g&&typeof g.focus=="function"&&g.focus(),g=null},x=u=>{u.key==="Escape"&&(u.preventDefault(),P())},m=({triggerElement:u}={})=>{u&&typeof u.focus=="function"?g=u:g=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),H(!0),document.addEventListener("keydown",x,!0),e.addEventListener("keydown",N,!0),e.addEventListener("focusin",k,!0),window.requestAnimationFrame(()=>{I()})},p=(u,h={})=>{try{document.dispatchEvent(new CustomEvent(u,{detail:h}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let B=document.createEvent("CustomEvent");B.initCustomEvent(u,!0,!0,h),document.dispatchEvent(B)}}},b=(u={})=>{p("cue:cancelled",u)};s.forEach(u=>{u.addEventListener("click",h=>{h.preventDefault();let M={trigger:h.currentTarget instanceof HTMLElement?h.currentTarget:null,mode:"create"};p("cue:prepare",M),p("cue:open",M)})}),a.forEach(u=>{u.addEventListener("click",h=>{h.preventDefault(),b({trigger:u,reason:"button"})})}),e.addEventListener("click",u=>{u.target===e&&b({reason:"backdrop"})}),o?.addEventListener("click",u=>{u.target===o&&b({reason:"backdrop"})}),document.addEventListener("cue:open",u=>{let h=u?.detail?.trigger,B=h instanceof HTMLElement?h:null;m({triggerElement:B})});let v=()=>{P()};document.addEventListener("cue:close",v),document.addEventListener("cue:cancelled",v);let T=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&T instanceof HTMLElement&&t.addEventListener("submit",u=>{u.preventDefault(),!T.matches(":disabled")&&T.click()}),T instanceof HTMLElement&&document.addEventListener("reminder:save",u=>{let h=u?.detail?.trigger;h&&h!==T||T.matches(":disabled")||T.click()})}Jo();function Gt(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var Ss=null;function ea(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function Ws(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function ta(e){typeof document>"u"||!e||(window.clearTimeout(Ss),Ss=window.setTimeout(()=>{let t=ea(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Re(e){let t=e||Ws();t&&ta(t)}function na(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Re()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",s=>{if(!(s.currentTarget instanceof HTMLAnchorElement))return;let o=s.currentTarget.getAttribute("href")||"";if(!o.startsWith("#"))return;s.preventDefault();let a=o||"#dashboard",i=a.replace("#","")||"dashboard";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Re(i)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Re()}na();var Ls=document.getElementById("settings-save-button"),it=document.getElementById("settings-save-confirmation"),j=document.getElementById("live-status"),Xt=null,me=document.getElementById("resourcePlannerStatus"),Qt=null;document.addEventListener("planner:reminderCreated",e=>{if(!j)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",s=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",o=s?`Reminder saved for ${s}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";j.textContent=o});Ls&&it&&Ls.addEventListener("click",e=>{e.preventDefault(),it.classList.remove("hidden"),it.textContent="Settings saved!",j&&(j.textContent="Settings saved!"),Xt&&window.clearTimeout(Xt),Xt=window.setTimeout(()=>{it.classList.add("hidden")},3e3)});function sa(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Re(t),j&&(j.textContent="Opening planner to add a new lesson."),Nt(),window.requestAnimationFrame(()=>{let s=yo();s&&typeof s.catch=="function"&&s.catch(o=>{console.error("Planner quick action failed to start new lesson flow",o)})})}function oa(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",sa)})}oa();function Zt(e,{tone:t="success"}={}){me&&(me.textContent=e,me.classList.remove("hidden"),me.classList.remove("text-success","text-error"),me.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(Qt&&window.clearTimeout(Qt),Qt=window.setTimeout(()=>{me.classList.add("hidden"),me.textContent=""},4e3))),j&&(j.textContent=e)}function vn(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function aa(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let s=n.getAttribute("data-resource-title")?.trim(),o=n.getAttribute("data-resource-link")?.trim();if(!s||!o)return;let a="#planner";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Re("planner"),Nt(),await Dt();let i=`${s} \u2014 ${o}`,r=er(),l=null;try{if(r)l=await Kt(E,r,{badge:"Resource",text:i});else{let d=vn("lesson"),y=S?.lessons?.[0]?.dayLabel||"Monday";l=await rt(E,{id:d,dayName:y,title:s,summary:`Resource link: ${o}`,details:[{badge:"Resource",text:i}]}),l&&(_=d)}if(l){S=l,O(l),$(l,E);let d=r?`Added "${s}" to your selected lesson.`:`Created a lesson for "${s}" in this week's planner.`;Zt(d);return}Zt("Unable to save that resource to the planner right now.",{tone:"error"})}catch(d){console.error("Failed to save resource to planner",d),Zt("Unable to save that resource to the planner right now.",{tone:"error"})}}function ra(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",aa)})}ra();var zs=document.getElementById("reminder-title"),ia=document.getElementById("reminderText"),X=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),s=e.querySelector(".modal-backdrop button"),o=document.getElementById("modal-title");return ns({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:s instanceof HTMLElement?s:null,titleInput:zs,modalTitle:o instanceof HTMLElement?o:null,defaultTitle:_t,editTitle:$t})})();X?.setEditMode(!1);var la=()=>{let e=!!zs;if(!!ia)return Je({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?Je(n):Je({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};la().catch(e=>{console.error("Failed to initialise reminders",e)});var an=Gn(),Jt=Yn({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{an?.handleSessionChange(e)}});if(Jt?.supabase){an?.setSupabaseClient(Jt.supabase);try{Jt.supabase.auth.getSession().then(({data:e})=>{an?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var ee=document.getElementById("cues-list"),en=document.getElementById("pinnedNotesCard"),xe=document.getElementById("pinnedNotesList"),he=document.getElementById("cue-form"),G=he?.querySelector("#cue-id-input"),ca=X?.defaultTitle||X?.modalTitle?.textContent?.trim()||_t,Gr=X?.editTitle||$t,bt=document.getElementById("tab-cues"),Et=document.getElementById("tab-daily"),$e=document.getElementById("cues-view"),Oe=document.getElementById("daily-list-view"),Ts=document.getElementById("daily-list-header"),Ks=document.getElementById("quick-add-form"),V=document.getElementById("quick-add-input"),K=document.getElementById("daily-voice-btn"),ie=document.getElementById("daily-tasks-container"),rn=document.getElementById("clear-completed-btn"),wt=document.getElementById("daily-list-permission-notice"),F=document.getElementById("plannerCards")||document.getElementById("planner-grid"),xs=document.getElementById("plannerWeekRange"),da=document.getElementById("planner-prev"),ua=document.getElementById("planner-next"),fa=document.getElementById("planner-today"),ma=document.getElementById("planner-copy-week"),pa=document.getElementById("planner-clear-week"),ya=document.getElementById("planner-duplicate-btn"),ga=document.getElementById("planner-new-lesson-btn"),ln=document.getElementById("planner-list-view-toggle"),cn=document.getElementById("planner-week-view-toggle"),qe=document.getElementById("plannerWeekView"),vt=document.querySelector("[data-planner-text-size]"),tn=document.querySelector("[data-planner-card-panel]"),As=document.getElementById("plannerSummaryCount"),St=document.getElementById("plannerSummaryRange"),ks=document.getElementById("plannerInsightsLessons"),Is=document.getElementById("plannerInsightsSubjects"),Cs=document.getElementById("plannerInsightsNotes"),le=document.getElementById("plannerTeacherNotes"),nn=document.getElementById("plannerTeacherNotesStatus"),lt=document.querySelector("[data-mobile-notes-text-size]"),sn=document.querySelector(".mobile-panel--notes"),Ys="plannerTextSizePreference",Lt="default",kt=new Set(["small","default","large"]),ha=["planner-text-small","planner-text-default","planner-text-large"],Gs="mobileNotesTextSizePreference",Tt="default",It=new Set(["small","default","large"]),ba=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function dn(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function Ea(){if(typeof localStorage>"u")return Lt;let e=localStorage.getItem(Ys);return e&&kt.has(e)?e:Lt}function wa(e){typeof localStorage>"u"||!kt.has(e)||localStorage.setItem(Ys,e)}function Xs(e){if(!tn)return;let t=kt.has(e)?e:Lt;ha.forEach(n=>tn.classList.remove(n)),tn.classList.add(`planner-text-${t}`)}var Qs=Ea();Xs(Qs);dn(vt)&&(vt.value=Qs);function Zs(){if(typeof localStorage>"u")return Tt;let e=localStorage.getItem(Gs);return e&&It.has(e)?e:Tt}function va(e){typeof localStorage>"u"||!It.has(e)||localStorage.setItem(Gs,e)}function Js(e){if(!sn)return;let t=It.has(e)?e:Tt;ba.forEach(n=>sn.classList.remove(n)),sn.classList.add(`mobile-panel--notes-size-${t}`)}var eo=Zs();Js(eo);lt instanceof HTMLSelectElement&&(lt.value=eo,lt.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:Tt;if(!It.has(t)){lt.value=Zs();return}va(t),Js(t)}));var Sa=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function La(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=Sa.findIndex(s=>s.toLowerCase()===t.toLowerCase());return n>=0?n:0}function Ta(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function xa(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),s=document.getElementById("planner-modal-description"),o=document.getElementById("planner-modal-error"),a=document.getElementById("planner-modal-submit"),i=document.getElementById("planner-modal-submit-add-another"),r=document.getElementById("planner-lesson-day"),l=document.getElementById("planner-lesson-period"),d=document.getElementById("planner-lesson-title"),y=document.getElementById("planner-lesson-summary"),g=document.getElementById("planner-lesson-subject"),w=document.getElementById("planner-lesson-status"),I=document.getElementById("planner-detail-badge"),k=document.getElementById("planner-detail-text"),N=document.getElementById("planner-duplicate-week"),H=t?.querySelectorAll("[data-summary-template]")||[];if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(a instanceof HTMLElement)||!(r instanceof HTMLSelectElement)||!(l instanceof HTMLInputElement)||!(d instanceof HTMLInputElement)||!(y instanceof HTMLTextAreaElement)||!(w instanceof HTMLSelectElement))return null;let P=t.querySelector("[data-planner-lesson-section]"),x=t.querySelector("[data-planner-summary-section]"),m=t.querySelector("[data-planner-detail-section]"),p=t.querySelector("[data-planner-duplicate-section]"),b=e.querySelector("[data-planner-modal-dialog]"),v=e.querySelector("[data-planner-modal-backdrop]"),T=e.querySelectorAll("[data-planner-modal-close]"),u=document.getElementById("mainContent"),h=document.querySelector('nav[aria-label="Primary"]'),B=(()=>{let c=[],f=e.parentElement;return h instanceof HTMLElement&&c.push(h),f instanceof HTMLElement?c.push(...Array.from(f.children).filter(A=>A instanceof HTMLElement&&A!==e)):u instanceof HTMLElement&&(u.contains(e)?c.push(...Array.from(u.children).filter(A=>A instanceof HTMLElement&&!A.contains(e))):c.push(u)),c})(),M=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],L={mode:"add",lessonId:null,trigger:null},We=null,Pn=null,Fn="",Hn="",te="simple",ze="save",ue=c=>{We=c instanceof HTMLElement?c:null},Rn=c=>{ze=c},Ce=c=>{if(!(w instanceof HTMLSelectElement))return;let f=W[c]?c:"not_started";w.value=f},Ke=c=>{let f=typeof c=="string"&&c.trim()?c.trim():"Monday";r.value=f,r.value!==f&&(r.value="Monday")},xo=c=>{let f=po(c||"simple");!f||typeof y.value=="string"&&y.value.trim()&&!window.confirm("Replace existing summary with this template?")||(y.value=f,te=c||"simple",y.focus())},_n=c=>{B.forEach(f=>{f&&(c?f.setAttribute("inert",""):f.removeAttribute("inert"))})},$n=()=>{if(!(b instanceof HTMLElement))return[];let c=b.querySelectorAll(M.join(","));return Array.from(c).filter(f=>{if(f.closest('[aria-hidden="true"]')||"disabled"in f&&f.disabled)return!1;let A=f.getBoundingClientRect();return A.width>0&&A.height>0})},On=()=>{let c=$n(),f=(We&&c.includes(We)?We:null)||c[0]||b;f&&typeof f.focus=="function"&&f.focus({preventScroll:!0})},qn=c=>{b instanceof HTMLElement&&(b.contains(c.target)||On())},Ao=c=>{if(c.key!=="Tab")return;let f=$n();if(!f.length){c.preventDefault();return}let A=f[0],Ee=f[f.length-1];if(c.shiftKey&&document.activeElement===A){c.preventDefault(),Ee.focus();return}!c.shiftKey&&document.activeElement===Ee&&(c.preventDefault(),A.focus())},Un=c=>{if(c.key==="Escape"){c.preventDefault(),Q();return}Ao(c)},jn=()=>{o&&(o.textContent="",o.classList.add("hidden"),o.setAttribute("aria-hidden","true"))},ne=c=>{o&&(o.textContent=c,o.classList.remove("hidden"),o.removeAttribute("aria-hidden"))},Vn=c=>{a.disabled=!!c,a.classList.toggle("loading",!!c),i instanceof HTMLButtonElement&&(i.disabled=!!c,i.classList.toggle("loading",!!c))},R=(c,f)=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!f),f?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"))},Ye=c=>{[r,l,d,y,g,w].forEach(f=>{f instanceof HTMLElement&&(f.disabled=!!c,f.classList.toggle("opacity-60",!!c),f.classList.toggle("cursor-not-allowed",!!c))}),H.forEach(f=>{f instanceof HTMLButtonElement&&(f.disabled=!!c,f.classList.toggle("opacity-60",!!c),f.classList.toggle("cursor-not-allowed",!!c))})},be=()=>{t.reset(),jn(),ue(null),Ye(!1),g instanceof HTMLInputElement&&(g.value=""),l instanceof HTMLInputElement&&(l.value=""),I instanceof HTMLInputElement&&(I.value=""),(k instanceof HTMLTextAreaElement||k instanceof HTMLInputElement)&&(k.value=""),N instanceof HTMLInputElement&&(N.value=""),Ce("not_started"),te="simple",ze="save"},Ge=({title:c,description:f,action:A})=>{n&&(n.textContent=c||"Plan lesson"),s&&(s.textContent=f||""),a.textContent=A||"Save lesson"},Xe=({trigger:c}={})=>{L.trigger=c instanceof HTMLElement?c:null,Pn=L.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),_n(!0),document.addEventListener("keydown",Un,!0),e.addEventListener("focusin",qn,!0),window.requestAnimationFrame(()=>{On()})},Q=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),_n(!1),document.removeEventListener("keydown",Un,!0),e.removeEventListener("focusin",qn,!0);let c=L.trigger||Pn;L.mode="add",L.lessonId=null,L.trigger=null,ue(null),be(),c&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},ko=({defaultDay:c="Monday",trigger:f}={})=>{L.mode="add",L.lessonId=null,be(),R(P,!0),R(x,!0),R(m,!1),R(p,!1),Ye(!1);let A=typeof c=="string"&&c.trim()?c.trim():"Monday";Ke(A),d.value=A?`${A} lesson`:"",y.value="",l instanceof HTMLInputElement&&(l.value=""),g instanceof HTMLInputElement&&(g.value=""),Ce("not_started"),te="simple",Ge({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),ue(d),Xe({trigger:f})},Io=({lesson:c,trigger:f}={})=>{if(!c)return;L.mode="edit",L.lessonId=c.id,be(),R(P,!0),R(x,!0),R(m,!1),R(p,!1),Ye(!1);let A=c.dayLabel||c.dayName||"Monday";Ke(A),d.value=c.title||"",y.value=c.summary||"",l instanceof HTMLInputElement&&(l.value=c.period||""),g instanceof HTMLInputElement&&(g.value=c.subject||""),Ce(c.status||"not_started"),te=c.templateType||"simple",Ge({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),ue(d),Xe({trigger:f})},Co=({lesson:c,trigger:f}={})=>{if(!c)return;L.mode="detail",L.lessonId=c.id,be(),R(P,!0),R(x,!0),R(m,!0),R(p,!1),Ye(!0);let A=c.dayLabel||c.dayName||"Monday";Ke(A),d.value=c.title||"",y.value=c.summary||"",l instanceof HTMLInputElement&&(l.value=c.period||""),g instanceof HTMLInputElement&&(g.value=c.subject||""),Ce(c.status||"not_started"),te=c.templateType||"simple",I instanceof HTMLInputElement&&(I.value=""),(k instanceof HTMLTextAreaElement||k instanceof HTMLInputElement)&&(k.value=""),Ge({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),ue(k instanceof HTMLElement?k:null),Xe({trigger:f})},Do=({suggestedWeekId:c="",trigger:f}={})=>{L.mode="duplicate",L.lessonId=null,be(),R(P,!1),R(x,!1),R(m,!1),R(p,!0),N instanceof HTMLInputElement&&(N.value=c),Ge({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),ue(N instanceof HTMLElement?N:null),Xe({trigger:f})},No=async c=>{c.preventDefault(),jn(),Vn(!0);let f=ze==="add_another";try{if(L.mode==="duplicate"){let q=N?.value?.trim();if(!q){ne("Enter the Monday date for the destination week.");return}if(q===E){ne("Choose a different week to duplicate into.");return}let we=await Yt(E,q);we&&(E=q,Ln(q),S=we,O(we),$(we,q),Q());return}if(L.mode==="detail"){if(!L.lessonId){ne("Select a lesson before adding details.");return}let q=k?.value?.trim();if(!q){ne("Add text for this detail.");return}let we=I?.value?.trim()||"",Ze=await Kt(E,L.lessonId,{badge:we,text:q});Ze&&(S=Ze,O(Ze),$(Ze,E),Q());return}let A=r.value.trim(),Ee=l?.value?.trim()||"",Bt=d.value.trim(),Wn=y.value.trim(),Pt=g?.value?.trim()||"",zn=W[w?.value]?w.value:"not_started";if(!A){ne("Choose a day for this lesson.");return}if(!Bt){ne("Enter a lesson title.");return}if(L.mode==="edit"){if(!L.lessonId){ne("Select a lesson to edit.");return}let q=await re(E,L.lessonId,{dayName:A,title:Bt,summary:Wn,subject:Pt,period:Ee,status:zn,templateType:te||"simple"});q&&(S=q,O(q),$(q,E),Q());return}let Qe=await rt(E,{dayName:A,title:Bt,summary:Wn,subject:Pt,period:Ee,status:zn,templateType:te||"simple"});Qe&&(S=Qe,O(Qe),$(Qe,E),f?(Fn=A,Hn=Pt,be(),Ke(Fn||"Monday"),d.value=r.value?`${r.value} lesson`:"",g instanceof HTMLInputElement&&(g.value=Hn||""),Ce("not_started"),te="simple",ue(d)):Q())}catch(A){console.error("Failed to save planner change",A),ne("Unable to save changes right now. Please try again.")}finally{Vn(!1),ze="save"}};return i instanceof HTMLButtonElement&&i.addEventListener("click",()=>Rn("add_another")),a.addEventListener("click",()=>Rn("save")),H.forEach(c=>{c instanceof HTMLButtonElement&&c.addEventListener("click",f=>{f.preventDefault();let A=c.dataset.summaryTemplate||"simple";xo(A)})}),t.addEventListener("submit",No),T.forEach(c=>{c.addEventListener("click",f=>{f.preventDefault(),Q()})}),e.addEventListener("click",c=>{c.target===e&&Q()}),v?.addEventListener("click",c=>{c.target===v&&Q()}),{openAddLesson:ko,openEditLesson:Io,openAddDetail:Co,openDuplicatePlan:Do,close:Q}}var Ds=document.getElementById("remindersCount"),ce=typeof document<"u"?xa():null,Ns=document.getElementById("plannerCount"),Ms=document.getElementById("plannerSubtitle"),Xr=document.getElementById("resourcesCount"),Qr=document.getElementById("templatesCount"),ct=document.getElementById("dailySnapshotList"),dt=document.getElementById("todaysFocusList"),Z=document.getElementById("weekAtAGlanceList"),J=null;Z&&(J=document.createElement("li"),J.dataset.emptyState="week",J.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",J.textContent="No upcoming events this week.");var Bs=()=>{if(!Z||!J)return;Z.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?Z.contains(J)||Z.appendChild(J):Z.contains(J)&&Z.removeChild(J)};Z&&(Bs(),new MutationObserver(Bs).observe(Z,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var on=e=>{en&&(e?en.classList.remove("hidden"):en.classList.add("hidden"))},Ue={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Ps=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),Fs=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),yt=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",Sn=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},Aa=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),to=e=>{if(!e)return"";if(Ps)try{return Ps.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},ka=e=>{if(!e)return"";if(Fs)try{return Fs.format(e)}catch{}return e.toLocaleDateString()},no=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Ue,t)?t:"medium"},Hs=e=>{let t=no(e);return Ue[t]?.rank??Ue.medium.rank},Ia=e=>{let t=no(e);return Ue[t]??Ue.medium},Rs=e=>{let t=Sn(e);return t?t.getTime():Number.POSITIVE_INFINITY};function so(e=[]){if(!ct)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(s=>({reminder:s,date:Sn(s)})).filter(({date:s})=>s&&Aa(s,t)).sort((s,o)=>s.date.getTime()-o.date.getTime());if(!n.length){ct.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}ct.innerHTML="",n.forEach(({reminder:s,date:o})=>{let a=document.createElement("li");a.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=yt(s),a.appendChild(i);let r=to(o),l=document.createElement("p");l.className="text-xs text-base-content/70",l.textContent=r?`Due ${r}`:"Due today",a.appendChild(l),ct.appendChild(a)})}function oo(e=[]){if(!dt)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,s)=>{let o=Hs(n)-Hs(s);if(o!==0)return o;let a=Rs(n)-Rs(s);return a!==0?a:yt(n).localeCompare(yt(s),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){dt.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}dt.innerHTML="",t.forEach(n=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let o=document.createElement("div");o.className="flex items-center justify-between gap-3";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=yt(n),o.appendChild(a);let i=Ia(n),r=document.createElement("span");r.className=i.badgeClass,r.textContent=i.badgeLabel,o.appendChild(r),s.appendChild(o);let l=Sn(n),d=document.createElement("p");if(d.className="text-xs text-base-content/70",l){let y=to(l),g=ka(l),w=[];y&&w.push(`Due ${y}`),g&&w.push(g),d.textContent=w.length?w.join(" \u2022 "):"Due soon"}else d.textContent="No due date";s.appendChild(d),dt.appendChild(s)})}var Ca=e=>{if(!Ds)return;let t=Array.isArray(e)?e.length:0;Ds.textContent=String(t)},Da=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Ca(t),so(t),oo(t)};document.addEventListener("memoryCue:remindersUpdated",Da);so();oo();var un=Qn(Xn),Na={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},ut=null,Ma=3,_s=120;function Ba(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=_s?t:`${t.slice(0,_s-1)}\u2026`:""}function Pa(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let s=n.trim().toLowerCase();return s==="true"||s==="1"||s==="yes"}return!1})}function $s(e){if(!xe)return;let t=Array.isArray(e)?e:[];if(!t.length){xe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',on(!1);return}let n=t.filter(a=>Pa(a));if(!n.length){xe.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',on(!1);return}on(!0);let o=n.slice(0,Ma).map(a=>{let i=C(ve(a,"title")||"Untitled Cue"),r=ve(a,"details"),l=C(Ba(r)),d=l?`<p class="mt-1 text-sm text-base-content/70">${l}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${i}</p>
          ${d}
        </li>
      `}).join("");xe.innerHTML=o}function fn(e,{tone:t="muted"}={}){if(!ee)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),ee.innerHTML=`<p class="${n.join(" ")}">${C(e)}</p>`}function Fa(e){if(!ee)return;if(!Array.isArray(e)||e.length===0){fn("No cues yet.");return}let t=e.map(n=>{let s=C(ve(n,"title")||"Untitled Cue"),o=C(ve(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${s}</h2>
            ${o?`<p>${o}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${C(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${C(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");ee.innerHTML=t}async function Ve(){return ut||(ut=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:s,enableIndexedDbPersistence:o,collection:a,doc:i,getDoc:r,addDoc:l,updateDoc:d,getDocs:y,query:g,orderBy:w,serverTimestamp:I,setDoc:k,arrayUnion:N}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),H=t(),P=H&&H.length?H[0]:e(Na),x=n(P);(function(){let b=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;b&&(b.__persistenceInitialized__||(b.__persistenceInitialized__=!0,(async()=>{try{await s(x),console.info("[Firestore] Persistence: multi-tab enabled")}catch(v){if(v&&v.code==="failed-precondition")try{await o(x),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(T){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",T?.code||T)}else v&&v.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",v?.code||v)}})()))})();let m=a(x,"cues");return{db:x,cuesCollection:m,getCollection:a,doc:i,getDoc:r,addDoc:l,updateDoc:d,getDocs:y,query:g,orderBy:w,serverTimestamp:I,setDoc:k,arrayUnion:N}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),ut)}async function Ha(){let e=await Ve(),{getDocs:t,cuesCollection:n,query:s,orderBy:o}=e,a=s&&o?s(n,o("createdAt","desc")):n;return(await t(a)).docs.map(r=>({id:r.id,...r.data()}))}async function Ra(e){if(!e)return null;let t=await Ve(),{db:n,doc:s,getDoc:o}=t,a=s(n,"cues",e),i=await o(a);return i.exists()?{id:i.id,...i.data()}:null}async function ao(){if(!(!ee&&!xe))try{let e=await Ha();Fa(e),$s(e)}catch(e){console.error("Failed to load cues",e),Mt(e)?fn("Sign in to view your cues.",{tone:"muted"}):fn("Unable to load cues right now.",{tone:"error"}),$s([])}}function _a(e){!he||!G||(Zn(e,un),G.value=e?.id||"",X?.setEditMode(!0),X?.show({mode:"edit"}))}async function $a(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let s=await Ra(n);if(!s)return;_a(s)}catch(s){console.error("Failed to prepare cue for editing",s)}}async function Oa(e){if(e.preventDefault(),!he||!G)return;let t=G.value.trim(),n=es(un);try{let s=await Ve(),{db:o,doc:a,addDoc:i,updateDoc:r,cuesCollection:l,serverTimestamp:d}=s,y=typeof d=="function"?d():null;if(t){let g=a(o,"cues",t),w={...n};y&&(w.updatedAt=y),await r(g,w)}else{let g={...n};y&&(g.createdAt=y,g.updatedAt=y),await i(l,g)}await ao(),Jn(un,G,X?.modalTitle??null,ca),await X?.hide({reason:"form-submit"})}catch(s){console.error("Failed to save cue",s)}}async function qa(){!he||!G||!ee||(ee.addEventListener("click",$a),he.addEventListener("submit",Oa))}he&&G&&(document.addEventListener("cue:prepare",()=>{G.value="",X?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{G.value="",X?.setEditMode(!1)}));he&&G&&ee&&qa().catch(e=>{console.error("Failed to initialise cue editing",e)});(ee||xe)&&ao();var D=[],ft=null,ye=!1,ke=ae(),_e=!1,E=ke,S=null,He=null,_=null,xt=new Map,Ua=800,ro=1500,mn={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},io=new Set(["saving","saved","error"]),lo="plannerNotesOpenState",pe=Va(),mt=null,co="list",ja=800;function Va(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(lo);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function Wa(){if(!(typeof localStorage>"u"))try{localStorage.setItem(lo,JSON.stringify(pe))}catch(e){console.warn("Unable to persist planner notes state",e)}}function za(e){return e?!!pe?.[e]:!1}function Ka(e,t){if(e){if(t)pe={...pe,[e]:!0};else if(pe?.[e]){let n={...pe};delete n[e],pe=n}Wa()}}function Ya(e,t=ke){return Array.isArray(e)?e:e&&typeof e=="object"&&Array.isArray(e.lessons)?e.lessons:typeof t=="string"&&t?gs(t):[]}var Ga=(e=[])=>{if(!Ns)return;let t=Array.isArray(e)?e.length:0;Ns.textContent=String(t)};function Xa(e=[]){let t=Array.isArray(e)?e:[];if(ks&&(ks.textContent=String(t.length)),Is){let n=new Set;t.forEach(s=>{let o=Tn(s);o&&n.add(o.toLowerCase())}),Is.textContent=String(n.size)}if(Cs){let n=t.filter(s=>typeof s.notes=="string"&&s.notes.trim().length>0).length;Cs.textContent=String(n)}}function $(e,t){let n=Ya(e,t);Ga(n);let s=e?.weekId||t||ke,o=zt(s,{short:!0});Ms&&(Ms.textContent=o||""),As&&(As.textContent=String(n.length)),St&&(St.textContent=o||""),Xa(n)}function pn(e,{tone:t="muted"}={}){if(!F)return;_=null;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),F.innerHTML=`<p class="${n.join(" ")}">${C(e)}</p>`}function Ln(e){if(!xs)return;let t=zt(e);xs.textContent=t||"",St&&(St.textContent=t||"")}function Tn(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function uo(e){if(!e)return"badge-ghost";let t=e.toLowerCase();return t.includes("hpe")||t.includes("pe")?"badge-info":t.includes("english")?"badge-success":t.includes("civics")||t.includes("cac")?"badge-secondary":t.includes("geo")?"badge-warning":"badge-ghost"}var W={not_started:{label:"Not started",badge:"badge-ghost"},in_progress:{label:"In progress",badge:"badge-warning"},ready:{label:"Ready",badge:"badge-success"},taught:{label:"Taught",badge:"badge-neutral"}};function Qa(e,t){let n=W[t]?t:"not_started",s=Object.entries(W).map(([o,a])=>`<option value="${o}" ${o===n?"selected":""}>${C(a.label)}</option>`).join("");return`
    <label class="flex items-center gap-2 text-xs font-semibold text-base-content/80">
      <span>Status</span>
      <select class="select select-bordered select-xs" data-lesson-status="true" data-lesson-id="${e}">
        ${s}
      </select>
    </label>
  `}function Za(e=[],t=""){return e.length?`
    <ul class="space-y-2">
      ${e.map(n=>{let s=typeof n?.label=="string"&&n.label.trim()?n.label.trim():"Resource",o=typeof n?.url=="string"?n.url.trim():"",a=typeof n?.id=="string"?n.id:"",i=o?`<a class="link link-primary break-words" href="${o}" target="_blank" rel="noreferrer">${C(s)}</a>`:`<span class="text-base-content">${C(s)}</span>`,r=a?`<button class="btn btn-ghost btn-xs text-error" type="button" data-planner-action="remove-resource" data-lesson-id="${t}" data-resource-id="${a}">Remove</button>`:"";return`<li class="flex items-start justify-between gap-2 rounded-lg bg-base-200/70 px-2 py-1">${i}${r}</li>`}).join("")}
    </ul>
  `:'<p class="text-xs text-base-content/60">No resources added yet.</p>'}function O(e){if(!F)return;sr(e);let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){pn("No lessons saved for this week yet."),yn([]);return}let n=t,s=n.map(a=>typeof a.id=="string"&&a.id?a.id:"").filter(a=>!!a);_&&!s.includes(_)&&(_=null);let o=n.map(a=>{let i=Array.isArray(a.details)?a.details.map(h=>`
                <li class="flex items-center gap-2">
                  ${h.badge?`<span class="badge badge-outline badge-sm text-secondary">${C(h.badge)}</span>`:""}
                  <span class="text-sm text-base-content/80">${C(h.text)}</span>
                </li>
              `).join(""):"",r=i?`<ul class="space-y-2 text-sm text-base-content/80">${i}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',l=typeof a.id=="string"?a.id:"",d=!!(_&&l&&_===l),y=["data-planner-lesson",l?`data-lesson-id="${l}"`:"",d?'data-planner-selected="true"':""].filter(Boolean).join(" "),g=a.summary?`<p class="text-sm text-base-content/80">${C(a.summary)}</p>`:"",w=Tn(a),I=uo(w),k=w?`<span class="badge ${I} badge-sm">${C(w)}</span>`:"",N=typeof a.notes=="string"?a.notes:"",H=za(l),P=l?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${l}"
              ${H?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${l}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${C(N)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${C(mn.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",x=l?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${l}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${l}"
              >
                Move down
              </button>
            </div>
          `:"",m=l?Qa(l,a.status):"",p=Za(Array.isArray(a.resources)?a.resources:[],l),b=W[a.status]?.badge||W.not_started.badge,v=W[a.status]?.label||W.not_started.label,T=[a.weekDay||a.dayLabel||"Lesson"];a.period&&T.push(a.period);let u=T.filter(Boolean).join(" \xB7 ");return`
        <article class="card border border-base-300 bg-base-100 shadow-lg transition hover:-translate-y-1 hover:shadow-xl" ${y}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-3">
              <div class="space-y-2">
                <div class="flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">
                  <span>${C(u)}</span>
                  <span class="badge ${b} badge-xs">${C(v)}</span>
                </div>
                <div class="flex flex-wrap items-center gap-2">
                  <h2 class="text-lg font-semibold text-base-content">${C(a.title||a.dayLabel||"Lesson")}</h2>
                  ${k}
                </div>
                ${g}
                <div class="flex flex-wrap items-center gap-3">
                  ${m}
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                ${x}
                <div class="flex flex-wrap justify-end gap-1">
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="duplicate" data-lesson-id="${l}">Duplicate</button>
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${l}">
                    Edit
                  </button>
                  <button
                    type="button"
                    class="btn btn-ghost btn-xs text-error"
                    data-planner-action="delete"
                    data-lesson-id="${l}"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
            ${r}
            <div class="rounded-xl border border-base-200 bg-base-200/60 p-3">
              <div class="flex flex-wrap items-center justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold uppercase tracking-[0.2em] text-base-content/60">Resources</p>
                  <p class="text-xs text-base-content/70">Link slides, videos, and activity sheets.</p>
                </div>
                <span class="badge badge-outline badge-sm">${Array.isArray(a.resources)?a.resources.length:0} linked</span>
              </div>
              <div class="mt-2 space-y-2">
                ${p}
                <div class="grid gap-2 md:grid-cols-[1fr_1.5fr_auto]">
                  <input
                    type="text"
                    class="input input-bordered input-sm w-full"
                    placeholder="Label (e.g. Slides)"
                    data-resource-label="true"
                    data-lesson-id="${l}"
                  />
                  <input
                    type="url"
                    class="input input-bordered input-sm w-full"
                    placeholder="URL"
                    data-resource-url="true"
                    data-lesson-id="${l}"
                  />
                  <button
                    type="button"
                    class="btn btn-outline btn-sm"
                    data-planner-action="add-resource"
                    data-lesson-id="${l}"
                  >
                    Add resource
                  </button>
                </div>
              </div>
            </div>
            ${P}
            <div class="flex flex-wrap items-center gap-2">
              <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-xs">Add template</label>
                <ul tabindex="0" class="dropdown-content menu rounded-box z-[1] mt-2 w-64 bg-base-100 p-2 shadow">
                  <li><button type="button" data-planner-action="apply-template" data-template-type="simple" data-lesson-id="${l}">Simple lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="hpe" data-lesson-id="${l}">HPE lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="english" data-lesson-id="${l}">English lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="cac" data-lesson-id="${l}">CAC lesson template</button></li>
                </ul>
              </div>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${l}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${l}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");F.innerHTML=o,xn(_),yn(n)}function yn(e=[]){if(!qe)return;let n=["Monday","Tuesday","Wednesday","Thursday","Friday"].map((o,a)=>({day:o,index:a,lessons:[]}));e.forEach(o=>{let a=Number.isFinite(o?.dayIndex)?o.dayIndex:0,i=n.find(r=>r.index===a);i&&i.lessons.push(o)});let s=n.map(({day:o,lessons:a})=>{let i=a.map(l=>{let d=Tn(l),y=uo(d),g=W[l.status]?.label||W.not_started.label,w=W[l.status]?.badge||W.not_started.badge;return`
            <button
              type="button"
              class="w-full text-left rounded-xl border border-base-200 bg-base-100 px-3 py-2 shadow-sm transition hover:-translate-y-[1px] hover:shadow"
              data-week-view-lesson="${l.id||""}"
            >
              <div class="flex items-start justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold text-base-content/70">${C(l.title||l.dayLabel||"Lesson")}</p>
                  <p class="text-xs text-base-content/60">${C(l.summary||"")}</p>
                </div>
                <div class="flex flex-col items-end gap-1">
                  ${d?`<span class="badge ${y} badge-xs">${C(d)}</span>`:""}
                  <span class="badge ${w} badge-xs">${C(g)}</span>
                </div>
              </div>
            </button>
          `}).join("");return`
        <div class="space-y-2 rounded-2xl border border-base-200 bg-base-200/50 p-3">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-base-content/70">${o}</p>
          <div class="space-y-2">${i||'<p class="text-xs text-base-content/60">No lessons yet.</p>'}</div>
        </div>
      `}).join("");qe.innerHTML=s}function gt(e="list"){let t=e==="week"?"week":"list";co=t,F&&F.classList.toggle("hidden",t==="week"),qe&&qe.classList.toggle("hidden",t!=="week"),ln instanceof HTMLElement&&ln.setAttribute("aria-pressed",t==="list"?"true":"false"),cn instanceof HTMLElement&&cn.setAttribute("aria-pressed",t==="week"?"true":"false"),t==="week"&&yn(S?.lessons||[])}function xn(e){_=e||null,F&&F.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function Ja(e){let t=e.target instanceof Element?e.target.closest("[data-week-view-lesson]"):null;if(!t)return;let n=t.getAttribute("data-week-view-lesson");if(!n)return;gt("list"),xn(n);let s=F?.querySelector(`[data-lesson-id="${n}"]`);s instanceof HTMLElement&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"center"})}function er(){return _&&(Array.isArray(S?.lessons)?S.lessons:[]).some(t=>t.id===_)?_:null}function tr(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===_||xn(n)}function nr(e){let t=dn(e?.currentTarget)?e.currentTarget:vt;if(!dn(t))return;let n=t.value,s=kt.has(n)?n:Lt;Xs(s),wa(s),t.value!==s&&(t.value=s)}function Ct(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function fo(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function mo(e){if(!e)return;let t=xt.get(e);if(!t)return;let n=fo();n&&n(t),xt.delete(e)}function Pe(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&io.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Fe(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&io.has(t)?t:null,s=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(s instanceof HTMLElement){let o=n||"idle",a=mn[o]||mn.idle;s.textContent=a,s.setAttribute("data-status",o)}}function sr(e){if(!(le instanceof HTMLTextAreaElement))return;Le("idle");let t=typeof e?.teacherNotes=="string"?e.teacherNotes:"";le.value!==t&&(le.value=t)}function Le(e="idle"){if(!(nn instanceof HTMLElement))return;let t={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},n=t[e]||t.idle;nn.textContent=n,nn.setAttribute("data-status",e)}async function or(e){if(E){Le("saving");try{let t=await hs(E,e);t&&(S=t),Le("saved");let n=Ct();n?n(()=>Le("idle"),ro):Le("idle")}catch(t){console.error("Failed to save teacher notes",t),Le("error")}}}function ar(e){if(!(le instanceof HTMLTextAreaElement)||e?.target!==le)return;if(mt){let n=fo();n&&n(mt)}let t=Ct();t&&(mt=t(()=>{mt=null,or(le.value)},ja))}function po(e="simple"){switch(e){case"hpe":return`Focus skill:
Warm-up:
Skill drill:
Modified game:
Reflection questions:`;case"english":return`Text focus:
Discussion questions:
Mentor sentence:
Writing task:
Reflection / exit ticket:`;case"cac":return`Civics topic:
Key terms:
Source / video:
Discussion questions:
Activity:
Reflection question:`;case"simple":default:return`Learning intention:
Success criteria:
Warm-up:
Main activity:
Exit task:`}}async function rr(e,t){if(!e)return;await Dt();let n=S?.lessons?.find(i=>i.id===e);if(!n)return;let s=po(t),o=typeof n.notes=="string"?n.notes:"";if(o&&typeof window<"u"&&typeof window.confirm=="function"&&!window.confirm("Add this template to the existing notes?"))return;let a=o?`${o.trim()}

${s}`:s;try{let i=await re(E,e,{notes:a,templateType:t||"simple"});i&&(S=i,O(i),$(i,E))}catch(i){console.error("Failed to apply lesson template",i)}}async function ir(e){let t=e.target instanceof HTMLSelectElement&&e.target.hasAttribute("data-lesson-status")?e.target:null;if(!t)return;let n=t.getAttribute("data-lesson-id"),s=t.value;if(n)try{let o=await re(E,n,{status:s});o&&(S=o,O(o),$(o,E))}catch(o){console.error("Failed to update lesson status",o)}}async function lr(e,t,n){if(!e||!(t instanceof HTMLInputElement)||!(n instanceof HTMLInputElement))return;let s=t.value.trim(),o=n.value.trim();if(!s&&!o)return;let a=S?.lessons?.find(r=>r.id===e);if(!a)return;let i=Array.isArray(a.resources)?[...a.resources]:[];i.push({id:vn("resource"),label:s,url:o});try{let r=await re(E,e,{resources:i});r&&(S=r,O(r)),t.value="",n.value=""}catch(r){console.error("Failed to add resource",r)}}async function cr(e,t){if(!e||!t)return;let n=S?.lessons?.find(o=>o.id===e);if(!n)return;let s=(n.resources||[]).filter(o=>o?.id!==t);try{let o=await re(E,e,{resources:s});o&&(S=o,O(o))}catch(o){console.error("Failed to remove resource",o)}}async function gn(e,t,n){if(!e||!E)return;let s=n instanceof HTMLTextAreaElement?n:null;s&&(Pe(s,"saving"),Fe(s,"saving"));try{let o=await re(E,e,{notes:t});if(o&&(S=o),s){Pe(s,"saved"),Fe(s,"saved");let a=Ct();a?a(()=>{s.getAttribute("data-notes-status")==="saved"&&(Pe(s,null),Fe(s,null))},ro):(Pe(s,null),Fe(s,null))}}catch(o){console.error("Failed to save planner notes",o),s&&(Pe(s,"error"),Fe(s,"error"))}}function dr(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;mo(n);let s=Ct();if(!s){gn(n,t.value,t);return}let o=s(()=>{xt.delete(n),gn(n,t.value,t)},Ua);xt.set(n,o)}function ur(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(mo(n),gn(n,t.value,t))}function fr(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let s=t.hasAttribute("open");Ka(n,s)}function Te(e){if(!F)return He=null,Promise.resolve();let t=e||ae();E=t,Ln(t),pn("Loading plan\u2026");let n=(async()=>{try{let s=await z(t);S=s,O(s),$(s,t)}catch(s){console.error("Failed to load planner week",s),pn("Unable to load this week's planner.",{tone:"error"})}})();return He=n,n.finally(()=>{He===n&&(He=null)})}async function Dt(){if(!F)return;_e||Nt();let e=He;if(!e&&(!S||S.weekId!==E)&&(e=Te(E)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function mr(e,t){if(!e)return;await Dt();let n=Array.isArray(S?.lessons)?S.lessons:[];if(!n.length)return;let s=n.find(I=>I?.id===e);if(!s)return;let o=typeof s.dayLabel=="string"&&s.dayLabel.trim()?s.dayLabel.trim():typeof s.dayName=="string"&&s.dayName.trim()?s.dayName.trim():"",a=typeof s.title=="string"&&s.title.trim()?s.title.trim():o||"Lesson",i=typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():"",r=i||a,l=o?`${o} \xB7 ${r}`:r,d=i||"",y=La(s),g=Ta(ys(E,y)),w={reminderTitle:l,reminderNotes:d,dueDate:g,dayLabel:o,lessonTitle:a,summary:i,plannerLessonId:e};Gt("cue:prepare",{trigger:t,source:"planner"}),Gt("planner:prefillReminder",w),Gt("cue:open",{trigger:t,source:"planner"})}async function pr(e,t){if(!e)return;await Dt();let s=(Array.isArray(S?.lessons)?S.lessons:[]).find(r=>r?.id===e);if(!s)return;let o=t instanceof HTMLElement?t:null;o&&o.setAttribute("disabled","true");let a=vn("lesson"),i={id:a,dayIndex:s.dayIndex,dayLabel:s.dayLabel,dayName:s.dayName,title:s.title,summary:s.summary,subject:s.subject,notes:s.notes,period:s.period,templateType:s.templateType||"simple",status:"not_started",resources:Array.isArray(s.resources)?s.resources.map(r=>({label:r?.label||"",url:r?.url||""})):[],details:Array.isArray(s.details)?s.details.map(r=>({badge:r?.badge||"",text:r?.text||""})):[]};try{let r=await rt(E,i),l=r;r&&Number.isFinite(s.position)&&(l=await re(E,a,{position:s.position+.1})),l&&(S=l,_=a,O(l),$(l,E),j&&(j.textContent=`Duplicated ${s.title||"lesson"} into this week.`))}catch(r){console.error("Failed to duplicate planner lesson",r),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function yr(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),s=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":Er(s,t);break;case"edit":wr(s,t);break;case"delete":vr(s);break;case"duplicate":await pr(s,t);break;case"apply-template":{let o=t.getAttribute("data-template-type")||"simple";rr(s,o);break}case"add-resource":{let o=t.closest("[data-planner-lesson]"),a=o?.querySelector("input[data-resource-label][data-lesson-id]"),i=o?.querySelector("input[data-resource-url][data-lesson-id]");await lr(s,a,i);break}case"remove-resource":{let o=t.getAttribute("data-resource-id");await cr(s,o);break}case"move-up":Os(s,"up",t);break;case"move-down":Os(s,"down",t);break;case"create-reminder":await mr(s,t);break;default:break}}async function yo(e){if(typeof document>"u"||!ce)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=S?.lessons?.[0]?.dayLabel||"Monday";ce.openAddLesson({defaultDay:n,trigger:t})}async function gr(e){if(!ce)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Be(E,1);ce.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function hr(e){if(!E)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Be(E,-1);if(n){t&&t.setAttribute("disabled","true");try{let s=await Yt(n,E);s&&(S=s,_=null,O(s),$(s,E),j&&(j.textContent="Copied last week into this plan."))}catch(s){console.error("Failed to copy previous planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{t&&t.removeAttribute("disabled")}}}async function br(e){if(!E)return;e?.preventDefault?.();let t=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(t=window.confirm("Clear all lessons for this week?")),!t)return;let n=e?.currentTarget instanceof HTMLElement?e.currentTarget:null;n&&n.setAttribute("disabled","true");try{let s=await ws(E);s&&(S=s,_=null,O(s),$(s,E),j&&(j.textContent="Cleared this week's plan."))}catch(s){console.error("Failed to clear planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function Er(e,t){if(!e||!ce)return;let n=S?.lessons?.find(o=>o.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;ce.openAddDetail({lesson:n,trigger:s})}async function wr(e,t){if(!e||!ce)return;let n=S?.lessons?.find(o=>o.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;ce.openEditLesson({lesson:n,trigger:s})}async function Os(e,t,n){if(!e||!t)return;let s=E||ae();if(!s)return;let o=n instanceof HTMLElement?n:null;o&&o.setAttribute("disabled","true");try{let a=await Es(s,e,t);a&&(S=a,O(a),$(a,s))}catch(a){console.error("Failed to move planner lesson",a),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function vr(e){if(!e||typeof window>"u")return;let t=S?.lessons?.find(s=>s.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let s=await bs(E,e);s&&(S=s,O(s),$(s,E))}catch(s){console.error("Failed to delete planner lesson",s),window.alert("Unable to delete that lesson right now.")}}function Nt(){if(_e||!F){_e&&Te(E);return}_e=!0,ps({ensureFirestore:Ve}),F.addEventListener("click",tr),F.addEventListener("click",yr),F.addEventListener("change",ir),F.addEventListener("input",dr),F.addEventListener("focusout",ur),F.addEventListener("toggle",fr),qe?.addEventListener("click",Ja),le instanceof HTMLTextAreaElement&&le.addEventListener("input",ar),ga?.addEventListener("click",yo),ya?.addEventListener("click",gr),ma?.addEventListener("click",hr),pa?.addEventListener("click",br),vt?.addEventListener("change",nr),ln?.addEventListener("click",()=>gt("list")),cn?.addEventListener("click",()=>gt("week")),da?.addEventListener("click",()=>{let e=Be(E,-1);Te(e)}),ua?.addEventListener("click",()=>{let e=Be(E,1);Te(e)}),fa?.addEventListener("click",()=>{Te(ae())}),gt(co),Te(E)}function qs(){typeof window>"u"||Ws()==="planner"&&Nt()}function Sr(e){let t=e?.detail?.plan;t&&(_e&&t.weekId===E?(S=t,O(t),Ln(t.weekId),$(t,t.weekId)):t.weekId===ke&&$(t,ke))}$(null,ke);typeof document<"u"&&document.addEventListener(qt,Sr);typeof window<"u"&&(window.addEventListener("hashchange",qs),window.addEventListener("DOMContentLoaded",qs));var go="dailyTasksByDate",pt=null;function An(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function Lr(e){if(typeof e!="string")return"";let[t,n,s]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),i=Number.parseInt(s,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(i))return e;let r=new Date(o,a-1,i);return Number.isNaN(r.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(r)}function je(e){if(!rn)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);rn.disabled=!t}function ge(e){if(!ie)return;if(!Array.isArray(e)||e.length===0){ie.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',je([]);return}let t=e.map((n,s)=>{let o=C(n?.text||""),a=!!n?.completed,i=`daily-task-${s}`,r=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return a&&r.push("line-through","text-opacity-50"),`
        <label class="flex items-center p-3 border-b border-base-200" data-task-index="${s}" for="${i}">
          <input id="${i}" type="checkbox" class="checkbox checkbox-sm" data-task-index="${s}" ${a?"checked":""} />
          <span class="${r.join(" ")}">${o}</span>
        </label>
      `}).join("");ie.innerHTML=t,je(e)}function At(){wt&&wt.classList.remove("hidden")}function kn(){wt&&wt.classList.add("hidden")}function In(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Ie(e){return Array.isArray(e)?e.map(t=>In(t)):[]}function Cn(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(go);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function ho(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(go,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Us(e){let t=Cn(),n=t&&typeof t=="object"?t[e]:[];return Ie(n)}function hn(e,t){let n=Cn(),s=Ie(t);return n[e]=s,ho(n),s}function js(e,t){let n=Cn(),s=Ie(n[e]);return s.push(In(t)),n[e]=s,ho(n),s}function Mt(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Dn(){return pt||(pt=Ve().then(e=>{let{db:t,getCollection:n}=e,s=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:s}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),pt)}function Nn(e,t){let{doc:n,dailyListsCollection:s,db:o}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return s?n(s,t):n(o,"dailyLists",t)}async function Mn(){if(!Ts||!ie)return;let e=An(),t=Lr(e);Ts.textContent=t?`Today's List - ${t}`:"Today's List";let n=!1;if(ye){At();let s=Us(e);D=s,ge(s),n=!0}return ft||(n||(ie.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',je([])),ft=(async()=>{try{let s=await Dn(),o=Nn(s,e),a=await s.getDoc(o),i=a.exists()?a.data()?.tasks:[];return D=Ie(i),ge(D),hn(e,D),ye=!1,kn(),D}catch(s){Mt(s)?(console.warn("Falling back to local daily tasks due to permission issue",s),ye=!0,At()):console.error("Failed to load daily list",s);let a=Us(e);return D=a,a.length||n?ge(a):(ie.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',D=[],je(D)),D}})().finally(()=>{ft=null})),ft}async function Tr(e){let t=An(),n=In(e);try{let s=await Dn(),o=Nn(s,t),a=await s.getDoc(o);if(a.exists()&&typeof s.arrayUnion=="function")await s.updateDoc(o,{tasks:s.arrayUnion(n)});else{let i=a.exists()?a.data()?.tasks:[],r=Array.isArray(i)?Ie(i):[];r.push(n),typeof s.setDoc=="function"?await s.setDoc(o,{tasks:r},{merge:!0}):await s.updateDoc(o,{tasks:r})}js(t,n),ye=!1,kn()}catch(s){if(Mt(s)){console.warn("Saving task locally because cloud sync is unavailable",s),ye=!0,At(),js(t,n);return}throw s}}async function bo(e){let t=An(),n=Ie(e);try{let s=await Dn(),o=Nn(s,t);typeof s.setDoc=="function"?await s.setDoc(o,{tasks:n},{merge:!0}):await s.updateDoc(o,{tasks:n}),hn(t,n),ye=!1,kn()}catch(s){if(Mt(s)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",s),ye=!0,At(),hn(t,n);return}throw s}}function Eo(e){[bt,Et].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function xr(){!$e||!Oe||($e.classList.remove("hidden"),Oe.classList.add("hidden"),Eo(bt))}function Ar(){!$e||!Oe||($e.classList.add("hidden"),Oe.classList.remove("hidden"),Eo(Et),Mn())}function kr(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),s=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!s.length)return;let o=r=>{n.forEach(l=>{if(!l)return;let d=l.getAttribute("data-dashboard-tab")===r;l.classList.toggle("tab-active",d),l.setAttribute("aria-selected",d?"true":"false")}),s.forEach(l=>{if(!l)return;let d=l.getAttribute("data-dashboard-panel")===r;l.classList.toggle("hidden",!d),l.setAttribute("aria-hidden",d?"false":"true")})},i=(n.find(r=>r.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");i&&o(i),n.forEach(r=>{r.addEventListener("click",()=>{let l=r.getAttribute("data-dashboard-tab");l&&o(l)})})})}window.addEventListener("DOMContentLoaded",kr);bt&&Et&&$e&&Oe&&(bt.addEventListener("click",e=>{e.preventDefault(),xr()}),Et.addEventListener("click",e=>{e.preventDefault(),Ar()}));var U=null,Y=!1,ht=null;function Ae(e){if(!K)return;K.setAttribute("aria-pressed",e?"true":"false");let t=K.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":K.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function Ir(){Y&&(window.clearTimeout(ht),ht=window.setTimeout(()=>{ht=null,Y&&wo(!0)},400))}function wo(e=!1){if(!U)return!1;if(Y&&!e)return!0;try{return U.start(),Y=!0,Ae(!0),!0}catch{return Y=!1,Ae(!1),!1}}function Bn(){if(U){Y=!1,window.clearTimeout(ht);try{U.stop()}catch{}Ae(!1)}}function Cr(){if(K)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){K.setAttribute("disabled","true"),K.setAttribute("aria-disabled","true"),K.title="Voice input is not supported in this browser.";return}U=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(U.lang=t,U.interimResults=!1,"continuous"in U)try{U.continuous=!0}catch{}U.onresult=n=>{let s=n?.results?.[0]?.[0]?.transcript||"";if(s&&V){V.value=s.trim();try{V.focus({preventScroll:!0})}catch{V.focus()}try{let o=V.value.length;V.setSelectionRange(o,o)}catch{}}},U.onend=()=>{if(!Y){Ae(!1);return}Ir()},U.onerror=()=>{Y=!1,Ae(!1)}}catch{U=null,Ae(!1),K.setAttribute("disabled","true"),K.setAttribute("aria-disabled","true")}}Cr();K?.addEventListener("click",()=>{U&&(Y?Bn():wo())});Ks?.addEventListener("submit",()=>{Y&&Bn()});window.addEventListener("pagehide",()=>{Y&&Bn()});Ks?.addEventListener("submit",async e=>{if(e.preventDefault(),!V)return;let t=V.value.trim();if(!t){V.focus();return}let n={text:t,completed:!1};V.value="",V.focus();try{await Tr(n),await Mn()}catch(s){console.error("Failed to add task to the daily list",s),V.value=t,V.focus()}});ie?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(D)||Number.isNaN(n)||!D[n])return;let s=document.activeElement===t,o=()=>{if(!s)return;let r=ie?.querySelector(`input[data-task-index="${n}"]`);if(r instanceof HTMLInputElement)try{r.focus({preventScroll:!0})}catch{r.focus()}},a=D.map(r=>({...r})),i=a.map((r,l)=>l===n?{...r,completed:t.checked}:r);D=i,ge(i),o();try{await bo(i)}catch(r){console.error("Failed to update task completion state",r),D=a,ge(a),o()}});rn?.addEventListener("click",async()=>{if(!Array.isArray(D)||D.length===0)return;let e=D.filter(n=>!n.completed);if(e.length===D.length)return;let t=D.map(n=>({...n}));D=e,ge(e);try{await bo(e)}catch(n){console.error("Failed to clear completed tasks",n),D=t,ge(t)}});je(D);Mn();function Dr(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),s=document.getElementById("noteNewBtn"),o=document.getElementById("notesList"),a=document.querySelector("[data-notes-layout]"),i=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!s)return;let r=null,l=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}},d=()=>a&&a.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",y=m=>{let p=m==="collapsed";i.forEach(b=>{if(!(b instanceof HTMLElement))return;b.setAttribute("aria-expanded",p?"false":"true");let v=b.dataset.notesShelfToggleVariant;v==="primary"?b.textContent=p?"Show saved notes":"Hide saved notes":v==="close"&&(b.textContent=p?"Show":"Close")})},g=m=>{a&&(a.dataset.notesShelfState=m==="collapsed"?"collapsed":"expanded"),y(d())},w=()=>{let m=d()==="collapsed"?"expanded":"collapsed";g(m),m==="collapsed"&&l()};i.length&&(i.forEach(m=>{m.addEventListener("click",p=>{p.preventDefault(),w()})}),g(d()));let I=m=>{if(!m){r=null,e.value="",t.value="";return}r=m.id,e.value=m.title||"",t.value=m.body||""},k=()=>{if(!o)return;o.querySelectorAll("button[data-note-id]").forEach(p=>{if(!(p instanceof HTMLElement))return;let b=p.getAttribute("data-note-id")===r;p.classList.toggle("bg-base-200/80",b),p.classList.toggle("border-base-300",!b),p.classList.toggle("border-primary",b),p.classList.toggle("font-medium",b),p.setAttribute("aria-current",b?"true":"false")})},N=()=>{let m=et();return Array.isArray(m)?[...m].sort((p,b)=>{let v=Date.parse(p?.updatedAt||""),T=Date.parse(b?.updatedAt||"");return(Number.isNaN(T)?0:T)-(Number.isNaN(v)?0:v)}):[]},H=m=>{if(!m)return;let p=et();if(!Array.isArray(p))return;let b=p.filter(T=>T.id!==m);if(b.length===p.length)return;Rt(b),r===m&&(r=null);let v=P();if(r){let T=v.find(u=>u.id===r)||null;I(T)}else v.length?I(v[0]):I(null);k()},P=(m=N())=>{if(!o)return m;if(o.innerHTML="",!m.length){let p=document.createElement("li");return p.className="text-sm italic text-base-content/60",p.textContent="No saved notes yet.",o.appendChild(p),m}return m.forEach(p=>{let b=document.createElement("li");b.className="flex items-center gap-2";let v=document.createElement("button");v.type="button",v.dataset.noteId=p.id,v.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",v.textContent=p.title||"Untitled note",v.addEventListener("click",()=>{I(p),k(),l()});let T=document.createElement("button");T.type="button",T.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",T.setAttribute("aria-label",`Delete note "${p.title||"Untitled note"}"`),T.textContent="Delete",T.addEventListener("click",u=>{u.stopPropagation(),H(p.id)}),b.appendChild(v),b.appendChild(T),o.appendChild(b)}),k(),m},x=()=>{let m=P();if(!m.length){I(null),k();return}let p=r?m.find(b=>b.id===r):null;I(p||m[0]),k()};n.addEventListener("click",()=>{let m=et(),p=Array.isArray(m)?[...m]:[],b=typeof e.value=="string"?e.value.trim():"",v=typeof t.value=="string"?t.value:"",T=b||"Untitled note",u=new Date().toISOString();if(r){let M=p.findIndex(L=>L.id===r);if(M>=0)p[M]={...p[M],title:T,body:v,updatedAt:u};else{let L=Ht(T,v,{updatedAt:u});r=L.id,p.unshift(L)}}else{let M=Ht(T,v);r=M.id,p.unshift(M)}Rt(p);let h=P(),B=r?h.find(M=>M.id===r):null;I(B||null),k()}),s.addEventListener("click",()=>{r=null,e.value="",t.value="",k(),l()}),x()}Dr();var vo="theme",Nr="professional",bn="memoryCue:theme-change",Mr="professional",En=document.getElementById("theme-menu"),So="[data-theme-name],[data-theme-option]",Br=new Set(["dark","dracula","synthwave"]);function de(e){return typeof e=="string"?e.trim():""}function Lo(e){return e instanceof HTMLElement?de(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Pr(e){let t=de(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Br.has(t)))}function Vs(e){let t=de(e);if(t)try{localStorage.setItem(vo,t)}catch(n){console.warn("Unable to save theme preference",n)}}function To(e){if(!En)return;let t=de(e);En.querySelectorAll(So).forEach(s=>{if(!(s instanceof HTMLElement))return;let o=Lo(s),a=t&&o===t;s.setAttribute("aria-checked",a?"true":"false"),s.classList.toggle("active",a)})}function Fr(e){let t=de(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(bn,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let s=document.createEvent("CustomEvent");s.initCustomEvent(bn,!0,!0,{theme:t}),window.dispatchEvent(s)}}}function wn(e,{persist:t=!0,notify:n=!0}={}){let s=de(e);if(!s)return;de(document.documentElement.getAttribute("data-theme"))!==s&&Pr(s),t&&Vs(s),To(s),n&&Fr(s)}function Hr(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){wn(Mr,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(vo)||""}catch(s){console.warn("Unable to load theme preference",s)}let n=t||document.documentElement.getAttribute("data-theme")||Nr;n&&wn(n,{persist:!1,notify:!0})}En?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(So):null;if(!t)return;e.preventDefault();let n=Lo(t);n&&wn(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(bn,e=>{let t=de(e?.detail?.theme);t&&To(t)});Hr()});export default Rr();
