import{b as Rt,c as hr}from"./chunk-KX65DZXT.js";import{a as Yn,b as un,c as yr}from"./chunk-GUVSRPRW.js";function Vn(i={}){try{Object.assign(P,i||{})}catch(o){console.warn("[supabase-auth] setAuthContext failed",o)}}async function qn(i={}){try{if(P&&typeof P.signInWithPopup=="function"&&P.auth&&typeof P.GoogleAuthProvider=="function")return P.signInWithPopup(P.auth,new P.GoogleAuthProvider);if(P&&typeof P.signInWithRedirect=="function"&&P.auth&&typeof P.GoogleAuthProvider=="function")return P.signInWithRedirect(P.auth,new P.GoogleAuthProvider);let o=Rt();if(o&&o.auth){if(typeof o.auth.signInWithOAuth=="function")return o.auth.signInWithOAuth({provider:"google",...i});if(typeof o.auth.signIn=="function")return o.auth.signIn({provider:"google"})}}catch(o){console.error("[supabase-auth] startSignInFlow error",o);try{P?.toast?.("Sign-in failed")}catch(s){console.warn("[supabase-auth] toast handler failed",s)}throw o}return Promise.resolve(null)}async function zn(){try{if(P&&typeof P.signOut=="function")return P.signOut(P.auth);let i=Rt();if(i&&i.auth&&typeof i.auth.signOut=="function")return i.auth.signOut()}catch(i){throw console.error("[supabase-auth] startSignOutFlow error",i),i}return Promise.resolve(null)}function wr(i){return i?Array.isArray(i)?i:[i]:[]}function it(i){return Array.from(new Set(i.filter(o=>o instanceof HTMLElement||typeof SVGElement<"u"&&o instanceof SVGElement)))}function ae(i,o){let s=wr(o).filter(Boolean);if(!s.length)return[];let l=s.flatMap(I=>Array.from(i.querySelectorAll(I)));return it(l)}function Sr(i,o=document){let s=o instanceof Document||o instanceof HTMLElement?o:document;return{authForms:ae(s,i.authForm),emailInputs:ae(s,i.emailInput),signInButtons:ae(s,i.signInButtons),signOutButtons:ae(s,i.signOutButtons),userBadges:ae(s,i.userBadge),userBadgeEmails:ae(s,i.userBadgeEmail),userBadgeInitials:ae(s,i.userBadgeInitial),userNameEls:ae(s,i.userName),syncStatusEls:ae(s,i.syncStatus),syncStatusTextEls:ae(s,i.syncStatusText),statusIndicatorEls:ae(s,i.statusIndicator),feedbackEls:ae(s,i.feedback)}}function et(i,o){it(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.classList.toggle("hidden",!o),o?s.removeAttribute("hidden"):s.setAttribute("hidden",""))})}function Ae(i,o){it(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.textContent=o||"")})}function vr(i,o){it(i).forEach(s=>{s instanceof HTMLElement&&(s.dataset.state=o,s.classList.toggle("online",o==="online"),s.classList.toggle("offline",o!=="online"))})}function nt(i,o){it(i).forEach(s=>{if(!(s instanceof HTMLElement))return;s.textContent=o||"";let l=!!o;s.classList.toggle("hidden",!l),l?s.removeAttribute("hidden"):s.setAttribute("hidden","")})}function Xn(i={}){let o={...Gn.syncStatusText,...i.syncStatusText||{}};return{...Gn,...i,syncStatusText:o}}function tt(i,{user:o,messages:s}={}){let l=Xn(s),I=!!o;et(i.signInButtons,!I),et(i.authForms,!I),et(i.signOutButtons,I),et(i.userBadges,I);let N=typeof o?.email=="string"?o.email:"",B=N?N.charAt(0).toUpperCase():"U";I?(Ae(i.userBadgeEmails,N),Ae(i.userBadgeInitials,B),Ae(i.userNameEls,N)):(Ae(i.userBadgeEmails,""),Ae(i.userBadgeInitials,""),Ae(i.userNameEls,""));let J=typeof l.signedIn=="function"?l.signedIn(o):l.signedIn,L=typeof l.signedOut=="function"?l.signedOut(o):l.signedOut,Q=I?J:L,ie=!I;i.syncStatusEls.length&&(Ae(i.syncStatusEls,Q),i.syncStatusEls.forEach(se=>{se instanceof HTMLElement&&(se.classList.toggle("online",I),se.dataset.state=I?"online":"offline")}),et(i.syncStatusEls,ie));let v=I?l.syncStatusText?.signedIn:l.syncStatusText?.signedOut;Ae(i.syncStatusTextEls,v||""),vr(i.statusIndicatorEls,I?"online":"offline"),nt(i.feedbackEls,"")}function Er(i,o){o.authForms.forEach(s=>{!(s instanceof HTMLFormElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("submit",async l=>{l.preventDefault();let I=o.emailInputs.find(B=>s.contains(B))||s.querySelector('input[type="email"]'),N=typeof I?.value=="string"?I.value.trim():"";if(!N){nt(o.feedbackEls,"Enter an email address to continue.");return}try{let{error:B}=await i.auth.signInWithOtp({email:N});B?nt(o.feedbackEls,B.message||"Unable to send magic link."):nt(o.feedbackEls,"Magic link sent. Check your email.")}catch(B){nt(o.feedbackEls,B?.message||"Unable to send magic link.")}}))})}function Ir(i,o){o.signOutButtons.forEach(s=>{!(s instanceof HTMLElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("click",async()=>{try{await i.auth.signOut()}catch(l){console.error("[supabase] Sign-out failed.",l)}}))})}function $r(i={}){let{supabase:o,scope:s=document,selectors:l={},messages:I={},disableButtonBinding:N=!1,onSessionChange:B}=i,J={...br,...l},L=Sr(J,s),Q=Xn(I);tt(L,{user:null,messages:Q});let ie=o||Rt()||(typeof window<"u"?window.supabase:null);if(!ie)return{supabase:null,elements:L,applyAuthState:G=>tt(L,{...G,messages:Q}),destroy(){}};Er(ie,L),N||Ir(ie,L);let v=[],{data:se}=ie.auth.onAuthStateChange((G,F)=>{if(tt(L,{user:F?.user??null,messages:Q}),typeof B=="function")try{B(F?.user??null,F)}catch(U){console.error("[supabase] onSessionChange handler failed.",U)}});return se?.subscription&&v.push(()=>{try{se.subscription.unsubscribe()}catch{}}),ie.auth.getSession().then(({data:G,error:F})=>{F||tt(L,{user:G?.session?.user??null,messages:Q})}).catch(G=>{console.error("[supabase] getSession failed.",G)}),{supabase:ie,elements:L,applyAuthState:G=>tt(L,{...G,messages:Q}),destroy(){v.forEach(G=>{try{G()}catch{}})}}}var P,br,Gn,Kn=un(()=>{hr();P={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};br={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},Gn={signedOut:"",signedIn:i=>`Reminders syncing for ${i?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var ei=yr((Hr,rt)=>{var Bt=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Jn(i){if(!i||typeof i!="object")return null;let o=Object.entries(i).filter(([s,l])=>typeof l=="string"&&l.trim()!=="");return o.length?Object.fromEntries(o):null}function Ar(){let i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},o=Jn(i?.__FIREBASE_CONFIG);if(o)return o;let s=Jn(i?.__ENV?.FIREBASE_CONFIG);if(s)return s;let I=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((N,[B,J])=>{let L=i?.__ENV?.[B]??i?.[B];return typeof L=="string"&&L.trim()!==""&&(N[J]=L),N},{});return Object.keys(I).length?I:null}function Zn(){let i=Ar();return i?{...Bt,...i}:{...Bt}}var Qn={DEFAULT_FIREBASE_CONFIG:Bt,getFirebaseConfig:Zn};if(typeof globalThis<"u"){let i=globalThis;i.memoryCueFirebase=i.memoryCueFirebase||{},i.memoryCueFirebase.getFirebaseConfig=Zn,i.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Bt}typeof rt<"u"&&rt.exports&&(rt.exports=Qn,rt.exports.default=Qn)});function Cr(){if(pe)return{...pe};let o=hn()?.memoryCueFirebase;if(o&&typeof o.getFirebaseConfig=="function")return pe=o.getFirebaseConfig(),{...pe};if(typeof Yn=="function")try{let s=ei();if(s){let l=typeof s.getFirebaseConfig=="function"?s.getFirebaseConfig:typeof s.default?.getFirebaseConfig=="function"?s.default.getFirebaseConfig:null;if(l)return pe=l(),{...pe}}}catch{}return o&&o.DEFAULT_FIREBASE_CONFIG?(pe={...o.DEFAULT_FIREBASE_CONFIG},{...pe}):(pe={...Lr},{...pe})}function hn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function oi(){let i=hn(),o=i&&i.TimestampTrigger;return typeof o=="function"?o:null}function he(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!oi()}function Dr(){if(typeof window>"u"||!window.location)return ln;try{return new URL(ln,window.location.href).href}catch{return ln}}async function Te(){return Ot||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Ot=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Dr()),await navigator.serviceWorker.ready}catch(i){return console.warn("Service worker registration failed",i),null}})(),Ot))}async function ri(i){if(!i||typeof i!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let o=await Te();if(!o)return!1;let s=new Set;navigator.serviceWorker.controller&&s.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(I=>{let N=o[I];N&&s.add(N)});let l=!1;return s.forEach(I=>{try{I.postMessage(i),l=!0}catch(N){console.warn("Failed posting message to service worker",N)}}),l}catch(o){return console.warn("Unable to reach service worker",o),!1}}async function Mt(){if(he())return!1;if(pn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(ot)try{return await ot}catch{}ot=(async()=>{let i=await Te();if(!i)return!1;let o=!1;if("periodicSync"in i)try{let s=await i.periodicSync.getTags();(!Array.isArray(s)||!s.includes(fn))&&await i.periodicSync.register(fn,{minInterval:15*60*1e3}),o=!0}catch(s){console.warn("Periodic background sync unavailable",s)}if(!o&&"sync"in i)try{await i.sync.register(fn),o=!0}catch(s){console.warn("Background sync unavailable",s)}return o})();try{let i=await ot;return i&&(pn=!0),i}catch(i){return console.warn("Background reminder sync setup failed",i),pn=!1,!1}finally{ot=null}}async function gn(i=[],{requestCheck:o=!1}={}){if(!he()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let s=await Te();if(!s)return;let l=await ri({type:ii.updateScheduledReminders,reminders:Array.isArray(i)?i:[]});if(o&&await ri({type:ii.checkScheduledReminders}),!l&&typeof s.update=="function")try{await s.update()}catch{}}catch(s){console.warn("Failed syncing reminders with service worker",s)}}async function yn(i,o){if(he())try{let s=o||await Te();if(!s)return;let l=[];try{l=await s.getNotifications({tag:i,includeTriggered:!0})}catch{l=await s.getNotifications({tag:i})}for(let I of l)try{I.close()}catch{}}catch{}}function ai(){for(let i of Array.from(ye.values()))try{i.close()}catch{}ye.clear()}function xr(){if(ni||typeof window>"u"||typeof window.addEventListener!="function")return;let i=()=>ai();["pagehide","beforeunload"].forEach(o=>{try{window.addEventListener(o,i)}catch{}}),ni=!0}function W(i){if(typeof i=="string"){let o=i.replace(/\s+/g," ").trim();if(o)return o}return Y}async function Yr(i={}){let o=e=>e?document.querySelector(e):null,s=e=>e?Array.from(document.querySelectorAll(e)):[],l=o(i.titleSel),I=o(i.dateSel),N=o(i.timeSel),B=o(i.detailsSel),J=o(i.prioritySel),L=o(i.categorySel),Q=o(i.saveBtnSel),ie=o(i.cancelEditBtnSel),v=o(i.listSel),se=s(i.googleSignInBtnSel),G=s(i.googleSignOutBtnSel),F=o(i.statusSel),U=o(i.syncStatusSel),pi={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},mi=6e3,re=null;function Ne(e,{clearMessage:t=!0}={}){re&&(e&&re.tokenId!==e||(re.timeoutId&&clearTimeout(re.timeoutId),t&&F&&F.dataset.undoToken===re.tokenId&&(typeof F.replaceChildren=="function"?F.replaceChildren():F.textContent="",delete F.dataset.undoToken,delete F.dataset.statusKind),re=null))}function gi(e){if(!F)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),r=document.createElement("button");r.type="button",r.textContent="Undo",r.className="status-undo",r.addEventListener("click",()=>ur(e.tokenId)),e.button=r,typeof F.replaceChildren=="function"?F.replaceChildren(t,n,r):(F.textContent="",F.append(t,n,r)),F.dataset.statusKind="undo",F.dataset.undoToken=e.tokenId}function $t(e,t){if(!U)return;let n=["online","offline","error"];n.forEach(c=>U.classList.remove(c)),n.includes(e)&&U.classList.add(e),U.dataset.state=e;let r=typeof t=="string"?t:pi[e]||"";e==="online"||e==="offline"?(U.textContent="",U.dataset.compact="true",r?(U.setAttribute("aria-label",r),U.setAttribute("title",r)):(U.removeAttribute("aria-label"),U.removeAttribute("title"))):(U.textContent=r,U.removeAttribute("data-compact"),r?(U.setAttribute("aria-label",r),U.setAttribute("title",r)):(U.removeAttribute("aria-label"),U.removeAttribute("title")))}let z=o(i.notesSel),yi=o(i.saveNotesBtnSel),hi=o(i.loadNotesBtnSel),bn=o(i.countTotalSel),at=o(i.googleUserNameSel),Le=o(i.dateFeedbackSel),Z=o(i.voiceBtnSel),bi=o(i.notifBtnSel),_e=o(i.moreBtnSel),Pe=o(i.moreMenuSel),wi=o(i.copyMtlBtnSel),jt=o(i.importFileSel),Si=o(i.exportBtnSel),vi=o(i.syncAllBtnSel),Fe=o(i.syncUrlInputSel),Ei=o(i.saveSettingsSel),Ii=o(i.testSyncSel),Ai=s(i.openSettingsSel),st=o(i.settingsSectionSel),Re=o(i.emptyStateSel),wn=o(i.listWrapperSel),Ht=o(i.categoryOptionsSel),be=i.variant||"mobile",Ti=typeof i.autoWireAuthButtons=="boolean"?i.autoWireAuthButtons:be!=="desktop",Sn="mc:lastDefaults";function Wt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Sn)||"{}")||{}}catch{return{}}}function Li(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Sn,JSON.stringify(e))}catch{}}function vn(e){let t=Wt(),n={category:W(e?.category||t.category||Y),priority:e?.priority||t.priority||"Medium"};Li(n)}let En='fieldset#priorityChips input[name="priority"]';function Yt(){try{let e=document.querySelector(`${En}:checked`);if(e&&e.value)return e.value}catch{}return J&&typeof J.value=="string"&&J.value?J.value:"Medium"}function dt(e){let t=e||"Medium";J&&typeof J.value<"u"&&(J.value=t);try{let n=Array.from(document.querySelectorAll(En));if(!n.length)return;let r=!1;if(n.forEach(a=>{let c=a.value===t;a.checked=c,r=r||c}),!r){let a=n.find(c=>c.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function In(){let e=Wt();e.category&&L&&(L.value=e.category),e.priority&&dt(e.priority)}In();let ee=typeof document<"u"?document.getElementById("quickAddInput"):null,Ci=typeof document<"u"?document.getElementById("quickAddSubmit"):null,te=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,Gt=null;function Di(e,t){let n=Date.now(),r=Wt(),a=typeof t=="string"&&t?t:null;return{id:Tt(),title:(e||"").trim(),priority:r.priority||Yt(),category:W(r.category||L?.value||Y),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!V}}async function Vt(){if(!ee)return;if(typeof Gt=="function")try{Gt()}catch{}let e=(ee.value||"").trim();if(!e)return;let t=null;try{let a=Dt(e);a&&a.time&&(t=new Date(`${a.date}T${a.time}:00`).toISOString())}catch{t=null}let n=Di(e,t);Qt(n,{position:"start"}),u.unshift(n),oe(u);let r=ze(u);Ce=!0,$(),q(),r?u.forEach(a=>X(a)):X(n),Ke(n),xe(n),Ee(),vn(n),Ue();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}ce({action:"created",label:`Reminder added \xB7 ${n.title}`}),ee.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=Vt),Ci?.addEventListener("click",()=>{Vt()}),ee?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Vt())});function xi(){if(typeof HTMLElement>"u"||!(te instanceof HTMLElement)||!(ee instanceof HTMLInputElement)||te.dataset.voiceBound==="true")return;if(te.dataset.voiceBound="true",typeof window>"u"){te.setAttribute("disabled","true"),te.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){te.setAttribute("disabled","true"),te.setAttribute("aria-disabled","true"),te.getAttribute("title")||(te.title="Voice input is not supported in this browser.");return}let t=null,n=!1,r=d=>{n=d,te.setAttribute("aria-pressed",d?"true":"false"),te.dataset.listening=d?"true":"false",te.classList.toggle("is-listening",d)},a=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",h=>{let g=h?.results?.[0]?.[0]?.transcript?.trim()||"";if(g){ee.value=g;try{ee.focus({preventScroll:!0})}catch{ee.focus()}try{let S=ee.value.length;typeof ee.setSelectionRange=="function"&&ee.setSelectionRange(S,S)}catch{}}});let f=()=>{r(!1)};return t.addEventListener("end",f),t.addEventListener("error",f),t},c=()=>{if(!(!n||!t)){try{t.stop()}catch{}r(!1)}};Gt=c,te.addEventListener("click",()=>{let d=a();if(d){if(n){c();return}try{d.start(),r(!0)}catch(f){console.warn("Quick add voice error:",f),r(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",c),r(!1)}xi(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&ee&&(e.preventDefault(),ee.focus())})));try{be==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let ki=i.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",An=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Ni=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",ct=i.reminderLandingPath||(be==="desktop"?"index.html#reminders":"mobile.html"),we=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Tn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ue(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}L&&!L.value&&(L.value=Y),he()&&Te();function ce(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let r=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),r=!0)}catch{r=!1}if(!r){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(ti,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(ti,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function Fi(){if(typeof HTMLElement>"u"||!(Z instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&l instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&l instanceof HTMLTextAreaElement;if(!e&&!t||Z.dataset.voiceBound==="true")return;if(Z.dataset.voiceBound="true",typeof window>"u"){Z.setAttribute("disabled","true"),Z.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){Z.setAttribute("disabled","true"),Z.setAttribute("aria-disabled","true"),Z.getAttribute("title")||(Z.title="Voice input is not supported in this browser.");return}let r=null,a=!1,c=g=>{a=g,Z.setAttribute("aria-pressed",g?"true":"false"),Z.dataset.listening=g?"true":"false",Z.classList.toggle("is-listening",g)},d=()=>{if(r)return r;r=new n,r.lang="en-US",r.interimResults=!1,r.maxAlternatives=1,r.addEventListener("result",S=>{let T=S.results?.[0]?.[0]?.transcript?.trim()||"";if(T){l.value=T;try{l.focus({preventScroll:!0})}catch{try{l.focus()}catch{}}try{let O=l.value.length;typeof l.setSelectionRange=="function"&&l.setSelectionRange(O,O)}catch{}ce({action:"dictated",label:`Voice input captured \xB7 ${T}`})}});let g=()=>{c(!1)};return r.addEventListener("end",g),r.addEventListener("error",g),r},f=()=>{if(!(!a||!r)){try{r.stop()}catch{}c(!1)}};Z.addEventListener("click",()=>{let g=d();if(g){if(a){f();return}try{g.start(),c(!0)}catch(S){console.warn("Speech recognition error:",S),c(!1)}}});let h=()=>{f()};typeof document<"u"&&(document.addEventListener("cue:close",h),document.addEventListener("reminders:updated",h)),c(!1)}xr(),Fi();let ut,lt,ft,pt,Be,mt,gt,yt,ht,bt,wt,$e,je,St,vt,qt,zt,Et,Xt,Ln=i.firebaseDeps,Kt=typeof i.importModule=="function"?i.importModule:e=>import(e),He=hn(),We=!1,ue=!1,Jt=null,me=null,Ye=null,u=[],Ce=!1,V=null,Ge=null,Ve=null,De={},j={};function oe(e=u){Array.isArray(e)&&e.sort((t,n)=>{let r=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,a=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return r===a?Fn(t||{},n||{}):a-r})}function Ri(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(r=>{let a=Number.isFinite(r?.orderIndex)?r.orderIndex:null;a!=null&&(a<t&&(t=a),a>n&&(n=a))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function qe(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(r=>Number.isFinite(r?.orderIndex)),n;if(t)n=e.slice(),oe(n);else{n=e.slice().sort(Fn);let r=n.length;n.forEach((a,c)=>{a.orderIndex=(r-c)*fe})}return e===u&&(u=n),n}function Qt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:r}=Ri();if(t==="end"){let a=Number.isFinite(n)?n:0;e.orderIndex=a-fe||fe}else{let a=Number.isFinite(r)?r:0;e.orderIndex=a+fe||fe}}function ze(e=u){if(!Array.isArray(e)||e.length<2)return!1;oe(e);let t=!1;for(let n=1;n<e.length;n+=1){let r=e[n-1],a=e[n],c=Number.isFinite(r?.orderIndex)?r.orderIndex:null,d=Number.isFinite(a?.orderIndex)?a.orderIndex:null;if(c==null||d==null||c<=d||c-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*fe;return e===u&&oe(u),!0}let D={draggingId:null,dropTargetId:null,dropBefore:!0},Cn=!1,p={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Bi(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Xe(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Se(){v&&(v.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),v.classList.remove("drag-over-list"))}function Zt(){if(!v)return;let e=v.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Se(),D.draggingId=null,D.dropTargetId=null,D.dropBefore=!0}function Dn(e,t,n){if(!e||e===t)return;let r=u.findIndex(O=>O?.id===e);if(r<0)return;let[a]=u.splice(r,1),c;if(!t)c=u.length;else{let O=u.findIndex(H=>H?.id===t);if(O<0){u.splice(r,0,a);return}c=n?O:O+1}u.splice(c,0,a);let d=u[c-1],f=u[c+1],h=Number.isFinite(d?.orderIndex)?d.orderIndex:null,g=Number.isFinite(f?.orderIndex)?f.orderIndex:null,S;h!=null&&g!=null?S=(h+g)/2:h!=null?S=h-fe:g!=null?S=g+fe:S=fe,Number.isFinite(S)||(S=fe*(u.length+1)),a.orderIndex=S,oe(u);let T=ze(u);Ce=!0,$(),q(),T?u.forEach(O=>X(O)):X(a),Ue(),we("memoryCue:remindersUpdated",{items:u}),ce({action:"reordered",label:"Reminders reordered"})}function Oi(e){let t=Xe(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let r=t.dataset.id;if(r&&(D.draggingId=r,D.dropTargetId=null,D.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",r)}catch{}}function Mi(e){if(!D.draggingId)return;let t=Xe(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),D.dropTargetId=null,D.dropBefore=!1,Se(),v?.classList.add("drag-over-list");return}if(t.dataset.id===D.draggingId){e.preventDefault(),Se();return}e.preventDefault();let n=t.getBoundingClientRect(),r=n.top+n.height/2,a=e.clientY<r;(D.dropTargetId!==t.dataset.id||D.dropBefore!==a)&&(Se(),t.classList.add(a?"drag-over-before":"drag-over-after"),D.dropTargetId=t.dataset.id,D.dropBefore=a)}function _i(e){let t=Xe(e.target);if(!t){v?.contains(e.relatedTarget)||Se();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),v?.contains(e.relatedTarget)||v?.classList.remove("drag-over-list"))}function Pi(e){if(!D.draggingId)return;e.preventDefault();let t=Xe(e.target),n=t?.dataset.id||null,r=D.dropBefore;if(t){let a=t.getBoundingClientRect(),c=a.top+a.height/2;r=e.clientY<c}else n=null,r=!1;Dn(D.draggingId,n,r),Zt()}function Ui(){Zt()}function $i(){!v||Cn||(Cn=!0,v.addEventListener("dragstart",Oi),v.addEventListener("dragover",Mi),v.addEventListener("drop",Pi),v.addEventListener("dragend",Ui),v.addEventListener("dragleave",_i),It())}function It(){if(!v||It._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){It._bound=!0;return}let t=6,n=160;function r(){p.longPressTimer&&(clearTimeout(p.longPressTimer),p.longPressTimer=null)}function a(){v&&(p.initialTouchAction!=null?v.style.touchAction=p.initialTouchAction:v.style.removeProperty("touch-action"))}function c({keepHighlights:w=!1}={}){if(r(),p.item&&p.pointerId!=null)try{p.item.hasPointerCapture?.(p.pointerId)&&p.item.releasePointerCapture(p.pointerId)}catch{}if(p.placeholder?.parentNode)try{p.placeholder.parentNode.removeChild(p.placeholder)}catch{}p.item&&(p.item.classList.remove("is-dragging"),p.originalStyles?p.item.setAttribute("style",p.originalStyles):p.item.removeAttribute("style")),a(),w||Se(),Object.assign(p,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(w){return v?Array.from(v.querySelectorAll("[data-reminder-item]")).filter(y=>y!==w):[]}function f(w){let y=p.item;if(!y||p.ready)return;let C=y.getBoundingClientRect(),M=window.getComputedStyle(y);p.ready=!0,D.draggingId=y.dataset.id||null,p.offsetY=w.clientY-C.top,p.fixedX=C.left;let x=document.createElement("div");x.className="touch-drag-placeholder",x.setAttribute("aria-hidden","true"),x.style.height=`${C.height}px`,x.style.boxSizing="border-box",x.style.marginTop=M.marginTop,x.style.marginBottom=M.marginBottom,x.style.marginLeft=M.marginLeft,x.style.marginRight=M.marginRight,x.style.borderRadius=M.borderRadius,x.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",x.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",x.style.pointerEvents="none",x.style.display="block",x.style.width="100%",y.parentNode?.insertBefore(x,y),p.placeholder=x,p.longPressTimer=null,p.originalStyles=y.getAttribute("style")||"",y.classList.add("is-dragging"),y.style.position="fixed",y.style.left=`${C.left}px`,y.style.top=`${C.top}px`,y.style.width=`${C.width}px`,y.style.zIndex="999",y.style.pointerEvents="none",y.style.touchAction="none",p.initialTouchAction=v.style.touchAction||"",v.style.touchAction="none"}function h(w){let y=p.item;if(!y||!p.ready)return;let C=w-p.offsetY;y.style.top=`${C}px`,y.style.left=`${p.fixedX}px`}function g(w){if(!p.ready||!v)return;let y=p.item,C=d(y);if(Se(),!C.length){D.dropTargetId=null,D.dropBefore=!1;return}let M=null,x=!1;for(let b of C){let k=b.getBoundingClientRect(),_=k.top+k.height/2;if(w<_){M=b,x=!0;break}}if(!M){M=C[C.length-1];let b=M.getBoundingClientRect(),k=b.top+b.height/2;x=w<k,x||(x=!1)}if(!M){D.dropTargetId=null,D.dropBefore=!1;return}let ke=M.getBoundingClientRect(),Nt=ke.top+ke.height/2,m=w<Nt;M.classList.add(m?"drag-over-before":"drag-over-after"),D.dropTargetId=M.dataset.id||null,D.dropBefore=m}function S(w){let y=D.draggingId,C=p.moved;if(!p.ready){c();return}c(),!w&&C&&y&&Dn(y,D.dropTargetId,D.dropBefore),Zt()}function T(w){let y=w.pointerType||"";if(y&&y!=="touch"&&y!=="pen"||p.active)return;let C=Xe(w.target);if(!C)return;let M=Bi(w.target);if(!(M&&M!==C)){p.active=!0,p.pointerId=w.pointerId,p.item=C,p.startX=w.clientX,p.startY=w.clientY,p.lastClientX=w.clientX,p.lastClientY=w.clientY,p.moved=!1,p.ready=!1,p.originalStyles=C.getAttribute("style")||"",p.startTime=w.timeStamp||Date.now(),D.dropTargetId=null,D.dropBefore=!0,D.draggingId=null,r(),p.longPressTimer=setTimeout(()=>{f({clientY:p.lastClientY})},n);try{C.setPointerCapture(w.pointerId)}catch{}}}function O(w){if(!p.active||w.pointerId!==p.pointerId)return;let y=w.pointerType||"";if(!(y&&y!=="touch"&&y!=="pen")){if(p.lastClientX=w.clientX,p.lastClientY=w.clientY,!p.ready){let C=Math.abs(w.clientX-p.startX),M=Math.abs(w.clientY-p.startY);if(C>t||M>t){let x=typeof w.timeStamp=="number"?w.timeStamp:Date.now();Math.abs(x-p.startTime)>=n?(r(),f({clientY:p.lastClientY})):c()}return}w.preventDefault(),p.moved=!0,h(w.clientY),g(w.clientY)}}function H(w){!p.active||w.pointerId!==p.pointerId||S(!1)}function de(w){!p.active||w.pointerId!==p.pointerId||S(!0)}v.addEventListener("pointerdown",T),window.addEventListener("pointermove",O),window.addEventListener("pointerup",H),window.addEventListener("pointercancel",de),It._bound=!0}function xn(){V=null,$t("offline"),se.forEach(e=>e.classList.remove("hidden")),G.forEach(e=>e.classList.add("hidden")),at&&(at.textContent=""),Ge?.(),Ge=null,tn(),$(),q(),Ee()}function en(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(mn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let r=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:r,c=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:Tt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:W(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:r,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(c)?c:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function ji(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(mn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:W(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(mn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function q(){oe(u),ji(u)}function tn(){u=qe(en())}tn();async function Hi(){if(!V){u=en();return}let e=qe(en());if(!e.length){u=[],q();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await X(n),n.pendingSync=!1}catch(r){console.warn("Failed to sync offline reminder",r)}u=qe(e.map(n=>({...n,pendingSync:!1}))),q(),$(),Ee()}try{j=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{j={}}if(j&&typeof j=="object"&&Object.values(j).forEach(e=>{e&&typeof e=="object"&&(e.category=W(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Qe(e),e.urlPath=e.urlPath||ct,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!he()){let e=Pn();typeof Notification<"u"&&Notification.permission==="granted"?(Mt(),e.length&&gn(e,{requestCheck:!0})):e.length&&gn(e)}let At=e=>{if(!He)return;let t=[He];He.window&&!t.includes(He.window)&&t.push(He.window);let n=!e;t.forEach(r=>{try{r.__memoryCueFirebaseUnavailable__=n}catch{}})};function Wi(){if(!z)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",r="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",c=()=>"value"in z?z.value:z.innerHTML,d=S=>{if("value"in z){z.value=S;return}if(typeof S!="string"||S.length===0){z.innerHTML="";return}let T=S.trim();if(/<\/?[a-z][\s\S]*>/i.test(T)){z.innerHTML=S;return}let H=S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");z.innerHTML=H},f=S=>{S?z.classList.add("notes-editor--columns"):z.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!S))},h="";try{h=localStorage.getItem(n)||""}catch{E("Unable to access saved notes")}d(h);let g=!1;try{g=localStorage.getItem(r)==="1"}catch{g=!1}f(g),z.addEventListener("input",()=>{h=c();try{localStorage.setItem(n,h)}catch{E("Notes saved for this session only")}}),yi?.addEventListener("click",()=>{h=c();try{localStorage.setItem(n,h),E("Notes saved")}catch{E("Notes saved for this session only")}}),hi?.addEventListener("click",()=>{let S=h;try{S=localStorage.getItem(n)||h}catch{E("Unable to load saved notes")}h=S,d(h)}),e?.addEventListener("click",S=>{let T=S.target;if(!(T instanceof Element))return;let O=T.closest("button[data-action]");if(!O)return;let H=O.getAttribute("data-action");if(H==="columns"){let de=!z.classList.contains("notes-editor--columns");f(de);try{localStorage.setItem(r,de?"1":"0")}catch{E("Column preference saved for this session only")}return}if(!a){E("Formatting controls are not supported in this browser");return}z.focus(),H==="bullets"?document.execCommand("insertUnorderedList"):H==="numbers"&&document.execCommand("insertOrderedList")})}if(Wi(),Q?.addEventListener("click",$n),Ln)({initializeApp:ut,getFirestore:lt,enableMultiTabIndexedDbPersistence:ft,enableIndexedDbPersistence:pt,doc:Be,setDoc:mt,deleteDoc:gt,onSnapshot:yt,collection:ht,query:bt,orderBy:wt,serverTimestamp:$e,getAuth:je,onAuthStateChanged:St,GoogleAuthProvider:vt,signInWithPopup:qt,signInWithRedirect:zt,getRedirectResult:Et,signOut:Xt}=Ln),We=!0;else try{({initializeApp:ut}=await Kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:lt,enableMultiTabIndexedDbPersistence:ft,enableIndexedDbPersistence:pt,doc:Be,setDoc:mt,deleteDoc:gt,onSnapshot:yt,collection:ht,query:bt,orderBy:wt,serverTimestamp:$e}=await Kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:je,onAuthStateChanged:St,GoogleAuthProvider:vt,signInWithPopup:qt,signInWithRedirect:zt,getRedirectResult:Et,signOut:Xt}=await Kt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),We=!0}catch(e){We=!1,console.warn("Firebase modules failed to load:",e),E("Firebase failed to load; notes available offline"),At(!1)}if(We&&typeof ut=="function"&&typeof lt=="function"&&typeof je=="function")try{let e=Cr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Jt=ut(e),me=lt(Jt),ue=!0,console.info("[Firebase] Firestore initialised",e.projectId),At(!0)}catch(e){ue=!1,console.warn("Firebase initialization failed:",e),E("Firebase failed to load; notes available offline"),At(!1)}else We?(ue=!1,At(!1)):ue=!1;ue&&typeof ft=="function"&&typeof pt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await ft(me),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await pt(me),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(r){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",r?.code||r)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ue&&typeof je=="function"&&(Ye=je(Jt));function Yi(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Gi=typeof navigator<"u"&&navigator.language?navigator.language:"",kn=Yi(Gi),Oe=kn||"en-US",ge="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(ge=e.timeZone),!kn&&e.locale&&(Oe=e.locale)}catch{}let Vi=new Intl.DateTimeFormat(Oe,{timeZone:ge,hour:"2-digit",minute:"2-digit"}),qi=new Intl.DateTimeFormat(Oe,{timeZone:ge,weekday:"long",day:"numeric",month:"long"}),zi=new Intl.DateTimeFormat("en-CA",{timeZone:ge,year:"numeric",month:"2-digit",day:"2-digit"}),Xi=new Intl.DateTimeFormat(Oe,{timeZone:ge,weekday:"long"}),Ki=new Intl.DateTimeFormat(Oe,{timeZone:ge,month:"short",day:"numeric"});function ve(e){let t=zi.formatToParts(e),n=t.find(c=>c.type==="year").value,r=t.find(c=>c.type==="month").value,a=t.find(c=>c.type==="day").value;return`${n}-${r}-${a}`}function Nn(e,t){let[n,r,a]=e.split("-").map(h=>parseInt(h,10)),[c,d]=t.split(":").map(h=>parseInt(h,10)),f=new Date;return f.setFullYear(n,(r||1)-1,a||1),f.setHours(c||0,d||0,0,0),f.toISOString()}let Ji=new Intl.DateTimeFormat("en-CA",{timeZone:ge,year:"numeric",month:"2-digit",day:"2-digit"}),Qi=new Intl.DateTimeFormat("en-CA",{timeZone:ge,hour:"2-digit",minute:"2-digit",hour12:!1});function Zi(e){try{let t=new Date(e),n=Ji.formatToParts(t),r=n.find(d=>d.type==="year")?.value||"0000",a=n.find(d=>d.type==="month")?.value||"00",c=n.find(d=>d.type==="day")?.value||"00";return`${r}-${a}-${c}`}catch{return""}}function er(e){try{let t=new Date(e),n=Qi.formatToParts(t),r=n.find(c=>c.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(c=>c.type==="minute")?.value?.padStart(2,"0")||"00";return`${r}:${a}`}catch{return""}}function Tt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Lt(){return ve(new Date)}function tr(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Br(e){let t=tr(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Ct(e){return e==="High"?3:e==="Medium"?2:1}function Fn(e,t){let n=e?.done?1:0,r=t?.done?1:0;if(n!==r)return n-r;let a=e?.due?new Date(e.due).getTime():1/0,c=t?.due?new Date(t.due).getTime():1/0;if(a!==c)return a-c;let d=Ct(t?.priority)-Ct(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function Or(e,t){let n=Ct(t.priority)-Ct(e.priority);if(n)return n;let r=+new Date(e.due||0),a=+new Date(t.due||0);return r!==a?r-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Rn(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return qi.format(t)}catch{return e}}function nn(e){return Vi.format(e)}function nr(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Mr(e){return e?nr(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function E(e){F&&(Ne(),F.dataset.statusKind="toast",F.textContent=e,clearTimeout(E._t),E._t=setTimeout(()=>{F&&F.dataset.statusKind==="toast"&&(F.textContent="",delete F.dataset.statusKind)},2500))}function ir(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)}}function Dt(e){e=String(e||"").toLowerCase();let t={date:Lt(),time:""},n=f=>{let h=new Date,g=h.getDay(),S=(f-g+7)%7,T=new Date(h);return T.setDate(h.getDate()+(S===0?7:S)),T},r=f=>{let h=new Date,g=h.getDay(),S=(f-g+7)%7,T=new Date(h);return T.setDate(h.getDate()+S),T},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},c={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let f=new Date;f.setDate(f.getDate()+1),t.date=ve(f)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=a[f[1]],g=n(h);t.date=ve(g)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=a[f[1]],g=r(h);t.date=ve(g)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let f=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),h=a[f[1]],g=n(h);t.date=ve(g)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let f=e.match(/\bin\s+(\d+)\s+days?\b/),h=parseInt(f[1],10),g=new Date;g.setDate(g.getDate()+h),t.date=ve(g)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let f=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),h=parseInt(f[1],10),g=parseInt(f[2],10)-1,S=f[3]?parseInt(f[3],10):new Date().getFullYear(),T=new Date(S,g,h);t.date=ve(T)}else for(let[f,h]of Object.entries(c)){let g=new RegExp(`\\b${f}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(g.test(e)){let S=e.match(g),T=parseInt(S[1],10),O=new Date().getFullYear(),H=new Date(O,h,T);t.date=ve(H);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let f=parseInt(d[1],10),h=d[2]?parseInt(d[2],10):0,g=d[3];g&&(g==="pm"&&f<12&&(f+=12),g==="am"&&f===12&&(f=0)),t.time=`${String(f).padStart(2,"0")}:${String(h).padStart(2,"0")}`}return t}let rn=ue&&Ye&&typeof vt=="function";Vn({authReady:rn,auth:Ye,GoogleAuthProvider:vt,signInWithPopup:qt,signInWithRedirect:zt,signOut:Xt,toast:E});let Bn=Ti,On=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let r=t(n);r&&typeof r.then=="function"&&r.catch(a=>{console.error("Auth handler error:",a)})}catch(r){console.error("Auth handler error:",r)}}),e._authWired=!0)};Bn&&se.length&&se.forEach(e=>On(e,qn)),rn&&typeof Et=="function"&&Et(Ye).catch(()=>{}),Bn&&G.length&&G.forEach(e=>On(e,zn)),rn&&typeof St=="function"?St(Ye,async e=>{e?(V=e.uid,$t("online"),se.forEach(t=>t.classList.add("hidden")),G.forEach(t=>t.classList.remove("hidden")),at&&(at.textContent=e.displayName||e.email||""),rr(),await Hi()):xn()}):xn();function rr(){if(!ue||!me||typeof ht!="function"||typeof bt!="function"||typeof wt!="function"||typeof yt!="function")return;if(!V){tn(),$(),q(),Ee();return}Ge&&Ge();let e=ht(me,"users",V,"reminders"),t=bt(e,wt("updatedAt","desc"));Ge=yt(t,n=>{let r=[];n.forEach(a=>{let c=a.data(),d=Number(c.orderIndex);r.push({id:a.id,title:c.title,priority:c.priority,notes:c.notes||"",done:!!c.done,due:c.due||null,category:W(c.category),createdAt:c.createdAt?.toMillis?.()||0,updatedAt:c.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null})}),u=qe(r),$(),q(),Ee()},n=>{console.error("Firestore sync error:",n),U&&$t("error","Sync Error")})}async function X(e){if(!(!ue||!V||!me||typeof Be!="function"||typeof mt!="function"||typeof $e!="function"))try{await mt(Be(me,"users",V,"reminders",e.id),{ownerUid:V,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||Y,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):$e(),updatedAt:$e()},{merge:!0})}catch(t){console.error("Save failed:",t),E("Save queued (offline)")}}async function or(e){if(!(!ue||!V||!me||typeof Be!="function"||typeof gt!="function"))try{await gt(Be(me,"users",V,"reminders",e))}catch{E("Delete queued (offline)")}}async function Ke(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||Y,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Je(){l&&(l.value=""),I&&(I.value=""),N&&(N.value=""),B&&(B.value=""),dt("Medium"),L&&(L.value=Y),In(),Ve=null,Q&&(Q.textContent="Save"),ie?.classList.add("hidden")}function ar(e){let t=u.find(n=>n.id===e);t&&(l&&(l.value=t.title||""),I&&N&&(t.due?(I.value=Zi(t.due),N.value=er(t.due)):(I.value="",N.value="")),dt(t?.priority||"Medium"),L&&(L.value=W(t.category)),B&&(B.value=typeof t.notes=="string"?t.notes:""),Ve=e,Q&&(Q.textContent="Update"),ie?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),l?.focus(),we("cue:open",{mode:"edit"}))}function sr(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),r=W(e.category??(L?L.value:"")),a={id:Tt(),title:e.title.trim(),priority:e.priority||"Medium",category:r,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!V};Qt(a,{position:"start"}),u=[a,...u],oe(u);let c=ze(u);return Ce=!0,$(),q(),vn(a),c?u.forEach(d=>X(d)):X(a),Ke(a),xe(a),Ue(),we("memoryCue:remindersUpdated",{items:u}),Tn(),ce({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function dr(e,t){if(!V)return E("Sign in to add notes"),null;if(!e)return null;let n=u.find(d=>d.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let c=typeof n.notes=="string"?n.notes:"";return n.notes=c?`${c}
${a}`:a,n.updatedAt=Date.now(),X(n),$(),q(),ce({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function cr(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),X(t),Ke(t),$(),q(),t.done?(kt(e),ce({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(xe(t),ce({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function ur(e){if(!re||re.tokenId!==e)return;let{item:t,index:n}=re;if(!t){Ne(e);return}Ne(e);let r=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!V,t.updatedAt=Date.now(),u.splice(r,0,t),oe(u);let a=ze(u);Ce=!0,$(),q(),xe(t),a?u.forEach(c=>X(c)):X(t),Ke(t),Ue(),we("memoryCue:remindersUpdated",{items:u}),ce({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),E("Reminder restored")}function Mn(e){let t=u.findIndex(a=>a.id===e),n=t>=0?u.splice(t,1)[0]:null;$(),q(),or(e),kt(e);let r=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(ce({action:"deleted",label:r}),n&&F){Ne();let a=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;re={tokenId:a,item:n,index:t,timeoutId:null},gi(re),re.timeoutId=setTimeout(()=>{Ne(a)},mi)}else n&&Ne()}function lr(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,r=48,a=800,c='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,f=!1,h=0,g=0,S=0,T=()=>{if(f){if(f=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",H),e.removeEventListener("pointerup",de),e.removeEventListener("pointercancel",w),e.removeEventListener("pointerleave",w),window.removeEventListener("pointerup",de),window.removeEventListener("pointercancel",w)}},O=y=>{if(y.pointerType==="mouse"&&y.button!==0)return;f&&T();let C=y.target;C instanceof Element&&C.closest(c)||(d=y.pointerId,h=y.clientX,g=y.clientY,S=typeof y.timeStamp=="number"?y.timeStamp:Date.now(),f=!0,e.addEventListener("pointermove",H),e.addEventListener("pointerup",de),e.addEventListener("pointercancel",w),e.addEventListener("pointerleave",w),window.addEventListener("pointerup",de),window.addEventListener("pointercancel",w))},H=y=>{if(!f||y.pointerId!==d)return;Math.abs(y.clientY-g)>r&&T()},de=y=>{if(!f||y.pointerId!==d)return;let C=y.clientX-h,M=Math.abs(y.clientY-g),x=(typeof y.timeStamp=="number"?y.timeStamp:Date.now())-S;if(T(),C<=-n&&M<=r&&x<=a){y.preventDefault(),y.stopPropagation();try{t()}catch(ke){console.warn("Swipe delete handler failed",ke)}}},w=y=>{f&&(typeof y.pointerId=="number"&&y.pointerId!==d||T())};e.addEventListener("pointerdown",O)}function Qe(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(r=>r.trim()).find(Boolean);if(n){if(e.due)try{let r=new Date(e.due);if(!Number.isNaN(r.getTime())){let a=nn(r);if(a)return`${n} \u2022 ${a}`}}catch{}return n}if(e.due)try{let r=new Date(e.due);if(!Number.isNaN(r.getTime())){let a=nn(r);if(a)return`Due ${a}`}}catch{}return"Due now"}function _n(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}E("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Pn(){return Object.values(j||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||Y,notes:typeof e.notes=="string"?e.notes:"",body:Qe(e),urlPath:e.urlPath||ct,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function on(){try{localStorage.setItem("scheduledReminders",JSON.stringify(j))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Pn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Mt(),gn(e,{requestCheck:t})}function xt(e,{closeNotification:t=!0}={}){if(t){let n=ye.get(e);if(n){try{n.close()}catch{}ye.delete(e)}}De[e]&&(clearTimeout(De[e]),delete De[e]),yn(e),j[e]&&(delete j[e],on())}function kt(e){xt(e)}function Un(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ye.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Qe(e),tag:e.id});ye.set(e.id,n);let r=()=>{ye.get(e.id)===n&&ye.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",r),n.addEventListener("click",r)),n.onclose=r,n.onclick=r}catch{}}async function fr(e){if(!he())return!1;let t=oi();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let r=await Te();if(!r)return!1;await yn(e.id,r);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||Y,body:c,urlPath:ct},c=Qe(e),d={body:c,tag:e.id,data:a,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await r.showNotification(e.title,d),!0}catch(f){return console.warn("Failed to schedule persistent notification",f),!1}}function xe(e){if(!e||!e.id)return;if(e.category=W(e.category),!e.due||e.done){kt(e.id);return}let t=j[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||Y,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Qe(e),urlPath:ct,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let d=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return d===e.due?f:null})()};if(j[e.id]=n,on(),De[e.id]&&(clearTimeout(De[e.id]),delete De[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let r=new Date(e.due).getTime();if(!Number.isFinite(r))return;let a=r-Date.now();if(a<=0){if(j[e.id]?.viaTrigger){xt(e.id,{closeNotification:!1});return}Un(e),xt(e.id,{closeNotification:!1});return}let c=he();c&&(n.viaTrigger=!1,fr(e).then(d=>{d&&j[e.id]&&(j[e.id]={...j[e.id],viaTrigger:!0},on())})),De[e.id]=setTimeout(()=>{c&&yn(e.id),Un(e),xt(e.id,{closeNotification:!1})},a)}function Ee(){Object.values(j).forEach(e=>xe({...e,category:W(e?.category)}))}function pr(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Xi.format(t),r=Ki.format(t),a=nn(t);return`${n}, ${r}${a?` at ${a}`:""}`}catch{return"No due date"}}function $(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let r=new Date(t);if(r.setHours(23,59,59,999),Se(),oe(u),bn)try{bn.textContent=String(u.length)}catch{}u.forEach(m=>{m&&typeof m=="object"&&(m.category=W(m.category))});let a=new Set(Tr.map(m=>W(m)));u.forEach(m=>{m&&typeof m=="object"&&a.add(W(m.category))});let c=Array.from(a).sort((m,b)=>m.localeCompare(b,void 0,{sensitivity:"base"}));if(Ht){let m=new Set;Array.from(Ht.querySelectorAll("option")).forEach(b=>{m.add(b.value.trim().toLowerCase())}),c.forEach(b=>{let k=b.toLowerCase();if(!m.has(k)){let _=document.createElement("option");_.value=b,Ht.appendChild(_),m.add(k)}})}if(Ce)Ce=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=u.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(b))}}catch{}}let d=u.slice();oe(d);let f=!0,h=u.length>0,g=d.length>0,S=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(j||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(m.map(b=>b.id))})();if(Re)if(g)Re.classList.add("hidden");else{let m=h?"No reminders to show right now.":ki;An?An(Re,{icon:h?"sparkles":"bell",title:h?"Nothing to display":"Create your first cue",description:m,action:h?void 0:`<button type="button" class="${Ni}" data-trigger="open-cue">Create reminder</button>`}):Re.textContent=m,Re.classList.remove("hidden")}if(wn&&wn.classList.toggle("has-items",g),!v)return;if(!g){Re?(v.innerHTML="",v.classList.add("hidden")):(v.innerHTML='<div class="text-muted">No reminders found.</div>',v.classList.remove("hidden"));return}v.classList.remove("hidden"),v.replaceChildren();let T=document.createDocumentFragment(),O=v.tagName==="UL"||v.tagName==="OL",H=!0,de=["priority-high","priority-medium","priority-low"],w=(m,b)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...de);let k=typeof b=="string"?b.trim().toLowerCase():"";k.startsWith("h")?m.classList.add("priority-high"):k.startsWith("m")?m.classList.add("priority-medium"):k.startsWith("l")&&m.classList.add("priority-low")},y=(m,b="neutral")=>{let k=document.createElement("span");k.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",k.title=m,k.dataset.tone=b;let _=document.createElement("span");_.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?_.classList.add("bg-error"):b==="priority-medium"?_.classList.add("bg-warning"):b==="priority-low"?_.classList.add("bg-secondary"):b==="category"?_.classList.add("bg-primary"):_.classList.add("bg-base-content","opacity-40");let R=document.createElement("span");return R.className="truncate",R.textContent=m,k.append(_,R),k},C=(m,b,{elementTag:k,isMobile:_})=>{let R={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:b,done:!!m.done},A=document.createElement(k);A.className="task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",_&&A.classList.add("w-full"),A.dataset.id=R.id,A.dataset.category=R.category,A.dataset.title=R.title;let jn=R.priority&&String(R.priority).trim();jn?A.dataset.priority=jn:delete A.dataset.priority,A.dataset.done=String(R.done),R.dueIso?A.dataset.due=R.dueIso:delete A.dataset.due,A.dataset.reminder=JSON.stringify(R),A.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",A.dataset.reminderItem="true",A.dataset.compact="true",A.classList.add("reminder-draggable"),A.setAttribute("draggable","true"),A.setAttribute("role","button"),A.tabIndex=0,A.setAttribute("aria-label",`Edit reminder: ${m.title}`),w(A,R.priority),S.has(R.id)?A.dataset.notificationActive="true":delete A.dataset.notificationActive;let an=R.dueIso?new Date(R.dueIso):null;f&&an&&an>=n&&an<=r?(A.classList.add("is-today"),A.dataset.today="true"):(A.classList.remove("is-today"),delete A.dataset.today);let Ft=document.createElement("div");Ft.className="flex min-w-0 flex-col gap-2";let Me=document.createElement("p");Me.className="text-lg font-bold leading-snug text-base-content",Me.classList.add("desktop-reminder-title"),_||Me.classList.add("sm:text-[0.95rem]"),R.done&&Me.classList.add("line-through","text-base-content/60"),Me.textContent=m.title,Ft.appendChild(Me);let Ze=document.createElement("div");Ze.className="desktop-reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let sn=pr(m),Hn=sn&&sn!=="No due date"?sn:"";Hn&&Ze.appendChild(y(Hn,"due")),!!(b&&b!==Y)&&Ze.appendChild(y(b,"category")),Ze.children.length&&Ft.appendChild(Ze),A.appendChild(Ft);let dn=document.createElement("div");dn.className="flex items-start gap-1";let ne=document.createElement("button");ne.type="button",ne.className="btn btn-ghost btn-circle btn-xs",R.done?(ne.classList.add("text-base-content/60"),ne.innerHTML='<span aria-hidden="true">\u21BA</span>',ne.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(ne.classList.add("text-success"),ne.innerHTML='<span aria-hidden="true">\u2713</span>',ne.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),ne.setAttribute("aria-pressed",R.done?"true":"false"),ne.setAttribute("data-reminder-control","toggle"),ne.setAttribute("data-no-swipe","true"),ne.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),cr(R.id)});let Ie=document.createElement("button");Ie.type="button",Ie.className="btn btn-ghost btn-circle btn-xs text-error",Ie.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',Ie.setAttribute("aria-label",`Delete reminder: ${m.title}`),Ie.setAttribute("data-reminder-control","delete"),Ie.setAttribute("data-no-swipe","true"),Ie.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),Mn(R.id)}),dn.append(ne,Ie),A.appendChild(dn);let Wn=()=>ar(R.id);return A.addEventListener("click",K=>{if(K.defaultPrevented)return;let cn=K.target;cn&&typeof cn.closest=="function"&&cn.closest("[data-reminder-control]")||Wn()}),A.addEventListener("keydown",K=>{K.defaultPrevented||K.target===A&&(K.key==="Enter"||K.key===" ")&&(K.preventDefault(),Wn())}),_&&lr(A,()=>Mn(R.id)),A},M=(m,b)=>C(m,b,{elementTag:"div",isMobile:!0});if(be!=="desktop"&&!H){d.forEach(m=>{let b=m.category||Y;T.appendChild(M(m,b))}),v.appendChild(T);return}let x=new Map;d.forEach(m=>{let b=m.category||Y;x.has(b)||x.set(b,[]),x.get(b).push(m)});let ke=Array.from(x.entries()).sort((m,b)=>m[0].localeCompare(b[0],void 0,{sensitivity:"base"})),Nt=!0;ke.forEach(([m,b])=>{if(m!==Y){let k=document.createElement(O?"li":"div");k.dataset.categoryHeading=m,O&&(k.setAttribute("role","presentation"),k.style.listStyle="none"),k.className=be==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",Nt||(k.style.marginTop=be==="desktop"?"1.25rem":"1rem");let _=document.createElement("div");_.setAttribute("role","heading"),_.setAttribute("aria-level","3"),_.className=be==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let R=document.createElement("span");R.textContent=m;let A=document.createElement("span");A.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",A.textContent=`${b.length} ${b.length===1?"item":"items"}`,_.append(R,A),k.appendChild(_),T.appendChild(k)}b.forEach(k=>{if(be==="desktop"){let _=C(k,m,{elementTag:O?"li":"div",isMobile:!1});T.appendChild(_);return}T.appendChild(M(k,m))}),Nt=!1}),v.appendChild(T)}function le(){_e?.setAttribute("aria-expanded","false"),Pe?.classList.add("hidden")}function mr(){_e?.setAttribute("aria-expanded","true"),Pe?.classList.remove("hidden")}_e?.addEventListener("click",e=>{e.stopPropagation(),_e.getAttribute("aria-expanded")==="true"?le():mr()}),document.addEventListener("click",e=>{Pe&&!Pe.classList.contains("hidden")&&!Pe.contains(e.target)&&e.target!==_e&&le()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&le()}),Ai.forEach(e=>{e.addEventListener("click",()=>{let t=st?.classList.contains("hidden");st?.classList.toggle("hidden"),t&&st?.scrollIntoView({behavior:"smooth",block:"start"}),le()})}),document.addEventListener("DOMContentLoaded",()=>{st?.classList.add("hidden")});function $n(){try{console.log("handleSaveAction invoked",{editingId:Ve,title:l?.value})}catch{}let t=(typeof l?.value=="string"?l.value:"").trim(),n=typeof I?.value=="string"?I.value:"",r=typeof N?.value=="string"?N.value:"";if(Ve){let d=u.find(g=>g.id===Ve);if(!d){Je();return}if(!t){E("Add a reminder title");return}let f=null;if(n||r){let g=n||Lt();f=Nn(g,r||"09:00")}else{let g=Dt(t);g.time&&(f=new Date(`${g.date}T${g.time}:00`).toISOString())}d.title=t;let h=Yt();d.priority=h,dt(h),L&&(d.category=W(L.value)),d.due=f,B&&(d.notes=B.value.trim()),d.updatedAt=Date.now(),X(d),Ke(d),Ce=!0,$(),xe(d),q(),Ue(),we("memoryCue:remindersUpdated",{items:u}),Tn(),ce({action:"updated",label:`Reminder updated \xB7 ${d.title}`}),Je(),E("Reminder updated"),we("cue:close",{reason:"updated"});return}if(!t){E("Add a reminder title");return}let a=B?B.value.trim():"",c=null;if(n||r){let d=n||Lt();c=Nn(d,r||"09:00")}else{let d=Dt(t);d.time&&(c=new Date(`${d.date}T${d.time}:00`).toISOString())}sr({title:t,priority:Yt(),category:L?L.value:"",due:c,notes:a}),l&&(l.value=""),N&&(N.value=""),B&&(B.value=""),we("cue:close",{reason:"created"})}l?.addEventListener("keydown",e=>{e.key==="Enter"&&$n()});function gr(){if(!l||!Le)return;let e=l.value.trim();if(!e){Le.style.display="none";return}try{let t=Dt(e),n=Lt();if(t.date!==n||t.time){let r="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");r+=`\u{1F4C5} ${Rn(t.date)}`}t.time&&(r+=`${r?" ":""}\u{1F550} ${t.time}`),r?(Le.textContent=`Parsed: ${r}`,Le.style.display="block"):Le.style.display="none"}else Le.style.display="none"}catch{Le.style.display="none"}}return l?.addEventListener("input",ir(gr,300)),ie?.addEventListener("click",()=>{Je(),E("Edit cancelled"),we("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Je()}),document.addEventListener("cue:prepare",()=>{Je()}),window.addEventListener("load",()=>l?.focus()),wi?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?Rn(t.due.slice(0,10)):"",r=t.due?new Date(t.due).toLocaleTimeString(Oe,{hour:"2-digit",minute:"2-digit",timeZone:ge}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${r}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){E("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>E("Copied for Master Task List")).catch(()=>E("Copy failed")),le()}),jt?.addEventListener("change",()=>{let e=jt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),r=[];n.forEach(c=>{let d={...c,id:Tt(),category:W(c.category),pendingSync:!V,orderIndex:null};Qt(d,{position:"start"}),u=[d,...u],r.push(d)}),oe(u);let a=ze(u);$(),q(),a?u.forEach(c=>X(c)):r.forEach(c=>X(c)),E("Import successful")}catch{E("Invalid JSON")}},t.readAsText(e),jt.value="",le()}),Si?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),le()}),vi?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){E("Add your Apps Script URL in Settings first"),le();return}if(!u.length){E("No tasks to sync"),le();return}E("Syncing all tasks\u2026");let t=20,n=0;for(let r=0;r<u.length;r+=t){let a=u.slice(r,r+t),c=await Promise.allSettled(a.map(d=>{let f={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||Y,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}));n+=c.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}E(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),le()}),Fe&&(Fe.value=localStorage.getItem("syncUrl")||""),Ei?.addEventListener("click",()=>{Fe&&(localStorage.setItem("syncUrl",Fe.value.trim()),E("Settings saved"))}),Ii?.addEventListener("click",async()=>{if(!Fe)return;let e=Fe.value.trim();if(!e){E("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});E(t.ok?"Test ok":"Test failed")}catch{E("Test failed")}}),bi?.addEventListener("click",async()=>{if(!("Notification"in window)){E("Notifications not supported");return}if(Notification.permission==="granted"){E("Notifications enabled"),he()?Te():(Mt(),_n()),Ee(),$();return}try{await Notification.requestPermission()==="granted"?(E("Notifications enabled"),he()?Te():(Mt(),_n()),Ee(),$()):E("Notifications blocked")}catch{E("Notifications blocked")}}),$i(),Ee(),$(),q(),{cancelReminder:kt,scheduleReminder:xe,closeActiveNotifications:ai,getActiveNotifications:()=>ye,addNoteToReminder:dr,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:W(t?.category)})):[],u=qe(u),oe(u),$()},render:$,getItems:()=>u.map(e=>({...e}))}}}var ti,ye,ni,ln,fn,ii,Ot,ot,pn,Y,Tr,mn,fe,Lr,pe,kr=un(()=>{Kn();ti="memoryCue:activity",ye=new Map,ni=!1,ln="service-worker.js",fn="memory-cue-reminder-sync",ii=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Ot=null,ot=null,pn=!1,Y="General",Tr=Object.freeze([Y,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),mn="memoryCue:offlineReminders",fe=1024,Lr=Object.freeze({}),pe=null});var ui,Nr,Ut,li,_t,fi,si,Pt,di,Fr,qr,ci,Rr=un(()=>{ui="memoryCueNotes",Nr=["mobileNotes"],Ut=()=>typeof localStorage<"u",li=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,_t=i=>{if(typeof i!="string")return"";let o=i.trim();if(!o.length)return"";if(!/[<>]/.test(o))return i;try{if(typeof document<"u"){let s=document.createElement("div");return s.innerHTML=o,(typeof s.innerText=="string"&&s.innerText.length?s.innerText:s.textContent||"").replace(/\r?\n/g,`
`)}}catch{}return o.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},fi=i=>{if(typeof i!="string")return!1;let o=Date.parse(i);return!Number.isNaN(o)},si=(i,o,s={})=>{let l=typeof i=="string"?i.trim():"";return{id:s.id&&typeof s.id=="string"?s.id:li(),title:l||"Untitled note",body:typeof o=="string"?_t(o):"",updatedAt:s.updatedAt&&fi(s.updatedAt)?s.updatedAt:new Date().toISOString()}},Pt=i=>{if(Array.isArray(i))return i.map(o=>{if(!o||typeof o!="object")return null;let s=typeof o.title=="string"?o.title.trim():"",l=typeof o.body=="string"?_t(o.body):"",I=typeof o.id=="string"&&o.id.trim()?o.id:li(),N=fi(o.updatedAt)?o.updatedAt:new Date().toISOString();return!s&&!l?null:{id:I,title:s||"Untitled note",body:l,updatedAt:N}}).filter(Boolean);if(i&&typeof i=="object"){let o=typeof i.title=="string"?i.title:"",s=typeof i.body=="string"?_t(i.body):"";return!o&&!s?[]:[si(o,s,{id:typeof i.id=="string"?i.id:void 0,updatedAt:typeof i.updatedAt=="string"?i.updatedAt:void 0})]}return typeof i=="string"&&i.trim().length?[si("Notebook (legacy)",_t(i))]:[]},di=i=>{if(!Ut())return null;try{return localStorage.getItem(i)}catch{return null}},Fr=i=>{if(Ut())try{localStorage.removeItem(i)}catch{}},qr=()=>{if(!Ut())return[];let i=di(ui);if(typeof i=="string")try{let o=JSON.parse(i),s=Pt(o);if(s.length)return s}catch{let o=Pt(i);if(o.length)return ci(o),o}for(let o of Nr){let s=di(o);if(typeof s=="string"&&s.trim().length){let l=Pt(s);if(l.length)return ci(l),Fr(o),l}}return[]},ci=i=>{if(!Ut()||!Array.isArray(i))return!1;let o=i.map(s=>Pt([s])[0]).filter(Boolean);try{return localStorage.setItem(ui,JSON.stringify(o)),!0}catch{return!1}}});export{$r as a,Kn as b,Yr as c,kr as d,si as e,qr as f,ci as g,Rr as h};
