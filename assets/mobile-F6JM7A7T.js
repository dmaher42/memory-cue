import{a as ee,b as de,c as te,d as le,e as z,f as K,g as V,h as Y,i as ue,j as ne,k as fe}from"./chunk-FRQOQPUJ.js";import{a as X,b as ce}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{c as ae}from"./chunk-GUVSRPRW.js";var me=ae(()=>{ce();le();de();ue();fe();X();(function(){let n=()=>{let e=document.getElementById("create-sheet"),a=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(a instanceof HTMLElement)){let s=typeof n._retryCount=="number"?n._retryCount:0;s<10&&(n._retryCount=s+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let p=e.querySelector("[data-dialog-content]"),y=e.querySelector(".sheet-backdrop"),r=document.getElementById("createReminderForm"),l=document.getElementById("saveReminder"),h=document.getElementById("priority"),v=document.getElementById("priorityChips"),H=v?Array.from(v.querySelectorAll('input[name="priority"]')):[],w=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),d=Array.from(w).filter(s=>s instanceof HTMLElement),k=d[0]||null,T=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};T();let c=null,N=(s,I)=>{try{document.dispatchEvent(new CustomEvent(s,{detail:I}))}catch(B){console.warn(`${s} dispatch failed`,B)}},x=()=>{let s=h?.value||"Medium";H.forEach(I=>{let B=I.value===s;I.checked=B,I.setAttribute("aria-checked",B?"true":"false")})},O=s=>{h&&(h.value!==s&&(h.value=s,h.dispatchEvent(new Event("change",{bubbles:!0}))),x())};H.forEach(s=>{s.addEventListener("change",()=>{s.checked&&O(s.value)})}),h?.addEventListener("change",x),x();let _=()=>{let s=e.querySelector('input, textarea, select, button, [contenteditable="true"]');s instanceof HTMLElement&&setTimeout(()=>{try{s.focus()}catch{}},0)},$=s=>{c=s instanceof HTMLElement?s:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),c&&c.setAttribute("aria-expanded","true"),x(),_(),N("reminder:sheet-opened",{trigger:c})},D=(s="dismissed")=>{let I=!e.classList.contains("hidden");T(),c&&c.setAttribute("aria-expanded","false");let B=c&&document.body.contains(c)&&c||k;if(B&&typeof B.focus=="function")try{B.focus()}catch{}I&&N("reminder:sheet-closed",{reason:s,trigger:c}),c=null};d.forEach(s=>{s.addEventListener("click",I=>{I.preventDefault();let B={mode:"create",trigger:s};N("cue:prepare",B),N("cue:open",B)})}),a.addEventListener("click",s=>{s.preventDefault(),D("close-button")}),y?.addEventListener("click",s=>{s.target===y&&D("backdrop")}),e.addEventListener("keydown",s=>{s.key==="Escape"&&(s.stopPropagation(),D("escape"))}),p?.addEventListener("click",s=>{s.stopPropagation()}),e.addEventListener("click",s=>{s.target instanceof HTMLElement&&s.target.hasAttribute("data-close")&&D("backdrop")}),document.addEventListener("cue:open",s=>{x(),$(s?.detail?.trigger||null)}),document.addEventListener("cue:close",s=>{D(s?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{x()}),document.addEventListener("cue:cancelled",()=>{D("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=D),document.addEventListener("reminder:save",s=>{if(!(l instanceof HTMLElement))return;let I=s?.detail?.trigger;I&&I!==l||l.matches(":disabled")||l.click()}),r instanceof HTMLFormElement&&l instanceof HTMLElement&&r.addEventListener("submit",s=>{s.preventDefault(),!l.matches(":disabled")&&l.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var G=()=>{G._initialised||(G._initialised=!0,te({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G,{once:!0}):G();var oe=()=>{if(typeof document>"u")return;let n=document.getElementById("noteTitleMobile"),e=document.getElementById("noteBodyMobile"),a=e?.closest('[data-role="note-body-field"]'),p=document.getElementById("noteSaveMobile"),y=document.getElementById("noteNewMobile"),r=document.getElementById("notesListMobile"),l=document.getElementById("notesCountMobile"),h=document.getElementById("notesFilterMobile"),v=document.getElementById("savedNotesSheet"),H=document.querySelector('[data-action="open-saved-notes"]'),w=document.querySelector('[data-action="close-saved-notes"]');if(!n||!e||!p)return;let d=()=>{if(!a||!e)return;let o=typeof e.value=="string"&&e.value.trim().length>0;a.setAttribute("data-has-content",o?"true":"false")};d(),e.addEventListener("input",d);let k=(o,i=200)=>{let u;return(...A)=>{u&&clearTimeout(u),u=setTimeout(()=>{o(...A)},i)}},T=null,c=[],N="",x=!1,O=null,_=()=>v?.dataset.open==="true",$=()=>{v&&(O&&(clearTimeout(O),O=null),v.classList.remove("hidden"),v.dataset.open="true",v.setAttribute("aria-hidden","false"))},D=()=>{v&&(v.dataset.open="false",v.setAttribute("aria-hidden","true"),O&&clearTimeout(O),O=setTimeout(()=>{v?.classList.add("hidden")},200))};(()=>{v&&(H?.addEventListener("click",o=>{o.preventDefault(),$()}),w?.addEventListener("click",o=>{o.preventDefault(),D()}),v.addEventListener("click",o=>{o.target===v&&D()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&_()&&D()}))})();let I=()=>typeof N=="string"?N.trim().toLowerCase():"",B=(o=c)=>{if(!Array.isArray(o))return[];let i=I();return i?o.filter(u=>{let A=typeof u?.title=="string"?u.title.toLowerCase():"",S=typeof u?.body=="string"?u.body.toLowerCase():"";return A.includes(i)||S.includes(i)}):[...o]},U=o=>{if(!o){T=null,n.value="",e.value="",delete n.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody,d();return}T=o.id,n.value=o.title||"",e.value=o.body||"",n.dataset.noteOriginalTitle=o.title||"",e.dataset.noteOriginalBody=o.body||"",d()},t=()=>{if(!r)return;r.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(i=>{if(!(i instanceof HTMLElement))return;let u=i.getAttribute("data-note-id")===T;u?i.setAttribute("data-state","active"):i.removeAttribute("data-state"),i.setAttribute("aria-current",u?"true":"false")})},f=o=>{if(!o)return"";let i=new Date(o);if(Number.isNaN(i.getTime()))return"";let u=new Date,A=i.getFullYear()===u.getFullYear()&&i.getMonth()===u.getMonth()&&i.getDate()===u.getDate(),S=i.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return A?`Today \xB7 ${S}`:`${i.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${S}`},E=()=>{let o=typeof n.value=="string"?n.value:"",i=typeof e.value=="string"?e.value:"",u=n.dataset.noteOriginalTitle??"",A=e.dataset.noteOriginalBody??"";return o!==u||i!==A},L=()=>{let o=V();return Array.isArray(o)?[...o].sort((i,u)=>{let A=Date.parse(i?.updatedAt||""),S=Date.parse(u?.updatedAt||"");return(Number.isNaN(S)?0:S)-(Number.isNaN(A)?0:A)}):[]},b=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(z)}catch{return null}},g=b(),m=()=>(g=b(),g),F=({preserveDraft:o=!0}={})=>{let i=L();c=Array.isArray(i)?[...i]:[];let u=o&&E(),A=c.length>0,S=B();if(R(S),!A)return u||U(null),t(),m(),x=!1,S;if(T){let C=c.find(M=>M.id===T)||null;C?u||U(C):(T=null,!u&&!x&&c[0]&&U(c[0]))}else!u&&!x&&c[0]&&U(c[0]);return x=!1,t(),m(),S},Z=o=>{if(!o)return;let i=V();if(!Array.isArray(i))return;let u=i.filter(A=>A.id!==o);u.length!==i.length&&(Y(u),m(),T===o&&(U(null),x=!0),F({preserveDraft:!1}))},R=(o=[])=>{if(!r)return o;if(r.innerHTML="",l){let i=c.length,u=o.length;l.textContent=i?`${u} of ${i} saved`:"No saved notes yet"}if(!o.length){let i=document.createElement("li");return i.className="text-xs italic text-base-content/60 px-3 py-4 text-center rounded-2xl border border-dashed border-base-200/80 bg-base-100/50",i.textContent=c.length&&I()?"No notes match this filter.":"No saved notes yet.",r.appendChild(i),o}return o.forEach(i=>{let u=document.createElement("li");u.className="note-item-mobile w-full";let A=document.createElement("div");A.className="flex items-center gap-2";let S=document.createElement("button");S.type="button",S.dataset.noteId=i.id,S.dataset.role="open-note",S.className="note-card group flex-1 text-left rounded-2xl border border-base-200/70 bg-base-100 px-4 py-3 flex flex-col gap-1 shadow-sm transition-all duration-200 active:scale-[0.99] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30";let C=document.createElement("div");C.className="flex items-center justify-between gap-2";let M=document.createElement("span");M.className="text-sm font-semibold truncate text-base-content",M.textContent=i.title||"Untitled note",C.appendChild(M);let q=f(i.updatedAt||i.createdAt);if(q){let j=document.createElement("span");j.className="text-[0.7rem] text-base-content/50 whitespace-nowrap font-medium",j.textContent=q,C.appendChild(j)}let W=document.createElement("p");W.className="text-xs text-base-content/70 line-clamp-2 leading-snug";let se=typeof i.body=="string"?i.body.replace(/\s+/g," ").trim():"";W.textContent=se||"No body text yet.",S.appendChild(C),S.appendChild(W);let P=document.createElement("button");P.type="button",P.dataset.noteId=i.id,P.dataset.role="delete-note",P.className="btn btn-ghost btn-circle btn-sm shrink-0 text-error/70 hover:text-error focus-visible:outline-none focus-visible:ring focus-visible:ring-error/30",P.setAttribute("aria-label","Delete note"),P.textContent="\u2715",A.appendChild(S),A.appendChild(P),u.appendChild(A),r.appendChild(u)}),t(),o};r&&r.addEventListener("click",o=>{let i=o.target;if(!(i instanceof HTMLElement))return;let u=i.closest('button[data-role="delete-note"]');if(u&&r.contains(u)){o.preventDefault();let S=u.getAttribute("data-note-id");if(!S)return;let C=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(C?C("Delete this note? This cannot be undone."):!0)&&Z(S);return}let A=i.closest('button[data-role="open-note"]');if(A&&r.contains(A)){o.preventDefault();let S=A.getAttribute("data-note-id");if(!S)return;let C=c.find(M=>M.id===S);C&&(U(C),t(),_()&&D())}});let ie=()=>{R(B())};if(h){let o=k(()=>{N=typeof h.value=="string"?h.value:"",ie()},180);h.addEventListener("input",o),h.addEventListener("search",o)}let re=()=>{F({preserveDraft:!1})};p.addEventListener("click",()=>{let o=V(),i=Array.isArray(o)?[...o]:[],u=typeof n.value=="string"?n.value.trim():"",A=typeof e.value=="string"?e.value:"",S=u||"Untitled note",C=new Date().toISOString();if(T){let M=i.findIndex(q=>q.id===T);if(M>=0)i[M]={...i[M],title:S,body:A,updatedAt:C};else{let q=K(S,A,{updatedAt:C});T=q.id,i.unshift(q)}}else{let M=K(S,A);T=M.id,i.unshift(M)}Y(i),m(),F({preserveDraft:!1})}),y&&y.addEventListener("click",()=>{U(null),t(),typeof n.focus=="function"&&n.focus()}),re(),typeof window<"u"&&(window.addEventListener("storage",o=>{o.key===z&&(g=o.newValue??null,F({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let o=b();o!==g&&(g=o,F({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",oe,{once:!0}):oe();var Q=ne(),J=ee({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:n=>{Q?.handleSessionChange(n)}});if(J?.supabase){Q?.setSupabaseClient(J.supabase);try{J.supabase.auth.getSession().then(({data:n})=>{Q?.handleSessionChange(n?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let n=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let a='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',p=n,y=d=>{if(!(d instanceof HTMLElement)||d.getAttribute("aria-hidden")==="true"||d.hasAttribute("disabled")||d.tabIndex<0)return!1;let k=d.getBoundingClientRect();return k.width>0||k.height>0},r=()=>Array.from(e.querySelectorAll(a)).filter(y),l=()=>{let d=e.classList.contains("hidden");e.setAttribute("aria-hidden",d?"true":"false")};l();let h=d=>{!e.contains(d.target)&&d.target!==n&&w({restoreFocus:!1})},v=()=>{let[d]=r();if(d instanceof HTMLElement)try{d.focus()}catch{}},H=()=>{e.classList.contains("hidden")&&(p=document.activeElement instanceof HTMLElement?document.activeElement:n,e.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),l(),document.addEventListener("focusin",h),!e.contains(document.activeElement)&&v())},w=({restoreFocus:d=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),n.setAttribute("aria-expanded","false"),l(),document.removeEventListener("focusin",h),d&&p instanceof HTMLElement))try{p.focus()}catch{}};n.addEventListener("click",d=>{d.stopPropagation(),e.classList.contains("hidden")?H():w()}),document.addEventListener("click",d=>{d.target===n||e.contains(d.target)||w({restoreFocus:!1})}),document.addEventListener("keydown",d=>{if(d.key==="Escape"){w();return}d.key==="ArrowDown"&&!e.classList.contains("hidden")&&(d.preventDefault(),v())}),e.addEventListener("click",d=>{d.stopPropagation(),d.target instanceof HTMLElement&&d.target.closest("button")&&w({restoreFocus:!1})}),e.addEventListener("keydown",d=>{if(d.key!=="Tab")return;let k=r();if(!k.length)return;let T=k.indexOf(document.activeElement),c=k.length-1,N=T;d.shiftKey?N=T<=0?c:T-1:N=T===c?0:T+1,d.preventDefault();let x=k[N]||k[0];if(x instanceof HTMLElement)try{x.focus()}catch{}})})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let e=()=>{let y=document.getElementById("voiceBtn");return y instanceof HTMLElement?y:null},a=()=>{let y=e();if(!y)return;let r=()=>{y.hasAttribute("disabled")||y.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let h=y.getAttribute("title");h&&n.setAttribute("title",h)};r(),typeof MutationObserver=="function"&&new MutationObserver(r).observe(y,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a,{once:!0}):a();let p=()=>{let y=e();if(y&&!(y.hasAttribute("disabled")||y.getAttribute("aria-disabled")==="true")){try{y.focus({preventScroll:!0})}catch{try{y.focus()}catch{}}try{y.click()}catch(r){console.warn("Voice add trigger failed",r)}}};n.addEventListener("click",y=>{y.preventDefault();let r=!1,l=null,h=()=>{r||(r=!0,document.removeEventListener("reminder:sheet-opened",v),p())},v=w=>{if(w?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&l&&(window.clearTimeout(l),l=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(h,150)};document.addEventListener("reminder:sheet-opened",v);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(w){document.removeEventListener("reminder:sheet-opened",v),typeof window<"u"&&typeof window.clearTimeout=="function"&&l&&(window.clearTimeout(l),l=null),console.warn("Voice add open failed",w);return}let H=document.getElementById("create-sheet");H instanceof HTMLElement&&H.classList.contains("open")&&(l=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(h,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let a=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],p=()=>{let r=e.hasAttribute("open");n.setAttribute("aria-expanded",String(r)),n.classList.toggle("btn-active",r)},y=()=>{for(let r of a){let l=e.querySelector(r);if(l instanceof HTMLElement&&!l.hasAttribute("disabled")){try{l.focus({preventScroll:!0})}catch{l.focus()}return}}};n.addEventListener("click",()=>{let r=e.hasAttribute("open");e.open=!r,r||y(),p()}),e.addEventListener("toggle",p),p()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function e(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let e=document.getElementById("totalCount");if(!e)return;let a=Array.isArray(n?.detail?.items)?n.detail.items.length:0;e.textContent=String(a)});document.addEventListener("click",n=>{try{let e=n.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let a=document.createElement("div");a.textContent="Save clicked",a.style.position="fixed",a.style.right="16px",a.style.bottom="16px",a.style.background="rgba(34,197,94,0.95)",a.style.color="#fff",a.style.padding="8px 12px",a.style.borderRadius="8px",a.style.zIndex="99999",document.body.appendChild(a),setTimeout(()=>a.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let e=Array.from(n.children);if(e.length<=30)return;let a=20;n.innerHTML="";let p=0;function y(){let h=e.slice(p,p+a);h.forEach(v=>n.appendChild(v)),p+=h.length}y();let r=document.createElement("div");r.id="listSentinel",n.appendChild(r);let l=new IntersectionObserver(h=>{h.some(v=>v.isIntersecting)&&p<e.length&&(y(),p>=e.length&&l.disconnect())});l.observe(r)})();(function(){let n=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(r=>r instanceof HTMLElement),e=document.getElementById("settingsModal"),a=document.getElementById("closeSettings");if(!n.length||!e||!a)return;function p(){e.classList.remove("hidden")}function y(){e.classList.add("hidden")}n.forEach(r=>{r.addEventListener("click",p)}),a.addEventListener("click",y),e.addEventListener("click",r=>{r.target instanceof HTMLElement&&r.target.matches("[data-close]")&&y()}),e.addEventListener("keydown",r=>{r.key==="Escape"&&y()})})();(function(){let n=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),a=document.getElementById("mcStatusText"),p=document.getElementById("syncUrl"),y=document.getElementById("saveSyncSettings"),r=document.getElementById("testSync"),l=document.getElementById("syncAll"),h="syncUrl";if(!a)return;let v=["online","offline","error"],H=["online","offline"],w={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},d={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},k=null;function T(t){if(!e)return;H.forEach(E=>e.classList.remove(E));let f=t!=="offline"&&t!=="error";e.classList.add(f?"online":"offline"),e.setAttribute("aria-label",f?"Online":"Offline")}function c(t,f){k=t,v.forEach(g=>a.classList.remove(g)),n&&v.forEach(g=>n.classList.remove(g)),t==="online"?(a.classList.add("online"),n&&n.classList.add("online")):t==="error"?(a.classList.add("error"),n&&n.classList.add("error")):(a.classList.add("offline"),n&&n.classList.add("offline"));let E=typeof f=="string"&&f.trim()?f.trim():w[t]||"",L=typeof f=="string"&&f.trim()?f.trim():d[t]||E,b=E||L||"";a.textContent=b,b?(a.setAttribute("title",b),a.setAttribute("aria-label",b)):(a.removeAttribute("title"),a.removeAttribute("aria-label")),T(t),a.dataset.state=t}function N(){k!=="syncing"&&c(navigator.onLine?"online":"offline")}function x(t){typeof localStorage>"u"||(t?localStorage.setItem(h,t):localStorage.removeItem(h))}function O(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(h)||""}catch{return""}}function _(t){if(!t||typeof t!="object")return null;let f=t.id||t.uid||t.key||t.slug||t.uuid,E=typeof t.title=="string"&&t.title.trim()?t.title.trim():typeof t.name=="string"?t.name.trim():"";if(!E)return null;let L=typeof t.dueIso=="string"&&t.dueIso?t.dueIso:typeof t.due=="string"?t.due:null,b=typeof t.priority=="string"&&t.priority.trim()?t.priority.trim():t.level||t.importance||"Medium",g=typeof t.category=="string"&&t.category.trim()?t.category.trim():t.group||t.bucket||"General",m=typeof t.done=="boolean"?t.done:!!(t.completed||t.isDone||t.status==="done");return{id:f||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:E,dueIso:L&&L.trim()?L.trim():null,priority:b,category:g,done:m}}function $(){let t=Array.from(document.querySelectorAll("[data-reminder]"));return t.length?t.map(f=>{let E=f.dataset||{},L=null;if(E.reminder)try{L=JSON.parse(E.reminder)}catch{L=null}let b=L||{id:E.id||E.reminderId||f.getAttribute("data-id")||null,title:E.title||E.reminderTitle||"",dueIso:E.due||E.reminderDue||f.getAttribute("data-due")||null,priority:E.priority||E.reminderPriority||f.getAttribute("data-priority")||"",category:E.category||E.reminderCategory||f.getAttribute("data-category")||"",done:E.done==="true"||E.reminderDone==="true"||f.getAttribute("data-done")==="true"};if(!b.title){let g=f.querySelector("[data-reminder-title], [data-title], h3, h4, strong");g&&(b.title=g.textContent.trim())}if(!b.dueIso){let g=f.querySelector("[data-due], time");if(g){let m=g.getAttribute("datetime")||g.getAttribute("data-due");b.dueIso=m||g.textContent.trim()}}return _(b)}).filter(Boolean):[]}function D(){if(typeof localStorage>"u")return[];let t=[],f=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(L=>{if(!f.has(L)){f.add(L);try{let b=localStorage.getItem(L);if(!b)return;let g=JSON.parse(b);Array.isArray(g)?g.forEach(m=>t.push(m)):g&&typeof g=="object"&&(Array.isArray(g.items)&&g.items.forEach(m=>t.push(m)),Array.isArray(g.reminders)&&g.reminders.forEach(m=>t.push(m)))}catch{}}}),!t.length)for(let L=0;L<localStorage.length;L+=1){let b=localStorage.key(L);if(!(!b||f.has(b)||!/remind/i.test(b))){f.add(b);try{let g=localStorage.getItem(b);if(!g)continue;let m=JSON.parse(g);Array.isArray(m)?m.forEach(F=>t.push(F)):m&&typeof m=="object"&&(Array.isArray(m.items)&&m.items.forEach(F=>t.push(F)),Array.isArray(m.reminders)&&m.reminders.forEach(F=>t.push(F)))}catch{}}}return t.map(_).filter(Boolean)}function s(){let t=$();return t.length?t:D()}function I(t){t?(l?.setAttribute("aria-busy","true"),l?.setAttribute("disabled","disabled"),r?.setAttribute("aria-busy","true"),r?.setAttribute("disabled","disabled")):(l?.removeAttribute("aria-busy"),r?.removeAttribute("aria-busy"),B())}function B(){!!((p?.value||"").trim()||O())?(l?.removeAttribute("disabled"),r?.removeAttribute("disabled")):(l?.setAttribute("disabled","disabled"),r?.setAttribute("disabled","disabled"))}let U=O();p&&U&&(p.value=U),B(),c(navigator.onLine?"online":"offline"),window.addEventListener("online",N),window.addEventListener("offline",N),p?.addEventListener("input",B),y?.addEventListener("click",()=>{let t=(p?.value||"").trim();if(!t){x(""),c("info","Sync URL cleared. Add one to enable sync."),B();return}try{let f=new URL(t);if(!/^https?:/.test(f.protocol))throw new Error("Invalid protocol")}catch{c("error","Enter a valid sync URL before saving.");return}x(t),c("online","Sync settings saved."),B()}),r?.addEventListener("click",async()=>{let t=(p?.value||O()).trim();if(!t){c("error","Add your sync URL in Settings first.");return}I(!0),c("syncing","Testing connection\u2026");try{(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?c("online","Connection looks good."):c("error","Test failed. Check your Apps Script deployment.")}catch(f){console.error("Test sync failed",f),c("error","Test failed. Check your Apps Script deployment.")}finally{I(!1)}}),l?.addEventListener("click",async()=>{let t=(p?.value||O()).trim();if(!t){c("error","Add your sync URL in Settings first.");return}let f=s();if(!f.length){c("info","Nothing to sync right now.");return}I(!0),c("syncing",`Syncing ${f.length} reminder${f.length===1?"":"s"}\u2026`);let E=20,L=0,b=0,g=m=>({id:m.id,title:m.title,dueIso:m.dueIso||null,priority:m.priority||"Medium",category:m.category||"General",done:!!m.done,source:"memory-cue-mobile"});try{for(let m=0;m<f.length;m+=E){let F=f.slice(m,m+E);(await Promise.allSettled(F.map(R=>fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g(R))})))).forEach(R=>{R.status==="fulfilled"&&R.value?.ok?L+=1:(R.status,b+=1)}),await new Promise(R=>setTimeout(R,300))}b?L?c("error",`Partial sync: ${L} success, ${b} failed.`):c("error","Sync failed. Check your sync URL and retry."):c("online",`Sync complete. ${L} updated.`)}catch(m){console.error("Sync failed",m),c("error","Sync failed. Try again soon.")}finally{I(!1)}})})()});export default me();
