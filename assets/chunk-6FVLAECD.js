import{b as nt,c as Ni}from"./chunk-CTK42JWW.js";import{a as Di,b as an,c as bo}from"./chunk-GUVSRPRW.js";function Ri(i={}){try{Object.assign(j,i||{})}catch(o){console.warn("[supabase-auth] setAuthContext failed",o)}}async function Fi(i={}){try{if(j&&typeof j.signInWithPopup=="function"&&j.auth&&typeof j.GoogleAuthProvider=="function")return j.signInWithPopup(j.auth,new j.GoogleAuthProvider);if(j&&typeof j.signInWithRedirect=="function"&&j.auth&&typeof j.GoogleAuthProvider=="function")return j.signInWithRedirect(j.auth,new j.GoogleAuthProvider);let o=nt();if(o&&o.auth){if(typeof o.auth.signInWithOAuth=="function")return o.auth.signInWithOAuth({provider:"google",...i});if(typeof o.auth.signIn=="function")return o.auth.signIn({provider:"google"})}}catch(o){console.error("[supabase-auth] startSignInFlow error",o);try{j?.toast?.("Sign-in failed")}catch(s){console.warn("[supabase-auth] toast handler failed",s)}throw o}return Promise.resolve(null)}async function Bi(){try{if(j&&typeof j.signOut=="function")return j.signOut(j.auth);let i=nt();if(i&&i.auth&&typeof i.auth.signOut=="function")return i.auth.signOut()}catch(i){throw console.error("[supabase-auth] startSignOutFlow error",i),i}return Promise.resolve(null)}function So(i){return i?Array.isArray(i)?i:[i]:[]}function Lt(i){return Array.from(new Set(i.filter(o=>o instanceof HTMLElement||typeof SVGElement<"u"&&o instanceof SVGElement)))}function pe(i,o){let s=So(o).filter(Boolean);if(!s.length)return[];let l=s.flatMap(S=>Array.from(i.querySelectorAll(S)));return Lt(l)}function vo(i,o=document){let s=o instanceof Document||o instanceof HTMLElement?o:document;return{authForms:pe(s,i.authForm),emailInputs:pe(s,i.emailInput),signInButtons:pe(s,i.signInButtons),signOutButtons:pe(s,i.signOutButtons),userBadges:pe(s,i.userBadge),userBadgeEmails:pe(s,i.userBadgeEmail),userBadgeInitials:pe(s,i.userBadgeInitial),userNameEls:pe(s,i.userName),syncStatusEls:pe(s,i.syncStatus),syncStatusTextEls:pe(s,i.syncStatusText),statusIndicatorEls:pe(s,i.statusIndicator),feedbackEls:pe(s,i.feedback)}}function At(i,o){Lt(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.classList.toggle("hidden",!o),o?s.removeAttribute("hidden"):s.setAttribute("hidden",""))})}function _e(i,o){Lt(Array.isArray(i)?i:[i]).forEach(s=>{s instanceof HTMLElement&&(s.textContent=o||"")})}function Eo(i,o){Lt(i).forEach(s=>{s instanceof HTMLElement&&(s.dataset.state=o,s.classList.toggle("online",o==="online"),s.classList.toggle("offline",o!=="online"))})}function It(i,o){Lt(i).forEach(s=>{if(!(s instanceof HTMLElement))return;s.textContent=o||"";let l=!!o;s.classList.toggle("hidden",!l),l?s.removeAttribute("hidden"):s.setAttribute("hidden","")})}function Oi(i={}){let o={...ki.syncStatusText,...i.syncStatusText||{}};return{...ki,...i,syncStatusText:o}}function Tt(i,{user:o,messages:s}={}){let l=Oi(s),S=!!o;At(i.signInButtons,!S),At(i.authForms,!S),At(i.signOutButtons,S),At(i.userBadges,S);let T=typeof o?.email=="string"?o.email:"",I=T?T.charAt(0).toUpperCase():"U";S?(_e(i.userBadgeEmails,T),_e(i.userBadgeInitials,I),_e(i.userNameEls,T)):(_e(i.userBadgeEmails,""),_e(i.userBadgeInitials,""),_e(i.userNameEls,""));let G=typeof l.signedIn=="function"?l.signedIn(o):l.signedIn,L=typeof l.signedOut=="function"?l.signedOut(o):l.signedOut,X=S?G:L,ne=!S;i.syncStatusEls.length&&(_e(i.syncStatusEls,X),i.syncStatusEls.forEach(le=>{le instanceof HTMLElement&&(le.classList.toggle("online",S),le.dataset.state=S?"online":"offline")}),At(i.syncStatusEls,ne));let E=S?l.syncStatusText?.signedIn:l.syncStatusText?.signedOut;_e(i.syncStatusTextEls,E||""),Eo(i.statusIndicatorEls,S?"online":"offline"),It(i.feedbackEls,"")}function Ao(i,o){o.authForms.forEach(s=>{!(s instanceof HTMLFormElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("submit",async l=>{l.preventDefault();let S=o.emailInputs.find(I=>s.contains(I))||s.querySelector('input[type="email"]'),T=typeof S?.value=="string"?S.value.trim():"";if(!T){It(o.feedbackEls,"Enter an email address to continue.");return}try{let{error:I}=await i.auth.signInWithOtp({email:T});I?It(o.feedbackEls,I.message||"Unable to send magic link."):It(o.feedbackEls,"Magic link sent. Check your email.")}catch(I){It(o.feedbackEls,I?.message||"Unable to send magic link.")}}))})}function To(i,o){o.signOutButtons.forEach(s=>{!(s instanceof HTMLElement)||s.dataset.supabaseAuthBound==="true"||(s.dataset.supabaseAuthBound="true",s.addEventListener("click",async()=>{try{await i.auth.signOut()}catch(l){console.error("[supabase] Sign-out failed.",l)}}))})}function Vo(i={}){let{supabase:o,scope:s=document,selectors:l={},messages:S={},disableButtonBinding:T=!1,onSessionChange:I}=i,G={...wo,...l},L=vo(G,s),X=Oi(S);Tt(L,{user:null,messages:X});let ne=o||nt()||(typeof window<"u"?window.supabase:null);if(!ne)return{supabase:null,elements:L,applyAuthState:oe=>Tt(L,{...oe,messages:X}),destroy(){}};Ao(ne,L),T||To(ne,L);let E=[],{data:le}=ne.auth.onAuthStateChange((oe,_)=>{if(Tt(L,{user:_?.user??null,messages:X}),typeof I=="function")try{I(_?.user??null,_)}catch(K){console.error("[supabase] onSessionChange handler failed.",K)}});return le?.subscription&&E.push(()=>{try{le.subscription.unsubscribe()}catch{}}),ne.auth.getSession().then(({data:oe,error:_})=>{_||Tt(L,{user:oe?.session?.user??null,messages:X})}).catch(oe=>{console.error("[supabase] getSession failed.",oe)}),{supabase:ne,elements:L,applyAuthState:oe=>Tt(L,{...oe,messages:X}),destroy(){E.forEach(oe=>{try{oe()}catch{}})}}}var j,wo,ki,Mi=an(()=>{Ni();j={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};wo={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},ki={signedOut:"",signedIn:i=>`Reminders syncing for ${i?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var $i=bo((zo,Ct)=>{var sn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function _i(i){if(!i||typeof i!="object")return null;let o=Object.entries(i).filter(([s,l])=>typeof l=="string"&&l.trim()!=="");return o.length?Object.fromEntries(o):null}function Io(){let i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},o=_i(i?.__FIREBASE_CONFIG);if(o)return o;let s=_i(i?.__ENV?.FIREBASE_CONFIG);if(s)return s;let S=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((T,[I,G])=>{let L=i?.__ENV?.[I]??i?.[I];return typeof L=="string"&&L.trim()!==""&&(T[G]=L),T},{});return Object.keys(S).length?S:null}function Ui(){let i=Io();return i?{...sn,...i}:{...sn}}var Pi={DEFAULT_FIREBASE_CONFIG:sn,getFirebaseConfig:Ui};if(typeof globalThis<"u"){let i=globalThis;i.memoryCueFirebase=i.memoryCueFirebase||{},i.memoryCueFirebase.getFirebaseConfig=Ui,i.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=sn}typeof Ct<"u"&&Ct.exports&&(Ct.exports=Pi,Ct.exports.default=Pi)});function xo(){if(Le)return{...Le};let o=Kn()?.memoryCueFirebase;if(o&&typeof o.getFirebaseConfig=="function")return Le=o.getFirebaseConfig(),{...Le};if(typeof Di=="function")try{let s=$i();if(s){let l=typeof s.getFirebaseConfig=="function"?s.getFirebaseConfig:typeof s.default?.getFirebaseConfig=="function"?s.default.getFirebaseConfig:null;if(l)return Le=l(),{...Le}}}catch{}return o&&o.DEFAULT_FIREBASE_CONFIG?(Le={...o.DEFAULT_FIREBASE_CONFIG},{...Le}):(Le={...Co},{...Le})}function Kn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Gi(){let i=Kn(),o=i&&i.TimestampTrigger;return typeof o=="function"?o:null}function Fe(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Gi()}function Do(){if(typeof window>"u"||!window.location)return Yn;try{return new URL(Yn,window.location.href).href}catch{return Yn}}async function Pe(){return dn||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(dn=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Do()),await navigator.serviceWorker.ready}catch(i){return console.warn("Service worker registration failed",i),null}})(),dn))}async function Yi(i){if(!i||typeof i!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let o=await Pe();if(!o)return!1;let s=new Set;navigator.serviceWorker.controller&&s.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(S=>{let T=o[S];T&&s.add(T)});let l=!1;return s.forEach(S=>{try{S.postMessage(i),l=!0}catch(T){console.warn("Failed posting message to service worker",T)}}),l}catch(o){return console.warn("Unable to reach service worker",o),!1}}async function cn(){if(Fe())return!1;if(Vn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(xt)try{return await xt}catch{}xt=(async()=>{let i=await Pe();if(!i)return!1;let o=!1;if("periodicSync"in i)try{let s=await i.periodicSync.getTags();(!Array.isArray(s)||!s.includes(Gn))&&await i.periodicSync.register(Gn,{minInterval:15*60*1e3}),o=!0}catch(s){console.warn("Periodic background sync unavailable",s)}if(!o&&"sync"in i)try{await i.sync.register(Gn),o=!0}catch(s){console.warn("Background sync unavailable",s)}return o})();try{let i=await xt;return i&&(Vn=!0),i}catch(i){return console.warn("Background reminder sync setup failed",i),Vn=!1,!1}finally{xt=null}}async function zn(i=[],{requestCheck:o=!1}={}){if(!Fe()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let s=await Pe();if(!s)return;let l=await Yi({type:Wi.updateScheduledReminders,reminders:Array.isArray(i)?i:[]});if(o&&await Yi({type:Wi.checkScheduledReminders}),!l&&typeof s.update=="function")try{await s.update()}catch{}}catch(s){console.warn("Failed syncing reminders with service worker",s)}}async function Xn(i,o){if(Fe())try{let s=o||await Pe();if(!s)return;let l=[];try{l=await s.getNotifications({tag:i,includeTriggered:!0})}catch{l=await s.getNotifications({tag:i})}for(let S of l)try{S.close()}catch{}}catch{}}function Vi(){for(let i of Array.from(Re.values()))try{i.close()}catch{}Re.clear()}function No(){if(ji||typeof window>"u"||typeof window.addEventListener!="function")return;let i=()=>Vi();["pagehide","beforeunload"].forEach(o=>{try{window.addEventListener(o,i)}catch{}}),ji=!0}function Q(i){if(typeof i=="string"){let o=i.replace(/\s+/g," ").trim();if(o)return o}return z}async function Ko(i={}){let o=e=>e?document.querySelector(e):null,s=e=>e?Array.from(document.querySelectorAll(e)):[],l=o(i.titleSel),S=o(i.dateSel),T=o(i.timeSel),I=o(i.detailsSel),G=o(i.prioritySel),L=o(i.categorySel),X=o(i.saveBtnSel),ne=o(i.cancelEditBtnSel),E=o(i.listSel),le="reminder-title-pinned",oe="reminder-title-unpinned",_=o(i.detailPanelSel),K=o(i.detailEmptySel),Ue=o(i.detailContentSel),me=o(i.detailTitleSel),be=o(i.detailDueSel),ye=o(i.detailPrioritySel),F=o(i.detailCategorySel),ge=o(i.detailNotesSel),Ce=ge?.dataset?.placeholder||"No notes added yet.",er=o(i.detailClearSel),Dt=s(i.googleSignInBtnSel),Nt=s(i.googleSignOutBtnSel),U=o(i.statusSel),V=o(i.syncStatusSel),tr={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},nr=6e3,ue=null,kt=null;function qe(e,{clearMessage:t=!0}={}){ue&&(e&&ue.tokenId!==e||(ue.timeoutId&&clearTimeout(ue.timeoutId),t&&U&&U.dataset.undoToken===ue.tokenId&&(typeof U.replaceChildren=="function"?U.replaceChildren():U.textContent="",delete U.dataset.undoToken,delete U.dataset.statusKind),ue=null))}function ir(e){if(!U)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),r=document.createElement("button");r.type="button",r.textContent="Undo",r.className="status-undo",r.addEventListener("click",()=>co(e.tokenId)),e.button=r,typeof U.replaceChildren=="function"?U.replaceChildren(t,n,r):(U.textContent="",U.append(t,n,r)),U.dataset.statusKind="undo",U.dataset.undoToken=e.tokenId}function it(e){if(!_)return;let t=!!e;if(_.dataset.state=t?"active":"empty",_.dataset.selectedId=t&&e?.id?e.id:"",K&&(K.classList.toggle("hidden",t),K.setAttribute("aria-hidden",t?"true":"false")),Ue&&(Ue.classList.toggle("hidden",!t),Ue.setAttribute("aria-hidden",t?"false":"true")),!t){me&&(me.textContent=""),be&&(be.textContent=""),ye&&(ye.textContent=""),F&&(F.textContent=""),ge&&(ge.textContent=Ce,ge.dataset.empty="true");return}if(me&&(me.textContent=e.title||"Untitled reminder"),be&&(be.textContent=vi(e)),ye&&(ye.textContent=e.priority||"Medium"),F&&(F.textContent=e.category||z),ge){let n=typeof e.notes=="string"?e.notes.trim():"";n?(ge.textContent=n,ge.dataset.empty="false"):(ge.textContent=Ce,ge.dataset.empty="true")}}function Qn(){kt=null,it(null)}function rr(e){kt=e?.id||null,it(e||null)}function or(){if(!_)return;if(!kt){it(null);return}let e=f.find(t=>t?.id===kt);if(e){it(e);return}Qn()}it(null);function gn(e,t){if(!V)return;let n=["online","offline","error"];n.forEach(d=>V.classList.remove(d)),n.includes(e)&&V.classList.add(e),V.dataset.state=e;let r=typeof t=="string"?t:tr[e]||"";e==="online"||e==="offline"?(V.textContent="",V.dataset.compact="true",r?(V.setAttribute("aria-label",r),V.setAttribute("title",r)):(V.removeAttribute("aria-label"),V.removeAttribute("title"))):(V.textContent=r,V.removeAttribute("data-compact"),r?(V.setAttribute("aria-label",r),V.setAttribute("title",r)):(V.removeAttribute("aria-label"),V.removeAttribute("title")))}let ie=o(i.notesSel),ar=o(i.saveNotesBtnSel),sr=o(i.loadNotesBtnSel),Zn=o(i.countTotalSel),Rt=o(i.googleUserNameSel),$e=o(i.dateFeedbackSel),ae=o(i.voiceBtnSel),dr=o(i.notifBtnSel),rt=o(i.moreBtnSel),ot=o(i.moreMenuSel),cr=o(i.copyMtlBtnSel),hn=o(i.importFileSel),lr=o(i.exportBtnSel),ur=o(i.syncAllBtnSel),ze=o(i.syncUrlInputSel),fr=o(i.saveSettingsSel),pr=o(i.testSyncSel),mr=s(i.openSettingsSel),Ft=o(i.settingsSectionSel),Xe=o(i.emptyStateSel),ei=o(i.listWrapperSel),bn=o(i.categoryOptionsSel),re=o(i.plannerContextSel),W=o(i.plannerLessonInputSel),se=i.variant||"mobile",yr=typeof i.autoWireAuthButtons=="boolean"?i.autoWireAuthButtons:se!=="desktop",at="all",wn=[],Sn="";function gr(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function Ke(){if(se!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=gr(),n;at==="today"?n=`Today\u2019s reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,Sn&&(n+=` \u2022 ${Sn}`),e.textContent=n}function hr(){se==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,r=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(r).then(a=>{if(!a.ok)throw new Error("Weather request failed");return a.json()}).then(a=>{a&&a.current_weather&&typeof a.current_weather.temperature=="number"&&(Sn=`${Math.round(a.current_weather.temperature)}\xB0C`,Ke())}).catch(a=>{console.warn("Failed to fetch current temperature",a)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let ti="mc:lastDefaults",vn=()=>{re&&(re.classList.add("hidden"),re.setAttribute("aria-hidden","true"),typeof re.replaceChildren=="function"?re.replaceChildren():re.textContent=""),W&&(W.value="",W.dataset&&(delete W.dataset.lessonDayLabel,delete W.dataset.lessonTitle,delete W.dataset.lessonSummary))},br=(e={})=>{if(!re)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",r=typeof e.summary=="string"?e.summary.trim():"",a=document.createElement("p");a.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",a.textContent=t?`${t} lesson`:"Planner lesson";let d=document.createElement("p");d.className="text-sm font-semibold text-base-content",d.textContent=n||r||"Planner reminder";let c=r?document.createElement("p"):null;c&&(c.className="text-sm text-base-content/70",c.textContent=r),typeof re.replaceChildren=="function"?re.replaceChildren(...[a,d,c].filter(Boolean)):(re.textContent="",re.append(a,d),c&&re.append(c)),re.classList.remove("hidden"),re.removeAttribute("aria-hidden")},wr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";l&&typeof e.reminderTitle=="string"&&(l.value=e.reminderTitle),I&&typeof e.reminderNotes=="string"&&(I.value=e.reminderNotes),S&&typeof e.dueDate=="string"&&(S.value=e.dueDate),W&&(W.value=t,W.dataset&&(W.dataset.lessonDayLabel=dayLabel,W.dataset.lessonTitle=lessonTitle,W.dataset.lessonSummary=summary)),br(e)};function En(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(ti)||"{}")||{}}catch{return{}}}function Sr(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(ti,JSON.stringify(e))}catch{}}function ni(e){let t=En(),n={category:Q(e?.category||t.category||z),priority:e?.priority||t.priority||"Medium"};Sr(n)}let ii='fieldset#priorityChips input[name="priority"]';function An(){try{let e=document.querySelector(`${ii}:checked`);if(e&&e.value)return e.value}catch{}return G&&typeof G.value=="string"&&G.value?G.value:"Medium"}function Bt(e){let t=e||"Medium";G&&typeof G.value<"u"&&(G.value=t);try{let n=Array.from(document.querySelectorAll(ii));if(!n.length)return;let r=!1;if(n.forEach(a=>{let d=a.value===t;a.checked=d,r=r||d}),!r){let a=n.find(d=>d.value==="Medium")||n[0];a&&(a.checked=!0)}}catch{}}function ri(){let e=En();e.category&&L&&(L.value=e.category),e.priority&&Bt(e.priority)}ri();let Z=typeof document<"u"?document.getElementById("quickAddInput"):null,vr=typeof document<"u"?document.getElementById("quickAddSubmit"):null,de=typeof document<"u"?document.getElementById("quickAddVoice"):null,He=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,Tn=null;function Er(e,t){let n=Date.now(),r=En(),a=typeof t=="string"&&t?t:null;return{id:Qt(),title:(e||"").trim(),priority:r.priority||An(),category:Q(r.category||L?.value||z),notes:"",done:!1,createdAt:n,updatedAt:n,due:a,pendingSync:!ee,pinToToday:!1}}async function Ot(e={}){if(!Z)return null;if(typeof Tn=="function")try{Tn()}catch{}let n=((typeof e.text=="string"?e.text:(Z.value||"").trim())||"").trim();if(!n)return null;let a=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,d=null;if(a)d=new Date(a).toISOString();else try{let m=tn(n);m&&m.time&&(d=new Date(`${m.date}T${m.time}:00`).toISOString())}catch{d=null}let c=Er(n,d);if(e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{c.notifyAt=new Date(e.notifyAt).toISOString()}catch{c.notifyAt=null}Nn(c,{position:"start"}),f.unshift(c),fe(f);let u=mt(f);je=!0,H(),J(),u?f.forEach(m=>te(m)):te(c),gt(c),Ve(c),Me(),ni(c),Je();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:f}}))}catch{}if(Se({action:"created",label:`Reminder added \xB7 ${c.title}`}),Z.value="",typeof document<"u")try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:c}}))}catch{}return c}typeof window<"u"&&(window.memoryCueQuickAddNow=Ot),vr?.addEventListener("click",()=>{Ot()}),Z?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Ot())});function Ar(){if(typeof HTMLElement>"u"||!(de instanceof HTMLElement)||!(Z instanceof HTMLInputElement)||de.dataset.voiceBound==="true")return;if(de.dataset.voiceBound="true",typeof window>"u"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){de.setAttribute("disabled","true"),de.setAttribute("aria-disabled","true"),de.getAttribute("title")||(de.title="Voice input is not supported in this browser.");return}let t=null,n=!1,r=c=>{n=c,de.setAttribute("aria-pressed",c?"true":"false"),de.dataset.listening=c?"true":"false",de.classList.toggle("is-listening",c)},a=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",m=>{let p=m?.results?.[0]?.[0]?.transcript?.trim()||"";if(p){Z.value=p;try{Z.focus({preventScroll:!0})}catch{Z.focus()}try{let b=Z.value.length;typeof Z.setSelectionRange=="function"&&Z.setSelectionRange(b,b)}catch{}}});let u=()=>{r(!1)};return t.addEventListener("end",u),t.addEventListener("error",u),t},d=()=>{if(!(!n||!t)){try{t.stop()}catch{}r(!1)}};Tn=d,de.addEventListener("click",()=>{let c=a();if(c){if(n){d();return}try{c.start(),r(!0)}catch(u){console.warn("Quick add voice error:",u),r(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",d),r(!1)}Ar();let oi=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,xe=oi?new oi:null;xe&&(xe.lang="en-AU",xe.interimResults=!1,xe.maxAlternatives=1),He&&xe?He.addEventListener("click",()=>{try{xe.start(),He.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):He&&He.addEventListener("click",()=>{try{alert("Voice input is not supported on this browser.")}catch{console.warn("Voice input is not supported on this browser.")}}),xe&&(xe.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Lr(t)}),xe.addEventListener("end",()=>{He&&He.classList.remove("is-recording")}));function Tr(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function Ir(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase(),r=new Date,a=new Date(r);if(n.includes("tomorrow"))a.setDate(a.getDate()+1);else if(!n.includes("today"))return t;let d=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!d)return t;let c=parseInt(d[1],10),u=d[2]?parseInt(d[2],10):0,m=d[3];m==="pm"&&c<12&&(c+=12),m==="am"&&c===12&&(c=0),a.setHours(c,u,0,0);let p=new Date(a),b=new Date(p.getTime()-10*60*1e3);return t.dueDate=p,t.notifyAt=b,t}function Lr(e){if(!e||!Z)return;let t=Tr(e),{dueDate:n,notifyAt:r}=Ir(e);Z.value=t,Ot({text:t,dueDate:n,notifyAt:r})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&Z&&(e.preventDefault(),Z.focus())})));try{se==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Cr=i.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",ai=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,xr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Mt=i.reminderLandingPath||(se==="desktop"?"index.html#reminders":"mobile.html"),we=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function si(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Je(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:f}}))}catch{}}L&&!L.value&&(L.value=z),Fe()&&Pe();function Se(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let r=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),r=!0)}catch{r=!1}if(!r){if(typeof window<"u"){let a=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(a.push(n);a.length>20;)a.shift();window.memoryCueActivityQueue=a}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Hi,{detail:n}));else if(document.createEvent){let a=document.createEvent("CustomEvent");a&&a.initCustomEvent&&(a.initCustomEvent(Hi,!1,!1,n),document.dispatchEvent(a))}}catch{}}}function Dr(){if(typeof HTMLElement>"u"||!(ae instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&l instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&l instanceof HTMLTextAreaElement;if(!e&&!t||ae.dataset.voiceBound==="true")return;if(ae.dataset.voiceBound="true",typeof window>"u"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ae.setAttribute("disabled","true"),ae.setAttribute("aria-disabled","true"),ae.getAttribute("title")||(ae.title="Voice input is not supported in this browser.");return}let r=null,a=!1,d=p=>{a=p,ae.setAttribute("aria-pressed",p?"true":"false"),ae.dataset.listening=p?"true":"false",ae.classList.toggle("is-listening",p)},c=()=>{if(r)return r;r=new n,r.lang="en-US",r.interimResults=!1,r.maxAlternatives=1,r.addEventListener("result",b=>{let D=b.results?.[0]?.[0]?.transcript?.trim()||"";if(D){l.value=D;try{l.focus({preventScroll:!0})}catch{try{l.focus()}catch{}}try{let C=l.value.length;typeof l.setSelectionRange=="function"&&l.setSelectionRange(C,C)}catch{}Se({action:"dictated",label:`Voice input captured \xB7 ${D}`})}});let p=()=>{d(!1)};return r.addEventListener("end",p),r.addEventListener("error",p),r},u=()=>{if(!(!a||!r)){try{r.stop()}catch{}d(!1)}};ae.addEventListener("click",()=>{let p=c();if(p){if(a){u();return}try{p.start(),d(!0)}catch(b){console.warn("Speech recognition error:",b),d(!1)}}});let m=()=>{u()};typeof document<"u"&&(document.addEventListener("cue:close",m),document.addEventListener("reminders:updated",m)),d(!1)}No(),Dr();let _t,Pt,Ut,$t,Qe,Ht,jt,Wt,Yt,Gt,Vt,st,dt,qt,zt,In,Ln,Xt,Cn,di=i.firebaseDeps,xn=typeof i.importModule=="function"?i.importModule:e=>import(e),ct=Kn(),lt=!1,ve=!1,Dn=null,De=null,ut=null,f=[],je=!1,ee=null,ft=null,Ze=null,We={},Ye={},q={};function fe(e=f){Array.isArray(e)&&e.sort((t,n)=>{let r=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,a=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return r===a?mi(t||{},n||{}):a-r})}function Nr(e=f){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(r=>{let a=Number.isFinite(r?.orderIndex)?r.orderIndex:null;a!=null&&(a<t&&(t=a),a>n&&(n=a))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function pt(e=f){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(r=>Number.isFinite(r?.orderIndex)),n;if(t)n=e.slice(),fe(n);else{n=e.slice().sort(mi);let r=n.length;n.forEach((a,d)=>{a.orderIndex=(r-d)*Ie})}return e===f&&(f=n),n}function Nn(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:r}=Nr();if(t==="end"){let a=Number.isFinite(n)?n:0;e.orderIndex=a-Ie||Ie}else{let a=Number.isFinite(r)?r:0;e.orderIndex=a+Ie||Ie}}function mt(e=f){if(!Array.isArray(e)||e.length<2)return!1;fe(e);let t=!1;for(let n=1;n<e.length;n+=1){let r=e[n-1],a=e[n],d=Number.isFinite(r?.orderIndex)?r.orderIndex:null,c=Number.isFinite(a?.orderIndex)?a.orderIndex:null;if(d==null||c==null||d<=c||d-c<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Ie;return e===f&&fe(f),!0}let k={draggingId:null,dropTargetId:null,dropBefore:!0},ci=!1,g={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function kr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function yt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Be(){E&&(E.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),E.classList.remove("drag-over-list"))}function kn(){if(!E)return;let e=E.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Be(),k.draggingId=null,k.dropTargetId=null,k.dropBefore=!0}function li(e,t,n){if(!e||e===t)return;let r=f.findIndex(C=>C?.id===e);if(r<0)return;let[a]=f.splice(r,1),d;if(!t)d=f.length;else{let C=f.findIndex(Y=>Y?.id===t);if(C<0){f.splice(r,0,a);return}d=n?C:C+1}f.splice(d,0,a);let c=f[d-1],u=f[d+1],m=Number.isFinite(c?.orderIndex)?c.orderIndex:null,p=Number.isFinite(u?.orderIndex)?u.orderIndex:null,b;m!=null&&p!=null?b=(m+p)/2:m!=null?b=m-Ie:p!=null?b=p+Ie:b=Ie,Number.isFinite(b)||(b=Ie*(f.length+1)),a.orderIndex=b,fe(f);let D=mt(f);je=!0,H(),J(),D?f.forEach(C=>te(C)):te(a),Je(),we("memoryCue:remindersUpdated",{items:f}),Se({action:"reordered",label:"Reminders reordered"})}function Rr(e){let t=yt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let r=t.dataset.id;if(r&&(k.draggingId=r,k.dropTargetId=null,k.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",r)}catch{}}function Fr(e){if(!k.draggingId)return;let t=yt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),k.dropTargetId=null,k.dropBefore=!1,Be(),E?.classList.add("drag-over-list");return}if(t.dataset.id===k.draggingId){e.preventDefault(),Be();return}e.preventDefault();let n=t.getBoundingClientRect(),r=n.top+n.height/2,a=e.clientY<r;(k.dropTargetId!==t.dataset.id||k.dropBefore!==a)&&(Be(),t.classList.add(a?"drag-over-before":"drag-over-after"),k.dropTargetId=t.dataset.id,k.dropBefore=a)}function Br(e){let t=yt(e.target);if(!t){E?.contains(e.relatedTarget)||Be();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),E?.contains(e.relatedTarget)||E?.classList.remove("drag-over-list"))}function Or(e){if(!k.draggingId)return;e.preventDefault();let t=yt(e.target),n=t?.dataset.id||null,r=k.dropBefore;if(t){let a=t.getBoundingClientRect(),d=a.top+a.height/2;r=e.clientY<d}else n=null,r=!1;li(k.draggingId,n,r),kn()}function Mr(){kn()}function _r(){!E||ci||(ci=!0,E.addEventListener("dragstart",Rr),E.addEventListener("dragover",Fr),E.addEventListener("drop",Or),E.addEventListener("dragend",Mr),E.addEventListener("dragleave",Br),Kt())}function Kt(){if(!E||Kt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Kt._bound=!0;return}let t=6,n=160;function r(){g.longPressTimer&&(clearTimeout(g.longPressTimer),g.longPressTimer=null)}function a(){E&&(g.initialTouchAction!=null?E.style.touchAction=g.initialTouchAction:E.style.removeProperty("touch-action"))}function d({keepHighlights:v=!1}={}){if(r(),g.item&&g.pointerId!=null)try{g.item.hasPointerCapture?.(g.pointerId)&&g.item.releasePointerCapture(g.pointerId)}catch{}if(g.placeholder?.parentNode)try{g.placeholder.parentNode.removeChild(g.placeholder)}catch{}g.item&&(g.item.classList.remove("is-dragging"),g.originalStyles?g.item.setAttribute("style",g.originalStyles):g.item.removeAttribute("style")),a(),v||Be(),Object.assign(g,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function c(v){return E?Array.from(E.querySelectorAll("[data-reminder-item]")).filter(h=>h!==v):[]}function u(v){let h=g.item;if(!h||g.ready)return;let N=h.getBoundingClientRect(),P=window.getComputedStyle(h);g.ready=!0,k.draggingId=h.dataset.id||null,g.offsetY=v.clientY-N.top,g.fixedX=N.left;let B=document.createElement("div");B.className="touch-drag-placeholder",B.setAttribute("aria-hidden","true"),B.style.height=`${N.height}px`,B.style.boxSizing="border-box",B.style.marginTop=P.marginTop,B.style.marginBottom=P.marginBottom,B.style.marginLeft=P.marginLeft,B.style.marginRight=P.marginRight,B.style.borderRadius=P.borderRadius,B.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",B.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",B.style.pointerEvents="none",B.style.display="block",B.style.width="100%",h.parentNode?.insertBefore(B,h),g.placeholder=B,g.longPressTimer=null,g.originalStyles=h.getAttribute("style")||"",h.classList.add("is-dragging"),h.style.position="fixed",h.style.left=`${N.left}px`,h.style.top=`${N.top}px`,h.style.width=`${N.width}px`,h.style.zIndex="999",h.style.pointerEvents="none",h.style.touchAction="none",g.initialTouchAction=E.style.touchAction||"",E.style.touchAction="none"}function m(v){let h=g.item;if(!h||!g.ready)return;let N=v-g.offsetY;h.style.top=`${N}px`,h.style.left=`${g.fixedX}px`}function p(v){if(!g.ready||!E)return;let h=g.item,N=c(h);if(Be(),!N.length){k.dropTargetId=null,k.dropBefore=!1;return}let P=null,B=!1;for(let y of N){let w=y.getBoundingClientRect(),M=w.top+w.height/2;if(v<M){P=y,B=!0;break}}if(!P){P=N[N.length-1];let y=P.getBoundingClientRect(),w=y.top+y.height/2;B=v<w,B||(B=!1)}if(!P){k.dropTargetId=null,k.dropBefore=!1;return}let Ae=P.getBoundingClientRect(),$n=Ae.top+Ae.height/2,wt=v<$n;P.classList.add(wt?"drag-over-before":"drag-over-after"),k.dropTargetId=P.dataset.id||null,k.dropBefore=wt}function b(v){let h=k.draggingId,N=g.moved;if(!g.ready){d();return}d(),!v&&N&&h&&li(h,k.dropTargetId,k.dropBefore),kn()}function D(v){let h=v.pointerType||"";if(h&&h!=="touch"&&h!=="pen"||g.active)return;let N=yt(v.target);if(!N)return;let P=kr(v.target);if(!(P&&P!==N)){g.active=!0,g.pointerId=v.pointerId,g.item=N,g.startX=v.clientX,g.startY=v.clientY,g.lastClientX=v.clientX,g.lastClientY=v.clientY,g.moved=!1,g.ready=!1,g.originalStyles=N.getAttribute("style")||"",g.startTime=v.timeStamp||Date.now(),k.dropTargetId=null,k.dropBefore=!0,k.draggingId=null,r(),g.longPressTimer=setTimeout(()=>{u({clientY:g.lastClientY})},n);try{N.setPointerCapture(v.pointerId)}catch{}}}function C(v){if(!g.active||v.pointerId!==g.pointerId)return;let h=v.pointerType||"";if(!(h&&h!=="touch"&&h!=="pen")){if(g.lastClientX=v.clientX,g.lastClientY=v.clientY,!g.ready){let N=Math.abs(v.clientX-g.startX),P=Math.abs(v.clientY-g.startY);if(N>t||P>t){let B=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(B-g.startTime)>=n?(r(),u({clientY:g.lastClientY})):d()}return}v.preventDefault(),g.moved=!0,m(v.clientY),p(v.clientY)}}function Y(v){!g.active||v.pointerId!==g.pointerId||b(!1)}function he(v){!g.active||v.pointerId!==g.pointerId||b(!0)}E.addEventListener("pointerdown",D),window.addEventListener("pointermove",C),window.addEventListener("pointerup",Y),window.addEventListener("pointercancel",he),Kt._bound=!0}function ui(){ee=null,gn("offline"),Dt.forEach(e=>e.classList.remove("hidden")),Nt.forEach(e=>e.classList.add("hidden")),Rt&&(Rt.textContent=""),ft?.(),ft=null,Fn(),H(),J(),Me()}function Rn(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(qn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let r=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),a=Number.isFinite(n.updatedAt)?n.updatedAt:r,d=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:Qt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:Q(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:r,updatedAt:a,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Pr(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(qn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:Q(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(qn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function J(){fe(f),Pr(f)}function Fn(){f=pt(Rn())}Fn();async function Ur(){if(!ee){f=Rn();return}let e=pt(Rn());if(!e.length){f=[],J();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await te(n),n.pendingSync=!1}catch(r){console.warn("Failed to sync offline reminder",r)}f=pt(e.map(n=>({...n,pendingSync:!1}))),J(),H(),Me()}try{q=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{q={}}if(q&&typeof q=="object"&&Object.values(q).forEach(e=>{e&&typeof e=="object"&&(e.category=Q(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:ht(e),e.urlPath=e.urlPath||Mt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Fe()){let e=Si();typeof Notification<"u"&&Notification.permission==="granted"?(cn(),e.length&&zn(e,{requestCheck:!0})):e.length&&zn(e)}let Jt=e=>{if(!ct)return;let t=[ct];ct.window&&!t.includes(ct.window)&&t.push(ct.window);let n=!e;t.forEach(r=>{try{r.__memoryCueFirebaseUnavailable__=n}catch{}})};function $r(){if(!ie)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",r="mobileNotesColumns",a=typeof document<"u"&&typeof document.execCommand=="function",d=()=>"value"in ie?ie.value:ie.innerHTML,c=b=>{if("value"in ie){ie.value=b;return}if(typeof b!="string"||b.length===0){ie.innerHTML="";return}let D=b.trim();if(/<\/?[a-z][\s\S]*>/i.test(D)){ie.innerHTML=b;return}let Y=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");ie.innerHTML=Y},u=b=>{b?ie.classList.add("notes-editor--columns"):ie.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!b))},m="";try{m=localStorage.getItem(n)||""}catch{A("Unable to access saved notes")}c(m);let p=!1;try{p=localStorage.getItem(r)==="1"}catch{p=!1}u(p),ie.addEventListener("input",()=>{m=d();try{localStorage.setItem(n,m)}catch{A("Notes saved for this session only")}}),ar?.addEventListener("click",()=>{m=d();try{localStorage.setItem(n,m),A("Notes saved")}catch{A("Notes saved for this session only")}}),sr?.addEventListener("click",()=>{let b=m;try{b=localStorage.getItem(n)||m}catch{A("Unable to load saved notes")}m=b,c(m)}),e?.addEventListener("click",b=>{let D=b.target;if(!(D instanceof Element))return;let C=D.closest("button[data-action]");if(!C)return;let Y=C.getAttribute("data-action");if(Y==="columns"){let he=!ie.classList.contains("notes-editor--columns");u(he);try{localStorage.setItem(r,he?"1":"0")}catch{A("Column preference saved for this session only")}return}if(!a){A("Formatting controls are not supported in this browser");return}ie.focus(),Y==="bullets"?document.execCommand("insertUnorderedList"):Y==="numbers"&&document.execCommand("insertOrderedList")})}if($r(),X?.addEventListener("click",Ii),di)({initializeApp:_t,getFirestore:Pt,enableMultiTabIndexedDbPersistence:Ut,enableIndexedDbPersistence:$t,doc:Qe,setDoc:Ht,deleteDoc:jt,onSnapshot:Wt,collection:Yt,query:Gt,orderBy:Vt,serverTimestamp:st,getAuth:dt,onAuthStateChanged:qt,GoogleAuthProvider:zt,signInWithPopup:In,signInWithRedirect:Ln,getRedirectResult:Xt,signOut:Cn}=di),lt=!0;else try{({initializeApp:_t}=await xn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Pt,enableMultiTabIndexedDbPersistence:Ut,enableIndexedDbPersistence:$t,doc:Qe,setDoc:Ht,deleteDoc:jt,onSnapshot:Wt,collection:Yt,query:Gt,orderBy:Vt,serverTimestamp:st}=await xn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:dt,onAuthStateChanged:qt,GoogleAuthProvider:zt,signInWithPopup:In,signInWithRedirect:Ln,getRedirectResult:Xt,signOut:Cn}=await xn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),lt=!0}catch(e){lt=!1,console.warn("Firebase modules failed to load:",e),A("Firebase failed to load; notes available offline"),Jt(!1)}if(lt&&typeof _t=="function"&&typeof Pt=="function"&&typeof dt=="function")try{let e=xo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Dn=_t(e),De=Pt(Dn),ve=!0,console.info("[Firebase] Firestore initialised",e.projectId),Jt(!0)}catch(e){ve=!1,console.warn("Firebase initialization failed:",e),A("Firebase failed to load; notes available offline"),Jt(!1)}else lt?(ve=!1,Jt(!1)):ve=!1;ve&&typeof Ut=="function"&&typeof $t=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ut(De),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await $t(De),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(r){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",r?.code||r)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ve&&typeof dt=="function"&&(ut=dt(Dn));function Hr(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let jr=typeof navigator<"u"&&navigator.language?navigator.language:"",fi=Hr(jr),et=fi||"en-US",Ne="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Ne=e.timeZone),!fi&&e.locale&&(et=e.locale)}catch{}let Wr=new Intl.DateTimeFormat(et,{timeZone:Ne,hour:"2-digit",minute:"2-digit"}),Yr=new Intl.DateTimeFormat(et,{timeZone:Ne,weekday:"long",day:"numeric",month:"long"}),Gr=new Intl.DateTimeFormat("en-CA",{timeZone:Ne,year:"numeric",month:"2-digit",day:"2-digit"}),Vr=new Intl.DateTimeFormat(et,{timeZone:Ne,weekday:"long"}),qr=new Intl.DateTimeFormat(et,{timeZone:Ne,month:"short",day:"numeric"});function Oe(e){let t=Gr.formatToParts(e),n=t.find(d=>d.type==="year").value,r=t.find(d=>d.type==="month").value,a=t.find(d=>d.type==="day").value;return`${n}-${r}-${a}`}function pi(e,t){let[n,r,a]=e.split("-").map(m=>parseInt(m,10)),[d,c]=t.split(":").map(m=>parseInt(m,10)),u=new Date;return u.setFullYear(n,(r||1)-1,a||1),u.setHours(d||0,c||0,0,0),u.toISOString()}let zr=new Intl.DateTimeFormat("en-CA",{timeZone:Ne,year:"numeric",month:"2-digit",day:"2-digit"}),Xr=new Intl.DateTimeFormat("en-CA",{timeZone:Ne,hour:"2-digit",minute:"2-digit",hour12:!1});function Kr(e){try{let t=new Date(e),n=zr.formatToParts(t),r=n.find(c=>c.type==="year")?.value||"0000",a=n.find(c=>c.type==="month")?.value||"00",d=n.find(c=>c.type==="day")?.value||"00";return`${r}-${a}-${d}`}catch{return""}}function Jr(e){try{let t=new Date(e),n=Xr.formatToParts(t),r=n.find(d=>d.type==="hour")?.value?.padStart(2,"0")||"00",a=n.find(d=>d.type==="minute")?.value?.padStart(2,"0")||"00";return`${r}:${a}`}catch{return""}}function Qt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Zt(){return Oe(new Date)}function Qr(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function $o(e){let t=Qr(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function en(e){return e==="High"?3:e==="Medium"?2:1}function mi(e,t){let n=e?.done?1:0,r=t?.done?1:0;if(n!==r)return n-r;let a=e?.due?new Date(e.due).getTime():1/0,d=t?.due?new Date(t.due).getTime():1/0;if(a!==d)return a-d;let c=en(t?.priority)-en(e?.priority);return c||(t?.updatedAt||0)-(e?.updatedAt||0)}function Ho(e,t){let n=en(t.priority)-en(e.priority);if(n)return n;let r=+new Date(e.due||0),a=+new Date(t.due||0);return r!==a?r-a:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function yi(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Yr.format(t)}catch{return e}}function Bn(e){return Wr.format(e)}function Zr(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function jo(e){return e?Zr(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function A(e){U&&(qe(),U.dataset.statusKind="toast",U.textContent=e,clearTimeout(A._t),A._t=setTimeout(()=>{U&&U.dataset.statusKind==="toast"&&(U.textContent="",delete U.dataset.statusKind)},2500))}function eo(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)}}function tn(e){e=String(e||"").toLowerCase();let t={date:Zt(),time:""},n=u=>{let m=new Date,p=m.getDay(),b=(u-p+7)%7,D=new Date(m);return D.setDate(m.getDate()+(b===0?7:b)),D},r=u=>{let m=new Date,p=m.getDay(),b=(u-p+7)%7,D=new Date(m);return D.setDate(m.getDate()+b),D},a={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},d={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let u=new Date;u.setDate(u.getDate()+1),t.date=Oe(u)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=a[u[1]],p=n(m);t.date=Oe(p)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=a[u[1]],p=r(m);t.date=Oe(p)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let u=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),m=a[u[1]],p=n(m);t.date=Oe(p)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let u=e.match(/\bin\s+(\d+)\s+days?\b/),m=parseInt(u[1],10),p=new Date;p.setDate(p.getDate()+m),t.date=Oe(p)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let u=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),m=parseInt(u[1],10),p=parseInt(u[2],10)-1,b=u[3]?parseInt(u[3],10):new Date().getFullYear(),D=new Date(b,p,m);t.date=Oe(D)}else for(let[u,m]of Object.entries(d)){let p=new RegExp(`\\b${u}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(p.test(e)){let b=e.match(p),D=parseInt(b[1],10),C=new Date().getFullYear(),Y=new Date(C,m,D);t.date=Oe(Y);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let u=parseInt(c[1],10),m=c[2]?parseInt(c[2],10):0,p=c[3];p&&(p==="pm"&&u<12&&(u+=12),p==="am"&&u===12&&(u=0)),t.time=`${String(u).padStart(2,"0")}:${String(m).padStart(2,"0")}`}return t}let On=ve&&ut&&typeof zt=="function";Ri({authReady:On,auth:ut,GoogleAuthProvider:zt,signInWithPopup:In,signInWithRedirect:Ln,signOut:Cn,toast:A});let gi=yr,hi=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let r=t(n);r&&typeof r.then=="function"&&r.catch(a=>{console.error("Auth handler error:",a)})}catch(r){console.error("Auth handler error:",r)}}),e._authWired=!0)};gi&&Dt.length&&Dt.forEach(e=>hi(e,Fi)),On&&typeof Xt=="function"&&Xt(ut).catch(()=>{}),gi&&Nt.length&&Nt.forEach(e=>hi(e,Bi)),On&&typeof qt=="function"?qt(ut,async e=>{e?(ee=e.uid,gn("online"),Dt.forEach(t=>t.classList.add("hidden")),Nt.forEach(t=>t.classList.remove("hidden")),Rt&&(Rt.textContent=e.displayName||e.email||""),to(),await Ur()):ui()}):ui();function to(){if(!ve||!De||typeof Yt!="function"||typeof Gt!="function"||typeof Vt!="function"||typeof Wt!="function")return;if(!ee){Fn(),H(),Ke(),J(),Me();return}ft&&ft();let e=Yt(De,"users",ee,"reminders"),t=Gt(e,Vt("updatedAt","desc"));ft=Wt(t,n=>{let r=[];n.forEach(a=>{let d=a.data(),c=Number(d.orderIndex),u=typeof d.plannerLessonId=="string"&&d.plannerLessonId?d.plannerLessonId:null,m=d.pinToToday===!0;r.push({id:a.id,title:d.title,priority:d.priority,notes:d.notes||"",done:!!d.done,due:d.due||null,category:Q(d.category),createdAt:d.createdAt?.toMillis?.()||0,updatedAt:d.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(c)?c:null,plannerLessonId:u,pinToToday:m})}),f=pt(r),H(),Ke(),J(),Me()},n=>{console.error("Firestore sync error:",n),V&&gn("error","Sync Error")})}async function te(e){if(!(!ve||!ee||!De||typeof Qe!="function"||typeof Ht!="function"||typeof st!="function"))try{await Ht(Qe(De,"users",ee,"reminders",e.id),{ownerUid:ee,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||z,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):st(),updatedAt:st()},{merge:!0})}catch(t){console.error("Save failed:",t),A("Save queued (offline)")}}async function no(e){if(!(!ve||!ee||!De||typeof Qe!="function"||typeof jt!="function"))try{await jt(Qe(De,"users",ee,"reminders",e))}catch{A("Delete queued (offline)")}}async function gt(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||z,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ge({preserveDetail:e=!1}={}){l&&(l.value=""),S&&(S.value=""),T&&(T.value=""),I&&(I.value=""),Bt("Medium"),L&&(L.value=z),ri(),Ze=null,X&&(X.textContent="Save"),ne?.classList.add("hidden"),vn(),e||Qn()}function io(e){let t=f.find(n=>n.id===e);t&&(l&&(l.value=t.title||""),S&&T&&(t.due?(S.value=Kr(t.due),T.value=Jr(t.due)):(S.value="",T.value="")),Bt(t?.priority||"Medium"),L&&(L.value=Q(t.category)),I&&(I.value=typeof t.notes=="string"?t.notes:""),W&&(W.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),vn(),rr(t),Ze=e,X&&(X.textContent="Update"),ne?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),l?.focus(),we("cue:open",{mode:"edit"}))}function ro(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),r=Q(e.category??(L?L.value:"")),a={id:Qt(),title:e.title.trim(),priority:e.priority||"Medium",category:r,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!ee,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday};Nn(a,{position:"start"}),f=[a,...f],fe(f);let d=mt(f);return je=!0,H(),J(),ni(a),d?f.forEach(c=>te(c)):te(a),gt(a),Ve(a),Je(),we("memoryCue:remindersUpdated",{items:f}),si(),Se({action:"created",label:`Reminder added \xB7 ${a.title}`}),a}function oo(e,t){if(!ee)return A("Sign in to add notes"),null;if(!e)return null;let n=f.find(c=>c.id===e);if(!n)return null;let a=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!a)return n;let d=typeof n.notes=="string"?n.notes:"";return n.notes=d?`${d}
${a}`:a,n.updatedAt=Date.now(),te(n),H(),J(),Se({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function ao(e){let t=f.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),te(t),gt(t),H(),J(),t.done?(rn(e),Se({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ve(t),Se({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function so(e,t){let n=f.find(a=>a?.id===e);if(!n)return;let r=!!t;n.pinToToday!==r&&(n.pinToToday=r,n.updatedAt=Date.now(),te(n),H(),J(),Je(),we("memoryCue:remindersUpdated",{items:f}))}function co(e){if(!ue||ue.tokenId!==e)return;let{item:t,index:n}=ue;if(!t){qe(e);return}qe(e);let r=Number.isInteger(n)?Math.min(Math.max(n,0),f.length):f.length;t.pendingSync=!ee,t.updatedAt=Date.now(),f.splice(r,0,t),fe(f);let a=mt(f);je=!0,H(),J(),Ve(t),a?f.forEach(d=>te(d)):te(t),gt(t),Je(),we("memoryCue:remindersUpdated",{items:f}),Se({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),A("Reminder restored")}function bi(e){let t=f.findIndex(a=>a.id===e),n=t>=0?f.splice(t,1)[0]:null;n&&Ze===e&&Ge(),H(),J(),no(e),rn(e);let r=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(Se({action:"deleted",label:r}),n&&U){qe();let a=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;ue={tokenId:a,item:n,index:t,timeoutId:null},ir(ue),ue.timeoutId=setTimeout(()=>{qe(a)},nr)}else n&&qe()}function lo(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,r=48,a=800,d='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',c=null,u=!1,m=0,p=0,b=0,D=()=>{if(u){if(u=!1,c!=null&&e.hasPointerCapture?.(c))try{e.releasePointerCapture(c)}catch{}c=null,e.removeEventListener("pointermove",Y),e.removeEventListener("pointerup",he),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",he),window.removeEventListener("pointercancel",v)}},C=h=>{if(h.pointerType==="mouse"&&h.button!==0)return;u&&D();let N=h.target;N instanceof Element&&N.closest(d)||(c=h.pointerId,m=h.clientX,p=h.clientY,b=typeof h.timeStamp=="number"?h.timeStamp:Date.now(),u=!0,e.addEventListener("pointermove",Y),e.addEventListener("pointerup",he),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",he),window.addEventListener("pointercancel",v))},Y=h=>{if(!u||h.pointerId!==c)return;Math.abs(h.clientY-p)>r&&D()},he=h=>{if(!u||h.pointerId!==c)return;let N=h.clientX-m,P=Math.abs(h.clientY-p),B=(typeof h.timeStamp=="number"?h.timeStamp:Date.now())-b;if(D(),N<=-n&&P<=r&&B<=a){h.preventDefault(),h.stopPropagation();try{t()}catch(Ae){console.warn("Swipe delete handler failed",Ae)}}},v=h=>{u&&(typeof h.pointerId=="number"&&h.pointerId!==c||D())};e.addEventListener("pointerdown",C)}function ht(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(r=>r.trim()).find(Boolean);if(n){if(e.due)try{let r=new Date(e.due);if(!Number.isNaN(r.getTime())){let a=Bn(r);if(a)return`${n} \u2022 ${a}`}}catch{}return n}if(e.due)try{let r=new Date(e.due);if(!Number.isNaN(r.getTime())){let a=Bn(r);if(a)return`Due ${a}`}}catch{}return"Due now"}function wi(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}A("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Si(){return Object.values(q||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||z,notes:typeof e.notes=="string"?e.notes:"",body:ht(e),urlPath:e.urlPath||Mt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Mn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(q))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Si(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&cn(),zn(e,{requestCheck:t})}function nn(e,{closeNotification:t=!0}={}){if(t){let n=Re.get(e);if(n){try{n.close()}catch{}Re.delete(e)}}We[e]&&(clearTimeout(We[e]),delete We[e]),Ye[e]&&(clearTimeout(Ye[e]),delete Ye[e]),Xn(e),q[e]&&(delete q[e],Mn())}function rn(e){nn(e)}function _n(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Re.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:ht(e),tag:e.id});Re.set(e.id,n);let r=()=>{Re.get(e.id)===n&&Re.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",r),n.addEventListener("click",r)),n.onclose=r,n.onclick=r}catch{}}async function uo(e){if(!Fe())return!1;let t=Gi();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let r=await Pe();if(!r)return!1;await Xn(e.id,r);let a={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||z,body:d,urlPath:Mt},d=ht(e),c={body:d,tag:e.id,data:a,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await r.showNotification(e.title,c),!0}catch(u){return console.warn("Failed to schedule persistent notification",u),!1}}function Ve(e){if(!e||!e.id)return;if(e.category=Q(e.category),!e.due||e.done){rn(e.id);return}let t=q[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||z,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:ht(e),urlPath:Mt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let u=typeof t.due=="string"?t.due:null,m=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return u===e.due?m:null})()};if(q[e.id]=n,Mn(),We[e.id]&&(clearTimeout(We[e.id]),delete We[e.id]),Ye[e.id]&&(clearTimeout(Ye[e.id]),delete Ye[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let r=new Date(e.due).getTime();if(!Number.isFinite(r))return;let a=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,d=r-Date.now();if(d<=0){if(q[e.id]?.viaTrigger){nn(e.id,{closeNotification:!1});return}_n(e),nn(e.id,{closeNotification:!1});return}let c=Fe();if(Number.isFinite(a)&&a>Date.now()&&a<r){let u=a-Date.now();Ye[e.id]=setTimeout(()=>{_n({...e,due:e.due||n.due})},u)}c&&(n.viaTrigger=!1,uo(e).then(u=>{u&&q[e.id]&&(q[e.id]={...q[e.id],viaTrigger:!0},Mn())})),We[e.id]=setTimeout(()=>{c&&Xn(e.id),_n(e),nn(e.id,{closeNotification:!1})},d)}function Me(){Object.values(q).forEach(e=>Ve({...e,category:Q(e?.category)}))}function vi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Vr.format(t),r=qr.format(t),a=Bn(t);return`${n}, ${r}${a?` at ${a}`:""}`}catch{return"No due date"}}let Ei="__mcPinToggleHandler";var Pn=!1;function bt(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(le,t),e.classList.toggle(oe,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function Ai(e){if(!(e instanceof HTMLElement)||e[Ei])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async r=>{if(r?.defaultPrevented)return;r.stopPropagation(),typeof r?.preventDefault=="function"&&r.preventDefault();let a=r.currentTarget;if(!(a instanceof HTMLElement))return;let c=(typeof a.closest=="function"?a.closest("[data-reminder-item]"):null)?.dataset?.id;if(!c){bt(a,!1);return}let u=!a.classList.contains(le);await Promise.resolve(so(c,u)),bt(a,u)},n=r=>{r?.defaultPrevented||(r?.key==="Enter"||r?.key===" ")&&(r.preventDefault(),t(r))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Ei]={click:t,keydown:n}}function fo(){if(!E)return;let e=E.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let r=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!r){bt(t,!1),Ai(t);return}let d=!!f.find(c=>c?.id===r)?.pinToToday;bt(t,d),Ai(t)})}function Ti(){if(!E||Pn)return;Pn=!0;let e=()=>{Pn=!1,fo()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function po(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function mo(e,t,n){return t!=="today"?e:Array.isArray(e)?e.filter(r=>po(r,n)):[]}function Un(){if(se!=="mobile"||typeof document>"u"||Un._wired)return;let e=document.querySelectorAll("#view-reminders [data-reminders-tab]");if(!e.length)return;Un._wired=!0;let t=()=>{e.forEach(n=>{let a=n.getAttribute("data-reminders-tab")===at;n.setAttribute("aria-pressed",a?"true":"false"),a?n.classList.add("reminders-tab-active"):n.classList.remove("reminders-tab-active")})};t(),Ke(),e.forEach(n=>{n.addEventListener("click",()=>{let r=n.getAttribute("data-reminders-tab");!r||r===at||(at=r,t(),Array.isArray(wn)&&H(),Ke())})})}function H(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let r=new Date(t);r.setHours(23,59,59,999);let a={start:n,end:r};if(Be(),fe(f),Zn)try{Zn.textContent=String(f.length)}catch{}f.forEach(y=>{y&&typeof y=="object"&&(y.category=Q(y.category))});let d=new Set(Lo.map(y=>Q(y)));f.forEach(y=>{y&&typeof y=="object"&&d.add(Q(y.category))});let c=Array.from(d).sort((y,w)=>y.localeCompare(w,void 0,{sensitivity:"base"}));if(bn){let y=new Set;Array.from(bn.querySelectorAll("option")).forEach(w=>{y.add(w.value.trim().toLowerCase())}),c.forEach(w=>{let M=w.toLowerCase();if(!y.has(M)){let O=document.createElement("option");O.value=w,bn.appendChild(O),y.add(M)}})}if(je)je=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let y=f.map(w=>({...w}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:y}}));else if(document.createEvent){let w=document.createEvent("CustomEvent");w&&w.initCustomEvent&&(w.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:y}),document.dispatchEvent(w))}}catch{}}let u=f.slice();fe(u),se==="mobile"&&(wn=u.slice(),u=mo(wn,at,a),Ke());let m=!0,p=f.length>0,b=u.length>0,D=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let y=Object.values(q||{}).filter(w=>w&&typeof w=="object"&&w.id);return new Set(y.map(w=>w.id))})();if(Xe)if(b)Xe.classList.add("hidden");else{let y=p?"No reminders to show right now.":Cr;ai?ai(Xe,{icon:p?"sparkles":"bell",title:p?"Nothing to display":"Create your first cue",description:y,action:p?void 0:`<button type="button" class="${xr}" data-trigger="open-cue">Create reminder</button>`}):Xe.textContent=y,Xe.classList.remove("hidden")}if(ei&&ei.classList.toggle("has-items",b),!E)return;if(!b){Xe?(E.innerHTML="",E.classList.add("hidden")):(E.innerHTML='<div class="text-muted">No reminders found.</div>',E.classList.remove("hidden")),Ti();return}E.classList.remove("hidden"),E.replaceChildren();let C=document.createDocumentFragment(),Y=E.tagName==="UL"||E.tagName==="OL",he=!0,v=["priority-high","priority-medium","priority-low"],h=(y,w)=>{if(!(y instanceof HTMLElement))return;y.classList.remove(...v);let M=typeof w=="string"?w.trim().toLowerCase():"";M.startsWith("h")?y.classList.add("priority-high"):M.startsWith("m")?y.classList.add("priority-medium"):M.startsWith("l")&&y.classList.add("priority-low")},N=(y,w="neutral")=>{let M=document.createElement("span");M.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",M.title=y,M.dataset.tone=w;let O=document.createElement("span");O.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",w==="priority-high"?O.classList.add("bg-error"):w==="priority-medium"?O.classList.add("bg-warning"):w==="priority-low"?O.classList.add("bg-secondary"):w==="category"?O.classList.add("bg-primary"):O.classList.add("bg-base-content","opacity-40");let R=document.createElement("span");return R.className="truncate",R.textContent=y,M.append(O,R),M},P=(y,w,{elementTag:M,isMobile:O})=>{let R={id:y.id,title:y.title,dueIso:y.due||null,priority:y.priority||"Medium",category:w,done:!!y.done,pinToToday:y.pinToToday===!0},St="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",ho="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",x=document.createElement(M);x.className=O?ho:St,x.dataset.id=R.id,x.dataset.category=R.category,x.dataset.title=R.title;let Li=R.priority&&String(R.priority).trim();Li?x.dataset.priority=Li:delete x.dataset.priority,x.dataset.done=String(R.done),R.dueIso?x.dataset.due=R.dueIso:delete x.dataset.due,R.pinToToday?x.dataset.pinToToday="true":delete x.dataset.pinToToday,x.dataset.reminder=JSON.stringify(R),x.dataset.orderIndex=Number.isFinite(y.orderIndex)?String(y.orderIndex):"",x.dataset.reminderItem="true",x.dataset.compact="true",x.classList.add("reminder-draggable"),x.setAttribute("draggable","true"),x.setAttribute("role","button"),x.tabIndex=0,x.setAttribute("aria-label",`Edit reminder: ${y.title}`),h(x,R.priority),D.has(R.id)?x.dataset.notificationActive="true":delete x.dataset.notificationActive;let Hn=R.dueIso?new Date(R.dueIso):null;m&&Hn&&Hn>=n&&Hn<=r?(x.classList.add("is-today"),x.dataset.today="true"):(x.classList.remove("is-today"),delete x.dataset.today);let vt=document.createElement("div");vt.className="flex min-w-0 flex-1 flex-col gap-2",O&&vt.classList.add("text-sm","text-base-content");let Te=document.createElement("p");if(Te.className=O?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",Te.classList.add("desktop-reminder-title"),O||Te.classList.add("sm:text-[0.95rem]"),R.done&&Te.classList.add("line-through","text-base-content/60"),O){Te.dataset.reminderTitle="true",Te.textContent="";let $=document.createElement("span");$.dataset.role="reminder-today-toggle",$.className="reminder-title-toggle cursor-pointer",$.setAttribute("role","button"),$.tabIndex=0,$.textContent=y.title,bt($,R.pinToToday),Te.appendChild($)}else Te.textContent=y.title;let on=Te;O&&(on=document.createElement("div"),on.className="reminder-title-slot",on.appendChild(Te)),vt.appendChild(on);let Et=document.createElement("div");Et.className=O?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let jn=vi(y),Ci=jn&&jn!=="No due date"?jn:"";Ci&&Et.appendChild(N(Ci,"due")),!!(w&&w!==z)&&Et.appendChild(N(w,"category")),Et.children.length&&vt.appendChild(Et),x.appendChild(vt);let tt=document.createElement("div");tt.className="task-toolbar flex items-start gap-1",tt.setAttribute("role","toolbar"),tt.setAttribute("aria-label","Reminder actions"),O&&tt.classList.add("flex-shrink-0");let ce=document.createElement("button");ce.type="button",ce.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn",R.done?(ce.classList.add("text-base-content/60"),ce.innerHTML='<span aria-hidden="true">\u21BA</span>',ce.setAttribute("aria-label",`Mark reminder as active: ${y.title}`)):(ce.classList.add("text-success"),ce.innerHTML='<span aria-hidden="true">\u2713</span>',ce.setAttribute("aria-label",`Mark reminder as done: ${y.title}`)),ce.setAttribute("aria-pressed",R.done?"true":"false"),ce.setAttribute("data-reminder-control","toggle"),ce.setAttribute("data-no-swipe","true"),ce.addEventListener("click",$=>{$.preventDefault(),$.stopPropagation(),ao(R.id)});let ke=document.createElement("button");ke.type="button",ke.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn",ke.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',ke.setAttribute("aria-label",`Delete reminder: ${y.title}`),ke.setAttribute("data-action","delete"),ke.setAttribute("data-reminder-control","delete"),ke.setAttribute("data-no-swipe","true"),ke.addEventListener("click",$=>{$.preventDefault(),$.stopPropagation(),bi(R.id)}),tt.append(ce,ke),x.appendChild(tt);let xi=()=>io(R.id);return x.addEventListener("click",$=>{if($.defaultPrevented)return;let Wn=$.target;Wn&&typeof Wn.closest=="function"&&Wn.closest("[data-reminder-control]")||xi()}),x.addEventListener("keydown",$=>{$.defaultPrevented||$.target===x&&($.key==="Enter"||$.key===" ")&&($.preventDefault(),xi())}),O&&lo(x,()=>bi(R.id)),x},B=(y,w)=>P(y,w,{elementTag:"div",isMobile:!0});if(se!=="desktop"&&!he){u.forEach(y=>{let w=y.category||z;C.appendChild(B(y,w))}),E.appendChild(C);return}let Ae=new Map;u.forEach(y=>{let w=y.category||z;Ae.has(w)||Ae.set(w,[]),Ae.get(w).push(y)});let $n=Array.from(Ae.entries()).sort((y,w)=>y[0].localeCompare(w[0],void 0,{sensitivity:"base"})),wt=!0;$n.forEach(([y,w])=>{if(y!==z){let M=document.createElement(Y?"li":"div");M.dataset.categoryHeading=y,Y&&(M.setAttribute("role","presentation"),M.style.listStyle="none"),M.className=se==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",wt||(M.style.marginTop=se==="desktop"?"1.25rem":"1rem");let O=document.createElement("div");O.setAttribute("role","heading"),O.setAttribute("aria-level","3"),O.className=se==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let R=document.createElement("span");R.textContent=y;let St=document.createElement("span");St.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",St.textContent=`${w.length} ${w.length===1?"item":"items"}`,O.append(R,St),M.appendChild(O),C.appendChild(M)}w.forEach(M=>{if(se==="desktop"){let O=P(M,y,{elementTag:Y?"li":"div",isMobile:!1});C.appendChild(O);return}C.appendChild(B(M,y))}),wt=!1}),E.appendChild(C),or(),Ti()}function Ee(){rt?.setAttribute("aria-expanded","false"),ot?.classList.add("hidden")}function yo(){rt?.setAttribute("aria-expanded","true"),ot?.classList.remove("hidden")}rt?.addEventListener("click",e=>{e.stopPropagation(),rt.getAttribute("aria-expanded")==="true"?Ee():yo()}),document.addEventListener("click",e=>{ot&&!ot.classList.contains("hidden")&&!ot.contains(e.target)&&e.target!==rt&&Ee()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Ee()}),mr.forEach(e=>{e.addEventListener("click",()=>{let t=Ft?.classList.contains("hidden");Ft?.classList.toggle("hidden"),t&&Ft?.scrollIntoView({behavior:"smooth",block:"start"}),Ee()})}),document.addEventListener("DOMContentLoaded",()=>{Ft?.classList.add("hidden")});function Ii(){try{console.log("handleSaveAction invoked",{editingId:Ze,title:l?.value})}catch{}let t=(typeof l?.value=="string"?l.value:"").trim(),n=typeof S?.value=="string"?S.value:"",r=typeof T?.value=="string"?T.value:"",a=typeof W?.value=="string"?W.value.trim():"";if(Ze){let p=f.find(C=>C.id===Ze);if(!p){Ge();return}if(!t){A("Add a reminder title");return}let b=null;if(n||r){let C=n||Zt();b=pi(C,r||"09:00")}else{let C=tn(t);C.time&&(b=new Date(`${C.date}T${C.time}:00`).toISOString())}p.title=t;let D=An();p.priority=D,Bt(D),L&&(p.category=Q(L.value)),p.due=b,I&&(p.notes=I.value.trim()),p.plannerLessonId=a||null,p.updatedAt=Date.now(),te(p),gt(p),je=!0,H(),Ve(p),J(),Je(),we("memoryCue:remindersUpdated",{items:f}),si(),Se({action:"updated",label:`Reminder updated \xB7 ${p.title}`}),Ge(),A("Reminder updated"),we("cue:close",{reason:"updated"});return}if(!t){A("Add a reminder title");return}let d=I?I.value.trim():"",c=null;if(n||r){let p=n||Zt();c=pi(p,r||"09:00")}else{let p=tn(t);p.time&&(c=new Date(`${p.date}T${p.time}:00`).toISOString())}let u=a?{lessonId:a,dayLabel:W?.dataset?.lessonDayLabel||"",lessonTitle:W?.dataset?.lessonTitle||"",summary:W?.dataset?.lessonSummary||""}:null,m=ro({title:t,priority:An(),category:L?L.value:"",due:c,notes:d,plannerLessonId:a||null});m&&(u?(A("Planner reminder created"),we("planner:reminderCreated",{lessonId:u.lessonId,dayLabel:u.dayLabel,lessonTitle:u.lessonTitle,summary:u.summary,reminderId:m.id,reminderTitle:m.title,reminderDue:m.due||null})):A("Reminder created")),l&&(l.value=""),T&&(T.value=""),I&&(I.value=""),vn(),we("cue:close",{reason:"created"})}l?.addEventListener("keydown",e=>{e.key==="Enter"&&Ii()});function go(){if(!l||!$e)return;let e=l.value.trim();if(!e){$e.style.display="none";return}try{let t=tn(e),n=Zt();if(t.date!==n||t.time){let r="";if(t.date!==n){let a=new Date(t.date+"T00:00:00");r+=`\u{1F4C5} ${yi(t.date)}`}t.time&&(r+=`${r?" ":""}\u{1F550} ${t.time}`),r?($e.textContent=`Parsed: ${r}`,$e.style.display="block"):$e.style.display="none"}else $e.style.display="none"}catch{$e.style.display="none"}}if(l?.addEventListener("input",eo(go,300)),ne?.addEventListener("click",()=>{Ge(),A("Edit cancelled"),we("cue:close",{reason:"edit-cancelled"})}),er?.addEventListener("click",()=>{Ge()}),document.addEventListener("cue:cancelled",()=>{Ge()}),document.addEventListener("cue:prepare",()=>{Ge()}),document.addEventListener("planner:prefillReminder",e=>{wr(e?.detail||{})}),window.addEventListener("load",()=>l?.focus()),cr?.addEventListener("click",()=>{let e=f.filter(t=>!t.done).map(t=>{let n=t.due?yi(t.due.slice(0,10)):"",r=t.due?new Date(t.due).toLocaleTimeString(et,{hour:"2-digit",minute:"2-digit",timeZone:Ne}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${r}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){A("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>A("Copied for Master Task List")).catch(()=>A("Copy failed")),Ee()}),hn?.addEventListener("change",()=>{let e=hn.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),r=[];n.forEach(d=>{let c={...d,id:Qt(),category:Q(d.category),pendingSync:!ee,orderIndex:null};Nn(c,{position:"start"}),f=[c,...f],r.push(c)}),fe(f);let a=mt(f);H(),J(),a?f.forEach(d=>te(d)):r.forEach(d=>te(d)),A("Import successful")}catch{A("Invalid JSON")}},t.readAsText(e),hn.value="",Ee()}),lr?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Ee()}),ur?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){A("Add your Apps Script URL in Settings first"),Ee();return}if(!f.length){A("No tasks to sync"),Ee();return}A("Syncing all tasks\u2026");let t=20,n=0;for(let r=0;r<f.length;r+=t){let a=f.slice(r,r+t),d=await Promise.allSettled(a.map(c=>{let u={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||z,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})}));n+=d.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}A(`Sync complete: ${f.length-n} ok${n?`, ${n} failed`:""}`),Ee()}),ze&&(ze.value=localStorage.getItem("syncUrl")||""),fr?.addEventListener("click",()=>{ze&&(localStorage.setItem("syncUrl",ze.value.trim()),A("Settings saved"))}),pr?.addEventListener("click",async()=>{if(!ze)return;let e=ze.value.trim();if(!e){A("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});A(t.ok?"Test ok":"Test failed")}catch{A("Test failed")}}),dr?.addEventListener("click",async()=>{if(!("Notification"in window)){A("Notifications not supported");return}if(Notification.permission==="granted"){A("Notifications enabled"),Fe()?Pe():(cn(),wi()),Me(),H();return}try{await Notification.requestPermission()==="granted"?(A("Notifications enabled"),Fe()?Pe():(cn(),wi()),Me(),H()):A("Notifications blocked")}catch{A("Notifications blocked")}}),Un(),se==="mobile"){let e=()=>{try{hr()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return _r(),Me(),H(),J(),{cancelReminder:rn,scheduleReminder:Ve,closeActiveNotifications:Vi,getActiveNotifications:()=>Re,addNoteToReminder:oo,__testing:{setItems(e=[]){f=Array.isArray(e)?e.map(t=>({...t,category:Q(t?.category)})):[],f=pt(f),fe(f),H()},render:H,getItems:()=>f.map(e=>({...e}))}}}var Hi,Re,ji,Yn,Gn,Wi,dn,xt,Vn,z,Lo,qn,Ie,Co,Le,ko=an(()=>{Mi();Hi="memoryCue:activity",Re=new Map,ji=!1,Yn="service-worker.js",Gn="memory-cue-reminder-sync",Wi=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),dn=null,xt=null,Vn=!1,z="General",Lo=Object.freeze([z,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),qn="memoryCue:offlineReminders",Ie=1024,Co=Object.freeze({}),Le=null});var zi,Ro,mn,Jn,Xi,Ki,ln,Ji,fn,un,qi,Fo,Qi,pn,Zi=an(()=>{zi="memoryCueNotes",Ro=["mobileNotes"],mn=()=>typeof localStorage<"u",Jn=null,Xi=i=>{Jn=typeof i=="function"?i:null},Ki=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,ln=i=>{if(typeof i!="string")return"";let o=i.trim();if(!o.length)return"";if(!/[<>]/.test(o))return i;try{if(typeof document<"u"){let s=document.createElement("div");return s.innerHTML=o,(typeof s.innerText=="string"&&s.innerText.length?s.innerText:s.textContent||"").replace(/\r?\n/g,`
`)}}catch{}return o.replace(/<br\s*\/?\s*>/gi,`
`).replace(/<\/?div[^>]*>/gi,`
`).replace(/<\/?p[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`)},Ji=i=>{if(typeof i!="string")return!1;let o=Date.parse(i);return!Number.isNaN(o)},fn=(i,o,s={})=>{let l=typeof i=="string"?i.trim():"";return{id:s.id&&typeof s.id=="string"?s.id:Ki(),title:l||"Untitled note",body:typeof o=="string"?ln(o):"",updatedAt:s.updatedAt&&Ji(s.updatedAt)?s.updatedAt:new Date().toISOString()}},un=i=>{if(Array.isArray(i))return i.map(o=>{if(!o||typeof o!="object")return null;let s=typeof o.title=="string"?o.title.trim():"",l=typeof o.body=="string"?ln(o.body):"",S=typeof o.id=="string"&&o.id.trim()?o.id:Ki(),T=Ji(o.updatedAt)?o.updatedAt:new Date().toISOString();return!s&&!l&&!o.body?null:(!l&&o.body&&/<[^>]+>/.test(o.body)&&(l=o.body),{id:S,title:s||"Untitled note",body:l,updatedAt:T})}).filter(Boolean);if(i&&typeof i=="object"){let o=typeof i.title=="string"?i.title:"",s=typeof i.body=="string"?i.body:"",l=s?ln(s):"";return!l&&s&&/<[^>]+>/.test(s)&&(l=s),!o&&!l?[]:[fn(o,l,{id:typeof i.id=="string"?i.id:void 0,updatedAt:typeof i.updatedAt=="string"?i.updatedAt:void 0})]}return typeof i=="string"&&i.trim().length?[fn("Notebook (legacy)",ln(i))]:[]},qi=i=>{if(!mn())return null;try{return localStorage.getItem(i)}catch{return null}},Fo=i=>{if(mn())try{localStorage.removeItem(i)}catch{}},Qi=()=>{if(!mn())return[];let i=qi(zi);if(typeof i=="string")try{let o=JSON.parse(i),s=un(o);if(s.length)return s}catch{let o=un(i);if(o.length)return pn(o),o}for(let o of Ro){let s=qi(o);if(typeof s=="string"&&s.trim().length){let l=un(s);if(l.length)return pn(l),Fo(o),l}}return[]},pn=(i,o={})=>{if(!mn()||!Array.isArray(i))return!1;let s=i.map(l=>un([l])[0]).filter(Boolean);try{if(localStorage.setItem(zi,JSON.stringify(s)),!o.skipRemoteSync&&typeof Jn=="function")try{let l=Jn(s);l&&typeof l.then=="function"&&l.catch(S=>{console.error("[notes-storage] Remote sync failed.",S)})}catch(l){console.error("[notes-storage] Remote sync handler threw.",l)}return!0}catch{return!1}}});var Bo,Oo,Mo,yn,_o,Po,na,Uo=an(()=>{Ni();Zi();Bo="notes",Oo="user_id",Mo="updated_at",yn=i=>{if(typeof i!="string")return 0;let o=Date.parse(i);return Number.isNaN(o)?0:o},_o=(i=[],o=[])=>{let s=new Map;return o.forEach(l=>{l&&typeof l.id=="string"&&s.set(l.id,l)}),i.forEach(l=>{if(!l||typeof l.id!="string")return;let S=s.get(l.id);if(!S){s.set(l.id,l);return}let T=yn(l.updatedAt),I=yn(S.updatedAt);T>I&&s.set(l.id,l)}),Array.from(s.values()).sort((l,S)=>yn(S?.updatedAt)-yn(l?.updatedAt))},Po=i=>o=>{if(!o||typeof o!="object")return null;let s={id:typeof o.id=="string"&&o.id?o.id:void 0,updatedAt:typeof o[i]=="string"?o[i]:void 0};return fn(o.title,o.body,s)},na=(i={})=>{let{tableName:o=Bo,userColumn:s=Oo,updatedAtColumn:l=Mo,supabase:S=null}=i,T=S||null,I=null,G=!1,L=new Set,X=()=>T||(T=nt(),T),ne=Po(l),E=async _=>{let K=X();if(!K||!I)return;let me=(Array.isArray(_)?_.filter(F=>F&&typeof F.id=="string"):[]).map(F=>({id:F.id,[s]:I,title:F.title,body:F.body,[l]:typeof F.updatedAt=="string"&&F.updatedAt?F.updatedAt:new Date().toISOString()})),be=new Set(me.map(F=>F.id));if(me.length){let{error:F}=await K.from(o).upsert(me);if(F)throw F}let ye=[...L].filter(F=>F&&!be.has(F));if(ye.length){let{error:F}=await K.from(o).delete().in("id",ye).eq(s,I);if(F)throw F}L=new Set(be)},le=async()=>{let _=X();if(!(!_||!I))try{let{data:K,error:Ue}=await _.from(o).select(`id,title,body,${l}`).eq(s,I);if(Ue)throw Ue;let me=Array.isArray(K)?K:[];L=new Set(me.map(Ce=>typeof Ce.id=="string"?Ce.id:null).filter(Boolean));let be=me.map(ne).filter(Boolean),ye=Qi();if(!be.length){if(ye.length)try{await E(ye)}catch(Ce){console.error("[notes-sync] Failed to upload local notes to Supabase.",Ce)}return}let F=_o(ye,be);G=!0;let ge=pn(F,{skipRemoteSync:!0});G=!1,ge||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await E(F)}catch(Ce){console.error("[notes-sync] Failed to reconcile notes with Supabase.",Ce)}}catch(K){console.error("[notes-sync] Failed to fetch notes from Supabase.",K)}finally{G=!1}};return Xi(async _=>{if(!G)try{await E(_)}catch(K){console.error("[notes-sync] Failed to sync notes to Supabase.",K)}}),{setSupabaseClient(_){_&&(T=_)},handleSessionChange:async _=>{if(I=typeof _?.id=="string"?_.id:null,!I){L=new Set;return}await le()},syncFromRemote:le}}});export{Vo as a,Mi as b,Ko as c,ko as d,zi as e,fn as f,Qi as g,pn as h,Zi as i,na as j,Uo as k};
