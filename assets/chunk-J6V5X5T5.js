import{a as Vn}from"./chunk-RCZ4YZVR.js";function zt(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Kt(){let s=zt(),p=s&&s.TimestampTrigger;return typeof p=="function"?p:null}function me(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Kt()}function Jn(){if(typeof window>"u"||!window.location)return At;try{return new URL(At,window.location.href).href}catch{return At}}async function Te(){return rt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(rt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Jn()),await navigator.serviceWorker.ready}catch(s){return console.warn("Service worker registration failed",s),null}})(),rt))}async function Tt(s,p){if(me())try{let X=p||await Te();if(!X)return;let b=[];try{b=await X.getNotifications({tag:s,includeTriggered:!0})}catch{b=await X.getNotifications({tag:s})}for(let B of b)try{B.close()}catch{}}catch{}}function Qt(){for(let s of Array.from(z.values()))try{s.close()}catch{}z.clear()}function zn(){if(Jt||typeof window>"u"||typeof window.addEventListener!="function")return;let s=()=>Qt();["pagehide","beforeunload"].forEach(p=>{try{window.addEventListener(p,s)}catch{}}),Jt=!0}function A(s){if(typeof s=="string"){let p=s.replace(/\s+/g," ").trim();if(p)return p}return N}async function Yn(s={}){let p=e=>e?document.querySelector(e):null,X=e=>e?Array.from(document.querySelectorAll(e)):[],b=p(s.titleSel),B=p(s.dateSel),j=p(s.timeSel),P=p(s.detailsSel),ee=p(s.prioritySel),k=p(s.categorySel),ye=p(s.saveBtnSel),st=p(s.cancelEditBtnSel),U=p(s.listSel),Ce=X(s.googleSignInBtnSel),Ie=X(s.googleSignOutBtnSel),S=p(s.statusSel),L=p(s.syncStatusSel),Zt={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Yt=6e3,F=null;function se(e,{clearMessage:t=!0}={}){F&&(e&&F.tokenId!==e||(F.timeoutId&&clearTimeout(F.timeoutId),t&&S&&S.dataset.undoToken===F.tokenId&&(typeof S.replaceChildren=="function"?S.replaceChildren():S.textContent="",delete S.dataset.undoToken,delete S.dataset.statusKind),F=null))}function Xt(e){if(!S)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>jn(e.tokenId)),e.button=i,typeof S.replaceChildren=="function"?S.replaceChildren(t,n,i):(S.textContent="",S.append(t,n,i)),S.dataset.statusKind="undo",S.dataset.undoToken=e.tokenId}function ct(e,t){if(!L)return;let n=["online","offline","error"];n.forEach(a=>L.classList.remove(a)),n.includes(e)&&L.classList.add(e),L.dataset.state=e;let i=typeof t=="string"?t:Zt[e]||"";e==="online"||e==="offline"?(L.textContent="",L.dataset.compact="true",i?(L.setAttribute("aria-label",i),L.setAttribute("title",i)):(L.removeAttribute("aria-label"),L.removeAttribute("title"))):(L.textContent=i,L.removeAttribute("data-compact"),i?(L.setAttribute("aria-label",i),L.setAttribute("title",i)):(L.removeAttribute("aria-label"),L.removeAttribute("title")))}let T=p(s.notesSel),en=p(s.saveNotesBtnSel),tn=p(s.loadNotesBtnSel),Ct=p(s.countTotalSel),xe=p(s.googleUserNameSel),te=p(s.dateFeedbackSel),M=p(s.voiceBtnSel),nn=p(s.notifBtnSel),ge=p(s.moreBtnSel),he=p(s.moreMenuSel),on=p(s.copyMtlBtnSel),dt=p(s.importFileSel),an=p(s.exportBtnSel),rn=p(s.syncAllBtnSel),ce=p(s.syncUrlInputSel),sn=p(s.saveSettingsSel),cn=p(s.testSyncSel),dn=X(s.openSettingsSel),Ne=p(s.settingsSectionSel),de=p(s.emptyStateSel),It=p(s.listWrapperSel),lt=p(s.categoryOptionsSel),ne=s.variant||"mobile",xt="mc:lastDefaults";function ut(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(xt)||"{}")||{}}catch{return{}}}function ln(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(xt,JSON.stringify(e))}catch{}}function Nt(e){let t=ut(),n={category:A(e?.category||t.category||N),priority:e?.priority||t.priority||"Medium"};ln(n)}let Mt='fieldset#priorityChips input[name="priority"]';function ft(){try{let e=document.querySelector(`${Mt}:checked`);if(e&&e.value)return e.value}catch{}return ee&&typeof ee.value=="string"&&ee.value?ee.value:"Medium"}function Me(e){let t=e||"Medium";ee&&typeof ee.value<"u"&&(ee.value=t);try{let n=Array.from(document.querySelectorAll(Mt));if(!n.length)return;let i=!1;if(n.forEach(o=>{let a=o.value===t;o.checked=a,i=i||a}),!i){let o=n.find(a=>a.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function Rt(){let e=ut();e.category&&k&&(k.value=e.category),e.priority&&Me(e.priority)}Rt();let R=typeof document<"u"?document.getElementById("quickAddInput"):null,un=typeof document<"u"?document.getElementById("quickAddSubmit"):null,$=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,pt=null;function fn(e,t){let n=Date.now(),i=ut(),o=typeof t=="string"&&t?t:null;return{id:Ze(),title:(e||"").trim(),priority:i.priority||ft(),category:A(i.category||k?.value||N),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!C}}async function mt(){if(!R)return;if(typeof pt=="function")try{pt()}catch{}let e=(R.value||"").trim();if(!e)return;let t=null;try{let i=et(e);i&&i.time&&(t=new Date(`${i.date}T${i.time}:00`).toISOString())}catch{t=null}let n=fn(e,t);y.unshift(n),ue=!0,D(),x(),Z(n),ke(n),re(n),Y(),Nt(n),Re();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:y}}))}catch{}q({action:"created",label:`Reminder added \xB7 ${n.title}`}),R.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=mt),un?.addEventListener("click",()=>{mt()}),R?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),mt())});function pn(){if(typeof HTMLElement>"u"||!($ instanceof HTMLElement)||!(R instanceof HTMLInputElement)||$.dataset.voiceBound==="true")return;if($.dataset.voiceBound="true",typeof window>"u"){$.setAttribute("disabled","true"),$.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){$.setAttribute("disabled","true"),$.setAttribute("aria-disabled","true"),$.getAttribute("title")||($.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,$.setAttribute("aria-pressed",d?"true":"false"),$.dataset.listening=d?"true":"false",$.classList.toggle("is-listening",d)},o=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",l=>{let u=l?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){R.value=u;try{R.focus({preventScroll:!0})}catch{R.focus()}try{let v=R.value.length;typeof R.setSelectionRange=="function"&&R.setSelectionRange(v,v)}catch{}}});let r=()=>{i(!1)};return t.addEventListener("end",r),t.addEventListener("error",r),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};pt=a,$.addEventListener("click",()=>{let d=o();if(d){if(n){a();return}try{d.start(),i(!0)}catch(r){console.warn("Quick add voice error:",r),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}pn(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&R&&(e.preventDefault(),R.focus())})));try{ne==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let mn=s.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",$t=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,yn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",gn=s.reminderLandingPath||(ne==="desktop"?"index.html#reminders":"mobile.html"),ie=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Ft(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Re(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:y}}))}catch{}}k&&!k.value&&(k.value=N),me()&&Te();function q(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Gt,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Gt,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function hn(){if(typeof HTMLElement>"u"||!(M instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&b instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&b instanceof HTMLTextAreaElement;if(!e&&!t||M.dataset.voiceBound==="true")return;if(M.dataset.voiceBound="true",typeof window>"u"){M.setAttribute("disabled","true"),M.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){M.setAttribute("disabled","true"),M.setAttribute("aria-disabled","true"),M.getAttribute("title")||(M.title="Voice input is not supported in this browser.");return}let i=null,o=!1,a=u=>{o=u,M.setAttribute("aria-pressed",u?"true":"false"),M.dataset.listening=u?"true":"false",M.classList.toggle("is-listening",u)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",v=>{let w=v.results?.[0]?.[0]?.transcript?.trim()||"";if(w){b.value=w;try{b.focus({preventScroll:!0})}catch{try{b.focus()}catch{}}try{let O=b.value.length;typeof b.setSelectionRange=="function"&&b.setSelectionRange(O,O)}catch{}q({action:"dictated",label:`Voice input captured \xB7 ${w}`})}});let u=()=>{a(!1)};return i.addEventListener("end",u),i.addEventListener("error",u),i},r=()=>{if(!(!o||!i)){try{i.stop()}catch{}a(!1)}};M.addEventListener("click",()=>{let u=d();if(u){if(o){r();return}try{u.start(),a(!0)}catch(v){console.warn("Speech recognition error:",v),a(!1)}}});let l=()=>{r()};typeof document<"u"&&(document.addEventListener("cue:close",l),document.addEventListener("reminders:updated",l)),a(!1)}zn(),hn();let $e,Fe,Oe,Be,le,Ue,je,Pe,He,_e,qe,ve,be,We,Ve,Ge,Je,ze,Ke,Ot=s.firebaseDeps,yt=typeof s.importModule=="function"?s.importModule:e=>import(e),we=zt(),Se=!1,H=!1,gt=null,W=null,oe=null,y=[],ue=!1,C=null,Ee=null,Le=null,ae={},I={};function Bt(){C=null,ct("offline"),Ce.forEach(e=>e.classList.remove("hidden")),Ie.forEach(e=>e.classList.add("hidden")),xe&&(xe.textContent=""),Ee?.(),Ee=null,vt(),D(),x(),Y()}function ht(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Dt);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i;return{id:typeof n.id=="string"&&n.id?n.id:Ze(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:A(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function vn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Dt);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:A(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync}));localStorage.setItem(Dt,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function x(){vn(y)}function vt(){y=ht()}vt();async function bn(){if(!C){y=ht();return}let e=ht();if(!e.length){y=[],x();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await Z(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}y=e.map(n=>({...n,pendingSync:!1})),x(),D(),Y()}try{I=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{I={}}I&&typeof I=="object"&&Object.values(I).forEach(e=>{e&&typeof e=="object"&&(e.category=A(e.category))});let Qe=e=>{if(!we)return;let t=[we];we.window&&!t.includes(we.window)&&t.push(we.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function wn(){if(!T)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in T?T.value:T.innerHTML,d=v=>{if("value"in T){T.value=v;return}if(typeof v!="string"||v.length===0){T.innerHTML="";return}let w=v.trim();if(/<\/?[a-z][\s\S]*>/i.test(w)){T.innerHTML=v;return}let G=v.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");T.innerHTML=G},r=v=>{v?T.classList.add("notes-editor--columns"):T.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!v))},l="";try{l=localStorage.getItem(n)||""}catch{m("Unable to access saved notes")}d(l);let u=!1;try{u=localStorage.getItem(i)==="1"}catch{u=!1}r(u),T.addEventListener("input",()=>{l=a();try{localStorage.setItem(n,l)}catch{m("Notes saved for this session only")}}),en?.addEventListener("click",()=>{l=a();try{localStorage.setItem(n,l),m("Notes saved")}catch{m("Notes saved for this session only")}}),tn?.addEventListener("click",()=>{let v=l;try{v=localStorage.getItem(n)||l}catch{m("Unable to load saved notes")}l=v,d(l)}),e?.addEventListener("click",v=>{let w=v.target;if(!(w instanceof Element))return;let O=w.closest("button[data-action]");if(!O)return;let G=O.getAttribute("data-action");if(G==="columns"){let De=!T.classList.contains("notes-editor--columns");r(De);try{localStorage.setItem(i,De?"1":"0")}catch{m("Column preference saved for this session only")}return}if(!o){m("Formatting controls are not supported in this browser");return}T.focus(),G==="bullets"?document.execCommand("insertUnorderedList"):G==="numbers"&&document.execCommand("insertOrderedList")})}if(wn(),ye?.addEventListener("click",Wt),Ot)({initializeApp:$e,getFirestore:Fe,enableMultiTabIndexedDbPersistence:Oe,enableIndexedDbPersistence:Be,doc:le,setDoc:Ue,deleteDoc:je,onSnapshot:Pe,collection:He,query:_e,orderBy:qe,serverTimestamp:ve,getAuth:be,onAuthStateChanged:We,GoogleAuthProvider:Ve,signInWithPopup:Ge,signInWithRedirect:Je,getRedirectResult:ze,signOut:Ke}=Ot),Se=!0;else try{({initializeApp:$e}=await yt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Fe,enableMultiTabIndexedDbPersistence:Oe,enableIndexedDbPersistence:Be,doc:le,setDoc:Ue,deleteDoc:je,onSnapshot:Pe,collection:He,query:_e,orderBy:qe,serverTimestamp:ve}=await yt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:be,onAuthStateChanged:We,GoogleAuthProvider:Ve,signInWithPopup:Ge,signInWithRedirect:Je,getRedirectResult:ze,signOut:Ke}=await yt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Se=!0}catch(e){Se=!1,console.warn("Firebase modules failed to load:",e),m("Firebase failed to load; notes available offline"),Qe(!1)}if(Se&&typeof $e=="function"&&typeof Fe=="function"&&typeof be=="function")try{gt=$e({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),W=Fe(gt),H=!0,Qe(!0)}catch(e){H=!1,console.warn("Firebase initialization failed:",e),m("Firebase failed to load; notes available offline"),Qe(!1)}else Se?(H=!1,Qe(!1)):H=!1;H&&typeof Oe=="function"&&typeof Be=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Oe(W),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Be(W),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),H&&typeof be=="function"&&(oe=be(gt));function Sn(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let En=typeof navigator<"u"&&navigator.language?navigator.language:"",Ut=Sn(En),fe=Ut||"en-US",V="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(V=e.timeZone),!Ut&&e.locale&&(fe=e.locale)}catch{}let Ln=new Intl.DateTimeFormat(fe,{timeZone:V,hour:"2-digit",minute:"2-digit"}),kn=new Intl.DateTimeFormat(fe,{timeZone:V,weekday:"long",day:"numeric",month:"long"}),An=new Intl.DateTimeFormat("en-CA",{timeZone:V,year:"numeric",month:"2-digit",day:"2-digit"}),Dn=new Intl.DateTimeFormat(fe,{timeZone:V,weekday:"long"}),Tn=new Intl.DateTimeFormat(fe,{timeZone:V,month:"short",day:"numeric"});function K(e){let t=An.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,o=t.find(a=>a.type==="day").value;return`${n}-${i}-${o}`}function jt(e,t){let[n,i,o]=e.split("-").map(l=>parseInt(l,10)),[a,d]=t.split(":").map(l=>parseInt(l,10)),r=new Date;return r.setFullYear(n,(i||1)-1,o||1),r.setHours(a||0,d||0,0,0),r.toISOString()}let Cn=new Intl.DateTimeFormat("en-CA",{timeZone:V,year:"numeric",month:"2-digit",day:"2-digit"}),In=new Intl.DateTimeFormat("en-CA",{timeZone:V,hour:"2-digit",minute:"2-digit",hour12:!1});function xn(e){try{let t=new Date(e),n=Cn.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",o=n.find(d=>d.type==="month")?.value||"00",a=n.find(d=>d.type==="day")?.value||"00";return`${i}-${o}-${a}`}catch{return""}}function Nn(e){try{let t=new Date(e),n=In.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function Ze(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Ye(){return K(new Date)}function Mn(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function Qn(e){let t=Mn(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Xe(e){return e==="High"?3:e==="Medium"?2:1}function Zn(e,t){let n=Xe(t.priority)-Xe(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function bt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return kn.format(t)}catch{return e}}function wt(e){return Ln.format(e)}function Q(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Pt(e){return e?Q(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function m(e){S&&(se(),S.dataset.statusKind="toast",S.textContent=e,clearTimeout(m._t),m._t=setTimeout(()=>{S&&S.dataset.statusKind==="toast"&&(S.textContent="",delete S.dataset.statusKind)},2500))}function Rn(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function et(e){e=String(e||"").toLowerCase();let t={date:Ye(),time:""},n=r=>{let l=new Date,u=l.getDay(),v=(r-u+7)%7,w=new Date(l);return w.setDate(l.getDate()+(v===0?7:v)),w},i=r=>{let l=new Date,u=l.getDay(),v=(r-u+7)%7,w=new Date(l);return w.setDate(l.getDate()+v),w},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let r=new Date;r.setDate(r.getDate()+1),t.date=K(r)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let r=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),l=o[r[1]],u=n(l);t.date=K(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let r=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),l=o[r[1]],u=i(l);t.date=K(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let r=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),l=o[r[1]],u=n(l);t.date=K(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let r=e.match(/\bin\s+(\d+)\s+days?\b/),l=parseInt(r[1],10),u=new Date;u.setDate(u.getDate()+l),t.date=K(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let r=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),l=parseInt(r[1],10),u=parseInt(r[2],10)-1,v=r[3]?parseInt(r[3],10):new Date().getFullYear(),w=new Date(v,u,l);t.date=K(w)}else for(let[r,l]of Object.entries(a)){let u=new RegExp(`\\b${r}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let v=e.match(u),w=parseInt(v[1],10),O=new Date().getFullYear(),G=new Date(O,l,w);t.date=K(G);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let r=parseInt(d[1],10),l=d[2]?parseInt(d[2],10):0,u=d[3];u&&(u==="pm"&&r<12&&(r+=12),u==="am"&&r===12&&(r=0)),t.time=`${String(r).padStart(2,"0")}:${String(l).padStart(2,"0")}`}return t}let tt=H&&oe&&typeof Ve=="function";if(Ce.length){let e=async()=>{if(!tt||typeof Ge!="function"||typeof Je!="function"){m("Sign-in unavailable offline");return}let t=new Ve;try{await Ge(oe,t)}catch{try{await Je(oe,t)}catch{m("Google sign-in failed")}}};Ce.forEach(t=>{t.addEventListener("click",e)})}if(tt&&typeof ze=="function"&&ze(oe).catch(()=>{}),Ie.length){let e=async()=>{if(!tt||typeof Ke!="function"){m("Sign-out unavailable offline");return}try{await Ke(oe),m("Signed out")}catch{m("Sign-out failed")}};Ie.forEach(t=>{t.addEventListener("click",e)})}tt&&typeof We=="function"?We(oe,async e=>{e?(C=e.uid,ct("online"),Ce.forEach(t=>t.classList.add("hidden")),Ie.forEach(t=>t.classList.remove("hidden")),xe&&(xe.textContent=e.displayName||e.email||""),$n(),await bn()):Bt()}):Bt();function $n(){if(!H||!W||typeof He!="function"||typeof _e!="function"||typeof qe!="function"||typeof Pe!="function")return;if(!C){vt(),D(),x(),Y();return}Ee&&Ee();let e=He(W,"users",C,"reminders"),t=_e(e,qe("updatedAt","desc"));Ee=Pe(t,n=>{let i=[];n.forEach(o=>{let a=o.data();i.push({id:o.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:A(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1})}),y=i,D(),x(),Y()},n=>{console.error("Firestore sync error:",n),L&&ct("error","Sync Error")})}async function Z(e){if(!(!H||!C||!W||typeof le!="function"||typeof Ue!="function"||typeof ve!="function"))try{await Ue(le(W,"users",C,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||N,createdAt:e.createdAt?new Date(e.createdAt):ve(),updatedAt:ve()},{merge:!0})}catch(t){console.error("Save failed:",t),m("Save queued (offline)")}}async function Fn(e){if(!(!H||!C||!W||typeof le!="function"||typeof je!="function"))try{await je(le(W,"users",C,"reminders",e))}catch{m("Delete queued (offline)")}}async function ke(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||N,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ae(){b&&(b.value=""),B&&(B.value=""),j&&(j.value=""),P&&(P.value=""),Me("Medium"),k&&(k.value=N),Rt(),Le=null,ye&&(ye.textContent="Save Cue"),st?.classList.add("hidden")}function Ht(e){let t=y.find(n=>n.id===e);t&&(b&&(b.value=t.title||""),B&&j&&(t.due?(B.value=xn(t.due),j.value=Nn(t.due)):(B.value="",j.value="")),Me(t?.priority||"Medium"),k&&(k.value=A(t.category)),P&&(P.value=typeof t.notes=="string"?t.notes:""),Le=e,ye&&(ye.textContent="Update Cue"),st?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),b?.focus(),ie("cue:open",{mode:"edit"}))}function On(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=A(e.category??(k?k.value:"")),o={id:Ze(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!C};return y=[o,...y],ue=!0,D(),x(),Nt(o),Z(o),ke(o),re(o),Re(),ie("memoryCue:remindersUpdated",{items:y}),Ft(),q({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Bn(e,t){if(!C)return m("Sign in to add notes"),null;if(!e)return null;let n=y.find(d=>d.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${o}`:o,n.updatedAt=Date.now(),Z(n),D(),x(),q({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Un(e){let t=y.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),Z(t),ke(t),D(),x(),t.done?(it(e),q({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(re(t),q({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function jn(e){if(!F||F.tokenId!==e)return;let{item:t,index:n}=F;if(!t){se(e);return}se(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),y.length):y.length;t.pendingSync=!C,t.updatedAt=Date.now(),y.splice(i,0,t),ue=!0,D(),x(),re(t),Z(t),ke(t),Re(),ie("memoryCue:remindersUpdated",{items:y}),q({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),m("Reminder restored")}function _t(e){let t=y.findIndex(o=>o.id===e),n=t>=0?y.splice(t,1)[0]:null;D(),x(),Fn(e),it(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(q({action:"deleted",label:i}),n&&S){se();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;F={tokenId:o,item:n,index:t,timeoutId:null},Xt(F),F.timeoutId=setTimeout(()=>{se(o)},Yt)}else n&&se()}function St(){localStorage.setItem("scheduledReminders",JSON.stringify(I))}function nt(e,{closeNotification:t=!0}={}){if(t){let n=z.get(e);if(n){try{n.close()}catch{}z.delete(e)}}ae[e]&&(clearTimeout(ae[e]),delete ae[e]),Tt(e),I[e]&&(delete I[e],St())}function it(e){nt(e)}function qt(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=z.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:"Due now",tag:e.id});z.set(e.id,n);let i=()=>{z.get(e.id)===n&&z.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Pn(e){if(!me())return!1;let t=Kt();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Te();if(!i)return!1;await Tt(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||N,urlPath:gn},a=typeof e.notes=="string"&&e.notes.split(/\r?\n/).find(l=>l.trim())||"",d=a||"Due now";try{let l=new Date(e.due);if(!Number.isNaN(l.getTime())){let u=wt(l);u&&(d=a?`${a} \u2022 ${u}`:`Due ${u}`)}}catch{}let r={body:d,tag:e.id,data:o,renotify:!0};n>Date.now()&&(r.showTrigger=new t(n));try{return await i.showNotification(e.title,r),!0}catch(l){return console.warn("Failed to schedule persistent notification",l),!1}}function re(e){if(!e||!e.id)return;if(e.category=A(e.category),!e.due||e.done){it(e.id);return}let t={id:e.id,title:e.title,due:e.due,category:e.category||N};if(I[e.id]=t,St(),ae[e.id]&&(clearTimeout(ae[e.id]),delete ae[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return;let i=n-Date.now();if(i<=0){if(I[e.id]?.viaTrigger){nt(e.id,{closeNotification:!1});return}qt(e),nt(e.id,{closeNotification:!1});return}let o=me();o&&(t.viaTrigger=!1,Pn(e).then(a=>{a&&I[e.id]&&(I[e.id]={...I[e.id],viaTrigger:!0},St())})),ae[e.id]=setTimeout(()=>{o&&Tt(e.id),qt(e),nt(e.id,{closeNotification:!1})},i)}function Y(){Object.values(I).forEach(e=>re({...e,category:A(e?.category)}))}function Hn(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Dn.format(t),i=Tn.format(t),o=wt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function D(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),Ct)try{Ct.textContent=String(y.length)}catch{}y.forEach(c=>{c&&typeof c=="object"&&(c.category=A(c.category))});let o=new Set(Gn.map(c=>A(c)));y.forEach(c=>{c&&typeof c=="object"&&o.add(A(c.category))});let a=Array.from(o).sort((c,g)=>c.localeCompare(g,void 0,{sensitivity:"base"}));if(lt){let c=new Set;Array.from(lt.querySelectorAll("option")).forEach(g=>{c.add(g.value.trim().toLowerCase())}),a.forEach(g=>{let f=g.toLowerCase();if(!c.has(f)){let h=document.createElement("option");h.value=g,lt.appendChild(h),c.add(f)}})}if(ue)ue=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let c=y.map(g=>({...g}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:c}}));else if(document.createEvent){let g=document.createEvent("CustomEvent");g&&g.initCustomEvent&&(g.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:c}),document.dispatchEvent(g))}}catch{}}let d=y.slice(),r=(c,g)=>{let f=c.done?1:0,h=g.done?1:0;if(f!==h)return f-h;let E=c.due?new Date(c.due).getTime():1/0,J=g.due?new Date(g.due).getTime():1/0;if(E!==J)return E-J;let pe=Xe(g.priority)-Xe(c.priority);return pe||(g.updatedAt||0)-(c.updatedAt||0)},l=!0;d.sort(r);let u=y.length>0,v=d.length>0;if(de)if(v)de.classList.add("hidden");else{let c=u?"No reminders to show right now.":mn;$t?$t(de,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:c,action:u?void 0:`<button type="button" class="${yn}" data-trigger="open-cue">Create reminder</button>`}):de.textContent=c,de.classList.remove("hidden")}if(It&&It.classList.toggle("has-items",v),!U)return;if(!v){de?(U.innerHTML="",U.classList.add("hidden")):(U.innerHTML='<div class="text-muted">No reminders found.</div>',U.classList.remove("hidden"));return}U.classList.remove("hidden"),U.replaceChildren();let w=document.createDocumentFragment(),O=U.tagName==="UL"||U.tagName==="OL",G=!0,De=(c,g)=>{let f=document.createElement("div");f.className="task-item";let h={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:g,done:!!c.done};f.dataset.category=g,f.dataset.reminder=JSON.stringify(h),f.dataset.id=h.id,f.dataset.title=h.title,f.dataset.priority=h.priority,f.dataset.done=String(h.done),h.dueIso&&(f.dataset.due=h.dueIso);let E=h.dueIso?new Date(h.dueIso):null;l&&E&&E>=n&&E<=i&&(f.classList.add("is-today"),f.dataset.today="true");let pe=c.due?`${wt(new Date(c.due))} \u2022 ${bt(c.due.slice(0,10))}`:"No due date",at=g?Q(g):"",Et=Q(h.priority),Lt=[`<span class="task-chip" data-chip="due">${Q(pe)}</span>`,at?`<span class="task-chip" data-chip="category">${at}</span>`:"",`<span class="task-chip" data-chip="priority">${Et}</span>`].filter(Boolean).join(""),kt=c.notes?`<div class="task-notes">${Pt(c.notes)}</div>`:"";return f.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${Q(c.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn" data-edit type="button" aria-label="Edit reminder">
                <span aria-hidden="true">\u270F\uFE0F</span>
                <span class="task-toolbar-label">Edit</span>
              </button>
              <button class="task-toolbar-btn" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          <div class="task-meta">
            <div class="task-meta-row" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              ${Lt}
            </div>
          </div>
          ${kt}
        </div>`,f.querySelector("[data-edit]").addEventListener("click",()=>Ht(c.id)),f.querySelector("[data-del]").addEventListener("click",()=>_t(c.id)),f};if(ne!=="desktop"&&!G){d.forEach(c=>{let g=c.category||N;w.appendChild(De(c,g))}),U.appendChild(w);return}let ot=new Map;d.forEach(c=>{let g=c.category||N;ot.has(g)||ot.set(g,[]),ot.get(g).push(c)});let Wn=Array.from(ot.entries()).sort((c,g)=>c[0].localeCompare(g[0],void 0,{sensitivity:"base"})),Vt=!0;Wn.forEach(([c,g])=>{if(c!==N){let f=document.createElement(O?"li":"div");f.dataset.categoryHeading=c,O&&(f.setAttribute("role","presentation"),f.style.listStyle="none"),f.className=ne==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",Vt||(f.style.marginTop=ne==="desktop"?"1.25rem":"1rem");let h=document.createElement("div");h.setAttribute("role","heading"),h.setAttribute("aria-level","3"),h.className=ne==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let E=document.createElement("span");E.textContent=c;let J=document.createElement("span");J.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",J.textContent=`${g.length} ${g.length===1?"item":"items"}`,h.append(E,J),f.appendChild(h),w.appendChild(f)}g.forEach(f=>{if(ne==="desktop"){let h=document.createElement(O?"li":"div"),E={id:f.id,title:f.title,dueIso:f.due||null,priority:f.priority||"Medium",category:c,done:!!f.done};h.dataset.id=E.id,h.dataset.category=E.category,h.dataset.title=E.title,h.dataset.priority=E.priority,h.dataset.done=String(E.done),E.dueIso&&(h.dataset.due=E.dueIso),h.dataset.reminder=JSON.stringify(E),h.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200";let J=Hn(f),pe=f.done?"line-through text-base-content/50":"text-base-content",at=f.done?"Completed":"Active",Et=f.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Lt=f.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",kt=f.notes?`<p class="text-sm leading-relaxed text-base-content/70">${Pt(f.notes)}</p>`:"";h.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${pe}">${Q(f.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${Q(J)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${Q(c)}
            </span>
            <span class="${Et} text-[0.7rem] sm:text-xs">${at}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${kt}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Lt}">${f.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,h.querySelector('[data-action="toggle"]').addEventListener("click",()=>Un(f.id)),h.querySelector('[data-action="edit"]').addEventListener("click",()=>Ht(f.id)),h.querySelector('[data-action="delete"]').addEventListener("click",()=>_t(f.id)),w.appendChild(h);return}w.appendChild(De(f,c))}),Vt=!1}),U.appendChild(w)}function _(){ge?.setAttribute("aria-expanded","false"),he?.classList.add("hidden")}function _n(){ge?.setAttribute("aria-expanded","true"),he?.classList.remove("hidden")}ge?.addEventListener("click",e=>{e.stopPropagation(),ge.getAttribute("aria-expanded")==="true"?_():_n()}),document.addEventListener("click",e=>{he&&!he.classList.contains("hidden")&&!he.contains(e.target)&&e.target!==ge&&_()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&_()}),dn.forEach(e=>{e.addEventListener("click",()=>{let t=Ne?.classList.contains("hidden");Ne?.classList.toggle("hidden"),t&&Ne?.scrollIntoView({behavior:"smooth",block:"start"}),_()})}),document.addEventListener("DOMContentLoaded",()=>{Ne?.classList.add("hidden")});function Wt(){try{console.log("handleSaveAction invoked",{editingId:Le,title:b?.value})}catch{}if(Le){let i=y.find(r=>r.id===Le);if(!i){Ae();return}let o=b.value.trim();if(!o){m("Add a reminder title");return}let a=null;if(B.value||j.value){let r=B.value||Ye(),l=j.value||"09:00";a=jt(r,l)}else{let r=et(o);r.time&&(a=new Date(`${r.date}T${r.time}:00`).toISOString())}i.title=o;let d=ft();i.priority=d,Me(d),k&&(i.category=A(k.value)),i.due=a,P&&(i.notes=P.value.trim()),i.updatedAt=Date.now(),Z(i),ke(i),ue=!0,D(),re(i),x(),Re(),ie("memoryCue:remindersUpdated",{items:y}),Ft(),q({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Ae(),m("Reminder updated"),ie("cue:close",{reason:"updated"});return}let e=b.value.trim();if(!e){m("Add a reminder title");return}let t=P?P.value.trim():"",n=null;if(B.value||j.value){let i=B.value||Ye(),o=j.value||"09:00";n=jt(i,o)}else{let i=et(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}On({title:e,priority:ft(),category:k?k.value:"",due:n,notes:t}),b.value="",j.value="",P&&(P.value=""),ie("cue:close",{reason:"created"})}b?.addEventListener("keydown",e=>{e.key==="Enter"&&Wt()});function qn(){if(!b||!te)return;let e=b.value.trim();if(!e){te.style.display="none";return}try{let t=et(e),n=Ye();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${bt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(te.textContent=`Parsed: ${i}`,te.style.display="block"):te.style.display="none"}else te.style.display="none"}catch{te.style.display="none"}}return b?.addEventListener("input",Rn(qn,300)),st?.addEventListener("click",()=>{Ae(),m("Edit cancelled"),ie("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Ae()}),document.addEventListener("cue:prepare",()=>{Ae()}),window.addEventListener("load",()=>b?.focus()),on?.addEventListener("click",()=>{let e=y.filter(t=>!t.done).map(t=>{let n=t.due?bt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(fe,{hour:"2-digit",minute:"2-digit",timeZone:V}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){m("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>m("Copied for Master Task List")).catch(()=>m("Copy failed")),_()}),dt?.addEventListener("change",()=>{let e=dt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{JSON.parse(String(t.result)||"[]").slice(0,500).forEach(i=>{i.id=Ze(),i.category=A(i.category),i.pendingSync=!C,y=[i,...y],Z(i)}),D(),x(),m("Import successful")}catch{m("Invalid JSON")}},t.readAsText(e),dt.value="",_()}),an?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),_()}),rn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){m("Add your Apps Script URL in Settings first"),_();return}if(!y.length){m("No tasks to sync"),_();return}m("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<y.length;i+=t){let o=y.slice(i,i+t),a=await Promise.allSettled(o.map(d=>{let r={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||N,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}));n+=a.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}m(`Sync complete: ${y.length-n} ok${n?`, ${n} failed`:""}`),_()}),ce&&(ce.value=localStorage.getItem("syncUrl")||""),sn?.addEventListener("click",()=>{ce&&(localStorage.setItem("syncUrl",ce.value.trim()),m("Settings saved"))}),cn?.addEventListener("click",async()=>{if(!ce)return;let e=ce.value.trim();if(!e){m("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});m(t.ok?"Test ok":"Test failed")}catch{m("Test failed")}}),nn?.addEventListener("click",async()=>{if(!("Notification"in window)){m("Notifications not supported");return}if(Notification.permission==="granted"){m("Notifications enabled"),me()&&Te(),Y();return}try{await Notification.requestPermission()==="granted"?(m("Notifications enabled"),me()&&Te(),Y()):m("Notifications blocked")}catch{m("Notifications blocked")}}),Y(),D(),x(),{cancelReminder:it,scheduleReminder:re,closeActiveNotifications:Qt,getActiveNotifications:()=>z,addNoteToReminder:Bn,__testing:{setItems(e=[]){y=Array.isArray(e)?e.map(t=>({...t,category:A(t?.category)})):[],D()},render:D,getItems:()=>y.map(e=>({...e}))}}}var Gt,z,Jt,At,rt,N,Gn,Dt,Kn=Vn(()=>{Gt="memoryCue:activity",z=new Map,Jt=!1,At="service-worker.js",rt=null,N="General",Gn=Object.freeze([N,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Dt="memoryCue:offlineReminders"});export{Yn as a,Kn as b};
