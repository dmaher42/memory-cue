import{a as Wn,b as Pa,c as nt,d as Na,f as jt,g as rt,h as Ut,i as Ma,j as Vn,k as Ba}from"./chunk-673QGCZ3.js";import{a as Un,b as Da}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as qt,c as Ca}from"./chunk-GUVSRPRW.js";function Kn(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:r})=>{if(!Array.isArray(r))return null;for(let a of r){if(typeof a!="string"||!a)continue;let o=t.getElementById(a);if(o)return{key:n,element:o}}return null}).filter(n=>!!(n&&n.element))}function we(e,t){if(!e||typeof e!="object")return"";let n=Fa[t]||[t];for(let r of n)if(Object.prototype.hasOwnProperty.call(e,r)){let a=e[r];return a==null?"":typeof a=="string"?a:String(a)}return""}function Ha(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function Ra(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Yn(e,t){Array.isArray(t)&&t.forEach(({key:n,element:r})=>{let a=e&&typeof e=="object"?we(e,n):"";Ha(r,a)})}function Gn(e,t,n,r){Array.isArray(e)&&e.forEach(({element:a})=>{a instanceof HTMLInputElement?["checkbox","radio"].includes(a.type)?a.checked=!1:a.value="":(a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement)&&(a.value="")}),t&&(t.value=""),n&&(n.textContent=r)}function Jn(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:r})=>{let a=Ra(r);if(typeof a=="boolean"){t[n]=a;return}let o=typeof a=="string"?a.trim():a;t[n]=o??""}),t}function I(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var zn,Fa,Wt,Vt,Qn=qt(()=>{zn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],Fa={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Wt="Create Cue",Vt="Edit Cue"});function Xn(e){return new zt(e)}var Oa,_a,zt,Zn=qt(()=>{Oa=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),_a={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},zt=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={..._a,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let r=n[0],a=n[n.length-1],o=document.activeElement;t.shiftKey&&o===r?(t.preventDefault(),a.focus()):!t.shiftKey&&o===a&&(t.preventDefault(),r.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Oa)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let r=this.events[t];if(!r||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let a=new CustomEvent(r,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(a)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var er,tr,nr,Yt,Kt,$a,Le,Gt,qa,rr,ar,Jt,ja,or,it,sr,ir,Qt,me,Ua,lr,ve,cr,Wa,Va,za,dr,Xt,ot,$e,at,Se,_e,Ka,ur,ae,fr,oe,mr,pr,st,Ya,Oe,se,yr,Z,qe,hr,Zt,gr,K,lt,en,br,Er,tn,nn,wr,Sr,Te,Lr,ct,rn,vr=qt(()=>{er="memoryCue:plannerPlans",tr="memoryCue:plannerTemplates",nr="memoryCue:lastPlannerTemplate",Yt="memoryCue:plannerUpdated",Kt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$a=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],Le=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},Gt=e=>{if(!Le()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},qa=(e,t)=>{if(!(!Le()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch{}},rr=e=>{try{return JSON.parse(e)}catch{return null}},ar=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Jt=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,ja=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),r=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-r),t},or=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`},it=e=>{if(typeof e!="string")return null;let[t,n,r]=e.split("-"),a=Number.parseInt(t,10),o=Number.parseInt(n,10),i=Number.parseInt(r,10);if(!Number.isFinite(a)||!Number.isFinite(o)||!Number.isFinite(i))return null;let s=new Date(a,o-1,i);return Number.isNaN(s.getTime())?null:(s.setHours(0,0,0,0),s)},sr=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=Kt.findIndex(r=>r.toLowerCase()===t);return n>=0?n:0},ir=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:ar(),badge:n,text:t}},Qt=(e,t={})=>{let n=typeof t=="object"&&t?t:{},r=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:sr(e?.dayName||n.dayName||n.dayLabel),a=Jt(r),o=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():Kt[a],i=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",c=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(A=>ir(A)).filter(Boolean),l=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:ar(),f=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,m=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",b=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"";return{id:l,dayIndex:a,dayLabel:Kt[a]||"Lesson",title:o,summary:i,details:c,notes:m,subject:b,position:Number.isFinite(f)?f:null}},me=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let r=Number.isFinite(t.position),a=Number.isFinite(n.position);return r&&a&&t.position!==n.position?t.position-n.position:r&&!a?-1:!r&&a?1:t.title.localeCompare(n.title)}),Ua=e=>{let t=new Map;return e.forEach(n=>{let r=String(n.dayIndex),a=t.get(r)??0;Number.isFinite(n.position)?t.set(r,Math.max(a,n.position+1)):(n.position=a,t.set(r,a+1))}),e},lr=(e,t,n)=>{let r=e.filter(a=>!(a.dayIndex!==t||n&&a.id===n));return r.length?r.reduce((a,o)=>Number.isFinite(o.position)?Math.max(a,o.position):a,-1)+1:0},ve=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,r=it(n),a=Array.isArray(e?.lessons)?Ua(e.lessons.map(i=>Qt(i)).filter(Boolean)):[],o=typeof e?.templateId=="string"?e.templateId.trim():"";return{weekId:n,startDate:r?r.toISOString():"",lessons:me(a),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString(),templateId:o}},cr=()=>{if(!Le())return{};try{let e=Gt(er);if(typeof e!="string"||!e.length)return{};let t=rr(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Wa=e=>{if(Le())try{window.localStorage.setItem(er,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},Va=()=>{if(!Le())return{};try{let e=Gt(tr);if(typeof e!="string"||!e.length)return{};let t=rr(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},za=e=>{if(Le())try{window.localStorage.setItem(tr,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},dr=e=>{if(!e)return null;let n=cr()[e];return n?ve(n,e):null},Xt=(e,t)=>{if(!e||!t)return t;let n=cr();return n[e]=t,Wa(n),t},ot=new Map,$e=null,at=null,Se=!1,_e=null,Ka=()=>{if(typeof _e=="string")return _e;let e=Gt(nr);return _e=typeof e=="string"?e:"",_e},ur=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();_e=t,qa(nr,t)},ae=e=>{e?.templateId&&ur(e.templateId)},fr=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},oe=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(Yt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},mr=async()=>$e?at||(at=$e().then(e=>{let{db:t,getCollection:n}=e||{},r=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),at):null,pr=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:r,db:a}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(a,"plannerPlans",t)},st=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&ot.set(e.weekId,e),e),Ya=e=>{let t=Z();return ve({weekId:e,lessons:e===t?$a:[]},e)},Oe=e=>{let t=dr(e);if(t)return st(t),t;let n=Ya(e);return Xt(e,n),st(n),n},se=async e=>{if(!e?.weekId)return e;let t=ve(e,e.weekId);if(Xt(t.weekId,t),st(t),ae(t),Se||!$e)return t;try{let n=await mr();if(!n)return t;let r=pr(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(r,t,{merge:!0}):await n.updateDoc(r,t),t}catch(n){return fr(n)?(console.warn("Persisting planner data locally due to permission issue",n),Se=!0,t):(console.error("Failed to persist planner plan",n),t)}},yr=(e={})=>{typeof e.ensureFirestore=="function"&&($e=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(Se=e.forceLocal)},Z=(e=new Date)=>{let t=ja(e);return or(t)},qe=(e,t=0)=>{let n=it(e);if(!n||!Number.isFinite(t))return e;let r=new Date(n);return r.setDate(n.getDate()+t*7),or(r)},hr=(e=Z(),t=0)=>{let n=it(e);if(!n)return null;let r=Number.isFinite(t)?t:0,a=Jt(r),o=new Date(n);return o.setDate(n.getDate()+a),o},Zt=(e,{short:t=!1}={})=>{let n=it(e);if(!n)return"";let r=new Date(n);r.setDate(n.getDate()+6);let a=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),o=a.format(n),i=a.format(r),s=n.getFullYear()===r.getFullYear();if(t)return`Week of ${o}`;let c=s?n.getFullYear():`${n.getFullYear()} \u2013 ${r.getFullYear()}`;return`${o} \u2013 ${i}, ${c}`},gr=(e=Z())=>{if(!e)return[];let t=ot.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=dr(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},K=async(e=Z())=>{if(!e)return null;if(ot.has(e)){let t=ot.get(e);return ae(t),t}if(Se||!$e){let t=Oe(e);return ae(t),t}try{let t=await mr();if(!t){let o=Oe(e);return ae(o),o}let n=pr(t,e),r=await t.getDoc(n);if(r.exists()){let o=r.data(),i=ve({...o,weekId:e},e);return Xt(e,i),st(i),Se=!1,ae(i),i}let a=Oe(e);return typeof t.setDoc=="function"&&await t.setDoc(n,a,{merge:!0}),ae(a),a}catch(t){if(fr(t)){console.warn("Falling back to local planner data due to permission issue",t),Se=!0;let r=Oe(e);return ae(r),r}console.error("Failed to load planner data",t);let n=Oe(e);return ae(n),n}},lt=async(e,t)=>{if(!e)return null;let n=await K(e),r=Qt(t);r.position=lr(n?.lessons||[],r.dayIndex);let a={...n,lessons:me([...n?.lessons||[],r]),updatedAt:new Date().toISOString()},o=await se(a);return oe(o),o},en=async(e,t,n={})=>{if(!e||!t)return null;let r=await K(e),a=[...r?.lessons||[]],o=a.findIndex(f=>f.id===t);if(o===-1)return r;let i=a[o],s=Qt({...i,...n,id:t},i);if(s.dayIndex!==i.dayIndex){let f=a.filter((m,b)=>b!==o);s.position=lr(f,s.dayIndex)}a[o]=s;let c={...r,lessons:me(a),updatedAt:new Date().toISOString()},l=await se(c);return oe(l),l},br=async(e,t)=>{if(!e||!t)return null;let n=await K(e),r=(n?.lessons||[]).filter(i=>i.id!==t),a={...n,lessons:me(r),updatedAt:new Date().toISOString()},o=await se(a);return oe(o),o},Er=async(e,t,n)=>{if(!e||!t||!n)return null;let r=n==="up"?-1:n==="down"?1:0;if(!r)return K(e);let a=await K(e),o=[...a?.lessons||[]],i=o.findIndex(T=>T.id===t);if(i===-1)return a;let s=o[i],c=o.filter(T=>T.dayIndex===s.dayIndex);if(c.length<=1)return a;let f=me(c).map(T=>T.id),m=f.indexOf(t);if(m===-1)return a;let b=m+r;if(b<0||b>=f.length)return a;let[A]=f.splice(m,1);f.splice(b,0,A);let D=new Map(f.map((T,p)=>[T,p])),R=o.map(T=>{if(T.dayIndex!==s.dayIndex)return T;let p=D.get(T.id);return typeof p=="number"?{...T,position:p}:T}),M={...a,lessons:me(R),updatedAt:new Date().toISOString()},N=await se(M);return oe(N),N},tn=async(e,t,n)=>{if(!e||!t)return null;let r=await K(e),a=[...r?.lessons||[]],o=a.findIndex(m=>m.id===t);if(o===-1)return r;let i=ir(n);if(!i)return r;let s=a[o],c={...s,details:[...s.details||[],i]};a[o]=c;let l={...r,lessons:me(a),updatedAt:new Date().toISOString()},f=await se(l);return oe(f),f},nn=async(e,t)=>{if(!e||!t)return null;let n=await K(e),r=(n?.lessons||[]).map(i=>({title:i.title,summary:i.summary,dayIndex:i.dayIndex,notes:typeof i.notes=="string"?i.notes:"",subject:typeof i.subject=="string"?i.subject:"",details:(i.details||[]).map(s=>({badge:s.badge,text:s.text}))})),a=ve({weekId:t,lessons:r,templateId:typeof n?.templateId=="string"?n.templateId:""},t);a.updatedAt=new Date().toISOString();let o=await se(a);return oe(o),o},wr=async e=>{if(!e)return null;let t=await K(e);if(!t)return null;let n={...t,lessons:[],updatedAt:new Date().toISOString()},r=await se(n);return oe(r),r},Sr=e=>{if(!e||typeof e!="object")return null;let t=Jt(Number.isFinite(e.dayIndex)?e.dayIndex:sr(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",r=typeof e.summary=="string"?e.summary:"",a=typeof e.notes=="string"?e.notes:"",o=typeof e.subject=="string"?e.subject.trim():"",i=Array.isArray(e.details)?e.details.map(s=>{if(!s||typeof s!="object")return null;let c=typeof s.badge=="string"?s.badge:"",l=typeof s.text=="string"?s.text:"";return l.trim()?{badge:c,text:l}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:r,details:i,notes:a,subject:o}},Te=()=>{let e=Va(),t={};return Object.keys(e).forEach(n=>{let r=e[n];if(!r||typeof r!="object")return;let a=typeof r.name=="string"&&r.name.trim()?r.name.trim():n,o=Array.isArray(r.lessons)?r.lessons.map(i=>Sr(i)).filter(Boolean):[];t[a]={name:a,lessons:o,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:""}}),t},Lr=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let r=Te(),a=Array.isArray(t.lessons)?t.lessons.map(o=>Sr(o)).filter(Boolean):[];return r[n]={name:n,lessons:a,updatedAt:new Date().toISOString()},za(r),r[n]},ct=()=>Ka(),rn=async(e,t)=>{if(!e||!t)return null;let r=Te()[t];if(!r)return K(e);ur(t);let a=Array.isArray(r.lessons)?r.lessons.map(s=>({dayIndex:s.dayIndex,title:s.title,summary:s.summary,notes:typeof s.notes=="string"?s.notes:"",subject:typeof s.subject=="string"?s.subject:"",details:Array.isArray(s.details)?s.details.map(c=>({badge:c.badge,text:c.text})):[]})):[],o=ve({weekId:e,lessons:a,templateId:t},e);o.updatedAt=new Date().toISOString();let i=await se(o);return oe(i),i}});var Fs=Ca(()=>{Da();Na();Qn();Zn();Pa();Ma();Ba();vr();Un();function Ga(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let r=document.querySelectorAll("[data-open-reminder-modal]");if(!r.length)return;if(!e){let u=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};r.forEach(g=>{g.addEventListener("click",P=>{if(P.preventDefault(),typeof window<"u"){let k="#reminders";window.location.hash!==k&&(window.location.hash=k),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{u()})})});return}let a=e.querySelector("[data-reminder-modal-backdrop]"),o=e.querySelectorAll("[data-close-modal]"),i=document.getElementById("mainContent"),s=document.querySelector('nav[aria-label="Primary"]'),c=[i,s],l=e.querySelector('[role="dialog"]')??e,f=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],m=null,b=()=>{if(!(l instanceof HTMLElement))return[];let u=l.querySelectorAll(f.join(","));return Array.from(u).filter(g=>{let P=g instanceof HTMLElement,k=typeof SVGElement<"u"&&g instanceof SVGElement;if(!P&&!k||g.getAttribute("aria-hidden")==="true"||"disabled"in g&&g.disabled||g.hidden||g.closest("[hidden]"))return!1;let O=g.getBoundingClientRect();return O.width>0&&O.height>0})},A=()=>{let u=b(),g=u.find(P=>P.hasAttribute("data-autofocus")||P.hasAttribute("autofocus"))||(n&&u.includes(n)?n:null)||u[0];if(g&&typeof g.focus=="function"){g.focus({preventScroll:!0});return}l instanceof HTMLElement&&typeof l.focus=="function"&&l.focus({preventScroll:!0})},D=u=>{l instanceof HTMLElement&&(!(u.target instanceof Node)||!l.contains(u.target))&&(u.stopPropagation(),A())},R=u=>{if(u.key!=="Tab")return;let g=b();if(!g.length){u.preventDefault(),l instanceof HTMLElement&&l.focus({preventScroll:!0});return}let P=g[0],k=g[g.length-1],O=document.activeElement;if(u.shiftKey){(!l.contains(O)||O===P)&&(u.preventDefault(),k.focus());return}(!l.contains(O)||O===k)&&(u.preventDefault(),P.focus())},M=u=>{c.forEach(g=>{g&&(u?g.setAttribute("inert",""):g.removeAttribute("inert"))})},N=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),M(!1),document.removeEventListener("keydown",T,!0),e.removeEventListener("keydown",R,!0),e.removeEventListener("focusin",D,!0),m&&typeof m.focus=="function"&&m.focus(),m=null},T=u=>{u.key==="Escape"&&(u.preventDefault(),N())},p=({triggerElement:u}={})=>{u&&typeof u.focus=="function"?m=u:m=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),M(!0),document.addEventListener("keydown",T,!0),e.addEventListener("keydown",R,!0),e.addEventListener("focusin",D,!0),window.requestAnimationFrame(()=>{A()})},y=(u,g={})=>{try{document.dispatchEvent(new CustomEvent(u,{detail:g}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let P=document.createEvent("CustomEvent");P.initCustomEvent(u,!0,!0,g),document.dispatchEvent(P)}}},w=(u={})=>{y("cue:cancelled",u)};r.forEach(u=>{u.addEventListener("click",g=>{g.preventDefault();let k={trigger:g.currentTarget instanceof HTMLElement?g.currentTarget:null,mode:"create"};y("cue:prepare",k),y("cue:open",k)})}),o.forEach(u=>{u.addEventListener("click",g=>{g.preventDefault(),w({trigger:u,reason:"button"})})}),e.addEventListener("click",u=>{u.target===e&&w({reason:"backdrop"})}),a?.addEventListener("click",u=>{u.target===a&&w({reason:"backdrop"})}),document.addEventListener("cue:open",u=>{let g=u?.detail?.trigger,P=g instanceof HTMLElement?g:null;p({triggerElement:P})});let S=()=>{N()};document.addEventListener("cue:close",S),document.addEventListener("cue:cancelled",S);let v=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&v instanceof HTMLElement&&t.addEventListener("submit",u=>{u.preventDefault(),!v.matches(":disabled")&&v.click()}),v instanceof HTMLElement&&document.addEventListener("reminder:save",u=>{let g=u?.detail?.trigger;g&&g!==v||v.matches(":disabled")||v.click()})}Ga();function an(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var Tr=null;function Ja(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function Ur(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Qa(e){typeof document>"u"||!e||(window.clearTimeout(Tr),Tr=window.setTimeout(()=>{let t=Ja(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Ce(e){let t=e||Ur();t&&Qa(t)}function Xa(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Ce()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",r=>{if(!(r.currentTarget instanceof HTMLAnchorElement))return;let a=r.currentTarget.getAttribute("href")||"";if(!a.startsWith("#"))return;r.preventDefault();let o=a||"#dashboard",i=o.replace("#","")||"dashboard";window.location.hash!==o&&(window.location.hash=o),typeof window.renderRoute=="function"&&window.renderRoute(),Ce(i)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Ce()}Xa();var xr=document.getElementById("settings-save-button"),dt=document.getElementById("settings-save-confirmation"),H=document.getElementById("live-status"),on=null,pe=document.getElementById("resourcePlannerStatus"),sn=null;document.addEventListener("planner:reminderCreated",e=>{if(!H)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",r=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",a=r?`Reminder saved for ${r}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";H.textContent=a});xr&&dt&&xr.addEventListener("click",e=>{e.preventDefault(),dt.classList.remove("hidden"),dt.textContent="Settings saved!",H&&(H.textContent="Settings saved!"),on&&window.clearTimeout(on),on=window.setTimeout(()=>{dt.classList.add("hidden")},3e3)});function Za(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Ce(t),H&&(H.textContent="Opening planner to add a new lesson."),_t(),window.requestAnimationFrame(()=>{let r=ma();r&&typeof r.catch=="function"&&r.catch(a=>{console.error("Planner quick action failed to start new lesson flow",a)})})}function eo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Za)})}eo();function ln(e,{tone:t="success"}={}){pe&&(pe.textContent=e,pe.classList.remove("hidden"),pe.classList.remove("text-success","text-error"),pe.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(sn&&window.clearTimeout(sn),sn=window.setTimeout(()=>{pe.classList.add("hidden"),pe.textContent=""},4e3))),H&&(H.textContent=e)}function Wr(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function to(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let r=n.getAttribute("data-resource-title")?.trim(),a=n.getAttribute("data-resource-link")?.trim();if(!r||!a)return;let o="#planner";window.location.hash!==o&&(window.location.hash=o),typeof window.renderRoute=="function"&&window.renderRoute(),Ce("planner"),_t(),await kn();let i=`${r} \u2014 ${a}`,s=ts(),c=null;try{if(s)c=await tn(E,s,{badge:"Resource",text:i});else{let l=Wr("lesson"),f=L?.lessons?.[0]?.dayLabel||"Monday";c=await lt(E,{id:l,dayName:f,title:r,summary:`Resource link: ${a}`,details:[{badge:"Resource",text:i}]}),c&&(B=l)}if(c){L=c,W(c),U(c,E),z(c);let l=s?`Added "${r}" to your selected lesson.`:`Created a lesson for "${r}" in this week's planner.`;ln(l);return}ln("Unable to save that resource to the planner right now.",{tone:"error"})}catch(l){console.error("Failed to save resource to planner",l),ln("Unable to save that resource to the planner right now.",{tone:"error"})}}function no(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",to)})}no();var Vr=document.getElementById("reminder-title"),ro=document.getElementById("reminderText"),Q=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),r=e.querySelector(".modal-backdrop button"),a=document.getElementById("modal-title");return Xn({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:r instanceof HTMLElement?r:null,titleInput:Vr,modalTitle:a instanceof HTMLElement?a:null,defaultTitle:Wt,editTitle:Vt})})();Q?.setEditMode(!1);var ao=()=>{let e=!!Vr;if(!!ro)return nt({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?nt(n):nt({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};ao().catch(e=>{console.error("Failed to initialise reminders",e)});var pn=Vn(),cn=Wn({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{pn?.handleSessionChange(e)}});if(cn?.supabase){pn?.setSupabaseClient(cn.supabase);try{cn.supabase.auth.getSession().then(({data:e})=>{pn?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var ne=document.getElementById("cues-list"),dn=document.getElementById("pinnedNotesCard"),Ie=document.getElementById("pinnedNotesList"),Ee=document.getElementById("cue-form"),J=Ee?.querySelector("#cue-id-input"),oo=Q?.defaultTitle||Q?.modalTitle?.textContent?.trim()||Wt,Ks=Q?.editTitle||Vt,At=document.getElementById("tab-cues"),kt=document.getElementById("tab-daily"),Ke=document.getElementById("cues-view"),Ye=document.getElementById("daily-list-view"),Ar=document.getElementById("daily-list-header"),zr=document.getElementById("quick-add-form"),V=document.getElementById("quick-add-input"),Y=document.getElementById("daily-voice-btn"),ce=document.getElementById("daily-tasks-container"),yn=document.getElementById("clear-completed-btn"),It=document.getElementById("daily-list-permission-notice"),j=document.getElementById("plannerCards")||document.getElementById("planner-grid"),kr=document.getElementById("planner-week"),so=document.getElementById("planner-prev"),io=document.getElementById("planner-next"),lo=document.getElementById("planner-today"),co=document.getElementById("planner-copy-week"),uo=document.getElementById("planner-clear-week"),fo=document.getElementById("planner-duplicate-btn"),mo=document.getElementById("planner-new-lesson-btn"),ie=document.getElementById("planner-template-select"),Kr=document.getElementById("planner-template-save-btn"),Ct=document.querySelector("[data-planner-text-size]"),We=document.getElementById("planner-subject-filter"),un=document.querySelector("[data-planner-card-panel]"),De=document.getElementById("planner-detail-panel"),ut=De?.querySelector("[data-planner-detail-empty]"),ft=De?.querySelector("[data-planner-detail-content]"),mt=document.getElementById("planner-detail-day"),pt=document.getElementById("planner-detail-title"),yt=document.getElementById("planner-detail-summary"),ht=document.getElementById("planner-detail-subject"),gt=document.getElementById("planner-detail-details"),po=document.getElementById("planner-detail-actions"),q=document.querySelector('section[data-route="planner"]'),xe=q?Array.from(q.querySelectorAll("[data-planner-panel]")):[],yo=q?Array.from(q.querySelectorAll("[data-planner-panel-toggle]")):[],ho=q?Array.from(q.querySelectorAll("[data-planner-panel-close]")):[],Ae=q?.querySelector("[data-planner-support-collapse]");function go(){if(!q||!xe.length)return;let e=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(min-width: 1024px)"):null,t=l=>xe.find(f=>f.getAttribute("data-planner-panel")===l)||null,n=l=>{l&&window.requestAnimationFrame(()=>{typeof l.scrollIntoView=="function"&&l.scrollIntoView({behavior:"smooth",block:"start"})})},r=l=>{if(!Ae)return;let f=Ae.getAttribute("data-expanded-label")||"Hide panels",m=Ae.getAttribute("data-collapsed-label")||"Show panels",b=l!=="collapsed";Ae.textContent=b?f:m,Ae.setAttribute("aria-expanded",String(b))},a=l=>{if(q.dataset.plannerSupportState=l,r(l),e?.matches){let f=l==="collapsed";xe.forEach(m=>{m.hidden=f})}},o=()=>{let l=q.dataset.plannerSupportState==="collapsed"?"expanded":"collapsed";a(l)},i=l=>{if(l){let f=q.dataset.plannerSupportState||"expanded";q.dataset.plannerSupportState=f,r(f),xe.forEach(m=>{m.hidden=f==="collapsed"});return}q.dataset.plannerSupportState="collapsed",r("collapsed"),xe.forEach(f=>{f.hidden=!0})},s=l=>{if(!l)return;let f=t(l);if(!f)return;if(e?.matches){q.dataset.plannerSupportState==="collapsed"&&a("expanded"),f.hidden=!1,n(f);return}if(f.hidden){xe.forEach(b=>{b.hidden=b!==f}),f.hidden=!1,n(f);return}f.hidden=!0},c=l=>{if(!l)return;let f=t(l);f&&(f.hidden=!0)};if(yo.forEach(l=>{l.addEventListener("click",f=>{f.preventDefault(),s(l.getAttribute("data-planner-panel-toggle"))})}),ho.forEach(l=>{l.addEventListener("click",f=>{f.preventDefault(),c(l.getAttribute("data-planner-panel-close"))})}),Ae?.addEventListener("click",l=>{l.preventDefault(),o()}),e){i(e.matches);let l=f=>{i(f.matches)};typeof e.addEventListener=="function"?e.addEventListener("change",l):typeof e.addListener=="function"&&e.addListener(l)}}go();var bt=document.querySelector("[data-mobile-notes-text-size]"),fn=document.querySelector(".mobile-panel--notes"),Yr="plannerTextSizePreference",Dt="default",Ft=new Set(["small","default","large"]),bo=["planner-text-small","planner-text-default","planner-text-large"],Gr="mobileNotesTextSizePreference",Pt="default",Ht=new Set(["small","default","large"]),Eo=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function hn(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function wo(){if(typeof localStorage>"u")return Dt;let e=localStorage.getItem(Yr);return e&&Ft.has(e)?e:Dt}function So(e){typeof localStorage>"u"||!Ft.has(e)||localStorage.setItem(Yr,e)}function Jr(e){if(!un)return;let t=Ft.has(e)?e:Dt;bo.forEach(n=>un.classList.remove(n)),un.classList.add(`planner-text-${t}`)}var Qr=wo();Jr(Qr);hn(Ct)&&(Ct.value=Qr);function Xr(){if(typeof localStorage>"u")return Pt;let e=localStorage.getItem(Gr);return e&&Ht.has(e)?e:Pt}function Lo(e){typeof localStorage>"u"||!Ht.has(e)||localStorage.setItem(Gr,e)}function Zr(e){if(!fn)return;let t=Ht.has(e)?e:Pt;Eo.forEach(n=>fn.classList.remove(n)),fn.classList.add(`mobile-panel--notes-size-${t}`)}var ea=Xr();Zr(ea);bt instanceof HTMLSelectElement&&(bt.value=ea,bt.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:Pt;if(!Ht.has(t)){bt.value=Xr();return}Lo(t),Zr(t)}));var vo=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function To(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=vo.findIndex(r=>r.toLowerCase()===t.toLowerCase());return n>=0?n:0}function xo(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function Ao(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),r=document.getElementById("planner-modal-description"),a=document.getElementById("planner-modal-error"),o=document.getElementById("planner-modal-submit"),i=document.getElementById("planner-lesson-day"),s=document.getElementById("planner-lesson-title"),c=document.getElementById("planner-lesson-summary"),l=document.getElementById("planner-lesson-subject"),f=document.getElementById("planner-detail-badge"),m=document.getElementById("planner-detail-text"),b=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(o instanceof HTMLElement)||!(i instanceof HTMLSelectElement)||!(s instanceof HTMLInputElement)||!(c instanceof HTMLTextAreaElement))return null;let A=t.querySelector("[data-planner-lesson-section]"),D=t.querySelector("[data-planner-summary-section]"),R=t.querySelector("[data-planner-detail-section]"),M=t.querySelector("[data-planner-duplicate-section]"),N=e.querySelector("[data-planner-modal-dialog]"),T=e.querySelector("[data-planner-modal-backdrop]"),p=e.querySelectorAll("[data-planner-modal-close]"),y=document.getElementById("mainContent"),w=document.querySelector('nav[aria-label="Primary"]'),S=(()=>{let d=[],h=e.parentElement;return w instanceof HTMLElement&&d.push(w),h instanceof HTMLElement?d.push(...Array.from(h.children).filter(x=>x instanceof HTMLElement&&x!==e)):y instanceof HTMLElement&&(y.contains(e)?d.push(...Array.from(y.children).filter(x=>x instanceof HTMLElement&&!x.contains(e))):d.push(y)),d})(),v=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],u={mode:"add",lessonId:null,trigger:null},g=null,P=null,k=d=>{g=d instanceof HTMLElement?d:null},O=d=>{S.forEach(h=>{h&&(d?h.setAttribute("inert",""):h.removeAttribute("inert"))})},Hn=()=>{if(!(N instanceof HTMLElement))return[];let d=N.querySelectorAll(v.join(","));return Array.from(d).filter(h=>{if(h.closest('[aria-hidden="true"]')||"disabled"in h&&h.disabled)return!1;let x=h.getBoundingClientRect();return x.width>0&&x.height>0})},Rn=()=>{let d=Hn(),h=(g&&d.includes(g)?g:null)||d[0]||N;h&&typeof h.focus=="function"&&h.focus({preventScroll:!0})},On=d=>{N instanceof HTMLElement&&(N.contains(d.target)||Rn())},va=d=>{if(d.key!=="Tab")return;let h=Hn();if(!h.length){d.preventDefault();return}let x=h[0],Fe=h[h.length-1];if(d.shiftKey&&document.activeElement===x){d.preventDefault(),Fe.focus();return}!d.shiftKey&&document.activeElement===Fe&&(d.preventDefault(),x.focus())},_n=d=>{if(d.key==="Escape"){d.preventDefault(),X();return}va(d)},$n=()=>{a&&(a.textContent="",a.classList.add("hidden"),a.setAttribute("aria-hidden","true"))},re=d=>{a&&(a.textContent=d,a.classList.remove("hidden"),a.removeAttribute("aria-hidden"))},qn=d=>{o.disabled=!!d,o.classList.toggle("loading",!!d)},F=(d,h)=>{d instanceof HTMLElement&&(d.classList.toggle("hidden",!h),h?d.removeAttribute("aria-hidden"):d.setAttribute("aria-hidden","true"))},Ze=d=>{[i,s,c,l].forEach(h=>{h instanceof HTMLElement&&(h.disabled=!!d,h.classList.toggle("opacity-60",!!d),h.classList.toggle("cursor-not-allowed",!!d))})},Be=()=>{t.reset(),$n(),k(null),Ze(!1),l instanceof HTMLInputElement&&(l.value=""),f instanceof HTMLInputElement&&(f.value=""),(m instanceof HTMLTextAreaElement||m instanceof HTMLInputElement)&&(m.value=""),b instanceof HTMLInputElement&&(b.value="")},et=({title:d,description:h,action:x})=>{n&&(n.textContent=d||"Plan lesson"),r&&(r.textContent=h||""),o.textContent=x||"Save lesson"},tt=({trigger:d}={})=>{u.trigger=d instanceof HTMLElement?d:null,P=u.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),O(!0),document.addEventListener("keydown",_n,!0),e.addEventListener("focusin",On,!0),window.requestAnimationFrame(()=>{Rn()})},X=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),O(!1),document.removeEventListener("keydown",_n,!0),e.removeEventListener("focusin",On,!0);let d=u.trigger||P;u.mode="add",u.lessonId=null,u.trigger=null,k(null),Be(),d&&typeof d.focus=="function"&&d.focus({preventScroll:!0})},Ta=({defaultDay:d="Monday",trigger:h}={})=>{u.mode="add",u.lessonId=null,Be(),F(A,!0),F(D,!0),F(R,!1),F(M,!1),Ze(!1);let x=typeof d=="string"&&d.trim()?d.trim():"Monday";i.value=x,i.value!==x&&(i.value="Monday"),s.value=x?`${x} lesson`:"",c.value="",l instanceof HTMLInputElement&&(l.value=""),et({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),k(s),tt({trigger:h})},xa=({lesson:d,trigger:h}={})=>{if(!d)return;u.mode="edit",u.lessonId=d.id,Be(),F(A,!0),F(D,!0),F(R,!1),F(M,!1),Ze(!1);let x=d.dayLabel||d.dayName||"Monday";i.value=x,i.value!==x&&(i.value="Monday"),s.value=d.title||"",c.value=d.summary||"",l instanceof HTMLInputElement&&(l.value=d.subject||""),et({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),k(s),tt({trigger:h})},Aa=({lesson:d,trigger:h}={})=>{if(!d)return;u.mode="detail",u.lessonId=d.id,Be(),F(A,!0),F(D,!0),F(R,!0),F(M,!1),Ze(!0);let x=d.dayLabel||d.dayName||"Monday";i.value=x,i.value!==x&&(i.value="Monday"),s.value=d.title||"",c.value=d.summary||"",l instanceof HTMLInputElement&&(l.value=d.subject||""),f instanceof HTMLInputElement&&(f.value=""),(m instanceof HTMLTextAreaElement||m instanceof HTMLInputElement)&&(m.value=""),et({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),k(m instanceof HTMLElement?m:null),tt({trigger:h})},ka=({suggestedWeekId:d="",trigger:h}={})=>{u.mode="duplicate",u.lessonId=null,Be(),F(A,!1),F(D,!1),F(R,!1),F(M,!0),b instanceof HTMLInputElement&&(b.value=d),et({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),k(b instanceof HTMLElement?b:null),tt({trigger:h})},Ia=async d=>{d.preventDefault(),$n(),qn(!0);try{if(u.mode==="duplicate"){let _=b?.value?.trim();if(!_){re("Enter the Monday date for the destination week.");return}if(_===E){re("Choose a different week to duplicate into.");return}let fe=await nn(E,_);fe&&(E=_,L=fe,W(fe),An(_),U(fe,_),z(fe),X());return}if(u.mode==="detail"){if(!u.lessonId){re("Select a lesson before adding details.");return}let _=m?.value?.trim();if(!_){re("Add text for this detail.");return}let fe=f?.value?.trim()||"",Re=await tn(E,u.lessonId,{badge:fe,text:_});Re&&(L=Re,W(Re),U(Re,E),z(Re),X());return}let h=i.value.trim(),x=s.value.trim(),Fe=c.value.trim(),jn=l?.value?.trim()||"";if(!h){re("Choose a day for this lesson.");return}if(!x){re("Enter a lesson title.");return}if(u.mode==="edit"){if(!u.lessonId){re("Select a lesson to edit.");return}let _=await en(E,u.lessonId,{dayName:h,title:x,summary:Fe,subject:jn});_&&(L=_,W(_),U(_,E),z(_),X());return}let He=await lt(E,{dayName:h,title:x,summary:Fe,subject:jn});He&&(L=He,W(He),U(He,E),z(He),X())}catch(h){console.error("Failed to save planner change",h),re("Unable to save changes right now. Please try again.")}finally{qn(!1)}};return t.addEventListener("submit",Ia),p.forEach(d=>{d.addEventListener("click",h=>{h.preventDefault(),X()})}),e.addEventListener("click",d=>{d.target===e&&X()}),T?.addEventListener("click",d=>{d.target===T&&X()}),{openAddLesson:Ta,openEditLesson:xa,openAddDetail:Aa,openDuplicatePlan:ka,close:X}}var Ir=document.getElementById("remindersCount"),de=typeof document<"u"?Ao():null,Cr=document.getElementById("plannerCount"),Dr=document.getElementById("plannerSubtitle"),he="all",le=he,Ys=document.getElementById("resourcesCount"),Gs=document.getElementById("templatesCount"),Et=document.getElementById("dailySnapshotList"),wt=document.getElementById("todaysFocusList"),ee=document.getElementById("weekAtAGlanceList"),te=null;ee&&(te=document.createElement("li"),te.dataset.emptyState="week",te.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",te.textContent="No upcoming events this week.");var Pr=()=>{if(!ee||!te)return;ee.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?ee.contains(te)||ee.appendChild(te):ee.contains(te)&&ee.removeChild(te)};ee&&(Pr(),new MutationObserver(Pr).observe(ee,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var mn=e=>{dn&&(e?dn.classList.remove("hidden"):dn.classList.add("hidden"))},Ge={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},Nr=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),Mr=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),Tt=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",xn=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},ko=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),ta=e=>{if(!e)return"";if(Nr)try{return Nr.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},Io=e=>{if(!e)return"";if(Mr)try{return Mr.format(e)}catch{}return e.toLocaleDateString()},na=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Ge,t)?t:"medium"},Br=e=>{let t=na(e);return Ge[t]?.rank??Ge.medium.rank},Co=e=>{let t=na(e);return Ge[t]??Ge.medium},Fr=e=>{let t=xn(e);return t?t.getTime():Number.POSITIVE_INFINITY};function ra(e=[]){if(!Et)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(r=>({reminder:r,date:xn(r)})).filter(({date:r})=>r&&ko(r,t)).sort((r,a)=>r.date.getTime()-a.date.getTime());if(!n.length){Et.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Et.innerHTML="",n.forEach(({reminder:r,date:a})=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=Tt(r),o.appendChild(i);let s=ta(a),c=document.createElement("p");c.className="text-xs text-base-content/70",c.textContent=s?`Due ${s}`:"Due today",o.appendChild(c),Et.appendChild(o)})}function aa(e=[]){if(!wt)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,r)=>{let a=Br(n)-Br(r);if(a!==0)return a;let o=Fr(n)-Fr(r);return o!==0?o:Tt(n).localeCompare(Tt(r),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){wt.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}wt.innerHTML="",t.forEach(n=>{let r=document.createElement("li");r.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let a=document.createElement("div");a.className="flex items-center justify-between gap-3";let o=document.createElement("p");o.className="font-semibold text-base-content",o.textContent=Tt(n),a.appendChild(o);let i=Co(n),s=document.createElement("span");s.className=i.badgeClass,s.textContent=i.badgeLabel,a.appendChild(s),r.appendChild(a);let c=xn(n),l=document.createElement("p");if(l.className="text-xs text-base-content/70",c){let f=ta(c),m=Io(c),b=[];f&&b.push(`Due ${f}`),m&&b.push(m),l.textContent=b.length?b.join(" \u2022 "):"Due soon"}else l.textContent="No due date";r.appendChild(l),wt.appendChild(r)})}var Do=e=>{if(!Ir)return;let t=Array.isArray(e)?e.length:0;Ir.textContent=String(t)},Po=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Do(t),ra(t),aa(t)};document.addEventListener("memoryCue:remindersUpdated",Po);ra();aa();var gn=Kn(zn),No={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},St=null,Mo=3,Hr=120;function Bo(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Hr?t:`${t.slice(0,Hr-1)}\u2026`:""}function Fo(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let r=n.trim().toLowerCase();return r==="true"||r==="1"||r==="yes"}return!1})}function Rr(e){if(!Ie)return;let t=Array.isArray(e)?e:[];if(!t.length){Ie.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',mn(!1);return}let n=t.filter(o=>Fo(o));if(!n.length){Ie.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',mn(!1);return}mn(!0);let a=n.slice(0,Mo).map(o=>{let i=I(we(o,"title")||"Untitled Cue"),s=we(o,"details"),c=I(Bo(s)),l=c?`<p class="mt-1 text-sm text-base-content/70">${c}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${i}</p>
          ${l}
        </li>
      `}).join("");Ie.innerHTML=a}function bn(e,{tone:t="muted"}={}){if(!ne)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),ne.innerHTML=`<p class="${n.join(" ")}">${I(e)}</p>`}function Ho(e){if(!ne)return;if(!Array.isArray(e)||e.length===0){bn("No cues yet.");return}let t=e.map(n=>{let r=I(we(n,"title")||"Untitled Cue"),a=I(we(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${r}</h2>
            ${a?`<p>${a}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${I(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${I(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");ne.innerHTML=t}async function Xe(){return St||(St=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:r,enableIndexedDbPersistence:a,collection:o,doc:i,getDoc:s,addDoc:c,updateDoc:l,getDocs:f,query:m,orderBy:b,serverTimestamp:A,setDoc:D,arrayUnion:R}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),M=t(),N=M&&M.length?M[0]:e(No),T=n(N);(function(){let w=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;w&&(w.__persistenceInitialized__||(w.__persistenceInitialized__=!0,(async()=>{try{await r(T),console.info("[Firestore] Persistence: multi-tab enabled")}catch(S){if(S&&S.code==="failed-precondition")try{await a(T),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(v){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",v?.code||v)}else S&&S.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",S?.code||S)}})()))})();let p=o(T,"cues");return{db:T,cuesCollection:p,getCollection:o,doc:i,getDoc:s,addDoc:c,updateDoc:l,getDocs:f,query:m,orderBy:b,serverTimestamp:A,setDoc:D,arrayUnion:R}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),St)}async function Ro(){let e=await Xe(),{getDocs:t,cuesCollection:n,query:r,orderBy:a}=e,o=r&&a?r(n,a("createdAt","desc")):n;return(await t(o)).docs.map(s=>({id:s.id,...s.data()}))}async function Oo(e){if(!e)return null;let t=await Xe(),{db:n,doc:r,getDoc:a}=t,o=r(n,"cues",e),i=await a(o);return i.exists()?{id:i.id,...i.data()}:null}async function oa(){if(!(!ne&&!Ie))try{let e=await Ro();Ho(e),Rr(e)}catch(e){console.error("Failed to load cues",e),$t(e)?bn("Sign in to view your cues.",{tone:"muted"}):bn("Unable to load cues right now.",{tone:"error"}),Rr([])}}function _o(e){!Ee||!J||(Yn(e,gn),J.value=e?.id||"",Q?.setEditMode(!0),Q?.show({mode:"edit"}))}async function $o(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let r=await Oo(n);if(!r)return;_o(r)}catch(r){console.error("Failed to prepare cue for editing",r)}}async function qo(e){if(e.preventDefault(),!Ee||!J)return;let t=J.value.trim(),n=Jn(gn);try{let r=await Xe(),{db:a,doc:o,addDoc:i,updateDoc:s,cuesCollection:c,serverTimestamp:l}=r,f=typeof l=="function"?l():null;if(t){let m=o(a,"cues",t),b={...n};f&&(b.updatedAt=f),await s(m,b)}else{let m={...n};f&&(m.createdAt=f,m.updatedAt=f),await i(c,m)}await oa(),Gn(gn,J,Q?.modalTitle??null,oo),await Q?.hide({reason:"form-submit"})}catch(r){console.error("Failed to save cue",r)}}async function jo(){!Ee||!J||!ne||(ne.addEventListener("click",$o),Ee.addEventListener("submit",qo))}Ee&&J&&(document.addEventListener("cue:prepare",()=>{J.value="",Q?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{J.value="",Q?.setEditMode(!1)}));Ee&&J&&ne&&jo().catch(e=>{console.error("Failed to initialise cue editing",e)});(ne||Ie)&&oa();var C=[],Lt=null,ge=!1,Je=Z(),ze=!1,E=Je,L=null,Ve=null,B=null,Pe=Te(),Nt=new Map,Uo=800,Wo=1500,En={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},sa=new Set(["saving","saved","error"]),ia="plannerNotesOpenState",ye=Vo();function Vo(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(ia);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function zo(){if(!(typeof localStorage>"u"))try{localStorage.setItem(ia,JSON.stringify(ye))}catch(e){console.warn("Unable to persist planner notes state",e)}}function Ko(e){return e?!!ye?.[e]:!1}function Yo(e,t){if(e){if(t)ye={...ye,[e]:!0};else if(ye?.[e]){let n={...ye};delete n[e],ye=n}zo()}}var Go=e=>{if(!Cr)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=gr(Je),Cr.textContent=String(t.length)};function U(e,t){if(Go(e),Dr){let n=Zt(e?.weekId||t,{short:!0});Dr.textContent=n||""}}function Mt(e,{tone:t="muted"}={}){if(!j)return;B=null,la(null);let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),j.innerHTML=`<p class="${n.join(" ")}">${I(e)}</p>`}function An(e){if(!kr)return;let t=Zt(e);kr.textContent=t||""}function Rt(e){if(!ie)return;Pe=Te();let t=Object.values(Pe).sort((o,i)=>o.name.localeCompare(i.name)),n=t.length>0,a=[`<option value="">${I(n?"Select template":"No templates saved")}</option>`];t.forEach(o=>{let i=o.name;a.push(`<option value="${I(i)}">${I(i)}</option>`)}),ie.innerHTML=a.join(""),ie.disabled=!n,e&&Pe[e]?ie.value=e:ie.value=""}function z(e){let t=e?.templateId||ct();Rt(t)}function Ot(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function Jo(e){let t=Ot(e);return t?t.toLowerCase():""}function Qo(e){if(!We)return;let t=new Map;e.forEach(r=>{let a=Ot(r);if(!a)return;let o=a.toLowerCase();t.has(o)||t.set(o,a)}),(t.size===0||le!==he&&!t.has(le))&&(le=he);let n=[`<option value="${he}">All subjects</option>`];t.forEach((r,a)=>{n.push(`<option value="${I(a)}">${I(r)}</option>`)}),We.innerHTML=n.join(""),We.value=le,We.disabled=t.size===0}function Xo(e){return Array.isArray(e)?le===he?e:e.filter(t=>Jo(t)===le):[]}function Zo(e){le=typeof e?.target?.value=="string"?e.target.value:he,W(L)}function la(e){if(!De)return;if(!e){De.removeAttribute("data-lesson-id"),mt&&(mt.textContent=""),pt&&(pt.textContent=""),yt&&(yt.textContent=""),ht&&(ht.innerHTML=""),gt&&(gt.innerHTML=""),ut instanceof HTMLElement&&ut.classList.remove("hidden"),ft instanceof HTMLElement&&ft.classList.add("hidden");return}let t=typeof e.id=="string"?e.id:"";De.setAttribute("data-lesson-id",t);let n=typeof e.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(mt&&(mt.textContent=n),pt&&(pt.textContent=e.title||n||"Lesson"),yt){let r=typeof e.summary=="string"&&e.summary.trim()?e.summary.trim():"No summary added yet.";yt.textContent=r}if(ht){let r=Ot(e);ht.innerHTML=r?`<span class="badge badge-outline badge-sm text-base-content/80">${I(r)}</span>`:'<p class="text-xs text-base-content/60">No subject tagged.</p>'}if(gt){let r=Array.isArray(e.details)?e.details.filter(a=>typeof a?.text=="string"&&a.text.trim().length>0).map(a=>`
              <div class="rounded-xl border border-base-200/80 bg-base-100/80 p-3">
                <div class="flex flex-wrap items-start gap-2">
                  ${a?.badge?`<span class="badge badge-outline badge-xs text-base-content/70">${I(a.badge)}</span>`:""}
                  <p class="text-sm text-base-content/80">${I(a.text)}</p>
                </div>
              </div>
            `).join(""):"";gt.innerHTML=r||'<p class="text-sm text-base-content/60">No lesson details yet.</p>'}ut instanceof HTMLElement&&ut.classList.add("hidden"),ft instanceof HTMLElement&&ft.classList.remove("hidden")}async function es(e,t){let r=(Array.isArray(e?.lessons)?e.lessons:[]).length>0,a=typeof e?.templateId=="string"&&e.templateId.trim().length>0;if(r||a)return e;let o=ct();if(!o||(Pe[o]||(Pe=Te()),!Pe[o]))return e;try{return await rn(t,o)||e}catch(i){return console.error("Failed to auto apply preferred planner template",i),e}}function W(e){if(!j)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(Qo(t),!t.length){Mt("No lessons saved for this week yet.");return}let n=Xo(t);if(!n.length){Mt("No lessons saved for this subject yet.");return}let r=n.map(o=>typeof o.id=="string"&&o.id?o.id:"").filter(o=>!!o);B&&!r.includes(B)&&(B=null);let a=n.map(o=>{let i=Array.isArray(o.details)?o.details.map(p=>`
                <li class="flex items-center gap-2">
                  ${p.badge?`<span class="badge badge-outline badge-sm text-secondary">${I(p.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${I(p.text)}</span>
                </li>
              `).join(""):"",s=i?`<ul class="space-y-2 text-sm text-base-content/70">${i}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',c=typeof o.id=="string"?o.id:"",l=!!(B&&c&&B===c),f=["data-planner-lesson",c?`data-lesson-id="${c}"`:"",l?'data-planner-selected="true"':""].filter(Boolean).join(" "),m=o.summary?`<p class="text-sm text-base-content/70">${I(o.summary)}</p>`:"",b=Ot(o),A=b?`<span class="badge badge-outline badge-sm text-base-content/70">${I(b)}</span>`:"",D=A?`<div class="mt-2 flex flex-wrap gap-1">${A}</div>`:"",R=typeof o.notes=="string"?o.notes:"",M=Ko(c),N=c?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${c}"
              ${M?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${c}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${I(R)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${I(En.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",T=c?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${c}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${c}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${f}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${I(o.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${I(o.title||o.dayLabel||"Lesson")}</h2>
                ${m}
                ${D}
              </div>
              <div class="flex flex-wrap items-center justify-end gap-1">
                ${T}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${c}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${c}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${s}
            ${N}
            <div class="flex flex-wrap gap-2">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${c}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${c}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");j.innerHTML=a,ca(B)}function ca(e){B=e||null,j&&j.querySelectorAll("[data-planner-lesson]").forEach(a=>{!!e&&a.getAttribute("data-lesson-id")===e?a.setAttribute("data-planner-selected","true"):a.removeAttribute("data-planner-selected")});let n=(Array.isArray(L?.lessons)?L.lessons:[]).find(r=>r.id===B)||null;la(n)}function ts(){return B&&(Array.isArray(L?.lessons)?L.lessons:[]).some(t=>t.id===B)?B:null}function ns(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===B||ca(n)}function rs(e){let t=hn(e?.currentTarget)?e.currentTarget:Ct;if(!hn(t))return;let n=t.value,r=Ft.has(n)?n:Dt;Jr(r),So(r),t.value!==r&&(t.value=r)}function da(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function as(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function ua(e){if(!e)return;let t=Nt.get(e);if(!t)return;let n=as();n&&n(t),Nt.delete(e)}function je(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&sa.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Ue(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&sa.has(t)?t:null,r=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(r instanceof HTMLElement){let a=n||"idle",o=En[a]||En.idle;r.textContent=o,r.setAttribute("data-status",a)}}async function wn(e,t,n){if(!e||!E)return;let r=n instanceof HTMLTextAreaElement?n:null;r&&(je(r,"saving"),Ue(r,"saving"));try{let a=await en(E,e,{notes:t});if(a&&(L=a),r){je(r,"saved"),Ue(r,"saved");let o=da();o?o(()=>{r.getAttribute("data-notes-status")==="saved"&&(je(r,null),Ue(r,null))},Wo):(je(r,null),Ue(r,null))}}catch(a){console.error("Failed to save planner notes",a),r&&(je(r,"error"),Ue(r,"error"))}}function os(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;ua(n);let r=da();if(!r){wn(n,t.value,t);return}let a=r(()=>{Nt.delete(n),wn(n,t.value,t)},Uo);Nt.set(n,a)}function ss(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(ua(n),wn(n,t.value,t))}function is(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let r=t.hasAttribute("open");Yo(n,r)}function ke(e){if(!j)return Ve=null,Promise.resolve();let t=e||Z();E=t,An(t),Mt("Loading plan\u2026");let n=(async()=>{try{let r=await K(t);r=await es(r,t),L=r,W(r),U(r,t),z(r)}catch(r){console.error("Failed to load planner week",r),Mt("Unable to load this week's planner.",{tone:"error"})}})();return Ve=n,n.finally(()=>{Ve===n&&(Ve=null)})}async function kn(){if(!j)return;ze||_t();let e=Ve;if(!e&&(!L||L.weekId!==E)&&(e=ke(E)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function fa(e,t){if(!e)return;await kn();let n=Array.isArray(L?.lessons)?L.lessons:[];if(!n.length)return;let r=n.find(A=>A?.id===e);if(!r)return;let a=typeof r.dayLabel=="string"&&r.dayLabel.trim()?r.dayLabel.trim():typeof r.dayName=="string"&&r.dayName.trim()?r.dayName.trim():"",o=typeof r.title=="string"&&r.title.trim()?r.title.trim():a||"Lesson",i=typeof r.summary=="string"&&r.summary.trim()?r.summary.trim():"",s=i||o,c=a?`${a} \xB7 ${s}`:s,l=i||"",f=To(r),m=xo(hr(E,f)),b={reminderTitle:c,reminderNotes:l,dueDate:m,dayLabel:a,lessonTitle:o,summary:i,plannerLessonId:e};an("cue:prepare",{trigger:t,source:"planner"}),an("planner:prefillReminder",b),an("cue:open",{trigger:t,source:"planner"})}async function ls(e,t){if(!e)return;await kn();let r=(Array.isArray(L?.lessons)?L.lessons:[]).find(s=>s?.id===e);if(!r)return;let a=t instanceof HTMLElement?t:null;a&&a.setAttribute("disabled","true");let o=Wr("lesson"),i={id:o,dayIndex:r.dayIndex,dayLabel:r.dayLabel,dayName:r.dayName,title:r.title,summary:r.summary,subject:r.subject,notes:r.notes,details:Array.isArray(r.details)?r.details.map(s=>({badge:s?.badge||"",text:s?.text||""})):[]};try{let s=await lt(E,i);s&&(L=s,B=o,W(s),U(s,E),z(s),H&&(H.textContent=`Duplicated ${r.title||"lesson"} into this week.`))}catch(s){console.error("Failed to duplicate planner lesson",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{a&&a.removeAttribute("disabled")}}function cs(){if(typeof window>"u")return;let e="#resources";window.location.hash!==e&&(window.location.hash=e),typeof window.renderRoute=="function"&&window.renderRoute(),Ce("resources"),H&&(H.textContent="Opening resources to add new materials.")}async function ds(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),r=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":gs(r,t);break;case"edit":bs(r,t);break;case"delete":Es(r);break;case"move-up":Or(r,"up",t);break;case"move-down":Or(r,"down",t);break;case"create-reminder":await fa(r,t);break;default:break}}async function us(e){let t=e.target instanceof Element?e.target.closest("[data-planner-detail-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-detail-action");if(!n)return;let r=De?.getAttribute("data-lesson-id");switch(n){case"duplicate":r&&await ls(r,t);break;case"reminder":r&&await fa(r,t);break;case"resources":cs();break;default:break}}async function ma(e){if(typeof document>"u"||!de)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=L?.lessons?.[0]?.dayLabel||"Monday";de.openAddLesson({defaultDay:n,trigger:t})}async function fs(e){if(!de)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=qe(E,1);de.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function ms(e){if(!E)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=qe(E,-1);if(n){t&&t.setAttribute("disabled","true");try{let r=await nn(n,E);r&&(L=r,B=null,W(r),U(r,E),z(r),H&&(H.textContent="Copied last week into this plan."))}catch(r){console.error("Failed to copy previous planner week",r),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{t&&t.removeAttribute("disabled")}}}async function ps(e){if(!E)return;e?.preventDefault?.();let t=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(t=window.confirm("Clear all lessons for this week?")),!t)return;let n=e?.currentTarget instanceof HTMLElement?e.currentTarget:null;n&&n.setAttribute("disabled","true");try{let r=await wr(E);r&&(L=r,B=null,W(r),U(r,E),z(r),H&&(H.textContent="Cleared this week's plan."))}catch(r){console.error("Failed to clear planner week",r),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function ys(e){if(!ie)return;let t=e?.currentTarget instanceof HTMLSelectElement?e.currentTarget:ie,n=t.value?.trim();if(n){t.disabled=!0;try{let r=await rn(E,n);r&&(L=r,W(r),U(r,E),z(r))}catch(r){console.error("Failed to apply planner template",r),window.alert("Unable to apply that template right now.")}finally{Rt(n)}}}async function hs(e){if(e?.preventDefault?.(),!Kr)return;let t=L||await K(E),n=Array.isArray(t?.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let r=typeof window<"u"?window.prompt("Name this template:",t?.templateId||""):null,a=typeof r=="string"?r.trim():"";if(a)try{Lr(a,{lessons:n}),Rt(a)}catch(o){console.error("Failed to save planner template",o),window.alert("Unable to save that template right now.")}}async function gs(e,t){if(!e||!de)return;let n=L?.lessons?.find(a=>a.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;de.openAddDetail({lesson:n,trigger:r})}async function bs(e,t){if(!e||!de)return;let n=L?.lessons?.find(a=>a.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;de.openEditLesson({lesson:n,trigger:r})}async function Or(e,t,n){if(!e||!t)return;let r=E||Z();if(!r)return;let a=n instanceof HTMLElement?n:null;a&&a.setAttribute("disabled","true");try{let o=await Er(r,e,t);o&&(L=o,W(o),U(o,r),z(o))}catch(o){console.error("Failed to move planner lesson",o),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{a&&a.removeAttribute("disabled")}}async function Es(e){if(!e||typeof window>"u")return;let t=L?.lessons?.find(r=>r.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let r=await br(E,e);r&&(L=r,W(r),U(r,E),z(r))}catch(r){console.error("Failed to delete planner lesson",r),window.alert("Unable to delete that lesson right now.")}}function _t(){if(ze||!j){ze&&ke(E);return}ze=!0,yr({ensureFirestore:Xe}),j.addEventListener("click",ns),j.addEventListener("click",ds),j.addEventListener("input",os),j.addEventListener("focusout",ss),j.addEventListener("toggle",is),po?.addEventListener("click",us),mo?.addEventListener("click",ma),fo?.addEventListener("click",fs),co?.addEventListener("click",ms),uo?.addEventListener("click",ps),ie?.addEventListener("change",ys),We?.addEventListener("change",Zo),Ct?.addEventListener("change",rs),Kr?.addEventListener("click",hs),so?.addEventListener("click",()=>{let e=qe(E,-1);ke(e)}),io?.addEventListener("click",()=>{let e=qe(E,1);ke(e)}),lo?.addEventListener("click",()=>{ke(Z())}),Rt(ct()),ke(E)}function _r(){typeof window>"u"||Ur()==="planner"&&_t()}function ws(e){let t=e?.detail?.plan;t&&(ze&&t.weekId===E&&(L=t,W(t),An(t.weekId),z(t)),t.weekId===Je&&U(t,Je))}U(null,Je);typeof document<"u"&&document.addEventListener(Yt,ws);typeof window<"u"&&(window.addEventListener("hashchange",_r),window.addEventListener("DOMContentLoaded",_r));var pa="dailyTasksByDate",vt=null;function In(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function Ss(e){if(typeof e!="string")return"";let[t,n,r]=e.split("-"),a=Number.parseInt(t,10),o=Number.parseInt(n,10),i=Number.parseInt(r,10);if(!Number.isFinite(a)||!Number.isFinite(o)||!Number.isFinite(i))return e;let s=new Date(a,o-1,i);return Number.isNaN(s.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(s)}function Qe(e){if(!yn)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);yn.disabled=!t}function be(e){if(!ce)return;if(!Array.isArray(e)||e.length===0){ce.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',Qe([]);return}let t=e.map((n,r)=>{let a=I(n?.text||""),o=!!n?.completed,i=`daily-task-${r}`,s=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return o&&s.push("line-through","text-opacity-50"),`
        <label class="flex items-center p-3 border-b border-base-200" data-task-index="${r}" for="${i}">
          <input id="${i}" type="checkbox" class="checkbox checkbox-sm" data-task-index="${r}" ${o?"checked":""} />
          <span class="${s.join(" ")}">${a}</span>
        </label>
      `}).join("");ce.innerHTML=t,Qe(e)}function Bt(){It&&It.classList.remove("hidden")}function Cn(){It&&It.classList.add("hidden")}function Dn(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Me(e){return Array.isArray(e)?e.map(t=>Dn(t)):[]}function Pn(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(pa);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function ya(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(pa,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function $r(e){let t=Pn(),n=t&&typeof t=="object"?t[e]:[];return Me(n)}function Sn(e,t){let n=Pn(),r=Me(t);return n[e]=r,ya(n),r}function qr(e,t){let n=Pn(),r=Me(n[e]);return r.push(Dn(t)),n[e]=r,ya(n),r}function $t(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Nn(){return vt||(vt=Xe().then(e=>{let{db:t,getCollection:n}=e,r=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),vt)}function Mn(e,t){let{doc:n,dailyListsCollection:r,db:a}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(a,"dailyLists",t)}async function Bn(){if(!Ar||!ce)return;let e=In(),t=Ss(e);Ar.textContent=t?`Today's List - ${t}`:"Today's List";let n=!1;if(ge){Bt();let r=$r(e);C=r,be(r),n=!0}return Lt||(n||(ce.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',Qe([])),Lt=(async()=>{try{let r=await Nn(),a=Mn(r,e),o=await r.getDoc(a),i=o.exists()?o.data()?.tasks:[];return C=Me(i),be(C),Sn(e,C),ge=!1,Cn(),C}catch(r){$t(r)?(console.warn("Falling back to local daily tasks due to permission issue",r),ge=!0,Bt()):console.error("Failed to load daily list",r);let o=$r(e);return C=o,o.length||n?be(o):(ce.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',C=[],Qe(C)),C}})().finally(()=>{Lt=null})),Lt}async function Ls(e){let t=In(),n=Dn(e);try{let r=await Nn(),a=Mn(r,t),o=await r.getDoc(a);if(o.exists()&&typeof r.arrayUnion=="function")await r.updateDoc(a,{tasks:r.arrayUnion(n)});else{let i=o.exists()?o.data()?.tasks:[],s=Array.isArray(i)?Me(i):[];s.push(n),typeof r.setDoc=="function"?await r.setDoc(a,{tasks:s},{merge:!0}):await r.updateDoc(a,{tasks:s})}qr(t,n),ge=!1,Cn()}catch(r){if($t(r)){console.warn("Saving task locally because cloud sync is unavailable",r),ge=!0,Bt(),qr(t,n);return}throw r}}async function ha(e){let t=In(),n=Me(e);try{let r=await Nn(),a=Mn(r,t);typeof r.setDoc=="function"?await r.setDoc(a,{tasks:n},{merge:!0}):await r.updateDoc(a,{tasks:n}),Sn(t,n),ge=!1,Cn()}catch(r){if($t(r)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",r),ge=!0,Bt(),Sn(t,n);return}throw r}}function ga(e){[At,kt].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function vs(){!Ke||!Ye||(Ke.classList.remove("hidden"),Ye.classList.add("hidden"),ga(At))}function Ts(){!Ke||!Ye||(Ke.classList.add("hidden"),Ye.classList.remove("hidden"),ga(kt),Bn())}function xs(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),r=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!r.length)return;let a=s=>{n.forEach(c=>{if(!c)return;let l=c.getAttribute("data-dashboard-tab")===s;c.classList.toggle("tab-active",l),c.setAttribute("aria-selected",l?"true":"false")}),r.forEach(c=>{if(!c)return;let l=c.getAttribute("data-dashboard-panel")===s;c.classList.toggle("hidden",!l),c.setAttribute("aria-hidden",l?"false":"true")})},i=(n.find(s=>s.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");i&&a(i),n.forEach(s=>{s.addEventListener("click",()=>{let c=s.getAttribute("data-dashboard-tab");c&&a(c)})})})}window.addEventListener("DOMContentLoaded",xs);At&&kt&&Ke&&Ye&&(At.addEventListener("click",e=>{e.preventDefault(),vs()}),kt.addEventListener("click",e=>{e.preventDefault(),Ts()}));var $=null,G=!1,xt=null;function Ne(e){if(!Y)return;Y.setAttribute("aria-pressed",e?"true":"false");let t=Y.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":Y.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function As(){G&&(window.clearTimeout(xt),xt=window.setTimeout(()=>{xt=null,G&&ba(!0)},400))}function ba(e=!1){if(!$)return!1;if(G&&!e)return!0;try{return $.start(),G=!0,Ne(!0),!0}catch{return G=!1,Ne(!1),!1}}function Fn(){if($){G=!1,window.clearTimeout(xt);try{$.stop()}catch{}Ne(!1)}}function ks(){if(Y)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){Y.setAttribute("disabled","true"),Y.setAttribute("aria-disabled","true"),Y.title="Voice input is not supported in this browser.";return}$=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if($.lang=t,$.interimResults=!1,"continuous"in $)try{$.continuous=!0}catch{}$.onresult=n=>{let r=n?.results?.[0]?.[0]?.transcript||"";if(r&&V){V.value=r.trim();try{V.focus({preventScroll:!0})}catch{V.focus()}try{let a=V.value.length;V.setSelectionRange(a,a)}catch{}}},$.onend=()=>{if(!G){Ne(!1);return}As()},$.onerror=()=>{G=!1,Ne(!1)}}catch{$=null,Ne(!1),Y.setAttribute("disabled","true"),Y.setAttribute("aria-disabled","true")}}ks();Y?.addEventListener("click",()=>{$&&(G?Fn():ba())});zr?.addEventListener("submit",()=>{G&&Fn()});window.addEventListener("pagehide",()=>{G&&Fn()});zr?.addEventListener("submit",async e=>{if(e.preventDefault(),!V)return;let t=V.value.trim();if(!t){V.focus();return}let n={text:t,completed:!1};V.value="",V.focus();try{await Ls(n),await Bn()}catch(r){console.error("Failed to add task to the daily list",r),V.value=t,V.focus()}});ce?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(C)||Number.isNaN(n)||!C[n])return;let r=document.activeElement===t,a=()=>{if(!r)return;let s=ce?.querySelector(`input[data-task-index="${n}"]`);if(s instanceof HTMLInputElement)try{s.focus({preventScroll:!0})}catch{s.focus()}},o=C.map(s=>({...s})),i=o.map((s,c)=>c===n?{...s,completed:t.checked}:s);C=i,be(i),a();try{await ha(i)}catch(s){console.error("Failed to update task completion state",s),C=o,be(o),a()}});yn?.addEventListener("click",async()=>{if(!Array.isArray(C)||C.length===0)return;let e=C.filter(n=>!n.completed);if(e.length===C.length)return;let t=C.map(n=>({...n}));C=e,be(e);try{await ha(e)}catch(n){console.error("Failed to clear completed tasks",n),C=t,be(t)}});Qe(C);Bn();function Is(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),r=document.getElementById("noteNewBtn"),a=document.getElementById("notesList"),o=document.querySelector("[data-notes-layout]"),i=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!r)return;let s=null,c=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}},l=()=>o&&o.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",f=p=>{let y=p==="collapsed";i.forEach(w=>{if(!(w instanceof HTMLElement))return;w.setAttribute("aria-expanded",y?"false":"true");let S=w.dataset.notesShelfToggleVariant;S==="primary"?w.textContent=y?"Show saved notes":"Hide saved notes":S==="close"&&(w.textContent=y?"Show":"Close")})},m=p=>{o&&(o.dataset.notesShelfState=p==="collapsed"?"collapsed":"expanded"),f(l())},b=()=>{let p=l()==="collapsed"?"expanded":"collapsed";m(p),p==="collapsed"&&c()};i.length&&(i.forEach(p=>{p.addEventListener("click",y=>{y.preventDefault(),b()})}),m(l()));let A=p=>{if(!p){s=null,e.value="",t.value="";return}s=p.id,e.value=p.title||"",t.value=p.body||""},D=()=>{if(!a)return;a.querySelectorAll("button[data-note-id]").forEach(y=>{if(!(y instanceof HTMLElement))return;let w=y.getAttribute("data-note-id")===s;y.classList.toggle("bg-base-200/80",w),y.classList.toggle("border-base-300",!w),y.classList.toggle("border-primary",w),y.classList.toggle("font-medium",w),y.setAttribute("aria-current",w?"true":"false")})},R=()=>{let p=rt();return Array.isArray(p)?[...p].sort((y,w)=>{let S=Date.parse(y?.updatedAt||""),v=Date.parse(w?.updatedAt||"");return(Number.isNaN(v)?0:v)-(Number.isNaN(S)?0:S)}):[]},M=p=>{if(!p)return;let y=rt();if(!Array.isArray(y))return;let w=y.filter(v=>v.id!==p);if(w.length===y.length)return;Ut(w),s===p&&(s=null);let S=N();if(s){let v=S.find(u=>u.id===s)||null;A(v)}else S.length?A(S[0]):A(null);D()},N=(p=R())=>{if(!a)return p;if(a.innerHTML="",!p.length){let y=document.createElement("li");return y.className="text-sm italic text-base-content/60",y.textContent="No saved notes yet.",a.appendChild(y),p}return p.forEach(y=>{let w=document.createElement("li");w.className="flex items-center gap-2";let S=document.createElement("button");S.type="button",S.dataset.noteId=y.id,S.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",S.textContent=y.title||"Untitled note",S.addEventListener("click",()=>{A(y),D(),c()});let v=document.createElement("button");v.type="button",v.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",v.setAttribute("aria-label",`Delete note "${y.title||"Untitled note"}"`),v.textContent="Delete",v.addEventListener("click",u=>{u.stopPropagation(),M(y.id)}),w.appendChild(S),w.appendChild(v),a.appendChild(w)}),D(),p},T=()=>{let p=N();if(!p.length){A(null),D();return}let y=s?p.find(w=>w.id===s):null;A(y||p[0]),D()};n.addEventListener("click",()=>{let p=rt(),y=Array.isArray(p)?[...p]:[],w=typeof e.value=="string"?e.value.trim():"",S=typeof t.value=="string"?t.value:"",v=w||"Untitled note",u=new Date().toISOString();if(s){let k=y.findIndex(O=>O.id===s);if(k>=0)y[k]={...y[k],title:v,body:S,updatedAt:u};else{let O=jt(v,S,{updatedAt:u});s=O.id,y.unshift(O)}}else{let k=jt(v,S);s=k.id,y.unshift(k)}Ut(y);let g=N(),P=s?g.find(k=>k.id===s):null;A(P||null),D()}),r.addEventListener("click",()=>{s=null,e.value="",t.value="",D(),c()}),T()}Is();var Ea="theme",Cs="professional",Ln="memoryCue:theme-change",Ds="professional",vn=document.getElementById("theme-menu"),wa="[data-theme-name],[data-theme-option]",Ps=new Set(["dark","dracula","synthwave"]);function ue(e){return typeof e=="string"?e.trim():""}function Sa(e){return e instanceof HTMLElement?ue(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Ns(e){let t=ue(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Ps.has(t)))}function jr(e){let t=ue(e);if(t)try{localStorage.setItem(Ea,t)}catch(n){console.warn("Unable to save theme preference",n)}}function La(e){if(!vn)return;let t=ue(e);vn.querySelectorAll(wa).forEach(r=>{if(!(r instanceof HTMLElement))return;let a=Sa(r),o=t&&a===t;r.setAttribute("aria-checked",o?"true":"false"),r.classList.toggle("active",o)})}function Ms(e){let t=ue(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(Ln,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let r=document.createEvent("CustomEvent");r.initCustomEvent(Ln,!0,!0,{theme:t}),window.dispatchEvent(r)}}}function Tn(e,{persist:t=!0,notify:n=!0}={}){let r=ue(e);if(!r)return;ue(document.documentElement.getAttribute("data-theme"))!==r&&Ns(r),t&&jr(r),La(r),n&&Ms(r)}function Bs(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){Tn(Ds,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Ea)||""}catch(r){console.warn("Unable to load theme preference",r)}let n=t||document.documentElement.getAttribute("data-theme")||Cs;n&&Tn(n,{persist:!1,notify:!0})}vn?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(wa):null;if(!t)return;e.preventDefault();let n=Sa(t);n&&Tn(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(Ln,e=>{let t=ue(e?.detail?.theme);t&&La(t)});Bs()});export default Fs();
