import{a as An,b as ur,c as Ye,d as fr,f as At,g as Ge,h as kt,i as mr,j as kn,k as pr}from"./chunk-UP4RU4IJ.js";import{a as xn,b as dr}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as xt,c as cr}from"./chunk-GUVSRPRW.js";function Dn(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:o})=>{if(!Array.isArray(o))return null;for(let r of o){if(typeof r!="string"||!r)continue;let s=t.getElementById(r);if(s)return{key:n,element:s}}return null}).filter(n=>!!(n&&n.element))}function ge(e,t){if(!e||typeof e!="object")return"";let n=yr[t]||[t];for(let o of n)if(Object.prototype.hasOwnProperty.call(e,o)){let r=e[o];return r==null?"":typeof r=="string"?r:String(r)}return""}function hr(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function gr(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Cn(e,t){Array.isArray(t)&&t.forEach(({key:n,element:o})=>{let r=e&&typeof e=="object"?ge(e,n):"";hr(o,r)})}function Nn(e,t,n,o){Array.isArray(e)&&e.forEach(({element:r})=>{r instanceof HTMLInputElement?["checkbox","radio"].includes(r.type)?r.checked=!1:r.value="":(r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement)&&(r.value="")}),t&&(t.value=""),n&&(n.textContent=o)}function Pn(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:o})=>{let r=gr(o);if(typeof r=="boolean"){t[n]=r;return}let s=typeof r=="string"?r.trim():r;t[n]=s??""}),t}function I(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var In,yr,It,Dt,Bn=xt(()=>{In=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],yr={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},It="Create Cue",Dt="Edit Cue"});function Mn(e){return new Ct(e)}var br,Er,Ct,Fn=xt(()=>{br=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Er={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Ct=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...Er,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let o=n[0],r=n[n.length-1],s=document.activeElement;t.shiftKey&&s===o?(t.preventDefault(),r.focus()):!t.shiftKey&&s===r&&(t.preventDefault(),o.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(br)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let o=this.events[t];if(!o||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let r=new CustomEvent(o,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(r)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Hn,Rn,On,Pt,Nt,Sr,Ee,Bt,Tr,_n,$n,Mt,wr,Un,Ze,qn,Wn,Ft,le,vr,Vn,Se,jn,Lr,xr,Ar,zn,Ht,Je,Be,Xe,be,Pe,kr,Kn,ne,Yn,ce,Gn,Xn,Qe,Ir,Ne,de,Jn,J,et,Qn,Rt,Zn,$,Ot,_t,eo,to,$t,no,oo,Te,ro,tt,Ut,so=xt(()=>{Hn="memoryCue:plannerPlans",Rn="memoryCue:plannerTemplates",On="memoryCue:lastPlannerTemplate",Pt="memoryCue:plannerUpdated",Nt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Sr=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],Ee=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},Bt=e=>{if(!Ee()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},Tr=(e,t)=>{if(!(!Ee()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch{}},_n=e=>{try{return JSON.parse(e)}catch{return null}},$n=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Mt=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,wr=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),o=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-o),t},Un=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`},Ze=e=>{if(typeof e!="string")return null;let[t,n,o]=e.split("-"),r=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(o,10);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(a))return null;let i=new Date(r,s-1,a);return Number.isNaN(i.getTime())?null:(i.setHours(0,0,0,0),i)},qn=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=Nt.findIndex(o=>o.toLowerCase()===t);return n>=0?n:0},Wn=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:$n(),badge:n,text:t}},Ft=(e,t={})=>{let n=typeof t=="object"&&t?t:{},o=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:qn(e?.dayName||n.dayName||n.dayLabel),r=Mt(o),s=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():Nt[r],a=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",d=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(u=>Wn(u)).filter(Boolean),c=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:$n(),f=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,h=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"";return{id:c,dayIndex:r,dayLabel:Nt[r]||"Lesson",title:s,summary:a,details:d,notes:h,position:Number.isFinite(f)?f:null}},le=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let o=Number.isFinite(t.position),r=Number.isFinite(n.position);return o&&r&&t.position!==n.position?t.position-n.position:o&&!r?-1:!o&&r?1:t.title.localeCompare(n.title)}),vr=e=>{let t=new Map;return e.forEach(n=>{let o=String(n.dayIndex),r=t.get(o)??0;Number.isFinite(n.position)?t.set(o,Math.max(r,n.position+1)):(n.position=r,t.set(o,r+1))}),e},Vn=(e,t,n)=>{let o=e.filter(r=>!(r.dayIndex!==t||n&&r.id===n));return o.length?o.reduce((r,s)=>Number.isFinite(s.position)?Math.max(r,s.position):r,-1)+1:0},Se=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,o=Ze(n),r=Array.isArray(e?.lessons)?vr(e.lessons.map(a=>Ft(a)).filter(Boolean)):[],s=typeof e?.templateId=="string"?e.templateId.trim():"";return{weekId:n,startDate:o?o.toISOString():"",lessons:le(r),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString(),templateId:s}},jn=()=>{if(!Ee())return{};try{let e=Bt(Hn);if(typeof e!="string"||!e.length)return{};let t=_n(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Lr=e=>{if(Ee())try{window.localStorage.setItem(Hn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},xr=()=>{if(!Ee())return{};try{let e=Bt(Rn);if(typeof e!="string"||!e.length)return{};let t=_n(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},Ar=e=>{if(Ee())try{window.localStorage.setItem(Rn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},zn=e=>{if(!e)return null;let n=jn()[e];return n?Se(n,e):null},Ht=(e,t)=>{if(!e||!t)return t;let n=jn();return n[e]=t,Lr(n),t},Je=new Map,Be=null,Xe=null,be=!1,Pe=null,kr=()=>{if(typeof Pe=="string")return Pe;let e=Bt(On);return Pe=typeof e=="string"?e:"",Pe},Kn=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();Pe=t,Tr(On,t)},ne=e=>{e?.templateId&&Kn(e.templateId)},Yn=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},ce=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(Pt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},Gn=async()=>Be?Xe||(Xe=Be().then(e=>{let{db:t,getCollection:n}=e||{},o=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),Xe):null,Xn=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:o,db:r}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(r,"plannerPlans",t)},Qe=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Je.set(e.weekId,e),e),Ir=e=>{let t=J();return Se({weekId:e,lessons:e===t?Sr:[]},e)},Ne=e=>{let t=zn(e);if(t)return Qe(t),t;let n=Ir(e);return Ht(e,n),Qe(n),n},de=async e=>{if(!e?.weekId)return e;let t=Se(e,e.weekId);if(Ht(t.weekId,t),Qe(t),ne(t),be||!Be)return t;try{let n=await Gn();if(!n)return t;let o=Xn(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(o,t,{merge:!0}):await n.updateDoc(o,t),t}catch(n){return Yn(n)?(console.warn("Persisting planner data locally due to permission issue",n),be=!0,t):(console.error("Failed to persist planner plan",n),t)}},Jn=(e={})=>{typeof e.ensureFirestore=="function"&&(Be=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(be=e.forceLocal)},J=(e=new Date)=>{let t=wr(e);return Un(t)},et=(e,t=0)=>{let n=Ze(e);if(!n||!Number.isFinite(t))return e;let o=new Date(n);return o.setDate(n.getDate()+t*7),Un(o)},Qn=(e=J(),t=0)=>{let n=Ze(e);if(!n)return null;let o=Number.isFinite(t)?t:0,r=Mt(o),s=new Date(n);return s.setDate(n.getDate()+r),s},Rt=(e,{short:t=!1}={})=>{let n=Ze(e);if(!n)return"";let o=new Date(n);o.setDate(n.getDate()+6);let r=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),s=r.format(n),a=r.format(o),i=n.getFullYear()===o.getFullYear();if(t)return`Week of ${s}`;let d=i?n.getFullYear():`${n.getFullYear()} \u2013 ${o.getFullYear()}`;return`${s} \u2013 ${a}, ${d}`},Zn=(e=J())=>{if(!e)return[];let t=Je.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=zn(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},$=async(e=J())=>{if(!e)return null;if(Je.has(e)){let t=Je.get(e);return ne(t),t}if(be||!Be){let t=Ne(e);return ne(t),t}try{let t=await Gn();if(!t){let s=Ne(e);return ne(s),s}let n=Xn(t,e),o=await t.getDoc(n);if(o.exists()){let s=o.data(),a=Se({...s,weekId:e},e);return Ht(e,a),Qe(a),be=!1,ne(a),a}let r=Ne(e);return typeof t.setDoc=="function"&&await t.setDoc(n,r,{merge:!0}),ne(r),r}catch(t){if(Yn(t)){console.warn("Falling back to local planner data due to permission issue",t),be=!0;let o=Ne(e);return ne(o),o}console.error("Failed to load planner data",t);let n=Ne(e);return ne(n),n}},Ot=async(e,t)=>{if(!e)return null;let n=await $(e),o=Ft(t);o.position=Vn(n?.lessons||[],o.dayIndex);let r={...n,lessons:le([...n?.lessons||[],o]),updatedAt:new Date().toISOString()},s=await de(r);return ce(s),s},_t=async(e,t,n={})=>{if(!e||!t)return null;let o=await $(e),r=[...o?.lessons||[]],s=r.findIndex(f=>f.id===t);if(s===-1)return o;let a=r[s],i=Ft({...a,...n,id:t},a);if(i.dayIndex!==a.dayIndex){let f=r.filter((h,u)=>u!==s);i.position=Vn(f,i.dayIndex)}r[s]=i;let d={...o,lessons:le(r),updatedAt:new Date().toISOString()},c=await de(d);return ce(c),c},eo=async(e,t)=>{if(!e||!t)return null;let n=await $(e),o=(n?.lessons||[]).filter(a=>a.id!==t),r={...n,lessons:le(o),updatedAt:new Date().toISOString()},s=await de(r);return ce(s),s},to=async(e,t,n)=>{if(!e||!t||!n)return null;let o=n==="up"?-1:n==="down"?1:0;if(!o)return $(e);let r=await $(e),s=[...r?.lessons||[]],a=s.findIndex(L=>L.id===t);if(a===-1)return r;let i=s[a],d=s.filter(L=>L.dayIndex===i.dayIndex);if(d.length<=1)return r;let f=le(d).map(L=>L.id),h=f.indexOf(t);if(h===-1)return r;let u=h+o;if(u<0||u>=f.length)return r;let[m]=f.splice(h,1);f.splice(u,0,m);let b=new Map(f.map((L,P)=>[L,P])),E=s.map(L=>{if(L.dayIndex!==i.dayIndex)return L;let P=b.get(L.id);return typeof P=="number"?{...L,position:P}:L}),S={...r,lessons:le(E),updatedAt:new Date().toISOString()},D=await de(S);return ce(D),D},$t=async(e,t,n)=>{if(!e||!t)return null;let o=await $(e),r=[...o?.lessons||[]],s=r.findIndex(h=>h.id===t);if(s===-1)return o;let a=Wn(n);if(!a)return o;let i=r[s],d={...i,details:[...i.details||[],a]};r[s]=d;let c={...o,lessons:le(r),updatedAt:new Date().toISOString()},f=await de(c);return ce(f),f},no=async(e,t)=>{if(!e||!t)return null;let n=await $(e),o=(n?.lessons||[]).map(a=>({title:a.title,summary:a.summary,dayIndex:a.dayIndex,notes:typeof a.notes=="string"?a.notes:"",details:(a.details||[]).map(i=>({badge:i.badge,text:i.text}))})),r=Se({weekId:t,lessons:o,templateId:typeof n?.templateId=="string"?n.templateId:""},t);r.updatedAt=new Date().toISOString();let s=await de(r);return ce(s),s},oo=e=>{if(!e||typeof e!="object")return null;let t=Mt(Number.isFinite(e.dayIndex)?e.dayIndex:qn(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",o=typeof e.summary=="string"?e.summary:"",r=typeof e.notes=="string"?e.notes:"",s=Array.isArray(e.details)?e.details.map(a=>{if(!a||typeof a!="object")return null;let i=typeof a.badge=="string"?a.badge:"",d=typeof a.text=="string"?a.text:"";return d.trim()?{badge:i,text:d}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:o,details:s,notes:r}},Te=()=>{let e=xr(),t={};return Object.keys(e).forEach(n=>{let o=e[n];if(!o||typeof o!="object")return;let r=typeof o.name=="string"&&o.name.trim()?o.name.trim():n,s=Array.isArray(o.lessons)?o.lessons.map(a=>oo(a)).filter(Boolean):[];t[r]={name:r,lessons:s,updatedAt:typeof o.updatedAt=="string"?o.updatedAt:""}}),t},ro=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let o=Te(),r=Array.isArray(t.lessons)?t.lessons.map(s=>oo(s)).filter(Boolean):[];return o[n]={name:n,lessons:r,updatedAt:new Date().toISOString()},Ar(o),o[n]},tt=()=>kr(),Ut=async(e,t)=>{if(!e||!t)return null;let o=Te()[t];if(!o)return $(e);Kn(t);let r=Array.isArray(o.lessons)?o.lessons.map(i=>({dayIndex:i.dayIndex,title:i.title,summary:i.summary,notes:typeof i.notes=="string"?i.notes:"",details:Array.isArray(i.details)?i.details.map(d=>({badge:d.badge,text:d.text})):[]})):[],s=Se({weekId:e,lessons:r,templateId:t},e);s.updatedAt=new Date().toISOString();let a=await de(s);return ce(a),a}});var oa=cr(()=>{dr();fr();Bn();Fn();ur();mr();pr();so();xn();function Dr(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!t||!n)return;let o=document.querySelectorAll("[data-open-reminder-modal]");if(!o.length)return;let r=e.querySelector("[data-reminder-modal-backdrop]"),s=e.querySelectorAll("[data-close-modal]"),a=document.getElementById("mainContent"),i=document.querySelector('nav[aria-label="Primary"]'),d=[a,i],c=e.querySelector('[role="dialog"]')??e,f=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],h=null,u=()=>{if(!(c instanceof HTMLElement))return[];let p=c.querySelectorAll(f.join(","));return Array.from(p).filter(g=>{let k=g instanceof HTMLElement,V=typeof SVGElement<"u"&&g instanceof SVGElement;if(!k&&!V||g.getAttribute("aria-hidden")==="true"||"disabled"in g&&g.disabled||g.hidden||g.closest("[hidden]"))return!1;let j=g.getBoundingClientRect();return j.width>0&&j.height>0})},m=()=>{let p=u(),g=p.find(k=>k.hasAttribute("data-autofocus")||k.hasAttribute("autofocus"))||(n&&p.includes(n)?n:null)||p[0];if(g&&typeof g.focus=="function"){g.focus({preventScroll:!0});return}c instanceof HTMLElement&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},b=p=>{c instanceof HTMLElement&&(!(p.target instanceof Node)||!c.contains(p.target))&&(p.stopPropagation(),m())},E=p=>{if(p.key!=="Tab")return;let g=u();if(!g.length){p.preventDefault(),c instanceof HTMLElement&&c.focus({preventScroll:!0});return}let k=g[0],V=g[g.length-1],j=document.activeElement;if(p.shiftKey){(!c.contains(j)||j===k)&&(p.preventDefault(),V.focus());return}(!c.contains(j)||j===V)&&(p.preventDefault(),k.focus())},S=p=>{d.forEach(g=>{g&&(p?g.setAttribute("inert",""):g.removeAttribute("inert"))})},D=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),S(!1),document.removeEventListener("keydown",L,!0),e.removeEventListener("keydown",E,!0),e.removeEventListener("focusin",b,!0),h&&typeof h.focus=="function"&&h.focus(),h=null},L=p=>{p.key==="Escape"&&(p.preventDefault(),D())},P=({triggerElement:p}={})=>{p&&typeof p.focus=="function"?h=p:h=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),S(!0),document.addEventListener("keydown",L,!0),e.addEventListener("keydown",E,!0),e.addEventListener("focusin",b,!0),window.requestAnimationFrame(()=>{m()})},C=(p,g={})=>{try{document.dispatchEvent(new CustomEvent(p,{detail:g}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let k=document.createEvent("CustomEvent");k.initCustomEvent(p,!0,!0,g),document.dispatchEvent(k)}}},M=(p={})=>{C("cue:cancelled",p)};o.forEach(p=>{p.addEventListener("click",g=>{g.preventDefault();let V={trigger:g.currentTarget instanceof HTMLElement?g.currentTarget:null,mode:"create"};C("cue:prepare",V),C("cue:open",V)})}),s.forEach(p=>{p.addEventListener("click",g=>{g.preventDefault(),M({trigger:p,reason:"button"})})}),e.addEventListener("click",p=>{p.target===e&&M({reason:"backdrop"})}),r?.addEventListener("click",p=>{p.target===r&&M({reason:"backdrop"})}),document.addEventListener("cue:open",p=>{let g=p?.detail?.trigger,k=g instanceof HTMLElement?g:null;P({triggerElement:k})});let _=()=>{D()};document.addEventListener("cue:close",_),document.addEventListener("cue:cancelled",_);let T=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&T instanceof HTMLElement&&t.addEventListener("submit",p=>{p.preventDefault(),!T.matches(":disabled")&&T.click()}),T instanceof HTMLElement&&document.addEventListener("reminder:save",p=>{let g=p?.detail?.trigger;g&&g!==T||T.matches(":disabled")||T.click()})}Dr();function qt(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var ao=null;function xo(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Cr(e){typeof document>"u"||!e||(window.clearTimeout(ao),ao=window.setTimeout(()=>{let t=document.querySelector(`[data-route="${e}"]`);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Re(e){let t=e||xo();t&&Cr(t)}function Nr(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Re()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{if(!(o.currentTarget instanceof HTMLAnchorElement))return;let r=o.currentTarget.getAttribute("href")||"";if(!r.startsWith("#"))return;o.preventDefault();let s=r||"#dashboard",a=s.replace("#","")||"dashboard";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),Re(a)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Re()}Nr();var Ao="memoryCue:accountPanelCollapsed";function Pr(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem(Ao);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function Br(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem(Ao,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function Mr(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let o=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",r=(t.getAttribute("data-expanded-label")||"").trim()||o,s=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",a=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",i=t.querySelector("[data-account-toggle-label]"),d=t.querySelector("[data-account-toggle-a11y]"),c=Pr();typeof c!="boolean"&&(c=!0);let f=(h,{persist:u=!0}={})=>{c=!!h,e.setAttribute("data-account-collapsed",c?"true":"false"),t.setAttribute("aria-expanded",c?"false":"true");let m=c?o:r,b=c?s:a;i?i.textContent=m:t.textContent=m,t.setAttribute("aria-label",b),d&&(d.textContent=b),c?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),c||n.removeAttribute("hidden"),u&&Br(c)};f(c,{persist:!1}),t.addEventListener("click",h=>{h.preventDefault(),f(!c)})}Mr();var io=document.getElementById("settings-save-button"),nt=document.getElementById("settings-save-confirmation"),re=document.getElementById("live-status"),Wt=null,ue=document.getElementById("resourcePlannerStatus"),Vt=null;document.addEventListener("planner:reminderCreated",e=>{if(!re)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",o=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",r=o?`Reminder saved for ${o}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";re.textContent=r});io&&nt&&io.addEventListener("click",e=>{e.preventDefault(),nt.classList.remove("hidden"),nt.textContent="Settings saved!",re&&(re.textContent="Settings saved!"),Wt&&window.clearTimeout(Wt),Wt=window.setTimeout(()=>{nt.classList.add("hidden")},3e3)});function Fr(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Re(t),re&&(re.textContent="Opening planner to add a new lesson."),vt(),window.requestAnimationFrame(()=>{let o=Ko();o&&typeof o.catch=="function"&&o.catch(r=>{console.error("Planner quick action failed to start new lesson flow",r)})})}function Hr(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Fr)})}Hr();function jt(e,{tone:t="success"}={}){ue&&(ue.textContent=e,ue.classList.remove("hidden"),ue.classList.remove("text-success","text-error"),ue.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(Vt&&window.clearTimeout(Vt),Vt=window.setTimeout(()=>{ue.classList.add("hidden"),ue.textContent=""},4e3))),re&&(re.textContent=e)}function Rr(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function Or(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let o=n.getAttribute("data-resource-title")?.trim(),r=n.getAttribute("data-resource-link")?.trim();if(!o||!r)return;let s="#planner";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),Re("planner"),vt(),await zo();let a=`${o} \u2014 ${r}`,i=ks(),d=null;try{if(i)d=await $t(w,i,{badge:"Resource",text:a});else{let c=Rr("lesson"),f=x?.lessons?.[0]?.dayLabel||"Monday";d=await Ot(w,{id:c,dayName:f,title:o,summary:`Resource link: ${r}`,details:[{badge:"Resource",text:a}]}),d&&(H=c)}if(d){x=d,K(d),q(d,w),z(d);let c=i?`Added "${o}" to your selected lesson.`:`Created a lesson for "${o}" in this week's planner.`;jt(c);return}jt("Unable to save that resource to the planner right now.",{tone:"error"})}catch(c){console.error("Failed to save resource to planner",c),jt("Unable to save that resource to the planner right now.",{tone:"error"})}}function _r(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",Or)})}_r();var ko=document.getElementById("reminder-title"),$r=document.getElementById("reminderText"),G=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),o=e.querySelector(".modal-backdrop button"),r=document.getElementById("modal-title");return Mn({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:o instanceof HTMLElement?o:null,titleInput:ko,modalTitle:r instanceof HTMLElement?r:null,defaultTitle:It,editTitle:Dt})})();G?.setEditMode(!1);var Ur=()=>{let e=!!ko;if(!!$r)return Ye({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id"};return e?Ye(n):Ye({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Ur().catch(e=>{console.error("Failed to initialise reminders",e)});var Qt=kn(),zt=An({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{Qt?.handleSessionChange(e)}});if(zt?.supabase){Qt?.setSupabaseClient(zt.supabase);try{zt.supabase.auth.getSession().then(({data:e})=>{Qt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var ee=document.getElementById("cues-list"),Kt=document.getElementById("pinnedNotesCard"),ve=document.getElementById("pinnedNotesList"),he=document.getElementById("cue-form"),Y=he?.querySelector("#cue-id-input"),qr=G?.defaultTitle||G?.modalTitle?.textContent?.trim()||It,ya=G?.editTitle||Dt,ft=document.getElementById("tab-cues"),mt=document.getElementById("tab-daily"),_e=document.getElementById("cues-view"),$e=document.getElementById("daily-list-view"),lo=document.getElementById("daily-list-header"),Io=document.getElementById("quick-add-form"),O=document.getElementById("quick-add-input"),U=document.getElementById("daily-voice-btn"),me=document.getElementById("daily-tasks-container"),Zt=document.getElementById("clear-completed-btn"),pt=document.getElementById("daily-list-permission-notice"),R=document.getElementById("plannerCards")||document.getElementById("planner-grid"),co=document.getElementById("planner-week"),Wr=document.getElementById("planner-prev"),Vr=document.getElementById("planner-next"),jr=document.getElementById("planner-today"),zr=document.getElementById("planner-duplicate-btn"),Kr=document.getElementById("planner-new-lesson-btn"),oe=document.getElementById("planner-template-select"),Do=document.getElementById("planner-template-save-btn"),yt=document.querySelector("[data-planner-text-size]"),Yt=document.querySelector(".desktop-panel--planner"),ot=document.querySelector("[data-mobile-notes-text-size]"),Gt=document.querySelector(".mobile-panel--notes"),Co="plannerTextSizePreference",ht="default",St=new Set(["small","default","large"]),Yr=["planner-text-small","planner-text-default","planner-text-large"],No="mobileNotesTextSizePreference",gt="default",Tt=new Set(["small","default","large"]),Gr=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function en(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function Xr(){if(typeof localStorage>"u")return ht;let e=localStorage.getItem(Co);return e&&St.has(e)?e:ht}function Jr(e){typeof localStorage>"u"||!St.has(e)||localStorage.setItem(Co,e)}function Po(e){if(!Yt)return;let t=St.has(e)?e:ht;Yr.forEach(n=>Yt.classList.remove(n)),Yt.classList.add(`planner-text-${t}`)}var Bo=Xr();Po(Bo);en(yt)&&(yt.value=Bo);function Mo(){if(typeof localStorage>"u")return gt;let e=localStorage.getItem(No);return e&&Tt.has(e)?e:gt}function Qr(e){typeof localStorage>"u"||!Tt.has(e)||localStorage.setItem(No,e)}function Fo(e){if(!Gt)return;let t=Tt.has(e)?e:gt;Gr.forEach(n=>Gt.classList.remove(n)),Gt.classList.add(`mobile-panel--notes-size-${t}`)}var Ho=Mo();Fo(Ho);ot instanceof HTMLSelectElement&&(ot.value=Ho,ot.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:gt;if(!Tt.has(t)){ot.value=Mo();return}Qr(t),Fo(t)}));var Zr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function es(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=Zr.findIndex(o=>o.toLowerCase()===t.toLowerCase());return n>=0?n:0}function ts(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function ns(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),o=document.getElementById("planner-modal-description"),r=document.getElementById("planner-modal-error"),s=document.getElementById("planner-modal-submit"),a=document.getElementById("planner-lesson-day"),i=document.getElementById("planner-lesson-title"),d=document.getElementById("planner-lesson-summary"),c=document.getElementById("planner-detail-badge"),f=document.getElementById("planner-detail-text"),h=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(s instanceof HTMLElement)||!(a instanceof HTMLSelectElement)||!(i instanceof HTMLInputElement)||!(d instanceof HTMLTextAreaElement))return null;let u=t.querySelector("[data-planner-lesson-section]"),m=t.querySelector("[data-planner-summary-section]"),b=t.querySelector("[data-planner-detail-section]"),E=t.querySelector("[data-planner-duplicate-section]"),S=e.querySelector("[data-planner-modal-dialog]"),D=e.querySelector("[data-planner-modal-backdrop]"),L=e.querySelectorAll("[data-planner-modal-close]"),P=document.getElementById("mainContent"),C=document.querySelector('nav[aria-label="Primary"]'),M=(()=>{let l=[],y=e.parentElement;return C instanceof HTMLElement&&l.push(C),y instanceof HTMLElement?l.push(...Array.from(y.children).filter(v=>v instanceof HTMLElement&&v!==e)):P instanceof HTMLElement&&(P.contains(e)?l.push(...Array.from(P.children).filter(v=>v instanceof HTMLElement&&!v.contains(e))):l.push(P)),l})(),_=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],T={mode:"add",lessonId:null,trigger:null},p=null,g=null,k=l=>{p=l instanceof HTMLElement?l:null},V=l=>{M.forEach(y=>{y&&(l?y.setAttribute("inert",""):y.removeAttribute("inert"))})},j=()=>{if(!(S instanceof HTMLElement))return[];let l=S.querySelectorAll(_.join(","));return Array.from(l).filter(y=>{if(y.closest('[aria-hidden="true"]')||"disabled"in y&&y.disabled)return!1;let v=y.getBoundingClientRect();return v.width>0&&v.height>0})},Sn=()=>{let l=j(),y=(p&&l.includes(p)?p:null)||l[0]||S;y&&typeof y.focus=="function"&&y.focus({preventScroll:!0})},Tn=l=>{S instanceof HTMLElement&&(S.contains(l.target)||Sn())},or=l=>{if(l.key!=="Tab")return;let y=j();if(!y.length){l.preventDefault();return}let v=y[0],Ie=y[y.length-1];if(l.shiftKey&&document.activeElement===v){l.preventDefault(),Ie.focus();return}!l.shiftKey&&document.activeElement===Ie&&(l.preventDefault(),v.focus())},wn=l=>{if(l.key==="Escape"){l.preventDefault(),X();return}or(l)},vn=()=>{r&&(r.textContent="",r.classList.add("hidden"),r.setAttribute("aria-hidden","true"))},te=l=>{r&&(r.textContent=l,r.classList.remove("hidden"),r.removeAttribute("aria-hidden"))},Ln=l=>{s.disabled=!!l,s.classList.toggle("loading",!!l)},N=(l,y)=>{l instanceof HTMLElement&&(l.classList.toggle("hidden",!y),y?l.removeAttribute("aria-hidden"):l.setAttribute("aria-hidden","true"))},je=l=>{[a,i,d].forEach(y=>{y instanceof HTMLElement&&(y.disabled=!!l,y.classList.toggle("opacity-60",!!l),y.classList.toggle("cursor-not-allowed",!!l))})},ke=()=>{t.reset(),vn(),k(null),je(!1),c instanceof HTMLInputElement&&(c.value=""),(f instanceof HTMLTextAreaElement||f instanceof HTMLInputElement)&&(f.value=""),h instanceof HTMLInputElement&&(h.value="")},ze=({title:l,description:y,action:v})=>{n&&(n.textContent=l||"Plan lesson"),o&&(o.textContent=y||""),s.textContent=v||"Save lesson"},Ke=({trigger:l}={})=>{T.trigger=l instanceof HTMLElement?l:null,g=T.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),V(!0),document.addEventListener("keydown",wn,!0),e.addEventListener("focusin",Tn,!0),window.requestAnimationFrame(()=>{Sn()})},X=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),V(!1),document.removeEventListener("keydown",wn,!0),e.removeEventListener("focusin",Tn,!0);let l=T.trigger||g;T.mode="add",T.lessonId=null,T.trigger=null,k(null),ke(),l&&typeof l.focus=="function"&&l.focus({preventScroll:!0})},rr=({defaultDay:l="Monday",trigger:y}={})=>{T.mode="add",T.lessonId=null,ke(),N(u,!0),N(m,!0),N(b,!1),N(E,!1),je(!1);let v=typeof l=="string"&&l.trim()?l.trim():"Monday";a.value=v,a.value!==v&&(a.value="Monday"),i.value=v?`${v} lesson`:"",d.value="",ze({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),k(i),Ke({trigger:y})},sr=({lesson:l,trigger:y}={})=>{if(!l)return;T.mode="edit",T.lessonId=l.id,ke(),N(u,!0),N(m,!0),N(b,!1),N(E,!1),je(!1);let v=l.dayLabel||l.dayName||"Monday";a.value=v,a.value!==v&&(a.value="Monday"),i.value=l.title||"",d.value=l.summary||"",ze({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),k(i),Ke({trigger:y})},ar=({lesson:l,trigger:y}={})=>{if(!l)return;T.mode="detail",T.lessonId=l.id,ke(),N(u,!0),N(m,!0),N(b,!0),N(E,!1),je(!0);let v=l.dayLabel||l.dayName||"Monday";a.value=v,a.value!==v&&(a.value="Monday"),i.value=l.title||"",d.value=l.summary||"",c instanceof HTMLInputElement&&(c.value=""),(f instanceof HTMLTextAreaElement||f instanceof HTMLInputElement)&&(f.value=""),ze({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),k(f instanceof HTMLElement?f:null),Ke({trigger:y})},ir=({suggestedWeekId:l="",trigger:y}={})=>{T.mode="duplicate",T.lessonId=null,ke(),N(u,!1),N(m,!1),N(b,!1),N(E,!0),h instanceof HTMLInputElement&&(h.value=l),ze({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),k(h instanceof HTMLElement?h:null),Ke({trigger:y})},lr=async l=>{l.preventDefault(),vn(),Ln(!0);try{if(T.mode==="duplicate"){let B=h?.value?.trim();if(!B){te("Enter the Monday date for the destination week.");return}if(B===w){te("Choose a different week to duplicate into.");return}let ie=await no(w,B);ie&&(w=B,x=ie,K(ie),fn(B),q(ie,B),z(ie),X());return}if(T.mode==="detail"){if(!T.lessonId){te("Select a lesson before adding details.");return}let B=f?.value?.trim();if(!B){te("Add text for this detail.");return}let ie=c?.value?.trim()||"",Ce=await $t(w,T.lessonId,{badge:ie,text:B});Ce&&(x=Ce,K(Ce),q(Ce,w),z(Ce),X());return}let y=a.value.trim(),v=i.value.trim(),Ie=d.value.trim();if(!y){te("Choose a day for this lesson.");return}if(!v){te("Enter a lesson title.");return}if(T.mode==="edit"){if(!T.lessonId){te("Select a lesson to edit.");return}let B=await _t(w,T.lessonId,{dayName:y,title:v,summary:Ie});B&&(x=B,K(B),q(B,w),z(B),X());return}let De=await Ot(w,{dayName:y,title:v,summary:Ie});De&&(x=De,K(De),q(De,w),z(De),X())}catch(y){console.error("Failed to save planner change",y),te("Unable to save changes right now. Please try again.")}finally{Ln(!1)}};return t.addEventListener("submit",lr),L.forEach(l=>{l.addEventListener("click",y=>{y.preventDefault(),X()})}),e.addEventListener("click",l=>{l.target===e&&X()}),D?.addEventListener("click",l=>{l.target===D&&X()}),{openAddLesson:rr,openEditLesson:sr,openAddDetail:ar,openDuplicatePlan:ir,close:X}}var uo=document.getElementById("remindersCount"),se=typeof document<"u"?ns():null,fo=document.getElementById("plannerCount"),mo=document.getElementById("plannerSubtitle"),ha=document.getElementById("resourcesCount"),ga=document.getElementById("templatesCount"),rt=document.getElementById("dailySnapshotList"),st=document.getElementById("todaysFocusList"),Q=document.getElementById("weekAtAGlanceList"),Z=null;Q&&(Z=document.createElement("li"),Z.dataset.emptyState="week",Z.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",Z.textContent="No upcoming events this week.");var po=()=>{if(!Q||!Z)return;Q.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?Q.contains(Z)||Q.appendChild(Z):Q.contains(Z)&&Q.removeChild(Z)};Q&&(po(),new MutationObserver(po).observe(Q,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var Xt=e=>{Kt&&(e?Kt.classList.remove("hidden"):Kt.classList.add("hidden"))},Ue={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},yo=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),ho=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),ct=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",un=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},os=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Ro=e=>{if(!e)return"";if(yo)try{return yo.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},rs=e=>{if(!e)return"";if(ho)try{return ho.format(e)}catch{}return e.toLocaleDateString()},Oo=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(Ue,t)?t:"medium"},go=e=>{let t=Oo(e);return Ue[t]?.rank??Ue.medium.rank},ss=e=>{let t=Oo(e);return Ue[t]??Ue.medium},bo=e=>{let t=un(e);return t?t.getTime():Number.POSITIVE_INFINITY};function _o(e=[]){if(!rt)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(o=>({reminder:o,date:un(o)})).filter(({date:o})=>o&&os(o,t)).sort((o,r)=>o.date.getTime()-r.date.getTime());if(!n.length){rt.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}rt.innerHTML="",n.forEach(({reminder:o,date:r})=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=ct(o),s.appendChild(a);let i=Ro(r),d=document.createElement("p");d.className="text-xs text-base-content/70",d.textContent=i?`Due ${i}`:"Due today",s.appendChild(d),rt.appendChild(s)})}function $o(e=[]){if(!st)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,o)=>{let r=go(n)-go(o);if(r!==0)return r;let s=bo(n)-bo(o);return s!==0?s:ct(n).localeCompare(ct(o),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){st.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}st.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let r=document.createElement("div");r.className="flex items-center justify-between gap-3";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=ct(n),r.appendChild(s);let a=ss(n),i=document.createElement("span");i.className=a.badgeClass,i.textContent=a.badgeLabel,r.appendChild(i),o.appendChild(r);let d=un(n),c=document.createElement("p");if(c.className="text-xs text-base-content/70",d){let f=Ro(d),h=rs(d),u=[];f&&u.push(`Due ${f}`),h&&u.push(h),c.textContent=u.length?u.join(" \u2022 "):"Due soon"}else c.textContent="No due date";o.appendChild(c),st.appendChild(o)})}var as=e=>{if(!uo)return;let t=Array.isArray(e)?e.length:0;uo.textContent=String(t)},is=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];as(t),_o(t),$o(t)};document.addEventListener("memoryCue:remindersUpdated",is);_o();$o();var tn=Dn(In),ls={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},at=null,cs=3,Eo=120;function ds(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Eo?t:`${t.slice(0,Eo-1)}\u2026`:""}function us(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let o=n.trim().toLowerCase();return o==="true"||o==="1"||o==="yes"}return!1})}function So(e){if(!ve)return;let t=Array.isArray(e)?e:[];if(!t.length){ve.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Xt(!1);return}let n=t.filter(s=>us(s));if(!n.length){ve.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Xt(!1);return}Xt(!0);let r=n.slice(0,cs).map(s=>{let a=I(ge(s,"title")||"Untitled Cue"),i=ge(s,"details"),d=I(ds(i)),c=d?`<p class="mt-1 text-sm text-base-content/70">${d}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${a}</p>
          ${c}
        </li>
      `}).join("");ve.innerHTML=r}function nn(e,{tone:t="muted"}={}){if(!ee)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),ee.innerHTML=`<p class="${n.join(" ")}">${I(e)}</p>`}function fs(e){if(!ee)return;if(!Array.isArray(e)||e.length===0){nn("No cues yet.");return}let t=e.map(n=>{let o=I(ge(n,"title")||"Untitled Cue"),r=I(ge(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${o}</h2>
            ${r?`<p>${r}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${I(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${I(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");ee.innerHTML=t}async function Ve(){return at||(at=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:o,enableIndexedDbPersistence:r,collection:s,doc:a,getDoc:i,addDoc:d,updateDoc:c,getDocs:f,query:h,orderBy:u,serverTimestamp:m,setDoc:b,arrayUnion:E}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),S=t(),D=S&&S.length?S[0]:e(ls),L=n(D);(function(){let M=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;M&&(M.__persistenceInitialized__||(M.__persistenceInitialized__=!0,(async()=>{try{await o(L),console.info("[Firestore] Persistence: multi-tab enabled")}catch(_){if(_&&_.code==="failed-precondition")try{await r(L),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(T){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",T?.code||T)}else _&&_.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",_?.code||_)}})()))})();let P=s(L,"cues");return{db:L,cuesCollection:P,getCollection:s,doc:a,getDoc:i,addDoc:d,updateDoc:c,getDocs:f,query:h,orderBy:u,serverTimestamp:m,setDoc:b,arrayUnion:E}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),at)}async function ms(){let e=await Ve(),{getDocs:t,cuesCollection:n,query:o,orderBy:r}=e,s=o&&r?o(n,r("createdAt","desc")):n;return(await t(s)).docs.map(i=>({id:i.id,...i.data()}))}async function ps(e){if(!e)return null;let t=await Ve(),{db:n,doc:o,getDoc:r}=t,s=o(n,"cues",e),a=await r(s);return a.exists()?{id:a.id,...a.data()}:null}async function Uo(){if(!(!ee&&!ve))try{let e=await ms();fs(e),So(e)}catch(e){console.error("Failed to load cues",e),Lt(e)?nn("Sign in to view your cues.",{tone:"muted"}):nn("Unable to load cues right now.",{tone:"error"}),So([])}}function ys(e){!he||!Y||(Cn(e,tn),Y.value=e?.id||"",G?.setEditMode(!0),G?.show({mode:"edit"}))}async function hs(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let o=await ps(n);if(!o)return;ys(o)}catch(o){console.error("Failed to prepare cue for editing",o)}}async function gs(e){if(e.preventDefault(),!he||!Y)return;let t=Y.value.trim(),n=Pn(tn);try{let o=await Ve(),{db:r,doc:s,addDoc:a,updateDoc:i,cuesCollection:d,serverTimestamp:c}=o,f=typeof c=="function"?c():null;if(t){let h=s(r,"cues",t),u={...n};f&&(u.updatedAt=f),await i(h,u)}else{let h={...n};f&&(h.createdAt=f,h.updatedAt=f),await a(d,h)}await Uo(),Nn(tn,Y,G?.modalTitle??null,qr),await G?.hide({reason:"form-submit"})}catch(o){console.error("Failed to save cue",o)}}async function bs(){!he||!Y||!ee||(ee.addEventListener("click",hs),he.addEventListener("submit",gs))}he&&Y&&(document.addEventListener("cue:prepare",()=>{Y.value="",G?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{Y.value="",G?.setEditMode(!1)}));he&&Y&&ee&&bs().catch(e=>{console.error("Failed to initialise cue editing",e)});(ee||ve)&&Uo();var A=[],it=null,pe=!1,qe=J(),Oe=!1,w=qe,x=null,He=null,H=null,Le=Te(),bt=new Map,Es=800,Ss=1500,on={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},qo=new Set(["saving","saved","error"]),Wo="plannerNotesOpenState",fe=Ts();function Ts(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Wo);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function ws(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Wo,JSON.stringify(fe))}catch(e){console.warn("Unable to persist planner notes state",e)}}function vs(e){return e?!!fe?.[e]:!1}function Ls(e,t){if(e){if(t)fe={...fe,[e]:!0};else if(fe?.[e]){let n={...fe};delete n[e],fe=n}ws()}}var xs=e=>{if(!fo)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=Zn(qe),fo.textContent=String(t.length)};function q(e,t){if(xs(e),mo){let n=Rt(e?.weekId||t,{short:!0});mo.textContent=n||""}}function rn(e,{tone:t="muted"}={}){if(!R)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),R.innerHTML=`<p class="${n.join(" ")}">${I(e)}</p>`}function fn(e){if(!co)return;let t=Rt(e);co.textContent=t||""}function wt(e){if(!oe)return;Le=Te();let t=Object.values(Le).sort((s,a)=>s.name.localeCompare(a.name)),n=t.length>0,r=[`<option value="">${I(n?"Select template":"No templates saved")}</option>`];t.forEach(s=>{let a=s.name;r.push(`<option value="${I(a)}">${I(a)}</option>`)}),oe.innerHTML=r.join(""),oe.disabled=!n,e&&Le[e]?oe.value=e:oe.value=""}function z(e){let t=e?.templateId||tt();wt(t)}async function As(e,t){let o=(Array.isArray(e?.lessons)?e.lessons:[]).length>0,r=typeof e?.templateId=="string"&&e.templateId.trim().length>0;if(o||r)return e;let s=tt();if(!s||(Le[s]||(Le=Te()),!Le[s]))return e;try{return await Ut(t,s)||e}catch(a){return console.error("Failed to auto apply preferred planner template",a),e}}function K(e){if(!R)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){rn("No lessons saved for this week yet."),H=null;return}let n=t.map(r=>typeof r.id=="string"&&r.id?r.id:"").filter(r=>!!r);H&&!n.includes(H)&&(H=null);let o=t.map(r=>{let s=Array.isArray(r.details)?r.details.map(E=>`
                <li class="flex items-center gap-2">
                  ${E.badge?`<span class="badge badge-outline badge-sm text-secondary">${I(E.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${I(E.text)}</span>
                </li>
              `).join(""):"",a=s?`<ul class="space-y-2 text-sm text-base-content/70">${s}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',i=typeof r.id=="string"?r.id:"",d=!!(H&&i&&H===i),c=["data-planner-lesson",i?`data-lesson-id="${i}"`:"",d?'data-planner-selected="true"':""].filter(Boolean).join(" "),f=r.summary?`<p class="text-sm text-base-content/70">${I(r.summary)}</p>`:"",h=typeof r.notes=="string"?r.notes:"",u=vs(i),m=i?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${i}"
              ${u?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${i}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${I(h)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${I(on.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",b=i?`
            <div class="flex items-center gap-1" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${i}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${i}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${c}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${I(r.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${I(r.title||r.dayLabel||"Lesson")}</h2>
                ${f}
              </div>
              <div class="flex items-center gap-1">
                ${b}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${i}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${i}"
                >
                  Delete
                </button>
            </div>
          </div>
          ${a}
          ${m}
          <div class="flex flex-wrap gap-2">
            <button
              type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${i}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${i}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");R.innerHTML=o,sn(H||null)}function sn(e){if(H=e||null,!R)return;R.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function ks(){return H&&(Array.isArray(x?.lessons)?x.lessons:[]).some(t=>t.id===H)?H:null}function Is(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===H||sn(n)}function Ds(e){let t=en(e?.currentTarget)?e.currentTarget:yt;if(!en(t))return;let n=t.value,o=St.has(n)?n:ht;Po(o),Jr(o),t.value!==o&&(t.value=o)}function Vo(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function Cs(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function jo(e){if(!e)return;let t=bt.get(e);if(!t)return;let n=Cs();n&&n(t),bt.delete(e)}function Me(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&qo.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Fe(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&qo.has(t)?t:null,o=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(o instanceof HTMLElement){let r=n||"idle",s=on[r]||on.idle;o.textContent=s,o.setAttribute("data-status",r)}}async function an(e,t,n){if(!e||!w)return;let o=n instanceof HTMLTextAreaElement?n:null;o&&(Me(o,"saving"),Fe(o,"saving"));try{let r=await _t(w,e,{notes:t});if(r&&(x=r),o){Me(o,"saved"),Fe(o,"saved");let s=Vo();s?s(()=>{o.getAttribute("data-notes-status")==="saved"&&(Me(o,null),Fe(o,null))},Ss):(Me(o,null),Fe(o,null))}}catch(r){console.error("Failed to save planner notes",r),o&&(Me(o,"error"),Fe(o,"error"))}}function Ns(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;jo(n);let o=Vo();if(!o){an(n,t.value,t);return}let r=o(()=>{bt.delete(n),an(n,t.value,t)},Es);bt.set(n,r)}function Ps(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(jo(n),an(n,t.value,t))}function Bs(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let o=t.hasAttribute("open");Ls(n,o)}function we(e){if(!R)return He=null,Promise.resolve();let t=e||J();w=t,fn(t),rn("Loading plan\u2026");let n=(async()=>{try{let o=await $(t);o=await As(o,t),x=o,K(o),q(o,t),z(o)}catch(o){console.error("Failed to load planner week",o),rn("Unable to load this week's planner.",{tone:"error"})}})();return He=n,n.finally(()=>{He===n&&(He=null)})}async function zo(){if(!R)return;Oe||vt();let e=He;if(!e&&(!x||x.weekId!==w)&&(e=we(w)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function Ms(e,t){if(!e)return;await zo();let n=Array.isArray(x?.lessons)?x.lessons:[];if(!n.length)return;let o=n.find(m=>m?.id===e);if(!o)return;let r=typeof o.dayLabel=="string"&&o.dayLabel.trim()?o.dayLabel.trim():typeof o.dayName=="string"&&o.dayName.trim()?o.dayName.trim():"",s=typeof o.title=="string"&&o.title.trim()?o.title.trim():r||"Lesson",a=typeof o.summary=="string"&&o.summary.trim()?o.summary.trim():"",i=a||s,d=r?`${r} \xB7 ${i}`:i,c=a||"",f=es(o),h=ts(Qn(w,f)),u={reminderTitle:d,reminderNotes:c,dueDate:h,dayLabel:r,lessonTitle:s,summary:a,plannerLessonId:e};qt("cue:prepare",{trigger:t,source:"planner"}),qt("planner:prefillReminder",u),qt("cue:open",{trigger:t,source:"planner"})}async function Fs(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),o=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":_s(o,t);break;case"edit":$s(o,t);break;case"delete":Us(o);break;case"move-up":To(o,"up",t);break;case"move-down":To(o,"down",t);break;case"create-reminder":await Ms(o,t);break;default:break}}async function Ko(e){if(typeof document>"u"||!se)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=x?.lessons?.[0]?.dayLabel||"Monday";se.openAddLesson({defaultDay:n,trigger:t})}async function Hs(e){if(!se)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=et(w,1);se.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function Rs(e){if(!oe)return;let t=e?.currentTarget instanceof HTMLSelectElement?e.currentTarget:oe,n=t.value?.trim();if(n){t.disabled=!0;try{let o=await Ut(w,n);o&&(x=o,K(o),q(o,w),z(o))}catch(o){console.error("Failed to apply planner template",o),window.alert("Unable to apply that template right now.")}finally{wt(n)}}}async function Os(e){if(e?.preventDefault?.(),!Do)return;let t=x||await $(w),n=Array.isArray(t?.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let o=typeof window<"u"?window.prompt("Name this template:",t?.templateId||""):null,r=typeof o=="string"?o.trim():"";if(r)try{ro(r,{lessons:n}),wt(r)}catch(s){console.error("Failed to save planner template",s),window.alert("Unable to save that template right now.")}}async function _s(e,t){if(!e||!se)return;let n=x?.lessons?.find(r=>r.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;se.openAddDetail({lesson:n,trigger:o})}async function $s(e,t){if(!e||!se)return;let n=x?.lessons?.find(r=>r.id===e);if(!n)return;let o=t instanceof HTMLElement?t:null;se.openEditLesson({lesson:n,trigger:o})}async function To(e,t,n){if(!e||!t)return;let o=w||J();if(!o)return;let r=n instanceof HTMLElement?n:null;r&&r.setAttribute("disabled","true");try{let s=await to(o,e,t);s&&(x=s,K(s),q(s,o),z(s))}catch(s){console.error("Failed to move planner lesson",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{r&&r.removeAttribute("disabled")}}async function Us(e){if(!e||typeof window>"u")return;let t=x?.lessons?.find(o=>o.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let o=await eo(w,e);o&&(x=o,K(o),q(o,w),z(o))}catch(o){console.error("Failed to delete planner lesson",o),window.alert("Unable to delete that lesson right now.")}}function vt(){if(Oe||!R){Oe&&we(w);return}Oe=!0,Jn({ensureFirestore:Ve}),R.addEventListener("click",Is),R.addEventListener("click",Fs),R.addEventListener("input",Ns),R.addEventListener("focusout",Ps),R.addEventListener("toggle",Bs),Kr?.addEventListener("click",Ko),zr?.addEventListener("click",Hs),oe?.addEventListener("change",Rs),yt?.addEventListener("change",Ds),Do?.addEventListener("click",Os),Wr?.addEventListener("click",()=>{let e=et(w,-1);we(e)}),Vr?.addEventListener("click",()=>{let e=et(w,1);we(e)}),jr?.addEventListener("click",()=>{we(J())}),wt(tt()),we(w)}function wo(){typeof window>"u"||xo()==="planner"&&vt()}function qs(e){let t=e?.detail?.plan;t&&(Oe&&t.weekId===w&&(x=t,K(t),fn(t.weekId),z(t)),t.weekId===qe&&q(t,qe))}q(null,qe);typeof document<"u"&&document.addEventListener(Pt,qs);typeof window<"u"&&(window.addEventListener("hashchange",wo),window.addEventListener("DOMContentLoaded",wo));var Yo="dailyTasksByDate",lt=null;function mn(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function Ws(e){if(typeof e!="string")return"";let[t,n,o]=e.split("-"),r=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(o,10);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(a))return e;let i=new Date(r,s-1,a);return Number.isNaN(i.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(i)}function We(e){if(!Zt)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);Zt.disabled=!t}function ye(e){if(!me)return;if(!Array.isArray(e)||e.length===0){me.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',We([]);return}let t=e.map((n,o)=>{let r=I(n?.text||""),s=!!n?.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return s&&a.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${o}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${o}" data-task-text="${r}" ${s?"checked":""} />
          <span class="${a.join(" ")}">${r}</span>
        </div>
      `}).join("");me.innerHTML=t,We(e)}function Et(){pt&&pt.classList.remove("hidden")}function Vs(){pt&&pt.classList.add("hidden")}function pn(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Ae(e){return Array.isArray(e)?e.map(t=>pn(t)):[]}function yn(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Yo);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function Go(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Yo,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function vo(e){let t=yn(),n=t&&typeof t=="object"?t[e]:[];return Ae(n)}function dt(e,t){let n=yn(),o=Ae(t);return n[e]=o,Go(n),o}function Jt(e,t){let n=yn(),o=Ae(n[e]);return o.push(pn(t)),n[e]=o,Go(n),o}function Lt(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function hn(){return lt||(lt=Ve().then(e=>{let{db:t,getCollection:n}=e,o=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:o}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),lt)}function gn(e,t){let{doc:n,dailyListsCollection:o,db:r}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return o?n(o,t):n(r,"dailyLists",t)}async function bn(){if(!lo||!me)return;let e=mn(),t=Ws(e);if(lo.textContent=t?`Today's List - ${t}`:"Today's List",pe){Et();let n=vo(e);return A=n,ye(n),Promise.resolve(n)}return it||(me.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',We([]),it=(async()=>{try{let n=await hn(),o=gn(n,e),r=await n.getDoc(o),s=r.exists()?r.data()?.tasks:[];return A=Ae(s),ye(A),dt(e,A),pe=!1,Vs(),A}catch(n){if(Lt(n)){console.warn("Falling back to local daily tasks due to permission issue",n),pe=!0,Et();let o=vo(e);return A=o,ye(o),o}return console.error("Failed to load daily list",n),me.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',A=[],We(A),A}})().finally(()=>{it=null})),it}async function js(e){let t=mn(),n=pn(e);if(pe){Jt(t,n);return}try{let o=await hn(),r=gn(o,t),s=await o.getDoc(r);if(s.exists()&&typeof o.arrayUnion=="function")await o.updateDoc(r,{tasks:o.arrayUnion(n)});else{let a=s.exists()?s.data()?.tasks:[],i=Array.isArray(a)?Ae(a):[];i.push(n),typeof o.setDoc=="function"?await o.setDoc(r,{tasks:i},{merge:!0}):await o.updateDoc(r,{tasks:i})}Jt(t,n)}catch(o){if(Lt(o)){console.warn("Saving task locally because cloud sync is unavailable",o),pe=!0,Et(),Jt(t,n);return}throw o}}async function Xo(e){let t=mn(),n=Ae(e);if(pe){dt(t,n);return}try{let o=await hn(),r=gn(o,t);typeof o.setDoc=="function"?await o.setDoc(r,{tasks:n},{merge:!0}):await o.updateDoc(r,{tasks:n}),dt(t,n)}catch(o){if(Lt(o)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",o),pe=!0,Et(),dt(t,n);return}throw o}}function Jo(e){[ft,mt].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function zs(){!_e||!$e||(_e.classList.remove("hidden"),$e.classList.add("hidden"),Jo(ft))}function Ks(){!_e||!$e||(_e.classList.add("hidden"),$e.classList.remove("hidden"),Jo(mt),bn())}ft&&mt&&_e&&$e&&(ft.addEventListener("click",e=>{e.preventDefault(),zs()}),mt.addEventListener("click",e=>{e.preventDefault(),Ks()}));var F=null,W=!1,ut=null;function xe(e){if(!U)return;U.setAttribute("aria-pressed",e?"true":"false");let t=U.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":U.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function Ys(){W&&(window.clearTimeout(ut),ut=window.setTimeout(()=>{ut=null,W&&Qo(!0)},400))}function Qo(e=!1){if(!F)return!1;if(W&&!e)return!0;try{return F.start(),W=!0,xe(!0),!0}catch{return W=!1,xe(!1),!1}}function En(){if(F){W=!1,window.clearTimeout(ut);try{F.stop()}catch{}xe(!1)}}function Gs(){if(U)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){U.setAttribute("disabled","true"),U.setAttribute("aria-disabled","true"),U.title="Voice input is not supported in this browser.";return}F=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(F.lang=t,F.interimResults=!1,"continuous"in F)try{F.continuous=!0}catch{}F.onresult=n=>{let o=n?.results?.[0]?.[0]?.transcript||"";if(o&&O){O.value=o.trim();try{O.focus({preventScroll:!0})}catch{O.focus()}try{let r=O.value.length;O.setSelectionRange(r,r)}catch{}}},F.onend=()=>{if(!W){xe(!1);return}Ys()},F.onerror=()=>{W=!1,xe(!1)}}catch{F=null,xe(!1),U.setAttribute("disabled","true"),U.setAttribute("aria-disabled","true")}}Gs();U?.addEventListener("click",()=>{F&&(W?En():Qo())});Io?.addEventListener("submit",()=>{W&&En()});window.addEventListener("pagehide",()=>{W&&En()});Io?.addEventListener("submit",async e=>{if(e.preventDefault(),!O)return;let t=O.value.trim();if(!t){O.focus();return}let n={text:t,completed:!1};O.value="",O.focus();try{await js(n),await bn()}catch(o){console.error("Failed to add task to the daily list",o),O.value=t,O.focus()}});me?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(A)||Number.isNaN(n)||!A[n])return;let o=A.map(s=>({...s})),r=o.map((s,a)=>a===n?{...s,completed:t.checked}:s);A=r,ye(r);try{await Xo(r)}catch(s){console.error("Failed to update task completion state",s),A=o,ye(o)}});Zt?.addEventListener("click",async()=>{if(!Array.isArray(A)||A.length===0)return;let e=A.filter(n=>!n.completed);if(e.length===A.length)return;let t=A.map(n=>({...n}));A=e,ye(e);try{await Xo(e)}catch(n){console.error("Failed to clear completed tasks",n),A=t,ye(t)}});We(A);bn();function Xs(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),o=document.getElementById("noteNewBtn"),r=document.getElementById("notesList");if(!e||!t||!n||!o)return;let s=null,a=u=>{if(!u){s=null,e.value="",t.value="";return}s=u.id,e.value=u.title||"",t.value=u.body||""},i=()=>{if(!r)return;r.querySelectorAll("button[data-note-id]").forEach(m=>{if(!(m instanceof HTMLElement))return;let b=m.getAttribute("data-note-id")===s;m.classList.toggle("bg-base-200/80",b),m.classList.toggle("border-base-300",!b),m.classList.toggle("border-primary",b),m.classList.toggle("font-medium",b),m.setAttribute("aria-current",b?"true":"false")})},d=()=>{let u=Ge();return Array.isArray(u)?[...u].sort((m,b)=>{let E=Date.parse(m?.updatedAt||""),S=Date.parse(b?.updatedAt||"");return(Number.isNaN(S)?0:S)-(Number.isNaN(E)?0:E)}):[]},c=u=>{if(!u)return;let m=Ge();if(!Array.isArray(m))return;let b=m.filter(S=>S.id!==u);if(b.length===m.length)return;kt(b),s===u&&(s=null);let E=f();if(s){let S=E.find(D=>D.id===s)||null;a(S)}else E.length?a(E[0]):a(null);i()},f=(u=d())=>{if(!r)return u;if(r.innerHTML="",!u.length){let m=document.createElement("li");return m.className="text-sm italic text-base-content/60",m.textContent="No saved notes yet.",r.appendChild(m),u}return u.forEach(m=>{let b=document.createElement("li");b.className="flex items-center gap-2";let E=document.createElement("button");E.type="button",E.dataset.noteId=m.id,E.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",E.textContent=m.title||"Untitled note",E.addEventListener("click",()=>{a(m),i()});let S=document.createElement("button");S.type="button",S.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",S.setAttribute("aria-label",`Delete note "${m.title||"Untitled note"}"`),S.textContent="Delete",S.addEventListener("click",D=>{D.stopPropagation(),c(m.id)}),b.appendChild(E),b.appendChild(S),r.appendChild(b)}),i(),u},h=()=>{let u=f();if(!u.length){a(null),i();return}let m=s?u.find(b=>b.id===s):null;a(m||u[0]),i()};n.addEventListener("click",()=>{let u=Ge(),m=Array.isArray(u)?[...u]:[],b=typeof e.value=="string"?e.value.trim():"",E=typeof t.value=="string"?t.value:"",S=b||"Untitled note",D=new Date().toISOString();if(s){let C=m.findIndex(M=>M.id===s);if(C>=0)m[C]={...m[C],title:S,body:E,updatedAt:D};else{let M=At(S,E,{updatedAt:D});s=M.id,m.unshift(M)}}else{let C=At(S,E);s=C.id,m.unshift(C)}kt(m);let L=f(),P=s?L.find(C=>C.id===s):null;a(P||null),i()}),o.addEventListener("click",()=>{s=null,e.value="",t.value="",i(),typeof e.focus=="function"&&e.focus()}),h()}Xs();var Zo="theme",Js="professional",ln="memoryCue:theme-change",Qs="professional",cn=document.getElementById("theme-menu"),er="[data-theme-name],[data-theme-option]",Zs=new Set(["dark","dracula","synthwave"]);function ae(e){return typeof e=="string"?e.trim():""}function tr(e){return e instanceof HTMLElement?ae(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function ea(e){let t=ae(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Zs.has(t)))}function Lo(e){let t=ae(e);if(t)try{localStorage.setItem(Zo,t)}catch(n){console.warn("Unable to save theme preference",n)}}function nr(e){if(!cn)return;let t=ae(e);cn.querySelectorAll(er).forEach(o=>{if(!(o instanceof HTMLElement))return;let r=tr(o),s=t&&r===t;o.setAttribute("aria-checked",s?"true":"false"),o.classList.toggle("active",s)})}function ta(e){let t=ae(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(ln,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let o=document.createEvent("CustomEvent");o.initCustomEvent(ln,!0,!0,{theme:t}),window.dispatchEvent(o)}}}function dn(e,{persist:t=!0,notify:n=!0}={}){let o=ae(e);if(!o)return;ae(document.documentElement.getAttribute("data-theme"))!==o&&ea(o),t&&Lo(o),nr(o),n&&ta(o)}function na(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){dn(Qs,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(Zo)||""}catch(o){console.warn("Unable to load theme preference",o)}let n=t||document.documentElement.getAttribute("data-theme")||Js;n&&dn(n,{persist:!1,notify:!0})}cn?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(er):null;if(!t)return;e.preventDefault();let n=tr(t);n&&dn(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(ln,e=>{let t=ae(e?.detail?.theme);t&&nr(t)});na()});export default oa();
