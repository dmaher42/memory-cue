import{a as ws,b as po,c as ft,d as yo,f as rn,g as mt,h as ln,i as go,j as vs,k as bo}from"./chunk-P37YOGFR.js";import{a as Es,b as mo}from"./chunk-MG4MJA24.js";import"./chunk-CTK42JWW.js";import{b as on,c as fo}from"./chunk-GUVSRPRW.js";function Ts(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:s})=>{if(!Array.isArray(s))return null;for(let a of s){if(typeof a!="string"||!a)continue;let o=t.getElementById(a);if(o)return{key:n,element:o}}return null}).filter(n=>!!(n&&n.element))}function Ie(e,t){if(!e||typeof e!="object")return"";let n=ho[t]||[t];for(let s of n)if(Object.prototype.hasOwnProperty.call(e,s)){let a=e[s];return a==null?"":typeof a=="string"?a:String(a)}return""}function Eo(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function wo(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function Ls(e,t){Array.isArray(t)&&t.forEach(({key:n,element:s})=>{let a=e&&typeof e=="object"?Ie(e,n):"";Eo(s,a)})}function xs(e,t,n,s){Array.isArray(e)&&e.forEach(({element:a})=>{a instanceof HTMLInputElement?["checkbox","radio"].includes(a.type)?a.checked=!1:a.value="":(a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement)&&(a.value="")}),t&&(t.value=""),n&&(n.textContent=s)}function As(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:s})=>{let a=wo(s);if(typeof a=="boolean"){t[n]=a;return}let o=typeof a=="string"?a.trim():a;t[n]=o??""}),t}function v(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Ss,ho,cn,dn,ks=on(()=>{Ss=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],ho={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},cn="Create Cue",dn="Edit Cue"});function Is(e){return new un(e)}var vo,So,un,Ds=on(()=>{vo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),So={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},un=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...So,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let s=n[0],a=n[n.length-1],o=document.activeElement;t.shiftKey&&o===s?(t.preventDefault(),a.focus()):!t.shiftKey&&o===a&&(t.preventDefault(),s.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(vo)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let s=this.events[t];if(!s||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let a=new CustomEvent(s,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(a)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Cs,Ns,fn,mn,yt,To,Ue,Ms,Bs,ht,Ps,Lo,Fs,Ce,xo,Ao,ko,Io,Et,Hs,Do,pn,be,Co,$s,qe,Rs,No,_s,yn,Mo,Bo,Po,gn,gt,je,pt,De,ye,Os,re,bn,js,Us,bt,Fo,Oe,ie,qs,wt,vt,ge,Vs,Ws,zs,le,Ve,St,hn,Ys,Y,We,ce,Ks,Gs,Xs,En,wn,Js,Qs=on(()=>{Cs="memoryCue:plannerPlans",Ns="memoryCue:plannerTimetable",fn="memoryCue:plannerUpdated",mn="memoryCue:plannerTimetableUpdated",yt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],To=["monday","tuesday","wednesday","thursday","friday"],Ue=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},Ms=e=>{if(!Ue()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},Bs=e=>{try{return JSON.parse(e)}catch{return null}},ht=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Ps=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,Lo=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),s=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-s),t},Fs=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},Ce=e=>{if(typeof e!="string")return null;let[t,n,s]=e.split("-"),a=Number.parseInt(t,10),o=Number.parseInt(n,10),i=Number.parseInt(s,10);if(!Number.isFinite(a)||!Number.isFinite(o)||!Number.isFinite(i))return null;let r=new Date(a,o-1,i);return Number.isNaN(r.getTime())?null:(r.setHours(0,0,0,0),r)},xo=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=yt.findIndex(s=>s.toLowerCase()===t);return n>=0?n:0},Ao=e=>{if(typeof e!="string")return 1;let t=e.trim().toLowerCase(),n=To.indexOf(t);return n>=0?n+1:1},ko=new Set(["not_started","in_progress","ready","taught"]),Io=new Set(["simple","hpe","english","cac","custom"]),Et=e=>{if(!e||typeof e!="object")return null;let t=typeof e.id=="string"&&e.id.trim()?e.id:ht(),n=typeof e.day=="string"&&e.day.trim()?e.day.trim().toLowerCase():"monday",s=Ao(n),a=typeof e.period=="string"?e.period.trim():"",o=typeof e.className=="string"?e.className.trim():"",i=typeof e.subject=="string"?e.subject.trim():"";return o?{id:t,day:n,dayIndex:s,period:a,className:o,subject:i}:null},Hs=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:ht(),badge:n,text:t}},Do=e=>{if(!e||typeof e!="object")return null;let t=typeof e.label=="string"?e.label.trim():"",n=typeof e.url=="string"?e.url.trim():"";return!t&&!n?null:{id:typeof e.id=="string"&&e.id.trim()?e.id:ht(),label:t,url:n}},pn=(e,t={})=>{let n=typeof t=="object"&&t?t:{},s=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:xo(e?.dayName||n.dayName||n.dayLabel),a=Ps(s),o=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():yt[a],i=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",l=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(k=>Hs(k)).filter(Boolean),u=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:ht(),d=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,m=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",T=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"",g=typeof e?.status=="string"?e.status.trim().toLowerCase():"",I=ko.has(g)?g:"not_started",C=typeof e?.templateType=="string"?e.templateType.trim().toLowerCase():"",H=Io.has(C)?C:"simple",D=(Array.isArray(e?.resources)?e.resources:Array.isArray(n.resources)?n.resources:[]).map(k=>Do(k)).filter(Boolean),b=typeof e?.weekDay=="string"?e.weekDay.trim():typeof n.weekDay=="string"?n.weekDay.trim():yt[a],h=typeof e?.period=="string"?e.period.trim():typeof n.period=="string"?n.period.trim():"",w=typeof e?.timetableEntryId=="string"&&e.timetableEntryId.trim()?e.timetableEntryId.trim():typeof n.timetableEntryId=="string"&&n.timetableEntryId.trim()?n.timetableEntryId.trim():"",L=typeof e?.weekStartDate=="string"&&e.weekStartDate?e.weekStartDate:typeof n.weekStartDate=="string"?n.weekStartDate:"";return{id:u,dayIndex:a,dayLabel:yt[a]||"Lesson",title:o,summary:i,details:l,notes:m,subject:T,status:I,templateType:H,resources:D,weekDay:b,period:h,timetableEntryId:w,weekStartDate:L,position:Number.isFinite(d)?d:null}},be=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let s=Number.isFinite(t.position),a=Number.isFinite(n.position);return s&&a&&t.position!==n.position?t.position-n.position:s&&!a?-1:!s&&a?1:t.title.localeCompare(n.title)}),Co=e=>{let t=new Map;return e.forEach(n=>{let s=String(n.dayIndex),a=t.get(s)??0;Number.isFinite(n.position)?t.set(s,Math.max(a,n.position+1)):(n.position=a,t.set(s,a+1))}),e},$s=(e,t,n)=>{let s=e.filter(a=>!(a.dayIndex!==t||n&&a.id===n));return s.length?s.reduce((a,o)=>Number.isFinite(o.position)?Math.max(a,o.position):a,-1)+1:0},qe=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,s=Ce(n),a=s?s.toISOString():"",o=Array.isArray(e?.lessons)?Co(e.lessons.map(i=>pn(i,{weekStartDate:a})).filter(Boolean)):[];return{weekId:n,startDate:a,lessons:be(o),teacherNotes:typeof e?.teacherNotes=="string"?e.teacherNotes:"",updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString()}},Rs=()=>{if(!Ue())return{};try{let e=Ms(Cs);if(typeof e!="string"||!e.length)return{};let t=Bs(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},No=e=>{if(Ue())try{window.localStorage.setItem(Cs,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},_s=e=>{if(!e)return null;let n=Rs()[e];return n?qe(n,e):null},yn=(e,t)=>{if(!e||!t)return t;let n=Rs();return n[e]=t,No(n),t},Mo=()=>{if(!Ue())return[];try{let e=Ms(Ns);if(typeof e!="string"||!e.length)return[];let t=Bs(e);return Array.isArray(t)?t:[]}catch(e){return console.warn("Unable to read timetable data from storage",e),[]}},Bo=e=>{if(Ue())try{let t=JSON.stringify(e||[]);window.localStorage.setItem(Ns,t)}catch(t){console.warn("Unable to persist timetable locally",t)}},Po=()=>Mo().map(t=>Et(t)).filter(Boolean),gn=e=>{let t=Array.isArray(e)?e.map(n=>Et(n)).filter(Boolean):[];return Bo(t),t},gt=new Map,je=null,pt=null,De=!1,ye=null,Os=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},re=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(fn,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},bn=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(mn,{detail:{timetable:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch timetable update event",t)}},js=async()=>je?pt||(pt=je().then(e=>{let{db:t,getCollection:n}=e||{},s=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:s}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),pt):null,Us=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:s,db:a}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return s?n(s,t):n(a,"plannerPlans",t)},bt=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&gt.set(e.weekId,e),e),Fo=e=>qe({weekId:e,lessons:[]},e),Oe=e=>{let t=_s(e);if(t)return bt(t),t;let n=Fo(e);return yn(e,n),bt(n),n},ie=async e=>{if(!e?.weekId)return e;let t=qe(e,e.weekId);if(yn(t.weekId,t),bt(t),De||!je)return t;try{let n=await js();if(!n)return t;let s=Us(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(s,t,{merge:!0}):await n.updateDoc(s,t),t}catch(n){return Os(n)?(console.warn("Persisting planner data locally due to permission issue",n),De=!0,t):(console.error("Failed to persist planner plan",n),t)}},qs=(e={})=>{typeof e.ensureFirestore=="function"&&(je=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(De=e.forceLocal)},wt=()=>(Array.isArray(ye)||(ye=Po()),ye),vt=(e=[])=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let s=t.period||"",a=n.period||"";return s&&a&&s!==a?s.localeCompare(a,void 0,{numeric:!0,sensitivity:"base"}):t.className.localeCompare(n.className)}),ge=()=>{let e=wt();return vt(e)},Vs=async e=>{let t=Et(e);if(!t)return ge();let n=wt(),s=vt([...n.filter(Boolean),t]);return ye=s,gn(s),bn(s),s},Ws=async(e,t={})=>{if(!e)return ge();let n=wt(),s=n.findIndex(r=>r.id===e);if(s===-1)return ge();let a={...n[s],...t,id:e},o=Et(a);if(!o)return ge();let i=vt(n.map((r,l)=>l===s?o:r).filter(Boolean));return ye=i,gn(i),bn(i),i},zs=async e=>{if(!e)return ge();let t=wt(),n=vt(t.filter(s=>s.id!==e));return ye=n,gn(n),bn(n),n},le=(e=new Date)=>{let t=Lo(e);return Fs(t)},Ve=(e,t=0)=>{let n=Ce(e);if(!n||!Number.isFinite(t))return e;let s=new Date(n);return s.setDate(n.getDate()+t*7),Fs(s)},St=(e=le(),t=0)=>{let n=Ce(e);if(!n)return null;let s=Number.isFinite(t)?t:0,a=Ps(s),o=new Date(n);return o.setDate(n.getDate()+a),o},hn=(e,{short:t=!1}={})=>{let n=Ce(e);if(!n)return"";let s=new Date(n);s.setDate(n.getDate()+6);let a=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),o=a.format(n),i=a.format(s),r=n.getFullYear()===s.getFullYear();if(t)return`Week of ${o}`;let l=r?n.getFullYear():`${n.getFullYear()} \u2013 ${s.getFullYear()}`;return`${o} \u2013 ${i}, ${l}`},Ys=(e=le())=>{if(!e)return[];let t=gt.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=_s(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},Y=async(e=le())=>{if(!e)return null;if(gt.has(e))return gt.get(e);if(De||!je)return Oe(e);try{let t=await js();if(!t)return Oe(e);let n=Us(t,e),s=await t.getDoc(n);if(s.exists()){let o=s.data(),i=qe({...o,weekId:e},e);return yn(e,i),bt(i),De=!1,i}let a=Oe(e);return typeof t.setDoc=="function"&&await t.setDoc(n,a,{merge:!0}),a}catch(t){return Os(t)?(console.warn("Falling back to local planner data due to permission issue",t),De=!0,Oe(e)):(console.error("Failed to load planner data",t),Oe(e))}},We=async(e,t)=>{if(!e)return null;let n=await Y(e),s=Ce(e),a=s?s.toISOString():"",o=pn(t,{weekStartDate:a});o.weekStartDate||(o.weekStartDate=a),o.position=$s(n?.lessons||[],o.dayIndex);let i={...n,lessons:be([...n?.lessons||[],o]),updatedAt:new Date().toISOString()},r=await ie(i);return re(r),r},ce=async(e,t,n={})=>{if(!e||!t)return null;let s=await Y(e),a=[...s?.lessons||[]],o=a.findIndex(d=>d.id===t);if(o===-1)return s;let i=a[o],r=pn({...i,...n,id:t},{...i,weekStartDate:i.weekStartDate||s?.startDate||""});if(r.dayIndex!==i.dayIndex){let d=a.filter((m,T)=>T!==o);r.position=$s(d,r.dayIndex)}a[o]=r;let l={...s,lessons:be(a),updatedAt:new Date().toISOString()},u=await ie(l);return re(u),u},Ks=async(e,t="")=>{if(!e)return null;let n=await Y(e),s={...n,teacherNotes:typeof t=="string"?t:n?.teacherNotes||"",updatedAt:new Date().toISOString()},a=await ie(s);return re(a),a},Gs=async(e,t)=>{if(!e||!t)return null;let n=await Y(e),s=(n?.lessons||[]).filter(i=>i.id!==t),a={...n,lessons:be(s),updatedAt:new Date().toISOString()},o=await ie(a);return re(o),o},Xs=async(e,t,n)=>{if(!e||!t||!n)return null;let s=n==="up"?-1:n==="down"?1:0;if(!s)return Y(e);let a=await Y(e),o=[...a?.lessons||[]],i=o.findIndex(D=>D.id===t);if(i===-1)return a;let r=o[i],l=o.filter(D=>D.dayIndex===r.dayIndex);if(l.length<=1)return a;let d=be(l).map(D=>D.id),m=d.indexOf(t);if(m===-1)return a;let T=m+s;if(T<0||T>=d.length)return a;let[g]=d.splice(m,1);d.splice(T,0,g);let I=new Map(d.map((D,b)=>[D,b])),C=o.map(D=>{if(D.dayIndex!==r.dayIndex)return D;let b=I.get(D.id);return typeof b=="number"?{...D,position:b}:D}),H={...a,lessons:be(C),updatedAt:new Date().toISOString()},N=await ie(H);return re(N),N},En=async(e,t,n)=>{if(!e||!t)return null;let s=await Y(e),a=[...s?.lessons||[]],o=a.findIndex(m=>m.id===t);if(o===-1)return s;let i=Hs(n);if(!i)return s;let r=a[o],l={...r,details:[...r.details||[],i]};a[o]=l;let u={...s,lessons:be(a),updatedAt:new Date().toISOString()},d=await ie(u);return re(d),d},wn=async(e,t)=>{if(!e||!t)return null;let n=await Y(e),s=Ce(t),a=s?s.toISOString():"",o=(n?.lessons||[]).map(l=>({title:l.title,summary:l.summary,dayIndex:l.dayIndex,notes:typeof l.notes=="string"?l.notes:"",subject:typeof l.subject=="string"?l.subject:"",period:typeof l.period=="string"?l.period:"",weekDay:typeof l.weekDay=="string"?l.weekDay:"",templateType:typeof l.templateType=="string"?l.templateType:"simple",status:"not_started",timetableEntryId:typeof l.timetableEntryId=="string"?l.timetableEntryId:"",weekStartDate:a,resources:Array.isArray(l.resources)?l.resources.map(u=>({label:u?.label||"",url:u?.url||""})):[],details:(l.details||[]).map(u=>({badge:u.badge,text:u.text}))})),i=qe({weekId:t,lessons:o,teacherNotes:typeof n?.teacherNotes=="string"?n.teacherNotes:""},t);i.updatedAt=new Date().toISOString();let r=await ie(i);return re(r),r},Js=async e=>{if(!e)return null;let t=await Y(e);if(!t)return null;let n={...t,lessons:[],updatedAt:new Date().toISOString()},s=await ie(n);return re(s),s}});var ki=fo(()=>{mo();yo();ks();Ds();po();go();bo();Qs();Es();function Ho(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let s=document.querySelectorAll("[data-open-reminder-modal]");if(!s.length)return;if(!e){let f=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};s.forEach(E=>{E.addEventListener("click",P=>{if(P.preventDefault(),typeof window<"u"){let M="#reminders";window.location.hash!==M&&(window.location.hash=M),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{f()})})});return}let a=e.querySelector("[data-reminder-modal-backdrop]"),o=e.querySelectorAll("[data-close-modal]"),i=document.getElementById("mainContent"),r=document.querySelector('nav[aria-label="Primary"]'),l=[i,r],u=e.querySelector('[role="dialog"]')??e,d=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],m=null,T=()=>{if(!(u instanceof HTMLElement))return[];let f=u.querySelectorAll(d.join(","));return Array.from(f).filter(E=>{let P=E instanceof HTMLElement,M=typeof SVGElement<"u"&&E instanceof SVGElement;if(!P&&!M||E.getAttribute("aria-hidden")==="true"||"disabled"in E&&E.disabled||E.hidden||E.closest("[hidden]"))return!1;let x=E.getBoundingClientRect();return x.width>0&&x.height>0})},g=()=>{let f=T(),E=f.find(P=>P.hasAttribute("data-autofocus")||P.hasAttribute("autofocus"))||(n&&f.includes(n)?n:null)||f[0];if(E&&typeof E.focus=="function"){E.focus({preventScroll:!0});return}u instanceof HTMLElement&&typeof u.focus=="function"&&u.focus({preventScroll:!0})},I=f=>{u instanceof HTMLElement&&(!(f.target instanceof Node)||!u.contains(f.target))&&(f.stopPropagation(),g())},C=f=>{if(f.key!=="Tab")return;let E=T();if(!E.length){f.preventDefault(),u instanceof HTMLElement&&u.focus({preventScroll:!0});return}let P=E[0],M=E[E.length-1],x=document.activeElement;if(f.shiftKey){(!u.contains(x)||x===P)&&(f.preventDefault(),M.focus());return}(!u.contains(x)||x===M)&&(f.preventDefault(),P.focus())},H=f=>{l.forEach(E=>{E&&(f?E.setAttribute("inert",""):E.removeAttribute("inert"))})},N=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),H(!1),document.removeEventListener("keydown",D,!0),e.removeEventListener("keydown",C,!0),e.removeEventListener("focusin",I,!0),m&&typeof m.focus=="function"&&m.focus(),m=null},D=f=>{f.key==="Escape"&&(f.preventDefault(),N())},b=({triggerElement:f}={})=>{f&&typeof f.focus=="function"?m=f:m=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),H(!0),document.addEventListener("keydown",D,!0),e.addEventListener("keydown",C,!0),e.addEventListener("focusin",I,!0),window.requestAnimationFrame(()=>{g()})},h=(f,E={})=>{try{document.dispatchEvent(new CustomEvent(f,{detail:E}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let P=document.createEvent("CustomEvent");P.initCustomEvent(f,!0,!0,E),document.dispatchEvent(P)}}},w=(f={})=>{h("cue:cancelled",f)};s.forEach(f=>{f.addEventListener("click",E=>{E.preventDefault();let M={trigger:E.currentTarget instanceof HTMLElement?E.currentTarget:null,mode:"create"};h("cue:prepare",M),h("cue:open",M)})}),o.forEach(f=>{f.addEventListener("click",E=>{E.preventDefault(),w({trigger:f,reason:"button"})})}),e.addEventListener("click",f=>{f.target===e&&w({reason:"backdrop"})}),a?.addEventListener("click",f=>{f.target===a&&w({reason:"backdrop"})}),document.addEventListener("cue:open",f=>{let E=f?.detail?.trigger,P=E instanceof HTMLElement?E:null;b({triggerElement:P})});let L=()=>{N()};document.addEventListener("cue:close",L),document.addEventListener("cue:cancelled",L);let k=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&k instanceof HTMLElement&&t.addEventListener("submit",f=>{f.preventDefault(),!k.matches(":disabled")&&k.click()}),k instanceof HTMLElement&&document.addEventListener("reminder:save",f=>{let E=f?.detail?.trigger;E&&E!==k||k.matches(":disabled")||k.click()})}Ho();function vn(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var Zs=null;function $o(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function Ta(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Ro(e){typeof document>"u"||!e||(window.clearTimeout(Zs),Zs=window.setTimeout(()=>{let t=$o(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Ge(e){let t=e||Ta();t&&Ro(t)}function _o(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Ge()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",s=>{if(!(s.currentTarget instanceof HTMLAnchorElement))return;let a=s.currentTarget.getAttribute("href")||"";if(!a.startsWith("#"))return;s.preventDefault();let o=a||"#dashboard",i=o.replace("#","")||"dashboard";window.location.hash!==o&&(window.location.hash=o),typeof window.renderRoute=="function"&&window.renderRoute(),Ge(i)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Ge()}_o();var ea=document.getElementById("settings-save-button"),Tt=document.getElementById("settings-save-confirmation"),V=document.getElementById("live-status"),Sn=null,he=document.getElementById("resourcePlannerStatus"),Tn=null;document.addEventListener("planner:reminderCreated",e=>{if(!V)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",s=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",a=s?`Reminder saved for ${s}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";V.textContent=a});ea&&Tt&&ea.addEventListener("click",e=>{e.preventDefault(),Tt.classList.remove("hidden"),Tt.textContent="Settings saved!",V&&(V.textContent="Settings saved!"),Sn&&window.clearTimeout(Sn),Sn=window.setTimeout(()=>{Tt.classList.add("hidden")},3e3)});function Oo(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Ge(t),V&&(V.textContent="Opening planner to add a new lesson."),en(),window.requestAnimationFrame(()=>{let s=Ka();s&&typeof s.catch=="function"&&s.catch(a=>{console.error("Planner quick action failed to start new lesson flow",a)})})}function jo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Oo)})}jo();function Ln(e,{tone:t="success"}={}){he&&(he.textContent=e,he.classList.remove("hidden"),he.classList.remove("text-success","text-error"),he.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(Tn&&window.clearTimeout(Tn),Tn=window.setTimeout(()=>{he.classList.add("hidden"),he.textContent=""},4e3))),V&&(V.textContent=e)}function zn(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function Uo(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let s=n.getAttribute("data-resource-title")?.trim(),a=n.getAttribute("data-resource-link")?.trim();if(!s||!a)return;let o="#planner";window.location.hash!==o&&(window.location.hash=o),typeof window.renderRoute=="function"&&window.renderRoute(),Ge("planner"),en(),await Zt();let i=`${s} \u2014 ${a}`,r=Ur(),l=null;try{if(r)l=await En(y,r,{badge:"Resource",text:i});else{let u=zn("lesson"),d=S?.lessons?.[0]?.dayLabel||"Monday";l=await We(y,{id:u,dayName:d,title:s,summary:`Resource link: ${a}`,details:[{badge:"Resource",text:i}]}),l&&(_=u)}if(l){S=l,F(l),O(l,y);let u=r?`Added "${s}" to your selected lesson.`:`Created a lesson for "${s}" in this week's planner.`;Ln(u);return}Ln("Unable to save that resource to the planner right now.",{tone:"error"})}catch(u){console.error("Failed to save resource to planner",u),Ln("Unable to save that resource to the planner right now.",{tone:"error"})}}function qo(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",Uo)})}qo();var La=document.getElementById("reminder-title"),Vo=document.getElementById("reminderText"),Q=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),s=e.querySelector(".modal-backdrop button"),a=document.getElementById("modal-title");return Is({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:s instanceof HTMLElement?s:null,titleInput:La,modalTitle:a instanceof HTMLElement?a:null,defaultTitle:cn,editTitle:dn})})();Q?.setEditMode(!1);var Wo=()=>{let e=!!La;if(!!Vo)return ft({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?ft(n):ft({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};Wo().catch(e=>{console.error("Failed to initialise reminders",e)});var Nn=vs(),xn=ws({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{Nn?.handleSessionChange(e)}});if(xn?.supabase){Nn?.setSupabaseClient(xn.supabase);try{xn.supabase.auth.getSession().then(({data:e})=>{Nn?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var se=document.getElementById("cues-list"),An=document.getElementById("pinnedNotesCard"),Be=document.getElementById("pinnedNotesList"),Se=document.getElementById("cue-form"),J=Se?.querySelector("#cue-id-input"),zo=Q?.defaultTitle||Q?.modalTitle?.textContent?.trim()||cn,_i=Q?.editTitle||dn,Ft=document.getElementById("tab-cues"),Ht=document.getElementById("tab-daily"),Je=document.getElementById("cues-view"),Qe=document.getElementById("daily-list-view"),ta=document.getElementById("daily-list-header"),xa=document.getElementById("quick-add-form"),W=document.getElementById("quick-add-input"),K=document.getElementById("daily-voice-btn"),de=document.getElementById("daily-tasks-container"),Mn=document.getElementById("clear-completed-btn"),$t=document.getElementById("daily-list-permission-notice"),R=document.getElementById("plannerCards")||document.getElementById("planner-grid"),na=document.getElementById("plannerWeekRange"),Yo=document.getElementById("planner-prev"),Ko=document.getElementById("planner-next"),Go=document.getElementById("planner-today"),Xo=document.getElementById("planner-copy-week"),Jo=document.getElementById("planner-clear-week"),Qo=document.getElementById("planner-duplicate-btn"),Zo=document.getElementById("planner-new-lesson-btn"),Bn=document.getElementById("planner-list-view-toggle"),Pn=document.getElementById("planner-week-view-toggle"),Ze=document.getElementById("plannerWeekView"),Rt=document.querySelector("[data-planner-text-size]"),kn=document.querySelector("[data-planner-card-panel]"),sa=document.getElementById("plannerSummaryCount"),_t=document.getElementById("plannerSummaryRange"),aa=document.getElementById("plannerInsightsLessons"),oa=document.getElementById("plannerInsightsSubjects"),ra=document.getElementById("plannerInsightsNotes"),ue=document.getElementById("plannerTeacherNotes"),In=document.getElementById("plannerTeacherNotesStatus"),U=document.getElementById("planner-lesson-timetable"),et=document.getElementById("timetable-form"),Pe=document.getElementById("timetable-list"),$e=document.getElementById("timetable-day"),Fn=document.getElementById("timetable-period"),Ot=document.getElementById("timetable-class"),Hn=document.getElementById("timetable-subject"),jt=document.getElementById("timetable-submit"),ia=document.getElementById("timetable-reset"),Lt=document.querySelector("[data-mobile-notes-text-size]"),Dn=document.querySelector(".mobile-panel--notes"),Aa="plannerTextSizePreference",Ut="default",Gt=new Set(["small","default","large"]),er=["planner-text-small","planner-text-default","planner-text-large"],ka="mobileNotesTextSizePreference",qt="default",Xt=new Set(["small","default","large"]),tr=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function $n(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function nr(){if(typeof localStorage>"u")return Ut;let e=localStorage.getItem(Aa);return e&&Gt.has(e)?e:Ut}function sr(e){typeof localStorage>"u"||!Gt.has(e)||localStorage.setItem(Aa,e)}function Ia(e){if(!kn)return;let t=Gt.has(e)?e:Ut;er.forEach(n=>kn.classList.remove(n)),kn.classList.add(`planner-text-${t}`)}var Da=nr();Ia(Da);$n(Rt)&&(Rt.value=Da);function Ca(){if(typeof localStorage>"u")return qt;let e=localStorage.getItem(ka);return e&&Xt.has(e)?e:qt}function ar(e){typeof localStorage>"u"||!Xt.has(e)||localStorage.setItem(ka,e)}function Na(e){if(!Dn)return;let t=Xt.has(e)?e:qt;tr.forEach(n=>Dn.classList.remove(n)),Dn.classList.add(`mobile-panel--notes-size-${t}`)}var Ma=Ca();Na(Ma);Lt instanceof HTMLSelectElement&&(Lt.value=Ma,Lt.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:qt;if(!Xt.has(t)){Lt.value=Ca();return}ar(t),Na(t)}));var or=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function rr(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=or.findIndex(s=>s.toLowerCase()===t.toLowerCase());return n>=0?n:0}function ir(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function lr(e){if(!e)return"";let t=[],n=typeof e.day=="string"?e.day.trim():"",s=typeof e.period=="string"?e.period.trim():"",a=typeof e.className=="string"?e.className.trim():"";return n&&t.push(n.charAt(0).toUpperCase()+n.slice(1)),s&&t.push(s),a&&t.push(a),t.join(" \u2013 ")}function Vt(e){return Number.isFinite(e)?e<0?0:e>6?6:e:1}function tt(e){if(typeof e!="string")return"Monday";let t=e.trim();return t?t.charAt(0).toUpperCase()+t.slice(1):"Monday"}function Fe(e=""){if(!(U instanceof HTMLSelectElement))return;let t=['<option value="">No timetable link</option>'];Z.forEach(n=>{let s=lr(n)||"Timetable slot",a=e&&n.id===e?"selected":"";t.push(`<option value="${n.id}" ${a}>${v(s)}</option>`)}),U.innerHTML=t.join(""),e&&U.value!==e&&(U.value=e)}function cr(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),s=document.getElementById("planner-modal-description"),a=document.getElementById("planner-modal-error"),o=document.getElementById("planner-modal-submit"),i=document.getElementById("planner-modal-submit-add-another"),r=document.getElementById("planner-lesson-day"),l=document.getElementById("planner-lesson-period"),u=document.getElementById("planner-lesson-title"),d=document.getElementById("planner-lesson-summary"),m=document.getElementById("planner-lesson-subject"),T=document.getElementById("planner-lesson-status"),g=document.getElementById("planner-detail-badge"),I=document.getElementById("planner-detail-text"),C=document.getElementById("planner-duplicate-week"),H=t?.querySelectorAll("[data-summary-template]")||[];if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(o instanceof HTMLElement)||!(r instanceof HTMLSelectElement)||!(l instanceof HTMLInputElement)||!(u instanceof HTMLInputElement)||!(d instanceof HTMLTextAreaElement)||!(T instanceof HTMLSelectElement))return null;let N=t.querySelector("[data-planner-lesson-section]"),D=t.querySelector("[data-planner-summary-section]"),b=t.querySelector("[data-planner-detail-section]"),h=t.querySelector("[data-planner-duplicate-section]"),w=e.querySelector("[data-planner-modal-dialog]"),L=e.querySelector("[data-planner-modal-backdrop]"),k=e.querySelectorAll("[data-planner-modal-close]"),f=document.getElementById("mainContent"),E=document.querySelector('nav[aria-label="Primary"]'),P=(()=>{let c=[],p=e.parentElement;return E instanceof HTMLElement&&c.push(E),p instanceof HTMLElement?c.push(...Array.from(p.children).filter(A=>A instanceof HTMLElement&&A!==e)):f instanceof HTMLElement&&(f.contains(e)?c.push(...Array.from(f.children).filter(A=>A instanceof HTMLElement&&!A.contains(e))):c.push(f)),c})(),M=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],x={mode:"add",lessonId:null,trigger:null},Le=null,xe=null,nn="",rs="",ae="simple",ot="save",pe=c=>{Le=c instanceof HTMLElement?c:null},is=c=>{ot=c},_e=c=>{if(!(T instanceof HTMLSelectElement))return;let p=z[c]?c:"not_started";T.value=p},rt=c=>{let p=typeof c=="string"&&c.trim()?c.trim():"Monday";r.value=p,r.value!==p&&(r.value="Monday")},ao=c=>{let p=Ya(c||"simple");!p||typeof d.value=="string"&&d.value.trim()&&!window.confirm("Replace existing summary with this template?")||(d.value=p,ae=c||"simple",d.focus())},ls=c=>{P.forEach(p=>{p&&(c?p.setAttribute("inert",""):p.removeAttribute("inert"))})},cs=()=>{if(!(w instanceof HTMLElement))return[];let c=w.querySelectorAll(M.join(","));return Array.from(c).filter(p=>{if(p.closest('[aria-hidden="true"]')||"disabled"in p&&p.disabled)return!1;let A=p.getBoundingClientRect();return A.width>0&&A.height>0})},ds=()=>{let c=cs(),p=(Le&&c.includes(Le)?Le:null)||c[0]||w;p&&typeof p.focus=="function"&&p.focus({preventScroll:!0})},us=c=>{w instanceof HTMLElement&&(w.contains(c.target)||ds())},oo=c=>{if(c.key!=="Tab")return;let p=cs();if(!p.length){c.preventDefault();return}let A=p[0],X=p[p.length-1];if(c.shiftKey&&document.activeElement===A){c.preventDefault(),X.focus();return}!c.shiftKey&&document.activeElement===X&&(c.preventDefault(),A.focus())},fs=c=>{if(c.key==="Escape"){c.preventDefault(),ee();return}oo(c)},ms=()=>{a&&(a.textContent="",a.classList.add("hidden"),a.setAttribute("aria-hidden","true"))},oe=c=>{a&&(a.textContent=c,a.classList.remove("hidden"),a.removeAttribute("aria-hidden"))},ps=c=>{o.disabled=!!c,o.classList.toggle("loading",!!c),i instanceof HTMLButtonElement&&(i.disabled=!!c,i.classList.toggle("loading",!!c))},j=(c,p)=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!p),p?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"))},it=c=>{[r,l,u,d,m,T,U].forEach(p=>{p instanceof HTMLElement&&(p.disabled=!!c,p.classList.toggle("opacity-60",!!c),p.classList.toggle("cursor-not-allowed",!!c))}),H.forEach(p=>{p instanceof HTMLButtonElement&&(p.disabled=!!c,p.classList.toggle("opacity-60",!!c),p.classList.toggle("cursor-not-allowed",!!c))})},Ae=()=>{t.reset(),ms(),pe(null),it(!1),Fe(""),U instanceof HTMLSelectElement&&(U.value=""),m instanceof HTMLInputElement&&(m.value=""),l instanceof HTMLInputElement&&(l.value=""),g instanceof HTMLInputElement&&(g.value=""),(I instanceof HTMLTextAreaElement||I instanceof HTMLInputElement)&&(I.value=""),C instanceof HTMLInputElement&&(C.value=""),_e("not_started"),ae="simple",ot="save"},lt=({title:c,description:p,action:A})=>{n&&(n.textContent=c||"Plan lesson"),s&&(s.textContent=p||""),o.textContent=A||"Save lesson"},ct=({trigger:c}={})=>{x.trigger=c instanceof HTMLElement?c:null,xe=x.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),ls(!0),document.addEventListener("keydown",fs,!0),e.addEventListener("focusin",us,!0),window.requestAnimationFrame(()=>{ds()})},ee=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),ls(!1),document.removeEventListener("keydown",fs,!0),e.removeEventListener("focusin",us,!0);let c=x.trigger||xe;x.mode="add",x.lessonId=null,x.trigger=null,pe(null),Ae(),c&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},ro=({defaultDay:c="Monday",trigger:p,timetableEntry:A}={})=>{x.mode="add",x.lessonId=null,Ae(),j(N,!0),j(D,!0),j(b,!1),j(h,!1),it(!1);let X=typeof A?.day=="string"&&A.day.trim()?A.day.charAt(0).toUpperCase()+A.day.slice(1):typeof c=="string"&&c.trim()?c.trim():"Monday";rt(X),u.value=A?.className&&A.className.trim()||(X?`${X} lesson`:""),d.value="",l instanceof HTMLInputElement&&(l.value=A?.period||""),m instanceof HTMLInputElement&&(m.value=A?.subject||""),Fe(A?.id||""),_e("not_started"),ae="simple",lt({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),pe(u),ct({trigger:p})},io=({lesson:c,trigger:p}={})=>{if(!c)return;x.mode="edit",x.lessonId=c.id,Ae(),j(N,!0),j(D,!0),j(b,!1),j(h,!1),it(!1);let A=c.dayLabel||c.dayName||"Monday";rt(A),u.value=c.title||"",d.value=c.summary||"",l instanceof HTMLInputElement&&(l.value=c.period||""),m instanceof HTMLInputElement&&(m.value=c.subject||""),Fe(c.timetableEntryId||""),U instanceof HTMLSelectElement&&(U.value=c.timetableEntryId||""),_e(c.status||"not_started"),ae=c.templateType||"simple",lt({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),pe(u),ct({trigger:p})},lo=({lesson:c,trigger:p}={})=>{if(!c)return;x.mode="detail",x.lessonId=c.id,Ae(),j(N,!0),j(D,!0),j(b,!0),j(h,!1),it(!0);let A=c.dayLabel||c.dayName||"Monday";rt(A),u.value=c.title||"",d.value=c.summary||"",l instanceof HTMLInputElement&&(l.value=c.period||""),m instanceof HTMLInputElement&&(m.value=c.subject||""),_e(c.status||"not_started"),ae=c.templateType||"simple",g instanceof HTMLInputElement&&(g.value=""),(I instanceof HTMLTextAreaElement||I instanceof HTMLInputElement)&&(I.value=""),lt({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),pe(I instanceof HTMLElement?I:null),ct({trigger:p})},co=({suggestedWeekId:c="",trigger:p}={})=>{x.mode="duplicate",x.lessonId=null,Ae(),j(N,!1),j(D,!1),j(b,!1),j(h,!0),C instanceof HTMLInputElement&&(C.value=c),lt({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),pe(C instanceof HTMLElement?C:null),ct({trigger:p})},uo=async c=>{c.preventDefault(),ms(),ps(!0);let p=ot==="add_another";try{if(x.mode==="duplicate"){let $=C?.value?.trim();if(!$){oe("Enter the Monday date for the destination week.");return}if($===y){oe("Choose a different week to duplicate into.");return}let ke=await wn(y,$);ke&&(y=$,Kn($),S=ke,F(ke),O(ke,$),ee());return}if(x.mode==="detail"){if(!x.lessonId){oe("Select a lesson before adding details.");return}let $=I?.value?.trim();if(!$){oe("Add text for this detail.");return}let ke=g?.value?.trim()||"",ut=await En(y,x.lessonId,{badge:ke,text:$});ut&&(S=ut,F(ut),O(ut,y),ee());return}let A=r.value.trim(),X=l?.value?.trim()||"",sn=u.value.trim(),ys=d.value.trim(),an=m?.value?.trim()||"",gs=z[T?.value]?T.value:"not_started",bs=U instanceof HTMLSelectElement?U.value:"",hs=(()=>{let $=St(y,1);return $ instanceof Date&&!Number.isNaN($.getTime())?$.toISOString():""})();if(!A){oe("Choose a day for this lesson.");return}if(!sn){oe("Enter a lesson title.");return}if(x.mode==="edit"){if(!x.lessonId){oe("Select a lesson to edit.");return}let $=await ce(y,x.lessonId,{dayName:A,title:sn,summary:ys,subject:an,period:X,status:gs,timetableEntryId:bs,weekStartDate:hs,templateType:ae||"simple"});$&&(S=$,F($),O($,y),ee());return}let dt=await We(y,{dayName:A,title:sn,summary:ys,subject:an,period:X,status:gs,timetableEntryId:bs,weekStartDate:hs,templateType:ae||"simple"});dt&&(S=dt,F(dt),O(dt,y),p?(nn=A,rs=an,Ae(),rt(nn||"Monday"),u.value=r.value?`${r.value} lesson`:"",m instanceof HTMLInputElement&&(m.value=rs||""),_e("not_started"),ae="simple",pe(u)):ee())}catch(A){console.error("Failed to save planner change",A),oe("Unable to save changes right now. Please try again.")}finally{ps(!1),ot="save"}};return i instanceof HTMLButtonElement&&i.addEventListener("click",()=>is("add_another")),o.addEventListener("click",()=>is("save")),H.forEach(c=>{c instanceof HTMLButtonElement&&c.addEventListener("click",p=>{p.preventDefault();let A=c.dataset.summaryTemplate||"simple";ao(A)})}),t.addEventListener("submit",uo),k.forEach(c=>{c.addEventListener("click",p=>{p.preventDefault(),ee()})}),e.addEventListener("click",c=>{c.target===e&&ee()}),L?.addEventListener("click",c=>{c.target===L&&ee()}),{openAddLesson:ro,openEditLesson:io,openAddDetail:lo,openDuplicatePlan:co,close:ee}}var la=document.getElementById("remindersCount"),fe=typeof document<"u"?cr():null,ca=document.getElementById("plannerCount"),da=document.getElementById("plannerSubtitle"),Oi=document.getElementById("resourcesCount"),ji=document.getElementById("templatesCount"),xt=document.getElementById("dailySnapshotList"),At=document.getElementById("todaysFocusList"),te=document.getElementById("weekAtAGlanceList"),ne=null;te&&(ne=document.createElement("li"),ne.dataset.emptyState="week",ne.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",ne.textContent="No upcoming events this week.");var ua=()=>{if(!te||!ne)return;te.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?te.contains(ne)||te.appendChild(ne):te.contains(ne)&&te.removeChild(ne)};te&&(ua(),new MutationObserver(ua).observe(te,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var Cn=e=>{An&&(e?An.classList.remove("hidden"):An.classList.add("hidden"))},nt={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},fa=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),ma=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),Nt=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",Yn=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},dr=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Ba=e=>{if(!e)return"";if(fa)try{return fa.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},ur=e=>{if(!e)return"";if(ma)try{return ma.format(e)}catch{}return e.toLocaleDateString()},Pa=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(nt,t)?t:"medium"},pa=e=>{let t=Pa(e);return nt[t]?.rank??nt.medium.rank},fr=e=>{let t=Pa(e);return nt[t]??nt.medium},ya=e=>{let t=Yn(e);return t?t.getTime():Number.POSITIVE_INFINITY};function Fa(e=[]){if(!xt)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(s=>({reminder:s,date:Yn(s)})).filter(({date:s})=>s&&dr(s,t)).sort((s,a)=>s.date.getTime()-a.date.getTime());if(!n.length){xt.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}xt.innerHTML="",n.forEach(({reminder:s,date:a})=>{let o=document.createElement("li");o.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=Nt(s),o.appendChild(i);let r=Ba(a),l=document.createElement("p");l.className="text-xs text-base-content/70",l.textContent=r?`Due ${r}`:"Due today",o.appendChild(l),xt.appendChild(o)})}function Ha(e=[]){if(!At)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,s)=>{let a=pa(n)-pa(s);if(a!==0)return a;let o=ya(n)-ya(s);return o!==0?o:Nt(n).localeCompare(Nt(s),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){At.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}At.innerHTML="",t.forEach(n=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let a=document.createElement("div");a.className="flex items-center justify-between gap-3";let o=document.createElement("p");o.className="font-semibold text-base-content",o.textContent=Nt(n),a.appendChild(o);let i=fr(n),r=document.createElement("span");r.className=i.badgeClass,r.textContent=i.badgeLabel,a.appendChild(r),s.appendChild(a);let l=Yn(n),u=document.createElement("p");if(u.className="text-xs text-base-content/70",l){let d=Ba(l),m=ur(l),T=[];d&&T.push(`Due ${d}`),m&&T.push(m),u.textContent=T.length?T.join(" \u2022 "):"Due soon"}else u.textContent="No due date";s.appendChild(u),At.appendChild(s)})}var mr=e=>{if(!la)return;let t=Array.isArray(e)?e.length:0;la.textContent=String(t)},pr=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];mr(t),Fa(t),Ha(t)};document.addEventListener("memoryCue:remindersUpdated",pr);Fa();Ha();var Rn=Ts(Ss),yr={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},kt=null,gr=3,ga=120;function br(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=ga?t:`${t.slice(0,ga-1)}\u2026`:""}function hr(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let s=n.trim().toLowerCase();return s==="true"||s==="1"||s==="yes"}return!1})}function ba(e){if(!Be)return;let t=Array.isArray(e)?e:[];if(!t.length){Be.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Cn(!1);return}let n=t.filter(o=>hr(o));if(!n.length){Be.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Cn(!1);return}Cn(!0);let a=n.slice(0,gr).map(o=>{let i=v(Ie(o,"title")||"Untitled Cue"),r=Ie(o,"details"),l=v(br(r)),u=l?`<p class="mt-1 text-sm text-base-content/70">${l}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${i}</p>
          ${u}
        </li>
      `}).join("");Be.innerHTML=a}function _n(e,{tone:t="muted"}={}){if(!se)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),se.innerHTML=`<p class="${n.join(" ")}">${v(e)}</p>`}function Er(e){if(!se)return;if(!Array.isArray(e)||e.length===0){_n("No cues yet.");return}let t=e.map(n=>{let s=v(Ie(n,"title")||"Untitled Cue"),a=v(Ie(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${s}</h2>
            ${a?`<p>${a}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${v(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${v(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");se.innerHTML=t}async function at(){return kt||(kt=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:s,enableIndexedDbPersistence:a,collection:o,doc:i,getDoc:r,addDoc:l,updateDoc:u,getDocs:d,query:m,orderBy:T,serverTimestamp:g,setDoc:I,arrayUnion:C}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),H=t(),N=H&&H.length?H[0]:e(yr),D=n(N);(function(){let w=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;w&&(w.__persistenceInitialized__||(w.__persistenceInitialized__=!0,(async()=>{try{await s(D),console.info("[Firestore] Persistence: multi-tab enabled")}catch(L){if(L&&L.code==="failed-precondition")try{await a(D),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(k){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",k?.code||k)}else L&&L.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",L?.code||L)}})()))})();let b=o(D,"cues");return{db:D,cuesCollection:b,getCollection:o,doc:i,getDoc:r,addDoc:l,updateDoc:u,getDocs:d,query:m,orderBy:T,serverTimestamp:g,setDoc:I,arrayUnion:C}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),kt)}async function wr(){let e=await at(),{getDocs:t,cuesCollection:n,query:s,orderBy:a}=e,o=s&&a?s(n,a("createdAt","desc")):n;return(await t(o)).docs.map(r=>({id:r.id,...r.data()}))}async function vr(e){if(!e)return null;let t=await at(),{db:n,doc:s,getDoc:a}=t,o=s(n,"cues",e),i=await a(o);return i.exists()?{id:i.id,...i.data()}:null}async function $a(){if(!(!se&&!Be))try{let e=await wr();Er(e),ba(e)}catch(e){console.error("Failed to load cues",e),tn(e)?_n("Sign in to view your cues.",{tone:"muted"}):_n("Unable to load cues right now.",{tone:"error"}),ba([])}}function Sr(e){!Se||!J||(Ls(e,Rn),J.value=e?.id||"",Q?.setEditMode(!0),Q?.show({mode:"edit"}))}async function Tr(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let s=await vr(n);if(!s)return;Sr(s)}catch(s){console.error("Failed to prepare cue for editing",s)}}async function Lr(e){if(e.preventDefault(),!Se||!J)return;let t=J.value.trim(),n=As(Rn);try{let s=await at(),{db:a,doc:o,addDoc:i,updateDoc:r,cuesCollection:l,serverTimestamp:u}=s,d=typeof u=="function"?u():null;if(t){let m=o(a,"cues",t),T={...n};d&&(T.updatedAt=d),await r(m,T)}else{let m={...n};d&&(m.createdAt=d,m.updatedAt=d),await i(l,m)}await $a(),xs(Rn,J,Q?.modalTitle??null,zo),await Q?.hide({reason:"form-submit"})}catch(s){console.error("Failed to save cue",s)}}async function xr(){!Se||!J||!se||(se.addEventListener("click",Tr),Se.addEventListener("submit",Lr))}Se&&J&&(document.addEventListener("cue:prepare",()=>{J.value="",Q?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{J.value="",Q?.setEditMode(!1)}));Se&&J&&se&&xr().catch(e=>{console.error("Failed to initialise cue editing",e)});(se||Be)&&$a();var B=[],It=null,we=!1,Te=le(),Xe=!1,y=Te,S=null,Ke=null,_=null,Z=ge(),Wt=null,zt=new Map,Ar=800,Ra=1500,On={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},_a=new Set(["saving","saved","error"]),Oa="plannerNotesOpenState",Ee=Ir(),Dt=null,ja="list",kr=800;function Ir(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Oa);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function Dr(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Oa,JSON.stringify(Ee))}catch(e){console.warn("Unable to persist planner notes state",e)}}function Cr(e){return e?!!Ee?.[e]:!1}function Nr(e,t){if(e){if(t)Ee={...Ee,[e]:!0};else if(Ee?.[e]){let n={...Ee};delete n[e],Ee=n}Dr()}}function Mr(e,t=Te){return Array.isArray(e)?e:e&&typeof e=="object"&&Array.isArray(e.lessons)?e.lessons:typeof t=="string"&&t?Ys(t):[]}var Br=(e=[])=>{if(!ca)return;let t=Array.isArray(e)?e.length:0;ca.textContent=String(t)};function Pr(e=[]){let t=Array.isArray(e)?e:[];if(aa&&(aa.textContent=String(t.length)),oa){let n=new Set;t.forEach(s=>{let a=Gn(s);a&&n.add(a.toLowerCase())}),oa.textContent=String(n.size)}if(ra){let n=t.filter(s=>typeof s.notes=="string"&&s.notes.trim().length>0).length;ra.textContent=String(n)}}function O(e,t){let n=Mr(e,t);Br(n);let s=e?.weekId||t||Te,a=hn(s,{short:!0});da&&(da.textContent=a||""),sa&&(sa.textContent=String(n.length)),_t&&(_t.textContent=a||""),Pr(n)}function Yt(e,{tone:t="muted"}={}){if(!R)return;_=null;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),R.innerHTML=`<p class="${n.join(" ")}">${v(e)}</p>`}function Kn(e){if(!na)return;let t=hn(e);na.textContent=t||"",_t&&(_t.textContent=t||"")}function Ua(e=y){let t=St(e,1);return t instanceof Date&&!Number.isNaN(t.getTime())?t.toISOString():""}function Gn(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function qa(e){if(!e)return"badge-ghost";let t=e.toLowerCase();return t.includes("hpe")||t.includes("pe")?"badge-info":t.includes("english")?"badge-success":t.includes("civics")||t.includes("cac")?"badge-secondary":t.includes("geo")?"badge-warning":"badge-ghost"}var z={not_started:{label:"Not started",badge:"badge-ghost"},in_progress:{label:"In progress",badge:"badge-warning"},ready:{label:"Ready",badge:"badge-success"},taught:{label:"Taught",badge:"badge-neutral"}};function Fr(e){if(!e)return"";let t=tt(e.day||"Monday"),n=e.period?e.period:"Lesson",s=e.subject?`<span class="badge badge-ghost badge-xs">${v(e.subject)}</span>`:"";return`
    <article
      class="flex h-full flex-col justify-between rounded-2xl border border-dashed border-base-300/80 bg-base-100/70 px-4 py-4 text-left text-base-content shadow-sm"
      data-planner-slot="true"
      data-timetable-entry="${e.id}"
    >
      <div class="space-y-2">
        <p class="label-text">${v(t)} \xB7 ${v(n)}</p>
        <p class="text-base font-semibold">${v(e.className||"Timetable slot")}</p>
        ${e.subject?`<p class="text-xs text-base-content/70">${v(e.subject)}</p>`:""}
      </div>
      <div class="flex flex-wrap items-center justify-between gap-2 pt-3">
        <div class="flex flex-wrap gap-2">${s}</div>
        <button
          type="button"
          class="btn btn-primary btn-xs"
          data-planner-action="create-slot"
          data-timetable-entry-id="${e.id}"
        >
          Plan lesson
        </button>
      </div>
    </article>
  `}function Xn(e=[],t=y){let n=Array.isArray(e)?e:[],s=new Set,a=Ua(t),o=[];return Z.forEach(i=>{let r=n.find(u=>u.timetableEntryId===i.id),l=Vt(Number(i.dayIndex));r?(s.add(r.id),o.push({type:"lesson",entry:i,lesson:r,dayIndex:l})):o.push({type:"slot",entry:i,lesson:null,dayIndex:l,weekStartDate:a})}),n.forEach(i=>{if(s.has(i.id))return;let r=Vt(Number(i.dayIndex));o.push({type:"lesson",entry:null,lesson:i,dayIndex:r,isLoose:!0})}),o.sort((i,r)=>{if(i.dayIndex!==r.dayIndex)return i.dayIndex-r.dayIndex;let l=i.entry?.period||i.lesson?.period||"",u=r.entry?.period||r.lesson?.period||"";if(l&&u&&l!==u)return l.localeCompare(u,void 0,{numeric:!0,sensitivity:"base"});let d=i.entry?.className||i.lesson?.title||"",m=r.entry?.className||r.lesson?.title||"";return d.localeCompare(m)})}function Hr(e,t){let n=z[t]?t:"not_started",s=Object.entries(z).map(([a,o])=>`<option value="${a}" ${a===n?"selected":""}>${v(o.label)}</option>`).join("");return`
    <label class="flex items-center gap-2 text-xs font-semibold text-base-content/80">
      <span>Status</span>
      <select class="select select-bordered select-xs" data-lesson-status="true" data-lesson-id="${e}">
        ${s}
      </select>
    </label>
  `}function $r(e=[],t=""){return e.length?`
    <ul class="space-y-2">
      ${e.map(n=>{let s=typeof n?.label=="string"&&n.label.trim()?n.label.trim():"Resource",a=typeof n?.url=="string"?n.url.trim():"",o=typeof n?.id=="string"?n.id:"",i=a?`<a class="link link-primary break-words" href="${a}" target="_blank" rel="noreferrer">${v(s)}</a>`:`<span class="text-base-content">${v(s)}</span>`,r=o?`<button class="btn btn-ghost btn-xs text-error" type="button" data-planner-action="remove-resource" data-lesson-id="${t}" data-resource-id="${o}">Remove</button>`:"";return`<li class="flex items-start justify-between gap-2 rounded-lg bg-base-200/70 px-2 py-1">${i}${r}</li>`}).join("")}
    </ul>
  `:'<p class="text-xs text-base-content/60">No resources added yet.</p>'}function F(e){if(!R)return;Wr(e);let t=Array.isArray(e?.lessons)?e.lessons:[],n=e?.weekId||y||Te,s=Xn(t,n),a=t,o=s.some(d=>d.type==="slot");if(!t.length&&!o){Yt("No lessons or timetable slots yet. Start by adding a timetable entry."),Mt([],s);return}let i=a.map(d=>typeof d.id=="string"&&d.id?d.id:"").filter(d=>!!d);_&&!i.includes(_)&&(_=null);let r=a.map(d=>{let m=Array.isArray(d.details)?d.details.map(xe=>`
                <li class="flex items-center gap-2">
                  ${xe.badge?`<span class="badge badge-outline badge-sm text-secondary">${v(xe.badge)}</span>`:""}
                  <span class="text-sm text-base-content/80">${v(xe.text)}</span>
                </li>
              `).join(""):"",T=m?`<ul class="space-y-2 text-sm text-base-content/80">${m}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',g=typeof d.id=="string"?d.id:"",I=!!(_&&g&&_===g),C=["data-planner-lesson",g?`data-lesson-id="${g}"`:"",I?'data-planner-selected="true"':""].filter(Boolean).join(" "),H=d.summary?`<p class="text-sm text-base-content/80">${v(d.summary)}</p>`:"",N=Gn(d),D=qa(N),b=N?`<span class="badge ${D} badge-sm">${v(N)}</span>`:"",h=typeof d.notes=="string"?d.notes:"",w=Cr(g),L=g?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${g}"
              ${w?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${g}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${v(h)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${v(On.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",k=g?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${g}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${g}"
              >
                Move down
              </button>
            </div>
          `:"",f=g?Hr(g,d.status):"",E=$r(Array.isArray(d.resources)?d.resources:[],g),P=z[d.status]?.badge||z.not_started.badge,M=z[d.status]?.label||z.not_started.label,x=[d.weekDay||d.dayLabel||"Lesson"];d.period&&x.push(d.period);let Le=x.filter(Boolean).join(" \xB7 ");return`
        <article class="card border border-base-300 bg-base-100 shadow-lg transition hover:-translate-y-1 hover:shadow-xl" ${C}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-3">
              <div class="space-y-2">
                <div class="flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">
                  <span>${v(Le)}</span>
                  <span class="badge ${P} badge-xs">${v(M)}</span>
                </div>
                <div class="flex flex-wrap items-center gap-2">
                  <h2 class="text-lg font-semibold text-base-content">${v(d.title||d.dayLabel||"Lesson")}</h2>
                  ${b}
                </div>
                ${H}
                <div class="flex flex-wrap items-center gap-3">
                  ${f}
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                ${k}
                <div class="flex flex-wrap justify-end gap-1">
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="duplicate" data-lesson-id="${g}">Duplicate</button>
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${g}">
                    Edit
                  </button>
                  <button
                    type="button"
                    class="btn btn-ghost btn-xs text-error"
                    data-planner-action="delete"
                    data-lesson-id="${g}"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
            ${T}
            <div class="rounded-xl border border-base-200 bg-base-200/60 p-3">
              <div class="flex flex-wrap items-center justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold uppercase tracking-[0.2em] text-base-content/60">Resources</p>
                  <p class="text-xs text-base-content/70">Link slides, videos, and activity sheets.</p>
                </div>
                <span class="badge badge-outline badge-sm">${Array.isArray(d.resources)?d.resources.length:0} linked</span>
              </div>
              <div class="mt-2 space-y-2">
                ${E}
                <div class="grid gap-2 md:grid-cols-[1fr_1.5fr_auto]">
                  <input
                    type="text"
                    class="input input-bordered input-sm w-full"
                    placeholder="Label (e.g. Slides)"
                    data-resource-label="true"
                    data-lesson-id="${g}"
                  />
                  <input
                    type="url"
                    class="input input-bordered input-sm w-full"
                    placeholder="URL"
                    data-resource-url="true"
                    data-lesson-id="${g}"
                  />
                  <button
                    type="button"
                    class="btn btn-outline btn-sm"
                    data-planner-action="add-resource"
                    data-lesson-id="${g}"
                  >
                    Add resource
                  </button>
                </div>
              </div>
            </div>
            ${L}
            <div class="flex flex-wrap items-center gap-2">
              <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-xs">Add template</label>
                <ul tabindex="0" class="dropdown-content menu rounded-box z-[1] mt-2 w-64 bg-base-100 p-2 shadow">
                  <li><button type="button" data-planner-action="apply-template" data-template-type="simple" data-lesson-id="${g}">Simple lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="hpe" data-lesson-id="${g}">HPE lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="english" data-lesson-id="${g}">English lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="cac" data-lesson-id="${g}">CAC lesson template</button></li>
                </ul>
              </div>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${g}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${g}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join(""),l=s.filter(d=>d.type==="slot"&&d.entry).map(d=>Fr(d.entry)).join(""),u=[r,l].filter(Boolean).join("");if(!u){Yt("No lessons or timetable slots yet. Start by adding a timetable entry."),Mt([],s);return}R.innerHTML=u,Jn(_),Mt(a,s)}function Mt(e=[],t=null){if(!Ze)return;let n=Array.isArray(t)?t:Xn(e,y),a=[{day:"Monday",index:1},{day:"Tuesday",index:2},{day:"Wednesday",index:3},{day:"Thursday",index:4},{day:"Friday",index:5}].map(i=>({...i,items:[]}));n.forEach(i=>{let r=Vt(Number(i?.dayIndex)),l=a.find(u=>u.index===r);l&&l.items.push(i)});let o=a.map(({day:i,items:r})=>{let l=r.map(d=>{if(d.type==="slot"&&d.entry){let H=d.entry.period?` \xB7 ${v(d.entry.period)}`:"",N=d.entry.subject?`<span class="badge badge-ghost badge-xs">${v(d.entry.subject)}</span>`:"";return`
              <div class="rounded-xl border border-dashed border-base-200 bg-base-100 px-3 py-2">
                <div class="flex items-start justify-between gap-2">
                  <div>
                    <p class="text-xs font-semibold text-base-content/70">${v(d.entry.className||"Timetable slot")}</p>
                    <p class="text-xs text-base-content/60">${v(tt(d.entry.day||i)+H)}</p>
                  </div>
                  ${N}
                </div>
                <div class="mt-2 flex flex-wrap justify-end">
                  <button class="btn btn-primary btn-ghost btn-xs" type="button" data-planner-action="create-slot" data-timetable-entry-id="${d.entry.id}">Plan lesson</button>
                </div>
              </div>
            `}let m=d.lesson||d,T=Gn(m),g=qa(T),I=z[m.status]?.label||z.not_started.label,C=z[m.status]?.badge||z.not_started.badge;return`
            <button
              type="button"
              class="w-full text-left rounded-xl border border-base-200 bg-base-100 px-3 py-2 shadow-sm transition hover:-translate-y-[1px] hover:shadow"
              data-week-view-lesson="${m.id||""}"
            >
              <div class="flex items-start justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold text-base-content/70">${v(m.title||m.dayLabel||"Lesson")}</p>
                  <p class="text-xs text-base-content/60">${v(m.summary||"")}</p>
                </div>
                <div class="flex flex-col items-end gap-1">
                  ${T?`<span class="badge ${g} badge-xs">${v(T)}</span>`:""}
                  <span class="badge ${C} badge-xs">${v(I)}</span>
                </div>
              </div>
            </button>
          `}).join("");return`
        <div class="space-y-2 rounded-2xl border border-base-200 bg-base-200/50 p-3">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-base-content/70">${i}</p>
          <div class="space-y-2">${l||'<p class="text-xs text-base-content/60">No lessons yet.</p>'}</div>
        </div>
      `}).join("");Ze.innerHTML=o}function Bt(e="list"){let t=e==="week"?"week":"list";if(ja=t,R&&R.classList.toggle("hidden",t==="week"),Ze&&Ze.classList.toggle("hidden",t!=="week"),Bn instanceof HTMLElement&&Bn.setAttribute("aria-pressed",t==="list"?"true":"false"),Pn instanceof HTMLElement&&Pn.setAttribute("aria-pressed",t==="week"?"true":"false"),t==="week"){let n=S?.lessons||[];Mt(n,Xn(n,y))}}function Va(){et instanceof HTMLFormElement&&et.reset(),Wt=null,$e instanceof HTMLSelectElement&&($e.value="monday"),jt instanceof HTMLElement&&(jt.textContent="Add to timetable")}function Jt(){if(!Pe)return;if(!Z.length){Pe.innerHTML='<p class="text-sm text-base-content/70">No timetable entries yet. Add your classes to auto-create lesson slots.</p>',Fe("");return}let t=["monday","tuesday","wednesday","thursday","friday"].map(s=>({day:s,entries:[]}));Z.forEach(s=>{let a=t.find(o=>o.day===(s.day||"").toLowerCase());a&&a.entries.push(s)});let n=t.map(({day:s,entries:a})=>{let o=tt(s),i=a.map(l=>{let u=l.subject?`<span class="badge badge-ghost badge-xs">${v(l.subject)}</span>`:"",d=l.period?`<span class="text-xs text-base-content/60">${v(l.period)}</span>`:"";return`
            <li class="flex items-center justify-between gap-2 rounded-xl border border-base-200 bg-base-100 px-3 py-2">
              <div>
                <p class="text-sm font-semibold text-base-content">${v(l.className)}</p>
                <div class="flex flex-wrap items-center gap-2 text-xs text-base-content/70">
                  <span>${v(o)}</span>
                  ${d}
                  ${u}
                </div>
              </div>
              <div class="flex flex-wrap items-center gap-2">
                <button type="button" class="btn btn-ghost btn-xs" data-timetable-action="edit" data-entry-id="${l.id}">Edit</button>
                <button type="button" class="btn btn-ghost btn-xs text-error" data-timetable-action="delete" data-entry-id="${l.id}">Delete</button>
              </div>
            </li>
          `}).join("");return`
        <div class="space-y-2 rounded-2xl border border-base-200 bg-base-200/60 p-3">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-base-content/70">${o}</p>
          <ul class="space-y-2">${i||'<p class="text-xs text-base-content/60">No slots for this day yet.</p>'}</ul>
        </div>
      `}).join("");Pe.innerHTML=n,Fe(U instanceof HTMLSelectElement?U.value:"")}async function Rr(e){if(e.preventDefault(),!$e||!Ot)return;let t=$e.value||"monday",n=Fn?.value?.trim()||"",s=Ot.value?.trim(),a=Hn?.value?.trim()||"";if(s)try{Wt?Z=await Ws(Wt,{day:t,period:n,className:s,subject:a}):Z=await Vs({day:t,period:n,className:s,subject:a}),Va(),Jt(),F(S||{lessons:[]})}catch(o){console.error("Unable to save timetable entry",o)}}function _r(e){let t=e.target instanceof Element?e.target.closest("[data-timetable-action]"):null;if(!t)return;let n=t.getAttribute("data-timetable-action"),s=t.getAttribute("data-entry-id");if(!(!n||!s)){if(n==="edit"){let a=Z.find(o=>o.id===s);if(!a)return;Wt=a.id,$e instanceof HTMLSelectElement&&($e.value=a.day||"monday"),Fn instanceof HTMLInputElement&&(Fn.value=a.period||""),Ot instanceof HTMLInputElement&&(Ot.value=a.className||""),Hn instanceof HTMLInputElement&&(Hn.value=a.subject||""),jt instanceof HTMLElement&&(jt.textContent="Update slot");return}if(n==="delete"){if(!(typeof window<"u"&&typeof window.confirm=="function"?window.confirm("Remove this timetable slot?"):!0))return;zs(s).then(o=>{Z=o,Jt(),F(S||{lessons:[]})}).catch(o=>{console.error("Unable to delete timetable entry",o)})}}}function Or(){et instanceof HTMLFormElement&&et.addEventListener("submit",Rr),ia instanceof HTMLElement&&ia.addEventListener("click",e=>{e.preventDefault(),Va()}),Pe&&Pe.addEventListener("click",_r),Jt()}function Jn(e){_=e||null,R&&R.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function jr(e){let t=e.target instanceof Element?e.target.closest("[data-week-view-lesson]"):null;if(!t)return;let n=t.getAttribute("data-week-view-lesson");if(!n)return;Bt("list"),Jn(n);let s=R?.querySelector(`[data-lesson-id="${n}"]`);s instanceof HTMLElement&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"center"})}function Ur(){return _&&(Array.isArray(S?.lessons)?S.lessons:[]).some(t=>t.id===_)?_:null}function qr(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===_||Jn(n)}function Vr(e){let t=$n(e?.currentTarget)?e.currentTarget:Rt;if(!$n(t))return;let n=t.value,s=Gt.has(n)?n:Ut;Ia(s),sr(s),t.value!==s&&(t.value=s)}function Qt(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function Wa(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function za(e){if(!e)return;let t=zt.get(e);if(!t)return;let n=Wa();n&&n(t),zt.delete(e)}function ze(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&_a.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Ye(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&_a.has(t)?t:null,s=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(s instanceof HTMLElement){let a=n||"idle",o=On[a]||On.idle;s.textContent=o,s.setAttribute("data-status",a)}}function Wr(e){if(!(ue instanceof HTMLTextAreaElement))return;Ne("idle");let t=typeof e?.teacherNotes=="string"?e.teacherNotes:"";ue.value!==t&&(ue.value=t)}function Ne(e="idle"){if(!(In instanceof HTMLElement))return;let t={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},n=t[e]||t.idle;In.textContent=n,In.setAttribute("data-status",e)}async function zr(e){if(y){Ne("saving");try{let t=await Ks(y,e);t&&(S=t),Ne("saved");let n=Qt();n?n(()=>Ne("idle"),Ra):Ne("idle")}catch(t){console.error("Failed to save teacher notes",t),Ne("error")}}}function Yr(e){if(!(ue instanceof HTMLTextAreaElement)||e?.target!==ue)return;if(Dt){let n=Wa();n&&n(Dt)}let t=Qt();t&&(Dt=t(()=>{Dt=null,zr(ue.value)},kr))}function Ya(e="simple"){switch(e){case"hpe":return`Focus skill:
Warm-up:
Skill drill:
Modified game:
Reflection questions:`;case"english":return`Text focus:
Discussion questions:
Mentor sentence:
Writing task:
Reflection / exit ticket:`;case"cac":return`Civics topic:
Key terms:
Source / video:
Discussion questions:
Activity:
Reflection question:`;case"simple":default:return`Learning intention:
Success criteria:
Warm-up:
Main activity:
Exit task:`}}async function Kr(e,t){if(!e)return;await Zt();let n=S?.lessons?.find(i=>i.id===e);if(!n)return;let s=Ya(t),a=typeof n.notes=="string"?n.notes:"";if(a&&typeof window<"u"&&typeof window.confirm=="function"&&!window.confirm("Add this template to the existing notes?"))return;let o=a?`${a.trim()}

${s}`:s;try{let i=await ce(y,e,{notes:o,templateType:t||"simple"});i&&(S=i,F(i),O(i,y))}catch(i){console.error("Failed to apply lesson template",i)}}async function Gr(e){let t=e.target instanceof HTMLSelectElement&&e.target.hasAttribute("data-lesson-status")?e.target:null;if(!t)return;let n=t.getAttribute("data-lesson-id"),s=t.value;if(n)try{let a=await ce(y,n,{status:s});a&&(S=a,F(a),O(a,y))}catch(a){console.error("Failed to update lesson status",a)}}async function Xr(e,t,n){if(!e||!(t instanceof HTMLInputElement)||!(n instanceof HTMLInputElement))return;let s=t.value.trim(),a=n.value.trim();if(!s&&!a)return;let o=S?.lessons?.find(r=>r.id===e);if(!o)return;let i=Array.isArray(o.resources)?[...o.resources]:[];i.push({id:zn("resource"),label:s,url:a});try{let r=await ce(y,e,{resources:i});r&&(S=r,F(r)),t.value="",n.value=""}catch(r){console.error("Failed to add resource",r)}}async function Jr(e,t){if(!e||!t)return;let n=S?.lessons?.find(a=>a.id===e);if(!n)return;let s=(n.resources||[]).filter(a=>a?.id!==t);try{let a=await ce(y,e,{resources:s});a&&(S=a,F(a))}catch(a){console.error("Failed to remove resource",a)}}async function jn(e,t,n){if(!e||!y)return;let s=n instanceof HTMLTextAreaElement?n:null;s&&(ze(s,"saving"),Ye(s,"saving"));try{let a=await ce(y,e,{notes:t});if(a&&(S=a),s){ze(s,"saved"),Ye(s,"saved");let o=Qt();o?o(()=>{s.getAttribute("data-notes-status")==="saved"&&(ze(s,null),Ye(s,null))},Ra):(ze(s,null),Ye(s,null))}}catch(a){console.error("Failed to save planner notes",a),s&&(ze(s,"error"),Ye(s,"error"))}}function Qr(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;za(n);let s=Qt();if(!s){jn(n,t.value,t);return}let a=s(()=>{zt.delete(n),jn(n,t.value,t)},Ar);zt.set(n,a)}function Zr(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(za(n),jn(n,t.value,t))}function ei(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let s=t.hasAttribute("open");Nr(n,s)}function Me(e){if(!R)return Ke=null,Promise.resolve();let t=e||le();y=t,Kn(t),Yt("Loading plan\u2026");let n=(async()=>{try{let s=await Y(t);S=s,F(s),O(s,t)}catch(s){console.error("Failed to load planner week",s),Yt("Unable to load this week's planner.",{tone:"error"})}})();return Ke=n,n.finally(()=>{Ke===n&&(Ke=null)})}async function Zt(){if(!R)return;Xe||en();let e=Ke;if(!e&&(!S||S.weekId!==y)&&(e=Me(y)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function ti(e,t){if(!e)return;await Zt();let n=Array.isArray(S?.lessons)?S.lessons:[];if(!n.length)return;let s=n.find(g=>g?.id===e);if(!s)return;let a=typeof s.dayLabel=="string"&&s.dayLabel.trim()?s.dayLabel.trim():typeof s.dayName=="string"&&s.dayName.trim()?s.dayName.trim():"",o=typeof s.title=="string"&&s.title.trim()?s.title.trim():a||"Lesson",i=typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():"",r=i||o,l=a?`${a} \xB7 ${r}`:r,u=i||"",d=rr(s),m=ir(St(y,d)),T={reminderTitle:l,reminderNotes:u,dueDate:m,dayLabel:a,lessonTitle:o,summary:i,plannerLessonId:e};vn("cue:prepare",{trigger:t,source:"planner"}),vn("planner:prefillReminder",T),vn("cue:open",{trigger:t,source:"planner"})}async function ni(e,t){if(!e)return;await Zt();let s=(Array.isArray(S?.lessons)?S.lessons:[]).find(r=>r?.id===e);if(!s)return;let a=t instanceof HTMLElement?t:null;a&&a.setAttribute("disabled","true");let o=zn("lesson"),i={id:o,dayIndex:s.dayIndex,dayLabel:s.dayLabel,dayName:s.dayName,title:s.title,summary:s.summary,subject:s.subject,notes:s.notes,period:s.period,templateType:s.templateType||"simple",status:"not_started",resources:Array.isArray(s.resources)?s.resources.map(r=>({label:r?.label||"",url:r?.url||""})):[],details:Array.isArray(s.details)?s.details.map(r=>({badge:r?.badge||"",text:r?.text||""})):[]};try{let r=await We(y,i),l=r;r&&Number.isFinite(s.position)&&(l=await ce(y,o,{position:s.position+.1})),l&&(S=l,_=o,F(l),O(l,y),V&&(V.textContent=`Duplicated ${s.title||"lesson"} into this week.`))}catch(r){console.error("Failed to duplicate planner lesson",r),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{a&&a.removeAttribute("disabled")}}async function si(e,t){if(!e||!y)return;let n=Z.find(a=>a.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;s&&s.setAttribute("disabled","true");try{let a=Ua(y),o=await We(y,{dayIndex:Vt(Number(n.dayIndex)),dayName:tt(n.day),title:n.className||tt(n.day||"Monday"),summary:"",subject:n.subject||"",period:n.period||"",status:"not_started",timetableEntryId:n.id,weekStartDate:a});o&&(S=o,_=o.lessons?.find(r=>r.timetableEntryId===n.id&&(!r.weekStartDate||r.weekStartDate===a))?.id||_,F(o),O(o,y))}catch(a){console.error("Failed to create lesson from timetable slot",a)}finally{s&&s.removeAttribute("disabled")}}async function ai(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),s=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":li(s,t);break;case"edit":ci(s,t);break;case"delete":di(s);break;case"duplicate":await ni(s,t);break;case"apply-template":{let a=t.getAttribute("data-template-type")||"simple";Kr(s,a);break}case"add-resource":{let a=t.closest("[data-planner-lesson]"),o=a?.querySelector("input[data-resource-label][data-lesson-id]"),i=a?.querySelector("input[data-resource-url][data-lesson-id]");await Xr(s,o,i);break}case"remove-resource":{let a=t.getAttribute("data-resource-id");await Jr(s,a);break}case"move-up":ha(s,"up",t);break;case"move-down":ha(s,"down",t);break;case"create-reminder":await ti(s,t);break;case"create-slot":{let a=t.getAttribute("data-timetable-entry-id");await si(a,t);break}default:break}}async function Ka(e){if(typeof document>"u"||!fe)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=S?.lessons?.[0]?.dayLabel||"Monday";fe.openAddLesson({defaultDay:n,trigger:t})}async function oi(e){if(!fe)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Ve(y,1);fe.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function ri(e){if(!y)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Ve(y,-1);if(n){t&&t.setAttribute("disabled","true");try{let s=await wn(n,y);s&&(S=s,_=null,F(s),O(s,y),V&&(V.textContent="Copied last week into this plan."))}catch(s){console.error("Failed to copy previous planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{t&&t.removeAttribute("disabled")}}}async function ii(e){if(!y)return;e?.preventDefault?.();let t=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(t=window.confirm("Clear all lessons for this week?")),!t)return;let n=e?.currentTarget instanceof HTMLElement?e.currentTarget:null;n&&n.setAttribute("disabled","true");try{let s=await Js(y);s&&(S=s,_=null,F(s),O(s,y),V&&(V.textContent="Cleared this week's plan."))}catch(s){console.error("Failed to clear planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function li(e,t){if(!e||!fe)return;let n=S?.lessons?.find(a=>a.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;fe.openAddDetail({lesson:n,trigger:s})}async function ci(e,t){if(!e||!fe)return;let n=S?.lessons?.find(a=>a.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;fe.openEditLesson({lesson:n,trigger:s})}async function ha(e,t,n){if(!e||!t)return;let s=y||le();if(!s)return;let a=n instanceof HTMLElement?n:null;a&&a.setAttribute("disabled","true");try{let o=await Xs(s,e,t);o&&(S=o,F(o),O(o,s))}catch(o){console.error("Failed to move planner lesson",o),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{a&&a.removeAttribute("disabled")}}async function di(e){if(!e||typeof window>"u")return;let t=S?.lessons?.find(s=>s.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let s=await Gs(y,e);s&&(S=s,F(s),O(s,y))}catch(s){console.error("Failed to delete planner lesson",s),window.alert("Unable to delete that lesson right now.")}}function en(){if(Xe||!R){Xe&&Me(y);return}Xe=!0,qs({ensureFirestore:at}),R.addEventListener("click",qr),R.addEventListener("click",ai),R.addEventListener("change",Gr),R.addEventListener("input",Qr),R.addEventListener("focusout",Zr),R.addEventListener("toggle",ei),Ze?.addEventListener("click",jr),ue instanceof HTMLTextAreaElement&&ue.addEventListener("input",Yr),Zo?.addEventListener("click",Ka),Qo?.addEventListener("click",oi),Xo?.addEventListener("click",ri),Jo?.addEventListener("click",ii),Rt?.addEventListener("change",Vr),Bn?.addEventListener("click",()=>Bt("list")),Pn?.addEventListener("click",()=>Bt("week")),Yo?.addEventListener("click",()=>{let e=Ve(y,-1);Me(e)}),Ko?.addEventListener("click",()=>{let e=Ve(y,1);Me(e)}),Go?.addEventListener("click",()=>{Me(le())}),Bt(ja),Me(y)}function Ea(){typeof window>"u"||Ta()==="planner"&&en()}function ui(e){let t=e?.detail?.plan;t&&(Xe&&t.weekId===y?(S=t,F(t),Kn(t.weekId),O(t,t.weekId)):t.weekId===Te&&O(t,Te))}function fi(e){Z=Array.isArray(e?.detail?.timetable)?e.detail.timetable:[],Jt(),Fe(U instanceof HTMLSelectElement?U.value:""),S&&F(S)}O(null,Te);typeof document<"u"&&(document.addEventListener(fn,ui),document.addEventListener(mn,fi));(et||Pe)&&Or();typeof window<"u"&&(window.addEventListener("hashchange",Ea),window.addEventListener("DOMContentLoaded",Ea));var Ga="dailyTasksByDate",Ct=null;function Qn(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function mi(e){if(typeof e!="string")return"";let[t,n,s]=e.split("-"),a=Number.parseInt(t,10),o=Number.parseInt(n,10),i=Number.parseInt(s,10);if(!Number.isFinite(a)||!Number.isFinite(o)||!Number.isFinite(i))return e;let r=new Date(a,o-1,i);return Number.isNaN(r.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(r)}function st(e){if(!Mn)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);Mn.disabled=!t}function ve(e){if(!de)return;if(!Array.isArray(e)||e.length===0){de.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',st([]);return}let t=e.map((n,s)=>{let a=v(n?.text||""),o=!!n?.completed,i=`daily-task-${s}`,r=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return o&&r.push("line-through","text-opacity-50"),`
        <label class="flex items-center p-3 border-b border-base-200" data-task-index="${s}" for="${i}">
          <input id="${i}" type="checkbox" class="checkbox checkbox-sm" data-task-index="${s}" ${o?"checked":""} />
          <span class="${r.join(" ")}">${a}</span>
        </label>
      `}).join("");de.innerHTML=t,st(e)}function Kt(){$t&&$t.classList.remove("hidden")}function Zn(){$t&&$t.classList.add("hidden")}function es(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Re(e){return Array.isArray(e)?e.map(t=>es(t)):[]}function ts(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Ga);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function Xa(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Ga,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function wa(e){let t=ts(),n=t&&typeof t=="object"?t[e]:[];return Re(n)}function Un(e,t){let n=ts(),s=Re(t);return n[e]=s,Xa(n),s}function va(e,t){let n=ts(),s=Re(n[e]);return s.push(es(t)),n[e]=s,Xa(n),s}function tn(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function ns(){return Ct||(Ct=at().then(e=>{let{db:t,getCollection:n}=e,s=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:s}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),Ct)}function ss(e,t){let{doc:n,dailyListsCollection:s,db:a}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return s?n(s,t):n(a,"dailyLists",t)}async function as(){if(!ta||!de)return;let e=Qn(),t=mi(e);ta.textContent=t?`Today's List - ${t}`:"Today's List";let n=!1;if(we){Kt();let s=wa(e);B=s,ve(s),n=!0}return It||(n||(de.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',st([])),It=(async()=>{try{let s=await ns(),a=ss(s,e),o=await s.getDoc(a),i=o.exists()?o.data()?.tasks:[];return B=Re(i),ve(B),Un(e,B),we=!1,Zn(),B}catch(s){tn(s)?(console.warn("Falling back to local daily tasks due to permission issue",s),we=!0,Kt()):console.error("Failed to load daily list",s);let o=wa(e);return B=o,o.length||n?ve(o):(de.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',B=[],st(B)),B}})().finally(()=>{It=null})),It}async function pi(e){let t=Qn(),n=es(e);try{let s=await ns(),a=ss(s,t),o=await s.getDoc(a);if(o.exists()&&typeof s.arrayUnion=="function")await s.updateDoc(a,{tasks:s.arrayUnion(n)});else{let i=o.exists()?o.data()?.tasks:[],r=Array.isArray(i)?Re(i):[];r.push(n),typeof s.setDoc=="function"?await s.setDoc(a,{tasks:r},{merge:!0}):await s.updateDoc(a,{tasks:r})}va(t,n),we=!1,Zn()}catch(s){if(tn(s)){console.warn("Saving task locally because cloud sync is unavailable",s),we=!0,Kt(),va(t,n);return}throw s}}async function Ja(e){let t=Qn(),n=Re(e);try{let s=await ns(),a=ss(s,t);typeof s.setDoc=="function"?await s.setDoc(a,{tasks:n},{merge:!0}):await s.updateDoc(a,{tasks:n}),Un(t,n),we=!1,Zn()}catch(s){if(tn(s)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",s),we=!0,Kt(),Un(t,n);return}throw s}}function Qa(e){[Ft,Ht].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function yi(){!Je||!Qe||(Je.classList.remove("hidden"),Qe.classList.add("hidden"),Qa(Ft))}function gi(){!Je||!Qe||(Je.classList.add("hidden"),Qe.classList.remove("hidden"),Qa(Ht),as())}function bi(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),s=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!s.length)return;let a=r=>{n.forEach(l=>{if(!l)return;let u=l.getAttribute("data-dashboard-tab")===r;l.classList.toggle("tab-active",u),l.setAttribute("aria-selected",u?"true":"false")}),s.forEach(l=>{if(!l)return;let u=l.getAttribute("data-dashboard-panel")===r;l.classList.toggle("hidden",!u),l.setAttribute("aria-hidden",u?"false":"true")})},i=(n.find(r=>r.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");i&&a(i),n.forEach(r=>{r.addEventListener("click",()=>{let l=r.getAttribute("data-dashboard-tab");l&&a(l)})})})}window.addEventListener("DOMContentLoaded",bi);Ft&&Ht&&Je&&Qe&&(Ft.addEventListener("click",e=>{e.preventDefault(),yi()}),Ht.addEventListener("click",e=>{e.preventDefault(),gi()}));var q=null,G=!1,Pt=null;function He(e){if(!K)return;K.setAttribute("aria-pressed",e?"true":"false");let t=K.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":K.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function hi(){G&&(window.clearTimeout(Pt),Pt=window.setTimeout(()=>{Pt=null,G&&Za(!0)},400))}function Za(e=!1){if(!q)return!1;if(G&&!e)return!0;try{return q.start(),G=!0,He(!0),!0}catch{return G=!1,He(!1),!1}}function os(){if(q){G=!1,window.clearTimeout(Pt);try{q.stop()}catch{}He(!1)}}function Ei(){if(K)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){K.setAttribute("disabled","true"),K.setAttribute("aria-disabled","true"),K.title="Voice input is not supported in this browser.";return}q=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(q.lang=t,q.interimResults=!1,"continuous"in q)try{q.continuous=!0}catch{}q.onresult=n=>{let s=n?.results?.[0]?.[0]?.transcript||"";if(s&&W){W.value=s.trim();try{W.focus({preventScroll:!0})}catch{W.focus()}try{let a=W.value.length;W.setSelectionRange(a,a)}catch{}}},q.onend=()=>{if(!G){He(!1);return}hi()},q.onerror=()=>{G=!1,He(!1)}}catch{q=null,He(!1),K.setAttribute("disabled","true"),K.setAttribute("aria-disabled","true")}}Ei();K?.addEventListener("click",()=>{q&&(G?os():Za())});xa?.addEventListener("submit",()=>{G&&os()});window.addEventListener("pagehide",()=>{G&&os()});xa?.addEventListener("submit",async e=>{if(e.preventDefault(),!W)return;let t=W.value.trim();if(!t){W.focus();return}let n={text:t,completed:!1};W.value="",W.focus();try{await pi(n),await as()}catch(s){console.error("Failed to add task to the daily list",s),W.value=t,W.focus()}});de?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(B)||Number.isNaN(n)||!B[n])return;let s=document.activeElement===t,a=()=>{if(!s)return;let r=de?.querySelector(`input[data-task-index="${n}"]`);if(r instanceof HTMLInputElement)try{r.focus({preventScroll:!0})}catch{r.focus()}},o=B.map(r=>({...r})),i=o.map((r,l)=>l===n?{...r,completed:t.checked}:r);B=i,ve(i),a();try{await Ja(i)}catch(r){console.error("Failed to update task completion state",r),B=o,ve(o),a()}});Mn?.addEventListener("click",async()=>{if(!Array.isArray(B)||B.length===0)return;let e=B.filter(n=>!n.completed);if(e.length===B.length)return;let t=B.map(n=>({...n}));B=e,ve(e);try{await Ja(e)}catch(n){console.error("Failed to clear completed tasks",n),B=t,ve(t)}});st(B);as();function wi(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),s=document.getElementById("noteNewBtn"),a=document.getElementById("notesList"),o=document.querySelector("[data-notes-layout]"),i=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!s)return;let r=null,l=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}},u=()=>o&&o.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",d=b=>{let h=b==="collapsed";i.forEach(w=>{if(!(w instanceof HTMLElement))return;w.setAttribute("aria-expanded",h?"false":"true");let L=w.dataset.notesShelfToggleVariant;L==="primary"?w.textContent=h?"Show saved notes":"Hide saved notes":L==="close"&&(w.textContent=h?"Show":"Close")})},m=b=>{o&&(o.dataset.notesShelfState=b==="collapsed"?"collapsed":"expanded"),d(u())},T=()=>{let b=u()==="collapsed"?"expanded":"collapsed";m(b),b==="collapsed"&&l()};i.length&&(i.forEach(b=>{b.addEventListener("click",h=>{h.preventDefault(),T()})}),m(u()));let g=b=>{if(!b){r=null,e.value="",t.value="";return}r=b.id,e.value=b.title||"",t.value=b.body||""},I=()=>{if(!a)return;a.querySelectorAll("button[data-note-id]").forEach(h=>{if(!(h instanceof HTMLElement))return;let w=h.getAttribute("data-note-id")===r;h.classList.toggle("bg-base-200/80",w),h.classList.toggle("border-base-300",!w),h.classList.toggle("border-primary",w),h.classList.toggle("font-medium",w),h.setAttribute("aria-current",w?"true":"false")})},C=()=>{let b=mt();return Array.isArray(b)?[...b].sort((h,w)=>{let L=Date.parse(h?.updatedAt||""),k=Date.parse(w?.updatedAt||"");return(Number.isNaN(k)?0:k)-(Number.isNaN(L)?0:L)}):[]},H=b=>{if(!b)return;let h=mt();if(!Array.isArray(h))return;let w=h.filter(k=>k.id!==b);if(w.length===h.length)return;ln(w),r===b&&(r=null);let L=N();if(r){let k=L.find(f=>f.id===r)||null;g(k)}else L.length?g(L[0]):g(null);I()},N=(b=C())=>{if(!a)return b;if(a.innerHTML="",!b.length){let h=document.createElement("li");return h.className="text-sm italic text-base-content/60",h.textContent="No saved notes yet.",a.appendChild(h),b}return b.forEach(h=>{let w=document.createElement("li");w.className="flex items-center gap-2";let L=document.createElement("button");L.type="button",L.dataset.noteId=h.id,L.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",L.textContent=h.title||"Untitled note",L.addEventListener("click",()=>{g(h),I(),l()});let k=document.createElement("button");k.type="button",k.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",k.setAttribute("aria-label",`Delete note "${h.title||"Untitled note"}"`),k.textContent="Delete",k.addEventListener("click",f=>{f.stopPropagation(),H(h.id)}),w.appendChild(L),w.appendChild(k),a.appendChild(w)}),I(),b},D=()=>{let b=N();if(!b.length){g(null),I();return}let h=r?b.find(w=>w.id===r):null;g(h||b[0]),I()};n.addEventListener("click",()=>{let b=mt(),h=Array.isArray(b)?[...b]:[],w=typeof e.value=="string"?e.value.trim():"",L=typeof t.value=="string"?t.value:"",k=w||"Untitled note",f=new Date().toISOString();if(r){let M=h.findIndex(x=>x.id===r);if(M>=0)h[M]={...h[M],title:k,body:L,updatedAt:f};else{let x=rn(k,L,{updatedAt:f});r=x.id,h.unshift(x)}}else{let M=rn(k,L);r=M.id,h.unshift(M)}ln(h);let E=N(),P=r?E.find(M=>M.id===r):null;g(P||null),I()}),s.addEventListener("click",()=>{r=null,e.value="",t.value="",I(),l()}),D()}wi();var eo="theme",vi="professional",qn="memoryCue:theme-change",Si="professional",Vn=document.getElementById("theme-menu"),to="[data-theme-name],[data-theme-option]",Ti=new Set(["dark","dracula","synthwave"]);function me(e){return typeof e=="string"?e.trim():""}function no(e){return e instanceof HTMLElement?me(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Li(e){let t=me(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Ti.has(t)))}function Sa(e){let t=me(e);if(t)try{localStorage.setItem(eo,t)}catch(n){console.warn("Unable to save theme preference",n)}}function so(e){if(!Vn)return;let t=me(e);Vn.querySelectorAll(to).forEach(s=>{if(!(s instanceof HTMLElement))return;let a=no(s),o=t&&a===t;s.setAttribute("aria-checked",o?"true":"false"),s.classList.toggle("active",o)})}function xi(e){let t=me(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(qn,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let s=document.createEvent("CustomEvent");s.initCustomEvent(qn,!0,!0,{theme:t}),window.dispatchEvent(s)}}}function Wn(e,{persist:t=!0,notify:n=!0}={}){let s=me(e);if(!s)return;me(document.documentElement.getAttribute("data-theme"))!==s&&Li(s),t&&Sa(s),so(s),n&&xi(s)}function Ai(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){Wn(Si,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(eo)||""}catch(s){console.warn("Unable to load theme preference",s)}let n=t||document.documentElement.getAttribute("data-theme")||vi;n&&Wn(n,{persist:!1,notify:!0})}Vn?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(to):null;if(!t)return;e.preventDefault();let n=no(t);n&&Wn(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(qn,e=>{let t=me(e?.detail?.theme);t&&so(t)});Ai()});export default ki();
