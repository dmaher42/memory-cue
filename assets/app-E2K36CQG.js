import{a as z,b as Oe}from"./chunk-VBVSTL6U.js";import{a as le,b as qe}from"./chunk-ERL7JLDU.js";import{a as re,b as Re}from"./chunk-RCZ4YZVR.js";function de(t,e=document){return!Array.isArray(t)||!e||typeof e.getElementById!="function"?[]:t.map(({key:i,ids:n})=>{if(!Array.isArray(n))return null;for(let s of n){if(typeof s!="string"||!s)continue;let o=e.getElementById(s);if(o)return{key:i,element:o}}return null}).filter(i=>!!(i&&i.element))}function M(t,e){if(!t||typeof t!="object")return"";let i=_e[e]||[e];for(let n of i)if(Object.prototype.hasOwnProperty.call(t,n)){let s=t[n];return s==null?"":typeof s=="string"?s:String(s)}return""}function Ue(t,e){if(!t)return;let i=e??"";if(t instanceof HTMLInputElement){t.type==="checkbox"?t.checked=!!i:t.value=typeof i=="string"?i:String(i);return}(t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)&&(t.value=typeof i=="string"?i:String(i))}function Ne(t){return t?t instanceof HTMLInputElement?t.type==="checkbox"?t.checked:t.value:t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?t.value:"":""}function ue(t,e){Array.isArray(e)&&e.forEach(({key:i,element:n})=>{let s=t&&typeof t=="object"?M(t,i):"";Ue(n,s)})}function fe(t,e,i,n){Array.isArray(t)&&t.forEach(({element:s})=>{s instanceof HTMLInputElement?["checkbox","radio"].includes(s.type)?s.checked=!1:s.value="":(s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement)&&(s.value="")}),e&&(e.value=""),i&&(i.textContent=n)}function he(t){let e={};return Array.isArray(t)&&t.forEach(({key:i,element:n})=>{let s=Ne(n);if(typeof s=="boolean"){e[i]=s;return}let o=typeof s=="string"?s.trim():s;e[i]=o??""}),e}function S(t){return t==null?"":String(t).replace(/[&<>'"]/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}var ce,_e,Q,Y,me=re(()=>{ce=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],_e={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Q="Create Cue",Y="Edit Cue"});function pe(t){return new G(t)}var Ve,Pe,G,ye=re(()=>{Ve=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Pe={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},G=class t{static activeStack=[];constructor(e={}){this.modal=e.modalElement??null,this.openButton=e.openButton??null,this.closeButton=e.closeButton??null,this.backdropButton=e.backdropButton??null,this.titleInput=e.titleInput??null,this.modalTitle=e.modalTitle??null,this.defaultTitle=e.defaultTitle??"",this.editTitle=e.editTitle??e.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=e.manageAria!==!1,this.enableFocusTrap=e.focusTrap!==!1,this.shouldAutoFocus=e.autoFocus!==!1,this.eventTarget=e.eventTarget??document,this.events={...Pe,...e.events||{}},this.animationHooks=e.animationHooks??{},this.enableStacking=e.enableStacking!==!1,this.isDisabled=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(!this.validateModal()){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return!this.modal||!(this.modal instanceof HTMLElement)?(console.warn("[ModalController] Modal element is not provided or invalid."),!1):(typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(e={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...e}),await this.runHook("onAfterShow")}}async hide(e={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...e}),await this.runHook("onAfterHide"))}focusTitleInput(){let e=this.titleInput||this.modal?.querySelector("[autofocus]");!e||typeof e.focus!="function"||window.setTimeout(()=>{try{e.focus({preventScroll:!0})}catch{e.focus()}},50)}async restoreFocus(){let e=this.previouslyFocusedElement||this.openButton;if(e&&typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(e={}){this.isDestroyed||(await this.hide(e),this.cleanup(),this.isDestroyed=!0)}setEditMode(e=!1){this.modalTitle&&(this.modalTitle.textContent=e?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",e?"edit":"create"),this.currentMode=e?"edit":"create"}handleOpenClick(e){e.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(e){e.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(e){e.preventDefault(),this.requestClose("backdrop")}handleCancel(e){e.preventDefault(),this.requestClose("keyboard")}handleKeydown(e){this.enableFocusTrap&&e.key==="Tab"&&this.maintainFocus(e),e.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(e){if(!this.modal)return;let i=this.getFocusableElements();if(i.length===0){e.preventDefault(),this.modal.focus();return}let n=i[0],s=i[i.length-1],o=document.activeElement;e.shiftKey&&o===n?(e.preventDefault(),s.focus()):!e.shiftKey&&o===s&&(e.preventDefault(),n.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(Ve)).filter(e=>!(e instanceof HTMLElement)||e.hasAttribute("disabled")?!1:e.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(e){if(!e||e.detail&&e.detail.controller&&e.detail.controller!==this)return;let i=e?.detail?.mode==="edit";this.setEditMode(i),this.show({reason:e?.detail?.reason||"external-open",mode:e?.detail?.mode})}handleDocumentCloseRequest(e){if(!e||e.detail?.controller&&e.detail.controller!==this||e.detail?.initiatedBy==="controller")return;let i=e.detail?.reason||"external-close";this.hide({reason:i})}dispatchEvent(e,i={}){let n=this.events[e];if(!n||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let s=new CustomEvent(n,{detail:i,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(s)}requestClose(e){let i={reason:e,controller:this};this.dispatchEvent("cancelled",i),this.dispatchEvent("closeRequest",{...i,initiatedBy:"controller"}),this.hide({reason:e})}async runHook(e){let i=this.animationHooks?.[e];typeof i=="function"&&await i(this)}addToStack(){let e=t.activeStack,i=e.indexOf(this);i!==-1&&e.splice(i,1),e.push(this),this.stackIndex=e.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let e=t.activeStack,i=e.indexOf(this);i!==-1&&e.splice(i,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var dt=Re(()=>{qe();Oe();me();ye();le();var ke=document.getElementById("title"),$e=document.getElementById("reminderText"),m=(()=>{let t=document.getElementById("cue-modal")??document.getElementById("cue_modal");return pe({modalElement:t,openButton:document.getElementById("openCueModal"),closeButton:document.getElementById("closeCueModal"),backdropButton:t?.querySelector(".modal-backdrop button")??null,titleInput:ke,modalTitle:document.getElementById("modal-title"),defaultTitle:Q,editTitle:Y})})();m?.setEditMode(!1);var je=()=>{let t=!!ke,e=!!$e;return!t&&!e?Promise.resolve():e?z({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",dateFeedbackSel:"#dateFeedback"}):z({titleSel:"#title",dateSel:"#date",timeSel:"#time",detailsSel:"#details",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveBtn",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",statusSel:"#status",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#inlineTotalCount",emptyStateSel:"#emptyState",listWrapperSel:"#remindersWrapper",dateFeedbackSel:"#dateFeedback",variant:"desktop"})};je().catch(t=>{console.error("Failed to initialise reminders",t)});var g=document.getElementById("cues-list"),T=document.getElementById("cue-form"),h=T?.querySelector("#cue-id-input"),Ke=m?.defaultTitle||m?.modalTitle?.textContent?.trim()||Q,bt=m?.editTitle||Y,U=document.getElementById("tab-cues"),N=document.getElementById("tab-daily"),C=document.getElementById("cues-view"),D=document.getElementById("daily-list-view"),ge=document.getElementById("daily-list-header"),Ee=document.getElementById("quick-add-form"),d=document.getElementById("quick-add-input"),u=document.getElementById("daily-voice-btn"),b=document.getElementById("daily-tasks-container"),J=document.getElementById("clear-completed-btn"),V=document.getElementById("daily-list-permission-notice"),Z=de(ce),ze={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},H=null;function Qe(t){if(!g)return;if(!Array.isArray(t)||t.length===0){g.innerHTML='<p class="text-sm text-base-content/60">No cues yet.</p>';return}let e=t.map(i=>{let n=S(M(i,"title")||"Untitled Cue"),s=S(M(i,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${n}</h2>
            ${s?`<p>${s}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${S(i.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${S(i.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");g.innerHTML=e}async function $(){return H||(H=(async()=>{let[{initializeApp:t,getApps:e},{getFirestore:i,enableMultiTabIndexedDbPersistence:n,enableIndexedDbPersistence:s,collection:o,doc:r,getDoc:c,addDoc:x,updateDoc:B,getDocs:p,query:y,orderBy:F,serverTimestamp:Be,setDoc:Fe,arrayUnion:Ie}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),j=e(),Me=j&&j.length?j[0]:t(ze),I=i(Me);(function(){let K=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;K&&(K.__persistenceInitialized__||(K.__persistenceInitialized__=!0,(async()=>{try{await n(I),console.info("[Firestore] Persistence: multi-tab enabled")}catch(v){if(v&&v.code==="failed-precondition")try{await s(I),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(ae){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",ae?.code||ae)}else v&&v.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",v?.code||v)}})()))})();let He=o(I,"cues");return{db:I,cuesCollection:He,getCollection:o,doc:r,getDoc:c,addDoc:x,updateDoc:B,getDocs:p,query:y,orderBy:F,serverTimestamp:Be,setDoc:Fe,arrayUnion:Ie}})().catch(t=>{throw console.error("Failed to initialise Firestore for cues",t),t}),H)}async function Ye(){let t=await $(),{getDocs:e,cuesCollection:i,query:n,orderBy:s}=t,o=n&&s?n(i,s("createdAt","desc")):i;return(await e(o)).docs.map(c=>({id:c.id,...c.data()}))}async function Ge(t){if(!t)return null;let e=await $(),{db:i,doc:n,getDoc:s}=e,o=n(i,"cues",t),r=await s(o);return r.exists()?{id:r.id,...r.data()}:null}async function Te(){if(g)try{let t=await Ye();Qe(t)}catch(t){console.error("Failed to load cues",t)}}function We(t){!T||!h||(ue(t,Z),h.value=t?.id||"",m?.setEditMode(!0),m?.show({mode:"edit"}))}async function Je(t){let e=t.target instanceof Element?t.target.closest(".edit-btn"):null;if(!e)return;t.preventDefault();let i=e.getAttribute("data-id");if(i)try{let n=await Ge(i);if(!n)return;We(n)}catch(n){console.error("Failed to prepare cue for editing",n)}}async function Ze(t){if(t.preventDefault(),!T||!h)return;let e=h.value.trim(),i=he(Z);try{let n=await $(),{db:s,doc:o,addDoc:r,updateDoc:c,cuesCollection:x,serverTimestamp:B}=n,p=typeof B=="function"?B():null;if(e){let y=o(s,"cues",e),F={...i};p&&(F.updatedAt=p),await c(y,F)}else{let y={...i};p&&(y.createdAt=p,y.updatedAt=p),await r(x,y)}await Te(),fe(Z,h,m?.modalTitle??null,Ke),await m?.hide({reason:"form-submit"})}catch(n){console.error("Failed to save cue",n)}}async function Xe(){!T||!h||!g||(await Te(),g.addEventListener("click",Je),T.addEventListener("submit",Ze))}T&&h&&(document.addEventListener("cue:prepare",()=>{h.value="",m?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{h.value="",m?.setEditMode(!1)}));T&&h&&g&&Xe().catch(t=>{console.error("Failed to initialise cue editing",t)});var a=[],R=null,k=!1,ve="dailyTasksByDate",q=null;function X(){let t=new Date,e=String(t.getFullYear()),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${n}`}function et(t){if(typeof t!="string")return"";let[e,i,n]=t.split("-"),s=Number.parseInt(e,10),o=Number.parseInt(i,10),r=Number.parseInt(n,10);if(!Number.isFinite(s)||!Number.isFinite(o)||!Number.isFinite(r))return t;let c=new Date(s,o-1,r);return Number.isNaN(c.getTime())?t:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(c)}function L(t){if(!J)return;let e=Array.isArray(t)&&t.some(i=>!!i?.completed);J.disabled=!e}function E(t){if(!b)return;if(!Array.isArray(t)||t.length===0){b.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',L([]);return}let e=t.map((i,n)=>{let s=S(i?.text||""),o=!!i?.completed,r=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return o&&r.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${n}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${n}" data-task-text="${s}" ${o?"checked":""} />
          <span class="${r.join(" ")}">${s}</span>
        </div>
      `}).join("");b.innerHTML=e,L(t)}function P(){V&&V.classList.remove("hidden")}function tt(){V&&V.classList.add("hidden")}function ee(t){return{text:typeof t?.text=="string"?t.text:"",completed:!!t?.completed}}function A(t){return Array.isArray(t)?t.map(e=>ee(e)):[]}function te(){if(typeof localStorage>"u")return{};try{let t=localStorage.getItem(ve);if(!t)return{};let e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch(t){return console.warn("Unable to read daily tasks from storage",t),{}}}function Se(t){if(!(typeof localStorage>"u"))try{let e=t&&typeof t=="object"?t:{};localStorage.setItem(ve,JSON.stringify(e))}catch(e){console.warn("Unable to persist daily tasks locally",e)}}function be(t){let e=te(),i=e&&typeof e=="object"?e[t]:[];return A(i)}function O(t,e){let i=te(),n=A(e);return i[t]=n,Se(i),n}function W(t,e){let i=te(),n=A(i[t]);return n.push(ee(e)),i[t]=n,Se(i),n}function ie(t){let e=typeof t?.code=="string"?t.code.toLowerCase():"";if(e)return e.includes("permission-denied")||e.includes("insufficient-permission");let i=typeof t?.message=="string"?t.message.toLowerCase():"";return!!(i&&i.includes("permission"))}async function ne(){return q||(q=$().then(t=>{let{db:e,getCollection:i}=t,n=typeof i=="function"&&e?i(e,"dailyLists"):null;return{...t,dailyListsCollection:n}}).catch(t=>{throw console.error("Failed to initialise Firestore for daily lists",t),t}),q)}function se(t,e){let{doc:i,dailyListsCollection:n,db:s}=t||{};if(typeof i!="function")throw new Error("Firestore document helper is unavailable");return n?i(n,e):i(s,"dailyLists",e)}async function we(){if(!ge||!b)return;let t=X(),e=et(t);if(ge.textContent=e?`Today's List - ${e}`:"Today's List",k){P();let i=be(t);return a=i,E(i),Promise.resolve(i)}return R||(b.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',L([]),R=(async()=>{try{let i=await ne(),n=se(i,t),s=await i.getDoc(n),o=s.exists()?s.data()?.tasks:[];a=A(o),E(a),O(t,a),k=!1,tt()}catch(i){if(ie(i)){console.warn("Falling back to local daily tasks due to permission issue",i),k=!0,P();let n=be(t);a=n,E(n);return}console.error("Failed to load daily list",i),b.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',a=[],L(a)}})().finally(()=>{R=null})),R}async function it(t){let e=X(),i=ee(t);if(k){W(e,i);return}try{let n=await ne(),s=se(n,e),o=await n.getDoc(s);if(o.exists()&&typeof n.arrayUnion=="function")await n.updateDoc(s,{tasks:n.arrayUnion(i)});else{let r=o.exists()?o.data()?.tasks:[],c=Array.isArray(r)?A(r):[];c.push(i),typeof n.setDoc=="function"?await n.setDoc(s,{tasks:c},{merge:!0}):await n.updateDoc(s,{tasks:c})}W(e,i)}catch(n){if(ie(n)){console.warn("Saving task locally because cloud sync is unavailable",n),k=!0,P(),W(e,i);return}throw n}}async function Ae(t){let e=X(),i=A(t);if(k){O(e,i);return}try{let n=await ne(),s=se(n,e);typeof n.setDoc=="function"?await n.setDoc(s,{tasks:i},{merge:!0}):await n.updateDoc(s,{tasks:i}),O(e,i)}catch(n){if(ie(n)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",n),k=!0,P(),O(e,i);return}throw n}}function Ce(t){[U,N].forEach(e=>{if(!e)return;let i=e===t;e.classList.toggle("tab-active",i),e.setAttribute("aria-selected",i?"true":"false")})}function nt(){!C||!D||(C.classList.remove("hidden"),D.classList.add("hidden"),Ce(U))}function st(){!C||!D||(C.classList.add("hidden"),D.classList.remove("hidden"),Ce(N),we())}U&&N&&C&&D&&(U.addEventListener("click",t=>{t.preventDefault(),nt()}),N.addEventListener("click",t=>{t.preventDefault(),st()}));var l=null,f=!1,_=null;function w(t){if(!u)return;u.setAttribute("aria-pressed",t?"true":"false");let e=u.querySelector('[aria-hidden="true"]');e?e.textContent=t?"\u{1F442}":"\u{1F399}\uFE0F":u.textContent=t?"\u{1F442}":"\u{1F399}\uFE0F"}function ot(){f&&(window.clearTimeout(_),_=window.setTimeout(()=>{_=null,f&&De(!0)},400))}function De(t=!1){if(!l)return!1;if(f&&!t)return!0;try{return l.start(),f=!0,w(!0),!0}catch{return f=!1,w(!1),!1}}function oe(){if(l){f=!1,window.clearTimeout(_);try{l.stop()}catch{}w(!1)}}function at(){if(u)try{let t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){u.setAttribute("disabled","true"),u.setAttribute("aria-disabled","true"),u.title="Voice input is not supported in this browser.";return}l=new t;let e=document.documentElement?.lang||navigator?.language||"en-AU";if(l.lang=e,l.interimResults=!1,"continuous"in l)try{l.continuous=!0}catch{}l.onresult=i=>{let n=i?.results?.[0]?.[0]?.transcript||"";if(n&&d){d.value=n.trim();try{d.focus({preventScroll:!0})}catch{d.focus()}try{let s=d.value.length;d.setSelectionRange(s,s)}catch{}}},l.onend=()=>{if(!f){w(!1);return}ot()},l.onerror=()=>{f=!1,w(!1)}}catch{l=null,w(!1),u.setAttribute("disabled","true"),u.setAttribute("aria-disabled","true")}}at();u?.addEventListener("click",()=>{l&&(f?oe():De())});Ee?.addEventListener("submit",()=>{f&&oe()});window.addEventListener("pagehide",()=>{f&&oe()});Ee?.addEventListener("submit",async t=>{if(t.preventDefault(),!d)return;let e=d.value.trim();if(!e){d.focus();return}let i={text:e,completed:!1};d.value="",d.focus();try{await it(i),await we()}catch(n){console.error("Failed to add task to the daily list",n),d.value=e,d.focus()}});b?.addEventListener("change",async t=>{let e=t.target instanceof HTMLInputElement?t.target:null;if(!e||e.type!=="checkbox")return;let i=Number.parseInt(e.getAttribute("data-task-index")||"",10);if(!Array.isArray(a)||Number.isNaN(i)||!a[i])return;let n=a.map(o=>({...o})),s=n.map((o,r)=>r===i?{...o,completed:e.checked}:o);a=s,E(s);try{await Ae(s)}catch(o){console.error("Failed to update task completion state",o),a=n,E(n)}});J?.addEventListener("click",async()=>{if(!Array.isArray(a)||a.length===0)return;let t=a.filter(i=>!i.completed);if(t.length===a.length)return;let e=a.map(i=>({...i}));a=t,E(t);try{await Ae(t)}catch(i){console.error("Failed to clear completed tasks",i),a=e,E(e)}});L(a);var Le="theme",rt=document.getElementById("theme-menu");function xe(t){if(typeof t!="string"||!t.trim())return;let e=t.trim();document.documentElement.setAttribute("data-theme",e);let i=new Set(["dark","dracula","synthwave"]);document.documentElement.classList.toggle("dark",i.has(e))}function lt(t){if(typeof t!="string"||!t.trim())return;let e=t.trim();try{localStorage.setItem(Le,e)}catch(i){console.warn("Unable to save theme preference",i)}}function ct(){let t="";try{t=localStorage.getItem(Le)||""}catch(e){console.warn("Unable to load theme preference",e)}t&&xe(t)}rt?.addEventListener("click",t=>{let e=t.target instanceof HTMLElement?t.target.closest("[data-theme-name]"):null;if(!e)return;t.preventDefault();let i=e.getAttribute("data-theme-name");i&&(xe(i),lt(i))});ct()});export default dt();
