import{a as rn,b as eo,c as sn,d as to,e as nt,g as no}from"./chunk-5FG3T7L3.js";import{a as nn,b as Xn}from"./chunk-MG4MJA24.js";import{b as on,c as Zn}from"./chunk-QHE5AMPX.js";import{b as tn,c as Qn}from"./chunk-GUVSRPRW.js";var qe,ot,oo,Ce,St,an,dn,cn,vt,ro,wt,un,me,rt,ln,io,ye,re,Lt,K,ie,Pe,fn,ke=tn(()=>{qe="memoryCueNotes",ot="memoryCueFolders",oo=["mobileNotes","memory-cue-notes"],Ce=()=>typeof localStorage<"u",St=null,an=r=>{St=typeof r=="function"?r:null},dn=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,cn=r=>{if(typeof r!="string")return"";let n=r.trim();return n.length?(/[<>]/.test(n),r):""},vt=r=>{if(typeof r!="string")return"";let n=r.trim();return n.length?/[<>]/.test(n)?r:cn(r):""},ro=(r="")=>{if(typeof document<"u"&&typeof document.createElement=="function"){let n=document.createElement("div");return n.innerHTML=typeof r=="string"?r:"",(n.textContent||n.innerText||"").replace(/\s+/g," ").trim()}return typeof r!="string"?"":r.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim()},wt=(r="",n="")=>{let i=ro(r);return i||(typeof n=="string"?n.trim():"")},un=r=>{if(typeof r!="string")return!1;let n=Date.parse(r);return!Number.isNaN(n)},me=(r,n,i={})=>{let s=typeof r=="string"?r.trim():"",f=typeof i.bodyHtml=="string"&&i.bodyHtml.length?i.bodyHtml:n,a=vt(f),m=typeof i.bodyText=="string"?i.bodyText:null,b=m!==null?m.trim():wt(a);return{id:i.id&&typeof i.id=="string"?i.id:dn(),title:s||"Untitled note",body:a,bodyHtml:a,bodyText:b,pinned:typeof i.pinned=="boolean"?i.pinned:!1,updatedAt:i.updatedAt&&un(i.updatedAt)?i.updatedAt:new Date().toISOString(),folderId:i.folderId&&typeof i.folderId=="string"?i.folderId:null}},rt=r=>{if(Array.isArray(r))return r.map(n=>{if(!n||typeof n!="object")return null;let i=typeof n.title=="string"?n.title.trim():"",s=typeof n.bodyHtml=="string"&&n.bodyHtml.length?n.bodyHtml:typeof n.body=="string"?n.body:typeof n.bodyText=="string"?n.bodyText:"",f=typeof n.bodyText=="string"?n.bodyText:"",a=vt(s||f),m=wt(a,f),b=typeof n.id=="string"&&n.id.trim()?n.id:dn(),M=un(n.updatedAt)?n.updatedAt:new Date().toISOString(),H=typeof n.pinned=="boolean"?n.pinned:!1;return!i&&!a&&!f?null:me(i||"Untitled note",a,{id:b,updatedAt:M,folderId:typeof n.folderId=="string"&&n.folderId?n.folderId:null,bodyHtml:a,bodyText:m,pinned:H})}).filter(Boolean);if(r&&typeof r=="object"){let n=typeof r.title=="string"?r.title:"",i=typeof r.bodyHtml=="string"&&r.bodyHtml.length?r.bodyHtml:typeof r.body=="string"?r.body:typeof r.bodyText=="string"?r.bodyText:"",s=typeof r.bodyText=="string"?r.bodyText:"",f=vt(i||s),a=wt(f,s),m=typeof r.pinned=="boolean"?r.pinned:!1;return!n&&!f&&!a?[]:[me(n,f,{id:typeof r.id=="string"?r.id:void 0,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:void 0,folderId:typeof r.folderId=="string"?r.folderId:void 0,bodyHtml:f,bodyText:a,pinned:m})]}return typeof r=="string"&&r.trim().length?[me("Notebook (legacy)",cn(r))]:[]},ln=r=>{if(!Ce())return null;try{return localStorage.getItem(r)}catch{return null}},io=r=>{if(Ce())try{localStorage.removeItem(r)}catch{}},ye=()=>{if(!Ce())return[];let r=ln(qe);if(typeof r=="string")try{let n=JSON.parse(r),i=rt(n);if(i.length)return i}catch{let n=rt(r);if(n.length)return re(n),n}for(let n of oo){let i=ln(n);if(typeof i=="string"&&i.trim().length){let s=rt(i);if(s.length)return re(s),io(n),s}}return[]},re=(r,n={})=>{if(!Ce()||!Array.isArray(r))return!1;let i=r.map(s=>{let a=rt([s])[0];return a&&(a.folderId=typeof s.folderId=="string"&&s.folderId?s.folderId:a.folderId||null,a.pinned=typeof s.pinned=="boolean"?s.pinned:!!a.pinned),a}).filter(Boolean);try{if(localStorage.setItem(qe,JSON.stringify(i)),!n.skipRemoteSync&&typeof St=="function")try{let s=St(i);s&&typeof s.then=="function"&&s.catch(f=>{console.error("[notes-storage] Remote sync failed.",f)})}catch(s){console.error("[notes-storage] Remote sync handler threw.",s)}return!0}catch{return!1}},Lt=()=>[{id:"unsorted",name:"Unsorted"}],K=()=>{if(!Ce())return Lt();try{let n=localStorage.getItem(ot);if(typeof n=="string"){let i=JSON.parse(n);if(Array.isArray(i)&&i.length){let s=!1,f=i.map((a,m)=>{let b=String(a.id),M=typeof a.name=="string"?a.name:String(a.id),H=typeof a.order=="number"?a.order:m;return typeof a.order!="number"&&(s=!0),{id:b,name:M,order:H}});if(s)try{localStorage.setItem(ot,JSON.stringify(f))}catch{}return f}}}catch{}let r=Lt();try{localStorage.setItem(ot,JSON.stringify(r))}catch{}return r},ie=r=>{let i=K().find(s=>s&&String(s.id)===String(r));return i?String(i.name):"Unsorted"},Pe=r=>{if(!Ce()||!Array.isArray(r))return!1;try{let n=r.filter(i=>i&&typeof i.id=="string"&&i.id.trim()).map((i,s)=>({id:i.id,name:typeof i.name=="string"?i.name:String(i.id),order:typeof i.order=="number"?i.order:s}));return n.length||n.push(...Lt()),localStorage.setItem(ot,JSON.stringify(n)),!0}catch{return!1}},fn=(r,n)=>{if(!r||typeof r!="string")return!1;let i=ye(),s=!1,f=i.map(m=>m.id===r?(s=!0,{...m,folderId:n&&typeof n=="string"?n:null,updatedAt:new Date().toISOString()}):m);return s?re(f):!1}});var so,lo,ao,it,co,uo,mn,yn=tn(()=>{Zn();ke();so="notes",lo="user_id",ao="updated_at",it=r=>{if(typeof r!="string")return 0;let n=Date.parse(r);return Number.isNaN(n)?0:n},co=(r=[],n=[])=>{let i=new Map;return n.forEach(s=>{s&&typeof s.id=="string"&&i.set(s.id,s)}),r.forEach(s=>{if(!s||typeof s.id!="string")return;let f=i.get(s.id);if(!f){i.set(s.id,s);return}let a=it(s.updatedAt),m=it(f.updatedAt);a>m&&i.set(s.id,s)}),Array.from(i.values()).sort((s,f)=>it(f?.updatedAt)-it(s?.updatedAt))},uo=r=>n=>{if(!n||typeof n!="object")return null;let i=typeof n.body_text=="string"?n.body_text:void 0,s=(typeof n.body_html=="string"&&n.body_html.length?n.body_html:null)??(typeof n.body=="string"&&n.body.length?n.body:null)??i,f={id:typeof n.id=="string"&&n.id?n.id:void 0,updatedAt:typeof n[r]=="string"?n[r]:void 0,folderId:typeof n.folder_id=="string"&&n.folder_id?n.folder_id:void 0,bodyHtml:s,bodyText:i,pinned:typeof n.pinned=="boolean"?n.pinned:void 0};return me(n.title,s,f)},mn=(r={})=>{let{tableName:n=so,userColumn:i=lo,updatedAtColumn:s=ao,supabase:f=null}=r,a=f||null,m=null,b=!1,M=new Set,H=null,F=()=>a||(a=on(),a),V=uo(s),U=async()=>(!m||b||H||(H=x().catch(()=>{}).finally(()=>{H=null})),H),X=async S=>{let A=F();if(!A||!m)return;let q=(Array.isArray(S)?S.filter(g=>g&&typeof g.id=="string"):[]).map(g=>({id:g.id,[i]:m,title:g.title,body:typeof g.bodyHtml=="string"&&g.bodyHtml.length?g.bodyHtml:g.body,body_html:typeof g.bodyHtml=="string"?g.bodyHtml:null,body_text:typeof g.bodyText=="string"?g.bodyText:null,folder_id:typeof g.folderId=="string"&&g.folderId?g.folderId:null,[s]:typeof g.updatedAt=="string"&&g.updatedAt?g.updatedAt:new Date().toISOString()})),Q=new Set(q.map(g=>g.id));if(q.length){let{error:g}=await A.from(n).upsert(q);if(g)throw g}let Z=[...M].filter(g=>g&&!Q.has(g));if(Z.length){let{error:g}=await A.from(n).delete().in("id",Z).eq(i,m);if(g)throw g}M=new Set(Q)},x=async()=>{let S=F();if(!(!S||!m))try{let{data:A,error:v}=await S.from(n).select(`id,title,body,body_html,body_text,folder_id,${s}`).eq(i,m);if(v)throw v;let q=Array.isArray(A)?A:[];M=new Set(q.map(R=>typeof R.id=="string"?R.id:null).filter(Boolean));let Q=q.map(V).filter(Boolean),Z=ye();if(!Q.length){if(Z.length)try{await X(Z)}catch(R){console.error("[notes-sync] Failed to upload local notes to Supabase.",R)}return}let g=co(Z,Q);b=!0;let ee=re(g,{skipRemoteSync:!0});b=!1,ee||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await X(g)}catch(R){console.error("[notes-sync] Failed to reconcile notes with Supabase.",R)}}catch(A){console.error("[notes-sync] Failed to fetch notes from Supabase.",A)}finally{b=!1}};an(async S=>{if(!b)try{await X(S)}catch(A){console.error("[notes-sync] Failed to sync notes to Supabase.",A)}});let y=async S=>{if(m=typeof S?.id=="string"?S.id:null,!m){M=new Set;return}await x()};return typeof window<"u"&&(window.addEventListener("online",U),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&U()})),{setSupabaseClient(S){S&&(a=S)},handleSessionChange:y,syncFromRemote:x}}});var yo=Qn(()=>{Xn();to();eo();ke();ke();ke();yn();no();ke();nn();(function(){let r=()=>{let n=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!(n instanceof HTMLElement)||!(i instanceof HTMLElement)){let d=typeof r._retryCount=="number"?r._retryCount:0;d<10&&(r._retryCount=d+1,setTimeout(r,50));return}if(r._initialised)return;r._initialised=!0;let s=n.querySelector("[data-dialog-content]"),f=n.querySelector(".sheet-backdrop"),a=document.getElementById("createReminderForm"),m=document.getElementById("saveReminder"),b=document.getElementById("priority"),M=document.getElementById("priorityChips"),H=n.querySelector(".reminder-editor-shell"),F=n.querySelector(".notif-switch-row"),V=n.querySelector("#notifBtn"),U=M?Array.from(M.querySelectorAll('input[name="priority"]')):[],X=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),x=Array.from(X).filter(d=>d instanceof HTMLElement),y=x[0]||null,S=()=>{n.classList.add("hidden"),n.setAttribute("hidden",""),n.setAttribute("aria-hidden","true"),n.removeAttribute("open"),n.classList.remove("open"),[f,s].forEach(d=>{d instanceof HTMLElement&&(d.classList.add("hidden"),d.setAttribute("hidden",""),d.setAttribute("aria-hidden","true"))})};S(),[F,V].forEach(d=>{d?.addEventListener("click",h=>h.stopPropagation())});let A=null,v=(d,h)=>{try{document.dispatchEvent(new CustomEvent(d,{detail:h}))}catch(w){console.warn(`${d} dispatch failed`,w)}},q=()=>{let d=b?.value||"Medium";U.forEach(h=>{let w=h.value===d;h.checked=w,h.setAttribute("aria-checked",w?"true":"false")})},Q=d=>{b&&(b.value!==d&&(b.value=d,b.dispatchEvent(new Event("change",{bubbles:!0}))),q())};U.forEach(d=>{d.addEventListener("change",()=>{d.checked&&Q(d.value)})}),b?.addEventListener("change",q),q();let Z=()=>{let d=n.querySelector('input, textarea, select, button, [contenteditable="true"]');d instanceof HTMLElement&&setTimeout(()=>{try{d.focus()}catch{}},0)},g=()=>{H instanceof HTMLElement&&(H.classList.remove("reminder-enter","reminder-enter-active"),H.offsetWidth,H.classList.add("reminder-enter"),requestAnimationFrame(()=>{H.classList.add("reminder-enter-active")}))},ee=d=>{if(A=d instanceof HTMLElement?d:null,!(n instanceof HTMLElement)){console.warn("cue:open skipped: sheet element missing");return}let h=[];f instanceof HTMLElement||h.push("backdrop"),s instanceof HTMLElement||h.push("content"),h.length&&console.warn(`cue:open incomplete: missing ${h.join(", ")}`),f instanceof HTMLElement&&(f.classList.remove("hidden"),f.removeAttribute("hidden"),f.setAttribute("aria-hidden","false")),s instanceof HTMLElement&&(s.classList.remove("hidden"),s.removeAttribute("hidden"),s.setAttribute("aria-hidden","false")),n.classList.remove("hidden"),n.removeAttribute("hidden"),n.setAttribute("aria-hidden","false"),n.setAttribute("open",""),n.classList.add("open"),A&&A.setAttribute("aria-expanded","true"),q(),Z(),g();let w=[{name:"sheet",el:n},{name:"backdrop",el:f},{name:"content",el:s}].filter(({el:L})=>L instanceof HTMLElement).filter(({el:L})=>L.classList.contains("hidden")||L.hasAttribute("hidden")||L.getAttribute("aria-hidden")==="true");w.length&&console.warn(`cue:open visibility issue: ${w.map(({name:L})=>L).join(", ")}`),v("reminder:sheet-opened",{trigger:A})},R=(d="dismissed")=>{let h=!n.classList.contains("hidden");H&&H.classList.remove("reminder-enter","reminder-enter-active"),S(),A&&A.setAttribute("aria-expanded","false");let w=A&&document.body.contains(A)&&A||y;if(w&&typeof w.focus=="function")try{w.focus()}catch{}h&&v("reminder:sheet-closed",{reason:d,trigger:A}),A=null},u=d=>{if(typeof window<"u"&&typeof window.openNewReminderSheet=="function"){window.openNewReminderSheet(d);return}let h={mode:"create",trigger:d};v("cue:prepare",h),v("cue:open",h)},T=(d,h=void 0)=>{if(!(d instanceof HTMLElement))return;let w=h||!1;d.addEventListener("click",L=>{L.preventDefault(),u(d)},w)},N=document.getElementById("mobile-footer-new-reminder");x.forEach(d=>{T(d,d===N?{capture:!0}:void 0)}),N&&!x.includes(N)&&T(N,{capture:!0}),i.addEventListener("click",d=>{d.preventDefault(),R("close-button")}),f?.addEventListener("click",d=>{d.target===f&&R("backdrop")}),n.addEventListener("keydown",d=>{d.key==="Escape"&&(d.stopPropagation(),R("escape"))}),s?.addEventListener("click",d=>{d.stopPropagation()}),n.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.hasAttribute("data-close")&&R("backdrop")}),document.addEventListener("cue:open",d=>{q(),ee(d?.detail?.trigger||null)}),document.addEventListener("cue:close",d=>{R(d?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{q()}),document.addEventListener("cue:cancelled",()=>{R("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=R),document.addEventListener("reminder:save",d=>{if(!(m instanceof HTMLElement))return;let h=d?.detail?.trigger;h&&h!==m||m.matches(":disabled")||m.click()}),a instanceof HTMLFormElement&&m instanceof HTMLElement&&a.addEventListener("submit",d=>{d.preventDefault(),!m.matches(":disabled")&&m.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r()})();var st=()=>{st._initialised||(st._initialised=!0,sn({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#startVoiceCaptureGlobal, #quickAddVoice"}).then(()=>{mo()}).catch(r=>{console.error("Failed to initialise reminders:",r)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",st,{once:!0}):st();var pn=()=>{let r=document.getElementById("notifHeaderBtn"),n=document.getElementById("notifBtn");r&&n&&r.addEventListener("click",()=>{n.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",pn,{once:!0}):pn();var At=null;function fo(){typeof At=="function"&&At({preserveDraft:!0})}var gn=()=>{if(typeof document>"u")return;let r=document.getElementById("noteTitleMobile"),n=document.getElementById("notebook-editor-body"),i=document.getElementById("noteSaveMobile"),s=document.getElementById("notesListMobile"),f=document.getElementById("notesCountMobile"),a=document.getElementById("notebook-search-input"),m=document.getElementById("folderFilterSelect"),b=document.getElementById("savedNotesSheet"),M=document.getElementById("openSavedNotesGlobal")||document.getElementById("savedNotesShortcut"),H=document.querySelector('[data-action="close-saved-notes"]'),F=document.getElementById("moveFolderSheet"),V=document.getElementById("move-folder-unsorted"),U=document.getElementById("move-folder-list"),X=document.getElementById("move-folder-create"),x=document.getElementById("move-folder-cancel"),y=F?.querySelector(".sheet-panel"),S=document.getElementById("note-folder-sheet"),A=document.getElementById("note-folder-sheet-backdrop"),v=S?.querySelector(".note-folder-sheet-list"),q=S?.querySelector(".note-folder-sheet-close"),Q="shadow-[0_0_0_3px_var(--accent-color)]",g=(()=>{if(!n)return null;let e=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return e?new e("#notebook-editor-body",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(n.setAttribute("contenteditable","true"),n.setAttribute("role","textbox"),n.setAttribute("aria-multiline","true"),n.dataset.placeholder="Start typing your note\u2026",{element:n,setContent(t=""){n.innerHTML=t||""},getHTML(){return n.innerHTML||""},getText(){return n.textContent||""},focus(){try{n.focus()}catch{}}})})();if(!r||!g||!n||!i)return;let ee=new Set(["bold","italic","underline","insertunorderedlist","insertorderedlist","indent","outdent"]);function R(){document.querySelectorAll(".rte-btn[data-cmd]").forEach(t=>{let o=(t.dataset.cmd||"").toLowerCase();if(!o||!ee.has(o)){t.classList.remove("active");return}try{let l=document.queryCommandState(o);t.classList.toggle("active",!!l)}catch{t.classList.remove("active")}})}let u=e=>{if(!(!e||!n)){try{n.focus()}catch{}try{document.execCommand(e,!1,null)}catch{}R();try{let t=new Event("input",{bubbles:!0});n.dispatchEvent(t)}catch{}}},T=document.getElementById("scratchNotesToolbar");T&&n&&T.addEventListener("click",e=>{let t=e.target.closest(".rte-btn[data-cmd]");if(!t)return;e.preventDefault(),e.stopPropagation();let o=t.getAttribute("data-cmd");o&&u(o)});let N=()=>g&&typeof g.getHtml=="function"?g.getHtml()||"":g&&typeof g.getHTML=="function"?g.getHTML()||"":n.innerHTML||"",d=(e="")=>{let t=typeof e=="string"?e:"";g&&typeof g.setHtml=="function"?g.setHtml(t):g&&typeof g.setContent=="function"?g.setContent(t):n.innerHTML=t},h=(e="")=>{let t=document.createElement("div");return t.innerHTML=typeof e=="string"?e:"",(t.textContent||t.innerText||"").replace(/\s+/g," ").trim()},w=(e="")=>{d(typeof e=="string"?e:""),R()},L=()=>N(),se=()=>h(N()),Tt=e=>{let t=e;for(;t&&t!==n;){if(t.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(t.tagName?.toLowerCase()))return t;t=t.parentNode}return n},le=e=>{if(typeof e!="string")return null;let t=e.replace(/\u00a0/g," ");return/^\s*[\*-]\s*$/.test(t)?"ul":/^\s*1\.?\s*$/.test(t)?"ol":null},hn=e=>{e.key===" "&&setTimeout(()=>{let t=window.getSelection();if(!t||t.rangeCount===0)return;let o=t.getRangeAt(0);if(!n.contains(o.startContainer))return;let l=Tt(o.startContainer),c=o.cloneRange();c.selectNodeContents(l),c.setEnd(o.startContainer,o.startOffset);let p=c.toString(),E=le(p);E&&(e.preventDefault(),c.deleteContents(),u(E==="ul"?"insertUnorderedList":"insertOrderedList"))},0)},bn=e=>{if(!e||e.altKey||!(e.ctrlKey||e.metaKey))return;let t=(e.key||"").toLowerCase(),o=null;t==="b"?o="bold":t==="i"?o="italic":t==="u"&&(o="underline"),o&&(e.preventDefault(),u(o))},It=(e,t=200)=>{let o;return(...l)=>{o&&clearTimeout(o),o=setTimeout(()=>{e(...l)},t)}},$=null,ge=!1,ae=!1,Y=[],j="all",W="unsorted",Fe=null,lt=null,xe=null,ze=null,Ve="",Me=!1,Le=null,at=()=>{Ve="",a&&(a.value="")},Nt=()=>b?.dataset.open==="true",En=()=>{if(b){Le&&(clearTimeout(Le),Le=null),b.classList.remove("hidden"),b.dataset.open="true",b.setAttribute("aria-hidden","false"),document.body.dataset.savedNotesOpen="true",document.documentElement.dataset.savedNotesOpen="true",window.scrollTo({top:0,left:0,behavior:"auto"});try{we()}catch{}try{Hn()}catch{}}},$e=()=>{b&&(b.dataset.open="false",b.setAttribute("aria-hidden","true"),delete document.body.dataset.savedNotesOpen,delete document.documentElement.dataset.savedNotesOpen,Le&&clearTimeout(Le),Le=setTimeout(()=>{b?.classList.add("hidden")},200))};(()=>{b&&(M?.addEventListener("click",e=>{e.preventDefault(),En();let t=document.getElementById("notesListMobile");t&&(t.scrollTop=0)}),H?.addEventListener("click",e=>{e.preventDefault(),$e()}),b.addEventListener("click",e=>{e.target===b&&$e()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Nt()&&$e()}))})();let Bt=()=>typeof Ve=="string"?Ve.trim().toLowerCase():"",Sn=(e=Y)=>{if(!Array.isArray(e))return[];let t=Bt();return t?e.filter(o=>{let l=typeof o?.title=="string"?o.title.toLowerCase():"",c=Ln(o).toLowerCase();return l.includes(t)||c.includes(t)}):[...e]},vn=(e=[])=>[...e].sort((t,o)=>{let l=!!t?.pinned,c=!!o?.pinned;return l!==c?l?-1:1:Ke(o)-Ke(t)}),Ct=(e=Y)=>{if(!Array.isArray(e))return[];let t;return j===null||j==="all"?t=[...e]:j==="unsorted"?t=e.filter(o=>!o.folderId||o.folderId==="unsorted"):t=e.filter(o=>o.folderId===j),vn(Sn(t))},kt=(e=[],t=[])=>{let o={all:Array.isArray(e)?e.length:0,unsorted:0};return(Array.isArray(t)?t:[]).forEach(l=>{l&&l.id&&l.id!=="unsorted"&&(o[l.id]=0)}),(Array.isArray(e)?e:[]).forEach(l=>{let c=l?.folderId||"unsorted";!c||c==="unsorted"?o.unsorted+=1:Object.prototype.hasOwnProperty.call(o,c)?o[c]+=1:o.unsorted+=1}),o},he=(e,t={})=>{let{isNew:o=!1}=t;if(e&&$===e.id&&!o)return;if(!e){ge=!1,ae=!1,$=null,r.value="",w(""),delete r.dataset.noteOriginalTitle,n.dataset.noteOriginalBody=L();let C=document.getElementById("note-folder-label");C&&(C.textContent=ie(W||"unsorted"));return}ge=!!o,ae=!1,$=e.id;let l=e.title||"",c=typeof e.bodyHtml=="string"?e.bodyHtml:null,p=typeof e.body=="string"?e.body:"",E=(c??p)||"";r.value=o?"":l,w(o?"":E),r.dataset.noteOriginalTitle=o?"":l,n.dataset.noteOriginalBody=L(),W=e.folderId&&typeof e.folderId=="string"?e.folderId:"unsorted";let O=document.getElementById("note-folder-label");O&&(O.textContent=ie(W))},wn=(e="")=>h(e),Ln=e=>{if(!e)return"";if(typeof e.bodyText=="string"&&e.bodyText.trim().length)return e.bodyText.trim();let t=typeof e.bodyHtml=="string"&&e.bodyHtml.trim().length?e.bodyHtml:typeof e.body=="string"?e.body:"";return wn(t)},De=()=>{if(!s)return;s.querySelectorAll('[data-role="open-note"][data-note-id]').forEach(t=>{if(!(t instanceof HTMLElement))return;let o=t.getAttribute("data-note-id")===$;o?t.setAttribute("data-state","active"):t.removeAttribute("data-state"),t.classList.toggle("selected",o),t.classList.toggle("active",o),t.classList.toggle("outline",o),t.classList.toggle("outline-2",o),t.classList.toggle("outline-accent",o),t.classList.toggle(Q,o),t.setAttribute("aria-current",o?"true":"false");let l=t.closest(".note-list-item, .note-row");l&&(l.classList.toggle("is-active",o),l.classList.toggle("selected",o))})},An=e=>{if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let o=new Date,l=t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate(),c=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return l?`Today \xB7 ${c}`:`${t.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${c}`},dt=()=>{if(ge&&!ae)return!1;let e=typeof r.value=="string"?r.value:"",t=N(),o=r.dataset.noteOriginalTitle??"",l=n.dataset.noteOriginalBody??"";return e!==o||t!==l},Ft=()=>{let e=typeof r.value=="string"?r.value.trim():"",t=se();return!!e||!!t},Tn=()=>{let e=document.querySelector(".note-editor-card");e&&(e.scrollTop=0);let t=document.querySelector(".note-editor-inner");t&&(t.scrollTop=0)},In=()=>typeof window<"u"&&window.innerWidth<768||/Mobi|Android/i.test(typeof navigator<"u"?navigator.userAgent:""),Ke=e=>{if(!e)return 0;let t=[e.updatedAt,e.modifiedAt,e.createdAt];for(let o of t){let l=Date.parse(o||"");if(!Number.isNaN(l))return l}return 0},Nn=()=>{let e=ye();return Array.isArray(e)?[...e].sort((t,o)=>Ke(o)-Ke(t)):[]},ct=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(qe)}catch{return null}},He=ct(),Ge=()=>(He=ct(),He),de=({preserveDraft:e=!0}={})=>{let t=Nn();Y=Array.isArray(t)?[...t]:[];let o=e&&dt(),l=Y.length>0,c=Ct();if(ut(c),!l)return o||he(null),De(),Ge(),Me=!1,c;if($){let p=Y.find(E=>E.id===$)||null;p?o||he(p):($=null,!o&&!Me&&Y[0]&&he(Y[0]))}else!o&&!Me&&Y[0]&&he(Y[0]);return Me=!1,De(),Ge(),c};At=(e={})=>{try{de(e)}catch(t){console.warn("[notebook] requestNotesRefresh failed",t)}};let Bn=160,Cn=e=>{if(!e)return null;let t=document.createElement("div");return t.className="note-toast",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t&&t.parentNode&&t.parentNode.removeChild(t)},2800),t},kn=e=>{Cn(`Moved to ${e||"folder"}`)},Fn=typeof requestAnimationFrame=="function"?requestAnimationFrame:e=>setTimeout(e,0),xn=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:e=>clearTimeout(e),Ye=null,je=null,Mn=e=>{if(typeof e=="function"){if(!s){e();return}Ye&&(clearTimeout(Ye),Ye=null),je&&(xn(je),je=null),s.classList.remove("notebook-list-transition-in","notebook-list-transition-in-active"),s.classList.add("notebook-list-transition-out"),Ye=setTimeout(()=>{e(),s.classList.remove("notebook-list-transition-out"),s.classList.add("notebook-list-transition-in"),je=Fn(()=>{s.classList.add("notebook-list-transition-in-active")})},Bn)}},Dn=e=>{if(!e)return;let t=ye();if(!Array.isArray(t))return;let o=t.filter(l=>l.id!==e);o.length!==t.length&&(re(o),Ge(),$===e&&(he(null),Me=!0),de({preserveDraft:!1}))},ut=(e=[],{withTransition:t=!0}={})=>{if(t)return Mn(()=>ut(e,{withTransition:!1})),e;if(!s)return e;if(s.innerHTML="",f){let o=Y.length,l=e.length;f.textContent=o?`${l} of ${o} saved`:"No saved notes yet"}if(!e.length){let o=!!Bt(),l=o?"No notes found":"No notes yet",c=o?"Try a different search term or clear the search.":"Create a new note to start capturing your ideas.";return s.innerHTML=`
        <div class="notebook-empty">
          <div class="notebook-empty-title">${l}</div>
          <div class="notebook-empty-body">${c}</div>
        </div>
      `,e}return e.forEach(o=>{let l=document.createElement("li"),c=String(o.id)===String($),p=!!o?.pinned;l.className="note-item-mobile";let E=document.createElement("div");E.className="note-card note-row note-list-item",E.classList.toggle("selected",c),E.classList.toggle("is-active",c),E.dataset.noteId=o.id,E.dataset.role="open-note",E.setAttribute("role","button"),E.tabIndex=0;let O=document.createElement("div");O.className="note-row-main note-list-main note-card-main",O.dataset.role="open-note",O.dataset.noteId=o.id;let C=typeof o.title=="string"&&o.title.trim()||"Untitled",B=document.createElement("div");B.className="note-row-title note-list-title note-card-title",B.textContent=C,B.setAttribute("title",C);let I=document.createElement("div");if(I.className="note-row-title-row note-list-title-row note-card-header",I.appendChild(B),p){let P=document.createElement("span");P.className="note-list-pin-icon",P.textContent="\u{1F4CC}",P.setAttribute("aria-hidden","true"),I.appendChild(P)}let D=o.folderId&&typeof o.folderId=="string"?o.folderId:"unsorted",z=ie(D)||"Unsorted",oe=An(o.updatedAt),k=document.createElement("div");k.className="note-row-meta note-list-meta note-card-meta";let _=document.createElement("button");if(_.type="button",_.className="note-row-folder note-list-folder note-card-folder",_.textContent=z,_.setAttribute("aria-label","Move note to folder"),_.addEventListener("click",P=>{P.preventDefault(),P.stopPropagation(),ht(o.id,{initialFolderId:D,triggerEl:_})}),k.appendChild(_),oe){let P=document.createElement("span");P.className="note-row-dot note-list-dot note-card-meta-dot",P.textContent="\u2022";let fe=document.createElement("span");fe.className="note-row-timestamp note-list-date note-card-timestamp",fe.textContent=oe,k.appendChild(P),k.appendChild(fe)}O.appendChild(I),O.appendChild(k);let J=document.createElement("button");J.type="button",J.dataset.noteId=o.id,J.dataset.role="note-menu",J.className="note-row-overflow note-list-overflow note-options-button note-card-action",J.setAttribute("aria-label","Note actions"),J.tabIndex=0,J.setAttribute("aria-haspopup","true"),J.textContent="\u22EF",I.appendChild(J),E.appendChild(O),l.appendChild(E),s.appendChild(l)}),De(),e},xt=()=>document.getElementById("notebook-folder-bar"),ft=e=>{let t=xt();if(!t)return;t.querySelectorAll(".notebook-folder-chip").forEach(l=>{let c=String(l.dataset.folderId)===String(e);if(l.classList.toggle("notebook-folder-chip--active",c),l.classList.toggle("active",c),c)try{l.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}catch{try{l.scrollIntoView()}catch{}}})},Mt=()=>{let e=[];try{e=Array.isArray(K())?K():[]}catch{e=[]}let t=Array.isArray(e)?e.filter(Boolean):[],o=t.find(p=>p&&p.id==="unsorted")||{id:"unsorted",name:"Unsorted"},l=t.filter(p=>p&&p.id!=="unsorted").sort((p,E)=>String(p.name||"").localeCompare(String(E.name||""),void 0,{sensitivity:"base"}));return{chipModel:[{id:"all",name:"All notes",isVirtual:!0},{...o,isVirtual:!1},...l.map(p=>({...p,isVirtual:!1}))],unsortedFolder:o,extraFolders:l}},Dt=e=>{if(!m)return;let t=e||"all";m.value=t},Ht=(e=null)=>{if(!m)return;let t=Array.isArray(e)?e:Mt().chipModel;m.innerHTML="",t.forEach(o=>{let l=document.createElement("option");l.value=o.id||"unsorted",l.textContent=o.name||"Folder",m.appendChild(l)}),Dt(j)},Oe=()=>{let e=xt();if(!e)return;e.innerHTML="";let t=document.createElement("div");t.className="notebook-folder-filter-bar";let{chipModel:o,unsortedFolder:l,extraFolders:c}=Mt(),p=[l,...c],E=kt(Y,p),O=D=>{let z=document.createElement("button");z.type="button",z.className="folder-chip notebook-folder-chip notebook-tab",z.dataset.folderId=D.id;let oe=document.createElement("span");oe.className="notebook-folder-chip-label",oe.textContent=D.name,z.appendChild(oe);let k=document.createElement("span");k.className="notebook-folder-chip-count";let _=D.id==="all"?"all":D.id||"unsorted",J=typeof E[_]=="number"?E[_]:0;if(k.textContent=J,z.appendChild(k),z.addEventListener("click",()=>{j=D.id==="all"?"all":D.id,ft(j),at(),we()}),D.id!=="all"&&D.id!=="unsorted"){let P=document.createElement("button");P.type="button",P.className="notebook-folder-chip-overflow",P.setAttribute("aria-label","Folder options"),P.innerHTML="\u22EF",P.addEventListener("click",fe=>{fe.stopPropagation(),Pn(D.id,z)}),z.appendChild(P)}return z};o.forEach(D=>{t.appendChild(O(D))});let C=document.createElement("div");C.className="notebook-folder-scroll-wrap",C.appendChild(t);let B=document.createElement("div");B.className="notebook-folder-header";let I=document.createElement("div");I.className="folder-chips",I.appendChild(C),B.appendChild(I),e.appendChild(B),ft(j),Ht(o)},Hn=()=>{if(!b)return;try{let t=document.getElementById("notebook-folder-bar");if(t){let o=t.querySelector('[data-folder-id="new-folder"], .new-folder-btn, .notebook-folder-chip--new');o&&o.remove()}}catch{}if(document.getElementById("fabNewFolder"))return;try{b.style.position=b.style.position||"fixed"}catch{}let e=document.createElement("button");e.id="fabNewFolder",e.type="button",e.className="fab-new-folder fab-button",e.setAttribute("aria-label","Create new folder"),e.setAttribute("title","Create new folder"),e.innerHTML=`
      <span aria-hidden="true">+</span>
      <span class="sr-only">New folder</span>
    `,e.addEventListener("click",t=>{t.preventDefault();try{Je()}catch(o){console.warn("[notebook] openNewFolderDialog() not available",o)}}),b.appendChild(e)},Ot=document.getElementById("newFolderModal"),ne=document.getElementById("newFolderName"),Ae=document.getElementById("newFolderError"),_t=document.getElementById("newFolderCreate"),mt=document.getElementById("newFolderCancel"),We=null,be=null,Rt=()=>{Ae&&(Ae.classList.add("sr-only"),Ae.textContent="")},yt=e=>{Ae&&(Ae.textContent=e,Ae.classList.remove("sr-only"))},Je=()=>{if(!Ot){console.warn("[notebook] #newFolderModal not found; create folder modal missing");return}We||(We=new nt({modalElement:Ot,closeButton:mt,titleInput:ne,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),Rt(),ne&&(ne.value="",setTimeout(()=>{try{ne.focus(),ne.select&&ne.select()}catch{}},20)),We.show()};typeof window<"u"&&typeof window.openNewFolderDialog>"u"&&(window.openNewFolderDialog=Je);let Ut=()=>{if(!ne)return;let t=String(ne.value||"").trim();if(Rt(),!t.length){yt("Folder name can't be empty.");return}let o=[];try{o=Array.isArray(K())?K():[]}catch{o=[]}if(o.some(C=>String(C.name).toLowerCase()===t.toLowerCase())){yt("You already have a folder with this name.");return}let c=`folder-${Date.now().toString(36)}`,p={id:c,name:t},E=[...o.filter(Boolean),p];if(!Pe(E))return yt("Unable to create folder. Please try again."),null;try{We.requestClose("created")}catch{}try{Oe()}catch(C){console.warn("[notebook] rebuild folder chips failed",C)}if(typeof be=="function"){try{be(c,t)}catch(C){console.warn("[notebook] post-create handler failed",C)}be=null}return c};_t&&_t.addEventListener("click",e=>{e.preventDefault(),Ut()}),ne&&ne.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Ut())}),mt&&mt.addEventListener("click",()=>{be=null});let Ee=document.getElementById("note-folder-button")||document.getElementById("noteFolderPillMobile");Ee&&Ee.addEventListener("click",e=>{e.preventDefault(),ht($,{initialFolderId:W,triggerEl:Ee})});let pe=null,Te=null,te=()=>{pe&&pe.parentNode&&pe.parentNode.removeChild(pe);let e=Te&&document.body.contains(Te)&&typeof Te.focus=="function"?Te:null;if(pe=null,Te=null,document.removeEventListener("click",te),document.removeEventListener("keydown",qt),e)try{e.focus()}catch{}},qt=e=>{e.key==="Escape"&&(e.preventDefault(),te()),e.key==="Tab"&&requestAnimationFrame(()=>{pe&&!pe.contains(document.activeElement)&&te()})},ce=document.getElementById("note-options-overlay"),G=document.getElementById("note-options-sheet"),pt=G?.querySelector(".note-action-move"),Qe=G?.querySelector(".note-action-toggle-pin"),Pt=G?.querySelector(".note-action-delete"),ue=null,On=()=>G&&G.classList.contains("open"),Ie=()=>{ue=null,G&&(G.classList.remove("open"),G.setAttribute("aria-hidden","true"),G.removeAttribute("data-note-id")),ce&&(ce.classList.remove("open"),ce.setAttribute("aria-hidden","true"))},_n=e=>{e.key==="Escape"&&On()&&(e.preventDefault(),Ie())},zt=e=>{if(!e||!G||!ce)return;Ie(),te(),ue=e;let t=Y.find(o=>o.id===e);if(Qe){let o=!!t?.pinned;Qe.textContent=o?"Unpin note":"Pin note"}G.classList.add("open"),G.setAttribute("aria-hidden","false"),G.setAttribute("data-note-id",e),ce.classList.add("open"),ce.setAttribute("aria-hidden","false")};ce&&ce.addEventListener("click",e=>{e.preventDefault(),Ie()}),G&&pt&&pt.addEventListener("click",e=>{e.preventDefault();let t=Y.find(o=>o.id===ue);Ie(),ue&&ht(ue,{initialFolderId:t&&t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted",triggerEl:pt})}),G&&Qe&&Qe.addEventListener("click",e=>{if(e.preventDefault(),!ue)return;let t=ye(),o=!1,l=(Array.isArray(t)?t:[]).map(c=>{if(c&&c.id===ue){o=!0;let p=!c.pinned;return{...c,pinned:p,updatedAt:new Date().toISOString()}}return c});o&&(re(l),de({preserveDraft:!0})),Ie()}),G&&Pt&&Pt.addEventListener("click",e=>{e.preventDefault(),ue&&Dn(ue),Ie()}),G&&ce&&document.addEventListener("keydown",_n);let Xe=(e,t)=>{if(!e)return;let o=t==="unsorted"?null:t;if(fn(e,o)){try{de({preserveDraft:!0})}catch(c){console.warn("[notebook] failed to refresh notes after move",c)}try{Oe()}catch(c){console.warn("[notebook] failed to refresh folder chips after move",c)}try{let c=ie(o||"unsorted")||"Unsorted";kn(c)}catch{}if(e===$){W=o||"unsorted";let c=document.getElementById("note-folder-label");c&&(c.textContent=ie(W))}te()}},_e=()=>{S&&(S.classList.remove("open"),S.setAttribute("aria-hidden","true")),A&&(A.classList.remove("open"),A.setAttribute("aria-hidden","true")),lt=null,document.removeEventListener("keydown",Rn),v&&(v.innerHTML="")},Vt=e=>{let t=lt||$;t&&Xe(t,e||"unsorted"),_e()},$t=e=>{e&&(e.preventDefault(),e.stopPropagation());let t=lt||$;be=o=>{t&&Xe(t,o||"unsorted"),_e()},Je()},Rn=e=>{e.key==="Escape"&&(e.preventDefault(),_e())};v&&(v.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(".note-folder-row"):null;if(!(!t||!v.contains(t))){if(t.classList.contains("note-folder-row-new")){$t(e);return}e.preventDefault(),Vt(t.dataset.folderId||"unsorted")}}),v.addEventListener("keydown",e=>{if(e.key!=="Enter"&&e.key!==" ")return;let t=e.target instanceof HTMLElement?e.target.closest(".note-folder-row"):null;if(!(!t||!v.contains(t))){if(t.classList.contains("note-folder-row-new")){$t(e);return}e.preventDefault(),Vt(t.dataset.folderId||"unsorted")}})),q&&q.addEventListener("click",e=>{e.preventDefault(),_e()}),A&&A.addEventListener("click",e=>{e.preventDefault(),_e()});let Un='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Kt=()=>{if(!y)return[];let e=y.querySelectorAll(Un);return Array.from(e).filter(t=>t instanceof HTMLElement&&!t.hasAttribute("disabled")&&t.tabIndex!==-1&&t.offsetParent!==null)},qn=()=>{let e=Kt();if(e.length){try{e[0].focus({preventScroll:!0})}catch{}return}if(y)try{y.focus({preventScroll:!0})}catch{}},Gt=e=>{let t=String(e||"unsorted");if((U?.querySelectorAll(".folder-select-row")||[]).forEach(l=>{if(!(l instanceof HTMLElement))return;let c=l.dataset.folderId===t;l.classList.toggle("folder-select-row--active",c),l.setAttribute("aria-selected",c?"true":"false")}),V){let l=t==="unsorted";V.classList.toggle("folder-select-row--active",l),V.setAttribute("aria-selected",l?"true":"false")}},Yt=e=>{if(!F||F.classList.contains("hidden"))return;if(e.key==="Escape"){e.preventDefault(),Ne();return}if(e.key!=="Tab")return;let t=Kt();if(!t.length)return;let o=t[0],l=t[t.length-1],c=document.activeElement;e.shiftKey&&c===o?(e.preventDefault(),l.focus()):!e.shiftKey&&c===l&&(e.preventDefault(),o.focus())},gt=e=>{let t=e||"unsorted";if(Gt(t),xe)xe(t);else if(Fe)Xe(Fe,t);else{W=t;let o=document.getElementById("note-folder-label");o&&(o.textContent=ie(W))}Ne()},Ne=(e={})=>{let{preserveCreateHandler:t=!1}=e||{};if(F&&(F.classList.add("hidden"),F.setAttribute("aria-hidden","true")),U&&U.querySelectorAll(".folder-select-row").forEach(l=>{l.id!=="move-folder-unsorted"&&l.remove()}),Fe=null,xe=null,t||(be=null),document.removeEventListener("keydown",Yt),Ee&&Ee.setAttribute("aria-expanded","false"),ze instanceof HTMLElement)try{ze.focus({preventScroll:!0})}catch{}ze=null},ht=(e,t={})=>{if(!F||!U)return;let{onSelect:o=null,initialFolderId:l=null,triggerEl:c=null}=t;Fe=e||null,xe=typeof o=="function"?o:null,ze=c||document.activeElement,U.querySelectorAll(".folder-select-row").forEach(k=>{k.id!=="move-folder-unsorted"&&k.remove()});let E=[];try{E=Array.isArray(K())?K():[]}catch{E=[]}let O={id:"unsorted",name:"Unsorted"},C=E.some(k=>k&&k.id==="unsorted");C||E.unshift(O);let B=e&&Y.find(k=>k.id===e)||null,I=l||(B&&typeof B.folderId=="string"&&B.folderId?B.folderId:W||"unsorted"),D=E.filter(k=>k&&k.id!=="unsorted").sort((k,_)=>(Number(k.order)||0)-(Number(_.order)||0)),z=kt(Y,[O,...D]);if(V){let k=V.querySelector(".folder-select-row__count");k&&(k.textContent=z.unsorted||0);let _=V.querySelector(".folder-select-row__name");_&&(_.textContent=C&&ie("unsorted")||"Unsorted")}let oe=k=>{let _=document.createElement("button");_.className="folder-select-row",_.dataset.folderId=k.id,_.setAttribute("role","option"),_.type="button",_.setAttribute("aria-selected","false");let J=document.createElement("div");J.className="folder-select-row__left";let P=document.createElement("span");P.className="folder-select-row__dot",P.setAttribute("aria-hidden","true"),J.appendChild(P);let fe=document.createElement("span");fe.className="folder-select-row__name",fe.textContent=k.name||String(k.id),J.appendChild(fe),_.appendChild(J);let Et=document.createElement("span");return Et.className="folder-select-row__count",Et.textContent=z[k.id]||0,_.appendChild(Et),_};if(D.forEach(k=>{if(typeof k.id>"u")return;let _=oe(k);U.appendChild(_)}),Gt(I),F.classList.remove("hidden"),F.setAttribute("aria-hidden","false"),y)try{y.focus({preventScroll:!0})}catch{}c===Ee&&Ee.setAttribute("aria-expanded","true"),document.addEventListener("keydown",Yt),qn()};U&&(U.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(".folder-select-row"):null;!t||!U.contains(t)||(e.preventDefault(),gt(t.dataset.folderId||"unsorted"))}),U.addEventListener("keydown",e=>{if(e.key!=="Enter"&&e.key!==" ")return;let t=e.target instanceof HTMLElement?e.target.closest(".folder-select-row"):null;!t||!U.contains(t)||(e.preventDefault(),gt(t.dataset.folderId||"unsorted"))})),V&&V.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),gt("unsorted")}),F&&F.addEventListener("click",e=>{e.target===F&&(e.preventDefault(),Ne())}),x&&x.addEventListener("click",e=>{e.preventDefault(),Ne()}),X&&X.addEventListener("click",e=>{e.preventDefault();let t=Fe||$,o=xe;be=l=>{if(o)o(l);else if(t)Xe(t,l);else{W=l||"unsorted";let c=document.getElementById("note-folder-label");c&&(c.textContent=ie(W))}Ne()},Ne({preserveCreateHandler:!0}),Je()});let jt=(e,t)=>{if(!e||t!==-1&&t!==1)return;let o=[];try{o=Array.isArray(K())?K().slice():[]}catch{o=[]}if(!o.length)return;let l=o.filter(I=>I&&I.id!=="unsorted");l.sort((I,D)=>(Number(I.order)||0)-(Number(D.order)||0));let c=l.findIndex(I=>String(I.id)===String(e));if(c===-1)return;let p=c+t;if(p<0||p>=l.length)return;let E=l[c].order;l[c].order=l[p].order,l[p].order=E;let B=[o.find(I=>I&&I.id==="unsorted")||{id:"unsorted",name:"Unsorted",order:-1},...l].map((I,D)=>({id:I.id,name:I.name,order:D}));try{if(Pe(B)){try{Oe()}catch{}try{we()}catch{}}}catch(I){console.warn("[notebook] reorder save failed",I)}},Pn=(e,t)=>{if(!e||e==="all"||e==="unsorted")return;te();let o=document.createElement("div");o.className="memory-glass-card p-2 rounded shadow-lg",o.style.position="absolute",o.style.zIndex=1200,o.style.minWidth="160px";let l=!1,c=!1;try{let I=(Array.isArray(K())?K().filter(Boolean):[]).filter(z=>z&&z.id!=="unsorted").sort((z,oe)=>(Number(z.order)||0)-(Number(oe.order)||0)),D=I.findIndex(z=>String(z.id)===String(e));l=D===0,c=D===-1?!0:D===I.length-1}catch{l=!1,c=!1}let p=document.createElement("button");p.type="button",p.className="w-full text-left px-3 py-2 btn-ghost",p.textContent="Move up",l&&(p.setAttribute("disabled",""),p.classList.add("opacity-50","cursor-not-allowed")),p.addEventListener("click",B=>{B.preventDefault();try{jt(e,-1)}catch(I){console.warn("[notebook] reorder move up failed",I)}te()});let E=document.createElement("button");E.type="button",E.className="w-full text-left px-3 py-2 btn-ghost",E.textContent="Move down",c&&(E.setAttribute("disabled",""),E.classList.add("opacity-50","cursor-not-allowed")),E.addEventListener("click",B=>{B.preventDefault();try{jt(e,1)}catch(I){console.warn("[notebook] reorder move down failed",I)}te()});let O=document.createElement("button");O.type="button",O.className="w-full text-left px-3 py-2 btn-ghost",O.textContent="Rename folder",O.addEventListener("click",B=>{B.preventDefault(),Vn(e),te()});let C=document.createElement("button");C.type="button",C.className="w-full text-left px-3 py-2 btn-ghost text-accent",C.textContent="Delete folder",C.addEventListener("click",B=>{B.preventDefault(),Kn(e),te()}),o.appendChild(p),o.appendChild(E),o.appendChild(O),o.appendChild(C),document.body.appendChild(o),pe=o,Te=t instanceof HTMLElement?t:null;try{let B=t.getBoundingClientRect(),I=B.bottom+window.scrollY+6,D=B.left+window.scrollX;o.style.top=`${I}px`,o.style.left=`${D}px`}catch{o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)"}document.addEventListener("click",te),document.addEventListener("keydown",qt)},Wt=document.getElementById("renameFolderModal"),Se=document.getElementById("renameFolderName"),Be=document.getElementById("renameFolderError"),Jt=document.getElementById("renameFolderSave"),zn=document.getElementById("renameFolderCancel"),Ze=null,Re=null,Qt=()=>{Be&&(Be.classList.add("sr-only"),Be.textContent="")},bt=e=>{Be&&(Be.textContent=e,Be.classList.remove("sr-only"))},Vn=e=>{if(!Wt||e==="all"||e==="unsorted")return;Re=e;let o=(Array.isArray(K())?K():[]).find(l=>l&&String(l.id)===String(e));o&&(Ze||(Ze=new nt({modalElement:Wt,closeButton:zn,titleInput:Se,modalTitle:document.getElementById("renameFolderTitle"),autoFocus:!0})),Qt(),Se&&(Se.value=o.name||""),Ze.show())},Xt=()=>{if(!Re||!Se)return;let t=String(Se.value||"").trim();if(Qt(),!t.length){bt("Folder name can't be empty.");return}let o=[];try{o=Array.isArray(K())?K():[]}catch{o=[]}if(o.some(E=>String(E.name).toLowerCase()===t.toLowerCase()&&String(E.id)!==String(Re))){bt("You already have a folder with this name.");return}let c=o.map(E=>String(E.id)===String(Re)?{...E,name:t}:E);if(!Pe(c)){bt("Unable to rename folder. Please try again.");return}try{Ze.requestClose("saved")}catch{}Re=null;try{Oe()}catch{}we()};Jt&&Jt.addEventListener("click",e=>{e.preventDefault(),Xt()}),Se&&Se.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Xt())});let Zt=document.getElementById("deleteFolderModal"),en=document.getElementById("deleteFolderConfirm"),$n=document.getElementById("deleteFolderCancel"),Ue=null,ve=null,Kn=e=>{!Zt||e==="all"||e==="unsorted"||(ve=e,Ue||(Ue=new nt({modalElement:Zt,closeButton:$n,titleInput:null,modalTitle:document.getElementById("deleteFolderTitle"),autoFocus:!1})),Ue.show())},Gn=()=>{if(!ve)return;let e=[];try{e=Array.isArray(K())?K():[]}catch{e=[]}let t=e.filter(p=>String(p.id)!==String(ve));if(t.some(p=>p&&p.id==="unsorted")||t.unshift({id:"unsorted",name:"Unsorted"}),!Pe(t)){try{Ue.requestClose("failed")}catch{}ve=null;return}let l=ye(),c=(Array.isArray(l)?l:[]).map(p=>p&&String(p.folderId)===String(ve)?{...p,folderId:"unsorted",updatedAt:new Date().toISOString()}:p);re(c),String(j)===String(ve)&&(j="unsorted",at()),ve=null;try{Ue.requestClose("deleted")}catch{}Oe(),we()};en&&en.addEventListener("click",e=>{e.preventDefault(),Gn()}),s&&(s.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let o=t.closest('.note-options-button, button[data-role="note-menu"]');if(o&&s.contains(o)){e.preventDefault(),e.stopPropagation();let c=o.getAttribute("data-note-id")||(o.closest("[data-note-id]")||o).getAttribute("data-note-id");if(!c)return;zt(c);return}let l=t.closest('[data-role="open-note"]');if(l&&s.contains(l)){e.preventDefault();let c=l.getAttribute("data-note-id");if(!c)return;let p=Y.find(E=>E.id===c);p&&(he(p),De(),Nt()&&$e())}}),s.addEventListener("pointerup",e=>{if(!(e instanceof PointerEvent)||e.pointerType!=="touch")return;let t=e.target instanceof HTMLElement?e.target:null;if(!t)return;let o=t.closest('.note-options-button, button[data-role="note-menu"]');if(o&&s.contains(o)){e.preventDefault(),e.stopPropagation();let l=o.getAttribute("data-note-id")||(o.closest("[data-note-id]")||o).getAttribute("data-note-id");if(!l)return;zt(l);return}}));let we=()=>{ut(Ct())};if(a){let e=It(()=>{Ve=typeof a.value=="string"?a.value.trim():"",we()},200);a.addEventListener("input",e),a.addEventListener("search",e)}m&&m.addEventListener("change",e=>{j=e?.target?.value||"all"||"all",ft(j),Dt(j),at(),we()});let Yn=()=>{de({preserveDraft:!1})},jn=e=>{if(!e)return;W=e.folderId&&typeof e.folderId=="string"?e.folderId:"unsorted",Tn(),he(e,{isNew:!0}),De();let t=document.getElementById("note-folder-label");if(t&&(t.textContent=ie(W)),In())try{g&&typeof g.focus=="function"?g.focus():n&&typeof n.focus=="function"&&n.focus()}catch{}else if(typeof r.focus=="function")try{r.focus()}catch{}},Wn=()=>{let e=new Date().toISOString(),t=j&&j!=="all"?j:"unsorted",l={...me("","",{folderId:t,updatedAt:e}),title:"",body:"",bodyHtml:"",bodyText:"",updatedAt:e,folderId:t};jn(l)};i.addEventListener("click",()=>{if(ge&&!ae&&!Ft())return;let e=ye(),t=Array.isArray(e)?[...e]:[],o=N()||"",l=h(o),p=(typeof r.value=="string"?r.value.trim():"")||"Untitled note",E=new Date().toISOString(),O=W&&W!=="all"?W:"unsorted";if($){let C=t.findIndex(B=>B.id===$);if(C>=0)t[C]={...t[C],title:p,body:o,bodyHtml:o,bodyText:l,updatedAt:E,folderId:O};else{let B=me(p,o,{updatedAt:E,folderId:O,bodyText:l});$=B.id,t.unshift(B)}}else{let C=me(p,o,{folderId:O,bodyText:l});$=C.id,t.unshift(C)}re(t),Ge(),ge=!1,ae=!1,de({preserveDraft:!1})});let et=document.getElementById("mobile-footer-new-note");et&&et.addEventListener("click",e=>{e.preventDefault();try{et.getAttribute("data-nav-target")&&(document.querySelectorAll("[data-nav-target]").forEach(l=>l.classList.remove("active")),et.classList.add("active"))}catch{}Wn()});let tt=It(()=>{try{if(ge&&!ae||!dt())return;i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}},1500),Jn=()=>{if(ge){if(!Ft()){ae=!1;return}ae=!0}else ae=!0;tt()};try{r.addEventListener("input",Jn)}catch{}try{n.addEventListener("input",tt),n.addEventListener("input",R),n.addEventListener("keyup",R),n.addEventListener("mouseup",R),n.addEventListener("keydown",hn),n.addEventListener("keydown",bn),n.addEventListener("blur",()=>{tt()}),r.addEventListener("blur",()=>tt())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",e=>{try{dt()&&i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}}),R(),Yn(),Ht(),typeof window<"u"&&(window.addEventListener("storage",e=>{e.key===qe&&(He=e.newValue??null,de({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let e=ct();e!==He&&(He=e,de({preserveDraft:!0}))},2e3)));try{de({preserveDraft:!0})}catch(e){console.warn("[notebook] initial refreshFromStorage failed",e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",gn,{once:!0}):gn();function mo(){let r=mn?.();if(!r)console.warn("[notes-sync] initNotesSync() did not return a controller; notes will remain local-only.");else if(typeof r.syncFromRemote=="function"){let s=r.syncFromRemote.bind(r);r.syncFromRemote=async(...f)=>{let a=await s(...f);try{fo()}catch{}return a}}let i=rn({selectors:{signInButtons:["#googleSignInBtn","#googleSignInBtnMenu"],signOutButtons:["#googleSignOutBtn","#googleSignOutBtnMenu"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#notesSyncStatus"],feedback:["#notesSyncMessage"]},disableButtonBinding:!1,onSessionChange(s,f){r&&typeof r.handleSessionChange=="function"&&r.handleSessionChange(s??null,f??null)}})?.supabase;!i||!r||(typeof r.setSupabaseClient=="function"&&r.setSupabaseClient(i),i.auth.getSession().then(({data:s})=>{let f=s?.session??null,a=f?.user??null;typeof r.handleSessionChange=="function"&&r.handleSessionChange(a,f)}).catch(s=>{console.warn("[notes-sync] Failed to get initial Supabase session on mobile:",s)}))}(()=>{let r=document.getElementById("headerMenuBtn")||document.getElementById("overflowMenuBtn")||document.getElementById("headerMenuBtnSlim"),n=document.getElementById("headerMenu")||document.getElementById("overflowMenu")||document.getElementById("headerMenuSlim");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;r.dataset.overflowMenuHandled="mobile-js";let i='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',s=r,f=y=>{if(!(y instanceof HTMLElement)||y.getAttribute("aria-hidden")==="true"||y.hasAttribute("disabled")||y.tabIndex<0)return!1;let S=y.getBoundingClientRect();return S.width>0||S.height>0},a=()=>Array.from(n.querySelectorAll(i)).filter(f),m=()=>{let y=n.classList.contains("hidden");n.setAttribute("aria-hidden",y?"true":"false")};m();let b=y=>{!n.contains(y.target)&&y.target!==r&&F({restoreFocus:!1})},M=()=>{let[y]=a();if(y instanceof HTMLElement)try{y.focus()}catch{}},H=()=>{n.classList.contains("hidden")&&(s=document.activeElement instanceof HTMLElement?document.activeElement:r,n.classList.remove("hidden"),r.setAttribute("aria-expanded","true"),m(),document.addEventListener("focusin",b),!n.contains(document.activeElement)&&M())},F=({restoreFocus:y=!0}={})=>{if(!n.classList.contains("hidden")&&(n.classList.add("hidden"),r.setAttribute("aria-expanded","false"),m(),document.removeEventListener("focusin",b),y&&s instanceof HTMLElement))try{s.focus()}catch{}},V=y=>{let S=document.documentElement;if(S){y?S.setAttribute("data-theme",y):S.removeAttribute("data-theme");try{window.localStorage?.setItem("mc-theme",y||"")}catch{}}},U=y=>{let S=document.body;S&&(S.classList.remove("layout-cozy","layout-compact"),y&&S.classList.add(`layout-${y}`))};r.addEventListener("click",y=>{y.stopPropagation(),n.classList.contains("hidden")?H():F()}),document.addEventListener("click",y=>{y.target===r||n.contains(y.target)||F({restoreFocus:!1})}),document.addEventListener("keydown",y=>{if(y.key==="Escape"){F();return}y.key==="ArrowDown"&&!n.classList.contains("hidden")&&(y.preventDefault(),M())});let X=y=>{let S=y.target;return S instanceof Element?S.closest("[data-menu-action]"):null},x=y=>{let S=X(y);if(!S)return;y.stopPropagation();let A=S.getAttribute("data-menu-action");if(A){switch(A){case"completed":case"completed-reminders":{let v=document.querySelector('[data-reminders-tab="completed"]')||document.querySelector('[data-reminders-filter="completed"]');v instanceof HTMLElement?v.click():window.remindersController&&typeof window.remindersController.setFilter=="function"?window.remindersController.setFilter("completed"):typeof window.setMobileRemindersFilter=="function"&&window.setMobileRemindersFilter("completed");break}case"settings":{let v=document.querySelector('[data-open="settings"]');v instanceof HTMLElement&&v.click();break}case"saved-notes":{try{if(typeof window.showSavedNotesSheet=="function")window.showSavedNotesSheet();else{let v=document.getElementById("openSavedNotesGlobal")||document.getElementById("openSavedNotesSheetButton")||document.getElementById("openSavedNotesSheet")||document.getElementById("savedNotesShortcut")||document.querySelector(".open-saved-notes-global");v instanceof HTMLElement&&v.click()}}catch(v){console.warn("[overflow-menu] failed to open saved notes sheet",v)}break}case"sign-in":{let v=document.getElementById("googleSignInBtn");v instanceof HTMLElement?v.click():typeof window.startSignInFlow=="function"&&window.startSignInFlow();break}case"sign-out":{let v=document.getElementById("googleSignOutBtn");v instanceof HTMLElement?v.click():window.__supabaseAuth&&window.__supabaseAuth.supabase&&window.__supabaseAuth.supabase.auth&&typeof window.__supabaseAuth.supabase.auth.signOut=="function"&&window.__supabaseAuth.supabase.auth.signOut().catch(()=>{});break}case"sync-all":case"sync-now":{let v=document.getElementById("syncAll");v instanceof HTMLElement?v.click():window.remindersController&&typeof window.remindersController.syncAll=="function"?window.remindersController.syncAll().catch(()=>{}):typeof window.syncAllReminders=="function"&&window.syncAllReminders();break}case"theme-light":V("light");break;case"theme-dark":V("dark");break;case"theme-professional-dark":V("professional-dark");break;case"layout-cozy":U("cozy");break;case"layout-compact":U("compact");break;case"about":{let v=document.querySelector('[data-open="about"]')||document.getElementById("aboutMemoryCueBtn");v instanceof HTMLElement?v.click():typeof window.showAboutMemoryCue=="function"&&window.showAboutMemoryCue();break}default:break}try{F()}catch{}}};n instanceof HTMLElement&&n.addEventListener("click",x),n.addEventListener("click",y=>{y.stopPropagation(),y.target instanceof HTMLElement&&y.target.closest("button")&&F({restoreFocus:!1})}),n.addEventListener("keydown",y=>{if(y.key!=="Tab")return;let S=a();if(!S.length)return;let A=S.indexOf(document.activeElement),v=S.length-1,q=A;y.shiftKey?q=A<=0?v:A-1:q=A===v?0:A+1,y.preventDefault();let Q=S[q]||S[0];if(Q instanceof HTMLElement)try{Q.focus()}catch{}})})();(()=>{let r=document.getElementById("voiceAddBtn");if(!(r instanceof HTMLElement))return;let n=()=>{let f=document.getElementById("startVoiceCaptureGlobal")||document.getElementById("quickAddVoice");return f instanceof HTMLElement?f:null},i=()=>{let f=n();if(!f)return;let a=()=>{f.hasAttribute("disabled")||f.getAttribute("aria-disabled")==="true"?(r.setAttribute("disabled","true"),r.setAttribute("aria-disabled","true")):(r.removeAttribute("disabled"),r.removeAttribute("aria-disabled"));let b=f.getAttribute("title");b&&r.setAttribute("title",b)};a(),typeof MutationObserver=="function"&&new MutationObserver(a).observe(f,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i();let s=()=>{let f=n();if(f&&!(f.hasAttribute("disabled")||f.getAttribute("aria-disabled")==="true")){try{f.focus({preventScroll:!0})}catch{try{f.focus()}catch{}}try{f.click()}catch(a){console.warn("Voice add trigger failed",a)}}};r.addEventListener("click",f=>{f.preventDefault();let a=!1,m=null,b=()=>{a||(a=!0,document.removeEventListener("reminder:sheet-opened",M),s())},M=F=>{if(F?.detail?.trigger!==r)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&m&&(window.clearTimeout(m),m=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,150)};document.addEventListener("reminder:sheet-opened",M);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:r}}))}catch(F){document.removeEventListener("reminder:sheet-opened",M),typeof window<"u"&&typeof window.clearTimeout=="function"&&m&&(window.clearTimeout(m),m=null),console.warn("Voice add open failed",F);return}let H=document.getElementById("create-sheet");H instanceof HTMLElement&&H.classList.contains("open")&&(m=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,120))})})();(()=>{let r=document.getElementById("toggleReminderFilters"),n=document.getElementById("reminderFilters");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;let i=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],s=()=>{let a=n.hasAttribute("open");r.setAttribute("aria-expanded",String(a)),r.classList.toggle("btn-active",a)},f=()=>{for(let a of i){let m=n.querySelector(a);if(m instanceof HTMLElement&&!m.hasAttribute("disabled")){try{m.focus({preventScroll:!0})}catch{m.focus()}return}}};r.addEventListener("click",()=>{let a=n.hasAttribute("open");n.open=!a,a||f(),s()}),n.addEventListener("toggle",s),s()})();(()=>{let r=document.getElementById("create-sheet");if(!(r instanceof HTMLElement))return;function n(){!r.classList.contains("open")&&r.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",n),document.addEventListener("reminders:updated",n)})();document.addEventListener("memoryCue:remindersUpdated",r=>{let n=document.getElementById("totalCount");if(!n)return;let i=Array.isArray(r?.detail?.items)?r.detail.items.length:0;n.textContent=String(i)});document.addEventListener("click",r=>{try{let n=r.target;if(!n)return;if(n instanceof HTMLElement&&n.id==="saveReminder"||n instanceof Element&&n.closest&&n.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:n});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let r=document.getElementById("reminderList");if(!r)return;let n=Array.from(r.children);if(n.length<=30)return;let i=20;r.innerHTML="";let s=0;function f(){let b=n.slice(s,s+i);b.forEach(M=>r.appendChild(M)),s+=b.length}f();let a=document.createElement("div");a.id="listSentinel",r.appendChild(a);let m=new IntersectionObserver(b=>{b.some(M=>M.isIntersecting)&&s<n.length&&(f(),s>=n.length&&m.disconnect())});m.observe(a)})();(function(){let r=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(a=>a instanceof HTMLElement),n=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!r.length||!n||!i)return;function s(){n.classList.remove("hidden")}function f(){n.classList.add("hidden")}r.forEach(a=>{a.addEventListener("click",s)}),i.addEventListener("click",f),n.addEventListener("click",a=>{a.target instanceof HTMLElement&&a.target.matches("[data-close]")&&f()}),n.addEventListener("keydown",a=>{a.key==="Escape"&&f()})})();(function(){let r=document.getElementById("syncStatus"),n=document.getElementById("mcStatus"),i=document.getElementById("mcStatusText"),s=document.getElementById("syncUrl"),f=document.getElementById("saveSyncSettings"),a=document.getElementById("testSync"),m=document.getElementById("syncAll"),b="syncUrl";if(!i)return;let M=["online","offline","error"],H=["online","offline"],F={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},V={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},U=null;function X(u){if(!n)return;H.forEach(N=>n.classList.remove(N));let T=u!=="offline"&&u!=="error";n.classList.add(T?"online":"offline"),n.setAttribute("aria-label",T?"Online":"Offline")}function x(u,T){U=u,M.forEach(w=>i.classList.remove(w)),r&&M.forEach(w=>r.classList.remove(w)),u==="online"?(i.classList.add("online"),r&&r.classList.add("online")):u==="error"?(i.classList.add("error"),r&&r.classList.add("error")):(i.classList.add("offline"),r&&r.classList.add("offline"));let N=typeof T=="string"&&T.trim()?T.trim():F[u]||"",d=typeof T=="string"&&T.trim()?T.trim():V[u]||N,h=N||d||"";i.textContent=h,h?(i.setAttribute("title",h),i.setAttribute("aria-label",h)):(i.removeAttribute("title"),i.removeAttribute("aria-label")),X(u),i.dataset.state=u}function y(){U!=="syncing"&&x(navigator.onLine?"online":"offline")}function S(u){typeof localStorage>"u"||(u?localStorage.setItem(b,u):localStorage.removeItem(b))}function A(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(b)||""}catch{return""}}function v(u){if(!u||typeof u!="object")return null;let T=u.id||u.uid||u.key||u.slug||u.uuid,N=typeof u.title=="string"&&u.title.trim()?u.title.trim():typeof u.name=="string"?u.name.trim():"";if(!N)return null;let d=typeof u.dueIso=="string"&&u.dueIso?u.dueIso:typeof u.due=="string"?u.due:null,h=typeof u.priority=="string"&&u.priority.trim()?u.priority.trim():u.level||u.importance||"Medium",w=typeof u.category=="string"&&u.category.trim()?u.category.trim():u.group||u.bucket||"General",L=typeof u.done=="boolean"?u.done:!!(u.completed||u.isDone||u.status==="done");return{id:T||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:N,dueIso:d&&d.trim()?d.trim():null,priority:h,category:w,done:L}}function q(){let u=Array.from(document.querySelectorAll("[data-reminder]"));return u.length?u.map(T=>{let N=T.dataset||{},d=null;if(N.reminder)try{d=JSON.parse(N.reminder)}catch{d=null}let h=d||{id:N.id||N.reminderId||T.getAttribute("data-id")||null,title:N.title||N.reminderTitle||"",dueIso:N.due||N.reminderDue||T.getAttribute("data-due")||null,priority:N.priority||N.reminderPriority||T.getAttribute("data-priority")||"",category:N.category||N.reminderCategory||T.getAttribute("data-category")||"",done:N.done==="true"||N.reminderDone==="true"||T.getAttribute("data-done")==="true"};if(!h.title){let w=T.querySelector("[data-reminder-title], [data-title], h3, h4, strong");w&&(h.title=w.textContent.trim())}if(!h.dueIso){let w=T.querySelector("[data-due], time");if(w){let L=w.getAttribute("datetime")||w.getAttribute("data-due");h.dueIso=L||w.textContent.trim()}}return v(h)}).filter(Boolean):[]}function Q(){if(typeof localStorage>"u")return[];let u=[],T=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(d=>{if(!T.has(d)){T.add(d);try{let h=localStorage.getItem(d);if(!h)return;let w=JSON.parse(h);Array.isArray(w)?w.forEach(L=>u.push(L)):w&&typeof w=="object"&&(Array.isArray(w.items)&&w.items.forEach(L=>u.push(L)),Array.isArray(w.reminders)&&w.reminders.forEach(L=>u.push(L)))}catch{}}}),!u.length)for(let d=0;d<localStorage.length;d+=1){let h=localStorage.key(d);if(!(!h||T.has(h)||!/remind/i.test(h))){T.add(h);try{let w=localStorage.getItem(h);if(!w)continue;let L=JSON.parse(w);Array.isArray(L)?L.forEach(se=>u.push(se)):L&&typeof L=="object"&&(Array.isArray(L.items)&&L.items.forEach(se=>u.push(se)),Array.isArray(L.reminders)&&L.reminders.forEach(se=>u.push(se)))}catch{}}}return u.map(v).filter(Boolean)}function Z(){let u=q();return u.length?u:Q()}function g(u){u?(m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled"),a?.setAttribute("aria-busy","true"),a?.setAttribute("disabled","disabled")):(m?.removeAttribute("aria-busy"),a?.removeAttribute("aria-busy"),ee())}function ee(){!!((s?.value||"").trim()||A())?(m?.removeAttribute("disabled"),a?.removeAttribute("disabled")):(m?.setAttribute("disabled","disabled"),a?.setAttribute("disabled","disabled"))}let R=A();s&&R&&(s.value=R),ee(),x(navigator.onLine?"online":"offline"),window.addEventListener("online",y),window.addEventListener("offline",y),s?.addEventListener("input",ee),f?.addEventListener("click",()=>{let u=(s?.value||"").trim();if(!u){S(""),x("info","Sync URL cleared. Add one to enable sync."),ee();return}try{let T=new URL(u);if(!/^https?:/.test(T.protocol))throw new Error("Invalid protocol")}catch{x("error","Enter a valid sync URL before saving.");return}S(u),x("online","Sync settings saved."),ee()}),a?.addEventListener("click",async()=>{let u=(s?.value||A()).trim();if(!u){x("error","Add your sync URL in Settings first.");return}g(!0),x("syncing","Testing connection\u2026");try{(await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?x("online","Connection looks good."):x("error","Test failed. Check your Apps Script deployment.")}catch(T){console.error("Test sync failed",T),x("error","Test failed. Check your Apps Script deployment.")}finally{g(!1)}}),m?.addEventListener("click",async()=>{let u=(s?.value||A()).trim();if(!u){x("error","Add your sync URL in Settings first.");return}let T=Z();if(!T.length){x("info","Nothing to sync right now.");return}g(!0),x("syncing",`Syncing ${T.length} reminder${T.length===1?"":"s"}\u2026`);let N=20,d=0,h=0,w=L=>({id:L.id,title:L.title,dueIso:L.dueIso||null,priority:L.priority||"Medium",category:L.category||"General",done:!!L.done,source:"memory-cue-mobile"});try{for(let L=0;L<T.length;L+=N){let se=T.slice(L,L+N);(await Promise.allSettled(se.map(le=>fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w(le))})))).forEach(le=>{le.status==="fulfilled"&&le.value?.ok?d+=1:(le.status,h+=1)}),await new Promise(le=>setTimeout(le,300))}h?d?x("error",`Partial sync: ${d} success, ${h} failed.`):x("error","Sync failed. Check your sync URL and retry."):x("online",`Sync complete. ${d} updated.`)}catch(L){console.error("Sync failed",L),x("error","Sync failed. Try again soon.")}finally{g(!1)}})})()});export default yo();
