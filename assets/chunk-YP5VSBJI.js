import{b as wn,c as qo}from"./chunk-QHE5AMPX.js";import{a as Gi,b as Qn,c as Uo}from"./chunk-GUVSRPRW.js";function Xi(o={}){try{Object.assign(W,o||{})}catch(r){console.warn("[supabase-auth] setAuthContext failed",r)}}async function Qi(o={}){try{if(W&&typeof W.signInWithPopup=="function"&&W.auth&&typeof W.GoogleAuthProvider=="function")return W.signInWithPopup(W.auth,new W.GoogleAuthProvider);if(W&&typeof W.signInWithRedirect=="function"&&W.auth&&typeof W.GoogleAuthProvider=="function")return W.signInWithRedirect(W.auth,new W.GoogleAuthProvider);let r=wn();if(r&&r.auth){if(typeof r.auth.signInWithOAuth=="function")return r.auth.signInWithOAuth({provider:"google",...o});if(typeof r.auth.signIn=="function")return r.auth.signIn({provider:"google"})}}catch(r){console.error("[supabase-auth] startSignInFlow error",r);try{W?.toast?.("Sign-in failed")}catch(c){console.warn("[supabase-auth] toast handler failed",c)}throw r}return Promise.resolve(null)}async function zi(){try{if(W&&typeof W.signOut=="function")return W.signOut(W.auth);let o=wn();if(o&&o.auth&&typeof o.auth.signOut=="function")return o.auth.signOut()}catch(o){throw console.error("[supabase-auth] startSignOutFlow error",o),o}return Promise.resolve(null)}function Wo(o){return o?Array.isArray(o)?o:[o]:[]}function kt(o){return Array.from(new Set(o.filter(r=>r instanceof HTMLElement||typeof SVGElement<"u"&&r instanceof SVGElement)))}function ye(o,r){let c=Wo(r).filter(Boolean);if(!c.length)return[];let h=c.flatMap(C=>Array.from(o.querySelectorAll(C)));return kt(h)}function Vo(o,r=document){let c=r instanceof Document||r instanceof HTMLElement?r:document;return{authForms:ye(c,o.authForm),emailInputs:ye(c,o.emailInput),signInButtons:ye(c,o.signInButtons),signOutButtons:ye(c,o.signOutButtons),userBadges:ye(c,o.userBadge),userBadgeEmails:ye(c,o.userBadgeEmail),userBadgeInitials:ye(c,o.userBadgeInitial),userNameEls:ye(c,o.userName),syncStatusEls:ye(c,o.syncStatus),syncStatusTextEls:ye(c,o.syncStatusText),statusIndicatorEls:ye(c,o.statusIndicator),feedbackEls:ye(c,o.feedback)}}function Lt(o,r){kt(Array.isArray(o)?o:[o]).forEach(c=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!r),r?c.removeAttribute("hidden"):c.setAttribute("hidden",""))})}function $e(o,r){kt(Array.isArray(o)?o:[o]).forEach(c=>{c instanceof HTMLElement&&(c.textContent=r||"")})}function Yo(o,r){kt(o).forEach(c=>{c instanceof HTMLElement&&(c.dataset.state=r,c.classList.toggle("online",r==="online"),c.classList.toggle("offline",r!=="online"))})}function xt(o,r){kt(o).forEach(c=>{if(!(c instanceof HTMLElement))return;c.textContent=r||"";let h=!!r;c.classList.toggle("hidden",!h),h?c.removeAttribute("hidden"):c.setAttribute("hidden","")})}function Ji(o={}){let r={...Ki.syncStatusText,...o.syncStatusText||{}};return{...Ki,...o,syncStatusText:r}}function Ct(o,{user:r,messages:c}={}){let h=Ji(c),C=!!r;Lt(o.signInButtons,!C),Lt(o.authForms,!C),Lt(o.signOutButtons,C),Lt(o.userBadges,C);let M=typeof r?.email=="string"?r.email:"",P=M?M.charAt(0).toUpperCase():"U";C?($e(o.userBadgeEmails,M),$e(o.userBadgeInitials,P),$e(o.userNameEls,M)):($e(o.userBadgeEmails,""),$e(o.userBadgeInitials,""),$e(o.userNameEls,""));let U=typeof h.signedIn=="function"?h.signedIn(r):h.signedIn,O=typeof h.signedOut=="function"?h.signedOut(r):h.signedOut,de=C?U:O,fe=!C;o.syncStatusEls.length&&($e(o.syncStatusEls,de),o.syncStatusEls.forEach(Le=>{Le instanceof HTMLElement&&(Le.classList.toggle("online",C),Le.dataset.state=C?"online":"offline")}),Lt(o.syncStatusEls,fe));let k=C?h.syncStatusText?.signedIn:h.syncStatusText?.signedOut;$e(o.syncStatusTextEls,k||""),Yo(o.statusIndicatorEls,C?"online":"offline"),xt(o.feedbackEls,"")}function Go(o,r){r.authForms.forEach(c=>{!(c instanceof HTMLFormElement)||c.dataset.supabaseAuthBound==="true"||(c.dataset.supabaseAuthBound="true",c.addEventListener("submit",async h=>{h.preventDefault();let C=r.emailInputs.find(P=>c.contains(P))||c.querySelector('input[type="email"]'),M=typeof C?.value=="string"?C.value.trim():"";if(!M){xt(r.feedbackEls,"Enter an email address to continue.");return}try{let{error:P}=await o.auth.signInWithOtp({email:M});P?xt(r.feedbackEls,P.message||"Unable to send magic link."):xt(r.feedbackEls,"Magic link sent. Check your email.")}catch(P){xt(r.feedbackEls,P?.message||"Unable to send magic link.")}}))})}function Ko(o,r){r.signOutButtons.forEach(c=>{!(c instanceof HTMLElement)||c.dataset.supabaseAuthBound==="true"||(c.dataset.supabaseAuthBound="true",c.addEventListener("click",async()=>{try{await o.auth.signOut()}catch(h){console.error("[supabase] Sign-out failed.",h)}}))})}function us(o={}){let{supabase:r,scope:c=document,selectors:h={},messages:C={},disableButtonBinding:M=!1,onSessionChange:P}=o,U={...jo,...h},O=Vo(U,c),de=Ji(C);Ct(O,{user:null,messages:de});let fe=r||wn()||(typeof window<"u"?window.supabase:null);if(!fe)return{supabase:null,elements:O,applyAuthState:me=>Ct(O,{...me,messages:de}),destroy(){}};Go(fe,O),M||Ko(fe,O);let k=[],{data:Le}=fe.auth.onAuthStateChange((me,we)=>{if(Ct(O,{user:we?.user??null,messages:de}),typeof P=="function")try{P(we?.user??null,we)}catch(ot){console.error("[supabase] onSessionChange handler failed.",ot)}});return Le?.subscription&&k.push(()=>{try{Le.subscription.unsubscribe()}catch{}}),fe.auth.getSession().then(({data:me,error:we})=>{we||Ct(O,{user:me?.session?.user??null,messages:de})}).catch(me=>{console.error("[supabase] getSession failed.",me)}),{supabase:fe,elements:O,applyAuthState:me=>Ct(O,{...me,messages:de}),destroy(){k.forEach(me=>{try{me()}catch{}})}}}var W,jo,Ki,Zi=Qn(()=>{qo();W={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};jo={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},Ki={signedOut:"",signedIn:o=>`Reminders syncing for ${o?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var ir=Uo((ms,Dt)=>{var vn=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function er(o){if(!o||typeof o!="object")return null;let r=Object.entries(o).filter(([c,h])=>typeof h=="string"&&h.trim()!=="");return r.length?Object.fromEntries(r):null}function Xo(){let o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},r=er(o?.__FIREBASE_CONFIG);if(r)return r;let c=er(o?.__ENV?.FIREBASE_CONFIG);if(c)return c;let C=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((M,[P,U])=>{let O=o?.__ENV?.[P]??o?.[P];return typeof O=="string"&&O.trim()!==""&&(M[U]=O),M},{});return Object.keys(C).length?C:null}function nr(){let o=Xo();return o?{...vn,...o}:{...vn}}var tr={DEFAULT_FIREBASE_CONFIG:vn,getFirebaseConfig:nr};if(typeof globalThis<"u"){let o=globalThis;o.memoryCueFirebase=o.memoryCueFirebase||{},o.memoryCueFirebase.getFirebaseConfig=nr,o.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=vn}typeof Dt<"u"&&Dt.exports&&(Dt.exports=tr,Dt.exports.default=tr)});function J(o){if(!Array.isArray(o))return null;let r=o.map(c=>Number(c)).filter(c=>Number.isFinite(c));return r.length?r:null}async function cr(o){return typeof o=="string"?o.trim():"",null}function zo(o,r){let c=J(o),h=J(r);if(!c||!h||c.length!==h.length)return 0;let C=0,M=0,P=0;for(let U=0;U<c.length;U+=1)C+=c[U]*h[U],M+=c[U]*c[U],P+=h[U]*h[U];return!M||!P?0:C/(Math.sqrt(M)*Math.sqrt(P))}async function ar(o){if(!o||typeof o!="object")return o;let r=J(o.semanticEmbedding);if(r)return o.semanticEmbedding=r,o;let c=[o.title,o.bodyText,o.body,o.notes].filter(C=>typeof C=="string"&&C.trim()).join(`
`).trim();if(!c)return o;let h=J(await cr(c));return h&&(o.semanticEmbedding=h),o}function Zo(){if(Ie)return{...Ie};let r=ii()?.memoryCueFirebase;if(r&&typeof r.getFirebaseConfig=="function")return Ie=r.getFirebaseConfig(),{...Ie};if(typeof Gi=="function")try{let c=ir();if(c){let h=typeof c.getFirebaseConfig=="function"?c.getFirebaseConfig:typeof c.default?.getFirebaseConfig=="function"?c.default.getFirebaseConfig:null;if(h)return Ie=h(),{...Ie}}}catch{}return r&&r.DEFAULT_FIREBASE_CONFIG?(Ie={...r.DEFAULT_FIREBASE_CONFIG},{...Ie}):(Ie={...Jo},{...Ie})}function ii(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function lr(){let o=ii(),r=o&&o.TimestampTrigger;return typeof r=="function"?r:null}function Me(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!lr()}function es(){if(typeof window>"u"||!window.location)return zn;try{return new URL(zn,window.location.href).href}catch{return zn}}async function Ue(){return En||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(En=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(es()),await navigator.serviceWorker.ready}catch(o){return console.warn("Service worker registration failed",o),null}})(),En))}async function dr(o){if(!o||typeof o!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let r=await Ue();if(!r)return!1;let c=new Set;navigator.serviceWorker.controller&&c.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(C=>{let M=r[C];M&&c.add(M)});let h=!1;return c.forEach(C=>{try{C.postMessage(o),h=!0}catch(M){console.warn("Failed posting message to service worker",M)}}),h}catch(r){return console.warn("Unable to reach service worker",r),!1}}async function Sn(){if(Me())return!1;if(Zn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Nt)try{return await Nt}catch{}Nt=(async()=>{let o=await Ue();if(!o)return!1;let r=!1;if("periodicSync"in o)try{let c=await o.periodicSync.getTags();(!Array.isArray(c)||!c.includes(Jn))&&await o.periodicSync.register(Jn,{minInterval:15*60*1e3}),r=!0}catch(c){console.warn("Periodic background sync unavailable",c)}if(!r&&"sync"in o)try{await o.sync.register(Jn),r=!0}catch(c){console.warn("Background sync unavailable",c)}return r})();try{let o=await Nt;return o&&(Zn=!0),o}catch(o){return console.warn("Background reminder sync setup failed",o),Zn=!1,!1}finally{Nt=null}}async function ti(o=[],{requestCheck:r=!1}={}){if(!Me()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let c=await Ue();if(!c)return;let h=await dr({type:sr.updateScheduledReminders,reminders:Array.isArray(o)?o:[]});if(r&&await dr({type:sr.checkScheduledReminders}),!h&&typeof c.update=="function")try{await c.update()}catch{}}catch(c){console.warn("Failed syncing reminders with service worker",c)}}async function ni(o,r){if(Me())try{let c=r||await Ue();if(!c)return;let h=[];try{h=await c.getNotifications({tag:o,includeTriggered:!0})}catch{h=await c.getNotifications({tag:o})}for(let C of h)try{C.close()}catch{}}catch{}}function ur(){for(let o of Array.from(Fe.values()))try{o.close()}catch{}Fe.clear()}function ts(){if(or||typeof window>"u"||typeof window.addEventListener!="function")return;let o=()=>ur();["pagehide","beforeunload"].forEach(r=>{try{window.addEventListener(r,o)}catch{}}),or=!0}function te(o){if(typeof o=="string"){let r=o.replace(/\s+/g," ").trim();if(r)return r}return K}async function hs(o={}){let r=e=>e?document.querySelector(e):null,c=e=>e?Array.from(document.querySelectorAll(e)):[],h=r(o.titleSel),C=r(o.dateSel),M=r(o.timeSel),P=r(o.detailsSel),U=r(o.prioritySel),O=r(o.categorySel),de=r(o.saveBtnSel),fe=r(o.cancelEditBtnSel),k=r(o.listSel),Le="reminder-title-pinned",me="reminder-title-unpinned",we=r(o.detailPanelSel),ot=r(o.detailEmptySel),Tn=r(o.detailContentSel),Rt=r(o.detailTitleSel),Ft=r(o.detailDueSel),Mt=r(o.detailPrioritySel),Bt=r(o.detailCategorySel),Ce=r(o.detailNotesSel),oi=Ce?.dataset?.placeholder||"No notes added yet.",fr=r(o.detailClearSel),Ot=c(o.googleSignInBtnSel),Pt=c(o.googleSignOutBtnSel),q=r(o.statusSel),X=r(o.syncStatusSel),mr={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},pr=6e3,pe=null,_t=null;function Ge(e,{clearMessage:t=!0}={}){pe&&(e&&pe.tokenId!==e||(pe.timeoutId&&clearTimeout(pe.timeoutId),t&&q&&q.dataset.undoToken===pe.tokenId&&(typeof q.replaceChildren=="function"?q.replaceChildren():q.textContent="",delete q.dataset.undoToken,delete q.dataset.statusKind),pe=null))}function hr(e){if(!q)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Ro(e.tokenId)),e.button=i,typeof q.replaceChildren=="function"?q.replaceChildren(t,n,i):(q.textContent="",q.append(t,n,i)),q.dataset.statusKind="undo",q.dataset.undoToken=e.tokenId}function st(e){if(!we)return;let t=!!e;if(we.dataset.state=t?"active":"empty",we.dataset.selectedId=t&&e?.id?e.id:"",ot&&(ot.classList.toggle("hidden",t),ot.setAttribute("aria-hidden",t?"true":"false")),Tn&&(Tn.classList.toggle("hidden",!t),Tn.setAttribute("aria-hidden",t?"false":"true")),!t){Rt&&(Rt.textContent=""),Ft&&(Ft.textContent=""),Mt&&(Mt.textContent=""),Bt&&(Bt.textContent=""),Ce&&(Ce.textContent=oi,Ce.dataset.empty="true");return}if(Rt&&(Rt.textContent=e.title||"Untitled reminder"),Ft&&(Ft.textContent=$i(e)),Mt&&(Mt.textContent=e.priority||"Medium"),Bt&&(Bt.textContent=e.category||K),Ce){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Ce.textContent=n,Ce.dataset.empty="false"):(Ce.textContent=oi,Ce.dataset.empty="true")}}function si(){_t=null,st(null)}function gr(e){_t=e?.id||null,st(e||null)}function yr(){if(!we)return;if(!_t){st(null);return}let e=p.find(t=>t?.id===_t);if(e){st(e);return}si()}st(null);function An(e,t){if(!X)return;let n=["online","offline","error"];n.forEach(a=>X.classList.remove(a)),n.includes(e)&&X.classList.add(e),X.dataset.state=e;let i=typeof t=="string"?t:mr[e]||"";e==="online"||e==="offline"?(X.textContent="",X.dataset.compact="true",i?(X.setAttribute("aria-label",i),X.setAttribute("title",i)):(X.removeAttribute("aria-label"),X.removeAttribute("title"))):(X.textContent=i,X.removeAttribute("data-compact"),i?(X.setAttribute("aria-label",i),X.setAttribute("title",i)):(X.removeAttribute("aria-label"),X.removeAttribute("title")))}let re=r(o.notesSel),br=r(o.saveNotesBtnSel),wr=r(o.loadNotesBtnSel),ai=r(o.countTotalSel),Ht=r(o.googleUserNameSel),qe=r(o.dateFeedbackSel),ce=r(o.voiceBtnSel),vr=r(o.notifBtnSel),at=r(o.moreBtnSel),dt=r(o.moreMenuSel),Er=r(o.copyMtlBtnSel),In=r(o.importFileSel),Sr=r(o.exportBtnSel),Tr=r(o.syncAllBtnSel),Ke=r(o.syncUrlInputSel),Ar=r(o.saveSettingsSel),Ir=r(o.testSyncSel),Lr=c(o.openSettingsSel),$t=r(o.settingsSectionSel),Xe=r(o.emptyStateSel),di=r(o.listWrapperSel),Ln=r(o.categoryOptionsSel),oe=r(o.plannerContextSel),V=r(o.plannerLessonInputSel),se=o.variant||"mobile",Cr=typeof o.autoWireAuthButtons=="boolean"?o.autoWireAuthButtons:se!=="desktop",ct="all",Cn=[],xn="";function xr(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function Qe(){if(se!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=xr(),n;ct==="today"?n=`Today\u2019s reminders \u2022 ${t}`:ct==="completed"?n=`Completed reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,xn&&(n+=` \u2022 ${xn}`),e.textContent=n}function kr(){se==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(s=>{if(!s.ok)throw new Error("Weather request failed");return s.json()}).then(s=>{s&&s.current_weather&&typeof s.current_weather.temperature=="number"&&(xn=`${Math.round(s.current_weather.temperature)}\xB0C`,Qe())}).catch(s=>{console.warn("Failed to fetch current temperature",s)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let ci="mc:lastDefaults",kn=()=>{oe&&(oe.classList.add("hidden"),oe.setAttribute("aria-hidden","true"),typeof oe.replaceChildren=="function"?oe.replaceChildren():oe.textContent=""),V&&(V.value="",V.dataset&&(delete V.dataset.lessonDayLabel,delete V.dataset.lessonTitle,delete V.dataset.lessonSummary))},Dr=(e={})=>{if(!oe)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",s=document.createElement("p");s.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",s.textContent=t?`${t} lesson`:"Planner lesson";let a=document.createElement("p");a.className="text-sm font-semibold text-base-content",a.textContent=n||i||"Planner reminder";let d=i?document.createElement("p"):null;d&&(d.className="text-sm text-base-content/70",d.textContent=i),typeof oe.replaceChildren=="function"?oe.replaceChildren(...[s,a,d].filter(Boolean)):(oe.textContent="",oe.append(s,a),d&&oe.append(d)),oe.classList.remove("hidden"),oe.removeAttribute("aria-hidden")},Nr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";h&&typeof e.reminderTitle=="string"&&(h.value=e.reminderTitle),P&&typeof e.reminderNotes=="string"&&(P.value=e.reminderNotes),C&&typeof e.dueDate=="string"&&(C.value=e.dueDate),V&&(V.value=t,V.dataset&&(V.dataset.lessonDayLabel=dayLabel,V.dataset.lessonTitle=lessonTitle,V.dataset.lessonSummary=summary)),Dr(e)};function Dn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(ci)||"{}")||{}}catch{return{}}}function Rr(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(ci,JSON.stringify(e))}catch{}}function Fr(e){let t=Dn(),n={category:te(e?.category||t.category||K),priority:e?.priority||t.priority||"Medium"};Rr(n)}let li='fieldset#priorityChips input[name="priority"]';function Ut(){try{let e=document.querySelector(`${li}:checked`);if(e&&e.value)return e.value}catch{}return U&&typeof U.value=="string"&&U.value?U.value:"Medium"}function qt(e){let t=e||"Medium";U&&typeof U.value<"u"&&(U.value=t);try{let n=Array.from(document.querySelectorAll(li));if(!n.length)return;let i=!1;if(n.forEach(s=>{let a=s.value===t;s.checked=a,i=i||a}),!i){let s=n.find(a=>a.value==="Medium")||n[0];s&&(s.checked=!0)}}catch{}}function ui(){let e=Dn();e.category&&O&&(O.value=e.category),e.priority&&qt(e.priority)}ui();let Mr=typeof document<"u"?document.getElementById("quickAddForm"):null,Z=typeof document<"u"?document.getElementById("quickAddInput"):null,Br=typeof document<"u"?document.getElementById("quickAddSubmit"):null,le=typeof document<"u"?document.getElementById("quickAddVoice")||document.getElementById("voiceBtn"):null,Be=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,Nn=null,lt="memoryCueNotes",fi="memoryCueFolders",mi="Lesson \u2013 Reflections";function Or(e){let t=typeof e=="string"?e:"",n=[{kind:"footy-drill",pattern:/^\s*footy\s+drill\s*:\s*/i},{kind:"reflection",pattern:/^\s*reflection\s*:\s*/i},{kind:"task",pattern:/^\s*task\s*:\s*/i}];for(let i of n)if(i.pattern.test(t))return{kind:i.kind,text:t.replace(i.pattern,"").trim()};return{kind:"default",text:t.trim()}}function Rn(e,t=[]){if(typeof localStorage>"u")return Array.isArray(t)?[...t]:[];try{let n=localStorage.getItem(e);if(!n)return Array.isArray(t)?[...t]:[];let i=JSON.parse(n);return Array.isArray(i)?i:Array.isArray(t)?[...t]:[]}catch{return Array.isArray(t)?[...t]:[]}}function Pr(){let t=Rn(fi,[{id:"unsorted",name:"Unsorted",order:0}]).filter(d=>d&&typeof d=="object"&&typeof d.id=="string"),n=t.find(d=>d.name===mi);if(n?.id)return n.id;let i=new Set(t.map(d=>d.id)),s="lesson-reflections",a=1;for(;i.has(s);)a+=1,s=`lesson-reflections-${a}`;t.push({id:s,name:mi,order:t.length});try{localStorage.setItem(fi,JSON.stringify(t))}catch{}return s}function _r(e){let t=typeof e=="string"?e.trim():"";if(!t||typeof localStorage>"u")return null;let n=Pr(),i=Rn(lt,[]),s=new Date().toISOString(),a={id:dn(),title:t,body:t,bodyHtml:t,bodyText:t,pinned:!1,updatedAt:s,folderId:n,semanticEmbedding:null};i.unshift(a);try{localStorage.setItem(lt,JSON.stringify(i))}catch{return null}return a}function Hr(e,t){let n=Dn(),i=typeof t=="string"&&t?t:null;return{title:(e||"").trim(),priority:n.priority||Ut(),category:te(n.category||O?.value||K),notes:"",due:i,pinToToday:!1,semanticEmbedding:null}}function Fn(e,t=null){let n=typeof e=="string"?e.trim():"";if(!n)return{keywordQuery:"",timeRange:null};let i=t instanceof Date&&!Number.isNaN(t.getTime())?new Date(t):new Date,s=n.toLowerCase(),a=/\b(monday|mon|tuesday|tue|tues|wednesday|wed|thursday|thu|thur|thurs|friday|fri|saturday|sat|sunday|sun)\b/i,d=/\b(\d{1,2})(?::(\d{2}))?\s*(am|pm)?\b/i,l=/\btoday\b/i,f=/\byesterday\b/i,u=s.match(a),g=s.match(d),A=s.match(l),x=s.match(f),$=()=>{if(!g)return null;let S=Number.parseInt(g[1],10),R=Number.parseInt(g[2]||"0",10),E=g[3]?g[3].toLowerCase():null;return!Number.isFinite(S)||!Number.isFinite(R)||R>59||(E==="pm"&&S<12?S+=12:E==="am"&&S===12&&(S=0),S>23)?null:{hours:S,minutes:R}},j=S=>String(S).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),T=()=>{let S=n;return u&&(S=S.replace(new RegExp(`\\b${j(u[0])}\\b`,"i")," ")),A&&(S=S.replace(new RegExp(`\\b${j(A[0])}\\b`,"i")," ")),x&&(S=S.replace(new RegExp(`\\b${j(x[0])}\\b`,"i")," ")),g&&(S=S.replace(new RegExp(j(g[0]),"i")," ")),S.replace(/\s+/g," ").trim()},w=(S=0)=>{let R=new Date(i);R.setHours(0,0,0,0),R.setDate(R.getDate()+S);let E=new Date(R);return E.setHours(23,59,59,999),{start:R.getTime(),end:E.getTime()}},N=$();if(u&&N){let S=u[1].slice(0,3).toLowerCase(),E={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[S];if(typeof E=="number"){let F=new Date(i),H=(E-F.getDay()+7)%7;return F.setDate(F.getDate()+H),F.setHours(N.hours,N.minutes,0,0),{keywordQuery:T(),timeRange:{start:F.getTime()-60*60*1e3,end:F.getTime()+60*60*1e3}}}}if(A||x){if(N){let S=new Date(i);return x&&S.setDate(S.getDate()-1),S.setHours(N.hours,N.minutes,0,0),{keywordQuery:T(),timeRange:{start:S.getTime()-60*60*1e3,end:S.getTime()+60*60*1e3}}}return{keywordQuery:T(),timeRange:w(x?-1:0)}}return{keywordQuery:n,timeRange:null}}function $r(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(lt),t=e?JSON.parse(e):[];return Array.isArray(t)?t:[]}catch{return[]}}function pi(){let e=(Array.isArray(p)?p:[]).map(n=>({type:"Reminder",title:n?.title||"",body:n?.notes||"",timestamp:Number.isFinite(n?.createdAt)?n.createdAt:null,semanticEmbedding:J(n?.semanticEmbedding)})),t=$r().map(n=>{let i=typeof n?.updatedAt=="string"?Date.parse(n.updatedAt):Number.NaN,s=typeof n?.createdAt=="string"?Date.parse(n.createdAt):Number.NaN;return{type:"Note",title:n?.title||"",body:n?.bodyText||n?.body||"",timestamp:Number.isFinite(i)?i:Number.isFinite(s)?s:null,semanticEmbedding:J(n?.semanticEmbedding)}});return[...e,...t]}async function hi(e,t,n=[]){let i=J(await cr(e));if(!i)return[];let s=.72,a=new Set(n);return t.filter(l=>!a.has(l)).map(l=>({entry:l,score:zo(i,l.semanticEmbedding)})).filter(l=>l.score>=s).sort((l,f)=>f.score-l.score).map(l=>({...l.entry,isSemanticMatch:!0}))}function Ur(e,t){let n=Fn(e),i=(n.keywordQuery||"").toLowerCase().split(/\s+/).map(a=>a.trim()).filter(Boolean),s=t.filter(a=>{let d=`${a.title} ${a.body}`.toLowerCase();return!i.length||i.every(f=>d.includes(f))?n.timeRange?Number.isFinite(a.timestamp)?a.timestamp>=n.timeRange.start&&a.timestamp<=n.timeRange.end:!1:!0:!1});return s.sort((a,d)=>(d.timestamp||0)-(a.timestamp||0)),s}function gi(e){let t=["=== MEMORY CONTEXT START ==="];return e.forEach((n,i)=>{let s=Number.isFinite(n.timestamp)?new Date(n.timestamp).toISOString().slice(0,10):"No date";t.push(`[${i+1}] Type: ${n.type||"Unknown"}`),t.push(`    Title: ${n.title||"(untitled)"}`),t.push(`    Date: ${s}`),t.push(`    Notes: ${n.body||""}`),t.push("")}),t.push("=== MEMORY CONTEXT END ==="),t.join(`
`)}async function Mn(e,t=8){let n=typeof e=="string"?e.trim():"",i=Number.isFinite(t)?Math.max(1,Math.min(50,Math.floor(t))):8;if(!n)return gi([]);let s=pi(),a=await hi(n,s),d=a.length?a.slice(0,i):Ur(n,s).slice(0,i);return gi(d)}async function yi(e){let n=`You are an assistant that must answer ONLY using the provided MEMORY CONTEXT.
Do not invent new information.
If answer not in context, say: "I do not have enough information."

MEMORY CONTEXT:
${await Mn(e)}

USER QUESTION:
${e}`;return console.log(`[RAG assistant] Prompt:
`,n),"Assistant response placeholder."}function qr(){let e=typeof document<"u"?document.getElementById("inboxSearchInput"):null,t=typeof document<"u"?document.getElementById("inboxSearchResults"):null,n=typeof document<"u"?document.getElementById("inboxSearchClear"):null;if(!e||!t)return;let i=E=>{if(!Number.isFinite(E))return"No date";try{return new Date(E).toLocaleString()}catch{return"No date"}},s=E=>String(E||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),a=(E,F)=>{let H=String(E||"");if(!F)return s(H);let m=H.toLowerCase(),b=F.toLowerCase(),I=m.indexOf(b);if(I<0)return s(H);let B=s(H.slice(0,I)),v=s(H.slice(I,I+F.length)),ne=s(H.slice(I+F.length));return`${B}<mark class="inbox-search-match">${v}</mark>${ne}`},d=()=>pi(),l=[],f=-1,u=null,g=null,A=()=>{l=[],f=-1,u=null,t.innerHTML="",t.dataset.mode=""},x=(E,F={})=>{let H=Number.isFinite(F.limit)?F.limit:20,m=F.query||"",b=Number.isInteger(F.selectedIndex)?F.selectedIndex:-1,I=F.mode||"";if(t.innerHTML="",t.dataset.mode=I,!E.length){if(I==="autocomplete"){let v=document.createElement("div");v.className="inbox-search-empty text-xs opacity-70 py-2 px-2",v.textContent="No matches",t.appendChild(v)}return}let B=document.createDocumentFragment();E.slice(0,H).forEach((v,ne)=>{let z=document.createElement("li");z.className="inbox-search-result-item text-xs py-1 border-b border-base-300/60",I==="autocomplete"&&(z.classList.add("inbox-search-result-item--autocomplete"),z.setAttribute("role","option"),z.tabIndex=-1,ne===b&&z.classList.add("is-active"));let L=document.createElement("span");L.className="badge badge-outline badge-xs mr-2",L.textContent=v.type;let Ve=document.createElement("span");Ve.className="inbox-search-result-title",I==="autocomplete"?Ve.innerHTML=a(v.title||"(untitled)",m):Ve.textContent=v.title||"(untitled)";let Ne=document.createElement("div");Ne.className="opacity-70",Ne.textContent=i(v.timestamp);let hn=document.createElement("div");hn.className="opacity-60 italic",hn.textContent="Related results",I==="autocomplete"&&z.addEventListener("mousedown",At=>{At.preventDefault(),e.value=v.title||"",j(),A()}),z.appendChild(L),z.appendChild(Ve),z.appendChild(Ne),v.isSemanticMatch&&I!=="autocomplete"&&z.appendChild(hn),B.appendChild(z)}),t.appendChild(B)};async function $(E,F,H=[]){return hi(E,F,H)}let j=async()=>{let F=(e.value||"").trim();if(n&&(n.hidden=!F),!F){t.innerHTML="";return}let H=Fn(F),m=(H.keywordQuery||"").toLowerCase().split(/\s+/).map(v=>v.trim()).filter(Boolean),b=d(),I=b.filter(v=>{let ne=`${v.title} ${v.body}`.toLowerCase();return!m.length||m.every(L=>ne.includes(L))?H.timeRange?Number.isFinite(v.timestamp)?v.timestamp>=H.timeRange.start&&v.timestamp<=H.timeRange.end:!1:!0:!1});I.sort((v,ne)=>(ne.timestamp||0)-(v.timestamp||0));let B=[...I];if(I.length<5){let v=await $(H.keywordQuery||F,b,I);B.push(...v)}x(B)},T=E=>{let F=E.toLowerCase(),H=d().filter(m=>{let b=String(m.title||"").toLowerCase(),I=String(m.body||"").toLowerCase();return b.includes(F)||I.includes(F)});return H.sort((m,b)=>{let I=String(m.title||"").toLowerCase(),B=String(b.title||"").toLowerCase(),v=String(m.body||"").toLowerCase(),ne=String(b.body||"").toLowerCase(),z=I.startsWith(F)||v.startsWith(F),L=B.startsWith(F)||ne.startsWith(F);return z!==L?z?-1:1:(b.timestamp||0)-(m.timestamp||0)}),H.slice(0,8)},w=E=>{l=T(E),f=l.length?0:-1,x(l,{limit:8,query:E,selectedIndex:f,mode:"autocomplete"})},N=()=>{x(l,{limit:8,query:e.value.trim(),selectedIndex:f,mode:"autocomplete"})},S=()=>{let E=(e.value||"").trim();E!==u&&(g&&clearTimeout(g),g=setTimeout(()=>{if(u=E,!E){A();return}w(E)},120))},R=()=>{if(f<0||f>=l.length)return;let E=l[f];e.value=E.title||"",j(),A()};e.addEventListener("input",S),e.addEventListener("keydown",E=>{if(t.dataset.mode==="autocomplete")if(E.key==="ArrowDown"){if(E.preventDefault(),!l.length)return;f=Math.min(f+1,l.length-1),N()}else if(E.key==="ArrowUp"){if(E.preventDefault(),!l.length)return;f=Math.max(f-1,0),N()}else E.key==="Enter"?f>=0&&(E.preventDefault(),R()):E.key==="Escape"&&(E.preventDefault(),A())}),document.addEventListener("click",E=>{E.target instanceof Node&&(E.target===e||t.contains(E.target)||A())}),n&&n.addEventListener("click",()=>{e.value="",A(),n.hidden=!0,e.focus()}),document.addEventListener("memoryCue:remindersUpdated",j)}async function ut(e={}){if(!Z)return null;if(typeof Nn=="function")try{Nn()}catch{}let t=typeof e.text=="string"?e.text:(Z.value||"").trim(),n=Or(t),i=n.text;if(!i)return null;if(n.kind==="reflection"){let u=_r(i);return u?(Z.value="",u):null}let a=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,d=null;if(a)d=new Date(a).toISOString();else try{let u=un(i);u&&u.time&&(d=new Date(`${u.date}T${u.time}:00`).toISOString())}catch{d=null}let l=Hr(i,d);if(n.kind==="footy-drill"?l.category="Footy \u2013 Drills":n.kind==="task"&&(l.category="Tasks"),e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{l.notifyAt=new Date(e.notifyAt).toISOString()}catch{l.notifyAt=null}let f=Oi(l,{closeSheet:!1});if(f&&typeof document<"u"){Z.value="";try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:f}}))}catch{}}return f||null}typeof window<"u"&&(window.memoryCueQuickAddNow=ut),Br?.addEventListener("click",()=>{ut()}),Z?.addEventListener("keydown",e=>{(e.key==="Enter"||e.key==="NumpadEnter")&&(e.preventDefault(),ut())}),Mr?.addEventListener("submit",e=>{e.preventDefault(),ut()}),qr();function jr(){if(typeof HTMLElement>"u"||!(le instanceof HTMLElement)||!(Z instanceof HTMLInputElement)||le.dataset.voiceBound==="true")return;if(le.dataset.voiceBound="true",typeof window>"u"){le.setAttribute("disabled","true"),le.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){le.setAttribute("disabled","true"),le.setAttribute("aria-disabled","true"),le.getAttribute("title")||(le.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,le.setAttribute("aria-pressed",d?"true":"false"),le.dataset.listening=d?"true":"false",le.classList.toggle("is-listening",d)},s=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",f=>{let u=f?.results?.[0]?.[0]?.transcript?.trim()||"";if(u){Z.value=u;try{Z.focus({preventScroll:!0})}catch{Z.focus()}try{let g=Z.value.length;typeof Z.setSelectionRange=="function"&&Z.setSelectionRange(g,g)}catch{}}});let l=()=>{i(!1)};return t.addEventListener("end",l),t.addEventListener("error",l),t},a=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};Nn=a,le.addEventListener("click",()=>{let d=s();if(d){if(n){a();return}try{d.start(),i(!0)}catch(l){console.warn("Quick add voice error:",l),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",a),i(!1)}jr();let bi=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,ve=null,wi=!!bi;wi&&(ve=new bi,ve.lang="en-AU",ve.interimResults=!1,ve.maxAlternatives=1);function Wr(){try{if(typeof D=="function"){D("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}Be&&(wi&&ve?Be.addEventListener("click",()=>{try{ve.start(),Be.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):Be.addEventListener("click",()=>{Wr()})),ve&&(ve.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();Gr(t)}),ve.addEventListener("end",()=>{Be&&Be.classList.remove("is-recording")}),ve.addEventListener("error",()=>{Be&&Be.classList.remove("is-recording")}));function Vr(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function Yr(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,s=new Date(i);if(n.includes("tomorrow"))s.setDate(s.getDate()+1);else if(!n.includes("today"))return t;let a=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!a)return t;let d=parseInt(a[1],10),l=a[2]?parseInt(a[2],10):0,f=a[3];f||(/\b(p\.?m\.?|p m)\b/.test(n)?f="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(f="am")),f==="pm"&&d<12&&(d+=12),f==="am"&&d===12&&(d=0),s.setHours(d,l,0,0);let u=new Date(s),g=new Date(u.getTime()-10*60*1e3);return t.dueDate=u,t.notifyAt=g,t}function Gr(e){if(!e||!Z)return;let t=Vr(e),{dueDate:n,notifyAt:i}=Yr(e);Z.value=t,ut({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&Z&&(e.preventDefault(),Z.focus())})));try{se==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let Kr=o.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",vi=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Xr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",jt=o.reminderLandingPath||(se==="desktop"?"index.html#reminders":"mobile.html"),he=(e,t={})=>{let n=null;try{n=typeof CustomEvent<"u"?CustomEvent:null}catch{n=null}!n&&typeof window<"u"&&typeof window.CustomEvent<"u"&&(n=window.CustomEvent),n||(n=function(i,s){s=s||{bubbles:!1,cancelable:!1,detail:null};let a=new Event(i,s);return a.detail=s.detail,a}),document.dispatchEvent(new n(e,{detail:t}))};function Ei(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function ft(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:p}}))}catch{}}O&&!O.value&&(O.value=K),Me()&&Ue();function xe(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let s=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(s.push(n);s.length>20;)s.shift();window.memoryCueActivityQueue=s}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(rr,{detail:n}));else if(document.createEvent){let s=document.createEvent("CustomEvent");s&&s.initCustomEvent&&(s.initCustomEvent(rr,!1,!1,n),document.dispatchEvent(s))}}catch{}}}function Qr(){if(typeof HTMLElement>"u"||!(ce instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&h instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&h instanceof HTMLTextAreaElement;if(!e&&!t||ce.dataset.voiceBound==="true")return;if(ce.dataset.voiceBound="true",typeof window>"u"){ce.setAttribute("disabled","true"),ce.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){ce.setAttribute("disabled","true"),ce.setAttribute("aria-disabled","true"),ce.getAttribute("title")||(ce.title="Voice input is not supported in this browser.");return}let i=null,s=!1,a=u=>{s=u,ce.setAttribute("aria-pressed",u?"true":"false"),ce.dataset.listening=u?"true":"false",ce.classList.toggle("is-listening",u)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",g=>{let A=g.results?.[0]?.[0]?.transcript?.trim()||"";if(A){h.value=A;try{h.focus({preventScroll:!0})}catch{try{h.focus()}catch{}}try{let x=h.value.length;typeof h.setSelectionRange=="function"&&h.setSelectionRange(x,x)}catch{}xe({action:"dictated",label:`Voice input captured \xB7 ${A}`})}});let u=()=>{a(!1)};return i.addEventListener("end",u),i.addEventListener("error",u),i},l=()=>{if(!(!s||!i)){try{i.stop()}catch{}a(!1)}};ce.addEventListener("click",()=>{let u=d();if(u){if(s){l();return}try{u.start(),a(!0)}catch(g){console.warn("Speech recognition error:",g),a(!1)}}});let f=()=>{l()};typeof document<"u"&&(document.addEventListener("cue:close",f),document.addEventListener("reminders:updated",f)),a(!1)}ts(),Qr();let Wt,Vt,Yt,Gt,ze,Kt,Xt,Qt,zt,Jt,Zt,mt,pt,en,tn,Bn,On,nn,Pn,Si=o.firebaseDeps,_n=typeof o.importModule=="function"?o.importModule:e=>import(e),ht=ii(),gt=!1,Ee=!1,Hn=null,ke=null,yt=null,p=[],Je=!1,ae=null,bt=null,Ze=null,wt=null,rn=null,je={},We={},Q={},Ti=typeof document<"u"?document.getElementById("createSheetTitle"):null,Ai=()=>{h instanceof HTMLElement&&setTimeout(()=>{try{h.focus()}catch{}},0)},et=(e,t=null)=>{wt=e||null,rn=t||null,Ze=wt==="edit"?rn:null,Ti instanceof HTMLElement&&(Ti.textContent=wt==="edit"?"Edit reminder":"New reminder")};function be(e=p){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,s=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===s?Ni(t||{},n||{}):s-i})}function zr(e=p){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let s=Number.isFinite(i?.orderIndex)?i.orderIndex:null;s!=null&&(s<t&&(t=s),s>n&&(n=s))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function vt(e=p){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),be(n);else{n=e.slice().sort(Ni);let i=n.length;n.forEach((s,a)=>{s.orderIndex=(i-a)*Ae})}return e===p&&(p=n),n}function Ii(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=zr();if(t==="end"){let s=Number.isFinite(n)?n:0;e.orderIndex=s-Ae||Ae}else{let s=Number.isFinite(i)?i:0;e.orderIndex=s+Ae||Ae}}function on(e=p){if(!Array.isArray(e)||e.length<2)return!1;be(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],s=e[n],a=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(s?.orderIndex)?s.orderIndex:null;if(a==null||d==null||a<=d||a-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Ae;return e===p&&be(p),!0}let _={draggingId:null,dropTargetId:null,dropBefore:!0},Li=!1,y={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Jr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Et(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function Oe(){k&&(k.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),k.classList.remove("drag-over-list"))}function $n(){if(!k)return;let e=k.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),Oe(),_.draggingId=null,_.dropTargetId=null,_.dropBefore=!0}function Ci(e,t,n){if(!e||e===t)return;let i=p.findIndex(x=>x?.id===e);if(i<0)return;let[s]=p.splice(i,1),a;if(!t)a=p.length;else{let x=p.findIndex($=>$?.id===t);if(x<0){p.splice(i,0,s);return}a=n?x:x+1}p.splice(a,0,s);let d=p[a-1],l=p[a+1],f=Number.isFinite(d?.orderIndex)?d.orderIndex:null,u=Number.isFinite(l?.orderIndex)?l.orderIndex:null,g;f!=null&&u!=null?g=(f+u)/2:f!=null?g=f-Ae:u!=null?g=u+Ae:g=Ae,Number.isFinite(g)||(g=Ae*(p.length+1)),s.orderIndex=g,be(p);let A=on(p);Je=!0,Y(),ee(),A?p.forEach(x=>ue(x)):ue(s),ft(),he("memoryCue:remindersUpdated",{items:p}),xe({action:"reordered",label:"Reminders reordered"})}function Zr(e){let t=Et(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(_.draggingId=i,_.dropTargetId=null,_.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function eo(e){if(!_.draggingId)return;let t=Et(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),_.dropTargetId=null,_.dropBefore=!1,Oe(),k?.classList.add("drag-over-list");return}if(t.dataset.id===_.draggingId){e.preventDefault(),Oe();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,s=e.clientY<i;(_.dropTargetId!==t.dataset.id||_.dropBefore!==s)&&(Oe(),t.classList.add(s?"drag-over-before":"drag-over-after"),_.dropTargetId=t.dataset.id,_.dropBefore=s)}function to(e){let t=Et(e.target);if(!t){k?.contains(e.relatedTarget)||Oe();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),k?.contains(e.relatedTarget)||k?.classList.remove("drag-over-list"))}function no(e){if(!_.draggingId)return;e.preventDefault();let t=Et(e.target),n=t?.dataset.id||null,i=_.dropBefore;if(t){let s=t.getBoundingClientRect(),a=s.top+s.height/2;i=e.clientY<a}else n=null,i=!1;Ci(_.draggingId,n,i),$n()}function io(){$n()}function ro(){!k||Li||(Li=!0,k.addEventListener("dragstart",Zr),k.addEventListener("dragover",eo),k.addEventListener("drop",no),k.addEventListener("dragend",io),k.addEventListener("dragleave",to),sn())}function sn(){if(!k||sn._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){sn._bound=!0;return}let t=6,n=160;function i(){y.longPressTimer&&(clearTimeout(y.longPressTimer),y.longPressTimer=null)}function s(){k&&(y.initialTouchAction!=null?k.style.touchAction=y.initialTouchAction:k.style.removeProperty("touch-action"))}function a({keepHighlights:T=!1}={}){if(i(),y.item&&y.pointerId!=null)try{y.item.hasPointerCapture?.(y.pointerId)&&y.item.releasePointerCapture(y.pointerId)}catch{}if(y.placeholder?.parentNode)try{y.placeholder.parentNode.removeChild(y.placeholder)}catch{}y.item&&(y.item.classList.remove("is-dragging"),y.originalStyles?y.item.setAttribute("style",y.originalStyles):y.item.removeAttribute("style")),s(),T||Oe(),Object.assign(y,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(T){return k?Array.from(k.querySelectorAll("[data-reminder-item]")).filter(w=>w!==T):[]}function l(T){let w=y.item;if(!w||y.ready)return;let N=w.getBoundingClientRect(),S=window.getComputedStyle(w);y.ready=!0,_.draggingId=w.dataset.id||null,y.offsetY=T.clientY-N.top,y.fixedX=N.left;let R=document.createElement("div");R.className="touch-drag-placeholder",R.setAttribute("aria-hidden","true"),R.style.height=`${N.height}px`,R.style.boxSizing="border-box",R.style.marginTop=S.marginTop,R.style.marginBottom=S.marginBottom,R.style.marginLeft=S.marginLeft,R.style.marginRight=S.marginRight,R.style.borderRadius=S.borderRadius,R.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",R.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",R.style.pointerEvents="none",R.style.display="block",R.style.width="100%",w.parentNode?.insertBefore(R,w),y.placeholder=R,y.longPressTimer=null,y.originalStyles=w.getAttribute("style")||"",w.classList.add("is-dragging"),w.style.position="fixed",w.style.left=`${N.left}px`,w.style.top=`${N.top}px`,w.style.width=`${N.width}px`,w.style.zIndex="999",w.style.pointerEvents="none",w.style.touchAction="none",y.initialTouchAction=k.style.touchAction||"",k.style.touchAction="none"}function f(T){let w=y.item;if(!w||!y.ready)return;let N=T-y.offsetY;w.style.top=`${N}px`,w.style.left=`${y.fixedX}px`}function u(T){if(!y.ready||!k)return;let w=y.item,N=d(w);if(Oe(),!N.length){_.dropTargetId=null,_.dropBefore=!1;return}let S=null,R=!1;for(let m of N){let b=m.getBoundingClientRect(),I=b.top+b.height/2;if(T<I){S=m,R=!0;break}}if(!S){S=N[N.length-1];let m=S.getBoundingClientRect(),b=m.top+m.height/2;R=T<b,R||(R=!1)}if(!S){_.dropTargetId=null,_.dropBefore=!1;return}let E=S.getBoundingClientRect(),F=E.top+E.height/2,H=T<F;S.classList.add(H?"drag-over-before":"drag-over-after"),_.dropTargetId=S.dataset.id||null,_.dropBefore=H}function g(T){let w=_.draggingId,N=y.moved;if(!y.ready){a();return}a(),!T&&N&&w&&Ci(w,_.dropTargetId,_.dropBefore),$n()}function A(T){let w=T.pointerType||"";if(w&&w!=="touch"&&w!=="pen"||y.active)return;let N=Et(T.target);if(!N)return;let S=Jr(T.target);if(!(S&&S!==N)){y.active=!0,y.pointerId=T.pointerId,y.item=N,y.startX=T.clientX,y.startY=T.clientY,y.lastClientX=T.clientX,y.lastClientY=T.clientY,y.moved=!1,y.ready=!1,y.originalStyles=N.getAttribute("style")||"",y.startTime=T.timeStamp||Date.now(),_.dropTargetId=null,_.dropBefore=!0,_.draggingId=null,i(),y.longPressTimer=setTimeout(()=>{l({clientY:y.lastClientY})},n);try{N.setPointerCapture(T.pointerId)}catch{}}}function x(T){if(!y.active||T.pointerId!==y.pointerId)return;let w=T.pointerType||"";if(!(w&&w!=="touch"&&w!=="pen")){if(y.lastClientX=T.clientX,y.lastClientY=T.clientY,!y.ready){let N=Math.abs(T.clientX-y.startX),S=Math.abs(T.clientY-y.startY);if(N>t||S>t){let R=typeof T.timeStamp=="number"?T.timeStamp:Date.now();Math.abs(R-y.startTime)>=n?(i(),l({clientY:y.lastClientY})):a()}return}T.preventDefault(),y.moved=!0,f(T.clientY),u(T.clientY)}}function $(T){!y.active||T.pointerId!==y.pointerId||g(!1)}function j(T){!y.active||T.pointerId!==y.pointerId||g(!0)}k.addEventListener("pointerdown",A),window.addEventListener("pointermove",x),window.addEventListener("pointerup",$),window.addEventListener("pointercancel",j),sn._bound=!0}function xi(){ae=null,An("offline"),Ot.forEach(e=>e.classList.remove("hidden")),Pt.forEach(e=>e.classList.add("hidden")),Ht&&(Ht.textContent=""),bt?.(),bt=null,qn(),Y(),ee(),He()}function Un(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(ei);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),s=Number.isFinite(n.updatedAt)?n.updatedAt:i,a=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:dn(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:te(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:s,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(a)?a:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0,semanticEmbedding:J(n.semanticEmbedding)}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function oo(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(ei);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:te(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday,semanticEmbedding:J(n.semanticEmbedding)}));localStorage.setItem(ei,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function ee(){be(p),oo(p)}function qn(){p=vt(Un())}qn();async function so(){let e=!1;for(let i of p){let s=J(i?.semanticEmbedding);await ar(i);let a=J(i?.semanticEmbedding);!s&&a&&(e=!0)}e&&ee();let t=Rn(lt,[]),n=!1;for(let i of t){let s=J(i?.semanticEmbedding);await ar(i);let a=J(i?.semanticEmbedding);!s&&a&&(n=!0)}if(n&&typeof localStorage<"u")try{localStorage.setItem(lt,JSON.stringify(t))}catch(i){console.warn("Failed to persist note embeddings",i)}}so();async function ao(){if(!ae){p=Un();return}let e=vt(Un());if(!e.length){p=[],ee();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await ue(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}p=vt(e.map(n=>({...n,pendingSync:!1}))),ee(),Y(),He()}try{Q=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{Q={}}if(Q&&typeof Q=="object"&&Object.values(Q).forEach(e=>{e&&typeof e=="object"&&(e.category=te(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:St(e),e.urlPath=e.urlPath||jt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null),e.semanticEmbedding=J(e.semanticEmbedding))}),!Me()){let e=Hi();typeof Notification<"u"&&Notification.permission==="granted"?(Sn(),e.length&&ti(e,{requestCheck:!0})):e.length&&ti(e)}let an=e=>{if(!ht)return;let t=[ht];ht.window&&!t.includes(ht.window)&&t.push(ht.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function co(){if(!re)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",s=typeof document<"u"&&typeof document.execCommand=="function",a=()=>"value"in re?re.value:re.innerHTML,d=g=>{if("value"in re){re.value=g;return}if(typeof g!="string"||g.length===0){re.innerHTML="";return}let A=g.trim();if(/<\/?[a-z][\s\S]*>/i.test(A)){re.innerHTML=g;return}let $=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");re.innerHTML=$},l=g=>{g?re.classList.add("notes-editor--columns"):re.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!g))},f="";try{f=localStorage.getItem(n)||""}catch{D("Unable to access saved notes")}d(f);let u=!1;try{u=localStorage.getItem(i)==="1"}catch{u=!1}l(u),re.addEventListener("input",()=>{f=a();try{localStorage.setItem(n,f)}catch{D("Notes saved for this session only")}}),br?.addEventListener("click",()=>{f=a();try{localStorage.setItem(n,f),D("Notes saved")}catch{D("Notes saved for this session only")}}),wr?.addEventListener("click",()=>{let g=f;try{g=localStorage.getItem(n)||f}catch{D("Unable to load saved notes")}f=g,d(f)}),e?.addEventListener("click",g=>{let A=g.target;if(!(A instanceof Element))return;let x=A.closest("button[data-action]");if(!x)return;let $=x.getAttribute("data-action");if($==="columns"){let j=!re.classList.contains("notes-editor--columns");l(j);try{localStorage.setItem(i,j?"1":"0")}catch{D("Column preference saved for this session only")}return}if(!s){D("Formatting controls are not supported in this browser");return}re.focus(),$==="bullets"?document.execCommand("insertUnorderedList"):$==="numbers"&&document.execCommand("insertOrderedList")})}if(co(),de?.addEventListener("click",Yi),Si)({initializeApp:Wt,getFirestore:Vt,enableMultiTabIndexedDbPersistence:Yt,enableIndexedDbPersistence:Gt,doc:ze,setDoc:Kt,deleteDoc:Xt,onSnapshot:Qt,collection:zt,query:Jt,orderBy:Zt,serverTimestamp:mt,getAuth:pt,onAuthStateChanged:en,GoogleAuthProvider:tn,signInWithPopup:Bn,signInWithRedirect:On,getRedirectResult:nn,signOut:Pn}=Si),gt=!0;else try{({initializeApp:Wt}=await _n("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Vt,enableMultiTabIndexedDbPersistence:Yt,enableIndexedDbPersistence:Gt,doc:ze,setDoc:Kt,deleteDoc:Xt,onSnapshot:Qt,collection:zt,query:Jt,orderBy:Zt,serverTimestamp:mt}=await _n("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:pt,onAuthStateChanged:en,GoogleAuthProvider:tn,signInWithPopup:Bn,signInWithRedirect:On,getRedirectResult:nn,signOut:Pn}=await _n("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),gt=!0}catch(e){gt=!1,console.warn("Firebase modules failed to load:",e),D("Firebase failed to load; notes available offline"),an(!1)}if(gt&&typeof Wt=="function"&&typeof Vt=="function"&&typeof pt=="function")try{let e=Zo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Hn=Wt(e),ke=Vt(Hn),Ee=!0,console.info("[Firebase] Firestore initialised",e.projectId),an(!0)}catch(e){Ee=!1,console.warn("Firebase initialization failed:",e),D("Firebase failed to load; notes available offline"),an(!1)}else gt?(Ee=!1,an(!1)):Ee=!1;Ee&&typeof Yt=="function"&&typeof Gt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Yt(ke),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Gt(ke),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),Ee&&typeof pt=="function"&&(yt=pt(Hn));function lo(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let uo=typeof navigator<"u"&&navigator.language?navigator.language:"",ki=lo(uo),tt=ki||"en-US",De="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(De=e.timeZone),!ki&&e.locale&&(tt=e.locale)}catch{}let fo=new Intl.DateTimeFormat(tt,{timeZone:De,hour:"2-digit",minute:"2-digit"}),mo=new Intl.DateTimeFormat(tt,{timeZone:De,weekday:"long",day:"numeric",month:"long"}),po=new Intl.DateTimeFormat("en-CA",{timeZone:De,year:"numeric",month:"2-digit",day:"2-digit"}),ho=new Intl.DateTimeFormat(tt,{timeZone:De,weekday:"long"}),go=new Intl.DateTimeFormat(tt,{timeZone:De,month:"short",day:"numeric"});function Pe(e){let t=po.formatToParts(e),n=t.find(a=>a.type==="year").value,i=t.find(a=>a.type==="month").value,s=t.find(a=>a.type==="day").value;return`${n}-${i}-${s}`}function Di(e,t){let[n,i,s]=e.split("-").map(f=>parseInt(f,10)),[a,d]=t.split(":").map(f=>parseInt(f,10)),l=new Date;return l.setFullYear(n,(i||1)-1,s||1),l.setHours(a||0,d||0,0,0),l.toISOString()}let yo=new Intl.DateTimeFormat("en-CA",{timeZone:De,year:"numeric",month:"2-digit",day:"2-digit"}),bo=new Intl.DateTimeFormat("en-CA",{timeZone:De,hour:"2-digit",minute:"2-digit",hour12:!1});function wo(e){try{let t=new Date(e),n=yo.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",s=n.find(d=>d.type==="month")?.value||"00",a=n.find(d=>d.type==="day")?.value||"00";return`${i}-${s}-${a}`}catch{return""}}function vo(e){try{let t=new Date(e),n=bo.formatToParts(t),i=n.find(a=>a.type==="hour")?.value?.padStart(2,"0")||"00",s=n.find(a=>a.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${s}`}catch{return""}}function dn(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function cn(){return Pe(new Date)}function Eo(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function ss(e){let t=Eo(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function ln(e){return e==="High"?3:e==="Medium"?2:1}function Ni(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let s=e?.due?new Date(e.due).getTime():1/0,a=t?.due?new Date(t.due).getTime():1/0;if(s!==a)return s-a;let d=ln(t?.priority)-ln(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function as(e,t){let n=ln(t.priority)-ln(e.priority);if(n)return n;let i=+new Date(e.due||0),s=+new Date(t.due||0);return i!==s?i-s:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Ri(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return mo.format(t)}catch{return e}}function jn(e){return fo.format(e)}function So(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ds(e){return e?So(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function D(e){q&&(Ge(),q.dataset.statusKind="toast",q.textContent=e,clearTimeout(D._t),D._t=setTimeout(()=>{q&&q.dataset.statusKind==="toast"&&(q.textContent="",delete q.dataset.statusKind)},2500))}function To(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function un(e){e=String(e||"").toLowerCase();let t={date:cn(),time:""},n=l=>{let f=new Date,u=f.getDay(),g=(l-u+7)%7,A=new Date(f);return A.setDate(f.getDate()+(g===0?7:g)),A},i=l=>{let f=new Date,u=f.getDay(),g=(l-u+7)%7,A=new Date(f);return A.setDate(f.getDate()+g),A},s={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},a={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let l=new Date;l.setDate(l.getDate()+1),t.date=Pe(l)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=s[l[1]],u=n(f);t.date=Pe(u)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=s[l[1]],u=i(f);t.date=Pe(u)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=s[l[1]],u=n(f);t.date=Pe(u)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let l=e.match(/\bin\s+(\d+)\s+days?\b/),f=parseInt(l[1],10),u=new Date;u.setDate(u.getDate()+f),t.date=Pe(u)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let l=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),f=parseInt(l[1],10),u=parseInt(l[2],10)-1,g=l[3]?parseInt(l[3],10):new Date().getFullYear(),A=new Date(g,u,f);t.date=Pe(A)}else for(let[l,f]of Object.entries(a)){let u=new RegExp(`\\b${l}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(u.test(e)){let g=e.match(u),A=parseInt(g[1],10),x=new Date().getFullYear(),$=new Date(x,f,A);t.date=Pe($);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let l=parseInt(d[1],10),f=d[2]?parseInt(d[2],10):0,u=d[3];u&&(u==="pm"&&l<12&&(l+=12),u==="am"&&l===12&&(l=0)),t.time=`${String(l).padStart(2,"0")}:${String(f).padStart(2,"0")}`}return t}let Wn=Ee&&yt&&typeof tn=="function";Xi({authReady:Wn,auth:yt,GoogleAuthProvider:tn,signInWithPopup:Bn,signInWithRedirect:On,signOut:Pn,toast:D});let Fi=Cr,Mi=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(s=>{console.error("Auth handler error:",s)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Fi&&Ot.length&&Ot.forEach(e=>Mi(e,Qi)),Wn&&typeof nn=="function"&&nn(yt).catch(()=>{}),Fi&&Pt.length&&Pt.forEach(e=>Mi(e,zi)),Wn&&typeof en=="function"?en(yt,async e=>{e?(ae=e.uid,An("online"),Ot.forEach(t=>t.classList.add("hidden")),Pt.forEach(t=>t.classList.remove("hidden")),Ht&&(Ht.textContent=e.displayName||e.email||""),Ao(),await ao()):xi()}):xi();function Ao(){if(!Ee||!ke||typeof zt!="function"||typeof Jt!="function"||typeof Zt!="function"||typeof Qt!="function")return;if(!ae){qn(),Y(),Qe(),ee(),He();return}bt&&bt();let e=zt(ke,"users",ae,"reminders"),t=Jt(e,Zt("updatedAt","desc"));bt=Qt(t,n=>{let i=[];n.forEach(s=>{let a=s.data(),d=Number(a.orderIndex),l=typeof a.plannerLessonId=="string"&&a.plannerLessonId?a.plannerLessonId:null,f=a.pinToToday===!0;i.push({id:s.id,title:a.title,priority:a.priority,notes:a.notes||"",done:!!a.done,due:a.due||null,category:te(a.category),createdAt:a.createdAt?.toMillis?.()||0,updatedAt:a.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:l,pinToToday:f})}),p=vt(i),Y(),Qe(),ee(),He()},n=>{console.error("Firestore sync error:",n),X&&An("error","Sync Error")})}async function ue(e){if(!(!Ee||!ae||!ke||typeof ze!="function"||typeof Kt!="function"||typeof mt!="function"))try{await Kt(ze(ke,"users",ae,"reminders",e.id),{ownerUid:ae,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||K,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):mt(),updatedAt:mt()},{merge:!0})}catch(t){console.error("Save failed:",t),D("Save queued (offline)")}}async function Io(e){if(!(!Ee||!ae||!ke||typeof ze!="function"||typeof Xt!="function"))try{await Xt(ze(ke,"users",ae,"reminders",e))}catch{D("Delete queued (offline)")}}async function fn(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||K,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function _e({preserveDetail:e=!1,resetMode:t=!0}={}){h&&(h.value=""),C&&(C.value=""),M&&(M.value=""),P&&(P.value=""),qt("Medium"),O&&(O.value=K),ui(),t?et(null):Ze=wt==="edit"?rn:null,de&&(de.textContent="Save"),fe?.classList.add("hidden"),kn(),e||si()}function Lo(e){let t=p.find(n=>n.id===e);t&&(et("edit",e),h&&(h.value=t.title||""),C&&M&&(t.due?(C.value=wo(t.due),M.value=vo(t.due)):(C.value="",M.value="")),qt(t?.priority||"Medium"),O&&(O.value=te(t.category)),P&&(P.value=typeof t.notes=="string"?t.notes:""),V&&(V.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),kn(),gr(t),de&&(de.textContent="Update"),fe?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),Ai(),he("cue:open",{mode:"edit"}))}function Bi(e){let t=e?.id||e;t&&(et("edit",t),Lo(t))}function Co(e=null){_e({resetMode:!1}),et("new");let t={mode:"create",trigger:e};he("cue:prepare",t),he("cue:open",t),Ai()}typeof window<"u"&&(window.openNewReminderSheet=Co,window.openEditReminderSheet=Bi);function Oi(e={},t={}){let{closeSheet:n=!0,activityAction:i="created",activityLabelPrefix:s="Reminder added"}=t,a=typeof e.title=="string"?e.title.trim():"";if(!a)return null;let d=Date.now(),l=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),f=te(e.category??(O?O.value:K)),u=null;e.due instanceof Date?u=e.due.toISOString():typeof e.due=="string"&&e.due.trim()&&(u=e.due);let g=null;e.notifyAt instanceof Date?g=e.notifyAt.toISOString():typeof e.notifyAt=="string"&&e.notifyAt.trim()&&(g=e.notifyAt);let A={id:dn(),title:a,priority:e.priority||Ut(),category:f,notes:l,done:!1,createdAt:d,updatedAt:d,due:u,pendingSync:!ae,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday,notifyAt:g,semanticEmbedding:J(e.semanticEmbedding)};Ii(A,{position:"start"}),p=[A,...p],be(p);let x=on(p);return Je=!0,Y(),ee(),Fr(A),x?p.forEach($=>ue($)):ue(A),fn(A),nt(A),He(),ft(),he("memoryCue:remindersUpdated",{items:p}),n&&Ei(),xe({action:i,label:`${s} \xB7 ${A.title}`}),A}function xo(e){return Oi(e,{closeSheet:!0})}function ko(e,t){if(!ae)return D("Sign in to add notes"),null;if(!e)return null;let n=p.find(d=>d.id===e);if(!n)return null;let s=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!s)return n;let a=typeof n.notes=="string"?n.notes:"";return n.notes=a?`${a}
${s}`:s,n.updatedAt=Date.now(),ue(n),Y(),ee(),xe({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Do(e){let t=p.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),ue(t),fn(t),Y(),ee(),t.done?(pn(e),xe({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(nt(t),xe({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function No(e,t){let n=p.find(s=>s?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),ue(n),Y(),ee(),ft(),he("memoryCue:remindersUpdated",{items:p}))}function Ro(e){if(!pe||pe.tokenId!==e)return;let{item:t,index:n}=pe;if(!t){Ge(e);return}Ge(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),p.length):p.length;t.pendingSync=!ae,t.updatedAt=Date.now(),p.splice(i,0,t),be(p);let s=on(p);Je=!0,Y(),ee(),nt(t),s?p.forEach(a=>ue(a)):ue(t),fn(t),ft(),he("memoryCue:remindersUpdated",{items:p}),xe({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),D("Reminder restored")}function Vn(e){let t=p.findIndex(s=>s.id===e),n=t>=0?p.splice(t,1)[0]:null;n&&Ze===e&&_e(),Y(),ee(),Io(e),pn(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(xe({action:"deleted",label:i}),n&&q){Ge();let s=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;pe={tokenId:s,item:n,index:t,timeoutId:null},hr(pe),pe.timeoutId=setTimeout(()=>{Ge(s)},pr)}else n&&Ge()}function Pi(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,s=800,a='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,l=!1,f=0,u=0,g=0,A=()=>{if(l){if(l=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",$),e.removeEventListener("pointerup",j),e.removeEventListener("pointercancel",T),e.removeEventListener("pointerleave",T),window.removeEventListener("pointerup",j),window.removeEventListener("pointercancel",T)}},x=w=>{if(w.pointerType==="mouse"&&w.button!==0)return;l&&A();let N=w.target;N instanceof Element&&N.closest(a)||(d=w.pointerId,f=w.clientX,u=w.clientY,g=typeof w.timeStamp=="number"?w.timeStamp:Date.now(),l=!0,e.addEventListener("pointermove",$),e.addEventListener("pointerup",j),e.addEventListener("pointercancel",T),e.addEventListener("pointerleave",T),window.addEventListener("pointerup",j),window.addEventListener("pointercancel",T))},$=w=>{if(!l||w.pointerId!==d)return;Math.abs(w.clientY-u)>i&&A()},j=w=>{if(!l||w.pointerId!==d)return;let N=w.clientX-f,S=Math.abs(w.clientY-u),R=(typeof w.timeStamp=="number"?w.timeStamp:Date.now())-g;if(A(),N<=-n&&S<=i&&R<=s){w.preventDefault(),w.stopPropagation();try{t()}catch(E){console.warn("Swipe delete handler failed",E)}}},T=w=>{l&&(typeof w.pointerId=="number"&&w.pointerId!==d||A())};e.addEventListener("pointerdown",x)}function St(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=jn(i);if(s)return`${n} \u2022 ${s}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let s=jn(i);if(s)return`Due ${s}`}}catch{}return"Due now"}function _i(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}D("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Hi(){return Object.values(Q||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||K,notes:typeof e.notes=="string"?e.notes:"",body:St(e),urlPath:e.urlPath||jt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null,semanticEmbedding:J(e.semanticEmbedding)}))}function Yn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(Q))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Hi(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Sn(),ti(e,{requestCheck:t})}function mn(e,{closeNotification:t=!0}={}){if(t){let n=Fe.get(e);if(n){try{n.close()}catch{}Fe.delete(e)}}je[e]&&(clearTimeout(je[e]),delete je[e]),We[e]&&(clearTimeout(We[e]),delete We[e]),ni(e),Q[e]&&(delete Q[e],Yn())}function pn(e){mn(e)}function Gn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Fe.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:St(e),tag:e.id});Fe.set(e.id,n);let i=()=>{Fe.get(e.id)===n&&Fe.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Fo(e){if(!Me())return!1;let t=lr();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Ue();if(!i)return!1;await ni(e.id,i);let s={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||K,body:a,urlPath:jt},a=St(e),d={body:a,tag:e.id,data:s,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(l){return console.warn("Failed to schedule persistent notification",l),!1}}function nt(e){if(!e||!e.id)return;if(e.category=te(e.category),!e.due||e.done){pn(e.id);return}let t=Q[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||K,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:St(e),urlPath:jt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,semanticEmbedding:J(e.semanticEmbedding),notifiedAt:(()=>{let l=typeof t.due=="string"?t.due:null,f=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return l===e.due?f:null})()};if(Q[e.id]=n,Yn(),je[e.id]&&(clearTimeout(je[e.id]),delete je[e.id]),We[e.id]&&(clearTimeout(We[e.id]),delete We[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let s=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,a=i-Date.now();if(a<=0){if(Q[e.id]?.viaTrigger){mn(e.id,{closeNotification:!1});return}Gn(e),mn(e.id,{closeNotification:!1});return}let d=Me();if(Number.isFinite(s)&&s>Date.now()&&s<i){let l=s-Date.now();We[e.id]=setTimeout(()=>{Gn({...e,due:e.due||n.due})},l)}d&&(n.viaTrigger=!1,Fo(e).then(l=>{l&&Q[e.id]&&(Q[e.id]={...Q[e.id],viaTrigger:!0},Yn())})),je[e.id]=setTimeout(()=>{d&&ni(e.id),Gn(e),mn(e.id,{closeNotification:!1})},a)}function He(){Object.values(Q).forEach(e=>nt({...e,category:te(e?.category)}))}function $i(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=ho.format(t),i=go.format(t),s=jn(t);return`${n}, ${i}${s?` at ${s}`:""}`}catch{return"No due date"}}let Ui="__mcPinToggleHandler";var Kn=!1;function Tt(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Le,t),e.classList.toggle(me,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function qi(e){if(!(e instanceof HTMLElement)||e[Ui])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let s=i.currentTarget;if(!(s instanceof HTMLElement))return;let d=(typeof s.closest=="function"?s.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){Tt(s,!1);return}let l=!s.classList.contains(Le);await Promise.resolve(No(d,l)),Tt(s,l)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[Ui]={click:t,keydown:n}}function Mo(){if(!k)return;let e=k.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){Tt(t,!1),qi(t);return}let a=!!p.find(d=>d?.id===i)?.pinToToday;Tt(t,a),qi(t)})}function ji(){if(!k||Kn)return;Kn=!0;let e=()=>{Kn=!1,Mo()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function Bo(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function Oo(e,t,n){if(!Array.isArray(e))return[];let s=t==="completed"?e.filter(a=>!!a?.done):e.filter(a=>!a?.done);return t==="today"?s.filter(a=>Bo(a,n)):s}function Po(){let e=document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]");e.length&&e.forEach(t=>{let i=t.getAttribute("data-reminders-tab")===ct;t.setAttribute("aria-pressed",i?"true":"false"),i?t.classList.add("reminders-tab-active","active"):t.classList.remove("reminders-tab-active","active")})}function Wi(e){if(!e||e===ct)return!1;document.querySelectorAll("#reminders-slim-header [data-reminders-tab], #view-reminders [data-reminders-tab]").length&&(Array.isArray(Cn)&&Y(),Qe())}function Vi(){if(se!=="mobile"||typeof document>"u"||Vi._wired)return;Po(),Qe(),document.querySelectorAll("#view-reminders [data-reminders-tab], #reminders-slim-header [data-reminders-tab]").forEach(t=>{t.addEventListener("click",()=>{let n=t.getAttribute("data-reminders-tab");Wi(n)})})}function Y(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let s={start:n,end:i};if(Oe(),be(p),ai)try{ai.textContent=String(p.length)}catch{}p.forEach(m=>{m&&typeof m=="object"&&(m.category=te(m.category))});let a=new Set(Qo.map(m=>te(m)));p.forEach(m=>{m&&typeof m=="object"&&a.add(te(m.category))});let d=Array.from(a).sort((m,b)=>m.localeCompare(b,void 0,{sensitivity:"base"}));if(Ln){let m=new Set;Array.from(Ln.querySelectorAll("option")).forEach(b=>{m.add(b.value.trim().toLowerCase())}),d.forEach(b=>{let I=b.toLowerCase();if(!m.has(I)){let B=document.createElement("option");B.value=b,Ln.appendChild(B),m.add(I)}})}if(Je)Je=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=p.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(b))}}catch{}}let l=p.slice();be(l),se==="mobile"&&(Cn=l.slice(),l=Oo(Cn,ct,s),Qe());let f=!0,u=p.length>0,g=l.length>0,A=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(Q||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(m.map(b=>b.id))})();if(Xe)if(g)Xe.classList.add("hidden");else{let m=u?"No reminders to show right now.":Kr;vi?vi(Xe,{icon:u?"sparkles":"bell",title:u?"Nothing to display":"Create your first cue",description:m,action:u?void 0:`<button type="button" class="${Xr}" data-trigger="open-cue">Create reminder</button>`}):Xe.textContent=m,Xe.classList.remove("hidden")}if(di&&di.classList.toggle("has-items",g),!k)return;if(!g){Xe?(k.innerHTML="",k.classList.add("hidden")):(k.innerHTML='<div class="text-muted">No reminders found.</div>',k.classList.remove("hidden")),ji();return}k.classList.remove("hidden"),k.replaceChildren();let x=document.createDocumentFragment(),$=k.tagName==="UL"||k.tagName==="OL",j=!0,T=["priority-high","priority-medium","priority-low"],w=(m,b)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...T);let I=typeof b=="string"?b.trim().toLowerCase():"";I.startsWith("h")?m.classList.add("priority-high"):I.startsWith("m")?m.classList.add("priority-medium"):I.startsWith("l")&&m.classList.add("priority-low")},N=(m,b="neutral")=>{let I=document.createElement("span");I.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",I.title=m,I.dataset.tone=b;let B=document.createElement("span");B.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",b==="priority-high"?B.classList.add("bg-error"):b==="priority-medium"?B.classList.add("bg-warning"):b==="priority-low"?B.classList.add("bg-secondary"):b==="category"?B.classList.add("bg-primary"):B.classList.add("bg-base-content","opacity-40");let v=document.createElement("span");return v.className="truncate",v.textContent=m,I.append(B,v),I},S=(m,b,{elementTag:I,isMobile:B})=>{let v={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:b,done:!!m.done,pinToToday:m.pinToToday===!0},ne="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",z="task-item reminder-row reminder-card w-full text-base-content",L=document.createElement(I);L.className=B?z:ne,L.dataset.id=v.id,L.dataset.category=v.category,L.dataset.title=v.title;let Ve=v.priority&&String(v.priority).trim();Ve?L.dataset.priority=Ve:delete L.dataset.priority,L.dataset.done=String(v.done),v.dueIso?L.dataset.due=v.dueIso:delete L.dataset.due,v.pinToToday?L.dataset.pinToToday="true":delete L.dataset.pinToToday,L.dataset.reminder=JSON.stringify(v),L.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",L.dataset.reminderItem="true",L.classList.add("reminder-draggable"),L.setAttribute("draggable","true"),L.setAttribute("role","button"),L.tabIndex=0,L.setAttribute("aria-label",`Edit reminder: ${m.title}`),w(L,v.priority),A.has(v.id)?L.dataset.notificationActive="true":delete L.dataset.notificationActive;let Ne=v.dueIso?new Date(v.dueIso):null;f&&Ne&&Ne>=n&&Ne<=i?(L.classList.add("is-today"),L.dataset.today="true"):(L.classList.remove("is-today"),delete L.dataset.today);let At=$i(m),gn=At&&At!=="No due date"?At:"",it=document.createElement("div");it.className="task-toolbar flex items-start gap-1",it.setAttribute("role","toolbar"),it.setAttribute("aria-label","Reminder actions"),B&&it.classList.add("flex-shrink-0");let ie=document.createElement("button");ie.type="button",ie.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn reminder-complete-toggle",ie.classList.toggle("reminder-complete-toggle--active",v.done);let $o=v.done?"reminder-complete-toggle-icon--checked":"reminder-complete-toggle-icon--unchecked";ie.innerHTML=`
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          width="18"
          height="18"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          class="reminder-complete-toggle-icon"
        >
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" opacity="0.32" />
          <path
            d="M5.5 12.25l4.25 4.25L18.75 7.5"
            stroke="currentColor"
            stroke-width="1.9"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="${$o}"
          />
        </svg>`,v.done?(ie.classList.add("text-base-content/60"),ie.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(ie.classList.add("text-success"),ie.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),ie.setAttribute("aria-pressed",v.done?"true":"false"),ie.setAttribute("data-reminder-control","toggle"),ie.setAttribute("data-no-swipe","true"),ie.addEventListener("click",G=>{G.preventDefault(),G.stopPropagation(),Do(v.id)});let yn=()=>Bi(m);if(B){let G=document.createElement("div");G.className="reminder-card-main reminder-row-main";let Te=document.createElement("div");Te.className="reminder-title reminder-row-title",Te.dataset.reminderTitle="true";let Ye=document.createElement("span");if(Ye.dataset.role="reminder-today-toggle",Ye.className="reminder-title-toggle cursor-pointer",Ye.setAttribute("role","button"),Ye.tabIndex=0,Ye.textContent=m.title,Tt(Ye,v.pinToToday),Te.appendChild(Ye),G.appendChild(Te),gn){let ge=document.createElement("div");ge.className="reminder-date reminder-row-meta",ge.textContent=gn,G.appendChild(ge)}return v.done?L.classList.add("reminder-row-completed"):Ne&&Ne<e&&L.classList.add("reminder-row-overdue"),ie.classList.add("reminder-row-complete","reminder-complete-btn"),L.append(ie,G),L.addEventListener("click",ge=>{if(ge.defaultPrevented)return;let Xn=ge.target;Xn&&typeof Xn.closest=="function"&&Xn.closest("[data-reminder-control]")||yn()}),L.addEventListener("keydown",ge=>{ge.defaultPrevented||ge.target===L&&(ge.key==="Enter"||ge.key===" ")&&(ge.preventDefault(),yn())}),B&&Pi(L,()=>Vn(v.id)),L}let bn=document.createElement("div");bn.className="flex min-w-0 flex-1 flex-col gap-2";let rt=document.createElement("p");rt.className="text-lg font-bold leading-snug text-base-content",rt.classList.add("desktop-reminder-title"),rt.classList.add("sm:text-[0.95rem]"),v.done&&rt.classList.add("line-through","text-base-content/60"),rt.textContent=m.title,bn.appendChild(rt);let It=document.createElement("div");It.className="desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70",gn&&It.appendChild(N(gn,"due")),!!(b&&b!==K)&&It.appendChild(N(b,"category")),It.children.length&&bn.appendChild(It),L.appendChild(bn);let Re=document.createElement("button");return Re.type="button",Re.className="btn btn-ghost btn-circle btn-xs text-error task-toolbar-btn reminder-icon-btn",Re.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--accent-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>`,Re.setAttribute("aria-label",`Delete reminder: ${m.title}`),Re.setAttribute("data-action","delete"),Re.setAttribute("data-reminder-control","delete"),Re.setAttribute("data-no-swipe","true"),Re.addEventListener("click",G=>{G.preventDefault(),G.stopPropagation();try{Vn(v.id)}catch(Te){console.warn("Delete handler failed",Te)}}),it.append(ie,Re),L.appendChild(it),L.addEventListener("click",G=>{if(G.defaultPrevented)return;let Te=G.target;Te&&typeof Te.closest=="function"&&Te.closest("[data-reminder-control]")||yn()}),L.addEventListener("keydown",G=>{G.defaultPrevented||G.target===L&&(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),yn())}),B&&Pi(L,()=>Vn(v.id)),L},R=(m,b)=>S(m,b,{elementTag:"div",isMobile:!0});if(se!=="desktop"&&!j){l.forEach(m=>{let b=m.category||K;x.appendChild(R(m,b))}),k.appendChild(x);return}let E=new Map;l.forEach(m=>{let b=m.category||K;E.has(b)||E.set(b,[]),E.get(b).push(m)});let F=Array.from(E.entries()).sort((m,b)=>m[0].localeCompare(b[0],void 0,{sensitivity:"base"})),H=!0;F.forEach(([m,b])=>{if(m!==K){let I=document.createElement($?"li":"div");I.dataset.categoryHeading=m,$&&(I.setAttribute("role","presentation"),I.style.listStyle="none"),I.className=se==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",H||(I.style.marginTop=se==="desktop"?"1.25rem":"1rem");let B=document.createElement("div");B.setAttribute("role","heading"),B.setAttribute("aria-level","3"),B.className=se==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let v=document.createElement("span");v.textContent=m;let ne=document.createElement("span");ne.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",ne.textContent=`${b.length} ${b.length===1?"item":"items"}`,B.append(v,ne),I.appendChild(B),x.appendChild(I)}b.forEach(I=>{if(se==="desktop"){let B=S(I,m,{elementTag:$?"li":"div",isMobile:!1});x.appendChild(B);return}x.appendChild(R(I,m))}),H=!1}),k.appendChild(x),yr(),ji()}function Se(){at?.setAttribute("aria-expanded","false"),dt?.classList.add("hidden")}function _o(){at?.setAttribute("aria-expanded","true"),dt?.classList.remove("hidden")}at?.addEventListener("click",e=>{e.stopPropagation(),at.getAttribute("aria-expanded")==="true"?Se():_o()}),document.addEventListener("click",e=>{dt&&!dt.classList.contains("hidden")&&!dt.contains(e.target)&&e.target!==at&&Se()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Se()}),Lr.forEach(e=>{e.addEventListener("click",()=>{let t=$t?.classList.contains("hidden");$t?.classList.toggle("hidden"),t&&$t?.scrollIntoView({behavior:"smooth",block:"start"}),Se()})}),document.addEventListener("DOMContentLoaded",()=>{$t?.classList.add("hidden")});function Yi(){try{console.log("handleSaveAction invoked",{editingId:Ze,title:h?.value})}catch{}let t=(typeof h?.value=="string"?h.value:"").trim(),n=typeof C?.value=="string"?C.value:"",i=typeof M?.value=="string"?M.value:"",s=typeof V?.value=="string"?V.value.trim():"";if(wt==="edit"&&Ze){let u=p.find(x=>x.id===Ze);if(!u){_e();return}if(!t){D("Add a reminder title");return}let g=null;if(n||i){let x=n||cn();g=Di(x,i||"09:00")}else{let x=un(t);x.time&&(g=new Date(`${x.date}T${x.time}:00`).toISOString())}u.title=t;let A=Ut();u.priority=A,qt(A),O&&(u.category=te(O.value)),u.due=g,P&&(u.notes=P.value.trim()),u.plannerLessonId=s||null,u.updatedAt=Date.now(),ue(u),fn(u),Je=!0,Y(),nt(u),ee(),ft(),he("memoryCue:remindersUpdated",{items:p}),Ei(),xe({action:"updated",label:`Reminder updated \xB7 ${u.title}`}),_e(),D("Reminder updated"),he("cue:close",{reason:"updated"});return}if(!t){D("Add a reminder title");return}let a=P?P.value.trim():"",d=null;if(n||i){let u=n||cn();d=Di(u,i||"09:00")}else{let u=un(t);u.time&&(d=new Date(`${u.date}T${u.time}:00`).toISOString())}let l=s?{lessonId:s,dayLabel:V?.dataset?.lessonDayLabel||"",lessonTitle:V?.dataset?.lessonTitle||"",summary:V?.dataset?.lessonSummary||""}:null,f=xo({title:t,priority:Ut(),category:O?O.value:"",due:d,notes:a,plannerLessonId:s||null});f&&(l?(D("Planner reminder created"),he("planner:reminderCreated",{lessonId:l.lessonId,dayLabel:l.dayLabel,lessonTitle:l.lessonTitle,summary:l.summary,reminderId:f.id,reminderTitle:f.title,reminderDue:f.due||null})):D("Reminder created")),h&&(h.value=""),M&&(M.value=""),P&&(P.value=""),kn(),he("cue:close",{reason:"created"})}h?.addEventListener("keydown",e=>{e.key==="Enter"&&Yi()});function Ho(){if(!h||!qe)return;let e=h.value.trim();if(!e){qe.style.display="none";return}try{let t=un(e),n=cn();if(t.date!==n||t.time){let i="";if(t.date!==n){let s=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Ri(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(qe.textContent=`Parsed: ${i}`,qe.style.display="block"):qe.style.display="none"}else qe.style.display="none"}catch{qe.style.display="none"}}if(h?.addEventListener("input",To(Ho,300)),fe?.addEventListener("click",()=>{_e(),D("Edit cancelled"),he("cue:close",{reason:"edit-cancelled"})}),fr?.addEventListener("click",()=>{_e()}),document.addEventListener("cue:cancelled",()=>{_e()}),document.addEventListener("cue:prepare",e=>{let t=e?.detail?.mode==="edit"?"edit":"new";_e({resetMode:!1}),et(t,t==="edit"?rn:null)}),document.addEventListener("cue:close",()=>{et(null)}),document.addEventListener("planner:prefillReminder",e=>{Nr(e?.detail||{})}),window.addEventListener("load",()=>h?.focus()),Er?.addEventListener("click",()=>{let e=p.filter(t=>!t.done).map(t=>{let n=t.due?Ri(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(tt,{hour:"2-digit",minute:"2-digit",timeZone:De}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){D("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>D("Copied for Master Task List")).catch(()=>D("Copy failed")),Se()}),In?.addEventListener("change",()=>{let e=In.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(a=>{let d={...a,id:dn(),category:te(a.category),pendingSync:!ae,orderIndex:null};Ii(d,{position:"start"}),p=[d,...p],i.push(d)}),be(p);let s=on(p);Y(),ee(),s?p.forEach(a=>ue(a)):i.forEach(a=>ue(a)),D("Import successful")}catch{D("Invalid JSON")}},t.readAsText(e),In.value="",Se()}),Sr?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),Se()}),Tr?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){D("Add your Apps Script URL in Settings first"),Se();return}if(!p.length){D("No tasks to sync"),Se();return}D("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<p.length;i+=t){let s=p.slice(i,i+t),a=await Promise.allSettled(s.map(d=>{let l={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||K,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}));n+=a.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}D(`Sync complete: ${p.length-n} ok${n?`, ${n} failed`:""}`),Se()}),Ke&&(Ke.value=localStorage.getItem("syncUrl")||""),Ar?.addEventListener("click",()=>{Ke&&(localStorage.setItem("syncUrl",Ke.value.trim()),D("Settings saved"))}),Ir?.addEventListener("click",async()=>{if(!Ke)return;let e=Ke.value.trim();if(!e){D("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});D(t.ok?"Test ok":"Test failed")}catch{D("Test failed")}}),vr?.addEventListener("click",async()=>{if(!("Notification"in window)){D("Notifications not supported");return}if(Notification.permission==="granted"){D("Notifications enabled"),Me()?Ue():(Sn(),_i()),He(),Y();return}try{await Notification.requestPermission()==="granted"?(D("Notifications enabled"),Me()?Ue():(Sn(),_i()),He(),Y()):D("Notifications blocked")}catch{D("Notifications blocked")}}),Vi(),se==="mobile"){let e=()=>{try{kr()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return ro(),He(),Y(),ee(),se==="mobile"&&(window.setMobileRemindersFilter=Wi),{cancelReminder:pn,scheduleReminder:nt,closeActiveNotifications:ur,getActiveNotifications:()=>Fe,addNoteToReminder:ko,buildRagContext:Mn,askAssistant:yi,__testing:{setItems(e=[]){p=Array.isArray(e)?e.map(t=>({...t,category:te(t?.category)})):[],p=vt(p),be(p),Y()},render:Y,getItems:()=>p.map(e=>({...e})),parseInboxTimeQuery:Fn,buildRagContext:Mn,askAssistant:yi}}}var rr,Fe,or,zn,Jn,sr,En,Nt,Zn,K,Qo,ei,Ae,Jo,Ie,ns=Qn(()=>{Zi();rr="memoryCue:activity",Fe=new Map,or=!1,zn="service-worker.js",Jn="memory-cue-reminder-sync",sr=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),En=null,Nt=null,Zn=!1,K="General",Qo=Object.freeze([K,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),ei="memoryCue:offlineReminders",Ae=1024;Jo=Object.freeze({}),Ie=null});function bs(o){return new ri(o)}var is,rs,ri,os=Qn(()=>{is=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),rs={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},ri=class o{static activeStack=[];constructor(r={}){this.modal=r.modalElement??null,this.openButton=r.openButton??null,this.closeButton=r.closeButton??null,this.backdropButton=r.backdropButton??null,this.titleInput=r.titleInput??null,this.modalTitle=r.modalTitle??null,this.defaultTitle=r.defaultTitle??"",this.editTitle=r.editTitle??r.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=r.manageAria!==!1,this.enableFocusTrap=r.focusTrap!==!1,this.shouldAutoFocus=r.autoFocus!==!1,this.eventTarget=r.eventTarget??document,this.events={...rs,...r.events||{}},this.animationHooks=r.animationHooks??{},this.enableStacking=r.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(r={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...r}),await this.runHook("onAfterShow")}}async hide(r={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...r}),await this.runHook("onAfterHide"))}focusTitleInput(){let r=this.titleInput||this.modal?.querySelector("[autofocus]");!r||typeof r.focus!="function"||window.setTimeout(()=>{try{r.focus({preventScroll:!0})}catch{r.focus()}},50)}async restoreFocus(){let r=this.previouslyFocusedElement||this.openButton;if(r&&typeof r.focus=="function")try{r.focus({preventScroll:!0})}catch{r.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(r={}){this.isDestroyed||(await this.hide(r),this.cleanup(),this.isDestroyed=!0)}setEditMode(r=!1){this.modalTitle&&(this.modalTitle.textContent=r?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",r?"edit":"create"),this.currentMode=r?"edit":"create"}handleOpenClick(r){r.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(r){r.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(r){r.preventDefault(),this.requestClose("backdrop")}handleCancel(r){r.preventDefault(),this.requestClose("keyboard")}handleKeydown(r){this.enableFocusTrap&&r.key==="Tab"&&this.maintainFocus(r),r.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(r){if(!this.modal)return;let c=this.getFocusableElements();if(c.length===0){r.preventDefault(),this.modal.focus();return}let h=c[0],C=c[c.length-1],M=document.activeElement;r.shiftKey&&M===h?(r.preventDefault(),C.focus()):!r.shiftKey&&M===C&&(r.preventDefault(),h.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(is)).filter(r=>!(r instanceof HTMLElement)||r.hasAttribute("disabled")?!1:r.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(r){if(!r||r.detail&&r.detail.controller&&r.detail.controller!==this)return;let c=r?.detail?.mode==="edit";this.setEditMode(c),this.show({reason:r?.detail?.reason||"external-open",mode:r?.detail?.mode})}handleDocumentCloseRequest(r){if(!r||r.detail?.controller&&r.detail.controller!==this||r.detail?.initiatedBy==="controller")return;let c=r.detail?.reason||"external-close";this.hide({reason:c})}dispatchEvent(r,c={}){let h=this.events[r];if(!h||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let C=new CustomEvent(h,{detail:c,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(C)}requestClose(r){let c={reason:r,controller:this};this.dispatchEvent("cancelled",c),this.dispatchEvent("closeRequest",{...c,initiatedBy:"controller"}),this.hide({reason:r})}async runHook(r){let c=this.animationHooks?.[r];typeof c=="function"&&await c(this)}addToStack(){let r=o.activeStack,c=r.indexOf(this);c!==-1&&r.splice(c,1),r.push(this),this.stackIndex=r.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let r=o.activeStack,c=r.indexOf(this);c!==-1&&r.splice(c,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});export{us as a,Zi as b,hs as c,ns as d,ri as e,bs as f,os as g};
