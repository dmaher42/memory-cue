import{a as U,b as D}from"./chunk-PFMLOWYV.js";import{a as R,b as O}from"./chunk-ERL7JLDU.js";import{b as H}from"./chunk-RCZ4YZVR.js";var F=H(()=>{O();D();R();(function(){let n=()=>{let t=document.getElementById("create-sheet"),a=document.getElementById("closeCreateSheet");if(!(t instanceof HTMLElement)||!(a instanceof HTMLElement)){let e=typeof n._retryCount=="number"?n._retryCount:0;e<10&&(n._retryCount=e+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let f=t.querySelector("[data-dialog-content]"),m=t.querySelector(".sheet-backdrop"),o=document.getElementById("fabCreate"),c=document.getElementById("createReminderForm"),g=document.getElementById("saveReminder"),S=document.getElementById("priority"),k=document.getElementById("priorityChips"),y=k?Array.from(k.querySelectorAll('input[name="priority"]')):[],B=new Set([...o?[o]:[],...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),C=Array.from(B).filter(e=>e instanceof HTMLElement),v=()=>{t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open")};v();let p=null,T=(e,r)=>{try{document.dispatchEvent(new CustomEvent(e,{detail:r}))}catch(i){console.warn(`${e} dispatch failed`,i)}},E=()=>{let e=S?.value||"Medium";y.forEach(r=>{let i=r.value===e;r.checked=i,r.setAttribute("aria-checked",i?"true":"false")})},x=e=>{S&&(S.value!==e&&(S.value=e,S.dispatchEvent(new Event("change",{bubbles:!0}))),E())};y.forEach(e=>{e.addEventListener("change",()=>{e.checked&&x(e.value)})}),S?.addEventListener("change",E),E();let I=()=>{let e=t.querySelector('input, textarea, select, button, [contenteditable="true"]');e instanceof HTMLElement&&setTimeout(()=>{try{e.focus()}catch{}},0)},b=e=>{p=e instanceof HTMLElement?e:null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),o&&o.setAttribute("aria-expanded","true"),p&&p!==o&&p.setAttribute("aria-expanded","true"),E(),I(),T("reminder:sheet-opened",{trigger:p})},h=(e="dismissed")=>{let r=!t.classList.contains("hidden");v(),o&&o.setAttribute("aria-expanded","false"),p&&p!==o&&p.setAttribute("aria-expanded","false");let i=p&&document.body.contains(p)&&p||o;if(i&&typeof i.focus=="function")try{i.focus()}catch{}r&&T("reminder:sheet-closed",{reason:e,trigger:p}),p=null};C.forEach(e=>{e.addEventListener("click",r=>{r.preventDefault(),b(e)})}),a.addEventListener("click",e=>{e.preventDefault(),h("close-button")}),m?.addEventListener("click",e=>{e.target===m&&h("backdrop")}),t.addEventListener("keydown",e=>{e.key==="Escape"&&(e.stopPropagation(),h("escape"))}),f?.addEventListener("click",e=>{e.stopPropagation()}),t.addEventListener("click",e=>{e.target instanceof HTMLElement&&e.target.hasAttribute("data-close")&&h("backdrop")}),document.addEventListener("cue:open",e=>{E(),b(e?.detail?.trigger||null)}),document.addEventListener("cue:close",e=>{h(e?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{E()}),document.addEventListener("cue:cancelled",()=>{h("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=h),document.addEventListener("reminder:save",e=>{if(!(g instanceof HTMLElement))return;let r=e?.detail?.trigger;r&&r!==g||g.matches(":disabled")||g.click()}),c instanceof HTMLFormElement&&g instanceof HTMLElement&&c.addEventListener("submit",e=>{e.preventDefault(),!g.matches(":disabled")&&g.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var M=()=>{M._initialised||(M._initialised=!0,U({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M,{once:!0}):M();(()=>{try{let n=document.getElementById("headerActionsToggle"),t=document.getElementById("headerActionsMenu");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let a=["button","[href]",'[tabindex]:not([tabindex="-1"])'],f=()=>{for(let c of a){let g=t.querySelector(c);if(g instanceof HTMLElement&&!g.hasAttribute("disabled")){try{g.focus({preventScroll:!0})}catch{g.focus()}return}}},m=()=>{t.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),f()},o=()=>{t.classList.contains("hidden")||(t.classList.add("hidden"),n.setAttribute("aria-expanded","false"))};n.addEventListener("click",c=>{c.stopPropagation(),t.classList.contains("hidden")?m():o()}),n.addEventListener("keydown",c=>{c.key==="Escape"?(o(),n.focus({preventScroll:!0})):(c.key==="ArrowDown"||c.key==="Enter"||c.key===" ")&&t.classList.contains("hidden")&&(c.preventDefault(),m())}),t.addEventListener("click",c=>{c.target instanceof HTMLElement&&c.target.closest("button")&&o()}),document.addEventListener("click",c=>{c.target instanceof Node&&(t.contains(c.target)||c.target===n)||o()}),document.addEventListener("keydown",c=>{c.key==="Escape"&&o()})}catch(n){console.error("[headerActions] init failed",n)}})();(()=>{let n=document.getElementById("toggleReminderFilters"),t=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let a=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],f=()=>{let o=t.hasAttribute("open");n.setAttribute("aria-expanded",String(o)),n.classList.toggle("btn-active",o)},m=()=>{for(let o of a){let c=t.querySelector(o);if(c instanceof HTMLElement&&!c.hasAttribute("disabled")){try{c.focus({preventScroll:!0})}catch{c.focus()}return}}};n.addEventListener("click",()=>{let o=t.hasAttribute("open");t.open=!o,o||m(),f()}),t.addEventListener("toggle",f),f()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let a=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(a)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let a=document.createElement("div");a.textContent="Save clicked",a.style.position="fixed",a.style.right="16px",a.style.bottom="16px",a.style.background="rgba(34,197,94,0.95)",a.style.color="#fff",a.style.padding="8px 12px",a.style.borderRadius="8px",a.style.zIndex="99999",document.body.appendChild(a),setTimeout(()=>a.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let a=20;n.innerHTML="";let f=0;function m(){let g=t.slice(f,f+a);g.forEach(S=>n.appendChild(S)),f+=g.length}m();let o=document.createElement("div");o.id="listSentinel",n.appendChild(o);let c=new IntersectionObserver(g=>{g.some(S=>S.isIntersecting)&&f<t.length&&(m(),f>=t.length&&c.disconnect())});c.observe(o)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),a=document.getElementById("closeSettings");if(!n||!t||!a)return;function f(){t.classList.remove("hidden")}function m(){t.classList.add("hidden")}n.addEventListener("click",f),a.addEventListener("click",m),t.addEventListener("click",o=>{o.target instanceof HTMLElement&&o.target.matches("[data-close]")&&m()}),t.addEventListener("keydown",o=>{o.key==="Escape"&&m()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),a=document.getElementById("saveSyncSettings"),f=document.getElementById("testSync"),m=document.getElementById("syncAll"),o="syncUrl";if(!n)return;let c=["online","error"],g={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},S={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},k=null;function y(e,r){k=e,c.forEach(d=>n.classList.remove(d)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let i=typeof r=="string"&&r.trim()?r.trim():g[e]||"",l=typeof r=="string"&&r.trim()?r.trim():S[e]||i;n.textContent=l,i?(n.setAttribute("title",i),l!==i?n.setAttribute("aria-label",i):n.removeAttribute("aria-label")):(n.removeAttribute("title"),n.removeAttribute("aria-label")),n.dataset.state=e}function B(){k!=="syncing"&&(navigator.onLine?k!=="online"&&y("online"):y("offline"))}function C(e){typeof localStorage>"u"||(e?localStorage.setItem(o,e):localStorage.removeItem(o))}function v(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(o)||""}catch{return""}}function p(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,i=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!i)return null;let l=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,d=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",u=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",s=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:i,dueIso:l&&l.trim()?l.trim():null,priority:d,category:u,done:s}}function T(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let i=r.dataset||{},l=null;if(i.reminder)try{l=JSON.parse(i.reminder)}catch{l=null}let d=l||{id:i.id||i.reminderId||r.getAttribute("data-id")||null,title:i.title||i.reminderTitle||"",dueIso:i.due||i.reminderDue||r.getAttribute("data-due")||null,priority:i.priority||i.reminderPriority||r.getAttribute("data-priority")||"",category:i.category||i.reminderCategory||r.getAttribute("data-category")||"",done:i.done==="true"||i.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!d.title){let u=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");u&&(d.title=u.textContent.trim())}if(!d.dueIso){let u=r.querySelector("[data-due], time");if(u){let s=u.getAttribute("datetime")||u.getAttribute("data-due");d.dueIso=s||u.textContent.trim()}}return p(d)}).filter(Boolean):[]}function E(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(l=>{if(!r.has(l)){r.add(l);try{let d=localStorage.getItem(l);if(!d)return;let u=JSON.parse(d);Array.isArray(u)?u.forEach(s=>e.push(s)):u&&typeof u=="object"&&(Array.isArray(u.items)&&u.items.forEach(s=>e.push(s)),Array.isArray(u.reminders)&&u.reminders.forEach(s=>e.push(s)))}catch{}}}),!e.length)for(let l=0;l<localStorage.length;l+=1){let d=localStorage.key(l);if(!(!d||r.has(d)||!/remind/i.test(d))){r.add(d);try{let u=localStorage.getItem(d);if(!u)continue;let s=JSON.parse(u);Array.isArray(s)?s.forEach(A=>e.push(A)):s&&typeof s=="object"&&(Array.isArray(s.items)&&s.items.forEach(A=>e.push(A)),Array.isArray(s.reminders)&&s.reminders.forEach(A=>e.push(A)))}catch{}}}return e.map(p).filter(Boolean)}function x(){let e=T();return e.length?e:E()}function I(e){e?(m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled"),f?.setAttribute("aria-busy","true"),f?.setAttribute("disabled","disabled")):(m?.removeAttribute("aria-busy"),f?.removeAttribute("aria-busy"),b())}function b(){!!((t?.value||"").trim()||v())?(m?.removeAttribute("disabled"),f?.removeAttribute("disabled")):(m?.setAttribute("disabled","disabled"),f?.setAttribute("disabled","disabled"))}let h=v();t&&h&&(t.value=h),b(),y(navigator.onLine?"online":"offline"),window.addEventListener("online",B),window.addEventListener("offline",B),t?.addEventListener("input",b),a?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){C(""),y("info","Sync URL cleared. Add one to enable sync."),b();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{y("error","Enter a valid sync URL before saving.");return}C(e),y("online","Sync settings saved."),b()}),f?.addEventListener("click",async()=>{let e=(t?.value||v()).trim();if(!e){y("error","Add your sync URL in Settings first.");return}I(!0),y("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?y("online","Connection looks good."):y("error","Test failed. Check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),y("error","Test failed. Check your Apps Script deployment.")}finally{I(!1)}}),m?.addEventListener("click",async()=>{let e=(t?.value||v()).trim();if(!e){y("error","Add your sync URL in Settings first.");return}let r=x();if(!r.length){y("info","Nothing to sync right now.");return}I(!0),y("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let i=20,l=0,d=0,u=s=>({id:s.id,title:s.title,dueIso:s.dueIso||null,priority:s.priority||"Medium",category:s.category||"General",done:!!s.done,source:"memory-cue-mobile"});try{for(let s=0;s<r.length;s+=i){let A=r.slice(s,s+i);(await Promise.allSettled(A.map(L=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u(L))})))).forEach(L=>{L.status==="fulfilled"&&L.value?.ok?l+=1:(L.status,d+=1)}),await new Promise(L=>setTimeout(L,300))}d?l?y("error",`Partial sync: ${l} success, ${d} failed.`):y("error","Sync failed. Check your sync URL and retry."):y("online",`Sync complete. ${l} updated.`)}catch(s){console.error("Sync failed",s),y("error","Sync failed. Try again soon.")}finally{I(!1)}})})()});export default F();
