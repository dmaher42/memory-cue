import{a as bt,b as Jt,c as Et,d as Kt,e as Se,g as Qt}from"./chunk-NQOL4S2N.js";import{a as gt,b as Wt}from"./chunk-MG4MJA24.js";import{b as ht,c as Gt}from"./chunk-CTK42JWW.js";import{b as pt,c as jt}from"./chunk-GUVSRPRW.js";var ve,xe,Xt,fe,ze,vt,At,Lt,Ve,wt,ae,Fe,St,Zt,Z,K,Ye,U,me,Ae,Ct,ye=pt(()=>{ve="memoryCueNotes",xe="memoryCueFolders",Xt=["mobileNotes"],fe=()=>typeof localStorage<"u",ze=null,vt=n=>{ze=typeof n=="function"?n:null},At=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Lt=n=>{if(typeof n!="string")return"";let e=n.trim();return e.length?(/[<>]/.test(e),n):""},Ve=n=>{if(typeof n!="string")return"";let e=n.trim();return e.length?/[<>]/.test(e)?n:Lt(n):""},wt=n=>{if(typeof n!="string")return!1;let e=Date.parse(n);return!Number.isNaN(e)},ae=(n,e,i={})=>{let l=typeof n=="string"?n.trim():"";return{id:i.id&&typeof i.id=="string"?i.id:At(),title:l||"Untitled note",body:Ve(e),updatedAt:i.updatedAt&&wt(i.updatedAt)?i.updatedAt:new Date().toISOString(),folderId:i.folderId&&typeof i.folderId=="string"?i.folderId:null}},Fe=n=>{if(Array.isArray(n))return n.map(e=>{if(!e||typeof e!="object")return null;let i=typeof e.title=="string"?e.title.trim():"",l=Ve(e.body),m=typeof e.id=="string"&&e.id.trim()?e.id:At(),c=wt(e.updatedAt)?e.updatedAt:new Date().toISOString();return!i&&!l&&!e.body?null:{id:m,title:i||"Untitled note",body:l,updatedAt:c,folderId:typeof e.folderId=="string"&&e.folderId?e.folderId:null}}).filter(Boolean);if(n&&typeof n=="object"){let e=typeof n.title=="string"?n.title:"",i=typeof n.body=="string"?n.body:"",l=Ve(i);return!e&&!l?[]:[ae(e,l,{id:typeof n.id=="string"?n.id:void 0,updatedAt:typeof n.updatedAt=="string"?n.updatedAt:void 0,folderId:typeof n.folderId=="string"?n.folderId:void 0})]}return typeof n=="string"&&n.trim().length?[ae("Notebook (legacy)",Lt(n))]:[]},St=n=>{if(!fe())return null;try{return localStorage.getItem(n)}catch{return null}},Zt=n=>{if(fe())try{localStorage.removeItem(n)}catch{}},Z=()=>{if(!fe())return[];let n=St(ve);if(typeof n=="string")try{let e=JSON.parse(n),i=Fe(e);if(i.length)return i}catch{let e=Fe(n);if(e.length)return K(e),e}for(let e of Xt){let i=St(e);if(typeof i=="string"&&i.trim().length){let l=Fe(i);if(l.length)return K(l),Zt(e),l}}return[]},K=(n,e={})=>{if(!fe()||!Array.isArray(n))return!1;let i=n.map(l=>{let c=Fe([l])[0];return c&&(c.folderId=typeof l.folderId=="string"&&l.folderId?l.folderId:c.folderId||null),c}).filter(Boolean);try{if(localStorage.setItem(ve,JSON.stringify(i)),!e.skipRemoteSync&&typeof ze=="function")try{let l=ze(i);l&&typeof l.then=="function"&&l.catch(m=>{console.error("[notes-storage] Remote sync failed.",m)})}catch(l){console.error("[notes-storage] Remote sync handler threw.",l)}return!0}catch{return!1}},Ye=()=>[{id:"unsorted",name:"Unsorted"}],U=()=>{if(!fe())return Ye();try{let e=localStorage.getItem(xe);if(typeof e=="string"){let i=JSON.parse(e);if(Array.isArray(i)&&i.length){let l=!1,m=i.map((c,y)=>{let b=String(c.id),D=typeof c.name=="string"?c.name:String(c.id),H=typeof c.order=="number"?c.order:y;return typeof c.order!="number"&&(l=!0),{id:b,name:D,order:H}});if(l)try{localStorage.setItem(xe,JSON.stringify(m))}catch{}return m}}}catch{}let n=Ye();try{localStorage.setItem(xe,JSON.stringify(n))}catch{}return n},me=n=>{let i=U().find(l=>l&&String(l.id)===String(n));return i?String(i.name):"Unsorted"},Ae=n=>{if(!fe()||!Array.isArray(n))return!1;try{let e=n.filter(i=>i&&typeof i.id=="string"&&i.id.trim()).map((i,l)=>({id:i.id,name:typeof i.name=="string"?i.name:String(i.id),order:typeof i.order=="number"?i.order:l}));return e.length||e.push(...Ye()),localStorage.setItem(xe,JSON.stringify(e)),!0}catch{return!1}},Ct=(n,e)=>{if(!n||typeof n!="string")return!1;let i=Z(),l=!1,m=i.map(y=>y.id===n?(l=!0,{...y,folderId:e&&typeof e=="string"?e:null,updatedAt:new Date().toISOString()}):y);return l?K(m):!1}});var en,tn,nn,De,on,rn,It,Bt=pt(()=>{Gt();ye();en="notes",tn="user_id",nn="updated_at",De=n=>{if(typeof n!="string")return 0;let e=Date.parse(n);return Number.isNaN(e)?0:e},on=(n=[],e=[])=>{let i=new Map;return e.forEach(l=>{l&&typeof l.id=="string"&&i.set(l.id,l)}),n.forEach(l=>{if(!l||typeof l.id!="string")return;let m=i.get(l.id);if(!m){i.set(l.id,l);return}let c=De(l.updatedAt),y=De(m.updatedAt);c>y&&i.set(l.id,l)}),Array.from(i.values()).sort((l,m)=>De(m?.updatedAt)-De(l?.updatedAt))},rn=n=>e=>{if(!e||typeof e!="object")return null;let i={id:typeof e.id=="string"&&e.id?e.id:void 0,updatedAt:typeof e[n]=="string"?e[n]:void 0,folderId:typeof e.folder_id=="string"&&e.folder_id?e.folder_id:void 0};return ae(e.title,e.body,i)},It=(n={})=>{let{tableName:e=en,userColumn:i=tn,updatedAtColumn:l=nn,supabase:m=null}=n,c=m||null,y=null,b=!1,D=new Set,H=()=>c||(c=ht(),c),O=rn(l),S=async g=>{let M=H();if(!M||!y)return;let P=(Array.isArray(g)?g.filter(A=>A&&typeof A.id=="string"):[]).map(A=>({id:A.id,[i]:y,title:A.title,body:A.body,folder_id:typeof A.folderId=="string"&&A.folderId?A.folderId:null,[l]:typeof A.updatedAt=="string"&&A.updatedAt?A.updatedAt:new Date().toISOString()})),V=new Set(P.map(A=>A.id));if(P.length){let{error:A}=await M.from(e).upsert(P);if(A)throw A}let Y=[...D].filter(A=>A&&!V.has(A));if(Y.length){let{error:A}=await M.from(e).delete().in("id",Y).eq(i,y);if(A)throw A}D=new Set(V)},x=async()=>{let g=H();if(!(!g||!y))try{let{data:M,error:_}=await g.from(e).select(`id,title,body,folder_id,${l}`).eq(i,y);if(_)throw _;let P=Array.isArray(M)?M:[];D=new Set(P.map(L=>typeof L.id=="string"?L.id:null).filter(Boolean));let V=P.map(O).filter(Boolean),Y=Z();if(!V.length){if(Y.length)try{await S(Y)}catch(L){console.error("[notes-sync] Failed to upload local notes to Supabase.",L)}return}let A=on(Y,V);b=!0;let f=K(A,{skipRemoteSync:!0});b=!1,f||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await S(A)}catch(L){console.error("[notes-sync] Failed to reconcile notes with Supabase.",L)}}catch(M){console.error("[notes-sync] Failed to fetch notes from Supabase.",M)}finally{b=!1}};return vt(async g=>{if(!b)try{await S(g)}catch(M){console.error("[notes-sync] Failed to sync notes to Supabase.",M)}}),{setSupabaseClient(g){g&&(c=g)},handleSessionChange:async g=>{if(y=typeof g?.id=="string"?g.id:null,!y){D=new Set;return}await x()},syncFromRemote:x}}});var sn=jt(()=>{Wt();Kt();Jt();ye();ye();ye();Bt();Qt();ye();gt();(function(){let n=()=>{let e=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(i instanceof HTMLElement)){let f=typeof n._retryCount=="number"?n._retryCount:0;f<10&&(n._retryCount=f+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let l=e.querySelector("[data-dialog-content]"),m=e.querySelector(".sheet-backdrop"),c=document.getElementById("createReminderForm"),y=document.getElementById("saveReminder"),b=document.getElementById("priority"),D=document.getElementById("priorityChips"),H=D?Array.from(D.querySelectorAll('input[name="priority"]')):[],O=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),S=Array.from(O).filter(f=>f instanceof HTMLElement),x=S[0]||null,$=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};$();let g=null,M=(f,L)=>{try{document.dispatchEvent(new CustomEvent(f,{detail:L}))}catch(C){console.warn(`${f} dispatch failed`,C)}},_=()=>{let f=b?.value||"Medium";H.forEach(L=>{let C=L.value===f;L.checked=C,L.setAttribute("aria-checked",C?"true":"false")})},P=f=>{b&&(b.value!==f&&(b.value=f,b.dispatchEvent(new Event("change",{bubbles:!0}))),_())};H.forEach(f=>{f.addEventListener("change",()=>{f.checked&&P(f.value)})}),b?.addEventListener("change",_),_();let V=()=>{let f=e.querySelector('input, textarea, select, button, [contenteditable="true"]');f instanceof HTMLElement&&setTimeout(()=>{try{f.focus()}catch{}},0)},Y=f=>{g=f instanceof HTMLElement?f:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),g&&g.setAttribute("aria-expanded","true"),_(),V(),M("reminder:sheet-opened",{trigger:g})},A=(f="dismissed")=>{let L=!e.classList.contains("hidden");$(),g&&g.setAttribute("aria-expanded","false");let C=g&&document.body.contains(g)&&g||x;if(C&&typeof C.focus=="function")try{C.focus()}catch{}L&&M("reminder:sheet-closed",{reason:f,trigger:g}),g=null};S.forEach(f=>{f.addEventListener("click",L=>{L.preventDefault();let C={mode:"create",trigger:f};M("cue:prepare",C),M("cue:open",C)})}),i.addEventListener("click",f=>{f.preventDefault(),A("close-button")}),m?.addEventListener("click",f=>{f.target===m&&A("backdrop")}),e.addEventListener("keydown",f=>{f.key==="Escape"&&(f.stopPropagation(),A("escape"))}),l?.addEventListener("click",f=>{f.stopPropagation()}),e.addEventListener("click",f=>{f.target instanceof HTMLElement&&f.target.hasAttribute("data-close")&&A("backdrop")}),document.addEventListener("cue:open",f=>{_(),Y(f?.detail?.trigger||null)}),document.addEventListener("cue:close",f=>{A(f?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{_()}),document.addEventListener("cue:cancelled",()=>{A("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=A),document.addEventListener("reminder:save",f=>{if(!(y instanceof HTMLElement))return;let L=f?.detail?.trigger;L&&L!==y||y.matches(":disabled")||y.click()}),c instanceof HTMLFormElement&&y instanceof HTMLElement&&c.addEventListener("submit",f=>{f.preventDefault(),!y.matches(":disabled")&&y.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var Me=()=>{Me._initialised||(Me._initialised=!0,Et({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Me,{once:!0}):Me();var Nt=()=>{let n=document.getElementById("notifHeaderBtn"),e=document.getElementById("notifBtn");n&&e&&n.addEventListener("click",()=>{e.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Nt,{once:!0}):Nt();var Tt=()=>{if(typeof document>"u")return;let n=document.getElementById("noteTitleMobile"),e=document.getElementById("scratchNotesEditor"),i=document.getElementById("noteSaveMobile"),l=document.getElementById("noteNewMobile"),m=document.getElementById("notesListMobile"),c=document.getElementById("notesCountMobile"),y=document.getElementById("notebook-search-input"),b=document.getElementById("savedNotesSheet"),D=document.getElementById("openSavedNotesSheet"),H=document.querySelector('[data-action="close-saved-notes"]'),O="shadow-[0_0_0_3px_var(--accent-color)]",x=(()=>{if(!e)return null;let t=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return t?new t("#scratchNotesEditor",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.dataset.placeholder="Start typing your note\u2026",{element:e,setContent(o=""){e.innerHTML=o||""},getHTML(){return e.innerHTML||""},getText(){return e.textContent||""},focus(){try{e.focus()}catch{}}})})();if(!n||!x||!e||!i)return;let $=document.getElementById("scratchNotesToolbar");$&&e&&$.addEventListener("click",t=>{let o=t.target.closest("button[data-format]");if(!o)return;let r=o.getAttribute("data-format");try{e.focus()}catch{}switch(r){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"ul":document.execCommand("insertUnorderedList",!1,null);break;case"ol":document.execCommand("insertOrderedList",!1,null);break;default:break}});let g=(t="")=>{if(x&&typeof x.setContent=="function"){x.setContent(t||"");return}e.innerHTML=t||""},M=()=>x&&typeof x.getHTML=="function"?x.getHTML()||"":e.innerHTML||"",_=()=>x&&typeof x.getText=="function"?x.getText()||"":e.textContent||"",P=t=>{let o=t;for(;o&&o!==e;){if(o.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(o.tagName?.toLowerCase()))return o;o=o.parentNode}return e},V=t=>{if(typeof t!="string")return null;let o=t.replace(/\u00a0/g," ").trim();return o==="*"?"ul":o==="1"?"ol":null},Y=t=>{if(![" ","Enter"].includes(t.key))return;let o=window.getSelection();if(!o||o.rangeCount===0)return;let r=o.getRangeAt(0);if(!e.contains(r.startContainer))return;let s=P(r.startContainer),a=r.cloneRange();a.selectNodeContents(s),a.setEnd(r.startContainer,r.startOffset);let u=V(a.toString());if(!u)return;t.preventDefault();let k=(s.textContent||"").replace(/^\s*[\*1]\s?/,"");s.textContent=k;let I=s.firstChild||s,h=document.createRange();h.setStart(I,(I.nodeType===Node.TEXT_NODE,0)),h.collapse(!0),o.removeAllRanges(),o.addRange(h);try{e.focus()}catch{}document.execCommand(u==="ul"?"insertUnorderedList":"insertOrderedList",!1,null)},A=(t,o=200)=>{let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>{t(...s)},o)}},f=null,L=[],C="all",z="unsorted",d="",v=!1,B=null,F=()=>{d="",y&&(y.value="")},N=()=>b?.dataset.open==="true",T=()=>{if(b){B&&(clearTimeout(B),B=null),b.classList.remove("hidden"),b.dataset.open="true",b.setAttribute("aria-hidden","false");try{X()}catch{}try{se()}catch{}}},w=()=>{b&&(b.dataset.open="false",b.setAttribute("aria-hidden","true"),B&&clearTimeout(B),B=setTimeout(()=>{b?.classList.add("hidden")},200))};(()=>{b&&(D?.addEventListener("click",t=>{t.preventDefault(),T();let o=document.getElementById("notesListMobile");o&&(o.scrollTop=0)}),H?.addEventListener("click",t=>{t.preventDefault(),w()}),b.addEventListener("click",t=>{t.target===b&&w()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&N()&&w()}))})();let Oe=()=>typeof d=="string"?d.trim().toLowerCase():"",G=(t=L)=>{if(!Array.isArray(t))return[];let o=Oe();return o?t.filter(r=>{let s=typeof r?.title=="string"?r.title.toLowerCase():"",a=typeof r?.body=="string"?r.body.toLowerCase():"";return s.includes(o)||a.includes(o)}):[...t]},Ge=(t=L)=>{if(!Array.isArray(t))return[];let o;return C===null||C==="all"?o=[...t]:C==="unsorted"?o=t.filter(r=>!r.folderId||r.folderId==="unsorted"):o=t.filter(r=>r.folderId===C),G(o)},kt=(t=[],o=[])=>{let r={all:Array.isArray(t)?t.length:0,unsorted:0};return(Array.isArray(o)?o:[]).forEach(s=>{s&&s.id&&s.id!=="unsorted"&&(r[s.id]=0)}),(Array.isArray(t)?t:[]).forEach(s=>{let a=s?.folderId||"unsorted";!a||a==="unsorted"?r.unsorted+=1:Object.prototype.hasOwnProperty.call(r,a)?r[a]+=1:r.unsorted+=1}),r},ee=t=>{if(!t){f=null,n.value="",g(""),delete n.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;let a=document.getElementById("note-folder-label");a&&(a.textContent=me(z||"unsorted"));return}f=t.id;let o=t.title||"",r=t.body||"";n.value=o,g(r),n.dataset.noteOriginalTitle=o,e.dataset.noteOriginalBody=r,z=t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted";let s=document.getElementById("note-folder-label");s&&(s.textContent=me(z))},xt=()=>({title:typeof n.value=="string"?n.value.trim():"",body:M()}),pe=()=>{if(!m)return;m.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(o=>{if(!(o instanceof HTMLElement))return;let r=o.getAttribute("data-note-id")===f;r?o.setAttribute("data-state","active"):o.removeAttribute("data-state"),o.classList.toggle("active",r),o.classList.toggle("outline",r),o.classList.toggle("outline-2",r),o.classList.toggle("outline-accent",r),o.classList.toggle(O,r),o.setAttribute("aria-current",r?"true":"false")})},Ft=t=>{if(!t)return"";let o=new Date(t);if(Number.isNaN(o.getTime()))return"";let r=new Date,s=o.getFullYear()===r.getFullYear()&&o.getMonth()===r.getMonth()&&o.getDate()===r.getDate(),a=o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return s?`Today \xB7 ${a}`:`${o.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${a}`},Re=()=>{let t=typeof n.value=="string"?n.value:"",o=M(),r=n.dataset.noteOriginalTitle??"",s=e.dataset.noteOriginalBody??"";return t!==r||o!==s},Dt=()=>{let t=Z();return Array.isArray(t)?[...t].sort((o,r)=>{let s=Date.parse(o?.updatedAt||""),a=Date.parse(r?.updatedAt||"");return(Number.isNaN(a)?0:a)-(Number.isNaN(s)?0:s)}):[]},Ue=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(ve)}catch{return null}},ge=Ue(),Le=()=>(ge=Ue(),ge),de=({preserveDraft:t=!0}={})=>{let o=Dt();L=Array.isArray(o)?[...o]:[];try{X()}catch{}let r=t&&Re(),s=L.length>0,a=Ge();if(Ke(a),!s)return r||ee(null),pe(),Le(),v=!1,a;if(f){let u=L.find(p=>p.id===f)||null;u?r||ee(u):(f=null,!r&&!v&&L[0]&&ee(L[0]))}else!r&&!v&&L[0]&&ee(L[0]);return v=!1,pe(),Le(),a},Je=t=>{if(!t)return;let o=Z();if(!Array.isArray(o))return;let r=o.filter(s=>s.id!==t);r.length!==o.length&&(K(r),Le(),f===t&&(ee(null),v=!0),de({preserveDraft:!1}))},Ke=(t=[])=>{if(!m)return t;if(m.innerHTML="",c){let o=L.length,r=t.length;c.textContent=o?`${r} of ${o} saved`:"No saved notes yet"}if(!t.length){let o=!!Oe(),a=o?"No notes match this filter":!C||C==="all"?"You don't have any notes yet.":C&&C!=="all"&&C!=="unsorted"?"No notes in this folder yet.":"No notes here yet",u=o?"Try adjusting your search or filters.":"Create your first note in this folder to get started.";return m.innerHTML=`
        <div class="notebook-empty-state">
          <h3 class="notebook-empty-title">${a}</h3>
          <p class="notebook-empty-body">${u}</p>
        </div>
      `,t}return t.forEach(o=>{let r=document.createElement("li");r.className="note-item-mobile w-full";let s=document.createElement("button");s.type="button",s.dataset.noteId=o.id,s.dataset.role="open-note",s.className="saved-note-item note-list-item w-full text-left active:scale-[0.99] focus:outline-none";let a=document.createElement("div");a.className="flex items-center justify-between gap-2";let u=document.createElement("div");u.className="flex items-center gap-2";let p=document.createElement("span");p.className="saved-note-title note-list-title truncate";let k=o.title||"Untitled";p.textContent=k,p.setAttribute("title",k);let I=document.createElement("span");I.className="note-folder-badge";let h=o.folderId&&typeof o.folderId=="string"?o.folderId:"unsorted";I.textContent=me(h);let E=document.createElement("span");E.className="saved-note-meta note-list-meta";let q=o.updatedAt||o.modifiedAt||o.createdAt||"";E.textContent=q?Ft(q):"";let R=document.createElement("button");R.type="button",R.dataset.noteId=o.id,R.dataset.role="note-menu",R.className="btn btn-ghost btn-xs rounded-full text-base-content/80 hover:bg-base-100",R.setAttribute("aria-label","Note actions"),R.textContent="\u22EF";let J=document.createElement("div");J.className="flex items-center gap-1",J.appendChild(E),J.appendChild(R),u.appendChild(p),u.appendChild(I),a.appendChild(u),a.appendChild(J);let Ee=document.createElement("p");Ee.className="saved-note-preview note-list-preview line-clamp-2";let W=o.body||"",$e=String(W).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();Ee.textContent=$e||"No content yet.",s.appendChild(a),s.appendChild(Ee);let le=document.createElement("button");le.type="button",le.dataset.noteId=o.id,le.dataset.role="delete-note",le.className="delete-note-btn btn btn-ghost btn-xs text-error shrink-0 focus-visible:outline-none focus-visible:ring-0",le.setAttribute("aria-label","Delete note"),le.textContent="\u2715";let ke=document.createElement("div");ke.className="flex items-start justify-between gap-3",ke.appendChild(s),ke.appendChild(le),r.appendChild(ke),m.appendChild(r)}),pe(),t},Qe=()=>document.getElementById("notebook-folder-bar"),Xe=t=>{let o=Qe();if(!o)return;o.querySelectorAll(".notebook-folder-chip").forEach(s=>{let a=String(s.dataset.folderId)===String(t);if(s.classList.toggle("notebook-folder-chip--active",a),s.classList.toggle("active",a),a)try{s.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}catch{try{s.scrollIntoView()}catch{}}})},X=()=>{let t=Qe();if(!t)return;t.innerHTML="";let o=[];try{o=Array.isArray(U())?U():[]}catch{o=[]}let r=Array.isArray(o)?o.filter(Boolean):[],s=r.find(h=>h&&h.id==="unsorted")||{id:"unsorted",name:"Unsorted"},a=r.filter(h=>h&&h.id!=="unsorted").sort((h,E)=>String(h.name||"").localeCompare(String(E.name||""),void 0,{sensitivity:"base"})),u=[s,...a],p=kt(L,u);[{id:"all",name:"All",isVirtual:!0},{...s,isVirtual:!1},...a.map(h=>({...h,isVirtual:!1}))].forEach(h=>{let E=document.createElement("button");if(E.type="button",E.className="folder-chip notebook-folder-chip",E.dataset.folderId=h.id,h.id!=="all"&&h.id!=="unsorted"){let W=document.createElement("span");W.className="notebook-folder-chip-grip",W.setAttribute("aria-hidden","true"),E.appendChild(W)}let q=document.createElement("span");q.className="notebook-folder-chip-label",q.textContent=h.name,E.appendChild(q);let R=document.createElement("span");R.className="notebook-folder-chip-count";let J=h.id==="all"?"all":h.id||"unsorted",Ee=typeof p[J]=="number"?p[J]:0;if(R.textContent=Ee,E.appendChild(R),E.addEventListener("click",()=>{C=h.id==="all"?"all":h.id,Xe(C),F(),se()}),h.id!=="all"&&h.id!=="unsorted"){let W=document.createElement("button");W.type="button",W.className="notebook-folder-chip-overflow",W.setAttribute("aria-label","Folder options"),W.innerHTML="\u22EF",W.addEventListener("click",$e=>{$e.stopPropagation(),Ht(h.id,E)}),E.appendChild(W)}t.appendChild(E)});let I=document.createElement("button");I.type="button",I.className="folder-chip outlined notebook-folder-chip notebook-folder-chip--new",I.dataset.folderId="new-folder",I.textContent="+ New folder",I.addEventListener("click",h=>{h.preventDefault();try{Ot()}catch(E){console.warn("[notebook] failed to open new folder dialog",E)}}),t.appendChild(I),Xe(C)},ln=()=>{try{X()}catch(t){console.warn("[notebook] Unable to build folder bar",t)}},Ze=document.getElementById("newFolderModal"),te=document.getElementById("newFolderName"),ce=document.getElementById("newFolderError"),et=document.getElementById("newFolderCreate"),Mt=document.getElementById("newFolderCancel"),we=null,tt=()=>{ce&&(ce.classList.add("sr-only"),ce.textContent="")},_e=t=>{ce&&(ce.textContent=t,ce.classList.remove("sr-only"))},Ot=()=>{Ze&&(we||(we=new Se({modalElement:Ze,closeButton:Mt,titleInput:te,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),tt(),te&&(te.value=""),we.show())},nt=()=>{if(!te)return;let o=String(te.value||"").trim();if(tt(),!o.length){_e("Folder name can't be empty.");return}let r=[];try{r=Array.isArray(U())?U():[]}catch{r=[]}if(r.some(I=>String(I.name).toLowerCase()===o.toLowerCase())){_e("You already have a folder with this name.");return}let a=`folder-${Date.now().toString(36)}`,u={id:a,name:o},p=[...r.filter(Boolean),u];if(!Ae(p)){_e("Unable to create folder. Please try again.");return}try{we.requestClose("created")}catch{}C=a,F();try{X()}catch(I){console.warn("[notebook] rebuild folder chips failed",I)}se()};et&&et.addEventListener("click",t=>{t.preventDefault(),nt()}),te&&te.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),nt())});let ot=document.getElementById("pickFolderModal"),He=document.getElementById("pickFolderList"),rt=document.getElementById("pickFolderConfirm"),Rt=document.getElementById("pickFolderCancel"),Ce=null,ne=null,Ie=null,it=(t={})=>{let{initialFolderId:o=null,onConfirm:r=null}=t||{};if(!ot||!He)return;ne=(o&&typeof o=="string"?o:z)||"unsorted",Ie=typeof r=="function"?r:null,He.innerHTML="";let s=[];try{s=Array.isArray(U())?U():[]}catch{s=[]}s.some(a=>a&&a.id==="unsorted")||s.unshift({id:"unsorted",name:"Unsorted"}),s.forEach(a=>{let u=document.createElement("div");u.className="flex items-center gap-3 p-2 rounded-md hover:bg-base-100";let p=document.createElement("input");p.type="radio",p.name="pick-folder",p.value=a.id,p.id=`pick-folder-${a.id}`,(String(a.id)===String(ne)||!ne&&a.id==="unsorted")&&(p.checked=!0,ne=a.id),p.addEventListener("change",()=>{ne=p.value});let I=document.createElement("label");I.setAttribute("for",p.id),I.textContent=a.name,u.appendChild(p),u.appendChild(I),He.appendChild(u)}),Ce||(Ce=new Se({modalElement:ot,closeButton:Rt,titleInput:null,autoFocus:!0})),Ce.show()};rt&&rt.addEventListener("click",t=>{if(t.preventDefault(),!ne)return;let o=ne;if(Ie){try{Ie(o)}catch(r){console.warn("[notebook] folder pick handler failed",r)}Ie=null}else{z=o==="unsorted"?"unsorted":o;let r=document.getElementById("note-folder-label");r&&(r.textContent=me(z))}try{Ce.requestClose("selected")}catch{}});let st=document.getElementById("note-folder-button");st&&st.addEventListener("click",t=>{t.preventDefault(),it()});let oe=null,j=()=>{oe&&oe.parentNode&&oe.parentNode.removeChild(oe),oe=null,document.removeEventListener("click",j),document.removeEventListener("keydown",qe)},qe=t=>{t.key==="Escape"&&j()},Ut=(t,o)=>{if(!(!t||!Ct(t,o==="unsorted"?null:o))){try{de({preserveDraft:!0})}catch(a){console.warn("[notebook] failed to refresh notes after move",a)}try{X()}catch(a){console.warn("[notebook] failed to refresh folder chips after move",a)}j()}},_t=(t,o)=>{if(!t||!o)return;j();let r=document.createElement("div");r.className="memory-glass-card p-2 rounded-2xl shadow-xl backdrop-blur-md border border-base-200/80",r.style.position="absolute",r.style.zIndex=1200,r.style.minWidth="180px";let s=document.createElement("button");s.type="button",s.className="w-full text-left px-3 py-2 btn-ghost rounded-xl",s.textContent="Move to folder\u2026",s.addEventListener("click",u=>{u.preventDefault(),it({initialFolderId:t.folderId&&typeof t.folderId=="string"?t.folderId:"unsorted",onConfirm:p=>Ut(t.id,p)})});let a=document.createElement("button");a.type="button",a.className="w-full text-left px-3 py-2 btn-ghost text-error rounded-xl",a.textContent="Delete note",a.addEventListener("click",u=>{u.preventDefault();let p=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(p?p("Delete this note? This cannot be undone."):!0)&&Je(t.id),j()}),r.appendChild(s),r.appendChild(a),document.body.appendChild(r),oe=r;try{let u=o.getBoundingClientRect(),p=u.bottom+window.scrollY+6,k=u.right+window.scrollX-r.offsetWidth;r.style.top=`${p}px`,r.style.left=`${k}px`}catch{r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}document.addEventListener("click",j),document.addEventListener("keydown",qe)},lt=(t,o)=>{if(!t||o!==-1&&o!==1)return;let r=[];try{r=Array.isArray(U())?U().slice():[]}catch{r=[]}if(!r.length)return;let s=r.filter(E=>E&&E.id!=="unsorted");s.sort((E,q)=>(Number(E.order)||0)-(Number(q.order)||0));let a=s.findIndex(E=>String(E.id)===String(t));if(a===-1)return;let u=a+o;if(u<0||u>=s.length)return;let p=s[a].order;s[a].order=s[u].order,s[u].order=p;let h=[r.find(E=>E&&E.id==="unsorted")||{id:"unsorted",name:"Unsorted",order:-1},...s].map((E,q)=>({id:E.id,name:E.name,order:q}));try{if(Ae(h)){try{X()}catch{}try{se()}catch{}}}catch(E){console.warn("[notebook] reorder save failed",E)}},Ht=(t,o)=>{if(!t||t==="all"||t==="unsorted")return;j();let r=document.createElement("div");r.className="memory-glass-card p-2 rounded shadow-lg",r.style.position="absolute",r.style.zIndex=1200,r.style.minWidth="160px";let s=!1,a=!1;try{let E=(Array.isArray(U())?U().filter(Boolean):[]).filter(R=>R&&R.id!=="unsorted").sort((R,J)=>(Number(R.order)||0)-(Number(J.order)||0)),q=E.findIndex(R=>String(R.id)===String(t));s=q===0,a=q===-1?!0:q===E.length-1}catch{s=!1,a=!1}let u=document.createElement("button");u.type="button",u.className="w-full text-left px-3 py-2 btn-ghost",u.textContent="Move up",s&&(u.setAttribute("disabled",""),u.classList.add("opacity-50","cursor-not-allowed")),u.addEventListener("click",h=>{h.preventDefault();try{lt(t,-1)}catch(E){console.warn("[notebook] reorder move up failed",E)}j()});let p=document.createElement("button");p.type="button",p.className="w-full text-left px-3 py-2 btn-ghost",p.textContent="Move down",a&&(p.setAttribute("disabled",""),p.classList.add("opacity-50","cursor-not-allowed")),p.addEventListener("click",h=>{h.preventDefault();try{lt(t,1)}catch(E){console.warn("[notebook] reorder move down failed",E)}j()});let k=document.createElement("button");k.type="button",k.className="w-full text-left px-3 py-2 btn-ghost",k.textContent="Rename folder",k.addEventListener("click",h=>{h.preventDefault(),Pt(t),j()});let I=document.createElement("button");I.type="button",I.className="w-full text-left px-3 py-2 btn-ghost text-accent",I.textContent="Delete folder",I.addEventListener("click",h=>{h.preventDefault(),zt(t),j()}),r.appendChild(u),r.appendChild(p),r.appendChild(k),r.appendChild(I),document.body.appendChild(r),oe=r;try{let h=o.getBoundingClientRect(),E=h.bottom+window.scrollY+6,q=h.left+window.scrollX;r.style.top=`${E}px`,r.style.left=`${q}px`}catch{r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}document.addEventListener("click",j),document.addEventListener("keydown",qe)},at=document.getElementById("renameFolderModal"),re=document.getElementById("renameFolderName"),ue=document.getElementById("renameFolderError"),dt=document.getElementById("renameFolderSave"),qt=document.getElementById("renameFolderCancel"),Be=null,he=null,ct=()=>{ue&&(ue.classList.add("sr-only"),ue.textContent="")},Pe=t=>{ue&&(ue.textContent=t,ue.classList.remove("sr-only"))},Pt=t=>{if(!at||t==="all"||t==="unsorted")return;he=t;let r=(Array.isArray(U())?U():[]).find(s=>s&&String(s.id)===String(t));r&&(Be||(Be=new Se({modalElement:at,closeButton:qt,titleInput:re,modalTitle:document.getElementById("renameFolderTitle"),autoFocus:!0})),ct(),re&&(re.value=r.name||""),Be.show())},ut=()=>{if(!he||!re)return;let o=String(re.value||"").trim();if(ct(),!o.length){Pe("Folder name can't be empty.");return}let r=[];try{r=Array.isArray(U())?U():[]}catch{r=[]}if(r.some(p=>String(p.name).toLowerCase()===o.toLowerCase()&&String(p.id)!==String(he))){Pe("You already have a folder with this name.");return}let a=r.map(p=>String(p.id)===String(he)?{...p,name:o}:p);if(!Ae(a)){Pe("Unable to rename folder. Please try again.");return}try{Be.requestClose("saved")}catch{}he=null;try{X()}catch{}se()};dt&&dt.addEventListener("click",t=>{t.preventDefault(),ut()}),re&&re.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),ut())});let ft=document.getElementById("deleteFolderModal"),mt=document.getElementById("deleteFolderConfirm"),$t=document.getElementById("deleteFolderCancel"),be=null,ie=null,zt=t=>{!ft||t==="all"||t==="unsorted"||(ie=t,be||(be=new Se({modalElement:ft,closeButton:$t,titleInput:null,modalTitle:document.getElementById("deleteFolderTitle"),autoFocus:!1})),be.show())},Vt=()=>{if(!ie)return;let t=[];try{t=Array.isArray(U())?U():[]}catch{t=[]}let o=t.filter(u=>String(u.id)!==String(ie));if(o.some(u=>u&&u.id==="unsorted")||o.unshift({id:"unsorted",name:"Unsorted"}),!Ae(o)){try{be.requestClose("failed")}catch{}ie=null;return}let s=Z(),a=(Array.isArray(s)?s:[]).map(u=>u&&String(u.folderId)===String(ie)?{...u,folderId:"unsorted",updatedAt:new Date().toISOString()}:u);K(a),String(C)===String(ie)&&(C="unsorted",F()),ie=null;try{be.requestClose("deleted")}catch{}X(),se()};mt&&mt.addEventListener("click",t=>{t.preventDefault(),Vt()}),m&&m.addEventListener("click",t=>{let o=t.target;if(!(o instanceof HTMLElement))return;let r=o.closest('button[data-role="delete-note"]');if(r&&m.contains(r)){t.preventDefault();let u=r.getAttribute("data-note-id");if(!u)return;let p=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(p?p("Delete this note? This cannot be undone."):!0)&&Je(u);return}let s=o.closest('button[data-role="note-menu"]');if(s&&m.contains(s)){t.preventDefault();let u=s.getAttribute("data-note-id");if(!u)return;let p=L.find(k=>k.id===u);p&&_t(p,s);return}let a=o.closest('button[data-role="open-note"]');if(a&&m.contains(a)){t.preventDefault();let u=a.getAttribute("data-note-id");if(!u)return;let p=L.find(k=>k.id===u);p&&(ee(p),pe(),N()&&w())}});let se=()=>{Ke(Ge())};if(y){let t=A(()=>{d=typeof y.value=="string"?y.value:"",se()},180);y.addEventListener("input",t),y.addEventListener("search",t)}let Yt=()=>{de({preserveDraft:!1})};i.addEventListener("click",()=>{let t=Z(),o=Array.isArray(t)?[...t]:[],{title:r,body:s}=xt(),a=r||"Untitled note",u=new Date().toISOString(),p=z&&z!=="all"?z:"unsorted";if(f){let k=o.findIndex(I=>I.id===f);if(k>=0)o[k]={...o[k],title:a,body:s,updatedAt:u,folderId:p};else{let I=ae(a,s,{updatedAt:u,folderId:p});f=I.id,o.unshift(I)}}else{let k=ae(a,s,{folderId:p});f=k.id,o.unshift(k)}K(o),Le(),de({preserveDraft:!1})});let yt=()=>{ee(null),z=C&&C!=="all"?C:"unsorted";let t=document.getElementById("note-folder-label");if(t&&(t.textContent=me(z)),pe(),typeof n.focus=="function")try{n.focus()}catch{}};l&&l.addEventListener("click",t=>{t.preventDefault(),yt()});let Ne=document.getElementById("mobile-footer-new-note");Ne&&Ne.addEventListener("click",t=>{t.preventDefault();try{Ne.getAttribute("data-nav-target")&&(document.querySelectorAll("[data-nav-target]").forEach(s=>s.classList.remove("active")),Ne.classList.add("active"))}catch{}yt()});let Te=A(()=>{try{if(!Re())return;i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}},1500);try{n.addEventListener("input",Te)}catch{}try{e.addEventListener("input",Te),e.addEventListener("keydown",Y),e.addEventListener("blur",()=>{Te()}),n.addEventListener("blur",()=>Te())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",t=>{try{Re()&&i instanceof HTMLElement&&!i.matches(":disabled")&&i.click()}catch{}}),Yt(),typeof window<"u"&&(window.addEventListener("storage",t=>{t.key===ve&&(ge=t.newValue??null,de({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let t=Ue();t!==ge&&(ge=t,de({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Tt,{once:!0}):Tt();var We=It(),je=bt({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:n=>{We?.handleSessionChange(n)}});if(je?.supabase){We?.setSupabaseClient(je.supabase);try{je.supabase.auth.getSession().then(({data:n})=>{We?.handleSessionChange(n?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let n=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let i='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',l=n,m=S=>{if(!(S instanceof HTMLElement)||S.getAttribute("aria-hidden")==="true"||S.hasAttribute("disabled")||S.tabIndex<0)return!1;let x=S.getBoundingClientRect();return x.width>0||x.height>0},c=()=>Array.from(e.querySelectorAll(i)).filter(m),y=()=>{let S=e.classList.contains("hidden");e.setAttribute("aria-hidden",S?"true":"false")};y();let b=S=>{!e.contains(S.target)&&S.target!==n&&O({restoreFocus:!1})},D=()=>{let[S]=c();if(S instanceof HTMLElement)try{S.focus()}catch{}},H=()=>{e.classList.contains("hidden")&&(l=document.activeElement instanceof HTMLElement?document.activeElement:n,e.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),y(),document.addEventListener("focusin",b),!e.contains(document.activeElement)&&D())},O=({restoreFocus:S=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),n.setAttribute("aria-expanded","false"),y(),document.removeEventListener("focusin",b),S&&l instanceof HTMLElement))try{l.focus()}catch{}};n.addEventListener("click",S=>{S.stopPropagation(),e.classList.contains("hidden")?H():O()}),document.addEventListener("click",S=>{S.target===n||e.contains(S.target)||O({restoreFocus:!1})}),document.addEventListener("keydown",S=>{if(S.key==="Escape"){O();return}S.key==="ArrowDown"&&!e.classList.contains("hidden")&&(S.preventDefault(),D())}),e.addEventListener("click",S=>{S.stopPropagation(),S.target instanceof HTMLElement&&S.target.closest("button")&&O({restoreFocus:!1})}),e.addEventListener("keydown",S=>{if(S.key!=="Tab")return;let x=c();if(!x.length)return;let $=x.indexOf(document.activeElement),g=x.length-1,M=$;S.shiftKey?M=$<=0?g:$-1:M=$===g?0:$+1,S.preventDefault();let _=x[M]||x[0];if(_ instanceof HTMLElement)try{_.focus()}catch{}})})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let e=()=>{let m=document.getElementById("voiceBtn");return m instanceof HTMLElement?m:null},i=()=>{let m=e();if(!m)return;let c=()=>{m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let b=m.getAttribute("title");b&&n.setAttribute("title",b)};c(),typeof MutationObserver=="function"&&new MutationObserver(c).observe(m,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i();let l=()=>{let m=e();if(m&&!(m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true")){try{m.focus({preventScroll:!0})}catch{try{m.focus()}catch{}}try{m.click()}catch(c){console.warn("Voice add trigger failed",c)}}};n.addEventListener("click",m=>{m.preventDefault();let c=!1,y=null,b=()=>{c||(c=!0,document.removeEventListener("reminder:sheet-opened",D),l())},D=O=>{if(O?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&y&&(window.clearTimeout(y),y=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,150)};document.addEventListener("reminder:sheet-opened",D);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(O){document.removeEventListener("reminder:sheet-opened",D),typeof window<"u"&&typeof window.clearTimeout=="function"&&y&&(window.clearTimeout(y),y=null),console.warn("Voice add open failed",O);return}let H=document.getElementById("create-sheet");H instanceof HTMLElement&&H.classList.contains("open")&&(y=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(b,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(e instanceof HTMLElement))return;let i=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],l=()=>{let c=e.hasAttribute("open");n.setAttribute("aria-expanded",String(c)),n.classList.toggle("btn-active",c)},m=()=>{for(let c of i){let y=e.querySelector(c);if(y instanceof HTMLElement&&!y.hasAttribute("disabled")){try{y.focus({preventScroll:!0})}catch{y.focus()}return}}};n.addEventListener("click",()=>{let c=e.hasAttribute("open");e.open=!c,c||m(),l()}),e.addEventListener("toggle",l),l()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function e(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let e=document.getElementById("totalCount");if(!e)return;let i=Array.isArray(n?.detail?.items)?n.detail.items.length:0;e.textContent=String(i)});document.addEventListener("click",n=>{try{let e=n.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let e=Array.from(n.children);if(e.length<=30)return;let i=20;n.innerHTML="";let l=0;function m(){let b=e.slice(l,l+i);b.forEach(D=>n.appendChild(D)),l+=b.length}m();let c=document.createElement("div");c.id="listSentinel",n.appendChild(c);let y=new IntersectionObserver(b=>{b.some(D=>D.isIntersecting)&&l<e.length&&(m(),l>=e.length&&y.disconnect())});y.observe(c)})();(function(){let n=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(c=>c instanceof HTMLElement),e=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!n.length||!e||!i)return;function l(){e.classList.remove("hidden")}function m(){e.classList.add("hidden")}n.forEach(c=>{c.addEventListener("click",l)}),i.addEventListener("click",m),e.addEventListener("click",c=>{c.target instanceof HTMLElement&&c.target.matches("[data-close]")&&m()}),e.addEventListener("keydown",c=>{c.key==="Escape"&&m()})})();(function(){let n=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),i=document.getElementById("mcStatusText"),l=document.getElementById("syncUrl"),m=document.getElementById("saveSyncSettings"),c=document.getElementById("testSync"),y=document.getElementById("syncAll"),b="syncUrl";if(!i)return;let D=["online","offline","error"],H=["online","offline"],O={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},S={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},x=null;function $(d){if(!e)return;H.forEach(B=>e.classList.remove(B));let v=d!=="offline"&&d!=="error";e.classList.add(v?"online":"offline"),e.setAttribute("aria-label",v?"Online":"Offline")}function g(d,v){x=d,D.forEach(T=>i.classList.remove(T)),n&&D.forEach(T=>n.classList.remove(T)),d==="online"?(i.classList.add("online"),n&&n.classList.add("online")):d==="error"?(i.classList.add("error"),n&&n.classList.add("error")):(i.classList.add("offline"),n&&n.classList.add("offline"));let B=typeof v=="string"&&v.trim()?v.trim():O[d]||"",F=typeof v=="string"&&v.trim()?v.trim():S[d]||B,N=B||F||"";i.textContent=N,N?(i.setAttribute("title",N),i.setAttribute("aria-label",N)):(i.removeAttribute("title"),i.removeAttribute("aria-label")),$(d),i.dataset.state=d}function M(){x!=="syncing"&&g(navigator.onLine?"online":"offline")}function _(d){typeof localStorage>"u"||(d?localStorage.setItem(b,d):localStorage.removeItem(b))}function P(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(b)||""}catch{return""}}function V(d){if(!d||typeof d!="object")return null;let v=d.id||d.uid||d.key||d.slug||d.uuid,B=typeof d.title=="string"&&d.title.trim()?d.title.trim():typeof d.name=="string"?d.name.trim():"";if(!B)return null;let F=typeof d.dueIso=="string"&&d.dueIso?d.dueIso:typeof d.due=="string"?d.due:null,N=typeof d.priority=="string"&&d.priority.trim()?d.priority.trim():d.level||d.importance||"Medium",T=typeof d.category=="string"&&d.category.trim()?d.category.trim():d.group||d.bucket||"General",w=typeof d.done=="boolean"?d.done:!!(d.completed||d.isDone||d.status==="done");return{id:v||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:B,dueIso:F&&F.trim()?F.trim():null,priority:N,category:T,done:w}}function Y(){let d=Array.from(document.querySelectorAll("[data-reminder]"));return d.length?d.map(v=>{let B=v.dataset||{},F=null;if(B.reminder)try{F=JSON.parse(B.reminder)}catch{F=null}let N=F||{id:B.id||B.reminderId||v.getAttribute("data-id")||null,title:B.title||B.reminderTitle||"",dueIso:B.due||B.reminderDue||v.getAttribute("data-due")||null,priority:B.priority||B.reminderPriority||v.getAttribute("data-priority")||"",category:B.category||B.reminderCategory||v.getAttribute("data-category")||"",done:B.done==="true"||B.reminderDone==="true"||v.getAttribute("data-done")==="true"};if(!N.title){let T=v.querySelector("[data-reminder-title], [data-title], h3, h4, strong");T&&(N.title=T.textContent.trim())}if(!N.dueIso){let T=v.querySelector("[data-due], time");if(T){let w=T.getAttribute("datetime")||T.getAttribute("data-due");N.dueIso=w||T.textContent.trim()}}return V(N)}).filter(Boolean):[]}function A(){if(typeof localStorage>"u")return[];let d=[],v=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(F=>{if(!v.has(F)){v.add(F);try{let N=localStorage.getItem(F);if(!N)return;let T=JSON.parse(N);Array.isArray(T)?T.forEach(w=>d.push(w)):T&&typeof T=="object"&&(Array.isArray(T.items)&&T.items.forEach(w=>d.push(w)),Array.isArray(T.reminders)&&T.reminders.forEach(w=>d.push(w)))}catch{}}}),!d.length)for(let F=0;F<localStorage.length;F+=1){let N=localStorage.key(F);if(!(!N||v.has(N)||!/remind/i.test(N))){v.add(N);try{let T=localStorage.getItem(N);if(!T)continue;let w=JSON.parse(T);Array.isArray(w)?w.forEach(Q=>d.push(Q)):w&&typeof w=="object"&&(Array.isArray(w.items)&&w.items.forEach(Q=>d.push(Q)),Array.isArray(w.reminders)&&w.reminders.forEach(Q=>d.push(Q)))}catch{}}}return d.map(V).filter(Boolean)}function f(){let d=Y();return d.length?d:A()}function L(d){d?(y?.setAttribute("aria-busy","true"),y?.setAttribute("disabled","disabled"),c?.setAttribute("aria-busy","true"),c?.setAttribute("disabled","disabled")):(y?.removeAttribute("aria-busy"),c?.removeAttribute("aria-busy"),C())}function C(){!!((l?.value||"").trim()||P())?(y?.removeAttribute("disabled"),c?.removeAttribute("disabled")):(y?.setAttribute("disabled","disabled"),c?.setAttribute("disabled","disabled"))}let z=P();l&&z&&(l.value=z),C(),g(navigator.onLine?"online":"offline"),window.addEventListener("online",M),window.addEventListener("offline",M),l?.addEventListener("input",C),m?.addEventListener("click",()=>{let d=(l?.value||"").trim();if(!d){_(""),g("info","Sync URL cleared. Add one to enable sync."),C();return}try{let v=new URL(d);if(!/^https?:/.test(v.protocol))throw new Error("Invalid protocol")}catch{g("error","Enter a valid sync URL before saving.");return}_(d),g("online","Sync settings saved."),C()}),c?.addEventListener("click",async()=>{let d=(l?.value||P()).trim();if(!d){g("error","Add your sync URL in Settings first.");return}L(!0),g("syncing","Testing connection\u2026");try{(await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?g("online","Connection looks good."):g("error","Test failed. Check your Apps Script deployment.")}catch(v){console.error("Test sync failed",v),g("error","Test failed. Check your Apps Script deployment.")}finally{L(!1)}}),y?.addEventListener("click",async()=>{let d=(l?.value||P()).trim();if(!d){g("error","Add your sync URL in Settings first.");return}let v=f();if(!v.length){g("info","Nothing to sync right now.");return}L(!0),g("syncing",`Syncing ${v.length} reminder${v.length===1?"":"s"}\u2026`);let B=20,F=0,N=0,T=w=>({id:w.id,title:w.title,dueIso:w.dueIso||null,priority:w.priority||"Medium",category:w.category||"General",done:!!w.done,source:"memory-cue-mobile"});try{for(let w=0;w<v.length;w+=B){let Q=v.slice(w,w+B);(await Promise.allSettled(Q.map(G=>fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T(G))})))).forEach(G=>{G.status==="fulfilled"&&G.value?.ok?F+=1:(G.status,N+=1)}),await new Promise(G=>setTimeout(G,300))}N?F?g("error",`Partial sync: ${F} success, ${N} failed.`):g("error","Sync failed. Check your sync URL and retry."):g("online",`Sync complete. ${F} updated.`)}catch(w){console.error("Sync failed",w),g("error","Sync failed. Try again soon.")}finally{L(!1)}})})()});export default sn();
