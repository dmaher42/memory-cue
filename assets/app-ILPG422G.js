import{a as Ot,b as lr,c as De,d as cr,f as et,g as Ce,h as tt,i as dr,j as $t,k as ur}from"./chunk-UP4RU4IJ.js";import{a as Rt,b as ir}from"./chunk-MG4MJA24.js";import"./chunk-KX65DZXT.js";import{b as Ze,c as ar}from"./chunk-GUVSRPRW.js";function Ut(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:r})=>{if(!Array.isArray(r))return null;for(let o of r){if(typeof o!="string"||!o)continue;let s=t.getElementById(o);if(s)return{key:n,element:s}}return null}).filter(n=>!!(n&&n.element))}function ne(e,t){if(!e||typeof e!="object")return"";let n=fr[t]||[t];for(let r of n)if(Object.prototype.hasOwnProperty.call(e,r)){let o=e[r];return o==null?"":typeof o=="string"?o:String(o)}return""}function mr(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function pr(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function _t(e,t){Array.isArray(t)&&t.forEach(({key:n,element:r})=>{let o=e&&typeof e=="object"?ne(e,n):"";mr(r,o)})}function Wt(e,t,n,r){Array.isArray(e)&&e.forEach(({element:o})=>{o instanceof HTMLInputElement?["checkbox","radio"].includes(o.type)?o.checked=!1:o.value="":(o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement)&&(o.value="")}),t&&(t.value=""),n&&(n.textContent=r)}function Vt(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:r})=>{let o=pr(r);if(typeof o=="boolean"){t[n]=o;return}let s=typeof o=="string"?o.trim():o;t[n]=s??""}),t}function L(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var qt,fr,nt,rt,jt=Ze(()=>{qt=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],fr={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},nt="Create Cue",rt="Edit Cue"});function Kt(e){return new ot(e)}var yr,hr,ot,Yt=Ze(()=>{yr=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),hr={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},ot=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...hr,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let r=n[0],o=n[n.length-1],s=document.activeElement;t.shiftKey&&s===r?(t.preventDefault(),o.focus()):!t.shiftKey&&s===o&&(t.preventDefault(),r.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(yr)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let r=this.events[t];if(!r||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let o=new CustomEvent(r,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(o)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Gt,zt,Qt,at,st,gr,se,it,br,Jt,Xt,lt,Er,Zt,Ne,en,tn,nn,oe,wr,vr,ge,rn,Lr,Tr,Sr,on,ct,Fe,he,Be,re,ye,xr,sn,V,an,be,ln,cn,Me,Ar,pe,Ee,dn,q,Pe,un,dt,fn,$,mn,pn,yn,hn,gn,ae,bn,He,ut,En=Ze(()=>{Gt="memoryCue:plannerPlans",zt="memoryCue:plannerTemplates",Qt="memoryCue:lastPlannerTemplate",at="memoryCue:plannerUpdated",st=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],gr=[{dayIndex:1,title:"Monday",summary:"Co-teach literacy rotations with Mia. Collect exit slips.",details:[{badge:"Workshop",text:"Shared reading focus \xB7 45 mins"},{badge:"Prep",text:"Print small group checklists"}]},{dayIndex:2,title:"Tuesday",summary:"STEM lab \u2013 robotics challenges for groups A & B.",details:[{badge:"Lab",text:"Calibrate sensors before class"},{badge:"Check-in",text:"Collect student reflections in Notes"}]},{dayIndex:3,title:"Wednesday",summary:"Parent interviews from 3 PM. Prepare student snapshots.",details:[{badge:"Families",text:"Finalise progress highlights"},{badge:"Reminder",text:"Email timetable to staff"}]},{dayIndex:4,title:"Thursday",summary:"Lesson study \xB7 co-design inquiry prompts with team.",details:[{badge:"Collab",text:"Align goals with team rubric"},{badge:"Resource",text:"Attach planning template"}]}],se=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},it=e=>{if(!se()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},br=(e,t)=>{if(!(!se()||!e))try{typeof t=="string"&&t.length?window.localStorage.setItem(e,t):window.localStorage.removeItem(e)}catch{}},Jt=e=>{try{return JSON.parse(e)}catch{return null}},Xt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,lt=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,Er=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),r=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-r),t},Zt=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`},Ne=e=>{if(typeof e!="string")return null;let[t,n,r]=e.split("-"),o=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(r,10);if(!Number.isFinite(o)||!Number.isFinite(s)||!Number.isFinite(a))return null;let i=new Date(o,s-1,a);return Number.isNaN(i.getTime())?null:(i.setHours(0,0,0,0),i)},en=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=st.findIndex(r=>r.toLowerCase()===t);return n>=0?n:0},tn=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:Xt(),badge:n,text:t}},nn=(e,t={})=>{let n=typeof t=="object"&&t?t:{},r=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:en(e?.dayName||n.dayName||n.dayLabel),o=lt(r),s=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():st[o],a=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",d=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(y=>tn(y)).filter(Boolean),l=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:Xt(),m=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN;return{id:l,dayIndex:o,dayLabel:st[o]||"Lesson",title:s,summary:a,details:d,position:Number.isFinite(m)?m:null}},oe=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let r=Number.isFinite(t.position),o=Number.isFinite(n.position);return r&&o&&t.position!==n.position?t.position-n.position:r&&!o?-1:!r&&o?1:t.title.localeCompare(n.title)}),wr=e=>{let t=new Map;return e.forEach(n=>{let r=String(n.dayIndex),o=t.get(r)??0;Number.isFinite(n.position)?t.set(r,Math.max(o,n.position+1)):(n.position=o,t.set(r,o+1))}),e},vr=(e,t,n)=>{let r=e.filter(o=>!(o.dayIndex!==t||n&&o.id===n));return r.length?r.reduce((o,s)=>Number.isFinite(s.position)?Math.max(o,s.position):o,-1)+1:0},ge=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,r=Ne(n),o=Array.isArray(e?.lessons)?wr(e.lessons.map(a=>nn(a)).filter(Boolean)):[],s=typeof e?.templateId=="string"?e.templateId.trim():"";return{weekId:n,startDate:r?r.toISOString():"",lessons:oe(o),updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString(),templateId:s}},rn=()=>{if(!se())return{};try{let e=it(Gt);if(typeof e!="string"||!e.length)return{};let t=Jt(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Lr=e=>{if(se())try{window.localStorage.setItem(Gt,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},Tr=()=>{if(!se())return{};try{let e=it(zt);if(typeof e!="string"||!e.length)return{};let t=Jt(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner templates from storage",e),{}}},Sr=e=>{if(se())try{window.localStorage.setItem(zt,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner templates locally",t)}},on=e=>{if(!e)return null;let n=rn()[e];return n?ge(n,e):null},ct=(e,t)=>{if(!e||!t)return t;let n=rn();return n[e]=t,Lr(n),t},Fe=new Map,he=null,Be=null,re=!1,ye=null,xr=()=>{if(typeof ye=="string")return ye;let e=it(Qt);return ye=typeof e=="string"?e:"",ye},sn=e=>{if(typeof e!="string"||!e.trim())return;let t=e.trim();ye=t,br(Qt,t)},V=e=>{e?.templateId&&sn(e.templateId)},an=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},be=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(at,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},ln=async()=>he?Be||(Be=he().then(e=>{let{db:t,getCollection:n}=e||{},r=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),Be):null,cn=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:r,db:o}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(o,"plannerPlans",t)},Me=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Fe.set(e.weekId,e),e),Ar=e=>{let t=q();return ge({weekId:e,lessons:e===t?gr:[]},e)},pe=e=>{let t=on(e);if(t)return Me(t),t;let n=Ar(e);return ct(e,n),Me(n),n},Ee=async e=>{if(!e?.weekId)return e;let t=ge(e,e.weekId);if(ct(t.weekId,t),Me(t),V(t),re||!he)return t;try{let n=await ln();if(!n)return t;let r=cn(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(r,t,{merge:!0}):await n.updateDoc(r,t),t}catch(n){return an(n)?(console.warn("Persisting planner data locally due to permission issue",n),re=!0,t):(console.error("Failed to persist planner plan",n),t)}},dn=(e={})=>{typeof e.ensureFirestore=="function"&&(he=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(re=e.forceLocal)},q=(e=new Date)=>{let t=Er(e);return Zt(t)},Pe=(e,t=0)=>{let n=Ne(e);if(!n||!Number.isFinite(t))return e;let r=new Date(n);return r.setDate(n.getDate()+t*7),Zt(r)},un=(e=q(),t=0)=>{let n=Ne(e);if(!n)return null;let r=Number.isFinite(t)?t:0,o=lt(r),s=new Date(n);return s.setDate(n.getDate()+o),s},dt=(e,{short:t=!1}={})=>{let n=Ne(e);if(!n)return"";let r=new Date(n);r.setDate(n.getDate()+6);let o=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),s=o.format(n),a=o.format(r),i=n.getFullYear()===r.getFullYear();if(t)return`Week of ${s}`;let d=i?n.getFullYear():`${n.getFullYear()} \u2013 ${r.getFullYear()}`;return`${s} \u2013 ${a}, ${d}`},fn=(e=q())=>{if(!e)return[];let t=Fe.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=on(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},$=async(e=q())=>{if(!e)return null;if(Fe.has(e)){let t=Fe.get(e);return V(t),t}if(re||!he){let t=pe(e);return V(t),t}try{let t=await ln();if(!t){let s=pe(e);return V(s),s}let n=cn(t,e),r=await t.getDoc(n);if(r.exists()){let s=r.data(),a=ge({...s,weekId:e},e);return ct(e,a),Me(a),re=!1,V(a),a}let o=pe(e);return typeof t.setDoc=="function"&&await t.setDoc(n,o,{merge:!0}),V(o),o}catch(t){if(an(t)){console.warn("Falling back to local planner data due to permission issue",t),re=!0;let r=pe(e);return V(r),r}console.error("Failed to load planner data",t);let n=pe(e);return V(n),n}},mn=async(e,t)=>{if(!e)return null;let n=await $(e),r=nn(t);r.position=vr(n?.lessons||[],r.dayIndex);let o={...n,lessons:oe([...n?.lessons||[],r]),updatedAt:new Date().toISOString()},s=await Ee(o);return be(s),s},pn=async(e,t)=>{if(!e||!t)return null;let n=await $(e),r=(n?.lessons||[]).filter(a=>a.id!==t),o={...n,lessons:oe(r),updatedAt:new Date().toISOString()},s=await Ee(o);return be(s),s},yn=async(e,t,n)=>{if(!e||!t||!n)return null;let r=n==="up"?-1:n==="down"?1:0;if(!r)return $(e);let o=await $(e),s=[...o?.lessons||[]],a=s.findIndex(E=>E.id===t);if(a===-1)return o;let i=s[a],d=s.filter(E=>E.dayIndex===i.dayIndex);if(d.length<=1)return o;let m=oe(d).map(E=>E.id),y=m.indexOf(t);if(y===-1)return o;let c=y+r;if(c<0||c>=m.length)return o;let[u]=m.splice(y,1);m.splice(c,0,u);let h=new Map(m.map((E,N)=>[E,N])),b=s.map(E=>{if(E.dayIndex!==i.dayIndex)return E;let N=h.get(E.id);return typeof N=="number"?{...E,position:N}:E}),g={...o,lessons:oe(b),updatedAt:new Date().toISOString()},S=await Ee(g);return be(S),S},hn=async(e,t,n)=>{if(!e||!t)return null;let r=await $(e),o=[...r?.lessons||[]],s=o.findIndex(y=>y.id===t);if(s===-1)return r;let a=tn(n);if(!a)return r;let i=o[s],d={...i,details:[...i.details||[],a]};o[s]=d;let l={...r,lessons:oe(o),updatedAt:new Date().toISOString()},m=await Ee(l);return be(m),m},gn=e=>{if(!e||typeof e!="object")return null;let t=lt(Number.isFinite(e.dayIndex)?e.dayIndex:en(e.dayLabel||e.dayName)),n=typeof e.title=="string"?e.title:"",r=typeof e.summary=="string"?e.summary:"",o=Array.isArray(e.details)?e.details.map(s=>{if(!s||typeof s!="object")return null;let a=typeof s.badge=="string"?s.badge:"",i=typeof s.text=="string"?s.text:"";return i.trim()?{badge:a,text:i}:null}).filter(Boolean):[];return{dayIndex:t,title:n,summary:r,details:o}},ae=()=>{let e=Tr(),t={};return Object.keys(e).forEach(n=>{let r=e[n];if(!r||typeof r!="object")return;let o=typeof r.name=="string"&&r.name.trim()?r.name.trim():n,s=Array.isArray(r.lessons)?r.lessons.map(a=>gn(a)).filter(Boolean):[];t[o]={name:o,lessons:s,updatedAt:typeof r.updatedAt=="string"?r.updatedAt:""}}),t},bn=(e,t={})=>{let n=typeof e=="string"?e.trim():"";if(!n)return null;let r=ae(),o=Array.isArray(t.lessons)?t.lessons.map(s=>gn(s)).filter(Boolean):[];return r[n]={name:n,lessons:o,updatedAt:new Date().toISOString()},Sr(r),r[n]},He=()=>xr(),ut=async(e,t)=>{if(!e||!t)return null;let r=ae()[t];if(!r)return $(e);sn(t);let o=Array.isArray(r.lessons)?r.lessons.map(i=>({dayIndex:i.dayIndex,title:i.title,summary:i.summary,details:Array.isArray(i.details)?i.details.map(d=>({badge:d.badge,text:d.text})):[]})):[],s=ge({weekId:e,lessons:o,templateId:t},e);s.updatedAt=new Date().toISOString();let a=await Ee(s);return be(a),a}});var $o=ar(()=>{ir();cr();jt();Yt();lr();dr();ur();En();Rt();function kr(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!e||!t||!n)return;let r=document.querySelectorAll("[data-open-reminder-modal]");if(!r.length)return;let o=e.querySelector("[data-reminder-modal-backdrop]"),s=e.querySelectorAll("[data-close-modal]"),a=document.getElementById("mainContent"),i=document.querySelector('nav[aria-label="Primary"]'),d=[a,i],l=e.querySelector('[role="dialog"]')??e,m=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],y=null,c=()=>{if(!(l instanceof HTMLElement))return[];let f=l.querySelectorAll(m.join(","));return Array.from(f).filter(p=>{let I=p instanceof HTMLElement,G=typeof SVGElement<"u"&&p instanceof SVGElement;if(!I&&!G||p.getAttribute("aria-hidden")==="true"||"disabled"in p&&p.disabled||p.hidden||p.closest("[hidden]"))return!1;let z=p.getBoundingClientRect();return z.width>0&&z.height>0})},u=()=>{let f=c(),p=f.find(I=>I.hasAttribute("data-autofocus")||I.hasAttribute("autofocus"))||(n&&f.includes(n)?n:null)||f[0];if(p&&typeof p.focus=="function"){p.focus({preventScroll:!0});return}l instanceof HTMLElement&&typeof l.focus=="function"&&l.focus({preventScroll:!0})},h=f=>{l instanceof HTMLElement&&(!(f.target instanceof Node)||!l.contains(f.target))&&(f.stopPropagation(),u())},b=f=>{if(f.key!=="Tab")return;let p=c();if(!p.length){f.preventDefault(),l instanceof HTMLElement&&l.focus({preventScroll:!0});return}let I=p[0],G=p[p.length-1],z=document.activeElement;if(f.shiftKey){(!l.contains(z)||z===I)&&(f.preventDefault(),G.focus());return}(!l.contains(z)||z===G)&&(f.preventDefault(),I.focus())},g=f=>{d.forEach(p=>{p&&(f?p.setAttribute("inert",""):p.removeAttribute("inert"))})},S=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),g(!1),document.removeEventListener("keydown",E,!0),e.removeEventListener("keydown",b,!0),e.removeEventListener("focusin",h,!0),y&&typeof y.focus=="function"&&y.focus(),y=null},E=f=>{f.key==="Escape"&&(f.preventDefault(),S())},N=({triggerElement:f}={})=>{f&&typeof f.focus=="function"?y=f:y=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),g(!0),document.addEventListener("keydown",E,!0),e.addEventListener("keydown",b,!0),e.addEventListener("focusin",h,!0),window.requestAnimationFrame(()=>{u()})},k=(f,p={})=>{try{document.dispatchEvent(new CustomEvent(f,{detail:p}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let I=document.createEvent("CustomEvent");I.initCustomEvent(f,!0,!0,p),document.dispatchEvent(I)}}},C=(f={})=>{k("cue:cancelled",f)};r.forEach(f=>{f.addEventListener("click",p=>{p.preventDefault();let G={trigger:p.currentTarget instanceof HTMLElement?p.currentTarget:null,mode:"create"};k("cue:prepare",G),k("cue:open",G)})}),s.forEach(f=>{f.addEventListener("click",p=>{p.preventDefault(),C({trigger:f,reason:"button"})})}),e.addEventListener("click",f=>{f.target===e&&C({reason:"backdrop"})}),o?.addEventListener("click",f=>{f.target===o&&C({reason:"backdrop"})}),document.addEventListener("cue:open",f=>{let p=f?.detail?.trigger,I=p instanceof HTMLElement?p:null;N({triggerElement:I})});let O=()=>{S()};document.addEventListener("cue:close",O),document.addEventListener("cue:cancelled",O);let P=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&P instanceof HTMLElement&&t.addEventListener("submit",f=>{f.preventDefault(),!P.matches(":disabled")&&P.click()}),P instanceof HTMLElement&&document.addEventListener("reminder:save",f=>{let p=f?.detail?.trigger;p&&p!==P||P.matches(":disabled")||P.click()})}kr();function ft(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var wn=null;function On(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function Ir(e){typeof document>"u"||!e||(window.clearTimeout(wn),wn=window.setTimeout(()=>{let t=document.querySelector(`[data-route="${e}"]`);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function ve(e){let t=e||On();t&&Ir(t)}function Dr(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{ve()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",r=>{if(!(r.currentTarget instanceof HTMLAnchorElement))return;let o=r.currentTarget.getAttribute("href")||"";if(!o.startsWith("#"))return;r.preventDefault();let s=o||"#dashboard",a=s.replace("#","")||"dashboard";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),ve(a)})}),typeof window.renderRoute=="function"&&window.renderRoute(),ve()}Dr();var $n="memoryCue:accountPanelCollapsed";function Cr(){if(typeof window>"u"||typeof window.localStorage>"u")return null;try{let e=window.localStorage.getItem($n);if(e==="true"||e==="false")return e==="true"}catch(e){console.warn("Unable to read account panel preference",e)}return null}function Br(e){if(!(typeof window>"u"||typeof window.localStorage>"u"))try{window.localStorage.setItem($n,e?"true":"false")}catch(t){console.warn("Unable to save account panel preference",t)}}function Fr(){if(typeof document>"u")return;let e=document.querySelector("[data-account-panel-container]"),t=document.getElementById("desktopAccountToggle"),n=document.getElementById("desktopAccountPanel");if(!e||!t||!n)return;let r=(t.getAttribute("data-collapsed-label")||"").trim()||"Account",o=(t.getAttribute("data-expanded-label")||"").trim()||r,s=(t.getAttribute("data-collapsed-aria")||"").trim()||"Show account controls",a=(t.getAttribute("data-expanded-aria")||"").trim()||"Hide account controls",i=t.querySelector("[data-account-toggle-label]"),d=t.querySelector("[data-account-toggle-a11y]"),l=Cr();typeof l!="boolean"&&(l=!0);let m=(y,{persist:c=!0}={})=>{l=!!y,e.setAttribute("data-account-collapsed",l?"true":"false"),t.setAttribute("aria-expanded",l?"false":"true");let u=l?r:o,h=l?s:a;i?i.textContent=u:t.textContent=u,t.setAttribute("aria-label",h),d&&(d.textContent=h),l?(n.setAttribute("aria-hidden","true"),n.setAttribute("inert","")):(n.setAttribute("aria-hidden","false"),n.removeAttribute("inert")),l||n.removeAttribute("hidden"),c&&Br(l)};m(l,{persist:!1}),t.addEventListener("click",y=>{y.preventDefault(),m(!l)})}Fr();var vn=document.getElementById("settings-save-button"),Re=document.getElementById("settings-save-confirmation"),K=document.getElementById("live-status"),mt=null,Q=document.getElementById("resourcePlannerStatus"),pt=null;document.addEventListener("planner:reminderCreated",e=>{if(!K)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",r=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",o=r?`Reminder saved for ${r}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";K.textContent=o});vn&&Re&&vn.addEventListener("click",e=>{e.preventDefault(),Re.classList.remove("hidden"),Re.textContent="Settings saved!",K&&(K.textContent="Settings saved!"),mt&&window.clearTimeout(mt),mt=window.setTimeout(()=>{Re.classList.add("hidden")},3e3)});function Mr(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),ve(t),K&&(K.textContent="Opening planner to add a new lesson."),Je(),window.requestAnimationFrame(()=>{let r=Qn();r&&typeof r.catch=="function"&&r.catch(o=>{console.error("Planner quick action failed to start new lesson flow",o)})})}function Nr(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",Mr)})}Nr();function yt(e,{tone:t="success"}={}){Q&&(Q.textContent=e,Q.classList.remove("hidden"),Q.classList.remove("text-success","text-error"),Q.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(pt&&window.clearTimeout(pt),pt=window.setTimeout(()=>{Q.classList.add("hidden"),Q.textContent=""},4e3))),K&&(K.textContent=e)}function Pr(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function Hr(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let r=n.getAttribute("data-resource-title")?.trim(),o=n.getAttribute("data-resource-link")?.trim();if(!r||!o)return;let s="#planner";window.location.hash!==s&&(window.location.hash=s),typeof window.renderRoute=="function"&&window.renderRoute(),ve("planner"),Je(),await zn();let a=`${r} \u2014 ${o}`,i=po(),d=null;try{if(i)d=await hn(v,i,{badge:"Resource",text:a});else{let l=Pr("lesson"),m=T?.lessons?.[0]?.dayLabel||"Monday";d=await mn(v,{id:l,dayName:m,title:r,summary:`Resource link: ${o}`,details:[{badge:"Resource",text:a}]}),d&&(A=l)}if(d){T=d,fe(d),te(d,v),ue(d);let l=i?`Added "${r}" to your selected lesson.`:`Created a lesson for "${r}" in this week's planner.`;yt(l);return}yt("Unable to save that resource to the planner right now.",{tone:"error"})}catch(l){console.error("Failed to save resource to planner",l),yt("Unable to save that resource to the planner right now.",{tone:"error"})}}function Rr(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",Hr)})}Rr();var qn=document.getElementById("reminder-title"),Or=document.getElementById("reminderText"),R=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),r=e.querySelector(".modal-backdrop button"),o=document.getElementById("modal-title");return Kt({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:r instanceof HTMLElement?r:null,titleInput:qn,modalTitle:o instanceof HTMLElement?o:null,defaultTitle:nt,editTitle:rt})})();R?.setEditMode(!1);var $r=()=>{let e=!!qn;if(!!Or)return De({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id"};return e?De(n):De({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};$r().catch(e=>{console.error("Failed to initialise reminders",e)});var wt=$t(),ht=Ot({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:"#auth-feedback"},disableButtonBinding:!0,onSessionChange:e=>{wt?.handleSessionChange(e)}});if(ht?.supabase){wt?.setSupabaseClient(ht.supabase);try{ht.supabase.auth.getSession().then(({data:e})=>{wt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var W=document.getElementById("cues-list"),gt=document.getElementById("pinnedNotesCard"),le=document.getElementById("pinnedNotesList"),ee=document.getElementById("cue-form"),H=ee?.querySelector("#cue-id-input"),qr=R?.defaultTitle||R?.modalTitle?.textContent?.trim()||nt,Zo=R?.editTitle||rt,Ke=document.getElementById("tab-cues"),Ye=document.getElementById("tab-daily"),Te=document.getElementById("cues-view"),Se=document.getElementById("daily-list-view"),Ln=document.getElementById("daily-list-header"),Un=document.getElementById("quick-add-form"),D=document.getElementById("quick-add-input"),B=document.getElementById("daily-voice-btn"),J=document.getElementById("daily-tasks-container"),vt=document.getElementById("clear-completed-btn"),Ge=document.getElementById("daily-list-permission-notice"),F=document.getElementById("plannerCards")||document.getElementById("planner-grid"),Tn=document.getElementById("planner-week"),Ur=document.getElementById("planner-prev"),_r=document.getElementById("planner-next"),Wr=document.getElementById("planner-today"),Vr=document.getElementById("planner-duplicate-btn"),jr=document.getElementById("planner-new-lesson-btn"),j=document.getElementById("planner-template-select"),_n=document.getElementById("planner-template-save-btn"),Kr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Yr(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=Kr.findIndex(r=>r.toLowerCase()===t.toLowerCase());return n>=0?n:0}function Gr(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}var Sn=document.getElementById("remindersCount"),xn=document.getElementById("plannerCount"),An=document.getElementById("plannerSubtitle"),es=document.getElementById("resourcesCount"),ts=document.getElementById("templatesCount"),Oe=document.getElementById("dailySnapshotList"),$e=document.getElementById("todaysFocusList"),U=document.getElementById("weekAtAGlanceList"),_=null;U&&(_=document.createElement("li"),_.dataset.emptyState="week",_.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",_.textContent="No upcoming events this week.");var kn=()=>{if(!U||!_)return;U.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?U.contains(_)||U.appendChild(_):U.contains(_)&&U.removeChild(_)};U&&(kn(),new MutationObserver(kn).observe(U,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var bt=e=>{gt&&(e?gt.classList.remove("hidden"):gt.classList.add("hidden"))},xe={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},In=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),Dn=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),We=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",Dt=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},zr=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Wn=e=>{if(!e)return"";if(In)try{return In.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},Qr=e=>{if(!e)return"";if(Dn)try{return Dn.format(e)}catch{}return e.toLocaleDateString()},Vn=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(xe,t)?t:"medium"},Cn=e=>{let t=Vn(e);return xe[t]?.rank??xe.medium.rank},Jr=e=>{let t=Vn(e);return xe[t]??xe.medium},Bn=e=>{let t=Dt(e);return t?t.getTime():Number.POSITIVE_INFINITY};function jn(e=[]){if(!Oe)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(r=>({reminder:r,date:Dt(r)})).filter(({date:r})=>r&&zr(r,t)).sort((r,o)=>r.date.getTime()-o.date.getTime());if(!n.length){Oe.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}Oe.innerHTML="",n.forEach(({reminder:r,date:o})=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=We(r),s.appendChild(a);let i=Wn(o),d=document.createElement("p");d.className="text-xs text-base-content/70",d.textContent=i?`Due ${i}`:"Due today",s.appendChild(d),Oe.appendChild(s)})}function Kn(e=[]){if(!$e)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,r)=>{let o=Cn(n)-Cn(r);if(o!==0)return o;let s=Bn(n)-Bn(r);return s!==0?s:We(n).localeCompare(We(r),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){$e.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}$e.innerHTML="",t.forEach(n=>{let r=document.createElement("li");r.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let o=document.createElement("div");o.className="flex items-center justify-between gap-3";let s=document.createElement("p");s.className="font-semibold text-base-content",s.textContent=We(n),o.appendChild(s);let a=Jr(n),i=document.createElement("span");i.className=a.badgeClass,i.textContent=a.badgeLabel,o.appendChild(i),r.appendChild(o);let d=Dt(n),l=document.createElement("p");if(l.className="text-xs text-base-content/70",d){let m=Wn(d),y=Qr(d),c=[];m&&c.push(`Due ${m}`),y&&c.push(y),l.textContent=c.length?c.join(" \u2022 "):"Due soon"}else l.textContent="No due date";r.appendChild(l),$e.appendChild(r)})}var Xr=e=>{if(!Sn)return;let t=Array.isArray(e)?e.length:0;Sn.textContent=String(t)},Zr=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];Xr(t),jn(t),Kn(t)};document.addEventListener("memoryCue:remindersUpdated",Zr);jn();Kn();var Lt=Ut(qt),eo={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},qe=null,to=3,Fn=120;function no(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Fn?t:`${t.slice(0,Fn-1)}\u2026`:""}function ro(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let r=n.trim().toLowerCase();return r==="true"||r==="1"||r==="yes"}return!1})}function Mn(e){if(!le)return;let t=Array.isArray(e)?e:[];if(!t.length){le.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',bt(!1);return}let n=t.filter(s=>ro(s));if(!n.length){le.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',bt(!1);return}bt(!0);let o=n.slice(0,to).map(s=>{let a=L(ne(s,"title")||"Untitled Cue"),i=ne(s,"details"),d=L(no(i)),l=d?`<p class="mt-1 text-sm text-base-content/70">${d}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${a}</p>
          ${l}
        </li>
      `}).join("");le.innerHTML=o}function Tt(e,{tone:t="muted"}={}){if(!W)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),W.innerHTML=`<p class="${n.join(" ")}">${L(e)}</p>`}function oo(e){if(!W)return;if(!Array.isArray(e)||e.length===0){Tt("No cues yet.");return}let t=e.map(n=>{let r=L(ne(n,"title")||"Untitled Cue"),o=L(ne(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${r}</h2>
            ${o?`<p>${o}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${L(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${L(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");W.innerHTML=t}async function Ie(){return qe||(qe=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:r,enableIndexedDbPersistence:o,collection:s,doc:a,getDoc:i,addDoc:d,updateDoc:l,getDocs:m,query:y,orderBy:c,serverTimestamp:u,setDoc:h,arrayUnion:b}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),g=t(),S=g&&g.length?g[0]:e(eo),E=n(S);(function(){let C=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;C&&(C.__persistenceInitialized__||(C.__persistenceInitialized__=!0,(async()=>{try{await r(E),console.info("[Firestore] Persistence: multi-tab enabled")}catch(O){if(O&&O.code==="failed-precondition")try{await o(E),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(P){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",P?.code||P)}else O&&O.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",O?.code||O)}})()))})();let N=s(E,"cues");return{db:E,cuesCollection:N,getCollection:s,doc:a,getDoc:i,addDoc:d,updateDoc:l,getDocs:m,query:y,orderBy:c,serverTimestamp:u,setDoc:h,arrayUnion:b}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),qe)}async function so(){let e=await Ie(),{getDocs:t,cuesCollection:n,query:r,orderBy:o}=e,s=r&&o?r(n,o("createdAt","desc")):n;return(await t(s)).docs.map(i=>({id:i.id,...i.data()}))}async function ao(e){if(!e)return null;let t=await Ie(),{db:n,doc:r,getDoc:o}=t,s=r(n,"cues",e),a=await o(s);return a.exists()?{id:a.id,...a.data()}:null}async function Yn(){if(!(!W&&!le))try{let e=await so();oo(e),Mn(e)}catch(e){console.error("Failed to load cues",e),Xe(e)?Tt("Sign in to view your cues.",{tone:"muted"}):Tt("Unable to load cues right now.",{tone:"error"}),Mn([])}}function io(e){!ee||!H||(_t(e,Lt),H.value=e?.id||"",R?.setEditMode(!0),R?.show({mode:"edit"}))}async function lo(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let r=await ao(n);if(!r)return;io(r)}catch(r){console.error("Failed to prepare cue for editing",r)}}async function co(e){if(e.preventDefault(),!ee||!H)return;let t=H.value.trim(),n=Vt(Lt);try{let r=await Ie(),{db:o,doc:s,addDoc:a,updateDoc:i,cuesCollection:d,serverTimestamp:l}=r,m=typeof l=="function"?l():null;if(t){let y=s(o,"cues",t),c={...n};m&&(c.updatedAt=m),await i(y,c)}else{let y={...n};m&&(y.createdAt=m,y.updatedAt=m),await a(d,y)}await Yn(),Wt(Lt,H,R?.modalTitle??null,qr),await R?.hide({reason:"form-submit"})}catch(r){console.error("Failed to save cue",r)}}async function uo(){!ee||!H||!W||(W.addEventListener("click",lo),ee.addEventListener("submit",co))}ee&&H&&(document.addEventListener("cue:prepare",()=>{H.value="",R?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{H.value="",R?.setEditMode(!1)}));ee&&H&&W&&uo().catch(e=>{console.error("Failed to initialise cue editing",e)});(W||le)&&Yn();var w=[],Ue=null,X=!1,Ae=q(),Le=!1,v=Ae,T=null,we=null,A=null,ce=ae(),fo=e=>{if(!xn)return;let t=[];Array.isArray(e)?t=e:e&&typeof e=="object"&&Array.isArray(e.lessons)?t=e.lessons:t=fn(Ae),xn.textContent=String(t.length)};function te(e,t){if(fo(e),An){let n=dt(e?.weekId||t,{short:!0});An.textContent=n||""}}function St(e,{tone:t="muted"}={}){if(!F)return;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),F.innerHTML=`<p class="${n.join(" ")}">${L(e)}</p>`}function Gn(e){if(!Tn)return;let t=dt(e);Tn.textContent=t||""}function Qe(e){if(!j)return;ce=ae();let t=Object.values(ce).sort((s,a)=>s.name.localeCompare(a.name)),n=t.length>0,o=[`<option value="">${L(n?"Select template":"No templates saved")}</option>`];t.forEach(s=>{let a=s.name;o.push(`<option value="${L(a)}">${L(a)}</option>`)}),j.innerHTML=o.join(""),j.disabled=!n,e&&ce[e]?j.value=e:j.value=""}function ue(e){let t=e?.templateId||He();Qe(t)}async function mo(e,t){let r=(Array.isArray(e?.lessons)?e.lessons:[]).length>0,o=typeof e?.templateId=="string"&&e.templateId.trim().length>0;if(r||o)return e;let s=He();if(!s||(ce[s]||(ce=ae()),!ce[s]))return e;try{return await ut(t,s)||e}catch(a){return console.error("Failed to auto apply preferred planner template",a),e}}function fe(e){if(!F)return;let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){St("No lessons saved for this week yet."),A=null;return}let n=t.map(o=>typeof o.id=="string"&&o.id?o.id:"").filter(o=>!!o);A&&!n.includes(A)&&(A=null);let r=t.map(o=>{let s=Array.isArray(o.details)?o.details.map(c=>`
                <li class="flex items-center gap-2">
                  ${c.badge?`<span class="badge badge-outline badge-sm text-secondary">${L(c.badge)}</span>`:""}
                  <span class="text-sm text-base-content/70">${L(c.text)}</span>
                </li>
              `).join(""):"",a=s?`<ul class="space-y-2 text-sm text-base-content/70">${s}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',i=typeof o.id=="string"?o.id:"",d=!!(A&&i&&A===i),l=["data-planner-lesson",i?`data-lesson-id="${i}"`:"",d?'data-planner-selected="true"':""].filter(Boolean).join(" "),m=o.summary?`<p class="text-sm text-base-content/70">${L(o.summary)}</p>`:"",y=i?`
            <div class="flex items-center gap-1" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${i}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${i}"
              >
                Move down
              </button>
            </div>
          `:"";return`
        <article class="card border border-base-300 bg-base-200/70 shadow-sm transition hover:-translate-y-1 hover:shadow" ${l}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">${L(o.dayLabel||"")}</p>
                <h2 class="text-lg font-semibold text-base-content">${L(o.title||o.dayLabel||"Lesson")}</h2>
                ${m}
              </div>
              <div class="flex items-center gap-1">
                ${y}
                <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${i}">
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-ghost btn-xs text-error"
                  data-planner-action="delete"
                  data-lesson-id="${i}"
                >
                  Delete
                </button>
              </div>
            </div>
            ${a}
            <div class="flex flex-wrap gap-2">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${i}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${i}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");F.innerHTML=r,xt(A||null)}function xt(e){if(A=e||null,!F)return;F.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function po(){return A&&(Array.isArray(T?.lessons)?T.lessons:[]).some(t=>t.id===A)?A:null}function yo(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===A||xt(n)}function ie(e){if(!F)return we=null,Promise.resolve();let t=e||q();v=t,Gn(t),St("Loading plan\u2026");let n=(async()=>{try{let r=await $(t);r=await mo(r,t),T=r,fe(r),te(r,t),ue(r)}catch(r){console.error("Failed to load planner week",r),St("Unable to load this week's planner.",{tone:"error"})}})();return we=n,n.finally(()=>{we===n&&(we=null)})}async function zn(){if(!F)return;Le||Je();let e=we;if(!e&&(!T||T.weekId!==v)&&(e=ie(v)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function ho(e,t){if(!e)return;await zn();let n=Array.isArray(T?.lessons)?T.lessons:[];if(!n.length)return;let r=n.find(u=>u?.id===e);if(!r)return;let o=typeof r.dayLabel=="string"&&r.dayLabel.trim()?r.dayLabel.trim():typeof r.dayName=="string"&&r.dayName.trim()?r.dayName.trim():"",s=typeof r.title=="string"&&r.title.trim()?r.title.trim():o||"Lesson",a=typeof r.summary=="string"&&r.summary.trim()?r.summary.trim():"",i=a||s,d=o?`${o} \xB7 ${i}`:i,l=a||"",m=Yr(r),y=Gr(un(v,m)),c={reminderTitle:d,reminderNotes:l,dueDate:y,dayLabel:o,lessonTitle:s,summary:a,plannerLessonId:e};ft("cue:prepare",{trigger:t,source:"planner"}),ft("planner:prefillReminder",c),ft("cue:open",{trigger:t,source:"planner"})}async function go(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),r=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":vo(r,t);break;case"edit":Lo(r,t);break;case"delete":To(r);break;case"move-up":Nn(r,"up",t);break;case"move-down":Nn(r,"down",t);break;case"create-reminder":await ho(r,t);break;default:break}}async function Qn(e){if(typeof document>"u"||!plannerLessonModalController)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=T?.lessons?.[0]?.dayLabel||"Monday";plannerLessonModalController.openAddLesson({defaultDay:n,trigger:t})}async function bo(e){if(!plannerLessonModalController)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=Pe(v,1);plannerLessonModalController.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function Eo(e){if(!j)return;let t=e?.currentTarget instanceof HTMLSelectElement?e.currentTarget:j,n=t.value?.trim();if(n){t.disabled=!0;try{let r=await ut(v,n);r&&(T=r,fe(r),te(r,v),ue(r))}catch(r){console.error("Failed to apply planner template",r),window.alert("Unable to apply that template right now.")}finally{Qe(n)}}}async function wo(e){if(e?.preventDefault?.(),!_n)return;let t=T||await $(v),n=Array.isArray(t?.lessons)?t.lessons:[];if(!n.length){window.alert("Add at least one lesson before saving a template.");return}let r=typeof window<"u"?window.prompt("Name this template:",t?.templateId||""):null,o=typeof r=="string"?r.trim():"";if(o)try{bn(o,{lessons:n}),Qe(o)}catch(s){console.error("Failed to save planner template",s),window.alert("Unable to save that template right now.")}}async function vo(e,t){if(!e||!plannerLessonModalController)return;let n=T?.lessons?.find(o=>o.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;plannerLessonModalController.openAddDetail({lesson:n,trigger:r})}async function Lo(e,t){if(!e||!plannerLessonModalController)return;let n=T?.lessons?.find(o=>o.id===e);if(!n)return;let r=t instanceof HTMLElement?t:null;plannerLessonModalController.openEditLesson({lesson:n,trigger:r})}async function Nn(e,t,n){if(!e||!t)return;let r=v||q();if(!r)return;let o=n instanceof HTMLElement?n:null;o&&o.setAttribute("disabled","true");try{let s=await yn(r,e,t);s&&(T=s,fe(s),te(s,r),ue(s))}catch(s){console.error("Failed to move planner lesson",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function To(e){if(!e||typeof window>"u")return;let t=T?.lessons?.find(r=>r.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let r=await pn(v,e);r&&(T=r,fe(r),te(r,v),ue(r))}catch(r){console.error("Failed to delete planner lesson",r),window.alert("Unable to delete that lesson right now.")}}function Je(){if(Le||!F){Le&&ie(v);return}Le=!0,dn({ensureFirestore:Ie}),F.addEventListener("click",yo),F.addEventListener("click",go),jr?.addEventListener("click",Qn),Vr?.addEventListener("click",bo),j?.addEventListener("change",Eo),_n?.addEventListener("click",wo),Ur?.addEventListener("click",()=>{let e=Pe(v,-1);ie(e)}),_r?.addEventListener("click",()=>{let e=Pe(v,1);ie(e)}),Wr?.addEventListener("click",()=>{ie(q())}),Qe(He()),ie(v)}function Pn(){typeof window>"u"||On()==="planner"&&Je()}function So(e){let t=e?.detail?.plan;t&&(Le&&t.weekId===v&&(T=t,fe(t),Gn(t.weekId),ue(t)),t.weekId===Ae&&te(t,Ae))}te(null,Ae);typeof document<"u"&&document.addEventListener(at,So);typeof window<"u"&&(window.addEventListener("hashchange",Pn),window.addEventListener("DOMContentLoaded",Pn));var Jn="dailyTasksByDate",_e=null;function Ct(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function xo(e){if(typeof e!="string")return"";let[t,n,r]=e.split("-"),o=Number.parseInt(t,10),s=Number.parseInt(n,10),a=Number.parseInt(r,10);if(!Number.isFinite(o)||!Number.isFinite(s)||!Number.isFinite(a))return e;let i=new Date(o,s-1,a);return Number.isNaN(i.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(i)}function ke(e){if(!vt)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);vt.disabled=!t}function Z(e){if(!J)return;if(!Array.isArray(e)||e.length===0){J.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',ke([]);return}let t=e.map((n,r)=>{let o=L(n?.text||""),s=!!n?.completed,a=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return s&&a.push("line-through","text-opacity-50"),`
        <div class="flex items-center p-3 border-b border-base-200" data-task-index="${r}">
          <input type="checkbox" class="checkbox checkbox-sm" data-task-index="${r}" data-task-text="${o}" ${s?"checked":""} />
          <span class="${a.join(" ")}">${o}</span>
        </div>
      `}).join("");J.innerHTML=t,ke(e)}function ze(){Ge&&Ge.classList.remove("hidden")}function Ao(){Ge&&Ge.classList.add("hidden")}function Bt(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function me(e){return Array.isArray(e)?e.map(t=>Bt(t)):[]}function Ft(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Jn);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function Xn(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(Jn,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Hn(e){let t=Ft(),n=t&&typeof t=="object"?t[e]:[];return me(n)}function Ve(e,t){let n=Ft(),r=me(t);return n[e]=r,Xn(n),r}function Et(e,t){let n=Ft(),r=me(n[e]);return r.push(Bt(t)),n[e]=r,Xn(n),r}function Xe(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Mt(){return _e||(_e=Ie().then(e=>{let{db:t,getCollection:n}=e,r=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:r}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),_e)}function Nt(e,t){let{doc:n,dailyListsCollection:r,db:o}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return r?n(r,t):n(o,"dailyLists",t)}async function Pt(){if(!Ln||!J)return;let e=Ct(),t=xo(e);if(Ln.textContent=t?`Today's List - ${t}`:"Today's List",X){ze();let n=Hn(e);return w=n,Z(n),Promise.resolve(n)}return Ue||(J.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',ke([]),Ue=(async()=>{try{let n=await Mt(),r=Nt(n,e),o=await n.getDoc(r),s=o.exists()?o.data()?.tasks:[];return w=me(s),Z(w),Ve(e,w),X=!1,Ao(),w}catch(n){if(Xe(n)){console.warn("Falling back to local daily tasks due to permission issue",n),X=!0,ze();let r=Hn(e);return w=r,Z(r),r}return console.error("Failed to load daily list",n),J.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',w=[],ke(w),w}})().finally(()=>{Ue=null})),Ue}async function ko(e){let t=Ct(),n=Bt(e);if(X){Et(t,n);return}try{let r=await Mt(),o=Nt(r,t),s=await r.getDoc(o);if(s.exists()&&typeof r.arrayUnion=="function")await r.updateDoc(o,{tasks:r.arrayUnion(n)});else{let a=s.exists()?s.data()?.tasks:[],i=Array.isArray(a)?me(a):[];i.push(n),typeof r.setDoc=="function"?await r.setDoc(o,{tasks:i},{merge:!0}):await r.updateDoc(o,{tasks:i})}Et(t,n)}catch(r){if(Xe(r)){console.warn("Saving task locally because cloud sync is unavailable",r),X=!0,ze(),Et(t,n);return}throw r}}async function Zn(e){let t=Ct(),n=me(e);if(X){Ve(t,n);return}try{let r=await Mt(),o=Nt(r,t);typeof r.setDoc=="function"?await r.setDoc(o,{tasks:n},{merge:!0}):await r.updateDoc(o,{tasks:n}),Ve(t,n)}catch(r){if(Xe(r)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",r),X=!0,ze(),Ve(t,n);return}throw r}}function er(e){[Ke,Ye].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function Io(){!Te||!Se||(Te.classList.remove("hidden"),Se.classList.add("hidden"),er(Ke))}function Do(){!Te||!Se||(Te.classList.add("hidden"),Se.classList.remove("hidden"),er(Ye),Pt())}Ke&&Ye&&Te&&Se&&(Ke.addEventListener("click",e=>{e.preventDefault(),Io()}),Ye.addEventListener("click",e=>{e.preventDefault(),Do()}));var x=null,M=!1,je=null;function de(e){if(!B)return;B.setAttribute("aria-pressed",e?"true":"false");let t=B.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":B.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function Co(){M&&(window.clearTimeout(je),je=window.setTimeout(()=>{je=null,M&&tr(!0)},400))}function tr(e=!1){if(!x)return!1;if(M&&!e)return!0;try{return x.start(),M=!0,de(!0),!0}catch{return M=!1,de(!1),!1}}function Ht(){if(x){M=!1,window.clearTimeout(je);try{x.stop()}catch{}de(!1)}}function Bo(){if(B)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){B.setAttribute("disabled","true"),B.setAttribute("aria-disabled","true"),B.title="Voice input is not supported in this browser.";return}x=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(x.lang=t,x.interimResults=!1,"continuous"in x)try{x.continuous=!0}catch{}x.onresult=n=>{let r=n?.results?.[0]?.[0]?.transcript||"";if(r&&D){D.value=r.trim();try{D.focus({preventScroll:!0})}catch{D.focus()}try{let o=D.value.length;D.setSelectionRange(o,o)}catch{}}},x.onend=()=>{if(!M){de(!1);return}Co()},x.onerror=()=>{M=!1,de(!1)}}catch{x=null,de(!1),B.setAttribute("disabled","true"),B.setAttribute("aria-disabled","true")}}Bo();B?.addEventListener("click",()=>{x&&(M?Ht():tr())});Un?.addEventListener("submit",()=>{M&&Ht()});window.addEventListener("pagehide",()=>{M&&Ht()});Un?.addEventListener("submit",async e=>{if(e.preventDefault(),!D)return;let t=D.value.trim();if(!t){D.focus();return}let n={text:t,completed:!1};D.value="",D.focus();try{await ko(n),await Pt()}catch(r){console.error("Failed to add task to the daily list",r),D.value=t,D.focus()}});J?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(w)||Number.isNaN(n)||!w[n])return;let r=w.map(s=>({...s})),o=r.map((s,a)=>a===n?{...s,completed:t.checked}:s);w=o,Z(o);try{await Zn(o)}catch(s){console.error("Failed to update task completion state",s),w=r,Z(r)}});vt?.addEventListener("click",async()=>{if(!Array.isArray(w)||w.length===0)return;let e=w.filter(n=>!n.completed);if(e.length===w.length)return;let t=w.map(n=>({...n}));w=e,Z(e);try{await Zn(e)}catch(n){console.error("Failed to clear completed tasks",n),w=t,Z(t)}});ke(w);Pt();function Fo(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),r=document.getElementById("noteNewBtn"),o=document.getElementById("notesList");if(!e||!t||!n||!r)return;let s=null,a=c=>{if(!c){s=null,e.value="",t.value="";return}s=c.id,e.value=c.title||"",t.value=c.body||""},i=()=>{if(!o)return;o.querySelectorAll("button[data-note-id]").forEach(u=>{if(!(u instanceof HTMLElement))return;let h=u.getAttribute("data-note-id")===s;u.classList.toggle("bg-base-200/80",h),u.classList.toggle("border-base-300",!h),u.classList.toggle("border-primary",h),u.classList.toggle("font-medium",h),u.setAttribute("aria-current",h?"true":"false")})},d=()=>{let c=Ce();return Array.isArray(c)?[...c].sort((u,h)=>{let b=Date.parse(u?.updatedAt||""),g=Date.parse(h?.updatedAt||"");return(Number.isNaN(g)?0:g)-(Number.isNaN(b)?0:b)}):[]},l=c=>{if(!c)return;let u=Ce();if(!Array.isArray(u))return;let h=u.filter(g=>g.id!==c);if(h.length===u.length)return;tt(h),s===c&&(s=null);let b=m();if(s){let g=b.find(S=>S.id===s)||null;a(g)}else b.length?a(b[0]):a(null);i()},m=(c=d())=>{if(!o)return c;if(o.innerHTML="",!c.length){let u=document.createElement("li");return u.className="text-sm italic text-base-content/60",u.textContent="No saved notes yet.",o.appendChild(u),c}return c.forEach(u=>{let h=document.createElement("li");h.className="flex items-center gap-2";let b=document.createElement("button");b.type="button",b.dataset.noteId=u.id,b.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",b.textContent=u.title||"Untitled note",b.addEventListener("click",()=>{a(u),i()});let g=document.createElement("button");g.type="button",g.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",g.setAttribute("aria-label",`Delete note "${u.title||"Untitled note"}"`),g.textContent="Delete",g.addEventListener("click",S=>{S.stopPropagation(),l(u.id)}),h.appendChild(b),h.appendChild(g),o.appendChild(h)}),i(),c},y=()=>{let c=m();if(!c.length){a(null),i();return}let u=s?c.find(h=>h.id===s):null;a(u||c[0]),i()};n.addEventListener("click",()=>{let c=Ce(),u=Array.isArray(c)?[...c]:[],h=typeof e.value=="string"?e.value.trim():"",b=typeof t.value=="string"?t.value:"",g=h||"Untitled note",S=new Date().toISOString();if(s){let k=u.findIndex(C=>C.id===s);if(k>=0)u[k]={...u[k],title:g,body:b,updatedAt:S};else{let C=et(g,b,{updatedAt:S});s=C.id,u.unshift(C)}}else{let k=et(g,b);s=k.id,u.unshift(k)}tt(u);let E=m(),N=s?E.find(k=>k.id===s):null;a(N||null),i()}),r.addEventListener("click",()=>{s=null,e.value="",t.value="",i(),typeof e.focus=="function"&&e.focus()}),y()}Fo();var nr="theme",Mo="professional",At="memoryCue:theme-change",No="professional",kt=document.getElementById("theme-menu"),rr="[data-theme-name],[data-theme-option]",Po=new Set(["dark","dracula","synthwave"]);function Y(e){return typeof e=="string"?e.trim():""}function or(e){return e instanceof HTMLElement?Y(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Ho(e){let t=Y(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",Po.has(t)))}function Rn(e){let t=Y(e);if(t)try{localStorage.setItem(nr,t)}catch(n){console.warn("Unable to save theme preference",n)}}function sr(e){if(!kt)return;let t=Y(e);kt.querySelectorAll(rr).forEach(r=>{if(!(r instanceof HTMLElement))return;let o=or(r),s=t&&o===t;r.setAttribute("aria-checked",s?"true":"false"),r.classList.toggle("active",s)})}function Ro(e){let t=Y(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(At,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let r=document.createEvent("CustomEvent");r.initCustomEvent(At,!0,!0,{theme:t}),window.dispatchEvent(r)}}}function It(e,{persist:t=!0,notify:n=!0}={}){let r=Y(e);if(!r)return;Y(document.documentElement.getAttribute("data-theme"))!==r&&Ho(r),t&&Rn(r),sr(r),n&&Ro(r)}function Oo(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){It(No,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(nr)||""}catch(r){console.warn("Unable to load theme preference",r)}let n=t||document.documentElement.getAttribute("data-theme")||Mo;n&&It(n,{persist:!1,notify:!0})}kt?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(rr):null;if(!t)return;e.preventDefault();let n=or(t);n&&It(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(At,e=>{let t=Y(e?.detail?.theme);t&&sr(t)});Oo()});export default $o();
