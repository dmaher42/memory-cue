import{a as Bn,b as bo,c as Ke,d as Eo,f as Ct,g as Ye,h as It,i as wo,j as Fn,k as vo}from"./chunk-P37YOGFR.js";import{a as Pn,b as ho}from"./chunk-MG4MJA24.js";import"./chunk-CTK42JWW.js";import{b as kt,c as go}from"./chunk-GUVSRPRW.js";function Rn(e,t=document){return!Array.isArray(e)||!t||typeof t.getElementById!="function"?[]:e.map(({key:n,ids:s})=>{if(!Array.isArray(s))return null;for(let o of s){if(typeof o!="string"||!o)continue;let a=t.getElementById(o);if(a)return{key:n,element:a}}return null}).filter(n=>!!(n&&n.element))}function he(e,t){if(!e||typeof e!="object")return"";let n=So[t]||[t];for(let s of n)if(Object.prototype.hasOwnProperty.call(e,s)){let o=e[s];return o==null?"":typeof o=="string"?o:String(o)}return""}function Lo(e,t){if(!e)return;let n=t??"";if(e instanceof HTMLInputElement){e.type==="checkbox"?e.checked=!!n:e.value=typeof n=="string"?n:String(n);return}(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(e.value=typeof n=="string"?n:String(n))}function To(e){return e?e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value:"":""}function $n(e,t){Array.isArray(t)&&t.forEach(({key:n,element:s})=>{let o=e&&typeof e=="object"?he(e,n):"";Lo(s,o)})}function _n(e,t,n,s){Array.isArray(e)&&e.forEach(({element:o})=>{o instanceof HTMLInputElement?["checkbox","radio"].includes(o.type)?o.checked=!1:o.value="":(o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement)&&(o.value="")}),t&&(t.value=""),n&&(n.textContent=s)}function On(e){let t={};return Array.isArray(e)&&e.forEach(({key:n,element:s})=>{let o=To(s);if(typeof o=="boolean"){t[n]=o;return}let a=typeof o=="string"?o.trim():o;t[n]=a??""}),t}function C(e){return e==null?"":String(e).replace(/[&<>'"]/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}var Hn,So,Dt,Nt,qn=kt(()=>{Hn=[{key:"title",ids:["cue-title","title"]},{key:"details",ids:["cue-details","details","cue-description"]},{key:"date",ids:["cue-date","date"]},{key:"time",ids:["cue-time","time"]},{key:"priority",ids:["cue-priority","priority"]},{key:"category",ids:["cue-category","category"]}],So={title:["title","name"],details:["details","description","notes","body"],date:["date","dueDate","due_date"],time:["time","dueTime","due_time"],priority:["priority","level"],category:["category","tag"]},Dt="Create Cue",Nt="Edit Cue"});function Un(e){return new Mt(e)}var xo,Ao,Mt,jn=kt(()=>{xo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),Ao={prepare:"cue:prepare",openRequest:"cue:open",closeRequest:"cue:close",cancelled:"cue:cancelled",shown:"cue:shown",hidden:"cue:hidden"},Mt=class e{static activeStack=[];constructor(t={}){this.modal=t.modalElement??null,this.openButton=t.openButton??null,this.closeButton=t.closeButton??null,this.backdropButton=t.backdropButton??null,this.titleInput=t.titleInput??null,this.modalTitle=t.modalTitle??null,this.defaultTitle=t.defaultTitle??"",this.editTitle=t.editTitle??t.defaultTitle??"",this.isOpen=!1,this.isDestroyed=!1,this.manageAria=t.manageAria!==!1,this.enableFocusTrap=t.focusTrap!==!1,this.shouldAutoFocus=t.autoFocus!==!1,this.eventTarget=t.eventTarget??document,this.events={...Ao,...t.events||{}},this.animationHooks=t.animationHooks??{},this.enableStacking=t.enableStacking!==!1,this.isDisabled=!1,this.isValid=!1,this.previouslyFocusedElement=null,this.boundHandlers={handleOpenClick:this.handleOpenClick.bind(this),handleCloseClick:this.handleCloseClick.bind(this),handleBackdropClick:this.handleBackdropClick.bind(this),handleCancel:this.handleCancel.bind(this),handleKeydown:this.handleKeydown.bind(this),handleDocumentOpenRequest:this.handleDocumentOpenRequest.bind(this),handleDocumentCloseRequest:this.handleDocumentCloseRequest.bind(this)},this.init()}init(){if(this.validateModal(),!this.isValid){this.isDisabled=!0;return}this.manageAria&&this.applyAriaAttributes(),this.setupEventListeners()}validateModal(){return this.modal instanceof HTMLElement?(this.isValid=!0,typeof this.modal.showModal!="function"&&(this.modal.showModal=this.modal.showModal||(()=>{this.modal?.setAttribute("open","")})),typeof this.modal.close!="function"&&(this.modal.close=this.modal.close||(()=>{this.modal?.removeAttribute("open")})),this.modal.hasAttribute("tabindex")||(this.modal.tabIndex=-1),!0):(console.warn("[ModalController] Modal element is not provided or invalid.",this.modal),this.isValid=!1,!1)}applyAriaAttributes(){this.modal&&(this.modal.setAttribute("role",this.modal.getAttribute("role")||"dialog"),this.modal.setAttribute("aria-modal","true"),this.modalTitle&&this.modalTitle.id&&this.modal.setAttribute("aria-labelledby",this.modalTitle.id),this.titleInput&&this.titleInput.id&&this.modal.setAttribute("aria-describedby",this.titleInput.id),this.modal.setAttribute("aria-hidden","true"))}async show(t={}){if(!(!this.modal||this.isDestroyed||this.isDisabled)){if(this.isOpen){this.shouldAutoFocus&&this.focusTitleInput();return}await this.runHook("onBeforeShow"),this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.enableStacking&&this.addToStack(),typeof this.modal.showModal=="function"&&!this.modal.open?this.modal.showModal():this.modal.setAttribute("open",""),this.modal.setAttribute("aria-hidden","false"),this.isOpen=!0,this.shouldAutoFocus&&this.focusTitleInput(),this.dispatchEvent("shown",{controller:this,...t}),await this.runHook("onAfterShow")}}async hide(t={}){!this.modal||this.isDestroyed||this.isDisabled||!this.isOpen||(await this.runHook("onBeforeHide"),typeof this.modal.close=="function"&&this.modal.open?this.modal.close():this.modal.removeAttribute("open"),this.modal.setAttribute("aria-hidden","true"),this.isOpen=!1,this.removeFromStack(),await this.restoreFocus(),this.dispatchEvent("hidden",{controller:this,...t}),await this.runHook("onAfterHide"))}focusTitleInput(){let t=this.titleInput||this.modal?.querySelector("[autofocus]");!t||typeof t.focus!="function"||window.setTimeout(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}},50)}async restoreFocus(){let t=this.previouslyFocusedElement||this.openButton;if(t&&typeof t.focus=="function")try{t.focus({preventScroll:!0})}catch{t.focus()}this.previouslyFocusedElement=null}setupEventListeners(){this.modal&&(this.openButton&&this.openButton.addEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.addEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.addEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.addEventListener("cancel",this.boundHandlers.handleCancel),this.modal.addEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.addEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.addEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}cleanup(){this.modal&&(this.openButton&&this.openButton.removeEventListener("click",this.boundHandlers.handleOpenClick),this.closeButton&&this.closeButton.removeEventListener("click",this.boundHandlers.handleCloseClick),this.backdropButton&&this.backdropButton.removeEventListener("click",this.boundHandlers.handleBackdropClick),this.modal.removeEventListener("cancel",this.boundHandlers.handleCancel),this.modal.removeEventListener("keydown",this.boundHandlers.handleKeydown),this.eventTarget&&(this.eventTarget.removeEventListener(this.events.openRequest,this.boundHandlers.handleDocumentOpenRequest),this.eventTarget.removeEventListener(this.events.closeRequest,this.boundHandlers.handleDocumentCloseRequest)))}async destroy(t={}){this.isDestroyed||(await this.hide(t),this.cleanup(),this.isDestroyed=!0)}setEditMode(t=!1){this.modalTitle&&(this.modalTitle.textContent=t?this.editTitle:this.defaultTitle),this.modal&&this.modal.setAttribute("data-mode",t?"edit":"create"),this.currentMode=t?"edit":"create"}handleOpenClick(t){t.preventDefault(),this.dispatchEvent("prepare",{mode:"create",controller:this}),this.setEditMode(!1),this.show({reason:"open-button"})}handleCloseClick(t){t.preventDefault(),this.requestClose("user-dismissed")}handleBackdropClick(t){t.preventDefault(),this.requestClose("backdrop")}handleCancel(t){t.preventDefault(),this.requestClose("keyboard")}handleKeydown(t){this.enableFocusTrap&&t.key==="Tab"&&this.maintainFocus(t),t.key==="Escape"&&this.requestClose("keyboard")}maintainFocus(t){if(!this.modal)return;let n=this.getFocusableElements();if(n.length===0){t.preventDefault(),this.modal.focus();return}let s=n[0],o=n[n.length-1],a=document.activeElement;t.shiftKey&&a===s?(t.preventDefault(),o.focus()):!t.shiftKey&&a===o&&(t.preventDefault(),s.focus())}getFocusableElements(){return this.modal?Array.from(this.modal.querySelectorAll(xo)).filter(t=>!(t instanceof HTMLElement)||t.hasAttribute("disabled")?!1:t.getAttribute("aria-hidden")!=="true"):[]}handleDocumentOpenRequest(t){if(!t||t.detail&&t.detail.controller&&t.detail.controller!==this)return;let n=t?.detail?.mode==="edit";this.setEditMode(n),this.show({reason:t?.detail?.reason||"external-open",mode:t?.detail?.mode})}handleDocumentCloseRequest(t){if(!t||t.detail?.controller&&t.detail.controller!==this||t.detail?.initiatedBy==="controller")return;let n=t.detail?.reason||"external-close";this.hide({reason:n})}dispatchEvent(t,n={}){let s=this.events[t];if(!s||!this.eventTarget||typeof this.eventTarget.dispatchEvent!="function")return;let o=new CustomEvent(s,{detail:n,bubbles:!1,cancelable:!0});this.eventTarget.dispatchEvent(o)}requestClose(t){let n={reason:t,controller:this};this.dispatchEvent("cancelled",n),this.dispatchEvent("closeRequest",{...n,initiatedBy:"controller"}),this.hide({reason:t})}async runHook(t){let n=this.animationHooks?.[t];typeof n=="function"&&await n(this)}addToStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),t.push(this),this.stackIndex=t.length-1,this.modal?.setAttribute("data-stack-index",String(this.stackIndex))}removeFromStack(){let t=e.activeStack,n=t.indexOf(this);n!==-1&&t.splice(n,1),this.stackIndex=void 0,this.modal&&this.modal.removeAttribute("data-stack-index")}}});var Wn,Pt,Xe,Bt,ko,Co,Ft,Vn,Io,zn,Je,Do,No,Mo,Kn,Po,Ht,de,Bo,Yn,Ie,Gn,Fo,Xn,Rt,Qe,Ce,Ge,be,Qn,ne,Zn,Jn,Ze,Ho,ke,se,es,oe,De,ts,$t,ns,V,et,ae,ss,os,as,_t,Ot,rs,is=kt(()=>{Wn="memoryCue:plannerPlans",Pt="memoryCue:plannerUpdated",Xe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Bt=()=>{try{return typeof window<"u"&&typeof window.localStorage<"u"}catch{return!1}},ko=e=>{if(!Bt()||!e)return null;try{return window.localStorage.getItem(e)}catch{return null}},Co=e=>{try{return JSON.parse(e)}catch{return null}},Ft=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`planner-${Date.now()}-${Math.random().toString(16).slice(2)}`,Vn=e=>!Number.isFinite(e)||e<0?0:e>6?6:e,Io=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return null;let t=new Date(e),s=(t.getDay()+6)%7;return t.setHours(0,0,0,0),t.setDate(t.getDate()-s),t},zn=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},Je=e=>{if(typeof e!="string")return null;let[t,n,s]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),i=Number.parseInt(s,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(i))return null;let r=new Date(o,a-1,i);return Number.isNaN(r.getTime())?null:(r.setHours(0,0,0,0),r)},Do=e=>{if(typeof e!="string")return 0;let t=e.trim().toLowerCase(),n=Xe.findIndex(s=>s.toLowerCase()===t);return n>=0?n:0},No=new Set(["not_started","in_progress","ready","taught"]),Mo=new Set(["simple","hpe","english","cac","custom"]),Kn=e=>{if(!e||typeof e!="object")return null;let t=typeof e.text=="string"?e.text.trim():"";if(!t)return null;let n=typeof e.badge=="string"?e.badge.trim():"";return{id:typeof e.id=="string"&&e.id.trim()?e.id:Ft(),badge:n,text:t}},Po=e=>{if(!e||typeof e!="object")return null;let t=typeof e.label=="string"?e.label.trim():"",n=typeof e.url=="string"?e.url.trim():"";return!t&&!n?null:{id:typeof e.id=="string"&&e.id.trim()?e.id:Ft(),label:t,url:n}},Ht=(e,t={})=>{let n=typeof t=="object"&&t?t:{},s=Number.isFinite(e?.dayIndex)?e.dayIndex:Number.isFinite(n.dayIndex)?n.dayIndex:Do(e?.dayName||n.dayName||n.dayLabel),o=Vn(s),a=typeof e?.title=="string"&&e.title.trim().length?e.title.trim():typeof n.title=="string"&&n.title.trim().length?n.title.trim():Xe[o],i=typeof e?.summary=="string"?e.summary.trim():typeof n.summary=="string"?n.summary:"",l=(Array.isArray(e?.details)?e.details:Array.isArray(n.details)?n.details:[]).map(E=>Kn(E)).filter(Boolean),u=typeof e?.id=="string"&&e.id.trim()?e.id:typeof n.id=="string"&&n.id.trim()?n.id:Ft(),b=Number.isFinite(e?.position)?e.position:Number.isFinite(n.position)?n.position:Number.NaN,y=typeof e?.notes=="string"?e.notes:typeof n.notes=="string"?n.notes:"",w=typeof e?.subject=="string"?e.subject.trim():typeof n.subject=="string"?n.subject.trim():"",A=typeof e?.status=="string"?e.status.trim().toLowerCase():"",I=No.has(A)?A:"not_started",B=typeof e?.templateType=="string"?e.templateType.trim().toLowerCase():"",P=Mo.has(B)?B:"simple",T=(Array.isArray(e?.resources)?e.resources:Array.isArray(n.resources)?n.resources:[]).map(E=>Po(E)).filter(Boolean),m=typeof e?.weekDay=="string"?e.weekDay.trim():typeof n.weekDay=="string"?n.weekDay.trim():Xe[o],f=typeof e?.period=="string"?e.period.trim():typeof n.period=="string"?n.period.trim():"";return{id:u,dayIndex:o,dayLabel:Xe[o]||"Lesson",title:a,summary:i,details:l,notes:y,subject:w,status:I,templateType:P,resources:T,weekDay:m,period:f,position:Number.isFinite(b)?b:null}},de=e=>[...e].sort((t,n)=>{if(t.dayIndex!==n.dayIndex)return t.dayIndex-n.dayIndex;let s=Number.isFinite(t.position),o=Number.isFinite(n.position);return s&&o&&t.position!==n.position?t.position-n.position:s&&!o?-1:!s&&o?1:t.title.localeCompare(n.title)}),Bo=e=>{let t=new Map;return e.forEach(n=>{let s=String(n.dayIndex),o=t.get(s)??0;Number.isFinite(n.position)?t.set(s,Math.max(o,n.position+1)):(n.position=o,t.set(s,o+1))}),e},Yn=(e,t,n)=>{let s=e.filter(o=>!(o.dayIndex!==t||n&&o.id===n));return s.length?s.reduce((o,a)=>Number.isFinite(a.position)?Math.max(o,a.position):o,-1)+1:0},Ie=(e,t)=>{let n=typeof e?.weekId=="string"&&e.weekId?e.weekId:t,s=Je(n),o=Array.isArray(e?.lessons)?Bo(e.lessons.map(a=>Ht(a)).filter(Boolean)):[];return{weekId:n,startDate:s?s.toISOString():"",lessons:de(o),teacherNotes:typeof e?.teacherNotes=="string"?e.teacherNotes:"",updatedAt:typeof e?.updatedAt=="string"?e.updatedAt:new Date().toISOString()}},Gn=()=>{if(!Bt())return{};try{let e=ko(Wn);if(typeof e!="string"||!e.length)return{};let t=Co(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read planner data from storage",e),{}}},Fo=e=>{if(Bt())try{window.localStorage.setItem(Wn,JSON.stringify(e))}catch(t){console.warn("Unable to persist planner data locally",t)}},Xn=e=>{if(!e)return null;let n=Gn()[e];return n?Ie(n,e):null},Rt=(e,t)=>{if(!e||!t)return t;let n=Gn();return n[e]=t,Fo(n),t},Qe=new Map,Ce=null,Ge=null,be=!1,Qn=e=>{let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t&&(t.includes("permission-denied")||t.includes("insufficient-permission")))return!0;let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))},ne=e=>{if(!(typeof document>"u"))try{let t=new CustomEvent(Pt,{detail:{plan:e}});document.dispatchEvent(t)}catch(t){console.warn("Unable to dispatch planner update event",t)}},Zn=async()=>Ce?Ge||(Ge=Ce().then(e=>{let{db:t,getCollection:n}=e||{},s=typeof n=="function"&&t?n(t,"plannerPlans"):null;return{...e,plannerCollection:s}}).catch(e=>{throw console.error("Failed to initialise Firestore for planner",e),e}),Ge):null,Jn=(e,t)=>{if(!e)throw new Error("Planner Firestore context is unavailable");let{doc:n,plannerCollection:s,db:o}=e;if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return s?n(s,t):n(o,"plannerPlans",t)},Ze=e=>(e&&typeof e=="object"&&typeof e.weekId=="string"&&Qe.set(e.weekId,e),e),Ho=e=>Ie({weekId:e,lessons:[]},e),ke=e=>{let t=Xn(e);if(t)return Ze(t),t;let n=Ho(e);return Rt(e,n),Ze(n),n},se=async e=>{if(!e?.weekId)return e;let t=Ie(e,e.weekId);if(Rt(t.weekId,t),Ze(t),be||!Ce)return t;try{let n=await Zn();if(!n)return t;let s=Jn(n,t.weekId);return typeof n.setDoc=="function"?await n.setDoc(s,t,{merge:!0}):await n.updateDoc(s,t),t}catch(n){return Qn(n)?(console.warn("Persisting planner data locally due to permission issue",n),be=!0,t):(console.error("Failed to persist planner plan",n),t)}},es=(e={})=>{typeof e.ensureFirestore=="function"&&(Ce=e.ensureFirestore),typeof e.forceLocal=="boolean"&&(be=e.forceLocal)},oe=(e=new Date)=>{let t=Io(e);return zn(t)},De=(e,t=0)=>{let n=Je(e);if(!n||!Number.isFinite(t))return e;let s=new Date(n);return s.setDate(n.getDate()+t*7),zn(s)},ts=(e=oe(),t=0)=>{let n=Je(e);if(!n)return null;let s=Number.isFinite(t)?t:0,o=Vn(s),a=new Date(n);return a.setDate(n.getDate()+o),a},$t=(e,{short:t=!1}={})=>{let n=Je(e);if(!n)return"";let s=new Date(n);s.setDate(n.getDate()+6);let o=new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric"}),a=o.format(n),i=o.format(s),r=n.getFullYear()===s.getFullYear();if(t)return`Week of ${a}`;let l=r?n.getFullYear():`${n.getFullYear()} \u2013 ${s.getFullYear()}`;return`${a} \u2013 ${i}, ${l}`},ns=(e=oe())=>{if(!e)return[];let t=Qe.get(e);if(t&&Array.isArray(t.lessons))return[...t.lessons];let n=Xn(e);return Array.isArray(n?.lessons)?[...n.lessons]:[]},V=async(e=oe())=>{if(!e)return null;if(Qe.has(e))return Qe.get(e);if(be||!Ce)return ke(e);try{let t=await Zn();if(!t)return ke(e);let n=Jn(t,e),s=await t.getDoc(n);if(s.exists()){let a=s.data(),i=Ie({...a,weekId:e},e);return Rt(e,i),Ze(i),be=!1,i}let o=ke(e);return typeof t.setDoc=="function"&&await t.setDoc(n,o,{merge:!0}),o}catch(t){return Qn(t)?(console.warn("Falling back to local planner data due to permission issue",t),be=!0,ke(e)):(console.error("Failed to load planner data",t),ke(e))}},et=async(e,t)=>{if(!e)return null;let n=await V(e),s=Ht(t);s.position=Yn(n?.lessons||[],s.dayIndex);let o={...n,lessons:de([...n?.lessons||[],s]),updatedAt:new Date().toISOString()},a=await se(o);return ne(a),a},ae=async(e,t,n={})=>{if(!e||!t)return null;let s=await V(e),o=[...s?.lessons||[]],a=o.findIndex(b=>b.id===t);if(a===-1)return s;let i=o[a],r=Ht({...i,...n,id:t},i);if(r.dayIndex!==i.dayIndex){let b=o.filter((y,w)=>w!==a);r.position=Yn(b,r.dayIndex)}o[a]=r;let l={...s,lessons:de(o),updatedAt:new Date().toISOString()},u=await se(l);return ne(u),u},ss=async(e,t="")=>{if(!e)return null;let n=await V(e),s={...n,teacherNotes:typeof t=="string"?t:n?.teacherNotes||"",updatedAt:new Date().toISOString()},o=await se(s);return ne(o),o},os=async(e,t)=>{if(!e||!t)return null;let n=await V(e),s=(n?.lessons||[]).filter(i=>i.id!==t),o={...n,lessons:de(s),updatedAt:new Date().toISOString()},a=await se(o);return ne(a),a},as=async(e,t,n)=>{if(!e||!t||!n)return null;let s=n==="up"?-1:n==="down"?1:0;if(!s)return V(e);let o=await V(e),a=[...o?.lessons||[]],i=a.findIndex(T=>T.id===t);if(i===-1)return o;let r=a[i],l=a.filter(T=>T.dayIndex===r.dayIndex);if(l.length<=1)return o;let b=de(l).map(T=>T.id),y=b.indexOf(t);if(y===-1)return o;let w=y+s;if(w<0||w>=b.length)return o;let[A]=b.splice(y,1);b.splice(w,0,A);let I=new Map(b.map((T,m)=>[T,m])),B=a.map(T=>{if(T.dayIndex!==r.dayIndex)return T;let m=I.get(T.id);return typeof m=="number"?{...T,position:m}:T}),P={...o,lessons:de(B),updatedAt:new Date().toISOString()},M=await se(P);return ne(M),M},_t=async(e,t,n)=>{if(!e||!t)return null;let s=await V(e),o=[...s?.lessons||[]],a=o.findIndex(y=>y.id===t);if(a===-1)return s;let i=Kn(n);if(!i)return s;let r=o[a],l={...r,details:[...r.details||[],i]};o[a]=l;let u={...s,lessons:de(o),updatedAt:new Date().toISOString()},b=await se(u);return ne(b),b},Ot=async(e,t)=>{if(!e||!t)return null;let n=await V(e),s=(n?.lessons||[]).map(i=>({title:i.title,summary:i.summary,dayIndex:i.dayIndex,notes:typeof i.notes=="string"?i.notes:"",subject:typeof i.subject=="string"?i.subject:"",period:typeof i.period=="string"?i.period:"",weekDay:typeof i.weekDay=="string"?i.weekDay:"",templateType:typeof i.templateType=="string"?i.templateType:"simple",status:"not_started",resources:Array.isArray(i.resources)?i.resources.map(r=>({label:r?.label||"",url:r?.url||""})):[],details:(i.details||[]).map(r=>({badge:r.badge,text:r.text}))})),o=Ie({weekId:t,lessons:s,teacherNotes:typeof n?.teacherNotes=="string"?n.teacherNotes:""},t);o.updatedAt=new Date().toISOString();let a=await se(o);return ne(a),a},rs=async e=>{if(!e)return null;let t=await V(e);if(!t)return null;let n={...t,lessons:[],updatedAt:new Date().toISOString()},s=await se(n);return ne(s),s}});var Sr=go(()=>{ho();Eo();qn();jn();bo();wo();vo();is();Pn();function Ro(){if(typeof document>"u")return;let e=document.getElementById("add-reminder-modal")??document.getElementById("reminder-modal"),t=document.getElementById("add-reminder-form")??document.getElementById("reminder-form"),n=document.getElementById("reminder-title");if(!t||!n)return;let s=document.querySelectorAll("[data-open-reminder-modal]");if(!s.length)return;if(!e){let d=()=>{if(!(!(n instanceof HTMLElement)||typeof n.focus!="function"))try{n.focus({preventScroll:!1})}catch{n.focus()}};s.forEach(p=>{p.addEventListener("click",N=>{if(N.preventDefault(),typeof window<"u"){let k="#reminders";window.location.hash!==k&&(window.location.hash=k),typeof window.renderRoute=="function"&&window.renderRoute()}window.requestAnimationFrame(()=>{d()})})});return}let o=e.querySelector("[data-reminder-modal-backdrop]"),a=e.querySelectorAll("[data-close-modal]"),i=document.getElementById("mainContent"),r=document.querySelector('nav[aria-label="Primary"]'),l=[i,r],u=e.querySelector('[role="dialog"]')??e,b=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],y=null,w=()=>{if(!(u instanceof HTMLElement))return[];let d=u.querySelectorAll(b.join(","));return Array.from(d).filter(p=>{let N=p instanceof HTMLElement,k=typeof SVGElement<"u"&&p instanceof SVGElement;if(!N&&!k||p.getAttribute("aria-hidden")==="true"||"disabled"in p&&p.disabled||p.hidden||p.closest("[hidden]"))return!1;let O=p.getBoundingClientRect();return O.width>0&&O.height>0})},A=()=>{let d=w(),p=d.find(N=>N.hasAttribute("data-autofocus")||N.hasAttribute("autofocus"))||(n&&d.includes(n)?n:null)||d[0];if(p&&typeof p.focus=="function"){p.focus({preventScroll:!0});return}u instanceof HTMLElement&&typeof u.focus=="function"&&u.focus({preventScroll:!0})},I=d=>{u instanceof HTMLElement&&(!(d.target instanceof Node)||!u.contains(d.target))&&(d.stopPropagation(),A())},B=d=>{if(d.key!=="Tab")return;let p=w();if(!p.length){d.preventDefault(),u instanceof HTMLElement&&u.focus({preventScroll:!0});return}let N=p[0],k=p[p.length-1],O=document.activeElement;if(d.shiftKey){(!u.contains(O)||O===N)&&(d.preventDefault(),k.focus());return}(!u.contains(O)||O===k)&&(d.preventDefault(),N.focus())},P=d=>{l.forEach(p=>{p&&(d?p.setAttribute("inert",""):p.removeAttribute("inert"))})},M=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),P(!1),document.removeEventListener("keydown",T,!0),e.removeEventListener("keydown",B,!0),e.removeEventListener("focusin",I,!0),y&&typeof y.focus=="function"&&y.focus(),y=null},T=d=>{d.key==="Escape"&&(d.preventDefault(),M())},m=({triggerElement:d}={})=>{d&&typeof d.focus=="function"?y=d:y=document.activeElement,e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),P(!0),document.addEventListener("keydown",T,!0),e.addEventListener("keydown",B,!0),e.addEventListener("focusin",I,!0),window.requestAnimationFrame(()=>{A()})},f=(d,p={})=>{try{document.dispatchEvent(new CustomEvent(d,{detail:p}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let N=document.createEvent("CustomEvent");N.initCustomEvent(d,!0,!0,p),document.dispatchEvent(N)}}},E=(d={})=>{f("cue:cancelled",d)};s.forEach(d=>{d.addEventListener("click",p=>{p.preventDefault();let k={trigger:p.currentTarget instanceof HTMLElement?p.currentTarget:null,mode:"create"};f("cue:prepare",k),f("cue:open",k)})}),a.forEach(d=>{d.addEventListener("click",p=>{p.preventDefault(),E({trigger:d,reason:"button"})})}),e.addEventListener("click",d=>{d.target===e&&E({reason:"backdrop"})}),o?.addEventListener("click",d=>{d.target===o&&E({reason:"backdrop"})}),document.addEventListener("cue:open",d=>{let p=d?.detail?.trigger,N=p instanceof HTMLElement?p:null;m({triggerElement:N})});let S=()=>{M()};document.addEventListener("cue:close",S),document.addEventListener("cue:cancelled",S);let L=e.querySelector("#saveReminder");t instanceof HTMLFormElement&&L instanceof HTMLElement&&t.addEventListener("submit",d=>{d.preventDefault(),!L.matches(":disabled")&&L.click()}),L instanceof HTMLElement&&document.addEventListener("reminder:save",d=>{let p=d?.detail?.trigger;p&&p!==L||L.matches(":disabled")||L.click()})}Ro();function qt(e,t={}){if(!(typeof document>"u"||!e))try{document.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{if(typeof document.createEvent=="function"){let n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),document.dispatchEvent(n)}}}var ls=null;function $o(e){return!e||typeof document>"u"?null:document.querySelector(`[data-route="${e}"]`)}function Ns(){if(typeof window>"u")return"";let e=window.location.hash||"#dashboard";return(e.startsWith("#")?e.slice(1):e)||"dashboard"}function _o(e){typeof document>"u"||!e||(window.clearTimeout(ls),ls=window.setTimeout(()=>{let t=$o(e);if(!t)return;let n=t.querySelector("h1, [data-primary-heading]");if(n instanceof HTMLElement&&(n.hasAttribute("tabindex")||n.setAttribute("tabindex","-1"),typeof n.focus=="function"))try{n.focus({preventScroll:!0})}catch{n.focus()}},0))}function Be(e){let t=e||Ns();t&&_o(t)}function Oo(){if(typeof document>"u"||typeof window>"u")return;let e=()=>{Be()};window.addEventListener("hashchange",e),window.addEventListener("DOMContentLoaded",e),document.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",s=>{if(!(s.currentTarget instanceof HTMLAnchorElement))return;let o=s.currentTarget.getAttribute("href")||"";if(!o.startsWith("#"))return;s.preventDefault();let a=o||"#dashboard",i=a.replace("#","")||"dashboard";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Be(i)})}),typeof window.renderRoute=="function"&&window.renderRoute(),Be()}Oo();var cs=document.getElementById("settings-save-button"),tt=document.getElementById("settings-save-confirmation"),j=document.getElementById("live-status"),Ut=null,ue=document.getElementById("resourcePlannerStatus"),jt=null;document.addEventListener("planner:reminderCreated",e=>{if(!j)return;let t=e?.detail||{},n=typeof t.lessonTitle=="string"&&t.lessonTitle.trim()?t.lessonTitle.trim():"",s=typeof t.dayLabel=="string"&&t.dayLabel.trim()?t.dayLabel.trim():"",o=s?`Reminder saved for ${s}${n?` \xB7 ${n}`:""}.`:n?`Reminder saved for ${n}.`:"Planner reminder saved.";j.textContent=o});cs&&tt&&cs.addEventListener("click",e=>{e.preventDefault(),tt.classList.remove("hidden"),tt.textContent="Settings saved!",j&&(j.textContent="Settings saved!"),Ut&&window.clearTimeout(Ut),Ut=window.setTimeout(()=>{tt.classList.add("hidden")},3e3)});function qo(e){if(typeof window>"u")return;e.preventDefault();let t="planner",n="#planner";window.location.hash!==n&&(window.location.hash=n),typeof window.renderRoute=="function"&&window.renderRoute(),Be(t),j&&(j.textContent="Opening planner to add a new lesson."),xt(),window.requestAnimationFrame(()=>{let s=Js();s&&typeof s.catch=="function"&&s.catch(o=>{console.error("Planner quick action failed to start new lesson flow",o)})})}function Uo(){if(typeof document>"u")return;let e=document.querySelectorAll('[data-quick-action="planner"]');e.length&&e.forEach(t=>{t.addEventListener("click",qo)})}Uo();function Wt(e,{tone:t="success"}={}){ue&&(ue.textContent=e,ue.classList.remove("hidden"),ue.classList.remove("text-success","text-error"),ue.classList.add(t==="error"?"text-error":"text-success"),typeof window<"u"&&(jt&&window.clearTimeout(jt),jt=window.setTimeout(()=>{ue.classList.add("hidden"),ue.textContent=""},4e3))),j&&(j.textContent=e)}function mn(e="resource"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function jo(e){if(typeof document>"u"||typeof window>"u")return;e.preventDefault();let t=e.currentTarget instanceof Element?e.currentTarget:e.target instanceof Element?e.target.closest("[data-resource-planner]"):null;if(!t)return;let n=t.closest("[data-resource-title][data-resource-link]");if(!n)return;let s=n.getAttribute("data-resource-title")?.trim(),o=n.getAttribute("data-resource-link")?.trim();if(!s||!o)return;let a="#planner";window.location.hash!==a&&(window.location.hash=a),typeof window.renderRoute=="function"&&window.renderRoute(),Be("planner"),xt(),await Tt();let i=`${s} \u2014 ${o}`,r=$a(),l=null;try{if(r)l=await _t(h,r,{badge:"Resource",text:i});else{let u=mn("lesson"),b=v?.lessons?.[0]?.dayLabel||"Monday";l=await et(h,{id:u,dayName:b,title:s,summary:`Resource link: ${o}`,details:[{badge:"Resource",text:i}]}),l&&(R=u)}if(l){v=l,_(l),$(l,h);let u=r?`Added "${s}" to your selected lesson.`:`Created a lesson for "${s}" in this week's planner.`;Wt(u);return}Wt("Unable to save that resource to the planner right now.",{tone:"error"})}catch(u){console.error("Failed to save resource to planner",u),Wt("Unable to save that resource to the planner right now.",{tone:"error"})}}function Wo(){if(typeof document>"u")return;let e=document.querySelectorAll("[data-resource-planner]");e.length&&e.forEach(t=>{t.addEventListener("click",jo)})}Wo();var Ms=document.getElementById("reminder-title"),Vo=document.getElementById("reminderText"),X=(()=>{let e=document.getElementById("cue-modal")??document.getElementById("cue_modal");if(!(e instanceof HTMLElement))return null;let t=document.getElementById("openCueModal"),n=document.getElementById("closeCueModal"),s=e.querySelector(".modal-backdrop button"),o=document.getElementById("modal-title");return Un({modalElement:e,openButton:t instanceof HTMLElement?t:null,closeButton:n instanceof HTMLElement?n:null,backdropButton:s instanceof HTMLElement?s:null,titleInput:Ms,modalTitle:o instanceof HTMLElement?o:null,defaultTitle:Dt,editTitle:Nt})})();X?.setEditMode(!1);var zo=()=>{let e=!!Ms;if(!!Vo)return Ke({variant:"mobile",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",voiceBtnSel:"#voiceBtn",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback"});let n={titleSel:"#reminder-title",dateSel:"#reminder-date",timeSel:null,detailsSel:"#reminder-notes",prioritySel:"#reminder-priority",categorySel:null,saveBtnSel:"#saveReminder",cancelEditBtnSel:null,listSel:"#reminders-list",statusSel:"#auth-feedback-header",syncStatusSel:"#sync-status",voiceBtnSel:null,categoryOptionsSel:null,countTotalSel:"#remindersCount",emptyStateSel:null,listWrapperSel:null,dateFeedbackSel:null,googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleUserNameSel:"#googleUserName",variant:"desktop",autoWireAuthButtons:!0,plannerContextSel:"#planner-reminder-context",plannerLessonInputSel:"#planner-reminder-lesson-id",detailPanelSel:"#reminder-detail-panel",detailEmptySel:"#reminder-detail-empty",detailContentSel:"#reminder-detail-content",detailTitleSel:"#reminder-detail-title",detailDueSel:"#reminder-detail-due",detailPrioritySel:"#reminder-detail-priority",detailCategorySel:"#reminder-detail-category",detailNotesSel:"#reminder-detail-notes",detailClearSel:"#reminder-detail-clear"};return e?Ke(n):Ke({...n,listSel:null,listWrapperSel:null,emptyStateSel:null,countTotalSel:null,voiceBtnSel:null,categoryOptionsSel:null,dateSel:null,timeSel:null,prioritySel:null,categorySel:null,saveBtnSel:null,cancelEditBtnSel:null,detailsSel:null,titleSel:null,dateFeedbackSel:null})};zo().catch(e=>{console.error("Failed to initialise reminders",e)});var Qt=Fn(),Vt=Bn({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:e=>{Qt?.handleSessionChange(e)}});if(Vt?.supabase){Qt?.setSupabaseClient(Vt.supabase);try{Vt.supabase.auth.getSession().then(({data:e})=>{Qt?.handleSessionChange(e?.session?.user??null)}).catch(()=>{})}catch{}}var ee=document.getElementById("cues-list"),zt=document.getElementById("pinnedNotesCard"),ve=document.getElementById("pinnedNotesList"),ye=document.getElementById("cue-form"),G=ye?.querySelector("#cue-id-input"),Ko=X?.defaultTitle||X?.modalTitle?.textContent?.trim()||Dt,Br=X?.editTitle||Nt,ft=document.getElementById("tab-cues"),mt=document.getElementById("tab-daily"),He=document.getElementById("cues-view"),Re=document.getElementById("daily-list-view"),ds=document.getElementById("daily-list-header"),Ps=document.getElementById("quick-add-form"),W=document.getElementById("quick-add-input"),z=document.getElementById("daily-voice-btn"),re=document.getElementById("daily-tasks-container"),Zt=document.getElementById("clear-completed-btn"),pt=document.getElementById("daily-list-permission-notice"),F=document.getElementById("plannerCards")||document.getElementById("planner-grid"),us=document.getElementById("plannerWeekRange"),Yo=document.getElementById("planner-prev"),Go=document.getElementById("planner-next"),Xo=document.getElementById("planner-today"),Qo=document.getElementById("planner-copy-week"),Zo=document.getElementById("planner-clear-week"),Jo=document.getElementById("planner-duplicate-btn"),ea=document.getElementById("planner-new-lesson-btn"),Jt=document.getElementById("planner-list-view-toggle"),en=document.getElementById("planner-week-view-toggle"),$e=document.getElementById("plannerWeekView"),yt=document.querySelector("[data-planner-text-size]"),Kt=document.querySelector("[data-planner-card-panel]"),fs=document.getElementById("plannerSummaryCount"),gt=document.getElementById("plannerSummaryRange"),ms=document.getElementById("plannerInsightsLessons"),ps=document.getElementById("plannerInsightsSubjects"),ys=document.getElementById("plannerInsightsNotes"),ie=document.getElementById("plannerTeacherNotes"),Yt=document.getElementById("plannerTeacherNotesStatus"),nt=document.querySelector("[data-mobile-notes-text-size]"),Gt=document.querySelector(".mobile-panel--notes"),Bs="plannerTextSizePreference",ht="default",vt=new Set(["small","default","large"]),ta=["planner-text-small","planner-text-default","planner-text-large"],Fs="mobileNotesTextSizePreference",bt="default",St=new Set(["small","default","large"]),na=["mobile-panel--notes-size-small","mobile-panel--notes-size-default","mobile-panel--notes-size-large"];function tn(e){return typeof HTMLSelectElement<"u"&&e instanceof HTMLSelectElement}function sa(){if(typeof localStorage>"u")return ht;let e=localStorage.getItem(Bs);return e&&vt.has(e)?e:ht}function oa(e){typeof localStorage>"u"||!vt.has(e)||localStorage.setItem(Bs,e)}function Hs(e){if(!Kt)return;let t=vt.has(e)?e:ht;ta.forEach(n=>Kt.classList.remove(n)),Kt.classList.add(`planner-text-${t}`)}var Rs=sa();Hs(Rs);tn(yt)&&(yt.value=Rs);function $s(){if(typeof localStorage>"u")return bt;let e=localStorage.getItem(Fs);return e&&St.has(e)?e:bt}function aa(e){typeof localStorage>"u"||!St.has(e)||localStorage.setItem(Fs,e)}function _s(e){if(!Gt)return;let t=St.has(e)?e:bt;na.forEach(n=>Gt.classList.remove(n)),Gt.classList.add(`mobile-panel--notes-size-${t}`)}var Os=$s();_s(Os);nt instanceof HTMLSelectElement&&(nt.value=Os,nt.addEventListener("change",e=>{let t=typeof e.target?.value=="string"?e.target.value:bt;if(!St.has(t)){nt.value=$s();return}aa(t),_s(t)}));var ra=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function ia(e){if(e&&Number.isFinite(e.dayIndex))return e.dayIndex;let t=typeof e?.dayLabel=="string"&&e.dayLabel.trim()?e.dayLabel.trim():typeof e?.dayName=="string"&&e.dayName.trim()?e.dayName.trim():"";if(!t)return 0;let n=ra.findIndex(s=>s.toLowerCase()===t.toLowerCase());return n>=0?n:0}function la(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";let t=String(e.getFullYear()).padStart(4,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function ca(){if(typeof document>"u")return null;let e=document.getElementById("planner-lesson-modal"),t=document.getElementById("planner-lesson-form"),n=document.getElementById("planner-modal-title"),s=document.getElementById("planner-modal-description"),o=document.getElementById("planner-modal-error"),a=document.getElementById("planner-modal-submit"),i=document.getElementById("planner-lesson-day"),r=document.getElementById("planner-lesson-title"),l=document.getElementById("planner-lesson-summary"),u=document.getElementById("planner-lesson-subject"),b=document.getElementById("planner-detail-badge"),y=document.getElementById("planner-detail-text"),w=document.getElementById("planner-duplicate-week");if(!(e instanceof HTMLElement)||!(t instanceof HTMLFormElement)||!(a instanceof HTMLElement)||!(i instanceof HTMLSelectElement)||!(r instanceof HTMLInputElement)||!(l instanceof HTMLTextAreaElement))return null;let A=t.querySelector("[data-planner-lesson-section]"),I=t.querySelector("[data-planner-summary-section]"),B=t.querySelector("[data-planner-detail-section]"),P=t.querySelector("[data-planner-duplicate-section]"),M=e.querySelector("[data-planner-modal-dialog]"),T=e.querySelector("[data-planner-modal-backdrop]"),m=e.querySelectorAll("[data-planner-modal-close]"),f=document.getElementById("mainContent"),E=document.querySelector('nav[aria-label="Primary"]'),S=(()=>{let c=[],g=e.parentElement;return E instanceof HTMLElement&&c.push(E),g instanceof HTMLElement?c.push(...Array.from(g.children).filter(x=>x instanceof HTMLElement&&x!==e)):f instanceof HTMLElement&&(f.contains(e)?c.push(...Array.from(f.children).filter(x=>x instanceof HTMLElement&&!x.contains(e))):c.push(f)),c})(),L=["a[href]","area[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'],d={mode:"add",lessonId:null,trigger:null},p=null,N=null,k=c=>{p=c instanceof HTMLElement?c:null},O=c=>{S.forEach(g=>{g&&(c?g.setAttribute("inert",""):g.removeAttribute("inert"))})},An=()=>{if(!(M instanceof HTMLElement))return[];let c=M.querySelectorAll(L.join(","));return Array.from(c).filter(g=>{if(g.closest('[aria-hidden="true"]')||"disabled"in g&&g.disabled)return!1;let x=g.getBoundingClientRect();return x.width>0&&x.height>0})},kn=()=>{let c=An(),g=(p&&c.includes(p)?p:null)||c[0]||M;g&&typeof g.focus=="function"&&g.focus({preventScroll:!0})},Cn=c=>{M instanceof HTMLElement&&(M.contains(c.target)||kn())},co=c=>{if(c.key!=="Tab")return;let g=An();if(!g.length){c.preventDefault();return}let x=g[0],Ae=g[g.length-1];if(c.shiftKey&&document.activeElement===x){c.preventDefault(),Ae.focus();return}!c.shiftKey&&document.activeElement===Ae&&(c.preventDefault(),x.focus())},In=c=>{if(c.key==="Escape"){c.preventDefault(),Q();return}co(c)},Dn=()=>{o&&(o.textContent="",o.classList.add("hidden"),o.setAttribute("aria-hidden","true"))},te=c=>{o&&(o.textContent=c,o.classList.remove("hidden"),o.removeAttribute("aria-hidden"))},Nn=c=>{a.disabled=!!c,a.classList.toggle("loading",!!c)},H=(c,g)=>{c instanceof HTMLElement&&(c.classList.toggle("hidden",!g),g?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"))},Ue=c=>{[i,r,l,u].forEach(g=>{g instanceof HTMLElement&&(g.disabled=!!c,g.classList.toggle("opacity-60",!!c),g.classList.toggle("cursor-not-allowed",!!c))})},xe=()=>{t.reset(),Dn(),k(null),Ue(!1),u instanceof HTMLInputElement&&(u.value=""),b instanceof HTMLInputElement&&(b.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),w instanceof HTMLInputElement&&(w.value="")},je=({title:c,description:g,action:x})=>{n&&(n.textContent=c||"Plan lesson"),s&&(s.textContent=g||""),a.textContent=x||"Save lesson"},We=({trigger:c}={})=>{d.trigger=c instanceof HTMLElement?c:null,N=d.trigger||(document.activeElement instanceof HTMLElement?document.activeElement:null),e.classList.remove("hidden"),e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),O(!0),document.addEventListener("keydown",In,!0),e.addEventListener("focusin",Cn,!0),window.requestAnimationFrame(()=>{kn()})},Q=()=>{e.classList.add("hidden"),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""),O(!1),document.removeEventListener("keydown",In,!0),e.removeEventListener("focusin",Cn,!0);let c=d.trigger||N;d.mode="add",d.lessonId=null,d.trigger=null,k(null),xe(),c&&typeof c.focus=="function"&&c.focus({preventScroll:!0})},uo=({defaultDay:c="Monday",trigger:g}={})=>{d.mode="add",d.lessonId=null,xe(),H(A,!0),H(I,!0),H(B,!1),H(P,!1),Ue(!1);let x=typeof c=="string"&&c.trim()?c.trim():"Monday";i.value=x,i.value!==x&&(i.value="Monday"),r.value=x?`${x} lesson`:"",l.value="",u instanceof HTMLInputElement&&(u.value=""),je({title:"Add lesson",description:"Pick a day and capture the lesson focus for this week.",action:"Save lesson"}),k(r),We({trigger:g})},fo=({lesson:c,trigger:g}={})=>{if(!c)return;d.mode="edit",d.lessonId=c.id,xe(),H(A,!0),H(I,!0),H(B,!1),H(P,!1),Ue(!1);let x=c.dayLabel||c.dayName||"Monday";i.value=x,i.value!==x&&(i.value="Monday"),r.value=c.title||"",l.value=c.summary||"",u instanceof HTMLInputElement&&(u.value=c.subject||""),je({title:"Edit lesson",description:"Update the lesson information for this week.",action:"Update lesson"}),k(r),We({trigger:g})},mo=({lesson:c,trigger:g}={})=>{if(!c)return;d.mode="detail",d.lessonId=c.id,xe(),H(A,!0),H(I,!0),H(B,!0),H(P,!1),Ue(!0);let x=c.dayLabel||c.dayName||"Monday";i.value=x,i.value!==x&&(i.value="Monday"),r.value=c.title||"",l.value=c.summary||"",u instanceof HTMLInputElement&&(u.value=c.subject||""),b instanceof HTMLInputElement&&(b.value=""),(y instanceof HTMLTextAreaElement||y instanceof HTMLInputElement)&&(y.value=""),je({title:"Add lesson detail",description:"Add a quick badge and note to this lesson.",action:"Save detail"}),k(y instanceof HTMLElement?y:null),We({trigger:g})},po=({suggestedWeekId:c="",trigger:g}={})=>{d.mode="duplicate",d.lessonId=null,xe(),H(A,!1),H(I,!1),H(B,!1),H(P,!0),w instanceof HTMLInputElement&&(w.value=c),je({title:"Duplicate plan",description:"Copy everything from this week into another week.",action:"Duplicate week"}),k(w instanceof HTMLElement?w:null),We({trigger:g})},yo=async c=>{c.preventDefault(),Dn(),Nn(!0);try{if(d.mode==="duplicate"){let q=w?.value?.trim();if(!q){te("Enter the Monday date for the destination week.");return}if(q===h){te("Choose a different week to duplicate into.");return}let ge=await Ot(h,q);ge&&(h=q,yn(q),v=ge,_(ge),$(ge,q),Q());return}if(d.mode==="detail"){if(!d.lessonId){te("Select a lesson before adding details.");return}let q=y?.value?.trim();if(!q){te("Add text for this detail.");return}let ge=b?.value?.trim()||"",ze=await _t(h,d.lessonId,{badge:ge,text:q});ze&&(v=ze,_(ze),$(ze,h),Q());return}let g=i.value.trim(),x=r.value.trim(),Ae=l.value.trim(),Mn=u?.value?.trim()||"";if(!g){te("Choose a day for this lesson.");return}if(!x){te("Enter a lesson title.");return}if(d.mode==="edit"){if(!d.lessonId){te("Select a lesson to edit.");return}let q=await ae(h,d.lessonId,{dayName:g,title:x,summary:Ae,subject:Mn});q&&(v=q,_(q),$(q,h),Q());return}let Ve=await et(h,{dayName:g,title:x,summary:Ae,subject:Mn});Ve&&(v=Ve,_(Ve),$(Ve,h),Q())}catch(g){console.error("Failed to save planner change",g),te("Unable to save changes right now. Please try again.")}finally{Nn(!1)}};return t.addEventListener("submit",yo),m.forEach(c=>{c.addEventListener("click",g=>{g.preventDefault(),Q()})}),e.addEventListener("click",c=>{c.target===e&&Q()}),T?.addEventListener("click",c=>{c.target===T&&Q()}),{openAddLesson:uo,openEditLesson:fo,openAddDetail:mo,openDuplicatePlan:po,close:Q}}var gs=document.getElementById("remindersCount"),le=typeof document<"u"?ca():null,hs=document.getElementById("plannerCount"),bs=document.getElementById("plannerSubtitle"),Fr=document.getElementById("resourcesCount"),Hr=document.getElementById("templatesCount"),st=document.getElementById("dailySnapshotList"),ot=document.getElementById("todaysFocusList"),Z=document.getElementById("weekAtAGlanceList"),J=null;Z&&(J=document.createElement("li"),J.dataset.emptyState="week",J.className="list-none rounded-xl border border-dashed border-base-300/70 bg-base-100/60 p-4 text-sm italic text-base-content/60",J.textContent="No upcoming events this week.");var Es=()=>{if(!Z||!J)return;Z.querySelectorAll(":scope > li:not([data-empty-state]):not(.hidden):not([hidden])").length===0?Z.contains(J)||Z.appendChild(J):Z.contains(J)&&Z.removeChild(J)};Z&&(Es(),new MutationObserver(Es).observe(Z,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","hidden"]}));var Xt=e=>{zt&&(e?zt.classList.remove("hidden"):zt.classList.add("hidden"))},_e={high:{badgeClass:"badge badge-outline text-error",badgeLabel:"High priority",rank:0},medium:{badgeClass:"badge badge-outline text-warning",badgeLabel:"Due soon",rank:1},low:{badgeClass:"badge badge-outline text-secondary",badgeLabel:"Scheduled",rank:2}},ws=(()=>{try{return new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return null}})(),vs=(()=>{try{return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"})}catch{return null}})(),ct=e=>e?(typeof e.title=="string"?e.title.trim():"")||"Untitled reminder":"",pn=e=>{if(!e?.due)return null;try{let t=new Date(e.due);return Number.isNaN(t.getTime())?null:t}catch{return null}},da=(e,t)=>!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),qs=e=>{if(!e)return"";if(ws)try{return ws.format(e)}catch{}let t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}:${n}`},ua=e=>{if(!e)return"";if(vs)try{return vs.format(e)}catch{}return e.toLocaleDateString()},Us=e=>{let t=typeof e?.priority=="string"?e.priority.trim().toLowerCase():"";return Object.prototype.hasOwnProperty.call(_e,t)?t:"medium"},Ss=e=>{let t=Us(e);return _e[t]?.rank??_e.medium.rank},fa=e=>{let t=Us(e);return _e[t]??_e.medium},Ls=e=>{let t=pn(e);return t?t.getTime():Number.POSITIVE_INFINITY};function js(e=[]){if(!st)return;let t=new Date,n=(Array.isArray(e)?e:[]).map(s=>({reminder:s,date:pn(s)})).filter(({date:s})=>s&&da(s,t)).sort((s,o)=>s.date.getTime()-o.date.getTime());if(!n.length){st.innerHTML='<p class="text-sm italic text-base-content/60">No reminders due today.</p>';return}st.innerHTML="",n.forEach(({reminder:s,date:o})=>{let a=document.createElement("li");a.className="rounded-xl border border-base-200 bg-base-100/80 p-3 shadow-sm";let i=document.createElement("p");i.className="font-semibold text-base-content",i.textContent=ct(s),a.appendChild(i);let r=qs(o),l=document.createElement("p");l.className="text-xs text-base-content/70",l.textContent=r?`Due ${r}`:"Due today",a.appendChild(l),st.appendChild(a)})}function Ws(e=[]){if(!ot)return;let t=(Array.isArray(e)?e:[]).filter(n=>n&&!n.done).sort((n,s)=>{let o=Ss(n)-Ss(s);if(o!==0)return o;let a=Ls(n)-Ls(s);return a!==0?a:ct(n).localeCompare(ct(s),void 0,{sensitivity:"base"})}).slice(0,3);if(!t.length){ot.innerHTML='<li class="list-none text-sm italic text-base-content/60">No focus items.</li>';return}ot.innerHTML="",t.forEach(n=>{let s=document.createElement("li");s.className="rounded-xl border border-base-200 bg-base-100/80 p-4 shadow-sm";let o=document.createElement("div");o.className="flex items-center justify-between gap-3";let a=document.createElement("p");a.className="font-semibold text-base-content",a.textContent=ct(n),o.appendChild(a);let i=fa(n),r=document.createElement("span");r.className=i.badgeClass,r.textContent=i.badgeLabel,o.appendChild(r),s.appendChild(o);let l=pn(n),u=document.createElement("p");if(u.className="text-xs text-base-content/70",l){let b=qs(l),y=ua(l),w=[];b&&w.push(`Due ${b}`),y&&w.push(y),u.textContent=w.length?w.join(" \u2022 "):"Due soon"}else u.textContent="No due date";s.appendChild(u),ot.appendChild(s)})}var ma=e=>{if(!gs)return;let t=Array.isArray(e)?e.length:0;gs.textContent=String(t)},pa=e=>{let t=Array.isArray(e?.detail?.items)?e.detail.items:[];ma(t),js(t),Ws(t)};document.addEventListener("memoryCue:remindersUpdated",pa);js();Ws();var nn=Rn(Hn),ya={apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"},at=null,ga=3,Ts=120;function ha(e){if(e==null)return"";let t=String(e).replace(/\s+/g," ").trim();return t?t.length<=Ts?t:`${t.slice(0,Ts-1)}\u2026`:""}function ba(e){return!e||typeof e!="object"?!1:[e.pinned,e.isPinned,e.pin].some(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){let s=n.trim().toLowerCase();return s==="true"||s==="1"||s==="yes"}return!1})}function xs(e){if(!ve)return;let t=Array.isArray(e)?e:[];if(!t.length){ve.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Xt(!1);return}let n=t.filter(a=>ba(a));if(!n.length){ve.innerHTML='<li class="list-none text-sm italic text-base-content/60">No pinned notes yet.</li>',Xt(!1);return}Xt(!0);let o=n.slice(0,ga).map(a=>{let i=C(he(a,"title")||"Untitled Cue"),r=he(a,"details"),l=C(ha(r)),u=l?`<p class="mt-1 text-sm text-base-content/70">${l}</p>`:"";return`
        <li class="rounded-xl border border-base-300 bg-base-100/80 p-3">
          <p class="font-medium text-base-content">${i}</p>
          ${u}
        </li>
      `}).join("");ve.innerHTML=o}function sn(e,{tone:t="muted"}={}){if(!ee)return;let n=["text-sm"];n.push(t==="error"?"text-error":"text-base-content/60"),ee.innerHTML=`<p class="${n.join(" ")}">${C(e)}</p>`}function Ea(e){if(!ee)return;if(!Array.isArray(e)||e.length===0){sn("No cues yet.");return}let t=e.map(n=>{let s=C(he(n,"title")||"Untitled Cue"),o=C(he(n,"details"));return`
        <div class="card w-96 bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title">${s}</h2>
            ${o?`<p>${o}</p>`:""}
            <div class="card-actions justify-end">
              <div class="dropdown dropdown-left">
                <label tabindex="0" class="btn btn-ghost btn-xs m-1">...</label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                  <li><a class="edit-btn" data-id="${C(n.id)}">Edit</a></li>
                  <li><a class="delete-btn" data-id="${C(n.id)}">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `}).join("");ee.innerHTML=t}async function qe(){return at||(at=(async()=>{let[{initializeApp:e,getApps:t},{getFirestore:n,enableMultiTabIndexedDbPersistence:s,enableIndexedDbPersistence:o,collection:a,doc:i,getDoc:r,addDoc:l,updateDoc:u,getDocs:b,query:y,orderBy:w,serverTimestamp:A,setDoc:I,arrayUnion:B}]=await Promise.all([import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"),import("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js")]),P=t(),M=P&&P.length?P[0]:e(ya),T=n(M);(function(){let E=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;E&&(E.__persistenceInitialized__||(E.__persistenceInitialized__=!0,(async()=>{try{await s(T),console.info("[Firestore] Persistence: multi-tab enabled")}catch(S){if(S&&S.code==="failed-precondition")try{await o(T),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(L){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",L?.code||L)}else S&&S.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",S?.code||S)}})()))})();let m=a(T,"cues");return{db:T,cuesCollection:m,getCollection:a,doc:i,getDoc:r,addDoc:l,updateDoc:u,getDocs:b,query:y,orderBy:w,serverTimestamp:A,setDoc:I,arrayUnion:B}})().catch(e=>{throw console.error("Failed to initialise Firestore for cues",e),e}),at)}async function wa(){let e=await qe(),{getDocs:t,cuesCollection:n,query:s,orderBy:o}=e,a=s&&o?s(n,o("createdAt","desc")):n;return(await t(a)).docs.map(r=>({id:r.id,...r.data()}))}async function va(e){if(!e)return null;let t=await qe(),{db:n,doc:s,getDoc:o}=t,a=s(n,"cues",e),i=await o(a);return i.exists()?{id:i.id,...i.data()}:null}async function Vs(){if(!(!ee&&!ve))try{let e=await wa();Ea(e),xs(e)}catch(e){console.error("Failed to load cues",e),At(e)?sn("Sign in to view your cues.",{tone:"muted"}):sn("Unable to load cues right now.",{tone:"error"}),xs([])}}function Sa(e){!ye||!G||($n(e,nn),G.value=e?.id||"",X?.setEditMode(!0),X?.show({mode:"edit"}))}async function La(e){let t=e.target instanceof Element?e.target.closest(".edit-btn"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-id");if(n)try{let s=await va(n);if(!s)return;Sa(s)}catch(s){console.error("Failed to prepare cue for editing",s)}}async function Ta(e){if(e.preventDefault(),!ye||!G)return;let t=G.value.trim(),n=On(nn);try{let s=await qe(),{db:o,doc:a,addDoc:i,updateDoc:r,cuesCollection:l,serverTimestamp:u}=s,b=typeof u=="function"?u():null;if(t){let y=a(o,"cues",t),w={...n};b&&(w.updatedAt=b),await r(y,w)}else{let y={...n};b&&(y.createdAt=b,y.updatedAt=b),await i(l,y)}await Vs(),_n(nn,G,X?.modalTitle??null,Ko),await X?.hide({reason:"form-submit"})}catch(s){console.error("Failed to save cue",s)}}async function xa(){!ye||!G||!ee||(ee.addEventListener("click",La),ye.addEventListener("submit",Ta))}ye&&G&&(document.addEventListener("cue:prepare",()=>{G.value="",X?.setEditMode(!1)}),document.addEventListener("cue:close",()=>{G.value="",X?.setEditMode(!1)}));ye&&G&&ee&&xa().catch(e=>{console.error("Failed to initialise cue editing",e)});(ee||ve)&&Vs();var D=[],rt=null,me=!1,Le=oe(),Fe=!1,h=Le,v=null,Pe=null,R=null,Et=new Map,Aa=800,zs=1500,on={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},Ks=new Set(["saving","saved","error"]),Ys="plannerNotesOpenState",fe=Ca(),it=null,Gs="list",ka=800;function Ca(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(Ys);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to load planner notes state",e),{}}}function Ia(){if(!(typeof localStorage>"u"))try{localStorage.setItem(Ys,JSON.stringify(fe))}catch(e){console.warn("Unable to persist planner notes state",e)}}function Da(e){return e?!!fe?.[e]:!1}function Na(e,t){if(e){if(t)fe={...fe,[e]:!0};else if(fe?.[e]){let n={...fe};delete n[e],fe=n}Ia()}}function Ma(e,t=Le){return Array.isArray(e)?e:e&&typeof e=="object"&&Array.isArray(e.lessons)?e.lessons:typeof t=="string"&&t?ns(t):[]}var Pa=(e=[])=>{if(!hs)return;let t=Array.isArray(e)?e.length:0;hs.textContent=String(t)};function Ba(e=[]){let t=Array.isArray(e)?e:[];if(ms&&(ms.textContent=String(t.length)),ps){let n=new Set;t.forEach(s=>{let o=gn(s);o&&n.add(o.toLowerCase())}),ps.textContent=String(n.size)}if(ys){let n=t.filter(s=>typeof s.notes=="string"&&s.notes.trim().length>0).length;ys.textContent=String(n)}}function $(e,t){let n=Ma(e,t);Pa(n);let s=e?.weekId||t||Le,o=$t(s,{short:!0});bs&&(bs.textContent=o||""),fs&&(fs.textContent=String(n.length)),gt&&(gt.textContent=o||""),Ba(n)}function an(e,{tone:t="muted"}={}){if(!F)return;R=null;let n=["rounded-xl","border","border-dashed","border-base-300/70","bg-base-100/60","p-4","text-sm"];n.push(t==="error"?"text-error":"text-base-content/70"),F.innerHTML=`<p class="${n.join(" ")}">${C(e)}</p>`}function yn(e){if(!us)return;let t=$t(e);us.textContent=t||"",gt&&(gt.textContent=t||"")}function gn(e){return!e||typeof e!="object"?"":typeof e.subject=="string"?e.subject.trim():""}function Xs(e){if(!e)return"badge-ghost";let t=e.toLowerCase();return t.includes("hpe")||t.includes("pe")?"badge-info":t.includes("english")?"badge-success":t.includes("civics")||t.includes("cac")?"badge-secondary":t.includes("geo")?"badge-warning":"badge-ghost"}var Y={not_started:{label:"Not started",badge:"badge-ghost"},in_progress:{label:"In progress",badge:"badge-warning"},ready:{label:"Ready",badge:"badge-success"},taught:{label:"Taught",badge:"badge-neutral"}};function Fa(e,t){let n=Y[t]?t:"not_started",s=Object.entries(Y).map(([o,a])=>`<option value="${o}" ${o===n?"selected":""}>${C(a.label)}</option>`).join("");return`
    <label class="flex items-center gap-2 text-xs font-semibold text-base-content/80">
      <span>Status</span>
      <select class="select select-bordered select-xs" data-lesson-status="true" data-lesson-id="${e}">
        ${s}
      </select>
    </label>
  `}function Ha(e=[],t=""){return e.length?`
    <ul class="space-y-2">
      ${e.map(n=>{let s=typeof n?.label=="string"&&n.label.trim()?n.label.trim():"Resource",o=typeof n?.url=="string"?n.url.trim():"",a=typeof n?.id=="string"?n.id:"",i=o?`<a class="link link-primary break-words" href="${o}" target="_blank" rel="noreferrer">${C(s)}</a>`:`<span class="text-base-content">${C(s)}</span>`,r=a?`<button class="btn btn-ghost btn-xs text-error" type="button" data-planner-action="remove-resource" data-lesson-id="${t}" data-resource-id="${a}">Remove</button>`:"";return`<li class="flex items-start justify-between gap-2 rounded-lg bg-base-200/70 px-2 py-1">${i}${r}</li>`}).join("")}
    </ul>
  `:'<p class="text-xs text-base-content/60">No resources added yet.</p>'}function _(e){if(!F)return;qa(e);let t=Array.isArray(e?.lessons)?e.lessons:[];if(!t.length){an("No lessons saved for this week yet."),rn([]);return}let n=t,s=n.map(a=>typeof a.id=="string"&&a.id?a.id:"").filter(a=>!!a);R&&!s.includes(R)&&(R=null);let o=n.map(a=>{let i=Array.isArray(a.details)?a.details.map(p=>`
                <li class="flex items-center gap-2">
                  ${p.badge?`<span class="badge badge-outline badge-sm text-secondary">${C(p.badge)}</span>`:""}
                  <span class="text-sm text-base-content/80">${C(p.text)}</span>
                </li>
              `).join(""):"",r=i?`<ul class="space-y-2 text-sm text-base-content/80">${i}</ul>`:'<p class="text-sm text-base-content/60">No details yet.</p>',l=typeof a.id=="string"?a.id:"",u=!!(R&&l&&R===l),b=["data-planner-lesson",l?`data-lesson-id="${l}"`:"",u?'data-planner-selected="true"':""].filter(Boolean).join(" "),y=a.summary?`<p class="text-sm text-base-content/80">${C(a.summary)}</p>`:"",w=gn(a),A=Xs(w),I=w?`<span class="badge ${A} badge-sm">${C(w)}</span>`:"",B=typeof a.notes=="string"?a.notes:"",P=Da(l),M=l?`
            <details
              class="planner-notes-collapse"
              data-planner-notes-collapse="true"
              data-lesson-id="${l}"
              ${P?"open":""}
            >
              <summary class="planner-notes-summary">
                <span class="label-text text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">Lesson notes</span>
                <span class="planner-notes-summary-indicator" aria-hidden="true"></span>
              </summary>
              <div class="planner-notes-panel">
                <label class="form-control w-full gap-1">
                  <textarea
                    class="textarea textarea-bordered w-full min-h-[6rem] text-base-content"
                    data-planner-notes="true"
                    data-lesson-id="${l}"
                    placeholder="Write lesson notes"
                    spellcheck="true"
                    aria-label="Lesson notes"
                  >${C(B)}</textarea>
                  <div class="label py-1">
                    <span class="label-text-alt text-xs text-base-content/60">
                      Status:
                      <span
                        data-notes-status-text
                        data-status="idle"
                        role="status"
                        aria-live="polite"
                      >${C(on.idle)}</span>
                    </span>
                  </div>
                </label>
              </div>
            </details>
          `:"",T=l?`
            <div class="flex flex-wrap items-center gap-1 justify-end sm:flex-nowrap" role="group" aria-label="Reorder lesson">
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-up"
                data-lesson-id="${l}"
              >
                Move up
              </button>
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                data-planner-action="move-down"
                data-lesson-id="${l}"
              >
                Move down
              </button>
            </div>
          `:"",m=l?Fa(l,a.status):"",f=Ha(Array.isArray(a.resources)?a.resources:[],l),E=Y[a.status]?.badge||Y.not_started.badge,S=Y[a.status]?.label||Y.not_started.label,L=[a.weekDay||a.dayLabel||"Lesson"];a.period&&L.push(a.period);let d=L.filter(Boolean).join(" \xB7 ");return`
        <article class="card border border-base-300 bg-base-100 shadow-lg transition hover:-translate-y-1 hover:shadow-xl" ${b}>
          <div class="card-body gap-4">
            <div class="flex items-start justify-between gap-3">
              <div class="space-y-2">
                <div class="flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-[0.3em] text-base-content/60">
                  <span>${C(d)}</span>
                  <span class="badge ${E} badge-xs">${C(S)}</span>
                </div>
                <div class="flex flex-wrap items-center gap-2">
                  <h2 class="text-lg font-semibold text-base-content">${C(a.title||a.dayLabel||"Lesson")}</h2>
                  ${I}
                </div>
                ${y}
                <div class="flex flex-wrap items-center gap-3">
                  ${m}
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                ${T}
                <div class="flex flex-wrap justify-end gap-1">
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="duplicate" data-lesson-id="${l}">Duplicate</button>
                  <button type="button" class="btn btn-ghost btn-xs" data-planner-action="edit" data-lesson-id="${l}">
                    Edit
                  </button>
                  <button
                    type="button"
                    class="btn btn-ghost btn-xs text-error"
                    data-planner-action="delete"
                    data-lesson-id="${l}"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
            ${r}
            <div class="rounded-xl border border-base-200 bg-base-200/60 p-3">
              <div class="flex flex-wrap items-center justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold uppercase tracking-[0.2em] text-base-content/60">Resources</p>
                  <p class="text-xs text-base-content/70">Link slides, videos, and activity sheets.</p>
                </div>
                <span class="badge badge-outline badge-sm">${Array.isArray(a.resources)?a.resources.length:0} linked</span>
              </div>
              <div class="mt-2 space-y-2">
                ${f}
                <div class="grid gap-2 md:grid-cols-[1fr_1.5fr_auto]">
                  <input
                    type="text"
                    class="input input-bordered input-sm w-full"
                    placeholder="Label (e.g. Slides)"
                    data-resource-label="true"
                    data-lesson-id="${l}"
                  />
                  <input
                    type="url"
                    class="input input-bordered input-sm w-full"
                    placeholder="URL"
                    data-resource-url="true"
                    data-lesson-id="${l}"
                  />
                  <button
                    type="button"
                    class="btn btn-outline btn-sm"
                    data-planner-action="add-resource"
                    data-lesson-id="${l}"
                  >
                    Add resource
                  </button>
                </div>
              </div>
            </div>
            ${M}
            <div class="flex flex-wrap items-center gap-2">
              <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-xs">Add template</label>
                <ul tabindex="0" class="dropdown-content menu rounded-box z-[1] mt-2 w-64 bg-base-100 p-2 shadow">
                  <li><button type="button" data-planner-action="apply-template" data-template-type="simple" data-lesson-id="${l}">Simple lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="hpe" data-lesson-id="${l}">HPE lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="english" data-lesson-id="${l}">English lesson template</button></li>
                  <li><button type="button" data-planner-action="apply-template" data-template-type="cac" data-lesson-id="${l}">CAC lesson template</button></li>
                </ul>
              </div>
              <button
                type="button"
                class="btn btn-sm btn-primary"
                data-planner-action="create-reminder"
                data-open-reminder-modal="true"
                data-lesson-id="${l}"
              >
                Create reminder
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline"
                data-planner-action="add-detail"
                data-lesson-id="${l}"
              >
                Add detail
              </button>
            </div>
          </div>
        </article>
      `}).join("");F.innerHTML=o,hn(R),rn(n)}function rn(e=[]){if(!$e)return;let n=["Monday","Tuesday","Wednesday","Thursday","Friday"].map((o,a)=>({day:o,index:a,lessons:[]}));e.forEach(o=>{let a=Number.isFinite(o?.dayIndex)?o.dayIndex:0,i=n.find(r=>r.index===a);i&&i.lessons.push(o)});let s=n.map(({day:o,lessons:a})=>{let i=a.map(l=>{let u=gn(l),b=Xs(u),y=Y[l.status]?.label||Y.not_started.label,w=Y[l.status]?.badge||Y.not_started.badge;return`
            <button
              type="button"
              class="w-full text-left rounded-xl border border-base-200 bg-base-100 px-3 py-2 shadow-sm transition hover:-translate-y-[1px] hover:shadow"
              data-week-view-lesson="${l.id||""}"
            >
              <div class="flex items-start justify-between gap-2">
                <div>
                  <p class="text-xs font-semibold text-base-content/70">${C(l.title||l.dayLabel||"Lesson")}</p>
                  <p class="text-xs text-base-content/60">${C(l.summary||"")}</p>
                </div>
                <div class="flex flex-col items-end gap-1">
                  ${u?`<span class="badge ${b} badge-xs">${C(u)}</span>`:""}
                  <span class="badge ${w} badge-xs">${C(y)}</span>
                </div>
              </div>
            </button>
          `}).join("");return`
        <div class="space-y-2 rounded-2xl border border-base-200 bg-base-200/50 p-3">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-base-content/70">${o}</p>
          <div class="space-y-2">${i||'<p class="text-xs text-base-content/60">No lessons yet.</p>'}</div>
        </div>
      `}).join("");$e.innerHTML=s}function dt(e="list"){let t=e==="week"?"week":"list";Gs=t,F&&F.classList.toggle("hidden",t==="week"),$e&&$e.classList.toggle("hidden",t!=="week"),Jt instanceof HTMLElement&&Jt.setAttribute("aria-pressed",t==="list"?"true":"false"),en instanceof HTMLElement&&en.setAttribute("aria-pressed",t==="week"?"true":"false"),t==="week"&&rn(v?.lessons||[])}function hn(e){R=e||null,F&&F.querySelectorAll("[data-planner-lesson]").forEach(n=>{!!e&&n.getAttribute("data-lesson-id")===e?n.setAttribute("data-planner-selected","true"):n.removeAttribute("data-planner-selected")})}function Ra(e){let t=e.target instanceof Element?e.target.closest("[data-week-view-lesson]"):null;if(!t)return;let n=t.getAttribute("data-week-view-lesson");if(!n)return;dt("list"),hn(n);let s=F?.querySelector(`[data-lesson-id="${n}"]`);s instanceof HTMLElement&&typeof s.scrollIntoView=="function"&&s.scrollIntoView({behavior:"smooth",block:"center"})}function $a(){return R&&(Array.isArray(v?.lessons)?v.lessons:[]).some(t=>t.id===R)?R:null}function _a(e){let t=e.target instanceof Element?e.target.closest("[data-planner-lesson][data-lesson-id]"):null;if(!t)return;let n=t.getAttribute("data-lesson-id");!n||n===R||hn(n)}function Oa(e){let t=tn(e?.currentTarget)?e.currentTarget:yt;if(!tn(t))return;let n=t.value,s=vt.has(n)?n:ht;Hs(s),oa(s),t.value!==s&&(t.value=s)}function Lt(){return typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:null}function Qs(){return typeof window<"u"&&typeof window.clearTimeout=="function"?window.clearTimeout.bind(window):typeof clearTimeout=="function"?clearTimeout:null}function Zs(e){if(!e)return;let t=Et.get(e);if(!t)return;let n=Qs();n&&n(t),Et.delete(e)}function Ne(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&Ks.has(t)?t:null;n?e.setAttribute("data-notes-status",n):e.removeAttribute("data-notes-status")}function Me(e,t){if(!(e instanceof HTMLTextAreaElement))return;let n=typeof t=="string"&&Ks.has(t)?t:null,s=e.parentElement instanceof HTMLElement?e.parentElement.querySelector("[data-notes-status-text]"):null;if(s instanceof HTMLElement){let o=n||"idle",a=on[o]||on.idle;s.textContent=a,s.setAttribute("data-status",o)}}function qa(e){if(!(ie instanceof HTMLTextAreaElement))return;Ee("idle");let t=typeof e?.teacherNotes=="string"?e.teacherNotes:"";ie.value!==t&&(ie.value=t)}function Ee(e="idle"){if(!(Yt instanceof HTMLElement))return;let t={idle:"Notes save automatically.",saving:"Saving\u2026",saved:"Saved",error:"Unable to save"},n=t[e]||t.idle;Yt.textContent=n,Yt.setAttribute("data-status",e)}async function Ua(e){if(h){Ee("saving");try{let t=await ss(h,e);t&&(v=t),Ee("saved");let n=Lt();n?n(()=>Ee("idle"),zs):Ee("idle")}catch(t){console.error("Failed to save teacher notes",t),Ee("error")}}}function ja(e){if(!(ie instanceof HTMLTextAreaElement)||e?.target!==ie)return;if(it){let n=Qs();n&&n(it)}let t=Lt();t&&(it=t(()=>{it=null,Ua(ie.value)},ka))}function Wa(e="simple"){switch(e){case"hpe":return`Focus skill:
Warm-up:
Skill drill:
Modified game:
Reflection questions:`;case"english":return`Text focus:
Discussion questions:
Mentor sentence:
Writing task:
Reflection / exit ticket:`;case"cac":return`Civics topic:
Key terms:
Source / video:
Discussion questions:
Activity:
Reflection question:`;case"simple":default:return`Learning intention:
Success criteria:
Warm-up:
Main activity:
Exit task:`}}async function Va(e,t){if(!e)return;await Tt();let n=v?.lessons?.find(i=>i.id===e);if(!n)return;let s=Wa(t),o=typeof n.notes=="string"?n.notes:"",a=o?`${o.trim()}

${s}`:s;try{let i=await ae(h,e,{notes:a,templateType:t||"simple"});i&&(v=i,_(i),$(i,h))}catch(i){console.error("Failed to apply lesson template",i)}}async function za(e){let t=e.target instanceof HTMLSelectElement&&e.target.hasAttribute("data-lesson-status")?e.target:null;if(!t)return;let n=t.getAttribute("data-lesson-id"),s=t.value;if(n)try{let o=await ae(h,n,{status:s});o&&(v=o,_(o),$(o,h))}catch(o){console.error("Failed to update lesson status",o)}}async function Ka(e,t,n){if(!e||!(t instanceof HTMLInputElement)||!(n instanceof HTMLInputElement))return;let s=t.value.trim(),o=n.value.trim();if(!s&&!o)return;let a=v?.lessons?.find(r=>r.id===e);if(!a)return;let i=Array.isArray(a.resources)?[...a.resources]:[];i.push({id:mn("resource"),label:s,url:o});try{let r=await ae(h,e,{resources:i});r&&(v=r,_(r)),t.value="",n.value=""}catch(r){console.error("Failed to add resource",r)}}async function Ya(e,t){if(!e||!t)return;let n=v?.lessons?.find(o=>o.id===e);if(!n)return;let s=(n.resources||[]).filter(o=>o?.id!==t);try{let o=await ae(h,e,{resources:s});o&&(v=o,_(o))}catch(o){console.error("Failed to remove resource",o)}}async function ln(e,t,n){if(!e||!h)return;let s=n instanceof HTMLTextAreaElement?n:null;s&&(Ne(s,"saving"),Me(s,"saving"));try{let o=await ae(h,e,{notes:t});if(o&&(v=o),s){Ne(s,"saved"),Me(s,"saved");let a=Lt();a?a(()=>{s.getAttribute("data-notes-status")==="saved"&&(Ne(s,null),Me(s,null))},zs):(Ne(s,null),Me(s,null))}}catch(o){console.error("Failed to save planner notes",o),s&&(Ne(s,"error"),Me(s,"error"))}}function Ga(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;Zs(n);let s=Lt();if(!s){ln(n,t.value,t);return}let o=s(()=>{Et.delete(n),ln(n,t.value,t)},Aa);Et.set(n,o)}function Xa(e){let t=e.target instanceof HTMLTextAreaElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes"))return;let n=t.getAttribute("data-lesson-id");n&&(Zs(n),ln(n,t.value,t))}function Qa(e){let t=e.target instanceof HTMLDetailsElement?e.target:null;if(!t||!t.hasAttribute("data-planner-notes-collapse"))return;let n=t.getAttribute("data-lesson-id");if(!n)return;let s=t.hasAttribute("open");Na(n,s)}function we(e){if(!F)return Pe=null,Promise.resolve();let t=e||oe();h=t,yn(t),an("Loading plan\u2026");let n=(async()=>{try{let s=await V(t);v=s,_(s),$(s,t)}catch(s){console.error("Failed to load planner week",s),an("Unable to load this week's planner.",{tone:"error"})}})();return Pe=n,n.finally(()=>{Pe===n&&(Pe=null)})}async function Tt(){if(!F)return;Fe||xt();let e=Pe;if(!e&&(!v||v.weekId!==h)&&(e=we(h)),e&&typeof e.then=="function")try{await e}catch(t){console.error("Planner failed to load",t)}}async function Za(e,t){if(!e)return;await Tt();let n=Array.isArray(v?.lessons)?v.lessons:[];if(!n.length)return;let s=n.find(A=>A?.id===e);if(!s)return;let o=typeof s.dayLabel=="string"&&s.dayLabel.trim()?s.dayLabel.trim():typeof s.dayName=="string"&&s.dayName.trim()?s.dayName.trim():"",a=typeof s.title=="string"&&s.title.trim()?s.title.trim():o||"Lesson",i=typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():"",r=i||a,l=o?`${o} \xB7 ${r}`:r,u=i||"",b=ia(s),y=la(ts(h,b)),w={reminderTitle:l,reminderNotes:u,dueDate:y,dayLabel:o,lessonTitle:a,summary:i,plannerLessonId:e};qt("cue:prepare",{trigger:t,source:"planner"}),qt("planner:prefillReminder",w),qt("cue:open",{trigger:t,source:"planner"})}async function Ja(e,t){if(!e)return;await Tt();let s=(Array.isArray(v?.lessons)?v.lessons:[]).find(r=>r?.id===e);if(!s)return;let o=t instanceof HTMLElement?t:null;o&&o.setAttribute("disabled","true");let a=mn("lesson"),i={id:a,dayIndex:s.dayIndex,dayLabel:s.dayLabel,dayName:s.dayName,title:s.title,summary:s.summary,subject:s.subject,notes:s.notes,period:s.period,templateType:s.templateType||"simple",status:"not_started",resources:Array.isArray(s.resources)?s.resources.map(r=>({label:r?.label||"",url:r?.url||""})):[],details:Array.isArray(s.details)?s.details.map(r=>({badge:r?.badge||"",text:r?.text||""})):[]};try{let r=await et(h,i),l=r;r&&Number.isFinite(s.position)&&(l=await ae(h,a,{position:s.position+.1})),l&&(v=l,R=a,_(l),$(l,h),j&&(j.textContent=`Duplicated ${s.title||"lesson"} into this week.`))}catch(r){console.error("Failed to duplicate planner lesson",r),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to duplicate that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function er(e){let t=e.target instanceof Element?e.target.closest("[data-planner-action]"):null;if(!t)return;e.preventDefault();let n=t.getAttribute("data-planner-action"),s=t.getAttribute("data-lesson-id");if(n)switch(n){case"add-detail":or(s,t);break;case"edit":ar(s,t);break;case"delete":rr(s);break;case"duplicate":await Ja(s,t);break;case"apply-template":{let o=t.getAttribute("data-template-type")||"simple";Va(s,o);break}case"add-resource":{let o=t.closest("[data-planner-lesson]"),a=o?.querySelector("input[data-resource-label][data-lesson-id]"),i=o?.querySelector("input[data-resource-url][data-lesson-id]");await Ka(s,a,i);break}case"remove-resource":{let o=t.getAttribute("data-resource-id");await Ya(s,o);break}case"move-up":As(s,"up",t);break;case"move-down":As(s,"down",t);break;case"create-reminder":await Za(s,t);break;default:break}}async function Js(e){if(typeof document>"u"||!le)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=v?.lessons?.[0]?.dayLabel||"Monday";le.openAddLesson({defaultDay:n,trigger:t})}async function tr(e){if(!le)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=De(h,1);le.openDuplicatePlan({suggestedWeekId:n,trigger:t})}async function nr(e){if(!h)return;e?.preventDefault?.();let t=e?.currentTarget instanceof HTMLElement?e.currentTarget:null,n=De(h,-1);if(n){t&&t.setAttribute("disabled","true");try{let s=await Ot(n,h);s&&(v=s,R=null,_(s),$(s,h),j&&(j.textContent="Copied last week into this plan."))}catch(s){console.error("Failed to copy previous planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to copy last week right now.")}finally{t&&t.removeAttribute("disabled")}}}async function sr(e){if(!h)return;e?.preventDefault?.();let t=!0;if(typeof window<"u"&&typeof window.confirm=="function"&&(t=window.confirm("Clear all lessons for this week?")),!t)return;let n=e?.currentTarget instanceof HTMLElement?e.currentTarget:null;n&&n.setAttribute("disabled","true");try{let s=await rs(h);s&&(v=s,R=null,_(s),$(s,h),j&&(j.textContent="Cleared this week's plan."))}catch(s){console.error("Failed to clear planner week",s),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to clear this week right now.")}finally{n&&n.removeAttribute("disabled")}}async function or(e,t){if(!e||!le)return;let n=v?.lessons?.find(o=>o.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;le.openAddDetail({lesson:n,trigger:s})}async function ar(e,t){if(!e||!le)return;let n=v?.lessons?.find(o=>o.id===e);if(!n)return;let s=t instanceof HTMLElement?t:null;le.openEditLesson({lesson:n,trigger:s})}async function As(e,t,n){if(!e||!t)return;let s=h||oe();if(!s)return;let o=n instanceof HTMLElement?n:null;o&&o.setAttribute("disabled","true");try{let a=await as(s,e,t);a&&(v=a,_(a),$(a,s))}catch(a){console.error("Failed to move planner lesson",a),typeof window<"u"&&typeof window.alert=="function"&&window.alert("Unable to move that lesson right now.")}finally{o&&o.removeAttribute("disabled")}}async function rr(e){if(!e||typeof window>"u")return;let t=v?.lessons?.find(s=>s.id===e);if(window.confirm(t?.title?`Delete "${t.title}" from this week?`:"Delete this lesson?"))try{let s=await os(h,e);s&&(v=s,_(s),$(s,h))}catch(s){console.error("Failed to delete planner lesson",s),window.alert("Unable to delete that lesson right now.")}}function xt(){if(Fe||!F){Fe&&we(h);return}Fe=!0,es({ensureFirestore:qe}),F.addEventListener("click",_a),F.addEventListener("click",er),F.addEventListener("change",za),F.addEventListener("input",Ga),F.addEventListener("focusout",Xa),F.addEventListener("toggle",Qa),$e?.addEventListener("click",Ra),ie instanceof HTMLTextAreaElement&&ie.addEventListener("input",ja),ea?.addEventListener("click",Js),Jo?.addEventListener("click",tr),Qo?.addEventListener("click",nr),Zo?.addEventListener("click",sr),yt?.addEventListener("change",Oa),Jt?.addEventListener("click",()=>dt("list")),en?.addEventListener("click",()=>dt("week")),Yo?.addEventListener("click",()=>{let e=De(h,-1);we(e)}),Go?.addEventListener("click",()=>{let e=De(h,1);we(e)}),Xo?.addEventListener("click",()=>{we(oe())}),dt(Gs),we(h)}function ks(){typeof window>"u"||Ns()==="planner"&&xt()}function ir(e){let t=e?.detail?.plan;t&&(Fe&&t.weekId===h?(v=t,_(t),yn(t.weekId),$(t,t.weekId)):t.weekId===Le&&$(t,Le))}$(null,Le);typeof document<"u"&&document.addEventListener(Pt,ir);typeof window<"u"&&(window.addEventListener("hashchange",ks),window.addEventListener("DOMContentLoaded",ks));var eo="dailyTasksByDate",lt=null;function bn(){let e=new Date,t=String(e.getFullYear()),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function lr(e){if(typeof e!="string")return"";let[t,n,s]=e.split("-"),o=Number.parseInt(t,10),a=Number.parseInt(n,10),i=Number.parseInt(s,10);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(i))return e;let r=new Date(o,a-1,i);return Number.isNaN(r.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",day:"numeric",year:"numeric"}).format(r)}function Oe(e){if(!Zt)return;let t=Array.isArray(e)&&e.some(n=>!!n?.completed);Zt.disabled=!t}function pe(e){if(!re)return;if(!Array.isArray(e)||e.length===0){re.innerHTML='<p class="text-sm text-base-content/60">No tasks for today yet.</p>',Oe([]);return}let t=e.map((n,s)=>{let o=C(n?.text||""),a=!!n?.completed,i=`daily-task-${s}`,r=["ml-3","flex-1","text-sm","sm:text-base","text-base-content"];return a&&r.push("line-through","text-opacity-50"),`
        <label class="flex items-center p-3 border-b border-base-200" data-task-index="${s}" for="${i}">
          <input id="${i}" type="checkbox" class="checkbox checkbox-sm" data-task-index="${s}" ${a?"checked":""} />
          <span class="${r.join(" ")}">${o}</span>
        </label>
      `}).join("");re.innerHTML=t,Oe(e)}function wt(){pt&&pt.classList.remove("hidden")}function En(){pt&&pt.classList.add("hidden")}function wn(e){return{text:typeof e?.text=="string"?e.text:"",completed:!!e?.completed}}function Te(e){return Array.isArray(e)?e.map(t=>wn(t)):[]}function vn(){if(typeof localStorage>"u")return{};try{let e=localStorage.getItem(eo);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(e){return console.warn("Unable to read daily tasks from storage",e),{}}}function to(e){if(!(typeof localStorage>"u"))try{let t=e&&typeof e=="object"?e:{};localStorage.setItem(eo,JSON.stringify(t))}catch(t){console.warn("Unable to persist daily tasks locally",t)}}function Cs(e){let t=vn(),n=t&&typeof t=="object"?t[e]:[];return Te(n)}function cn(e,t){let n=vn(),s=Te(t);return n[e]=s,to(n),s}function Is(e,t){let n=vn(),s=Te(n[e]);return s.push(wn(t)),n[e]=s,to(n),s}function At(e){let t=typeof e?.code=="string"?e.code.toLowerCase():"";if(t)return t.includes("permission-denied")||t.includes("insufficient-permission");let n=typeof e?.message=="string"?e.message.toLowerCase():"";return!!(n&&n.includes("permission"))}async function Sn(){return lt||(lt=qe().then(e=>{let{db:t,getCollection:n}=e,s=typeof n=="function"&&t?n(t,"dailyLists"):null;return{...e,dailyListsCollection:s}}).catch(e=>{throw console.error("Failed to initialise Firestore for daily lists",e),e}),lt)}function Ln(e,t){let{doc:n,dailyListsCollection:s,db:o}=e||{};if(typeof n!="function")throw new Error("Firestore document helper is unavailable");return s?n(s,t):n(o,"dailyLists",t)}async function Tn(){if(!ds||!re)return;let e=bn(),t=lr(e);ds.textContent=t?`Today's List - ${t}`:"Today's List";let n=!1;if(me){wt();let s=Cs(e);D=s,pe(s),n=!0}return rt||(n||(re.innerHTML='<p class="text-sm text-base-content/60">Loading tasks\u2026</p>',Oe([])),rt=(async()=>{try{let s=await Sn(),o=Ln(s,e),a=await s.getDoc(o),i=a.exists()?a.data()?.tasks:[];return D=Te(i),pe(D),cn(e,D),me=!1,En(),D}catch(s){At(s)?(console.warn("Falling back to local daily tasks due to permission issue",s),me=!0,wt()):console.error("Failed to load daily list",s);let a=Cs(e);return D=a,a.length||n?pe(a):(re.innerHTML='<p class="text-sm text-error">Unable to load daily tasks right now.</p>',D=[],Oe(D)),D}})().finally(()=>{rt=null})),rt}async function cr(e){let t=bn(),n=wn(e);try{let s=await Sn(),o=Ln(s,t),a=await s.getDoc(o);if(a.exists()&&typeof s.arrayUnion=="function")await s.updateDoc(o,{tasks:s.arrayUnion(n)});else{let i=a.exists()?a.data()?.tasks:[],r=Array.isArray(i)?Te(i):[];r.push(n),typeof s.setDoc=="function"?await s.setDoc(o,{tasks:r},{merge:!0}):await s.updateDoc(o,{tasks:r})}Is(t,n),me=!1,En()}catch(s){if(At(s)){console.warn("Saving task locally because cloud sync is unavailable",s),me=!0,wt(),Is(t,n);return}throw s}}async function no(e){let t=bn(),n=Te(e);try{let s=await Sn(),o=Ln(s,t);typeof s.setDoc=="function"?await s.setDoc(o,{tasks:n},{merge:!0}):await s.updateDoc(o,{tasks:n}),cn(t,n),me=!1,En()}catch(s){if(At(s)){console.warn("Persisting daily tasks locally because cloud sync is unavailable",s),me=!0,wt(),cn(t,n);return}throw s}}function so(e){[ft,mt].forEach(t=>{if(!t)return;let n=t===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")})}function dr(){!He||!Re||(He.classList.remove("hidden"),Re.classList.add("hidden"),so(ft))}function ur(){!He||!Re||(He.classList.add("hidden"),Re.classList.remove("hidden"),so(mt),Tn())}function fr(){document.querySelectorAll("[data-dashboard-tab-group]").forEach(t=>{let n=Array.from(t.querySelectorAll("[data-dashboard-tab]")),s=Array.from(t.querySelectorAll("[data-dashboard-panel]"));if(!n.length||!s.length)return;let o=r=>{n.forEach(l=>{if(!l)return;let u=l.getAttribute("data-dashboard-tab")===r;l.classList.toggle("tab-active",u),l.setAttribute("aria-selected",u?"true":"false")}),s.forEach(l=>{if(!l)return;let u=l.getAttribute("data-dashboard-panel")===r;l.classList.toggle("hidden",!u),l.setAttribute("aria-hidden",u?"false":"true")})},i=(n.find(r=>r.classList.contains("tab-active"))||n[0])?.getAttribute("data-dashboard-tab");i&&o(i),n.forEach(r=>{r.addEventListener("click",()=>{let l=r.getAttribute("data-dashboard-tab");l&&o(l)})})})}window.addEventListener("DOMContentLoaded",fr);ft&&mt&&He&&Re&&(ft.addEventListener("click",e=>{e.preventDefault(),dr()}),mt.addEventListener("click",e=>{e.preventDefault(),ur()}));var U=null,K=!1,ut=null;function Se(e){if(!z)return;z.setAttribute("aria-pressed",e?"true":"false");let t=z.querySelector('[aria-hidden="true"]');t?t.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F":z.textContent=e?"\u{1F442}":"\u{1F399}\uFE0F"}function mr(){K&&(window.clearTimeout(ut),ut=window.setTimeout(()=>{ut=null,K&&oo(!0)},400))}function oo(e=!1){if(!U)return!1;if(K&&!e)return!0;try{return U.start(),K=!0,Se(!0),!0}catch{return K=!1,Se(!1),!1}}function xn(){if(U){K=!1,window.clearTimeout(ut);try{U.stop()}catch{}Se(!1)}}function pr(){if(z)try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){z.setAttribute("disabled","true"),z.setAttribute("aria-disabled","true"),z.title="Voice input is not supported in this browser.";return}U=new e;let t=document.documentElement?.lang||navigator?.language||"en-AU";if(U.lang=t,U.interimResults=!1,"continuous"in U)try{U.continuous=!0}catch{}U.onresult=n=>{let s=n?.results?.[0]?.[0]?.transcript||"";if(s&&W){W.value=s.trim();try{W.focus({preventScroll:!0})}catch{W.focus()}try{let o=W.value.length;W.setSelectionRange(o,o)}catch{}}},U.onend=()=>{if(!K){Se(!1);return}mr()},U.onerror=()=>{K=!1,Se(!1)}}catch{U=null,Se(!1),z.setAttribute("disabled","true"),z.setAttribute("aria-disabled","true")}}pr();z?.addEventListener("click",()=>{U&&(K?xn():oo())});Ps?.addEventListener("submit",()=>{K&&xn()});window.addEventListener("pagehide",()=>{K&&xn()});Ps?.addEventListener("submit",async e=>{if(e.preventDefault(),!W)return;let t=W.value.trim();if(!t){W.focus();return}let n={text:t,completed:!1};W.value="",W.focus();try{await cr(n),await Tn()}catch(s){console.error("Failed to add task to the daily list",s),W.value=t,W.focus()}});re?.addEventListener("change",async e=>{let t=e.target instanceof HTMLInputElement?e.target:null;if(!t||t.type!=="checkbox")return;let n=Number.parseInt(t.getAttribute("data-task-index")||"",10);if(!Array.isArray(D)||Number.isNaN(n)||!D[n])return;let s=document.activeElement===t,o=()=>{if(!s)return;let r=re?.querySelector(`input[data-task-index="${n}"]`);if(r instanceof HTMLInputElement)try{r.focus({preventScroll:!0})}catch{r.focus()}},a=D.map(r=>({...r})),i=a.map((r,l)=>l===n?{...r,completed:t.checked}:r);D=i,pe(i),o();try{await no(i)}catch(r){console.error("Failed to update task completion state",r),D=a,pe(a),o()}});Zt?.addEventListener("click",async()=>{if(!Array.isArray(D)||D.length===0)return;let e=D.filter(n=>!n.completed);if(e.length===D.length)return;let t=D.map(n=>({...n}));D=e,pe(e);try{await no(e)}catch(n){console.error("Failed to clear completed tasks",n),D=t,pe(t)}});Oe(D);Tn();function yr(){if(typeof document>"u")return;let e=document.getElementById("noteTitle"),t=document.getElementById("noteBody"),n=document.getElementById("noteSaveBtn"),s=document.getElementById("noteNewBtn"),o=document.getElementById("notesList"),a=document.querySelector("[data-notes-layout]"),i=document.querySelectorAll("[data-notes-shelf-toggle]");if(!e||!t||!n||!s)return;let r=null,l=()=>{if(typeof e.focus=="function")try{e.focus({preventScroll:!0})}catch{e.focus()}},u=()=>a&&a.dataset.notesShelfState==="collapsed"?"collapsed":"expanded",b=m=>{let f=m==="collapsed";i.forEach(E=>{if(!(E instanceof HTMLElement))return;E.setAttribute("aria-expanded",f?"false":"true");let S=E.dataset.notesShelfToggleVariant;S==="primary"?E.textContent=f?"Show saved notes":"Hide saved notes":S==="close"&&(E.textContent=f?"Show":"Close")})},y=m=>{a&&(a.dataset.notesShelfState=m==="collapsed"?"collapsed":"expanded"),b(u())},w=()=>{let m=u()==="collapsed"?"expanded":"collapsed";y(m),m==="collapsed"&&l()};i.length&&(i.forEach(m=>{m.addEventListener("click",f=>{f.preventDefault(),w()})}),y(u()));let A=m=>{if(!m){r=null,e.value="",t.value="";return}r=m.id,e.value=m.title||"",t.value=m.body||""},I=()=>{if(!o)return;o.querySelectorAll("button[data-note-id]").forEach(f=>{if(!(f instanceof HTMLElement))return;let E=f.getAttribute("data-note-id")===r;f.classList.toggle("bg-base-200/80",E),f.classList.toggle("border-base-300",!E),f.classList.toggle("border-primary",E),f.classList.toggle("font-medium",E),f.setAttribute("aria-current",E?"true":"false")})},B=()=>{let m=Ye();return Array.isArray(m)?[...m].sort((f,E)=>{let S=Date.parse(f?.updatedAt||""),L=Date.parse(E?.updatedAt||"");return(Number.isNaN(L)?0:L)-(Number.isNaN(S)?0:S)}):[]},P=m=>{if(!m)return;let f=Ye();if(!Array.isArray(f))return;let E=f.filter(L=>L.id!==m);if(E.length===f.length)return;It(E),r===m&&(r=null);let S=M();if(r){let L=S.find(d=>d.id===r)||null;A(L)}else S.length?A(S[0]):A(null);I()},M=(m=B())=>{if(!o)return m;if(o.innerHTML="",!m.length){let f=document.createElement("li");return f.className="text-sm italic text-base-content/60",f.textContent="No saved notes yet.",o.appendChild(f),m}return m.forEach(f=>{let E=document.createElement("li");E.className="flex items-center gap-2";let S=document.createElement("button");S.type="button",S.dataset.noteId=f.id,S.className="w-full flex-1 rounded-lg border border-base-300 bg-base-100 px-3 py-2 text-left transition hover:bg-base-200 focus:outline-none focus-visible:ring focus-visible:ring-primary/60",S.textContent=f.title||"Untitled note",S.addEventListener("click",()=>{A(f),I(),l()});let L=document.createElement("button");L.type="button",L.className="btn btn-ghost btn-xs text-error focus-visible:ring focus-visible:ring-error/60",L.setAttribute("aria-label",`Delete note "${f.title||"Untitled note"}"`),L.textContent="Delete",L.addEventListener("click",d=>{d.stopPropagation(),P(f.id)}),E.appendChild(S),E.appendChild(L),o.appendChild(E)}),I(),m},T=()=>{let m=M();if(!m.length){A(null),I();return}let f=r?m.find(E=>E.id===r):null;A(f||m[0]),I()};n.addEventListener("click",()=>{let m=Ye(),f=Array.isArray(m)?[...m]:[],E=typeof e.value=="string"?e.value.trim():"",S=typeof t.value=="string"?t.value:"",L=E||"Untitled note",d=new Date().toISOString();if(r){let k=f.findIndex(O=>O.id===r);if(k>=0)f[k]={...f[k],title:L,body:S,updatedAt:d};else{let O=Ct(L,S,{updatedAt:d});r=O.id,f.unshift(O)}}else{let k=Ct(L,S);r=k.id,f.unshift(k)}It(f);let p=M(),N=r?p.find(k=>k.id===r):null;A(N||null),I()}),s.addEventListener("click",()=>{r=null,e.value="",t.value="",I(),l()}),T()}yr();var ao="theme",gr="professional",dn="memoryCue:theme-change",hr="professional",un=document.getElementById("theme-menu"),ro="[data-theme-name],[data-theme-option]",br=new Set(["dark","dracula","synthwave"]);function ce(e){return typeof e=="string"?e.trim():""}function io(e){return e instanceof HTMLElement?ce(e.getAttribute("data-theme-name")||e.getAttribute("data-theme-option")||""):""}function Er(e){let t=ce(e);t&&(document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("dark",br.has(t)))}function Ds(e){let t=ce(e);if(t)try{localStorage.setItem(ao,t)}catch(n){console.warn("Unable to save theme preference",n)}}function lo(e){if(!un)return;let t=ce(e);un.querySelectorAll(ro).forEach(s=>{if(!(s instanceof HTMLElement))return;let o=io(s),a=t&&o===t;s.setAttribute("aria-checked",a?"true":"false"),s.classList.toggle("active",a)})}function wr(e){let t=ce(e);if(!(typeof window>"u"||!t))try{window.dispatchEvent(new CustomEvent(dn,{detail:{theme:t}}))}catch{if(typeof document<"u"&&typeof document.createEvent=="function"){let s=document.createEvent("CustomEvent");s.initCustomEvent(dn,!0,!0,{theme:t}),window.dispatchEvent(s)}}}function fn(e,{persist:t=!0,notify:n=!0}={}){let s=ce(e);if(!s)return;ce(document.documentElement.getAttribute("data-theme"))!==s&&Er(s),t&&Ds(s),lo(s),n&&wr(s)}function vr(){if(typeof document<"u"&&document.body instanceof HTMLElement&&document.body.classList.contains("desktop-shell")){fn(hr,{persist:!0,notify:!0});return}let t="";try{t=localStorage.getItem(ao)||""}catch(s){console.warn("Unable to load theme preference",s)}let n=t||document.documentElement.getAttribute("data-theme")||gr;n&&fn(n,{persist:!1,notify:!0})}un?.addEventListener("click",e=>{let t=e.target instanceof HTMLElement?e.target.closest(ro):null;if(!t)return;e.preventDefault();let n=io(t);n&&fn(n,{persist:!0,notify:!0})});typeof window<"u"&&window.addEventListener(dn,e=>{let t=ce(e?.detail?.theme);t&&lo(t)});vr()});export default Sr();
