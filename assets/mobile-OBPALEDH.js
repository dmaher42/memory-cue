import{a as Ee,b as $e,c as Ae,d as ze}from"./chunk-WHAE3IIL.js";import{a as Se,b as Pe}from"./chunk-MG4MJA24.js";import{b as be,c as Ve}from"./chunk-CTK42JWW.js";import{b as he,c as qe}from"./chunk-GUVSRPRW.js";var X,Ye,Ge,Z,de,Te,Ie,Ne,le,Ce,z,oe,ve,je,j,Y,Le,ue,re=he(()=>{X="memoryCueNotes",Ye="memoryCueFolders",Ge=["mobileNotes"],Z=()=>typeof localStorage<"u",de=null,Te=t=>{de=typeof t=="function"?t:null},Ie=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Ne=t=>{if(typeof t!="string")return"";let e=t.trim();return e.length?(/[<>]/.test(e),t):""},le=t=>{if(typeof t!="string")return"";let e=t.trim();return e.length?/[<>]/.test(e)?t:Ne(t):""},Ce=t=>{if(typeof t!="string")return!1;let e=Date.parse(t);return!Number.isNaN(e)},z=(t,e,o={})=>{let s=typeof t=="string"?t.trim():"";return{id:o.id&&typeof o.id=="string"?o.id:Ie(),title:s||"Untitled note",body:le(e),updatedAt:o.updatedAt&&Ce(o.updatedAt)?o.updatedAt:new Date().toISOString(),folderId:o.folderId&&typeof o.folderId=="string"?o.folderId:null}},oe=t=>{if(Array.isArray(t))return t.map(e=>{if(!e||typeof e!="object")return null;let o=typeof e.title=="string"?e.title.trim():"",s=le(e.body),l=typeof e.id=="string"&&e.id.trim()?e.id:Ie(),d=Ce(e.updatedAt)?e.updatedAt:new Date().toISOString();return!o&&!s&&!e.body?null:{id:l,title:o||"Untitled note",body:s,updatedAt:d,folderId:typeof e.folderId=="string"&&e.folderId?e.folderId:null}}).filter(Boolean);if(t&&typeof t=="object"){let e=typeof t.title=="string"?t.title:"",o=typeof t.body=="string"?t.body:"",s=le(o);return!e&&!s?[]:[z(e,s,{id:typeof t.id=="string"?t.id:void 0,updatedAt:typeof t.updatedAt=="string"?t.updatedAt:void 0,folderId:typeof t.folderId=="string"?t.folderId:void 0})]}return typeof t=="string"&&t.trim().length?[z("Notebook (legacy)",Ne(t))]:[]},ve=t=>{if(!Z())return null;try{return localStorage.getItem(t)}catch{return null}},je=t=>{if(Z())try{localStorage.removeItem(t)}catch{}},j=()=>{if(!Z())return[];let t=ve(X);if(typeof t=="string")try{let e=JSON.parse(t),o=oe(e);if(o.length)return o}catch{let e=oe(t);if(e.length)return Y(e),e}for(let e of Ge){let o=ve(e);if(typeof o=="string"&&o.trim().length){let s=oe(o);if(s.length)return Y(s),je(e),s}}return[]},Y=(t,e={})=>{if(!Z()||!Array.isArray(t))return!1;let o=t.map(s=>{let d=oe([s])[0];return d&&(d.folderId=typeof s.folderId=="string"&&s.folderId?s.folderId:d.folderId||null),d}).filter(Boolean);try{if(localStorage.setItem(X,JSON.stringify(o)),!e.skipRemoteSync&&typeof de=="function")try{let s=de(o);s&&typeof s.then=="function"&&s.catch(l=>{console.error("[notes-storage] Remote sync failed.",l)})}catch(s){console.error("[notes-storage] Remote sync handler threw.",s)}return!0}catch{return!1}},Le=()=>[{id:"unsorted",name:"Unsorted"}],ue=()=>{if(!Z())return Le();try{let t=localStorage.getItem(Ye);if(typeof t=="string"){let e=JSON.parse(t);if(Array.isArray(e)&&e.length)return e.map(o=>({id:String(o.id),name:String(o.name)}))}}catch{}return Le()}});var Je,Ke,We,ie,Qe,Xe,we,Be=he(()=>{Ve();re();Je="notes",Ke="user_id",We="updated_at",ie=t=>{if(typeof t!="string")return 0;let e=Date.parse(t);return Number.isNaN(e)?0:e},Qe=(t=[],e=[])=>{let o=new Map;return e.forEach(s=>{s&&typeof s.id=="string"&&o.set(s.id,s)}),t.forEach(s=>{if(!s||typeof s.id!="string")return;let l=o.get(s.id);if(!l){o.set(s.id,s);return}let d=ie(s.updatedAt),u=ie(l.updatedAt);d>u&&o.set(s.id,s)}),Array.from(o.values()).sort((s,l)=>ie(l?.updatedAt)-ie(s?.updatedAt))},Xe=t=>e=>{if(!e||typeof e!="object")return null;let o={id:typeof e.id=="string"&&e.id?e.id:void 0,updatedAt:typeof e[t]=="string"?e[t]:void 0,folderId:typeof e.folder_id=="string"&&e.folder_id?e.folder_id:void 0};return z(e.title,e.body,o)},we=(t={})=>{let{tableName:e=Je,userColumn:o=Ke,updatedAtColumn:s=We,supabase:l=null}=t,d=l||null,u=null,p=!1,k=new Set,F=()=>d||(d=be(),d),x=Xe(s),m=async f=>{let C=F();if(!C||!u)return;let D=(Array.isArray(f)?f.filter(h=>h&&typeof h.id=="string"):[]).map(h=>({id:h.id,[o]:u,title:h.title,body:h.body,folder_id:typeof h.folderId=="string"&&h.folderId?h.folderId:null,[s]:typeof h.updatedAt=="string"&&h.updatedAt?h.updatedAt:new Date().toISOString()})),R=new Set(D.map(h=>h.id));if(D.length){let{error:h}=await C.from(e).upsert(D);if(h)throw h}let H=[...k].filter(h=>h&&!R.has(h));if(H.length){let{error:h}=await C.from(e).delete().in("id",H).eq(o,u);if(h)throw h}k=new Set(R)},I=async()=>{let f=F();if(!(!f||!u))try{let{data:C,error:M}=await f.from(e).select(`id,title,body,folder_id,${s}`).eq(o,u);if(M)throw M;let D=Array.isArray(C)?C:[];k=new Set(D.map(S=>typeof S.id=="string"?S.id:null).filter(Boolean));let R=D.map(x).filter(Boolean),H=j();if(!R.length){if(H.length)try{await m(H)}catch(S){console.error("[notes-sync] Failed to upload local notes to Supabase.",S)}return}let h=Qe(H,R);p=!0;let a=Y(h,{skipRemoteSync:!0});p=!1,a||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await m(h)}catch(S){console.error("[notes-sync] Failed to reconcile notes with Supabase.",S)}}catch(C){console.error("[notes-sync] Failed to fetch notes from Supabase.",C)}finally{p=!1}};return Te(async f=>{if(!p)try{await m(f)}catch(C){console.error("[notes-sync] Failed to sync notes to Supabase.",C)}}),{setSupabaseClient(f){f&&(d=f)},handleSessionChange:async f=>{if(u=typeof f?.id=="string"?f.id:null,!u){k=new Set;return}await I()},syncFromRemote:I}}});var Ze=qe(()=>{Pe();ze();$e();re();re();Be();Se();(function(){let t=()=>{let e=document.getElementById("create-sheet"),o=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(o instanceof HTMLElement)){let a=typeof t._retryCount=="number"?t._retryCount:0;a<10&&(t._retryCount=a+1,setTimeout(t,50));return}if(t._initialised)return;t._initialised=!0;let s=e.querySelector("[data-dialog-content]"),l=e.querySelector(".sheet-backdrop"),d=document.getElementById("createReminderForm"),u=document.getElementById("saveReminder"),p=document.getElementById("priority"),k=document.getElementById("priorityChips"),F=k?Array.from(k.querySelectorAll('input[name="priority"]')):[],x=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),m=Array.from(x).filter(a=>a instanceof HTMLElement),I=m[0]||null,U=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};U();let f=null,C=(a,S)=>{try{document.dispatchEvent(new CustomEvent(a,{detail:S}))}catch(w){console.warn(`${a} dispatch failed`,w)}},M=()=>{let a=p?.value||"Medium";F.forEach(S=>{let w=S.value===a;S.checked=w,S.setAttribute("aria-checked",w?"true":"false")})},D=a=>{p&&(p.value!==a&&(p.value=a,p.dispatchEvent(new Event("change",{bubbles:!0}))),M())};F.forEach(a=>{a.addEventListener("change",()=>{a.checked&&D(a.value)})}),p?.addEventListener("change",M),M();let R=()=>{let a=e.querySelector('input, textarea, select, button, [contenteditable="true"]');a instanceof HTMLElement&&setTimeout(()=>{try{a.focus()}catch{}},0)},H=a=>{f=a instanceof HTMLElement?a:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),f&&f.setAttribute("aria-expanded","true"),M(),R(),C("reminder:sheet-opened",{trigger:f})},h=(a="dismissed")=>{let S=!e.classList.contains("hidden");U(),f&&f.setAttribute("aria-expanded","false");let w=f&&document.body.contains(f)&&f||I;if(w&&typeof w.focus=="function")try{w.focus()}catch{}S&&C("reminder:sheet-closed",{reason:a,trigger:f}),f=null};m.forEach(a=>{a.addEventListener("click",S=>{S.preventDefault();let w={mode:"create",trigger:a};C("cue:prepare",w),C("cue:open",w)})}),o.addEventListener("click",a=>{a.preventDefault(),h("close-button")}),l?.addEventListener("click",a=>{a.target===l&&h("backdrop")}),e.addEventListener("keydown",a=>{a.key==="Escape"&&(a.stopPropagation(),h("escape"))}),s?.addEventListener("click",a=>{a.stopPropagation()}),e.addEventListener("click",a=>{a.target instanceof HTMLElement&&a.target.hasAttribute("data-close")&&h("backdrop")}),document.addEventListener("cue:open",a=>{M(),H(a?.detail?.trigger||null)}),document.addEventListener("cue:close",a=>{h(a?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{M()}),document.addEventListener("cue:cancelled",()=>{h("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=h),document.addEventListener("reminder:save",a=>{if(!(u instanceof HTMLElement))return;let S=a?.detail?.trigger;S&&S!==u||u.matches(":disabled")||u.click()}),d instanceof HTMLFormElement&&u instanceof HTMLElement&&d.addEventListener("submit",a=>{a.preventDefault(),!u.matches(":disabled")&&u.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();var se=()=>{se._initialised||(se._initialised=!0,Ae({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(t=>{console.error("Failed to initialise reminders:",t)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",se,{once:!0}):se();var ke=()=>{let t=document.getElementById("notifHeaderBtn"),e=document.getElementById("notifBtn");t&&e&&t.addEventListener("click",()=>{e.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ke,{once:!0}):ke();var xe=()=>{if(typeof document>"u")return;let t=document.getElementById("noteTitleMobile"),e=document.getElementById("scratchNotesEditor"),o=document.getElementById("noteSaveMobile"),s=document.getElementById("noteNewMobile"),l=document.getElementById("notesListMobile"),d=document.getElementById("notesCountMobile"),u=document.getElementById("notesSearchMobile"),p=document.getElementById("savedNotesSheet"),k=document.getElementById("openSavedNotesSheet"),F=document.querySelector('[data-action="close-saved-notes"]'),x="shadow-[0_0_0_3px_var(--accent-color)]",I=(()=>{if(!e)return null;let r=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return r?new r("#scratchNotesEditor",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.dataset.placeholder="Start typing your note\u2026",{element:e,setContent(n=""){e.innerHTML=n||""},getHTML(){return e.innerHTML||""},getText(){return e.textContent||""},focus(){try{e.focus()}catch{}}})})();if(!t||!I||!e||!o)return;let U=document.getElementById("scratchNotesToolbar");U&&e&&U.addEventListener("click",r=>{let n=r.target.closest("button[data-format]");if(!n)return;let c=n.getAttribute("data-format");try{e.focus()}catch{}switch(c){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"ul":document.execCommand("insertUnorderedList",!1,null);break;case"ol":document.execCommand("insertOrderedList",!1,null);break;default:break}});let f=(r="")=>{if(I&&typeof I.setContent=="function"){I.setContent(r||"");return}e.innerHTML=r||""},C=()=>I&&typeof I.getHTML=="function"?I.getHTML()||"":e.innerHTML||"",M=()=>I&&typeof I.getText=="function"?I.getText()||"":e.textContent||"",D=r=>{let n=r;for(;n&&n!==e;){if(n.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(n.tagName?.toLowerCase()))return n;n=n.parentNode}return e},R=r=>{if(typeof r!="string")return null;let n=r.replace(/\u00a0/g," ").trim();return n==="*"?"ul":n==="1"?"ol":null},H=r=>{if(![" ","Enter"].includes(r.key))return;let n=window.getSelection();if(!n||n.rangeCount===0)return;let c=n.getRangeAt(0);if(!e.contains(c.startContainer))return;let g=D(c.startContainer),b=c.cloneRange();b.selectNodeContents(g),b.setEnd(c.startContainer,c.startOffset);let A=R(b.toString());if(!A)return;r.preventDefault();let _=(g.textContent||"").replace(/^\s*[\*1]\s?/,"");g.textContent=_;let P=g.firstChild||g,V=document.createRange();V.setStart(P,(P.nodeType===Node.TEXT_NODE,0)),V.collapse(!0),n.removeAllRanges(),n.addRange(V);try{e.focus()}catch{}document.execCommand(A==="ul"?"insertUnorderedList":"insertOrderedList",!1,null)},h=(r,n=200)=>{let c;return(...g)=>{c&&clearTimeout(c),c=setTimeout(()=>{r(...g)},n)}},a=null,S=[],w="all",G="",i=!1,y=null,L=()=>p?.dataset.open==="true",B=()=>{p&&(y&&(clearTimeout(y),y=null),p.classList.remove("hidden"),p.dataset.open="true",p.setAttribute("aria-hidden","false"))},v=()=>{p&&(p.dataset.open="false",p.setAttribute("aria-hidden","true"),y&&clearTimeout(y),y=setTimeout(()=>{p?.classList.add("hidden")},200))};(()=>{p&&(k?.addEventListener("click",r=>{r.preventDefault(),B();let n=document.getElementById("notesListMobile");n&&(n.scrollTop=0)}),F?.addEventListener("click",r=>{r.preventDefault(),v()}),p.addEventListener("click",r=>{r.target===p&&v()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&L()&&v()}))})();let E=()=>typeof G=="string"?G.trim().toLowerCase():"",q=(r=S)=>{if(!Array.isArray(r))return[];let n=E();return n?r.filter(c=>{let g=typeof c?.title=="string"?c.title.toLowerCase():"",b=typeof c?.body=="string"?c.body.toLowerCase():"";return g.includes(n)||b.includes(n)}):[...r]},ye=(r=S)=>{if(!Array.isArray(r))return[];let n;return w===null||w==="all"?n=[...r]:w==="unsorted"?n=r.filter(c=>!c.folderId||c.folderId==="unsorted"):n=r.filter(c=>c.folderId===w),q(n)},O=r=>{if(!r){a=null,t.value="",f(""),delete t.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;return}a=r.id;let n=r.title||"",c=r.body||"";t.value=n,f(c),t.dataset.noteOriginalTitle=n,e.dataset.noteOriginalBody=c},Me=()=>({title:typeof t.value=="string"?t.value.trim():"",body:C()}),J=()=>{if(!l)return;l.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(n=>{if(!(n instanceof HTMLElement))return;let c=n.getAttribute("data-note-id")===a;c?n.setAttribute("data-state","active"):n.removeAttribute("data-state"),n.classList.toggle("active",c),n.classList.toggle("outline",c),n.classList.toggle("outline-2",c),n.classList.toggle("outline-accent",c),n.classList.toggle(x,c),n.setAttribute("aria-current",c?"true":"false")})},De=r=>{if(!r)return"";let n=new Date(r);if(Number.isNaN(n.getTime()))return"";let c=new Date,g=n.getFullYear()===c.getFullYear()&&n.getMonth()===c.getMonth()&&n.getDate()===c.getDate(),b=n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return g?`Today \xB7 ${b}`:`${n.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${b}`},ae=()=>{let r=typeof t.value=="string"?t.value:"",n=C(),c=t.dataset.noteOriginalTitle??"",g=e.dataset.noteOriginalBody??"";return r!==c||n!==g},Oe=()=>{let r=j();return Array.isArray(r)?[...r].sort((n,c)=>{let g=Date.parse(n?.updatedAt||""),b=Date.parse(c?.updatedAt||"");return(Number.isNaN(b)?0:b)-(Number.isNaN(g)?0:g)}):[]},ce=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(X)}catch{return null}},K=ce(),ee=()=>(K=ce(),K),W=({preserveDraft:r=!0}={})=>{let n=Oe();S=Array.isArray(n)?[...n]:[];let c=r&&ae(),g=S.length>0,b=ye();if(pe(b),!g)return c||O(null),J(),ee(),i=!1,b;if(a){let A=S.find(N=>N.id===a)||null;A?c||O(A):(a=null,!c&&!i&&S[0]&&O(S[0]))}else!c&&!i&&S[0]&&O(S[0]);return i=!1,J(),ee(),b},Fe=r=>{if(!r)return;let n=j();if(!Array.isArray(n))return;let c=n.filter(g=>g.id!==r);c.length!==n.length&&(Y(c),ee(),a===r&&(O(null),i=!0),W({preserveDraft:!1}))},pe=(r=[])=>{if(!l)return r;if(l.innerHTML="",d){let n=S.length,c=r.length;d.textContent=n?`${c} of ${n} saved`:"No saved notes yet"}if(!r.length){let n=document.createElement("li");return n.className="text-xs italic text-base-content/60 px-3 py-4 text-center rounded-2xl border border-dashed border-base-200/80 bg-base-100/50",n.textContent=S.length&&E()?"No notes match this filter.":"No saved notes yet.",l.appendChild(n),r}return r.forEach(n=>{let c=document.createElement("li");c.className="note-item-mobile w-full";let g=document.createElement("button");g.type="button",g.dataset.noteId=n.id,g.dataset.role="open-note",g.className="saved-note-item note-list-item w-full text-left active:scale-[0.99] focus:outline-none";let b=document.createElement("div");b.className="flex items-center justify-between gap-2";let A=document.createElement("span");A.className="saved-note-title note-list-title truncate";let N=n.title||"Untitled";A.textContent=N,A.setAttribute("title",N);let _=document.createElement("span");_.className="saved-note-meta note-list-meta";let P=n.updatedAt||n.modifiedAt||n.createdAt||"";_.textContent=P?De(P):"",b.appendChild(A),b.appendChild(_);let V=document.createElement("p");V.className="saved-note-preview note-list-preview line-clamp-2";let He=n.body||"",_e=String(He).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();V.textContent=_e||"No content yet.",g.appendChild(b),g.appendChild(V);let $=document.createElement("button");$.type="button",$.dataset.noteId=n.id,$.dataset.role="delete-note",$.className="delete-note-btn btn btn-ghost btn-xs text-error shrink-0 focus-visible:outline-none focus-visible:ring-0",$.setAttribute("aria-label","Delete note"),$.textContent="\u2715";let ne=document.createElement("div");ne.className="flex items-start justify-between gap-3",ne.appendChild(g),ne.appendChild($),c.appendChild(ne),l.appendChild(c)}),J(),r},Q=document.getElementById("notebook-folder-bar"),Ue=()=>{if(!Q)return;Q.innerHTML="";let r=[];try{r=Array.isArray(ue())?ue():[]}catch{r=[]}r.some(A=>A&&A.id==="unsorted")||r.unshift({id:"unsorted",name:"Unsorted"});let c=r.filter(A=>A&&A.id!=="unsorted").sort((A,N)=>String(A.name).localeCompare(String(N.name))),g=[];g.push({id:"all",name:"All"}),g.push({id:"unsorted",name:"Unsorted"}),g.push(...c),g.forEach(A=>{let N=document.createElement("button");N.type="button",N.className="folder-chip",N.dataset.folderId=A.id,N.textContent=A.name,String(w)===String(A.id)&&N.classList.add("active"),N.addEventListener("click",()=>{w=A.id==="all"?"all":A.id,Q.querySelectorAll(".folder-chip").forEach(P=>P.classList.remove("active")),N.classList.add("active"),ge()}),Q.appendChild(N)});let b=document.createElement("button");b.type="button",b.className="folder-chip outlined",b.textContent="+ New folder",b.addEventListener("click",()=>{console.log("New folder click (to be implemented)")}),Q.appendChild(b)},et=()=>{try{Ue()}catch(r){console.warn("[notebook] Unable to build folder bar",r)}};l&&l.addEventListener("click",r=>{let n=r.target;if(!(n instanceof HTMLElement))return;let c=n.closest('button[data-role="delete-note"]');if(c&&l.contains(c)){r.preventDefault();let b=c.getAttribute("data-note-id");if(!b)return;let A=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(A?A("Delete this note? This cannot be undone."):!0)&&Fe(b);return}let g=n.closest('button[data-role="open-note"]');if(g&&l.contains(g)){r.preventDefault();let b=g.getAttribute("data-note-id");if(!b)return;let A=S.find(N=>N.id===b);A&&(O(A),J(),L()&&v())}});let ge=()=>{pe(q())};if(u){let r=h(()=>{G=typeof u.value=="string"?u.value:"",ge()},180);u.addEventListener("input",r),u.addEventListener("search",r)}let Re=()=>{W({preserveDraft:!1})};o.addEventListener("click",()=>{let r=j(),n=Array.isArray(r)?[...r]:[],{title:c,body:g}=Me(),b=c||"Untitled note",A=new Date().toISOString();if(a){let N=n.findIndex(_=>_.id===a);if(N>=0)n[N]={...n[N],title:b,body:g,updatedAt:A};else{let _=z(b,g,{updatedAt:A});a=_.id,n.unshift(_)}}else{let N=z(b,g);a=N.id,n.unshift(N)}Y(n),ee(),W({preserveDraft:!1})}),s&&s.addEventListener("click",()=>{O(null),J(),typeof t.focus=="function"&&t.focus()});let te=h(()=>{try{if(!ae())return;o instanceof HTMLElement&&!o.matches(":disabled")&&o.click()}catch{}},1500);try{t.addEventListener("input",te)}catch{}try{e.addEventListener("input",te),e.addEventListener("keydown",H),e.addEventListener("blur",()=>{te()}),t.addEventListener("blur",()=>te())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",r=>{try{ae()&&o instanceof HTMLElement&&!o.matches(":disabled")&&o.click()}catch{}}),Re(),typeof window<"u"&&(window.addEventListener("storage",r=>{r.key===X&&(K=r.newValue??null,W({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let r=ce();r!==K&&(K=r,W({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",xe,{once:!0}):xe();var me=we(),fe=Ee({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:t=>{me?.handleSessionChange(t)}});if(fe?.supabase){me?.setSupabaseClient(fe.supabase);try{fe.supabase.auth.getSession().then(({data:t})=>{me?.handleSessionChange(t?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let t=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let o='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',s=t,l=m=>{if(!(m instanceof HTMLElement)||m.getAttribute("aria-hidden")==="true"||m.hasAttribute("disabled")||m.tabIndex<0)return!1;let I=m.getBoundingClientRect();return I.width>0||I.height>0},d=()=>Array.from(e.querySelectorAll(o)).filter(l),u=()=>{let m=e.classList.contains("hidden");e.setAttribute("aria-hidden",m?"true":"false")};u();let p=m=>{!e.contains(m.target)&&m.target!==t&&x({restoreFocus:!1})},k=()=>{let[m]=d();if(m instanceof HTMLElement)try{m.focus()}catch{}},F=()=>{e.classList.contains("hidden")&&(s=document.activeElement instanceof HTMLElement?document.activeElement:t,e.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),u(),document.addEventListener("focusin",p),!e.contains(document.activeElement)&&k())},x=({restoreFocus:m=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),t.setAttribute("aria-expanded","false"),u(),document.removeEventListener("focusin",p),m&&s instanceof HTMLElement))try{s.focus()}catch{}};t.addEventListener("click",m=>{m.stopPropagation(),e.classList.contains("hidden")?F():x()}),document.addEventListener("click",m=>{m.target===t||e.contains(m.target)||x({restoreFocus:!1})}),document.addEventListener("keydown",m=>{if(m.key==="Escape"){x();return}m.key==="ArrowDown"&&!e.classList.contains("hidden")&&(m.preventDefault(),k())}),e.addEventListener("click",m=>{m.stopPropagation(),m.target instanceof HTMLElement&&m.target.closest("button")&&x({restoreFocus:!1})}),e.addEventListener("keydown",m=>{if(m.key!=="Tab")return;let I=d();if(!I.length)return;let U=I.indexOf(document.activeElement),f=I.length-1,C=U;m.shiftKey?C=U<=0?f:U-1:C=U===f?0:U+1,m.preventDefault();let M=I[C]||I[0];if(M instanceof HTMLElement)try{M.focus()}catch{}})})();(()=>{let t=document.getElementById("voiceAddBtn");if(!(t instanceof HTMLElement))return;let e=()=>{let l=document.getElementById("voiceBtn");return l instanceof HTMLElement?l:null},o=()=>{let l=e();if(!l)return;let d=()=>{l.hasAttribute("disabled")||l.getAttribute("aria-disabled")==="true"?(t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"));let p=l.getAttribute("title");p&&t.setAttribute("title",p)};d(),typeof MutationObserver=="function"&&new MutationObserver(d).observe(l,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o();let s=()=>{let l=e();if(l&&!(l.hasAttribute("disabled")||l.getAttribute("aria-disabled")==="true")){try{l.focus({preventScroll:!0})}catch{try{l.focus()}catch{}}try{l.click()}catch(d){console.warn("Voice add trigger failed",d)}}};t.addEventListener("click",l=>{l.preventDefault();let d=!1,u=null,p=()=>{d||(d=!0,document.removeEventListener("reminder:sheet-opened",k),s())},k=x=>{if(x?.detail?.trigger!==t)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&u&&(window.clearTimeout(u),u=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,150)};document.addEventListener("reminder:sheet-opened",k);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:t}}))}catch(x){document.removeEventListener("reminder:sheet-opened",k),typeof window<"u"&&typeof window.clearTimeout=="function"&&u&&(window.clearTimeout(u),u=null),console.warn("Voice add open failed",x);return}let F=document.getElementById("create-sheet");F instanceof HTMLElement&&F.classList.contains("open")&&(u=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,120))})})();(()=>{let t=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let o=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],s=()=>{let d=e.hasAttribute("open");t.setAttribute("aria-expanded",String(d)),t.classList.toggle("btn-active",d)},l=()=>{for(let d of o){let u=e.querySelector(d);if(u instanceof HTMLElement&&!u.hasAttribute("disabled")){try{u.focus({preventScroll:!0})}catch{u.focus()}return}}};t.addEventListener("click",()=>{let d=e.hasAttribute("open");e.open=!d,d||l(),s()}),e.addEventListener("toggle",s),s()})();(()=>{let t=document.getElementById("create-sheet");if(!(t instanceof HTMLElement))return;function e(){!t.classList.contains("open")&&t.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",t=>{let e=document.getElementById("totalCount");if(!e)return;let o=Array.isArray(t?.detail?.items)?t.detail.items.length:0;e.textContent=String(o)});document.addEventListener("click",t=>{try{let e=t.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let o=document.createElement("div");o.textContent="Save clicked",o.style.position="fixed",o.style.right="16px",o.style.bottom="16px",o.style.background="rgba(34,197,94,0.95)",o.style.color="#fff",o.style.padding="8px 12px",o.style.borderRadius="8px",o.style.zIndex="99999",document.body.appendChild(o),setTimeout(()=>o.remove(),900)}catch{}}}catch{}});(function(){let t=document.getElementById("reminderList");if(!t)return;let e=Array.from(t.children);if(e.length<=30)return;let o=20;t.innerHTML="";let s=0;function l(){let p=e.slice(s,s+o);p.forEach(k=>t.appendChild(k)),s+=p.length}l();let d=document.createElement("div");d.id="listSentinel",t.appendChild(d);let u=new IntersectionObserver(p=>{p.some(k=>k.isIntersecting)&&s<e.length&&(l(),s>=e.length&&u.disconnect())});u.observe(d)})();(function(){let t=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(d=>d instanceof HTMLElement),e=document.getElementById("settingsModal"),o=document.getElementById("closeSettings");if(!t.length||!e||!o)return;function s(){e.classList.remove("hidden")}function l(){e.classList.add("hidden")}t.forEach(d=>{d.addEventListener("click",s)}),o.addEventListener("click",l),e.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.matches("[data-close]")&&l()}),e.addEventListener("keydown",d=>{d.key==="Escape"&&l()})})();(function(){let t=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),o=document.getElementById("mcStatusText"),s=document.getElementById("syncUrl"),l=document.getElementById("saveSyncSettings"),d=document.getElementById("testSync"),u=document.getElementById("syncAll"),p="syncUrl";if(!o)return;let k=["online","offline","error"],F=["online","offline"],x={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},m={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},I=null;function U(i){if(!e)return;F.forEach(L=>e.classList.remove(L));let y=i!=="offline"&&i!=="error";e.classList.add(y?"online":"offline"),e.setAttribute("aria-label",y?"Online":"Offline")}function f(i,y){I=i,k.forEach(T=>o.classList.remove(T)),t&&k.forEach(T=>t.classList.remove(T)),i==="online"?(o.classList.add("online"),t&&t.classList.add("online")):i==="error"?(o.classList.add("error"),t&&t.classList.add("error")):(o.classList.add("offline"),t&&t.classList.add("offline"));let L=typeof y=="string"&&y.trim()?y.trim():x[i]||"",B=typeof y=="string"&&y.trim()?y.trim():m[i]||L,v=L||B||"";o.textContent=v,v?(o.setAttribute("title",v),o.setAttribute("aria-label",v)):(o.removeAttribute("title"),o.removeAttribute("aria-label")),U(i),o.dataset.state=i}function C(){I!=="syncing"&&f(navigator.onLine?"online":"offline")}function M(i){typeof localStorage>"u"||(i?localStorage.setItem(p,i):localStorage.removeItem(p))}function D(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(p)||""}catch{return""}}function R(i){if(!i||typeof i!="object")return null;let y=i.id||i.uid||i.key||i.slug||i.uuid,L=typeof i.title=="string"&&i.title.trim()?i.title.trim():typeof i.name=="string"?i.name.trim():"";if(!L)return null;let B=typeof i.dueIso=="string"&&i.dueIso?i.dueIso:typeof i.due=="string"?i.due:null,v=typeof i.priority=="string"&&i.priority.trim()?i.priority.trim():i.level||i.importance||"Medium",T=typeof i.category=="string"&&i.category.trim()?i.category.trim():i.group||i.bucket||"General",E=typeof i.done=="boolean"?i.done:!!(i.completed||i.isDone||i.status==="done");return{id:y||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:L,dueIso:B&&B.trim()?B.trim():null,priority:v,category:T,done:E}}function H(){let i=Array.from(document.querySelectorAll("[data-reminder]"));return i.length?i.map(y=>{let L=y.dataset||{},B=null;if(L.reminder)try{B=JSON.parse(L.reminder)}catch{B=null}let v=B||{id:L.id||L.reminderId||y.getAttribute("data-id")||null,title:L.title||L.reminderTitle||"",dueIso:L.due||L.reminderDue||y.getAttribute("data-due")||null,priority:L.priority||L.reminderPriority||y.getAttribute("data-priority")||"",category:L.category||L.reminderCategory||y.getAttribute("data-category")||"",done:L.done==="true"||L.reminderDone==="true"||y.getAttribute("data-done")==="true"};if(!v.title){let T=y.querySelector("[data-reminder-title], [data-title], h3, h4, strong");T&&(v.title=T.textContent.trim())}if(!v.dueIso){let T=y.querySelector("[data-due], time");if(T){let E=T.getAttribute("datetime")||T.getAttribute("data-due");v.dueIso=E||T.textContent.trim()}}return R(v)}).filter(Boolean):[]}function h(){if(typeof localStorage>"u")return[];let i=[],y=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(B=>{if(!y.has(B)){y.add(B);try{let v=localStorage.getItem(B);if(!v)return;let T=JSON.parse(v);Array.isArray(T)?T.forEach(E=>i.push(E)):T&&typeof T=="object"&&(Array.isArray(T.items)&&T.items.forEach(E=>i.push(E)),Array.isArray(T.reminders)&&T.reminders.forEach(E=>i.push(E)))}catch{}}}),!i.length)for(let B=0;B<localStorage.length;B+=1){let v=localStorage.key(B);if(!(!v||y.has(v)||!/remind/i.test(v))){y.add(v);try{let T=localStorage.getItem(v);if(!T)continue;let E=JSON.parse(T);Array.isArray(E)?E.forEach(q=>i.push(q)):E&&typeof E=="object"&&(Array.isArray(E.items)&&E.items.forEach(q=>i.push(q)),Array.isArray(E.reminders)&&E.reminders.forEach(q=>i.push(q)))}catch{}}}return i.map(R).filter(Boolean)}function a(){let i=H();return i.length?i:h()}function S(i){i?(u?.setAttribute("aria-busy","true"),u?.setAttribute("disabled","disabled"),d?.setAttribute("aria-busy","true"),d?.setAttribute("disabled","disabled")):(u?.removeAttribute("aria-busy"),d?.removeAttribute("aria-busy"),w())}function w(){!!((s?.value||"").trim()||D())?(u?.removeAttribute("disabled"),d?.removeAttribute("disabled")):(u?.setAttribute("disabled","disabled"),d?.setAttribute("disabled","disabled"))}let G=D();s&&G&&(s.value=G),w(),f(navigator.onLine?"online":"offline"),window.addEventListener("online",C),window.addEventListener("offline",C),s?.addEventListener("input",w),l?.addEventListener("click",()=>{let i=(s?.value||"").trim();if(!i){M(""),f("info","Sync URL cleared. Add one to enable sync."),w();return}try{let y=new URL(i);if(!/^https?:/.test(y.protocol))throw new Error("Invalid protocol")}catch{f("error","Enter a valid sync URL before saving.");return}M(i),f("online","Sync settings saved."),w()}),d?.addEventListener("click",async()=>{let i=(s?.value||D()).trim();if(!i){f("error","Add your sync URL in Settings first.");return}S(!0),f("syncing","Testing connection\u2026");try{(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?f("online","Connection looks good."):f("error","Test failed. Check your Apps Script deployment.")}catch(y){console.error("Test sync failed",y),f("error","Test failed. Check your Apps Script deployment.")}finally{S(!1)}}),u?.addEventListener("click",async()=>{let i=(s?.value||D()).trim();if(!i){f("error","Add your sync URL in Settings first.");return}let y=a();if(!y.length){f("info","Nothing to sync right now.");return}S(!0),f("syncing",`Syncing ${y.length} reminder${y.length===1?"":"s"}\u2026`);let L=20,B=0,v=0,T=E=>({id:E.id,title:E.title,dueIso:E.dueIso||null,priority:E.priority||"Medium",category:E.category||"General",done:!!E.done,source:"memory-cue-mobile"});try{for(let E=0;E<y.length;E+=L){let q=y.slice(E,E+L);(await Promise.allSettled(q.map(O=>fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T(O))})))).forEach(O=>{O.status==="fulfilled"&&O.value?.ok?B+=1:(O.status,v+=1)}),await new Promise(O=>setTimeout(O,300))}v?B?f("error",`Partial sync: ${B} success, ${v} failed.`):f("error","Sync failed. Check your sync URL and retry."):f("online",`Sync complete. ${B} updated.`)}catch(E){console.error("Sync failed",E),f("error","Sync failed. Try again soon.")}finally{S(!1)}})})()});export default Ze();
