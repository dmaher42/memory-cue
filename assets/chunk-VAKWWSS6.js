import{b as Nt,c as or}from"./chunk-KX65DZXT.js";import{a as _n,b as Pn,c as rr}from"./chunk-GUVSRPRW.js";function $n(r={}){try{Object.assign(P,r||{})}catch(a){console.warn("[supabase-auth] setAuthContext failed",a)}}async function jn(r={}){try{if(P&&typeof P.signInWithPopup=="function"&&P.auth&&typeof P.GoogleAuthProvider=="function")return P.signInWithPopup(P.auth,new P.GoogleAuthProvider);if(P&&typeof P.signInWithRedirect=="function"&&P.auth&&typeof P.GoogleAuthProvider=="function")return P.signInWithRedirect(P.auth,new P.GoogleAuthProvider);let a=Nt();if(a&&a.auth){if(typeof a.auth.signInWithOAuth=="function")return a.auth.signInWithOAuth({provider:"google",...r});if(typeof a.auth.signIn=="function")return a.auth.signIn({provider:"google"})}}catch(a){console.error("[supabase-auth] startSignInFlow error",a);try{P?.toast?.("Sign-in failed")}catch(d){console.warn("[supabase-auth] toast handler failed",d)}throw a}return Promise.resolve(null)}async function Hn(){try{if(P&&typeof P.signOut=="function")return P.signOut(P.auth);let r=Nt();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function sr(r){return r?Array.isArray(r)?r:[r]:[]}function nt(r){return Array.from(new Set(r.filter(a=>a instanceof HTMLElement||typeof SVGElement<"u"&&a instanceof SVGElement)))}function se(r,a){let d=sr(a).filter(Boolean);if(!d.length)return[];let g=d.flatMap(I=>Array.from(r.querySelectorAll(I)));return nt(g)}function dr(r,a=document){let d=a instanceof Document||a instanceof HTMLElement?a:document;return{authForms:se(d,r.authForm),emailInputs:se(d,r.emailInput),signInButtons:se(d,r.signInButtons),signOutButtons:se(d,r.signOutButtons),userBadges:se(d,r.userBadge),userBadgeEmails:se(d,r.userBadgeEmail),userBadgeInitials:se(d,r.userBadgeInitial),userNameEls:se(d,r.userName),syncStatusEls:se(d,r.syncStatus),syncStatusTextEls:se(d,r.syncStatusText),statusIndicatorEls:se(d,r.statusIndicator),feedbackEls:se(d,r.feedback)}}function Ze(r,a){nt(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.classList.toggle("hidden",!a),a?d.removeAttribute("hidden"):d.setAttribute("hidden",""))})}function Ae(r,a){nt(Array.isArray(r)?r:[r]).forEach(d=>{d instanceof HTMLElement&&(d.textContent=a||"")})}function cr(r,a){nt(r).forEach(d=>{d instanceof HTMLElement&&(d.dataset.state=a,d.classList.toggle("online",a==="online"),d.classList.toggle("offline",a!=="online"))})}function tt(r,a){nt(r).forEach(d=>{if(!(d instanceof HTMLElement))return;d.textContent=a||"";let g=!!a;d.classList.toggle("hidden",!g),g?d.removeAttribute("hidden"):d.setAttribute("hidden","")})}function Wn(r={}){let a={...Un.syncStatusText,...r.syncStatusText||{}};return{...Un,...r,syncStatusText:a}}function et(r,{user:a,messages:d}={}){let g=Wn(d),I=!!a;Ze(r.signInButtons,!I),Ze(r.authForms,!I),Ze(r.signOutButtons,I),Ze(r.userBadges,I);let k=typeof a?.email=="string"?a.email:"",B=k?k.charAt(0).toUpperCase():"U";I?(Ae(r.userBadgeEmails,k),Ae(r.userBadgeInitials,B),Ae(r.userNameEls,k)):(Ae(r.userBadgeEmails,""),Ae(r.userBadgeInitials,""),Ae(r.userNameEls,""));let J=typeof g.signedIn=="function"?g.signedIn(a):g.signedIn,C=typeof g.signedOut=="function"?g.signedOut(a):g.signedOut,Q=I?J:C,ie=!I;r.syncStatusEls.length&&(Ae(r.syncStatusEls,Q),r.syncStatusEls.forEach(de=>{de instanceof HTMLElement&&(de.classList.toggle("online",I),de.dataset.state=I?"online":"offline")}),Ze(r.syncStatusEls,ie));let S=I?g.syncStatusText?.signedIn:g.syncStatusText?.signedOut;Ae(r.syncStatusTextEls,S||""),cr(r.statusIndicatorEls,I?"online":"offline"),tt(r.feedbackEls,"")}function ur(r,a){a.authForms.forEach(d=>{!(d instanceof HTMLFormElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("submit",async g=>{g.preventDefault();let I=a.emailInputs.find(B=>d.contains(B))||d.querySelector('input[type="email"]'),k=typeof I?.value=="string"?I.value.trim():"";if(!k){tt(a.feedbackEls,"Enter an email address to continue.");return}try{let{error:B}=await r.auth.signInWithOtp({email:k});B?tt(a.feedbackEls,B.message||"Unable to send magic link."):tt(a.feedbackEls,"Magic link sent. Check your email.")}catch(B){tt(a.feedbackEls,B?.message||"Unable to send magic link.")}}))})}function lr(r,a){a.signOutButtons.forEach(d=>{!(d instanceof HTMLElement)||d.dataset.supabaseAuthBound==="true"||(d.dataset.supabaseAuthBound="true",d.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(g){console.error("[supabase] Sign-out failed.",g)}}))})}function Tr(r={}){let{supabase:a,scope:d=document,selectors:g={},messages:I={},disableButtonBinding:k=!1,onSessionChange:B}=r,J={...ar,...g},C=dr(J,d),Q=Wn(I);et(C,{user:null,messages:Q});let ie=a||Nt()||(typeof window<"u"?window.supabase:null);if(!ie)return{supabase:null,elements:C,applyAuthState:G=>et(C,{...G,messages:Q}),destroy(){}};ur(ie,C),k||lr(ie,C);let S=[],{data:de}=ie.auth.onAuthStateChange((G,N)=>{if(et(C,{user:N?.user??null,messages:Q}),typeof B=="function")try{B(N?.user??null,N)}catch(U){console.error("[supabase] onSessionChange handler failed.",U)}});return de?.subscription&&S.push(()=>{try{de.subscription.unsubscribe()}catch{}}),ie.auth.getSession().then(({data:G,error:N})=>{N||et(C,{user:G?.session?.user??null,messages:Q})}).catch(G=>{console.error("[supabase] getSession failed.",G)}),{supabase:ie,elements:C,applyAuthState:G=>et(C,{...G,messages:Q}),destroy(){S.forEach(G=>{try{G()}catch{}})}}}var P,ar,Un,Yn=Pn(()=>{or();P={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};ar={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:"#auth-feedback"},Un={signedOut:"",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Xn=rr((Cr,it)=>{var Ft=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Gn(r){if(!r||typeof r!="object")return null;let a=Object.entries(r).filter(([d,g])=>typeof g=="string"&&g.trim()!=="");return a.length?Object.fromEntries(a):null}function fr(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},a=Gn(r?.__FIREBASE_CONFIG);if(a)return a;let d=Gn(r?.__ENV?.FIREBASE_CONFIG);if(d)return d;let I=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((k,[B,J])=>{let C=r?.__ENV?.[B]??r?.[B];return typeof C=="string"&&C.trim()!==""&&(k[J]=C),k},{});return Object.keys(I).length?I:null}function qn(){let r=fr();return r?{...Ft,...r}:{...Ft}}var Vn={DEFAULT_FIREBASE_CONFIG:Ft,getFirebaseConfig:qn};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=qn,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=Ft}typeof it<"u"&&it.exports&&(it.exports=Vn,it.exports.default=Vn)});function gr(){if(pe)return{...pe};let a=ln()?.memoryCueFirebase;if(a&&typeof a.getFirebaseConfig=="function")return pe=a.getFirebaseConfig(),{...pe};if(typeof _n=="function")try{let d=Xn();if(d){let g=typeof d.getFirebaseConfig=="function"?d.getFirebaseConfig:typeof d.default?.getFirebaseConfig=="function"?d.default.getFirebaseConfig:null;if(g)return pe=g(),{...pe}}}catch{}return a&&a.DEFAULT_FIREBASE_CONFIG?(pe={...a.DEFAULT_FIREBASE_CONFIG},{...pe}):(pe={...mr},{...pe})}function ln(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Zn(){let r=ln(),a=r&&r.TimestampTrigger;return typeof a=="function"?a:null}function he(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Zn()}function yr(){if(typeof window>"u"||!window.location)return on;try{return new URL(on,window.location.href).href}catch{return on}}async function Te(){return Rt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(Rt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(yr()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),Rt))}async function Qn(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let a=await Te();if(!a)return!1;let d=new Set;navigator.serviceWorker.controller&&d.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(I=>{let k=a[I];k&&d.add(k)});let g=!1;return d.forEach(I=>{try{I.postMessage(r),g=!0}catch(k){console.warn("Failed posting message to service worker",k)}}),g}catch(a){return console.warn("Unable to reach service worker",a),!1}}async function Bt(){if(he())return!1;if(sn)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(rt)try{return await rt}catch{}rt=(async()=>{let r=await Te();if(!r)return!1;let a=!1;if("periodicSync"in r)try{let d=await r.periodicSync.getTags();(!Array.isArray(d)||!d.includes(an))&&await r.periodicSync.register(an,{minInterval:15*60*1e3}),a=!0}catch(d){console.warn("Periodic background sync unavailable",d)}if(!a&&"sync"in r)try{await r.sync.register(an),a=!0}catch(d){console.warn("Background sync unavailable",d)}return a})();try{let r=await rt;return r&&(sn=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),sn=!1,!1}finally{rt=null}}async function cn(r=[],{requestCheck:a=!1}={}){if(!he()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let d=await Te();if(!d)return;let g=await Qn({type:Jn.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(a&&await Qn({type:Jn.checkScheduledReminders}),!g&&typeof d.update=="function")try{await d.update()}catch{}}catch(d){console.warn("Failed syncing reminders with service worker",d)}}async function un(r,a){if(he())try{let d=a||await Te();if(!d)return;let g=[];try{g=await d.getNotifications({tag:r,includeTriggered:!0})}catch{g=await d.getNotifications({tag:r})}for(let I of g)try{I.close()}catch{}}catch{}}function ei(){for(let r of Array.from(ye.values()))try{r.close()}catch{}ye.clear()}function hr(){if(Kn||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>ei();["pagehide","beforeunload"].forEach(a=>{try{window.addEventListener(a,r)}catch{}}),Kn=!0}function W(r){if(typeof r=="string"){let a=r.replace(/\s+/g," ").trim();if(a)return a}return Y}async function xr(r={}){let a=e=>e?document.querySelector(e):null,d=e=>e?Array.from(document.querySelectorAll(e)):[],g=a(r.titleSel),I=a(r.dateSel),k=a(r.timeSel),B=a(r.detailsSel),J=a(r.prioritySel),C=a(r.categorySel),Q=a(r.saveBtnSel),ie=a(r.cancelEditBtnSel),S=a(r.listSel),de=d(r.googleSignInBtnSel),G=d(r.googleSignOutBtnSel),N=a(r.statusSel),U=a(r.syncStatusSel),ti={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},ni=6e3,re=null;function ke(e,{clearMessage:t=!0}={}){re&&(e&&re.tokenId!==e||(re.timeoutId&&clearTimeout(re.timeoutId),t&&N&&N.dataset.undoToken===re.tokenId&&(typeof N.replaceChildren=="function"?N.replaceChildren():N.textContent="",delete N.dataset.undoToken,delete N.dataset.statusKind),re=null))}function ii(e){if(!N)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Qi(e.tokenId)),e.button=i,typeof N.replaceChildren=="function"?N.replaceChildren(t,n,i):(N.textContent="",N.append(t,n,i)),N.dataset.statusKind="undo",N.dataset.undoToken=e.tokenId}function Mt(e,t){if(!U)return;let n=["online","offline","error"];n.forEach(s=>U.classList.remove(s)),n.includes(e)&&U.classList.add(e),U.dataset.state=e;let i=typeof t=="string"?t:ti[e]||"";e==="online"||e==="offline"?(U.textContent="",U.dataset.compact="true",i?(U.setAttribute("aria-label",i),U.setAttribute("title",i)):(U.removeAttribute("aria-label"),U.removeAttribute("title"))):(U.textContent=i,U.removeAttribute("data-compact"),i?(U.setAttribute("aria-label",i),U.setAttribute("title",i)):(U.removeAttribute("aria-label"),U.removeAttribute("title")))}let X=a(r.notesSel),ri=a(r.saveNotesBtnSel),oi=a(r.loadNotesBtnSel),fn=a(r.countTotalSel),ot=a(r.googleUserNameSel),Le=a(r.dateFeedbackSel),Z=a(r.voiceBtnSel),ai=a(r.notifBtnSel),Oe=a(r.moreBtnSel),_e=a(r.moreMenuSel),si=a(r.copyMtlBtnSel),Ot=a(r.importFileSel),di=a(r.exportBtnSel),ci=a(r.syncAllBtnSel),Ne=a(r.syncUrlInputSel),ui=a(r.saveSettingsSel),li=a(r.testSyncSel),fi=d(r.openSettingsSel),at=a(r.settingsSectionSel),Fe=a(r.emptyStateSel),pn=a(r.listWrapperSel),_t=a(r.categoryOptionsSel),be=r.variant||"mobile",pi=typeof r.autoWireAuthButtons=="boolean"?r.autoWireAuthButtons:be!=="desktop",mn="mc:lastDefaults";function Pt(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(mn)||"{}")||{}}catch{return{}}}function mi(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(mn,JSON.stringify(e))}catch{}}function gn(e){let t=Pt(),n={category:W(e?.category||t.category||Y),priority:e?.priority||t.priority||"Medium"};mi(n)}let yn='fieldset#priorityChips input[name="priority"]';function Ut(){try{let e=document.querySelector(`${yn}:checked`);if(e&&e.value)return e.value}catch{}return J&&typeof J.value=="string"&&J.value?J.value:"Medium"}function st(e){let t=e||"Medium";J&&typeof J.value<"u"&&(J.value=t);try{let n=Array.from(document.querySelectorAll(yn));if(!n.length)return;let i=!1;if(n.forEach(o=>{let s=o.value===t;o.checked=s,i=i||s}),!i){let o=n.find(s=>s.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function hn(){let e=Pt();e.category&&C&&(C.value=e.category),e.priority&&st(e.priority)}hn();let ee=typeof document<"u"?document.getElementById("quickAddInput"):null,gi=typeof document<"u"?document.getElementById("quickAddSubmit"):null,te=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,$t=null;function yi(e,t){let n=Date.now(),i=Pt(),o=typeof t=="string"&&t?t:null;return{id:At(),title:(e||"").trim(),priority:i.priority||Ut(),category:W(i.category||C?.value||Y),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!V}}async function jt(){if(!ee)return;if(typeof $t=="function")try{$t()}catch{}let e=(ee.value||"").trim();if(!e)return;let t=null;try{let o=Ct(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=yi(e,t);qt(n,{position:"start"}),u.unshift(n),oe(u);let i=qe(u);Ce=!0,$(),q(),i?u.forEach(o=>z(o)):z(n),ze(n),xe(n),Ee(),gn(n),Pe();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}ce({action:"created",label:`Reminder added \xB7 ${n.title}`}),ee.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=jt),gi?.addEventListener("click",()=>{jt()}),ee?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),jt())});function hi(){if(typeof HTMLElement>"u"||!(te instanceof HTMLElement)||!(ee instanceof HTMLInputElement)||te.dataset.voiceBound==="true")return;if(te.dataset.voiceBound="true",typeof window>"u"){te.setAttribute("disabled","true"),te.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){te.setAttribute("disabled","true"),te.setAttribute("aria-disabled","true"),te.getAttribute("title")||(te.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=c=>{n=c,te.setAttribute("aria-pressed",c?"true":"false"),te.dataset.listening=c?"true":"false",te.classList.toggle("is-listening",c)},o=()=>{if(t)return t;t=new e;let c=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=c,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",y=>{let h=y?.results?.[0]?.[0]?.transcript?.trim()||"";if(h){ee.value=h;try{ee.focus({preventScroll:!0})}catch{ee.focus()}try{let w=ee.value.length;typeof ee.setSelectionRange=="function"&&ee.setSelectionRange(w,w)}catch{}}});let l=()=>{i(!1)};return t.addEventListener("end",l),t.addEventListener("error",l),t},s=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};$t=s,te.addEventListener("click",()=>{let c=o();if(c){if(n){s();return}try{c.start(),i(!0)}catch(l){console.warn("Quick add voice error:",l),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",s),i(!1)}hi(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&ee&&(e.preventDefault(),ee.focus())})));try{be==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let bi=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",bn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,wi=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",dt=r.reminderLandingPath||(be==="desktop"?"index.html#reminders":"mobile.html"),we=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function wn(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Pe(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}C&&!C.value&&(C.value=Y),he()&&Te();function ce(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(zn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(zn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function vi(){if(typeof HTMLElement>"u"||!(Z instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&g instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&g instanceof HTMLTextAreaElement;if(!e&&!t||Z.dataset.voiceBound==="true")return;if(Z.dataset.voiceBound="true",typeof window>"u"){Z.setAttribute("disabled","true"),Z.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){Z.setAttribute("disabled","true"),Z.setAttribute("aria-disabled","true"),Z.getAttribute("title")||(Z.title="Voice input is not supported in this browser.");return}let i=null,o=!1,s=h=>{o=h,Z.setAttribute("aria-pressed",h?"true":"false"),Z.dataset.listening=h?"true":"false",Z.classList.toggle("is-listening",h)},c=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",w=>{let T=w.results?.[0]?.[0]?.transcript?.trim()||"";if(T){g.value=T;try{g.focus({preventScroll:!0})}catch{try{g.focus()}catch{}}try{let M=g.value.length;typeof g.setSelectionRange=="function"&&g.setSelectionRange(M,M)}catch{}ce({action:"dictated",label:`Voice input captured \xB7 ${T}`})}});let h=()=>{s(!1)};return i.addEventListener("end",h),i.addEventListener("error",h),i},l=()=>{if(!(!o||!i)){try{i.stop()}catch{}s(!1)}};Z.addEventListener("click",()=>{let h=c();if(h){if(o){l();return}try{h.start(),s(!0)}catch(w){console.warn("Speech recognition error:",w),s(!1)}}});let y=()=>{l()};typeof document<"u"&&(document.addEventListener("cue:close",y),document.addEventListener("reminders:updated",y)),s(!1)}hr(),vi();let ct,ut,lt,ft,Re,pt,mt,gt,yt,ht,bt,Ue,$e,wt,vt,Ht,Wt,St,Yt,vn=r.firebaseDeps,Gt=typeof r.importModule=="function"?r.importModule:e=>import(e),je=ln(),He=!1,ue=!1,Vt=null,me=null,We=null,u=[],Ce=!1,V=null,Ye=null,Ge=null,De={},j={};function oe(e=u){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?Ln(t||{},n||{}):o-i})}function Si(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function Ve(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),oe(n);else{n=e.slice().sort(Ln);let i=n.length;n.forEach((o,s)=>{o.orderIndex=(i-s)*fe})}return e===u&&(u=n),n}function qt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=Si();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-fe||fe}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+fe||fe}}function qe(e=u){if(!Array.isArray(e)||e.length<2)return!1;oe(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],s=Number.isFinite(i?.orderIndex)?i.orderIndex:null,c=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(s==null||c==null||s<=c||s-c<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*fe;return e===u&&oe(u),!0}let D={draggingId:null,dropTargetId:null,dropBefore:!0},Sn=!1,f={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function Ei(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function Xe(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function ve(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function Xt(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),ve(),D.draggingId=null,D.dropTargetId=null,D.dropBefore=!0}function En(e,t,n){if(!e||e===t)return;let i=u.findIndex(M=>M?.id===e);if(i<0)return;let[o]=u.splice(i,1),s;if(!t)s=u.length;else{let M=u.findIndex(H=>H?.id===t);if(M<0){u.splice(i,0,o);return}s=n?M:M+1}u.splice(s,0,o);let c=u[s-1],l=u[s+1],y=Number.isFinite(c?.orderIndex)?c.orderIndex:null,h=Number.isFinite(l?.orderIndex)?l.orderIndex:null,w;y!=null&&h!=null?w=(y+h)/2:y!=null?w=y-fe:h!=null?w=h+fe:w=fe,Number.isFinite(w)||(w=fe*(u.length+1)),o.orderIndex=w,oe(u);let T=qe(u);Ce=!0,$(),q(),T?u.forEach(M=>z(M)):z(o),Pe(),we("memoryCue:remindersUpdated",{items:u}),ce({action:"reordered",label:"Reminders reordered"})}function Ii(e){let t=Xe(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(D.draggingId=i,D.dropTargetId=null,D.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Ai(e){if(!D.draggingId)return;let t=Xe(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),D.dropTargetId=null,D.dropBefore=!1,ve(),S?.classList.add("drag-over-list");return}if(t.dataset.id===D.draggingId){e.preventDefault(),ve();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(D.dropTargetId!==t.dataset.id||D.dropBefore!==o)&&(ve(),t.classList.add(o?"drag-over-before":"drag-over-after"),D.dropTargetId=t.dataset.id,D.dropBefore=o)}function Ti(e){let t=Xe(e.target);if(!t){S?.contains(e.relatedTarget)||ve();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function Li(e){if(!D.draggingId)return;e.preventDefault();let t=Xe(e.target),n=t?.dataset.id||null,i=D.dropBefore;if(t){let o=t.getBoundingClientRect(),s=o.top+o.height/2;i=e.clientY<s}else n=null,i=!1;En(D.draggingId,n,i),Xt()}function Ci(){Xt()}function Di(){!S||Sn||(Sn=!0,S.addEventListener("dragstart",Ii),S.addEventListener("dragover",Ai),S.addEventListener("drop",Li),S.addEventListener("dragend",Ci),S.addEventListener("dragleave",Ti),Et())}function Et(){if(!S||Et._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){Et._bound=!0;return}let t=6,n=160;function i(){f.longPressTimer&&(clearTimeout(f.longPressTimer),f.longPressTimer=null)}function o(){S&&(f.initialTouchAction!=null?S.style.touchAction=f.initialTouchAction:S.style.removeProperty("touch-action"))}function s({keepHighlights:b=!1}={}){if(i(),f.item&&f.pointerId!=null)try{f.item.hasPointerCapture?.(f.pointerId)&&f.item.releasePointerCapture(f.pointerId)}catch{}if(f.placeholder?.parentNode)try{f.placeholder.parentNode.removeChild(f.placeholder)}catch{}f.item&&(f.item.classList.remove("is-dragging"),f.originalStyles?f.item.setAttribute("style",f.originalStyles):f.item.removeAttribute("style")),o(),b||ve(),Object.assign(f,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function c(b){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(m=>m!==b):[]}function l(b){let m=f.item;if(!m||f.ready)return;let L=m.getBoundingClientRect(),_=window.getComputedStyle(m);f.ready=!0,D.draggingId=m.dataset.id||null,f.offsetY=b.clientY-L.top,f.fixedX=L.left;let F=document.createElement("div");F.className="touch-drag-placeholder",F.setAttribute("aria-hidden","true"),F.style.height=`${L.height}px`,F.style.boxSizing="border-box",F.style.marginTop=_.marginTop,F.style.marginBottom=_.marginBottom,F.style.marginLeft=_.marginLeft,F.style.marginRight=_.marginRight,F.style.borderRadius=_.borderRadius,F.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",F.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",F.style.pointerEvents="none",F.style.display="block",F.style.width="100%",m.parentNode?.insertBefore(F,m),f.placeholder=F,f.longPressTimer=null,f.originalStyles=m.getAttribute("style")||"",m.classList.add("is-dragging"),m.style.position="fixed",m.style.left=`${L.left}px`,m.style.top=`${L.top}px`,m.style.width=`${L.width}px`,m.style.zIndex="999",m.style.pointerEvents="none",m.style.touchAction="none",f.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function y(b){let m=f.item;if(!m||!f.ready)return;let L=b-f.offsetY;m.style.top=`${L}px`,m.style.left=`${f.fixedX}px`}function h(b){if(!f.ready||!S)return;let m=f.item,L=c(m);if(ve(),!L.length){D.dropTargetId=null,D.dropBefore=!1;return}let _=null,F=!1;for(let R of L){let x=R.getBoundingClientRect(),A=x.top+x.height/2;if(b<A){_=R,F=!0;break}}if(!_){_=L[L.length-1];let R=_.getBoundingClientRect(),x=R.top+R.height/2;F=b<x,F||(F=!1)}if(!_){D.dropTargetId=null,D.dropBefore=!1;return}let p=_.getBoundingClientRect(),v=p.top+p.height/2,O=b<v;_.classList.add(O?"drag-over-before":"drag-over-after"),D.dropTargetId=_.dataset.id||null,D.dropBefore=O}function w(b){let m=D.draggingId,L=f.moved;if(!f.ready){s();return}s(),!b&&L&&m&&En(m,D.dropTargetId,D.dropBefore),Xt()}function T(b){let m=b.pointerType||"";if(m&&m!=="touch"&&m!=="pen"||f.active)return;let L=Xe(b.target);if(!L)return;let _=Ei(b.target);if(!(_&&_!==L)){f.active=!0,f.pointerId=b.pointerId,f.item=L,f.startX=b.clientX,f.startY=b.clientY,f.lastClientX=b.clientX,f.lastClientY=b.clientY,f.moved=!1,f.ready=!1,f.originalStyles=L.getAttribute("style")||"",f.startTime=b.timeStamp||Date.now(),D.dropTargetId=null,D.dropBefore=!0,D.draggingId=null,i(),f.longPressTimer=setTimeout(()=>{l({clientY:f.lastClientY})},n);try{L.setPointerCapture(b.pointerId)}catch{}}}function M(b){if(!f.active||b.pointerId!==f.pointerId)return;let m=b.pointerType||"";if(!(m&&m!=="touch"&&m!=="pen")){if(f.lastClientX=b.clientX,f.lastClientY=b.clientY,!f.ready){let L=Math.abs(b.clientX-f.startX),_=Math.abs(b.clientY-f.startY);if(L>t||_>t){let F=typeof b.timeStamp=="number"?b.timeStamp:Date.now();Math.abs(F-f.startTime)>=n?(i(),l({clientY:f.lastClientY})):s()}return}b.preventDefault(),f.moved=!0,y(b.clientY),h(b.clientY)}}function H(b){!f.active||b.pointerId!==f.pointerId||w(!1)}function ae(b){!f.active||b.pointerId!==f.pointerId||w(!0)}S.addEventListener("pointerdown",T),window.addEventListener("pointermove",M),window.addEventListener("pointerup",H),window.addEventListener("pointercancel",ae),Et._bound=!0}function In(){V=null,Mt("offline"),de.forEach(e=>e.classList.remove("hidden")),G.forEach(e=>e.classList.add("hidden")),ot&&(ot.textContent=""),Ye?.(),Ye=null,Kt(),$(),q(),Ee()}function zt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(dn);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,s=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:At(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:W(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(s)?s:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function xi(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(dn);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:W(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(dn,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function q(){oe(u),xi(u)}function Kt(){u=Ve(zt())}Kt();async function ki(){if(!V){u=zt();return}let e=Ve(zt());if(!e.length){u=[],q();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await z(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}u=Ve(e.map(n=>({...n,pendingSync:!1}))),q(),$(),Ee()}try{j=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{j={}}if(j&&typeof j=="object"&&Object.values(j).forEach(e=>{e&&typeof e=="object"&&(e.category=W(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Je(e),e.urlPath=e.urlPath||dt,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!he()){let e=Fn();typeof Notification<"u"&&Notification.permission==="granted"?(Bt(),e.length&&cn(e,{requestCheck:!0})):e.length&&cn(e)}let It=e=>{if(!je)return;let t=[je];je.window&&!t.includes(je.window)&&t.push(je.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Ni(){if(!X)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",s=()=>"value"in X?X.value:X.innerHTML,c=w=>{if("value"in X){X.value=w;return}if(typeof w!="string"||w.length===0){X.innerHTML="";return}let T=w.trim();if(/<\/?[a-z][\s\S]*>/i.test(T)){X.innerHTML=w;return}let H=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");X.innerHTML=H},l=w=>{w?X.classList.add("notes-editor--columns"):X.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!w))},y="";try{y=localStorage.getItem(n)||""}catch{E("Unable to access saved notes")}c(y);let h=!1;try{h=localStorage.getItem(i)==="1"}catch{h=!1}l(h),X.addEventListener("input",()=>{y=s();try{localStorage.setItem(n,y)}catch{E("Notes saved for this session only")}}),ri?.addEventListener("click",()=>{y=s();try{localStorage.setItem(n,y),E("Notes saved")}catch{E("Notes saved for this session only")}}),oi?.addEventListener("click",()=>{let w=y;try{w=localStorage.getItem(n)||y}catch{E("Unable to load saved notes")}y=w,c(y)}),e?.addEventListener("click",w=>{let T=w.target;if(!(T instanceof Element))return;let M=T.closest("button[data-action]");if(!M)return;let H=M.getAttribute("data-action");if(H==="columns"){let ae=!X.classList.contains("notes-editor--columns");l(ae);try{localStorage.setItem(i,ae?"1":"0")}catch{E("Column preference saved for this session only")}return}if(!o){E("Formatting controls are not supported in this browser");return}X.focus(),H==="bullets"?document.execCommand("insertUnorderedList"):H==="numbers"&&document.execCommand("insertOrderedList")})}if(Ni(),Q?.addEventListener("click",Bn),vn)({initializeApp:ct,getFirestore:ut,enableMultiTabIndexedDbPersistence:lt,enableIndexedDbPersistence:ft,doc:Re,setDoc:pt,deleteDoc:mt,onSnapshot:gt,collection:yt,query:ht,orderBy:bt,serverTimestamp:Ue,getAuth:$e,onAuthStateChanged:wt,GoogleAuthProvider:vt,signInWithPopup:Ht,signInWithRedirect:Wt,getRedirectResult:St,signOut:Yt}=vn),He=!0;else try{({initializeApp:ct}=await Gt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:ut,enableMultiTabIndexedDbPersistence:lt,enableIndexedDbPersistence:ft,doc:Re,setDoc:pt,deleteDoc:mt,onSnapshot:gt,collection:yt,query:ht,orderBy:bt,serverTimestamp:Ue}=await Gt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:$e,onAuthStateChanged:wt,GoogleAuthProvider:vt,signInWithPopup:Ht,signInWithRedirect:Wt,getRedirectResult:St,signOut:Yt}=await Gt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),He=!0}catch(e){He=!1,console.warn("Firebase modules failed to load:",e),E("Firebase failed to load; notes available offline"),It(!1)}if(He&&typeof ct=="function"&&typeof ut=="function"&&typeof $e=="function")try{let e=gr();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),Vt=ct(e),me=ut(Vt),ue=!0,console.info("[Firebase] Firestore initialised",e.projectId),It(!0)}catch(e){ue=!1,console.warn("Firebase initialization failed:",e),E("Firebase failed to load; notes available offline"),It(!1)}else He?(ue=!1,It(!1)):ue=!1;ue&&typeof lt=="function"&&typeof ft=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await lt(me),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await ft(me),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ue&&typeof $e=="function"&&(We=$e(Vt));function Fi(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Ri=typeof navigator<"u"&&navigator.language?navigator.language:"",An=Fi(Ri),Be=An||"en-US",ge="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(ge=e.timeZone),!An&&e.locale&&(Be=e.locale)}catch{}let Bi=new Intl.DateTimeFormat(Be,{timeZone:ge,hour:"2-digit",minute:"2-digit"}),Mi=new Intl.DateTimeFormat(Be,{timeZone:ge,weekday:"long",day:"numeric",month:"long"}),Oi=new Intl.DateTimeFormat("en-CA",{timeZone:ge,year:"numeric",month:"2-digit",day:"2-digit"}),_i=new Intl.DateTimeFormat(Be,{timeZone:ge,weekday:"long"}),Pi=new Intl.DateTimeFormat(Be,{timeZone:ge,month:"short",day:"numeric"});function Se(e){let t=Oi.formatToParts(e),n=t.find(s=>s.type==="year").value,i=t.find(s=>s.type==="month").value,o=t.find(s=>s.type==="day").value;return`${n}-${i}-${o}`}function Tn(e,t){let[n,i,o]=e.split("-").map(y=>parseInt(y,10)),[s,c]=t.split(":").map(y=>parseInt(y,10)),l=new Date;return l.setFullYear(n,(i||1)-1,o||1),l.setHours(s||0,c||0,0,0),l.toISOString()}let Ui=new Intl.DateTimeFormat("en-CA",{timeZone:ge,year:"numeric",month:"2-digit",day:"2-digit"}),$i=new Intl.DateTimeFormat("en-CA",{timeZone:ge,hour:"2-digit",minute:"2-digit",hour12:!1});function ji(e){try{let t=new Date(e),n=Ui.formatToParts(t),i=n.find(c=>c.type==="year")?.value||"0000",o=n.find(c=>c.type==="month")?.value||"00",s=n.find(c=>c.type==="day")?.value||"00";return`${i}-${o}-${s}`}catch{return""}}function Hi(e){try{let t=new Date(e),n=$i.formatToParts(t),i=n.find(s=>s.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(s=>s.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function At(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Tt(){return Se(new Date)}function Wi(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function wr(e){let t=Wi(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Lt(e){return e==="High"?3:e==="Medium"?2:1}function Ln(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,s=t?.due?new Date(t.due).getTime():1/0;if(o!==s)return o-s;let c=Lt(t?.priority)-Lt(e?.priority);return c||(t?.updatedAt||0)-(e?.updatedAt||0)}function vr(e,t){let n=Lt(t.priority)-Lt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Cn(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Mi.format(t)}catch{return e}}function Jt(e){return Bi.format(e)}function Yi(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Sr(e){return e?Yi(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function E(e){N&&(ke(),N.dataset.statusKind="toast",N.textContent=e,clearTimeout(E._t),E._t=setTimeout(()=>{N&&N.dataset.statusKind==="toast"&&(N.textContent="",delete N.dataset.statusKind)},2500))}function Gi(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Ct(e){e=String(e||"").toLowerCase();let t={date:Tt(),time:""},n=l=>{let y=new Date,h=y.getDay(),w=(l-h+7)%7,T=new Date(y);return T.setDate(y.getDate()+(w===0?7:w)),T},i=l=>{let y=new Date,h=y.getDay(),w=(l-h+7)%7,T=new Date(y);return T.setDate(y.getDate()+w),T},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},s={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let l=new Date;l.setDate(l.getDate()+1),t.date=Se(l)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=o[l[1]],h=n(y);t.date=Se(h)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=o[l[1]],h=i(y);t.date=Se(h)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let l=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),y=o[l[1]],h=n(y);t.date=Se(h)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let l=e.match(/\bin\s+(\d+)\s+days?\b/),y=parseInt(l[1],10),h=new Date;h.setDate(h.getDate()+y),t.date=Se(h)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let l=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),y=parseInt(l[1],10),h=parseInt(l[2],10)-1,w=l[3]?parseInt(l[3],10):new Date().getFullYear(),T=new Date(w,h,y);t.date=Se(T)}else for(let[l,y]of Object.entries(s)){let h=new RegExp(`\\b${l}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(h.test(e)){let w=e.match(h),T=parseInt(w[1],10),M=new Date().getFullYear(),H=new Date(M,y,T);t.date=Se(H);break}}let c=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(c){let l=parseInt(c[1],10),y=c[2]?parseInt(c[2],10):0,h=c[3];h&&(h==="pm"&&l<12&&(l+=12),h==="am"&&l===12&&(l=0)),t.time=`${String(l).padStart(2,"0")}:${String(y).padStart(2,"0")}`}return t}let Qt=ue&&We&&typeof vt=="function";$n({authReady:Qt,auth:We,GoogleAuthProvider:vt,signInWithPopup:Ht,signInWithRedirect:Wt,signOut:Yt,toast:E});let Dn=pi,xn=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};Dn&&de.length&&de.forEach(e=>xn(e,jn)),Qt&&typeof St=="function"&&St(We).catch(()=>{}),Dn&&G.length&&G.forEach(e=>xn(e,Hn)),Qt&&typeof wt=="function"?wt(We,async e=>{e?(V=e.uid,Mt("online"),de.forEach(t=>t.classList.add("hidden")),G.forEach(t=>t.classList.remove("hidden")),ot&&(ot.textContent=e.displayName||e.email||""),Vi(),await ki()):In()}):In();function Vi(){if(!ue||!me||typeof yt!="function"||typeof ht!="function"||typeof bt!="function"||typeof gt!="function")return;if(!V){Kt(),$(),q(),Ee();return}Ye&&Ye();let e=yt(me,"users",V,"reminders"),t=ht(e,bt("updatedAt","desc"));Ye=gt(t,n=>{let i=[];n.forEach(o=>{let s=o.data(),c=Number(s.orderIndex);i.push({id:o.id,title:s.title,priority:s.priority,notes:s.notes||"",done:!!s.done,due:s.due||null,category:W(s.category),createdAt:s.createdAt?.toMillis?.()||0,updatedAt:s.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(c)?c:null})}),u=Ve(i),$(),q(),Ee()},n=>{console.error("Firestore sync error:",n),U&&Mt("error","Sync Error")})}async function z(e){if(!(!ue||!V||!me||typeof Re!="function"||typeof pt!="function"||typeof Ue!="function"))try{await pt(Re(me,"users",V,"reminders",e.id),{ownerUid:V,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||Y,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):Ue(),updatedAt:Ue()},{merge:!0})}catch(t){console.error("Save failed:",t),E("Save queued (offline)")}}async function qi(e){if(!(!ue||!V||!me||typeof Re!="function"||typeof mt!="function"))try{await mt(Re(me,"users",V,"reminders",e))}catch{E("Delete queued (offline)")}}async function ze(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||Y,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Ke(){g&&(g.value=""),I&&(I.value=""),k&&(k.value=""),B&&(B.value=""),st("Medium"),C&&(C.value=Y),hn(),Ge=null,Q&&(Q.textContent="Save Cue"),ie?.classList.add("hidden")}function Xi(e){let t=u.find(n=>n.id===e);t&&(g&&(g.value=t.title||""),I&&k&&(t.due?(I.value=ji(t.due),k.value=Hi(t.due)):(I.value="",k.value="")),st(t?.priority||"Medium"),C&&(C.value=W(t.category)),B&&(B.value=typeof t.notes=="string"?t.notes:""),Ge=e,Q&&(Q.textContent="Update"),ie?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),g?.focus(),we("cue:open",{mode:"edit"}))}function zi(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=W(e.category??(C?C.value:"")),o={id:At(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!V};qt(o,{position:"start"}),u=[o,...u],oe(u);let s=qe(u);return Ce=!0,$(),q(),gn(o),s?u.forEach(c=>z(c)):z(o),ze(o),xe(o),Pe(),we("memoryCue:remindersUpdated",{items:u}),wn(),ce({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Ki(e,t){if(!V)return E("Sign in to add notes"),null;if(!e)return null;let n=u.find(c=>c.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let s=typeof n.notes=="string"?n.notes:"";return n.notes=s?`${s}
${o}`:o,n.updatedAt=Date.now(),z(n),$(),q(),ce({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Ji(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),z(t),ze(t),$(),q(),t.done?(xt(e),ce({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(xe(t),ce({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function Qi(e){if(!re||re.tokenId!==e)return;let{item:t,index:n}=re;if(!t){ke(e);return}ke(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!V,t.updatedAt=Date.now(),u.splice(i,0,t),oe(u);let o=qe(u);Ce=!0,$(),q(),xe(t),o?u.forEach(s=>z(s)):z(t),ze(t),Pe(),we("memoryCue:remindersUpdated",{items:u}),ce({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),E("Reminder restored")}function kn(e){let t=u.findIndex(o=>o.id===e),n=t>=0?u.splice(t,1)[0]:null;$(),q(),qi(e),xt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(ce({action:"deleted",label:i}),n&&N){ke();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;re={tokenId:o,item:n,index:t,timeoutId:null},ii(re),re.timeoutId=setTimeout(()=>{ke(o)},ni)}else n&&ke()}function Zi(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,o=800,s='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',c=null,l=!1,y=0,h=0,w=0,T=()=>{if(l){if(l=!1,c!=null&&e.hasPointerCapture?.(c))try{e.releasePointerCapture(c)}catch{}c=null,e.removeEventListener("pointermove",H),e.removeEventListener("pointerup",ae),e.removeEventListener("pointercancel",b),e.removeEventListener("pointerleave",b),window.removeEventListener("pointerup",ae),window.removeEventListener("pointercancel",b)}},M=m=>{if(m.pointerType==="mouse"&&m.button!==0)return;l&&T();let L=m.target;L instanceof Element&&L.closest(s)||(c=m.pointerId,y=m.clientX,h=m.clientY,w=typeof m.timeStamp=="number"?m.timeStamp:Date.now(),l=!0,e.addEventListener("pointermove",H),e.addEventListener("pointerup",ae),e.addEventListener("pointercancel",b),e.addEventListener("pointerleave",b),window.addEventListener("pointerup",ae),window.addEventListener("pointercancel",b))},H=m=>{if(!l||m.pointerId!==c)return;Math.abs(m.clientY-h)>i&&T()},ae=m=>{if(!l||m.pointerId!==c)return;let L=m.clientX-y,_=Math.abs(m.clientY-h),F=(typeof m.timeStamp=="number"?m.timeStamp:Date.now())-w;if(T(),L<=-n&&_<=i&&F<=o){m.preventDefault(),m.stopPropagation();try{t()}catch(p){console.warn("Swipe delete handler failed",p)}}},b=m=>{l&&(typeof m.pointerId=="number"&&m.pointerId!==c||T())};e.addEventListener("pointerdown",M)}function Je(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=Jt(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=Jt(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function Nn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}E("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function Fn(){return Object.values(j||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||Y,notes:typeof e.notes=="string"?e.notes:"",body:Je(e),urlPath:e.urlPath||dt,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Zt(){try{localStorage.setItem("scheduledReminders",JSON.stringify(j))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=Fn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&Bt(),cn(e,{requestCheck:t})}function Dt(e,{closeNotification:t=!0}={}){if(t){let n=ye.get(e);if(n){try{n.close()}catch{}ye.delete(e)}}De[e]&&(clearTimeout(De[e]),delete De[e]),un(e),j[e]&&(delete j[e],Zt())}function xt(e){Dt(e)}function Rn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=ye.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Je(e),tag:e.id});ye.set(e.id,n);let i=()=>{ye.get(e.id)===n&&ye.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function er(e){if(!he())return!1;let t=Zn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Te();if(!i)return!1;await un(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||Y,body:s,urlPath:dt},s=Je(e),c={body:s,tag:e.id,data:o,renotify:!0};n>Date.now()&&(c.showTrigger=new t(n));try{return await i.showNotification(e.title,c),!0}catch(l){return console.warn("Failed to schedule persistent notification",l),!1}}function xe(e){if(!e||!e.id)return;if(e.category=W(e.category),!e.due||e.done){xt(e.id);return}let t=j[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||Y,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Je(e),urlPath:dt,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,l=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?l:null})()};if(j[e.id]=n,Zt(),De[e.id]&&(clearTimeout(De[e.id]),delete De[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(j[e.id]?.viaTrigger){Dt(e.id,{closeNotification:!1});return}Rn(e),Dt(e.id,{closeNotification:!1});return}let s=he();s&&(n.viaTrigger=!1,er(e).then(c=>{c&&j[e.id]&&(j[e.id]={...j[e.id],viaTrigger:!0},Zt())})),De[e.id]=setTimeout(()=>{s&&un(e.id),Rn(e),Dt(e.id,{closeNotification:!1})},o)}function Ee(){Object.values(j).forEach(e=>xe({...e,category:W(e?.category)}))}function tr(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=_i.format(t),i=Pi.format(t),o=Jt(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function $(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),ve(),oe(u),fn)try{fn.textContent=String(u.length)}catch{}u.forEach(p=>{p&&typeof p=="object"&&(p.category=W(p.category))});let o=new Set(pr.map(p=>W(p)));u.forEach(p=>{p&&typeof p=="object"&&o.add(W(p.category))});let s=Array.from(o).sort((p,v)=>p.localeCompare(v,void 0,{sensitivity:"base"}));if(_t){let p=new Set;Array.from(_t.querySelectorAll("option")).forEach(v=>{p.add(v.value.trim().toLowerCase())}),s.forEach(v=>{let O=v.toLowerCase();if(!p.has(O)){let R=document.createElement("option");R.value=v,_t.appendChild(R),p.add(O)}})}if(Ce)Ce=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let p=u.map(v=>({...v}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:p}}));else if(document.createEvent){let v=document.createEvent("CustomEvent");v&&v.initCustomEvent&&(v.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:p}),document.dispatchEvent(v))}}catch{}}let c=u.slice();oe(c);let l=!0,y=u.length>0,h=c.length>0,w=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let p=Object.values(j||{}).filter(v=>v&&typeof v=="object"&&v.id);return new Set(p.map(v=>v.id))})();if(Fe)if(h)Fe.classList.add("hidden");else{let p=y?"No reminders to show right now.":bi;bn?bn(Fe,{icon:y?"sparkles":"bell",title:y?"Nothing to display":"Create your first cue",description:p,action:y?void 0:`<button type="button" class="${wi}" data-trigger="open-cue">Create reminder</button>`}):Fe.textContent=p,Fe.classList.remove("hidden")}if(pn&&pn.classList.toggle("has-items",h),!S)return;if(!h){Fe?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden"));return}S.classList.remove("hidden"),S.replaceChildren();let T=document.createDocumentFragment(),M=S.tagName==="UL"||S.tagName==="OL",H=!0,ae=(p,v="neutral")=>{let O=document.createElement("span");O.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",O.title=p,O.dataset.tone=v;let R=document.createElement("span");R.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",v==="priority-high"?R.classList.add("bg-error"):v==="priority-medium"?R.classList.add("bg-warning"):v==="priority-low"?R.classList.add("bg-secondary"):v==="category"?R.classList.add("bg-primary"):R.classList.add("bg-base-content","opacity-40");let x=document.createElement("span");return x.className="truncate",x.textContent=p,O.append(R,x),O},b=(p,v,{elementTag:O,isMobile:R})=>{let x={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:v,done:!!p.done},A=document.createElement(O);A.className="task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",R&&A.classList.add("w-full"),A.dataset.id=x.id,A.dataset.category=x.category,A.dataset.title=x.title,A.dataset.priority=x.priority,A.dataset.done=String(x.done),x.dueIso?A.dataset.due=x.dueIso:delete A.dataset.due,A.dataset.reminder=JSON.stringify(x),A.dataset.orderIndex=Number.isFinite(p.orderIndex)?String(p.orderIndex):"",A.dataset.reminderItem="true",A.dataset.compact="true",A.classList.add("reminder-draggable"),A.setAttribute("draggable","true"),A.setAttribute("role","button"),A.tabIndex=0,A.setAttribute("aria-label",`Edit reminder: ${p.title}`),w.has(x.id)?A.dataset.notificationActive="true":delete A.dataset.notificationActive;let en=x.dueIso?new Date(x.dueIso):null;l&&en&&en>=n&&en<=i?(A.classList.add("is-today"),A.dataset.today="true"):(A.classList.remove("is-today"),delete A.dataset.today);let kt=document.createElement("div");kt.className="flex min-w-0 flex-col gap-2";let Me=document.createElement("p");Me.className="text-sm font-semibold leading-snug text-base-content",Me.classList.add("desktop-reminder-title"),R||Me.classList.add("sm:text-[0.95rem]"),x.done&&Me.classList.add("line-through","text-base-content/60"),Me.textContent=p.title,kt.appendChild(Me);let Qe=document.createElement("div");Qe.className="desktop-reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let tn=tr(p),Mn=tn&&tn!=="No due date"?tn:"";Mn&&Qe.appendChild(ae(Mn,"due")),!!(v&&v!==Y)&&Qe.appendChild(ae(v,"category")),Qe.children.length&&kt.appendChild(Qe),A.appendChild(kt);let nn=document.createElement("div");nn.className="flex items-start gap-1";let ne=document.createElement("button");ne.type="button",ne.className="btn btn-ghost btn-circle btn-xs",x.done?(ne.classList.add("text-base-content/60"),ne.innerHTML='<span aria-hidden="true">\u21BA</span>',ne.setAttribute("aria-label",`Mark reminder as active: ${p.title}`)):(ne.classList.add("text-success"),ne.innerHTML='<span aria-hidden="true">\u2713</span>',ne.setAttribute("aria-label",`Mark reminder as done: ${p.title}`)),ne.setAttribute("aria-pressed",x.done?"true":"false"),ne.setAttribute("data-reminder-control","toggle"),ne.setAttribute("data-no-swipe","true"),ne.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),Ji(x.id)});let Ie=document.createElement("button");Ie.type="button",Ie.className="btn btn-ghost btn-circle btn-xs text-error",Ie.innerHTML='<span aria-hidden="true">\u{1F5D1}\uFE0F</span>',Ie.setAttribute("aria-label",`Delete reminder: ${p.title}`),Ie.setAttribute("data-reminder-control","delete"),Ie.setAttribute("data-no-swipe","true"),Ie.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),kn(x.id)}),nn.append(ne,Ie),A.appendChild(nn);let On=()=>Xi(x.id);return A.addEventListener("click",K=>{if(K.defaultPrevented)return;let rn=K.target;rn&&typeof rn.closest=="function"&&rn.closest("[data-reminder-control]")||On()}),A.addEventListener("keydown",K=>{K.defaultPrevented||K.target===A&&(K.key==="Enter"||K.key===" ")&&(K.preventDefault(),On())}),R&&Zi(A,()=>kn(x.id)),A},m=(p,v)=>b(p,v,{elementTag:"div",isMobile:!0});if(be!=="desktop"&&!H){c.forEach(p=>{let v=p.category||Y;T.appendChild(m(p,v))}),S.appendChild(T);return}let L=new Map;c.forEach(p=>{let v=p.category||Y;L.has(v)||L.set(v,[]),L.get(v).push(p)});let _=Array.from(L.entries()).sort((p,v)=>p[0].localeCompare(v[0],void 0,{sensitivity:"base"})),F=!0;_.forEach(([p,v])=>{if(p!==Y){let O=document.createElement(M?"li":"div");O.dataset.categoryHeading=p,M&&(O.setAttribute("role","presentation"),O.style.listStyle="none"),O.className=be==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",F||(O.style.marginTop=be==="desktop"?"1.25rem":"1rem");let R=document.createElement("div");R.setAttribute("role","heading"),R.setAttribute("aria-level","3"),R.className=be==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let x=document.createElement("span");x.textContent=p;let A=document.createElement("span");A.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",A.textContent=`${v.length} ${v.length===1?"item":"items"}`,R.append(x,A),O.appendChild(R),T.appendChild(O)}v.forEach(O=>{if(be==="desktop"){let R=b(O,p,{elementTag:M?"li":"div",isMobile:!1});T.appendChild(R);return}T.appendChild(m(O,p))}),F=!1}),S.appendChild(T)}function le(){Oe?.setAttribute("aria-expanded","false"),_e?.classList.add("hidden")}function nr(){Oe?.setAttribute("aria-expanded","true"),_e?.classList.remove("hidden")}Oe?.addEventListener("click",e=>{e.stopPropagation(),Oe.getAttribute("aria-expanded")==="true"?le():nr()}),document.addEventListener("click",e=>{_e&&!_e.classList.contains("hidden")&&!_e.contains(e.target)&&e.target!==Oe&&le()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&le()}),fi.forEach(e=>{e.addEventListener("click",()=>{let t=at?.classList.contains("hidden");at?.classList.toggle("hidden"),t&&at?.scrollIntoView({behavior:"smooth",block:"start"}),le()})}),document.addEventListener("DOMContentLoaded",()=>{at?.classList.add("hidden")});function Bn(){try{console.log("handleSaveAction invoked",{editingId:Ge,title:g?.value})}catch{}if(Ge){let i=u.find(l=>l.id===Ge);if(!i){Ke();return}let o=g.value.trim();if(!o){E("Add a reminder title");return}let s=null;if(I.value||k.value){let l=I.value||Tt(),y=k.value||"09:00";s=Tn(l,y)}else{let l=Ct(o);l.time&&(s=new Date(`${l.date}T${l.time}:00`).toISOString())}i.title=o;let c=Ut();i.priority=c,st(c),C&&(i.category=W(C.value)),i.due=s,B&&(i.notes=B.value.trim()),i.updatedAt=Date.now(),z(i),ze(i),Ce=!0,$(),xe(i),q(),Pe(),we("memoryCue:remindersUpdated",{items:u}),wn(),ce({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Ke(),E("Reminder updated"),we("cue:close",{reason:"updated"});return}let e=g.value.trim();if(!e){E("Add a reminder title");return}let t=B?B.value.trim():"",n=null;if(I.value||k.value){let i=I.value||Tt(),o=k.value||"09:00";n=Tn(i,o)}else{let i=Ct(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}zi({title:e,priority:Ut(),category:C?C.value:"",due:n,notes:t}),g.value="",k.value="",B&&(B.value=""),we("cue:close",{reason:"created"})}g?.addEventListener("keydown",e=>{e.key==="Enter"&&Bn()});function ir(){if(!g||!Le)return;let e=g.value.trim();if(!e){Le.style.display="none";return}try{let t=Ct(e),n=Tt();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Cn(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Le.textContent=`Parsed: ${i}`,Le.style.display="block"):Le.style.display="none"}else Le.style.display="none"}catch{Le.style.display="none"}}return g?.addEventListener("input",Gi(ir,300)),ie?.addEventListener("click",()=>{Ke(),E("Edit cancelled"),we("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Ke()}),document.addEventListener("cue:prepare",()=>{Ke()}),window.addEventListener("load",()=>g?.focus()),si?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?Cn(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(Be,{hour:"2-digit",minute:"2-digit",timeZone:ge}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){E("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>E("Copied for Master Task List")).catch(()=>E("Copy failed")),le()}),Ot?.addEventListener("change",()=>{let e=Ot.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(s=>{let c={...s,id:At(),category:W(s.category),pendingSync:!V,orderIndex:null};qt(c,{position:"start"}),u=[c,...u],i.push(c)}),oe(u);let o=qe(u);$(),q(),o?u.forEach(s=>z(s)):i.forEach(s=>z(s)),E("Import successful")}catch{E("Invalid JSON")}},t.readAsText(e),Ot.value="",le()}),di?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),le()}),ci?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){E("Add your Apps Script URL in Settings first"),le();return}if(!u.length){E("No tasks to sync"),le();return}E("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<u.length;i+=t){let o=u.slice(i,i+t),s=await Promise.allSettled(o.map(c=>{let l={id:c.id,title:c.title,dueIso:c.due||null,priority:c.priority||"Medium",category:c.category||Y,done:!!c.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}));n+=s.filter(c=>c.status==="rejected").length,await new Promise(c=>setTimeout(c,400))}E(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),le()}),Ne&&(Ne.value=localStorage.getItem("syncUrl")||""),ui?.addEventListener("click",()=>{Ne&&(localStorage.setItem("syncUrl",Ne.value.trim()),E("Settings saved"))}),li?.addEventListener("click",async()=>{if(!Ne)return;let e=Ne.value.trim();if(!e){E("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});E(t.ok?"Test ok":"Test failed")}catch{E("Test failed")}}),ai?.addEventListener("click",async()=>{if(!("Notification"in window)){E("Notifications not supported");return}if(Notification.permission==="granted"){E("Notifications enabled"),he()?Te():(Bt(),Nn()),Ee(),$();return}try{await Notification.requestPermission()==="granted"?(E("Notifications enabled"),he()?Te():(Bt(),Nn()),Ee(),$()):E("Notifications blocked")}catch{E("Notifications blocked")}}),Di(),Ee(),$(),q(),{cancelReminder:xt,scheduleReminder:xe,closeActiveNotifications:ei,getActiveNotifications:()=>ye,addNoteToReminder:Ki,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:W(t?.category)})):[],u=Ve(u),oe(u),$()},render:$,getItems:()=>u.map(e=>({...e}))}}}var zn,ye,Kn,on,an,Jn,Rt,rt,sn,Y,pr,dn,fe,mr,pe,br=Pn(()=>{Yn();zn="memoryCue:activity",ye=new Map,Kn=!1,on="service-worker.js",an="memory-cue-reminder-sync",Jn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),Rt=null,rt=null,sn=!1,Y="General",pr=Object.freeze([Y,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),dn="memoryCue:offlineReminders",fe=1024,mr=Object.freeze({}),pe=null});export{Tr as a,Yn as b,xr as c,br as d};
