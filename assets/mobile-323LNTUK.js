import{a as ke,b as nt,c as xe,d as ot,e as Me,g as rt}from"./chunk-NQOL4S2N.js";import{a as Ne,b as et}from"./chunk-MG4MJA24.js";import{b as Be,c as tt}from"./chunk-CTK42JWW.js";import{b as Ce,c as Ze}from"./chunk-GUVSRPRW.js";var te,Fe,it,K,pe,Oe,Ue,Re,ge,He,Y,de,De,st,W,G,he,ne,_e,oe=Ce(()=>{te="memoryCueNotes",Fe="memoryCueFolders",it=["mobileNotes"],K=()=>typeof localStorage<"u",pe=null,Oe=t=>{pe=typeof t=="function"?t:null},Ue=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Re=t=>{if(typeof t!="string")return"";let e=t.trim();return e.length?(/[<>]/.test(e),t):""},ge=t=>{if(typeof t!="string")return"";let e=t.trim();return e.length?/[<>]/.test(e)?t:Re(t):""},He=t=>{if(typeof t!="string")return!1;let e=Date.parse(t);return!Number.isNaN(e)},Y=(t,e,n={})=>{let s=typeof t=="string"?t.trim():"";return{id:n.id&&typeof n.id=="string"?n.id:Ue(),title:s||"Untitled note",body:ge(e),updatedAt:n.updatedAt&&He(n.updatedAt)?n.updatedAt:new Date().toISOString(),folderId:n.folderId&&typeof n.folderId=="string"?n.folderId:null}},de=t=>{if(Array.isArray(t))return t.map(e=>{if(!e||typeof e!="object")return null;let n=typeof e.title=="string"?e.title.trim():"",s=ge(e.body),c=typeof e.id=="string"&&e.id.trim()?e.id:Ue(),l=He(e.updatedAt)?e.updatedAt:new Date().toISOString();return!n&&!s&&!e.body?null:{id:c,title:n||"Untitled note",body:s,updatedAt:l,folderId:typeof e.folderId=="string"&&e.folderId?e.folderId:null}}).filter(Boolean);if(t&&typeof t=="object"){let e=typeof t.title=="string"?t.title:"",n=typeof t.body=="string"?t.body:"",s=ge(n);return!e&&!s?[]:[Y(e,s,{id:typeof t.id=="string"?t.id:void 0,updatedAt:typeof t.updatedAt=="string"?t.updatedAt:void 0,folderId:typeof t.folderId=="string"?t.folderId:void 0})]}return typeof t=="string"&&t.trim().length?[Y("Notebook (legacy)",Re(t))]:[]},De=t=>{if(!K())return null;try{return localStorage.getItem(t)}catch{return null}},st=t=>{if(K())try{localStorage.removeItem(t)}catch{}},W=()=>{if(!K())return[];let t=De(te);if(typeof t=="string")try{let e=JSON.parse(t),n=de(e);if(n.length)return n}catch{let e=de(t);if(e.length)return G(e),e}for(let e of it){let n=De(e);if(typeof n=="string"&&n.trim().length){let s=de(n);if(s.length)return G(s),st(e),s}}return[]},G=(t,e={})=>{if(!K()||!Array.isArray(t))return!1;let n=t.map(s=>{let l=de([s])[0];return l&&(l.folderId=typeof s.folderId=="string"&&s.folderId?s.folderId:l.folderId||null),l}).filter(Boolean);try{if(localStorage.setItem(te,JSON.stringify(n)),!e.skipRemoteSync&&typeof pe=="function")try{let s=pe(n);s&&typeof s.then=="function"&&s.catch(c=>{console.error("[notes-storage] Remote sync failed.",c)})}catch(s){console.error("[notes-storage] Remote sync handler threw.",s)}return!0}catch{return!1}},he=()=>[{id:"unsorted",name:"Unsorted"}],ne=()=>{if(!K())return he();try{let t=localStorage.getItem(Fe);if(typeof t=="string"){let e=JSON.parse(t);if(Array.isArray(e)&&e.length)return e.map(n=>({id:String(n.id),name:String(n.name)}))}}catch{}return he()},_e=t=>{if(!K()||!Array.isArray(t))return!1;try{let e=t.filter(n=>n&&typeof n.id=="string"&&n.id.trim()).map(n=>({id:n.id,name:typeof n.name=="string"?n.name:String(n.id)}));return e.length||e.push(...he()),localStorage.setItem(Fe,JSON.stringify(e)),!0}catch{return!1}}});var at,dt,lt,le,ct,ut,qe,Pe=Ce(()=>{tt();oe();at="notes",dt="user_id",lt="updated_at",le=t=>{if(typeof t!="string")return 0;let e=Date.parse(t);return Number.isNaN(e)?0:e},ct=(t=[],e=[])=>{let n=new Map;return e.forEach(s=>{s&&typeof s.id=="string"&&n.set(s.id,s)}),t.forEach(s=>{if(!s||typeof s.id!="string")return;let c=n.get(s.id);if(!c){n.set(s.id,s);return}let l=le(s.updatedAt),u=le(c.updatedAt);l>u&&n.set(s.id,s)}),Array.from(n.values()).sort((s,c)=>le(c?.updatedAt)-le(s?.updatedAt))},ut=t=>e=>{if(!e||typeof e!="object")return null;let n={id:typeof e.id=="string"&&e.id?e.id:void 0,updatedAt:typeof e[t]=="string"?e[t]:void 0,folderId:typeof e.folder_id=="string"&&e.folder_id?e.folder_id:void 0};return Y(e.title,e.body,n)},qe=(t={})=>{let{tableName:e=at,userColumn:n=dt,updatedAtColumn:s=lt,supabase:c=null}=t,l=c||null,u=null,p=!1,k=new Set,O=()=>l||(l=Be(),l),x=ut(s),m=async f=>{let C=O();if(!C||!u)return;let D=(Array.isArray(f)?f.filter(h=>h&&typeof h.id=="string"):[]).map(h=>({id:h.id,[n]:u,title:h.title,body:h.body,folder_id:typeof h.folderId=="string"&&h.folderId?h.folderId:null,[s]:typeof h.updatedAt=="string"&&h.updatedAt?h.updatedAt:new Date().toISOString()})),R=new Set(D.map(h=>h.id));if(D.length){let{error:h}=await C.from(e).upsert(D);if(h)throw h}let H=[...k].filter(h=>h&&!R.has(h));if(H.length){let{error:h}=await C.from(e).delete().in("id",H).eq(n,u);if(h)throw h}k=new Set(R)},I=async()=>{let f=O();if(!(!f||!u))try{let{data:C,error:M}=await f.from(e).select(`id,title,body,folder_id,${s}`).eq(n,u);if(M)throw M;let D=Array.isArray(C)?C:[];k=new Set(D.map(b=>typeof b.id=="string"?b.id:null).filter(Boolean));let R=D.map(x).filter(Boolean),H=W();if(!R.length){if(H.length)try{await m(H)}catch(b){console.error("[notes-sync] Failed to upload local notes to Supabase.",b)}return}let h=ct(H,R);p=!0;let d=G(h,{skipRemoteSync:!0});p=!1,d||console.warn("[notes-sync] Unable to cache notes locally after remote sync.");try{await m(h)}catch(b){console.error("[notes-sync] Failed to reconcile notes with Supabase.",b)}}catch(C){console.error("[notes-sync] Failed to fetch notes from Supabase.",C)}finally{p=!1}};return Oe(async f=>{if(!p)try{await m(f)}catch(C){console.error("[notes-sync] Failed to sync notes to Supabase.",C)}}),{setSupabaseClient(f){f&&(l=f)},handleSessionChange:async f=>{if(u=typeof f?.id=="string"?f.id:null,!u){k=new Set;return}await I()},syncFromRemote:I}}});var ft=Ze(()=>{et();ot();nt();oe();oe();Pe();rt();oe();Ne();(function(){let t=()=>{let e=document.getElementById("create-sheet"),n=document.getElementById("closeCreateSheet");if(!(e instanceof HTMLElement)||!(n instanceof HTMLElement)){let d=typeof t._retryCount=="number"?t._retryCount:0;d<10&&(t._retryCount=d+1,setTimeout(t,50));return}if(t._initialised)return;t._initialised=!0;let s=e.querySelector("[data-dialog-content]"),c=e.querySelector(".sheet-backdrop"),l=document.getElementById("createReminderForm"),u=document.getElementById("saveReminder"),p=document.getElementById("priority"),k=document.getElementById("priorityChips"),O=k?Array.from(k.querySelectorAll('input[name="priority"]')):[],x=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),m=Array.from(x).filter(d=>d instanceof HTMLElement),I=m[0]||null,U=()=>{e.classList.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open"),e.classList.remove("open")};U();let f=null,C=(d,b)=>{try{document.dispatchEvent(new CustomEvent(d,{detail:b}))}catch(N){console.warn(`${d} dispatch failed`,N)}},M=()=>{let d=p?.value||"Medium";O.forEach(b=>{let N=b.value===d;b.checked=N,b.setAttribute("aria-checked",N?"true":"false")})},D=d=>{p&&(p.value!==d&&(p.value=d,p.dispatchEvent(new Event("change",{bubbles:!0}))),M())};O.forEach(d=>{d.addEventListener("change",()=>{d.checked&&D(d.value)})}),p?.addEventListener("change",M),M();let R=()=>{let d=e.querySelector('input, textarea, select, button, [contenteditable="true"]');d instanceof HTMLElement&&setTimeout(()=>{try{d.focus()}catch{}},0)},H=d=>{f=d instanceof HTMLElement?d:null,e.classList.remove("hidden"),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),e.setAttribute("open",""),e.classList.add("open"),f&&f.setAttribute("aria-expanded","true"),M(),R(),C("reminder:sheet-opened",{trigger:f})},h=(d="dismissed")=>{let b=!e.classList.contains("hidden");U(),f&&f.setAttribute("aria-expanded","false");let N=f&&document.body.contains(f)&&f||I;if(N&&typeof N.focus=="function")try{N.focus()}catch{}b&&C("reminder:sheet-closed",{reason:d,trigger:f}),f=null};m.forEach(d=>{d.addEventListener("click",b=>{b.preventDefault();let N={mode:"create",trigger:d};C("cue:prepare",N),C("cue:open",N)})}),n.addEventListener("click",d=>{d.preventDefault(),h("close-button")}),c?.addEventListener("click",d=>{d.target===c&&h("backdrop")}),e.addEventListener("keydown",d=>{d.key==="Escape"&&(d.stopPropagation(),h("escape"))}),s?.addEventListener("click",d=>{d.stopPropagation()}),e.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.hasAttribute("data-close")&&h("backdrop")}),document.addEventListener("cue:open",d=>{M(),H(d?.detail?.trigger||null)}),document.addEventListener("cue:close",d=>{h(d?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{M()}),document.addEventListener("cue:cancelled",()=>{h("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=h),document.addEventListener("reminder:save",d=>{if(!(u instanceof HTMLElement))return;let b=d?.detail?.trigger;b&&b!==u||u.matches(":disabled")||u.click()}),l instanceof HTMLFormElement&&u instanceof HTMLElement&&l.addEventListener("submit",d=>{d.preventDefault(),!u.matches(":disabled")&&u.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();var ce=()=>{ce._initialised||(ce._initialised=!0,xe({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:'[data-open="settings"]',dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(t=>{console.error("Failed to initialise reminders:",t)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ce,{once:!0}):ce();var Ve=()=>{let t=document.getElementById("notifHeaderBtn"),e=document.getElementById("notifBtn");t&&e&&t.addEventListener("click",()=>{e.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ve,{once:!0}):Ve();var $e=()=>{if(typeof document>"u")return;let t=document.getElementById("noteTitleMobile"),e=document.getElementById("scratchNotesEditor"),n=document.getElementById("noteSaveMobile"),s=document.getElementById("noteNewMobile"),c=document.getElementById("notesListMobile"),l=document.getElementById("notesCountMobile"),u=document.getElementById("notesSearchMobile"),p=document.getElementById("savedNotesSheet"),k=document.getElementById("openSavedNotesSheet"),O=document.querySelector('[data-action="close-saved-notes"]'),x="shadow-[0_0_0_3px_var(--accent-color)]",I=(()=>{if(!e)return null;let r=typeof window<"u"&&typeof window.NotesEditor=="function"?window.NotesEditor:null;return r?new r("#scratchNotesEditor",{toolbar:!0,placeholder:"Start typing your note\u2026"}):(e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.dataset.placeholder="Start typing your note\u2026",{element:e,setContent(o=""){e.innerHTML=o||""},getHTML(){return e.innerHTML||""},getText(){return e.textContent||""},focus(){try{e.focus()}catch{}}})})();if(!t||!I||!e||!n)return;let U=document.getElementById("scratchNotesToolbar");U&&e&&U.addEventListener("click",r=>{let o=r.target.closest("button[data-format]");if(!o)return;let a=o.getAttribute("data-format");try{e.focus()}catch{}switch(a){case"bold":document.execCommand("bold",!1,null);break;case"italic":document.execCommand("italic",!1,null);break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"ul":document.execCommand("insertUnorderedList",!1,null);break;case"ol":document.execCommand("insertOrderedList",!1,null);break;default:break}});let f=(r="")=>{if(I&&typeof I.setContent=="function"){I.setContent(r||"");return}e.innerHTML=r||""},C=()=>I&&typeof I.getHTML=="function"?I.getHTML()||"":e.innerHTML||"",M=()=>I&&typeof I.getText=="function"?I.getText()||"":e.textContent||"",D=r=>{let o=r;for(;o&&o!==e;){if(o.nodeType===Node.ELEMENT_NODE&&["div","p","li"].includes(o.tagName?.toLowerCase()))return o;o=o.parentNode}return e},R=r=>{if(typeof r!="string")return null;let o=r.replace(/\u00a0/g," ").trim();return o==="*"?"ul":o==="1"?"ol":null},H=r=>{if(![" ","Enter"].includes(r.key))return;let o=window.getSelection();if(!o||o.rangeCount===0)return;let a=o.getRangeAt(0);if(!e.contains(a.startContainer))return;let g=D(a.startContainer),E=a.cloneRange();E.selectNodeContents(g),E.setEnd(a.startContainer,a.startOffset);let S=R(E.toString());if(!S)return;r.preventDefault();let _=(g.textContent||"").replace(/^\s*[\*1]\s?/,"");g.textContent=_;let q=g.firstChild||g,$=document.createRange();$.setStart(q,(q.nodeType===Node.TEXT_NODE,0)),$.collapse(!0),o.removeAllRanges(),o.addRange($);try{e.focus()}catch{}document.execCommand(S==="ul"?"insertUnorderedList":"insertOrderedList",!1,null)},h=(r,o=200)=>{let a;return(...g)=>{a&&clearTimeout(a),a=setTimeout(()=>{r(...g)},o)}},d=null,b=[],N="all",j="",i=!1,y=null,L=()=>p?.dataset.open==="true",B=()=>{p&&(y&&(clearTimeout(y),y=null),p.classList.remove("hidden"),p.dataset.open="true",p.setAttribute("aria-hidden","false"))},v=()=>{p&&(p.dataset.open="false",p.setAttribute("aria-hidden","true"),y&&clearTimeout(y),y=setTimeout(()=>{p?.classList.add("hidden")},200))};(()=>{p&&(k?.addEventListener("click",r=>{r.preventDefault(),B();let o=document.getElementById("notesListMobile");o&&(o.scrollTop=0)}),O?.addEventListener("click",r=>{r.preventDefault(),v()}),p.addEventListener("click",r=>{r.target===p&&v()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&L()&&v()}))})();let A=()=>typeof j=="string"?j.trim().toLowerCase():"",P=(r=b)=>{if(!Array.isArray(r))return[];let o=A();return o?r.filter(a=>{let g=typeof a?.title=="string"?a.title.toLowerCase():"",E=typeof a?.body=="string"?a.body.toLowerCase():"";return g.includes(o)||E.includes(o)}):[...r]},be=(r=b)=>{if(!Array.isArray(r))return[];let o;return N===null||N==="all"?o=[...r]:N==="unsorted"?o=r.filter(a=>!a.folderId||a.folderId==="unsorted"):o=r.filter(a=>a.folderId===N),P(o)},F=r=>{if(!r){d=null,t.value="",f(""),delete t.dataset.noteOriginalTitle,delete e.dataset.noteOriginalBody;return}d=r.id;let o=r.title||"",a=r.body||"";t.value=o,f(a),t.dataset.noteOriginalTitle=o,e.dataset.noteOriginalBody=a},ze=()=>({title:typeof t.value=="string"?t.value.trim():"",body:C()}),Q=()=>{if(!c)return;c.querySelectorAll('button[data-role="open-note"][data-note-id]').forEach(o=>{if(!(o instanceof HTMLElement))return;let a=o.getAttribute("data-note-id")===d;a?o.setAttribute("data-state","active"):o.removeAttribute("data-state"),o.classList.toggle("active",a),o.classList.toggle("outline",a),o.classList.toggle("outline-2",a),o.classList.toggle("outline-accent",a),o.classList.toggle(x,a),o.setAttribute("aria-current",a?"true":"false")})},Ye=r=>{if(!r)return"";let o=new Date(r);if(Number.isNaN(o.getTime()))return"";let a=new Date,g=o.getFullYear()===a.getFullYear()&&o.getMonth()===a.getMonth()&&o.getDate()===a.getDate(),E=o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return g?`Today \xB7 ${E}`:`${o.toLocaleDateString([],{month:"short",day:"numeric"})} \xB7 ${E}`},ue=()=>{let r=typeof t.value=="string"?t.value:"",o=C(),a=t.dataset.noteOriginalTitle??"",g=e.dataset.noteOriginalBody??"";return r!==a||o!==g},Ge=()=>{let r=W();return Array.isArray(r)?[...r].sort((o,a)=>{let g=Date.parse(o?.updatedAt||""),E=Date.parse(a?.updatedAt||"");return(Number.isNaN(E)?0:E)-(Number.isNaN(g)?0:g)}):[]},fe=()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem(te)}catch{return null}},X=fe(),re=()=>(X=fe(),X),Z=({preserveDraft:r=!0}={})=>{let o=Ge();b=Array.isArray(o)?[...o]:[];let a=r&&ue(),g=b.length>0,E=be();if(Ae(E),!g)return a||F(null),Q(),re(),i=!1,E;if(d){let S=b.find(w=>w.id===d)||null;S?a||F(S):(d=null,!a&&!i&&b[0]&&F(b[0]))}else!a&&!i&&b[0]&&F(b[0]);return i=!1,Q(),re(),E},je=r=>{if(!r)return;let o=W();if(!Array.isArray(o))return;let a=o.filter(g=>g.id!==r);a.length!==o.length&&(G(a),re(),d===r&&(F(null),i=!0),Z({preserveDraft:!1}))},Ae=(r=[])=>{if(!c)return r;if(c.innerHTML="",l){let o=b.length,a=r.length;l.textContent=o?`${a} of ${o} saved`:"No saved notes yet"}if(!r.length){let o=document.createElement("li");return o.className="text-xs italic text-base-content/60 px-3 py-4 text-center rounded-2xl border border-dashed border-base-200/80 bg-base-100/50",o.textContent=b.length&&A()?"No notes match this filter.":"No saved notes yet.",c.appendChild(o),r}return r.forEach(o=>{let a=document.createElement("li");a.className="note-item-mobile w-full";let g=document.createElement("button");g.type="button",g.dataset.noteId=o.id,g.dataset.role="open-note",g.className="saved-note-item note-list-item w-full text-left active:scale-[0.99] focus:outline-none";let E=document.createElement("div");E.className="flex items-center justify-between gap-2";let S=document.createElement("span");S.className="saved-note-title note-list-title truncate";let w=o.title||"Untitled";S.textContent=w,S.setAttribute("title",w);let _=document.createElement("span");_.className="saved-note-meta note-list-meta";let q=o.updatedAt||o.modifiedAt||o.createdAt||"";_.textContent=q?Ye(q):"",E.appendChild(S),E.appendChild(_);let $=document.createElement("p");$.className="saved-note-preview note-list-preview line-clamp-2";let Qe=o.body||"",Xe=String(Qe).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();$.textContent=Xe||"No content yet.",g.appendChild(E),g.appendChild($);let z=document.createElement("button");z.type="button",z.dataset.noteId=o.id,z.dataset.role="delete-note",z.className="delete-note-btn btn btn-ghost btn-xs text-error shrink-0 focus-visible:outline-none focus-visible:ring-0",z.setAttribute("aria-label","Delete note"),z.textContent="\u2715";let ae=document.createElement("div");ae.className="flex items-start justify-between gap-3",ae.appendChild(g),ae.appendChild(z),a.appendChild(ae),c.appendChild(a)}),Q(),r},ee=document.getElementById("notebook-folder-bar"),ve=()=>{if(!ee)return;ee.innerHTML="";let r=[];try{r=Array.isArray(ne())?ne():[]}catch{r=[]}r.some(S=>S&&S.id==="unsorted")||r.unshift({id:"unsorted",name:"Unsorted"});let a=r.filter(S=>S&&S.id!=="unsorted").sort((S,w)=>String(S.name).localeCompare(String(w.name))),g=[];g.push({id:"all",name:"All"}),g.push({id:"unsorted",name:"Unsorted"}),g.push(...a),g.forEach(S=>{let w=document.createElement("button");w.type="button",w.className="folder-chip",w.dataset.folderId=S.id,w.textContent=S.name,String(N)===String(S.id)&&w.classList.add("active"),w.addEventListener("click",()=>{N=S.id==="all"?"all":S.id,ee.querySelectorAll(".folder-chip").forEach(q=>q.classList.remove("active")),w.classList.add("active"),ye()}),ee.appendChild(w)});let E=document.createElement("button");E.type="button",E.className="folder-chip outlined",E.textContent="+ New folder",E.addEventListener("click",S=>{S.preventDefault(),Ke()}),ee.appendChild(E)},mt=()=>{try{ve()}catch(r){console.warn("[notebook] Unable to build folder bar",r)}},Le=document.getElementById("newFolderModal"),V=document.getElementById("newFolderName"),J=document.getElementById("newFolderError"),Te=document.getElementById("newFolderCreate"),Je=document.getElementById("newFolderCancel"),ie=null,we=()=>{J&&(J.classList.add("sr-only"),J.textContent="")},me=r=>{J&&(J.textContent=r,J.classList.remove("sr-only"))},Ke=()=>{Le&&(ie||(ie=new Me({modalElement:Le,closeButton:Je,titleInput:V,modalTitle:document.getElementById("newFolderTitle"),autoFocus:!0})),we(),V&&(V.value=""),ie.show())},Ie=()=>{if(!V)return;let o=String(V.value||"").trim();if(we(),!o.length){me("Folder name can't be empty.");return}let a=[];try{a=Array.isArray(ne())?ne():[]}catch{a=[]}if(a.some(q=>String(q.name).toLowerCase()===o.toLowerCase())){me("You already have a folder with this name.");return}let E=`folder-${Date.now().toString(36)}`,S={id:E,name:o},w=[...a.filter(Boolean),S];if(!_e(w)){me("Unable to create folder. Please try again.");return}try{ie.requestClose("created")}catch{}N=E;try{ve()}catch(q){console.warn("[notebook] rebuild folder chips failed",q)}ye()};Te&&Te.addEventListener("click",r=>{r.preventDefault(),Ie()}),V&&V.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),Ie())}),c&&c.addEventListener("click",r=>{let o=r.target;if(!(o instanceof HTMLElement))return;let a=o.closest('button[data-role="delete-note"]');if(a&&c.contains(a)){r.preventDefault();let E=a.getAttribute("data-note-id");if(!E)return;let S=typeof window<"u"&&typeof window.confirm=="function"?window.confirm:null;(S?S("Delete this note? This cannot be undone."):!0)&&je(E);return}let g=o.closest('button[data-role="open-note"]');if(g&&c.contains(g)){r.preventDefault();let E=g.getAttribute("data-note-id");if(!E)return;let S=b.find(w=>w.id===E);S&&(F(S),Q(),L()&&v())}});let ye=()=>{Ae(P())};if(u){let r=h(()=>{j=typeof u.value=="string"?u.value:"",ye()},180);u.addEventListener("input",r),u.addEventListener("search",r)}let We=()=>{Z({preserveDraft:!1})};n.addEventListener("click",()=>{let r=W(),o=Array.isArray(r)?[...r]:[],{title:a,body:g}=ze(),E=a||"Untitled note",S=new Date().toISOString();if(d){let w=o.findIndex(_=>_.id===d);if(w>=0)o[w]={...o[w],title:E,body:g,updatedAt:S};else{let _=Y(E,g,{updatedAt:S});d=_.id,o.unshift(_)}}else{let w=Y(E,g);d=w.id,o.unshift(w)}G(o),re(),Z({preserveDraft:!1})}),s&&s.addEventListener("click",()=>{F(null),Q(),typeof t.focus=="function"&&t.focus()});let se=h(()=>{try{if(!ue())return;n instanceof HTMLElement&&!n.matches(":disabled")&&n.click()}catch{}},1500);try{t.addEventListener("input",se)}catch{}try{e.addEventListener("input",se),e.addEventListener("keydown",H),e.addEventListener("blur",()=>{se()}),t.addEventListener("blur",()=>se())}catch{}typeof window<"u"&&window.addEventListener("beforeunload",r=>{try{ue()&&n instanceof HTMLElement&&!n.matches(":disabled")&&n.click()}catch{}}),We(),typeof window<"u"&&(window.addEventListener("storage",r=>{r.key===te&&(X=r.newValue??null,Z({preserveDraft:!0}))}),window.__memoryCueNotesWatcher||(window.__memoryCueNotesWatcher=window.setInterval(()=>{let r=fe();r!==X&&(X=r,Z({preserveDraft:!0}))},2e3)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$e,{once:!0}):$e();var Se=qe(),Ee=ke({selectors:{signInButtons:["#googleSignInBtn"],signOutButtons:["#googleSignOutBtn"],userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:["#sync-status"],syncStatusText:["#mcStatusText"],statusIndicator:["#mcStatus"],feedback:["#auth-feedback-header","#auth-feedback-rail"]},disableButtonBinding:!0,onSessionChange:t=>{Se?.handleSessionChange(t)}});if(Ee?.supabase){Se?.setSupabaseClient(Ee.supabase);try{Ee.supabase.auth.getSession().then(({data:t})=>{Se?.handleSessionChange(t?.session?.user??null)}).catch(()=>{})}catch{}}(()=>{let t=document.getElementById("overflowMenuBtn"),e=document.getElementById("overflowMenu");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let n='button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])',s=t,c=m=>{if(!(m instanceof HTMLElement)||m.getAttribute("aria-hidden")==="true"||m.hasAttribute("disabled")||m.tabIndex<0)return!1;let I=m.getBoundingClientRect();return I.width>0||I.height>0},l=()=>Array.from(e.querySelectorAll(n)).filter(c),u=()=>{let m=e.classList.contains("hidden");e.setAttribute("aria-hidden",m?"true":"false")};u();let p=m=>{!e.contains(m.target)&&m.target!==t&&x({restoreFocus:!1})},k=()=>{let[m]=l();if(m instanceof HTMLElement)try{m.focus()}catch{}},O=()=>{e.classList.contains("hidden")&&(s=document.activeElement instanceof HTMLElement?document.activeElement:t,e.classList.remove("hidden"),t.setAttribute("aria-expanded","true"),u(),document.addEventListener("focusin",p),!e.contains(document.activeElement)&&k())},x=({restoreFocus:m=!0}={})=>{if(!e.classList.contains("hidden")&&(e.classList.add("hidden"),t.setAttribute("aria-expanded","false"),u(),document.removeEventListener("focusin",p),m&&s instanceof HTMLElement))try{s.focus()}catch{}};t.addEventListener("click",m=>{m.stopPropagation(),e.classList.contains("hidden")?O():x()}),document.addEventListener("click",m=>{m.target===t||e.contains(m.target)||x({restoreFocus:!1})}),document.addEventListener("keydown",m=>{if(m.key==="Escape"){x();return}m.key==="ArrowDown"&&!e.classList.contains("hidden")&&(m.preventDefault(),k())}),e.addEventListener("click",m=>{m.stopPropagation(),m.target instanceof HTMLElement&&m.target.closest("button")&&x({restoreFocus:!1})}),e.addEventListener("keydown",m=>{if(m.key!=="Tab")return;let I=l();if(!I.length)return;let U=I.indexOf(document.activeElement),f=I.length-1,C=U;m.shiftKey?C=U<=0?f:U-1:C=U===f?0:U+1,m.preventDefault();let M=I[C]||I[0];if(M instanceof HTMLElement)try{M.focus()}catch{}})})();(()=>{let t=document.getElementById("voiceAddBtn");if(!(t instanceof HTMLElement))return;let e=()=>{let c=document.getElementById("voiceBtn");return c instanceof HTMLElement?c:null},n=()=>{let c=e();if(!c)return;let l=()=>{c.hasAttribute("disabled")||c.getAttribute("aria-disabled")==="true"?(t.setAttribute("disabled","true"),t.setAttribute("aria-disabled","true")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"));let p=c.getAttribute("title");p&&t.setAttribute("title",p)};l(),typeof MutationObserver=="function"&&new MutationObserver(l).observe(c,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n();let s=()=>{let c=e();if(c&&!(c.hasAttribute("disabled")||c.getAttribute("aria-disabled")==="true")){try{c.focus({preventScroll:!0})}catch{try{c.focus()}catch{}}try{c.click()}catch(l){console.warn("Voice add trigger failed",l)}}};t.addEventListener("click",c=>{c.preventDefault();let l=!1,u=null,p=()=>{l||(l=!0,document.removeEventListener("reminder:sheet-opened",k),s())},k=x=>{if(x?.detail?.trigger!==t)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&u&&(window.clearTimeout(u),u=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,150)};document.addEventListener("reminder:sheet-opened",k);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:t}}))}catch(x){document.removeEventListener("reminder:sheet-opened",k),typeof window<"u"&&typeof window.clearTimeout=="function"&&u&&(window.clearTimeout(u),u=null),console.warn("Voice add open failed",x);return}let O=document.getElementById("create-sheet");O instanceof HTMLElement&&O.classList.contains("open")&&(u=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,120))})})();(()=>{let t=document.getElementById("toggleReminderFilters"),e=document.getElementById("reminderFilters");if(!(t instanceof HTMLElement)||!(e instanceof HTMLElement))return;let n=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],s=()=>{let l=e.hasAttribute("open");t.setAttribute("aria-expanded",String(l)),t.classList.toggle("btn-active",l)},c=()=>{for(let l of n){let u=e.querySelector(l);if(u instanceof HTMLElement&&!u.hasAttribute("disabled")){try{u.focus({preventScroll:!0})}catch{u.focus()}return}}};t.addEventListener("click",()=>{let l=e.hasAttribute("open");e.open=!l,l||c(),s()}),e.addEventListener("toggle",s),s()})();(()=>{let t=document.getElementById("create-sheet");if(!(t instanceof HTMLElement))return;function e(){!t.classList.contains("open")&&t.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",e),document.addEventListener("reminders:updated",e)})();document.addEventListener("memoryCue:remindersUpdated",t=>{let e=document.getElementById("totalCount");if(!e)return;let n=Array.isArray(t?.detail?.items)?t.detail.items.length:0;e.textContent=String(n)});document.addEventListener("click",t=>{try{let e=t.target;if(!e)return;if(e instanceof HTMLElement&&e.id==="saveReminder"||e instanceof Element&&e.closest&&e.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:e});try{let n=document.createElement("div");n.textContent="Save clicked",n.style.position="fixed",n.style.right="16px",n.style.bottom="16px",n.style.background="rgba(34,197,94,0.95)",n.style.color="#fff",n.style.padding="8px 12px",n.style.borderRadius="8px",n.style.zIndex="99999",document.body.appendChild(n),setTimeout(()=>n.remove(),900)}catch{}}}catch{}});(function(){let t=document.getElementById("reminderList");if(!t)return;let e=Array.from(t.children);if(e.length<=30)return;let n=20;t.innerHTML="";let s=0;function c(){let p=e.slice(s,s+n);p.forEach(k=>t.appendChild(k)),s+=p.length}c();let l=document.createElement("div");l.id="listSentinel",t.appendChild(l);let u=new IntersectionObserver(p=>{p.some(k=>k.isIntersecting)&&s<e.length&&(c(),s>=e.length&&u.disconnect())});u.observe(l)})();(function(){let t=Array.from(new Set([...Array.from(document.querySelectorAll('[data-open="settings"]')),...Array.from(document.querySelectorAll("#openSettings"))])).filter(l=>l instanceof HTMLElement),e=document.getElementById("settingsModal"),n=document.getElementById("closeSettings");if(!t.length||!e||!n)return;function s(){e.classList.remove("hidden")}function c(){e.classList.add("hidden")}t.forEach(l=>{l.addEventListener("click",s)}),n.addEventListener("click",c),e.addEventListener("click",l=>{l.target instanceof HTMLElement&&l.target.matches("[data-close]")&&c()}),e.addEventListener("keydown",l=>{l.key==="Escape"&&c()})})();(function(){let t=document.getElementById("syncStatus"),e=document.getElementById("mcStatus"),n=document.getElementById("mcStatusText"),s=document.getElementById("syncUrl"),c=document.getElementById("saveSyncSettings"),l=document.getElementById("testSync"),u=document.getElementById("syncAll"),p="syncUrl";if(!n)return;let k=["online","offline","error"],O=["online","offline"],x={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},m={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},I=null;function U(i){if(!e)return;O.forEach(L=>e.classList.remove(L));let y=i!=="offline"&&i!=="error";e.classList.add(y?"online":"offline"),e.setAttribute("aria-label",y?"Online":"Offline")}function f(i,y){I=i,k.forEach(T=>n.classList.remove(T)),t&&k.forEach(T=>t.classList.remove(T)),i==="online"?(n.classList.add("online"),t&&t.classList.add("online")):i==="error"?(n.classList.add("error"),t&&t.classList.add("error")):(n.classList.add("offline"),t&&t.classList.add("offline"));let L=typeof y=="string"&&y.trim()?y.trim():x[i]||"",B=typeof y=="string"&&y.trim()?y.trim():m[i]||L,v=L||B||"";n.textContent=v,v?(n.setAttribute("title",v),n.setAttribute("aria-label",v)):(n.removeAttribute("title"),n.removeAttribute("aria-label")),U(i),n.dataset.state=i}function C(){I!=="syncing"&&f(navigator.onLine?"online":"offline")}function M(i){typeof localStorage>"u"||(i?localStorage.setItem(p,i):localStorage.removeItem(p))}function D(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(p)||""}catch{return""}}function R(i){if(!i||typeof i!="object")return null;let y=i.id||i.uid||i.key||i.slug||i.uuid,L=typeof i.title=="string"&&i.title.trim()?i.title.trim():typeof i.name=="string"?i.name.trim():"";if(!L)return null;let B=typeof i.dueIso=="string"&&i.dueIso?i.dueIso:typeof i.due=="string"?i.due:null,v=typeof i.priority=="string"&&i.priority.trim()?i.priority.trim():i.level||i.importance||"Medium",T=typeof i.category=="string"&&i.category.trim()?i.category.trim():i.group||i.bucket||"General",A=typeof i.done=="boolean"?i.done:!!(i.completed||i.isDone||i.status==="done");return{id:y||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:L,dueIso:B&&B.trim()?B.trim():null,priority:v,category:T,done:A}}function H(){let i=Array.from(document.querySelectorAll("[data-reminder]"));return i.length?i.map(y=>{let L=y.dataset||{},B=null;if(L.reminder)try{B=JSON.parse(L.reminder)}catch{B=null}let v=B||{id:L.id||L.reminderId||y.getAttribute("data-id")||null,title:L.title||L.reminderTitle||"",dueIso:L.due||L.reminderDue||y.getAttribute("data-due")||null,priority:L.priority||L.reminderPriority||y.getAttribute("data-priority")||"",category:L.category||L.reminderCategory||y.getAttribute("data-category")||"",done:L.done==="true"||L.reminderDone==="true"||y.getAttribute("data-done")==="true"};if(!v.title){let T=y.querySelector("[data-reminder-title], [data-title], h3, h4, strong");T&&(v.title=T.textContent.trim())}if(!v.dueIso){let T=y.querySelector("[data-due], time");if(T){let A=T.getAttribute("datetime")||T.getAttribute("data-due");v.dueIso=A||T.textContent.trim()}}return R(v)}).filter(Boolean):[]}function h(){if(typeof localStorage>"u")return[];let i=[],y=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(B=>{if(!y.has(B)){y.add(B);try{let v=localStorage.getItem(B);if(!v)return;let T=JSON.parse(v);Array.isArray(T)?T.forEach(A=>i.push(A)):T&&typeof T=="object"&&(Array.isArray(T.items)&&T.items.forEach(A=>i.push(A)),Array.isArray(T.reminders)&&T.reminders.forEach(A=>i.push(A)))}catch{}}}),!i.length)for(let B=0;B<localStorage.length;B+=1){let v=localStorage.key(B);if(!(!v||y.has(v)||!/remind/i.test(v))){y.add(v);try{let T=localStorage.getItem(v);if(!T)continue;let A=JSON.parse(T);Array.isArray(A)?A.forEach(P=>i.push(P)):A&&typeof A=="object"&&(Array.isArray(A.items)&&A.items.forEach(P=>i.push(P)),Array.isArray(A.reminders)&&A.reminders.forEach(P=>i.push(P)))}catch{}}}return i.map(R).filter(Boolean)}function d(){let i=H();return i.length?i:h()}function b(i){i?(u?.setAttribute("aria-busy","true"),u?.setAttribute("disabled","disabled"),l?.setAttribute("aria-busy","true"),l?.setAttribute("disabled","disabled")):(u?.removeAttribute("aria-busy"),l?.removeAttribute("aria-busy"),N())}function N(){!!((s?.value||"").trim()||D())?(u?.removeAttribute("disabled"),l?.removeAttribute("disabled")):(u?.setAttribute("disabled","disabled"),l?.setAttribute("disabled","disabled"))}let j=D();s&&j&&(s.value=j),N(),f(navigator.onLine?"online":"offline"),window.addEventListener("online",C),window.addEventListener("offline",C),s?.addEventListener("input",N),c?.addEventListener("click",()=>{let i=(s?.value||"").trim();if(!i){M(""),f("info","Sync URL cleared. Add one to enable sync."),N();return}try{let y=new URL(i);if(!/^https?:/.test(y.protocol))throw new Error("Invalid protocol")}catch{f("error","Enter a valid sync URL before saving.");return}M(i),f("online","Sync settings saved."),N()}),l?.addEventListener("click",async()=>{let i=(s?.value||D()).trim();if(!i){f("error","Add your sync URL in Settings first.");return}b(!0),f("syncing","Testing connection\u2026");try{(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?f("online","Connection looks good."):f("error","Test failed. Check your Apps Script deployment.")}catch(y){console.error("Test sync failed",y),f("error","Test failed. Check your Apps Script deployment.")}finally{b(!1)}}),u?.addEventListener("click",async()=>{let i=(s?.value||D()).trim();if(!i){f("error","Add your sync URL in Settings first.");return}let y=d();if(!y.length){f("info","Nothing to sync right now.");return}b(!0),f("syncing",`Syncing ${y.length} reminder${y.length===1?"":"s"}\u2026`);let L=20,B=0,v=0,T=A=>({id:A.id,title:A.title,dueIso:A.dueIso||null,priority:A.priority||"Medium",category:A.category||"General",done:!!A.done,source:"memory-cue-mobile"});try{for(let A=0;A<y.length;A+=L){let P=y.slice(A,A+L);(await Promise.allSettled(P.map(F=>fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T(F))})))).forEach(F=>{F.status==="fulfilled"&&F.value?.ok?B+=1:(F.status,v+=1)}),await new Promise(F=>setTimeout(F,300))}v?B?f("error",`Partial sync: ${B} success, ${v} failed.`):f("error","Sync failed. Check your sync URL and retry."):f("online",`Sync complete. ${B} updated.`)}catch(A){console.error("Sync failed",A),f("error","Sync failed. Try again soon.")}finally{b(!1)}})})()});export default ft();
