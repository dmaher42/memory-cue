import{b as rn,c as oo}from"./chunk-CTK42JWW.js";import{a as Si,b as Ei,c as ro}from"./chunk-GUVSRPRW.js";function Ii(r={}){try{Object.assign($,r||{})}catch(a){console.warn("[supabase-auth] setAuthContext failed",a)}}async function Ai(r={}){try{if($&&typeof $.signInWithPopup=="function"&&$.auth&&typeof $.GoogleAuthProvider=="function")return $.signInWithPopup($.auth,new $.GoogleAuthProvider);if($&&typeof $.signInWithRedirect=="function"&&$.auth&&typeof $.GoogleAuthProvider=="function")return $.signInWithRedirect($.auth,new $.GoogleAuthProvider);let a=rn();if(a&&a.auth){if(typeof a.auth.signInWithOAuth=="function")return a.auth.signInWithOAuth({provider:"google",...r});if(typeof a.auth.signIn=="function")return a.auth.signIn({provider:"google"})}}catch(a){console.error("[supabase-auth] startSignInFlow error",a);try{$?.toast?.("Sign-in failed")}catch(l){console.warn("[supabase-auth] toast handler failed",l)}throw a}return Promise.resolve(null)}async function Li(){try{if($&&typeof $.signOut=="function")return $.signOut($.auth);let r=rn();if(r&&r.auth&&typeof r.auth.signOut=="function")return r.auth.signOut()}catch(r){throw console.error("[supabase-auth] startSignOutFlow error",r),r}return Promise.resolve(null)}function so(r){return r?Array.isArray(r)?r:[r]:[]}function wt(r){return Array.from(new Set(r.filter(a=>a instanceof HTMLElement||typeof SVGElement<"u"&&a instanceof SVGElement)))}function ce(r,a){let l=so(a).filter(Boolean);if(!l.length)return[];let y=l.flatMap(T=>Array.from(r.querySelectorAll(T)));return wt(y)}function co(r,a=document){let l=a instanceof Document||a instanceof HTMLElement?a:document;return{authForms:ce(l,r.authForm),emailInputs:ce(l,r.emailInput),signInButtons:ce(l,r.signInButtons),signOutButtons:ce(l,r.signOutButtons),userBadges:ce(l,r.userBadge),userBadgeEmails:ce(l,r.userBadgeEmail),userBadgeInitials:ce(l,r.userBadgeInitial),userNameEls:ce(l,r.userName),syncStatusEls:ce(l,r.syncStatus),syncStatusTextEls:ce(l,r.syncStatusText),statusIndicatorEls:ce(l,r.statusIndicator),feedbackEls:ce(l,r.feedback)}}function yt(r,a){wt(Array.isArray(r)?r:[r]).forEach(l=>{l instanceof HTMLElement&&(l.classList.toggle("hidden",!a),a?l.removeAttribute("hidden"):l.setAttribute("hidden",""))})}function Re(r,a){wt(Array.isArray(r)?r:[r]).forEach(l=>{l instanceof HTMLElement&&(l.textContent=a||"")})}function lo(r,a){wt(r).forEach(l=>{l instanceof HTMLElement&&(l.dataset.state=a,l.classList.toggle("online",a==="online"),l.classList.toggle("offline",a!=="online"))})}function bt(r,a){wt(r).forEach(l=>{if(!(l instanceof HTMLElement))return;l.textContent=a||"";let y=!!a;l.classList.toggle("hidden",!y),y?l.removeAttribute("hidden"):l.setAttribute("hidden","")})}function Ci(r={}){let a={...Ti.syncStatusText,...r.syncStatusText||{}};return{...Ti,...r,syncStatusText:a}}function ht(r,{user:a,messages:l}={}){let y=Ci(l),T=!!a;yt(r.signInButtons,!T),yt(r.authForms,!T),yt(r.signOutButtons,T),yt(r.userBadges,T);let F=typeof a?.email=="string"?a.email:"",B=F?F.charAt(0).toUpperCase():"U";T?(Re(r.userBadgeEmails,F),Re(r.userBadgeInitials,B),Re(r.userNameEls,F)):(Re(r.userBadgeEmails,""),Re(r.userBadgeInitials,""),Re(r.userNameEls,""));let Z=typeof y.signedIn=="function"?y.signedIn(a):y.signedIn,L=typeof y.signedOut=="function"?y.signedOut(a):y.signedOut,ee=T?Z:L,oe=!T;r.syncStatusEls.length&&(Re(r.syncStatusEls,ee),r.syncStatusEls.forEach(Se=>{Se instanceof HTMLElement&&(Se.classList.toggle("online",T),Se.dataset.state=T?"online":"offline")}),yt(r.syncStatusEls,oe));let S=T?y.syncStatusText?.signedIn:y.syncStatusText?.signedOut;Re(r.syncStatusTextEls,S||""),lo(r.statusIndicatorEls,T?"online":"offline"),bt(r.feedbackEls,"")}function uo(r,a){a.authForms.forEach(l=>{!(l instanceof HTMLFormElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("submit",async y=>{y.preventDefault();let T=a.emailInputs.find(B=>l.contains(B))||l.querySelector('input[type="email"]'),F=typeof T?.value=="string"?T.value.trim():"";if(!F){bt(a.feedbackEls,"Enter an email address to continue.");return}try{let{error:B}=await r.auth.signInWithOtp({email:F});B?bt(a.feedbackEls,B.message||"Unable to send magic link."):bt(a.feedbackEls,"Magic link sent. Check your email.")}catch(B){bt(a.feedbackEls,B?.message||"Unable to send magic link.")}}))})}function fo(r,a){a.signOutButtons.forEach(l=>{!(l instanceof HTMLElement)||l.dataset.supabaseAuthBound==="true"||(l.dataset.supabaseAuthBound="true",l.addEventListener("click",async()=>{try{await r.auth.signOut()}catch(y){console.error("[supabase] Sign-out failed.",y)}}))})}function Lo(r={}){let{supabase:a,scope:l=document,selectors:y={},messages:T={},disableButtonBinding:F=!1,onSessionChange:B}=r,Z={...ao,...y},L=co(Z,l),ee=Ci(T);ht(L,{user:null,messages:ee});let oe=a||rn()||(typeof window<"u"?window.supabase:null);if(!oe)return{supabase:null,elements:L,applyAuthState:ae=>ht(L,{...ae,messages:ee}),destroy(){}};uo(oe,L),F||fo(oe,L);let S=[],{data:Se}=oe.auth.onAuthStateChange((ae,ue)=>{if(ht(L,{user:ue?.user??null,messages:ee}),typeof B=="function")try{B(ue?.user??null,ue)}catch(ze){console.error("[supabase] onSessionChange handler failed.",ze)}});return Se?.subscription&&S.push(()=>{try{Se.subscription.unsubscribe()}catch{}}),oe.auth.getSession().then(({data:ae,error:ue})=>{ue||ht(L,{user:ae?.session?.user??null,messages:ee})}).catch(ae=>{console.error("[supabase] getSession failed.",ae)}),{supabase:oe,elements:L,applyAuthState:ae=>ht(L,{...ae,messages:ee}),destroy(){S.forEach(ae=>{try{ae()}catch{}})}}}var $,ao,Ti,xi=Ei(()=>{oo();$={authReady:!1,auth:null,GoogleAuthProvider:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,toast:null};ao={authForm:"#auth-form",emailInput:"#auth-email",signInButtons:null,signOutButtons:"#sign-out-btn",userBadge:"#user-badge",userBadgeEmail:"#user-badge-email",userBadgeInitial:"#user-badge-initial",userName:"#googleUserName",syncStatus:"#sync-status",syncStatusText:null,statusIndicator:null,feedback:["#auth-feedback-header","#auth-feedback-rail"]},Ti={signedOut:"",signedIn:r=>`Reminders syncing for ${r?.email||"your account"}.`,syncStatusText:{signedOut:"Offline",signedIn:"Online"}}});var Ri=ro((xo,vt)=>{var on=Object.freeze({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"});function Di(r){if(!r||typeof r!="object")return null;let a=Object.entries(r).filter(([l,y])=>typeof y=="string"&&y.trim()!=="");return a.length?Object.fromEntries(a):null}function po(){let r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},a=Di(r?.__FIREBASE_CONFIG);if(a)return a;let l=Di(r?.__ENV?.FIREBASE_CONFIG);if(l)return l;let T=Object.entries({FIREBASE_API_KEY:"apiKey",FIREBASE_AUTH_DOMAIN:"authDomain",FIREBASE_PROJECT_ID:"projectId",FIREBASE_STORAGE_BUCKET:"storageBucket",FIREBASE_MESSAGING_SENDER_ID:"messagingSenderId",FIREBASE_APP_ID:"appId",FIREBASE_MEASUREMENT_ID:"measurementId"}).reduce((F,[B,Z])=>{let L=r?.__ENV?.[B]??r?.[B];return typeof L=="string"&&L.trim()!==""&&(F[Z]=L),F},{});return Object.keys(T).length?T:null}function Ni(){let r=po();return r?{...on,...r}:{...on}}var ki={DEFAULT_FIREBASE_CONFIG:on,getFirebaseConfig:Ni};if(typeof globalThis<"u"){let r=globalThis;r.memoryCueFirebase=r.memoryCueFirebase||{},r.memoryCueFirebase.getFirebaseConfig=Ni,r.memoryCueFirebase.DEFAULT_FIREBASE_CONFIG=on}typeof vt<"u"&&vt.exports&&(vt.exports=ki,vt.exports.default=ki)});function yo(){if(ve)return{...ve};let a=jn()?.memoryCueFirebase;if(a&&typeof a.getFirebaseConfig=="function")return ve=a.getFirebaseConfig(),{...ve};if(typeof Si=="function")try{let l=Ri();if(l){let y=typeof l.getFirebaseConfig=="function"?l.getFirebaseConfig:typeof l.default?.getFirebaseConfig=="function"?l.default.getFirebaseConfig:null;if(y)return ve=y(),{...ve}}}catch{}return a&&a.DEFAULT_FIREBASE_CONFIG?(ve={...a.DEFAULT_FIREBASE_CONFIG},{...ve}):(ve={...go},{...ve})}function jn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function Pi(){let r=jn(),a=r&&r.TimestampTrigger;return typeof a=="function"?a:null}function Ce(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!Pi()}function ho(){if(typeof window>"u"||!window.location)return On;try{return new URL(On,window.location.href).href}catch{return On}}async function Fe(){return an||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(an=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(ho()),await navigator.serviceWorker.ready}catch(r){return console.warn("Service worker registration failed",r),null}})(),an))}async function Oi(r){if(!r||typeof r!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let a=await Fe();if(!a)return!1;let l=new Set;navigator.serviceWorker.controller&&l.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(T=>{let F=a[T];F&&l.add(F)});let y=!1;return l.forEach(T=>{try{T.postMessage(r),y=!0}catch(F){console.warn("Failed posting message to service worker",F)}}),y}catch(a){return console.warn("Unable to reach service worker",a),!1}}async function sn(){if(Ce())return!1;if(_n)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(St)try{return await St}catch{}St=(async()=>{let r=await Fe();if(!r)return!1;let a=!1;if("periodicSync"in r)try{let l=await r.periodicSync.getTags();(!Array.isArray(l)||!l.includes(Pn))&&await r.periodicSync.register(Pn,{minInterval:15*60*1e3}),a=!0}catch(l){console.warn("Periodic background sync unavailable",l)}if(!a&&"sync"in r)try{await r.sync.register(Pn),a=!0}catch(l){console.warn("Background sync unavailable",l)}return a})();try{let r=await St;return r&&(_n=!0),r}catch(r){return console.warn("Background reminder sync setup failed",r),_n=!1,!1}finally{St=null}}async function $n(r=[],{requestCheck:a=!1}={}){if(!Ce()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let l=await Fe();if(!l)return;let y=await Oi({type:Mi.updateScheduledReminders,reminders:Array.isArray(r)?r:[]});if(a&&await Oi({type:Mi.checkScheduledReminders}),!y&&typeof l.update=="function")try{await l.update()}catch{}}catch(l){console.warn("Failed syncing reminders with service worker",l)}}async function Hn(r,a){if(Ce())try{let l=a||await Fe();if(!l)return;let y=[];try{y=await l.getNotifications({tag:r,includeTriggered:!0})}catch{y=await l.getNotifications({tag:r})}for(let T of y)try{T.close()}catch{}}catch{}}function _i(){for(let r of Array.from(Le.values()))try{r.close()}catch{}Le.clear()}function bo(){if(Bi||typeof window>"u"||typeof window.addEventListener!="function")return;let r=()=>_i();["pagehide","beforeunload"].forEach(a=>{try{window.addEventListener(a,r)}catch{}}),Bi=!0}function q(r){if(typeof r=="string"){let a=r.replace(/\s+/g," ").trim();if(a)return a}return Y}async function ko(r={}){let a=e=>e?document.querySelector(e):null,l=e=>e?Array.from(document.querySelectorAll(e)):[],y=a(r.titleSel),T=a(r.dateSel),F=a(r.timeSel),B=a(r.detailsSel),Z=a(r.prioritySel),L=a(r.categorySel),ee=a(r.saveBtnSel),oe=a(r.cancelEditBtnSel),S=a(r.listSel),Se="reminder-title-pinned",ae="reminder-title-unpinned",ue=a(r.detailPanelSel),ze=a(r.detailEmptySel),dn=a(r.detailContentSel),Et=a(r.detailTitleSel),Tt=a(r.detailDueSel),It=a(r.detailPrioritySel),At=a(r.detailCategorySel),Ee=a(r.detailNotesSel),Wn=Ee?.dataset?.placeholder||"No notes added yet.",Ui=a(r.detailClearSel),Lt=l(r.googleSignInBtnSel),Ct=l(r.googleSignOutBtnSel),P=a(r.statusSel),W=a(r.syncStatusSel),$i={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Hi=6e3,se=null,xt=null;function $e(e,{clearMessage:t=!0}={}){se&&(e&&se.tokenId!==e||(se.timeoutId&&clearTimeout(se.timeoutId),t&&P&&P.dataset.undoToken===se.tokenId&&(typeof P.replaceChildren=="function"?P.replaceChildren():P.textContent="",delete P.dataset.undoToken,delete P.dataset.statusKind),se=null))}function ji(e){if(!P)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>Xr(e.tokenId)),e.button=i,typeof P.replaceChildren=="function"?P.replaceChildren(t,n,i):(P.textContent="",P.append(t,n,i)),P.dataset.statusKind="undo",P.dataset.undoToken=e.tokenId}function Ke(e){if(!ue)return;let t=!!e;if(ue.dataset.state=t?"active":"empty",ue.dataset.selectedId=t&&e?.id?e.id:"",ze&&(ze.classList.toggle("hidden",t),ze.setAttribute("aria-hidden",t?"true":"false")),dn&&(dn.classList.toggle("hidden",!t),dn.setAttribute("aria-hidden",t?"false":"true")),!t){Et&&(Et.textContent=""),Tt&&(Tt.textContent=""),It&&(It.textContent=""),At&&(At.textContent=""),Ee&&(Ee.textContent=Wn,Ee.dataset.empty="true");return}if(Et&&(Et.textContent=e.title||"Untitled reminder"),Tt&&(Tt.textContent=pi(e)),It&&(It.textContent=e.priority||"Medium"),At&&(At.textContent=e.category||Y),Ee){let n=typeof e.notes=="string"?e.notes.trim():"";n?(Ee.textContent=n,Ee.dataset.empty="false"):(Ee.textContent=Wn,Ee.dataset.empty="true")}}function Vn(){xt=null,Ke(null)}function Wi(e){xt=e?.id||null,Ke(e||null)}function Vi(){if(!ue)return;if(!xt){Ke(null);return}let e=u.find(t=>t?.id===xt);if(e){Ke(e);return}Vn()}Ke(null);function cn(e,t){if(!W)return;let n=["online","offline","error"];n.forEach(s=>W.classList.remove(s)),n.includes(e)&&W.classList.add(e),W.dataset.state=e;let i=typeof t=="string"?t:$i[e]||"";e==="online"||e==="offline"?(W.textContent="",W.dataset.compact="true",i?(W.setAttribute("aria-label",i),W.setAttribute("title",i)):(W.removeAttribute("aria-label"),W.removeAttribute("title"))):(W.textContent=i,W.removeAttribute("data-compact"),i?(W.setAttribute("aria-label",i),W.setAttribute("title",i)):(W.removeAttribute("aria-label"),W.removeAttribute("title")))}let J=a(r.notesSel),Yi=a(r.saveNotesBtnSel),Gi=a(r.loadNotesBtnSel),Yn=a(r.countTotalSel),Dt=a(r.googleUserNameSel),Be=a(r.dateFeedbackSel),te=a(r.voiceBtnSel),qi=a(r.notifBtnSel),Je=a(r.moreBtnSel),Qe=a(r.moreMenuSel),Xi=a(r.copyMtlBtnSel),ln=a(r.importFileSel),zi=a(r.exportBtnSel),Ki=a(r.syncAllBtnSel),He=a(r.syncUrlInputSel),Ji=a(r.saveSettingsSel),Qi=a(r.testSyncSel),Zi=l(r.openSettingsSel),kt=a(r.settingsSectionSel),je=a(r.emptyStateSel),Gn=a(r.listWrapperSel),un=a(r.categoryOptionsSel),Q=a(r.plannerContextSel),H=a(r.plannerLessonInputSel),ne=r.variant||"mobile",er=typeof r.autoWireAuthButtons=="boolean"?r.autoWireAuthButtons:ne!=="desktop",Ze="all",fn=[],pn="";function tr(){return new Date().toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"})}function We(){if(ne!=="mobile"||typeof document>"u")return;let e=document.getElementById("mobileRemindersHeaderSubtitle");if(!e)return;let t=tr(),n;Ze==="today"?n=`Today\u2019s reminders \u2022 ${t}`:n=`All reminders \u2022 ${t}`,pn&&(n+=` \u2022 ${pn}`),e.textContent=n}function nr(){ne==="mobile"&&(typeof navigator>"u"||!("geolocation"in navigator)||navigator.geolocation.getCurrentPosition(e=>{try{let{latitude:t,longitude:n}=e.coords,i=`https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(t)}&longitude=${encodeURIComponent(n)}&current_weather=true`;fetch(i).then(o=>{if(!o.ok)throw new Error("Weather request failed");return o.json()}).then(o=>{o&&o.current_weather&&typeof o.current_weather.temperature=="number"&&(pn=`${Math.round(o.current_weather.temperature)}\xB0C`,We())}).catch(o=>{console.warn("Failed to fetch current temperature",o)})}catch(t){console.warn("Failed to process geolocation weather data",t)}},e=>{console.warn("Geolocation error for weather",e)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:5*60*1e3}))}let qn="mc:lastDefaults",mn=()=>{Q&&(Q.classList.add("hidden"),Q.setAttribute("aria-hidden","true"),typeof Q.replaceChildren=="function"?Q.replaceChildren():Q.textContent=""),H&&(H.value="",H.dataset&&(delete H.dataset.lessonDayLabel,delete H.dataset.lessonTitle,delete H.dataset.lessonSummary))},ir=(e={})=>{if(!Q)return;let t=typeof e.dayLabel=="string"?e.dayLabel.trim():"",n=typeof e.lessonTitle=="string"?e.lessonTitle.trim():"",i=typeof e.summary=="string"?e.summary.trim():"",o=document.createElement("p");o.className="text-[0.65rem] font-semibold uppercase tracking-[0.2em] text-base-content/60",o.textContent=t?`${t} lesson`:"Planner lesson";let s=document.createElement("p");s.className="text-sm font-semibold text-base-content",s.textContent=n||i||"Planner reminder";let d=i?document.createElement("p"):null;d&&(d.className="text-sm text-base-content/70",d.textContent=i),typeof Q.replaceChildren=="function"?Q.replaceChildren(...[o,s,d].filter(Boolean)):(Q.textContent="",Q.append(o,s),d&&Q.append(d)),Q.classList.remove("hidden"),Q.removeAttribute("aria-hidden")},rr=(e={})=>{if(!e||typeof e!="object")return;let t=typeof e.plannerLessonId=="string"?e.plannerLessonId:"";y&&typeof e.reminderTitle=="string"&&(y.value=e.reminderTitle),B&&typeof e.reminderNotes=="string"&&(B.value=e.reminderNotes),T&&typeof e.dueDate=="string"&&(T.value=e.dueDate),H&&(H.value=t,H.dataset&&(H.dataset.lessonDayLabel=dayLabel,H.dataset.lessonTitle=lessonTitle,H.dataset.lessonSummary=summary)),ir(e)};function gn(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(qn)||"{}")||{}}catch{return{}}}function or(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(qn,JSON.stringify(e))}catch{}}function Xn(e){let t=gn(),n={category:q(e?.category||t.category||Y),priority:e?.priority||t.priority||"Medium"};or(n)}let zn='fieldset#priorityChips input[name="priority"]';function yn(){try{let e=document.querySelector(`${zn}:checked`);if(e&&e.value)return e.value}catch{}return Z&&typeof Z.value=="string"&&Z.value?Z.value:"Medium"}function Nt(e){let t=e||"Medium";Z&&typeof Z.value<"u"&&(Z.value=t);try{let n=Array.from(document.querySelectorAll(zn));if(!n.length)return;let i=!1;if(n.forEach(o=>{let s=o.value===t;o.checked=s,i=i||s}),!i){let o=n.find(s=>s.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function Kn(){let e=gn();e.category&&L&&(L.value=e.category),e.priority&&Nt(e.priority)}Kn();let X=typeof document<"u"?document.getElementById("quickAddInput"):null,ar=typeof document<"u"?document.getElementById("quickAddSubmit"):null,ie=typeof document<"u"?document.getElementById("quickAddVoice"):null,xe=typeof document<"u"?document.querySelector(".pill-voice-btn"):null,hn=null;function sr(e,t){let n=Date.now(),i=gn(),o=typeof t=="string"&&t?t:null;return{id:zt(),title:(e||"").trim(),priority:i.priority||yn(),category:q(i.category||L?.value||Y),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!z,pinToToday:!1}}async function Rt(e={}){if(!X)return null;if(typeof hn=="function")try{hn()}catch{}let n=((typeof e.text=="string"?e.text:(X.value||"").trim())||"").trim();if(!n)return null;let o=e.dueDate instanceof Date&&!Number.isNaN(e.dueDate.getTime())?e.dueDate:null,s=null;if(o)s=new Date(o).toISOString();else try{let p=Qt(n);p&&p.time&&(s=new Date(`${p.date}T${p.time}:00`).toISOString())}catch{s=null}let d=sr(n,s);if(e.notifyAt instanceof Date&&!Number.isNaN(e.notifyAt.getTime()))try{d.notifyAt=new Date(e.notifyAt).toISOString()}catch{d.notifyAt=null}Tn(d,{position:"start"}),u.unshift(d),de(u);let c=st(u);Me=!0,U(),G(),c?u.forEach(p=>K(p)):K(d),ct(d),Ue(d),Ne(),Xn(d),Ve();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:u}}))}catch{}if(me({action:"created",label:`Reminder added \xB7 ${d.title}`}),X.value="",typeof document<"u")try{document.dispatchEvent(new CustomEvent("reminder:quick-add:complete",{detail:{entry:d}}))}catch{}return d}typeof window<"u"&&(window.memoryCueQuickAddNow=Rt),ar?.addEventListener("click",()=>{Rt()}),X?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Rt())});function dr(){if(typeof HTMLElement>"u"||!(ie instanceof HTMLElement)||!(X instanceof HTMLInputElement)||ie.dataset.voiceBound==="true")return;if(ie.dataset.voiceBound="true",typeof window>"u"){ie.setAttribute("disabled","true"),ie.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){ie.setAttribute("disabled","true"),ie.setAttribute("aria-disabled","true"),ie.getAttribute("title")||(ie.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,ie.setAttribute("aria-pressed",d?"true":"false"),ie.dataset.listening=d?"true":"false",ie.classList.toggle("is-listening",d)},o=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",p=>{let f=p?.results?.[0]?.[0]?.transcript?.trim()||"";if(f){X.value=f;try{X.focus({preventScroll:!0})}catch{X.focus()}try{let b=X.value.length;typeof X.setSelectionRange=="function"&&X.setSelectionRange(b,b)}catch{}}});let c=()=>{i(!1)};return t.addEventListener("end",c),t.addEventListener("error",c),t},s=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};hn=s,ie.addEventListener("click",()=>{let d=o();if(d){if(n){s();return}try{d.start(),i(!0)}catch(c){console.warn("Quick add voice error:",c),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",s),i(!1)}dr();let Jn=typeof window<"u"?window.SpeechRecognition||window.webkitSpeechRecognition:null,fe=null,Qn=!!Jn;Qn&&(fe=new Jn,fe.lang="en-AU",fe.interimResults=!1,fe.maxAlternatives=1);function cr(){try{if(typeof E=="function"){E("Voice input is not supported on this device. You can still type your reminder.");return}}catch{}try{alert("Voice input is not supported on this device. You can still type your reminder.")}catch{console.warn("Voice input is not supported on this device.")}}xe&&(Qn&&fe?xe.addEventListener("click",()=>{try{fe.start(),xe.classList.add("is-recording")}catch(e){console.warn("Voice input failed to start",e)}}):xe.addEventListener("click",()=>{cr()})),fe&&(fe.addEventListener("result",e=>{let t=e?.results?.[0]?.[0]?.transcript?.trim();fr(t)}),fe.addEventListener("end",()=>{xe&&xe.classList.remove("is-recording")}),fe.addEventListener("error",()=>{xe&&xe.classList.remove("is-recording")}));function lr(e){if(!e)return"";let t=e.trim();return t=t.charAt(0).toUpperCase()+t.slice(1),/[.!?]$/.test(t)||(t+="."),t}function ur(e){let t={dueDate:null,notifyAt:null};if(!e)return t;let n=e.toLowerCase().trim(),i=new Date,o=new Date(i);if(n.includes("tomorrow"))o.setDate(o.getDate()+1);else if(!n.includes("today"))return t;let s=n.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/);if(!s)return t;let d=parseInt(s[1],10),c=s[2]?parseInt(s[2],10):0,p=s[3];p||(/\b(p\.?m\.?|p m)\b/.test(n)?p="pm":/\b(a\.?m\.?|a m)\b/.test(n)&&(p="am")),p==="pm"&&d<12&&(d+=12),p==="am"&&d===12&&(d=0),o.setHours(d,c,0,0);let f=new Date(o),b=new Date(f.getTime()-10*60*1e3);return t.dueDate=f,t.notifyAt=b,t}function fr(e){if(!e||!X)return;let t=lr(e),{dueDate:n,notifyAt:i}=ur(e);X.value=t,Rt({text:t,dueDate:n,notifyAt:i})}typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&X&&(e.preventDefault(),X.focus())})));try{ne==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let pr=r.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Zn=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,mr=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",Ft=r.reminderLandingPath||(ne==="desktop"?"index.html#reminders":"mobile.html"),pe=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function ei(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ve(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:u}}))}catch{}}L&&!L.value&&(L.value=Y),Ce()&&Fe();function me(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(Fi,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(Fi,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function gr(){if(typeof HTMLElement>"u"||!(te instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&y instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&y instanceof HTMLTextAreaElement;if(!e&&!t||te.dataset.voiceBound==="true")return;if(te.dataset.voiceBound="true",typeof window>"u"){te.setAttribute("disabled","true"),te.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){te.setAttribute("disabled","true"),te.setAttribute("aria-disabled","true"),te.getAttribute("title")||(te.title="Voice input is not supported in this browser.");return}let i=null,o=!1,s=f=>{o=f,te.setAttribute("aria-pressed",f?"true":"false"),te.dataset.listening=f?"true":"false",te.classList.toggle("is-listening",f)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",b=>{let C=b.results?.[0]?.[0]?.transcript?.trim()||"";if(C){y.value=C;try{y.focus({preventScroll:!0})}catch{try{y.focus()}catch{}}try{let I=y.value.length;typeof y.setSelectionRange=="function"&&y.setSelectionRange(I,I)}catch{}me({action:"dictated",label:`Voice input captured \xB7 ${C}`})}});let f=()=>{s(!1)};return i.addEventListener("end",f),i.addEventListener("error",f),i},c=()=>{if(!(!o||!i)){try{i.stop()}catch{}s(!1)}};te.addEventListener("click",()=>{let f=d();if(f){if(o){c();return}try{f.start(),s(!0)}catch(b){console.warn("Speech recognition error:",b),s(!1)}}});let p=()=>{c()};typeof document<"u"&&(document.addEventListener("cue:close",p),document.addEventListener("reminders:updated",p)),s(!1)}bo(),gr();let Bt,Mt,Ot,Pt,Ye,_t,Ut,$t,Ht,jt,Wt,et,tt,Vt,Yt,bn,wn,Gt,vn,ti=r.firebaseDeps,Sn=typeof r.importModule=="function"?r.importModule:e=>import(e),nt=jn(),it=!1,ge=!1,En=null,Te=null,rt=null,u=[],Me=!1,z=null,ot=null,Ge=null,Oe={},Pe={},V={};function de(e=u){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?si(t||{},n||{}):o-i})}function yr(e=u){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function at(e=u){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),de(n);else{n=e.slice().sort(si);let i=n.length;n.forEach((o,s)=>{o.orderIndex=(i-s)*we})}return e===u&&(u=n),n}function Tn(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=yr();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-we||we}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+we||we}}function st(e=u){if(!Array.isArray(e)||e.length<2)return!1;de(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],s=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(s==null||d==null||s<=d||s-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*we;return e===u&&de(u),!0}let D={draggingId:null,dropTargetId:null,dropBefore:!0},ni=!1,g={active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0};function hr(e){return!e||typeof e.closest!="function"?null:e.closest('button, a, input, textarea, select, label, [role="button"], [role="menuitem"], [role="option"], [role="switch"], [contenteditable="true"]')}function dt(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function De(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function In(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),De(),D.draggingId=null,D.dropTargetId=null,D.dropBefore=!0}function ii(e,t,n){if(!e||e===t)return;let i=u.findIndex(I=>I?.id===e);if(i<0)return;let[o]=u.splice(i,1),s;if(!t)s=u.length;else{let I=u.findIndex(j=>j?.id===t);if(I<0){u.splice(i,0,o);return}s=n?I:I+1}u.splice(s,0,o);let d=u[s-1],c=u[s+1],p=Number.isFinite(d?.orderIndex)?d.orderIndex:null,f=Number.isFinite(c?.orderIndex)?c.orderIndex:null,b;p!=null&&f!=null?b=(p+f)/2:p!=null?b=p-we:f!=null?b=f+we:b=we,Number.isFinite(b)||(b=we*(u.length+1)),o.orderIndex=b,de(u);let C=st(u);Me=!0,U(),G(),C?u.forEach(I=>K(I)):K(o),Ve(),pe("memoryCue:remindersUpdated",{items:u}),me({action:"reordered",label:"Reminders reordered"})}function br(e){let t=dt(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(D.draggingId=i,D.dropTargetId=null,D.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function wr(e){if(!D.draggingId)return;let t=dt(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),D.dropTargetId=null,D.dropBefore=!1,De(),S?.classList.add("drag-over-list");return}if(t.dataset.id===D.draggingId){e.preventDefault(),De();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(D.dropTargetId!==t.dataset.id||D.dropBefore!==o)&&(De(),t.classList.add(o?"drag-over-before":"drag-over-after"),D.dropTargetId=t.dataset.id,D.dropBefore=o)}function vr(e){let t=dt(e.target);if(!t){S?.contains(e.relatedTarget)||De();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function Sr(e){if(!D.draggingId)return;e.preventDefault();let t=dt(e.target),n=t?.dataset.id||null,i=D.dropBefore;if(t){let o=t.getBoundingClientRect(),s=o.top+o.height/2;i=e.clientY<s}else n=null,i=!1;ii(D.draggingId,n,i),In()}function Er(){In()}function Tr(){!S||ni||(ni=!0,S.addEventListener("dragstart",br),S.addEventListener("dragover",wr),S.addEventListener("drop",Sr),S.addEventListener("dragend",Er),S.addEventListener("dragleave",vr),qt())}function qt(){if(!S||qt._bound)return;if(!(()=>{if(typeof window>"u")return!1;if(navigator&&typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0)return!0;try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}})()){qt._bound=!0;return}let t=6,n=160;function i(){g.longPressTimer&&(clearTimeout(g.longPressTimer),g.longPressTimer=null)}function o(){S&&(g.initialTouchAction!=null?S.style.touchAction=g.initialTouchAction:S.style.removeProperty("touch-action"))}function s({keepHighlights:v=!1}={}){if(i(),g.item&&g.pointerId!=null)try{g.item.hasPointerCapture?.(g.pointerId)&&g.item.releasePointerCapture(g.pointerId)}catch{}if(g.placeholder?.parentNode)try{g.placeholder.parentNode.removeChild(g.placeholder)}catch{}g.item&&(g.item.classList.remove("is-dragging"),g.originalStyles?g.item.setAttribute("style",g.originalStyles):g.item.removeAttribute("style")),o(),v||De(),Object.assign(g,{active:!1,ready:!1,pointerId:null,item:null,placeholder:null,originalStyles:"",offsetY:0,fixedX:0,longPressTimer:null,startX:0,startY:0,lastClientX:0,lastClientY:0,moved:!1,initialTouchAction:"",startTime:0})}function d(v){return S?Array.from(S.querySelectorAll("[data-reminder-item]")).filter(h=>h!==v):[]}function c(v){let h=g.item;if(!h||g.ready)return;let x=h.getBoundingClientRect(),O=window.getComputedStyle(h);g.ready=!0,D.draggingId=h.dataset.id||null,g.offsetY=v.clientY-x.top,g.fixedX=x.left;let k=document.createElement("div");k.className="touch-drag-placeholder",k.setAttribute("aria-hidden","true"),k.style.height=`${x.height}px`,k.style.boxSizing="border-box",k.style.marginTop=O.marginTop,k.style.marginBottom=O.marginBottom,k.style.marginLeft=O.marginLeft,k.style.marginRight=O.marginRight,k.style.borderRadius=O.borderRadius,k.style.border="2px dashed color-mix(in srgb, var(--primary-color, #5e72e4) 55%, transparent)",k.style.background="color-mix(in srgb, var(--primary-color, #5e72e4) 12%, transparent)",k.style.pointerEvents="none",k.style.display="block",k.style.width="100%",h.parentNode?.insertBefore(k,h),g.placeholder=k,g.longPressTimer=null,g.originalStyles=h.getAttribute("style")||"",h.classList.add("is-dragging"),h.style.position="fixed",h.style.left=`${x.left}px`,h.style.top=`${x.top}px`,h.style.width=`${x.width}px`,h.style.zIndex="999",h.style.pointerEvents="none",h.style.touchAction="none",g.initialTouchAction=S.style.touchAction||"",S.style.touchAction="none"}function p(v){let h=g.item;if(!h||!g.ready)return;let x=v-g.offsetY;h.style.top=`${x}px`,h.style.left=`${g.fixedX}px`}function f(v){if(!g.ready||!S)return;let h=g.item,x=d(h);if(De(),!x.length){D.dropTargetId=null,D.dropBefore=!1;return}let O=null,k=!1;for(let m of x){let w=m.getBoundingClientRect(),M=w.top+w.height/2;if(v<M){O=m,k=!0;break}}if(!O){O=x[x.length-1];let m=O.getBoundingClientRect(),w=m.top+m.height/2;k=v<w,k||(k=!1)}if(!O){D.dropTargetId=null,D.dropBefore=!1;return}let he=O.getBoundingClientRect(),Fn=he.top+he.height/2,ft=v<Fn;O.classList.add(ft?"drag-over-before":"drag-over-after"),D.dropTargetId=O.dataset.id||null,D.dropBefore=ft}function b(v){let h=D.draggingId,x=g.moved;if(!g.ready){s();return}s(),!v&&x&&h&&ii(h,D.dropTargetId,D.dropBefore),In()}function C(v){let h=v.pointerType||"";if(h&&h!=="touch"&&h!=="pen"||g.active)return;let x=dt(v.target);if(!x)return;let O=hr(v.target);if(!(O&&O!==x)){g.active=!0,g.pointerId=v.pointerId,g.item=x,g.startX=v.clientX,g.startY=v.clientY,g.lastClientX=v.clientX,g.lastClientY=v.clientY,g.moved=!1,g.ready=!1,g.originalStyles=x.getAttribute("style")||"",g.startTime=v.timeStamp||Date.now(),D.dropTargetId=null,D.dropBefore=!0,D.draggingId=null,i(),g.longPressTimer=setTimeout(()=>{c({clientY:g.lastClientY})},n);try{x.setPointerCapture(v.pointerId)}catch{}}}function I(v){if(!g.active||v.pointerId!==g.pointerId)return;let h=v.pointerType||"";if(!(h&&h!=="touch"&&h!=="pen")){if(g.lastClientX=v.clientX,g.lastClientY=v.clientY,!g.ready){let x=Math.abs(v.clientX-g.startX),O=Math.abs(v.clientY-g.startY);if(x>t||O>t){let k=typeof v.timeStamp=="number"?v.timeStamp:Date.now();Math.abs(k-g.startTime)>=n?(i(),c({clientY:g.lastClientY})):s()}return}v.preventDefault(),g.moved=!0,p(v.clientY),f(v.clientY)}}function j(v){!g.active||v.pointerId!==g.pointerId||b(!1)}function le(v){!g.active||v.pointerId!==g.pointerId||b(!0)}S.addEventListener("pointerdown",C),window.addEventListener("pointermove",I),window.addEventListener("pointerup",j),window.addEventListener("pointercancel",le),qt._bound=!0}function ri(){z=null,cn("offline"),Lt.forEach(e=>e.classList.remove("hidden")),Ct.forEach(e=>e.classList.add("hidden")),Dt&&(Dt.textContent=""),ot?.(),ot=null,Ln(),U(),G(),Ne()}function An(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Un);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,s=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:zt(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:q(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(s)?s:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:n.pinToToday===!0}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function Ir(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Un);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:q(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null,plannerLessonId:typeof n.plannerLessonId=="string"&&n.plannerLessonId.trim()?n.plannerLessonId.trim():null,pinToToday:!!n.pinToToday}));localStorage.setItem(Un,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function G(){de(u),Ir(u)}function Ln(){u=at(An())}Ln();async function Ar(){if(!z){u=An();return}let e=at(An());if(!e.length){u=[],G();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await K(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}u=at(e.map(n=>({...n,pendingSync:!1}))),G(),U(),Ne()}try{V=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{V={}}if(V&&typeof V=="object"&&Object.values(V).forEach(e=>{e&&typeof e=="object"&&(e.category=q(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.notifyAt=typeof e.notifyAt=="string"?e.notifyAt:null,e.body=typeof e.body=="string"&&e.body?e.body:lt(e),e.urlPath=e.urlPath||Ft,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!Ce()){let e=fi();typeof Notification<"u"&&Notification.permission==="granted"?(sn(),e.length&&$n(e,{requestCheck:!0})):e.length&&$n(e)}let Xt=e=>{if(!nt)return;let t=[nt];nt.window&&!t.includes(nt.window)&&t.push(nt.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Lr(){if(!J)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",s=()=>"value"in J?J.value:J.innerHTML,d=b=>{if("value"in J){J.value=b;return}if(typeof b!="string"||b.length===0){J.innerHTML="";return}let C=b.trim();if(/<\/?[a-z][\s\S]*>/i.test(C)){J.innerHTML=b;return}let j=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");J.innerHTML=j},c=b=>{b?J.classList.add("notes-editor--columns"):J.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!b))},p="";try{p=localStorage.getItem(n)||""}catch{E("Unable to access saved notes")}d(p);let f=!1;try{f=localStorage.getItem(i)==="1"}catch{f=!1}c(f),J.addEventListener("input",()=>{p=s();try{localStorage.setItem(n,p)}catch{E("Notes saved for this session only")}}),Yi?.addEventListener("click",()=>{p=s();try{localStorage.setItem(n,p),E("Notes saved")}catch{E("Notes saved for this session only")}}),Gi?.addEventListener("click",()=>{let b=p;try{b=localStorage.getItem(n)||p}catch{E("Unable to load saved notes")}p=b,d(p)}),e?.addEventListener("click",b=>{let C=b.target;if(!(C instanceof Element))return;let I=C.closest("button[data-action]");if(!I)return;let j=I.getAttribute("data-action");if(j==="columns"){let le=!J.classList.contains("notes-editor--columns");c(le);try{localStorage.setItem(i,le?"1":"0")}catch{E("Column preference saved for this session only")}return}if(!o){E("Formatting controls are not supported in this browser");return}J.focus(),j==="bullets"?document.execCommand("insertUnorderedList"):j==="numbers"&&document.execCommand("insertOrderedList")})}if(Lr(),ee?.addEventListener("click",hi),ti)({initializeApp:Bt,getFirestore:Mt,enableMultiTabIndexedDbPersistence:Ot,enableIndexedDbPersistence:Pt,doc:Ye,setDoc:_t,deleteDoc:Ut,onSnapshot:$t,collection:Ht,query:jt,orderBy:Wt,serverTimestamp:et,getAuth:tt,onAuthStateChanged:Vt,GoogleAuthProvider:Yt,signInWithPopup:bn,signInWithRedirect:wn,getRedirectResult:Gt,signOut:vn}=ti),it=!0;else try{({initializeApp:Bt}=await Sn("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:Mt,enableMultiTabIndexedDbPersistence:Ot,enableIndexedDbPersistence:Pt,doc:Ye,setDoc:_t,deleteDoc:Ut,onSnapshot:$t,collection:Ht,query:jt,orderBy:Wt,serverTimestamp:et}=await Sn("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:tt,onAuthStateChanged:Vt,GoogleAuthProvider:Yt,signInWithPopup:bn,signInWithRedirect:wn,getRedirectResult:Gt,signOut:vn}=await Sn("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),it=!0}catch(e){it=!1,console.warn("Firebase modules failed to load:",e),E("Firebase failed to load; notes available offline"),Xt(!1)}if(it&&typeof Bt=="function"&&typeof Mt=="function"&&typeof tt=="function")try{let e=yo();if(!e||typeof e!="object")throw new Error("Firebase config unavailable");if(!e.projectId)throw new Error("Firebase projectId missing from configuration");console.info("[Firebase] Initialising Memory Cue",e.projectId),En=Bt(e),Te=Mt(En),ge=!0,console.info("[Firebase] Firestore initialised",e.projectId),Xt(!0)}catch(e){ge=!1,console.warn("Firebase initialization failed:",e),E("Firebase failed to load; notes available offline"),Xt(!1)}else it?(ge=!1,Xt(!1)):ge=!1;ge&&typeof Ot=="function"&&typeof Pt=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await Ot(Te),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Pt(Te),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),ge&&typeof tt=="function"&&(rt=tt(En));function Cr(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let xr=typeof navigator<"u"&&navigator.language?navigator.language:"",oi=Cr(xr),qe=oi||"en-US",Ie="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Ie=e.timeZone),!oi&&e.locale&&(qe=e.locale)}catch{}let Dr=new Intl.DateTimeFormat(qe,{timeZone:Ie,hour:"2-digit",minute:"2-digit"}),kr=new Intl.DateTimeFormat(qe,{timeZone:Ie,weekday:"long",day:"numeric",month:"long"}),Nr=new Intl.DateTimeFormat("en-CA",{timeZone:Ie,year:"numeric",month:"2-digit",day:"2-digit"}),Rr=new Intl.DateTimeFormat(qe,{timeZone:Ie,weekday:"long"}),Fr=new Intl.DateTimeFormat(qe,{timeZone:Ie,month:"short",day:"numeric"});function ke(e){let t=Nr.formatToParts(e),n=t.find(s=>s.type==="year").value,i=t.find(s=>s.type==="month").value,o=t.find(s=>s.type==="day").value;return`${n}-${i}-${o}`}function ai(e,t){let[n,i,o]=e.split("-").map(p=>parseInt(p,10)),[s,d]=t.split(":").map(p=>parseInt(p,10)),c=new Date;return c.setFullYear(n,(i||1)-1,o||1),c.setHours(s||0,d||0,0,0),c.toISOString()}let Br=new Intl.DateTimeFormat("en-CA",{timeZone:Ie,year:"numeric",month:"2-digit",day:"2-digit"}),Mr=new Intl.DateTimeFormat("en-CA",{timeZone:Ie,hour:"2-digit",minute:"2-digit",hour12:!1});function Or(e){try{let t=new Date(e),n=Br.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",o=n.find(d=>d.type==="month")?.value||"00",s=n.find(d=>d.type==="day")?.value||"00";return`${i}-${o}-${s}`}catch{return""}}function Pr(e){try{let t=new Date(e),n=Mr.formatToParts(t),i=n.find(s=>s.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(s=>s.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function zt(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function Kt(){return ke(new Date)}function _r(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function vo(e){let t=_r(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function Jt(e){return e==="High"?3:e==="Medium"?2:1}function si(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,s=t?.due?new Date(t.due).getTime():1/0;if(o!==s)return o-s;let d=Jt(t?.priority)-Jt(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function So(e,t){let n=Jt(t.priority)-Jt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function di(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return kr.format(t)}catch{return e}}function Cn(e){return Dr.format(e)}function Ur(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Eo(e){return e?Ur(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function E(e){P&&($e(),P.dataset.statusKind="toast",P.textContent=e,clearTimeout(E._t),E._t=setTimeout(()=>{P&&P.dataset.statusKind==="toast"&&(P.textContent="",delete P.dataset.statusKind)},2500))}function $r(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Qt(e){e=String(e||"").toLowerCase();let t={date:Kt(),time:""},n=c=>{let p=new Date,f=p.getDay(),b=(c-f+7)%7,C=new Date(p);return C.setDate(p.getDate()+(b===0?7:b)),C},i=c=>{let p=new Date,f=p.getDay(),b=(c-f+7)%7,C=new Date(p);return C.setDate(p.getDate()+b),C},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},s={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let c=new Date;c.setDate(c.getDate()+1),t.date=ke(c)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=o[c[1]],f=n(p);t.date=ke(f)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=o[c[1]],f=i(p);t.date=ke(f)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),p=o[c[1]],f=n(p);t.date=ke(f)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let c=e.match(/\bin\s+(\d+)\s+days?\b/),p=parseInt(c[1],10),f=new Date;f.setDate(f.getDate()+p),t.date=ke(f)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let c=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),p=parseInt(c[1],10),f=parseInt(c[2],10)-1,b=c[3]?parseInt(c[3],10):new Date().getFullYear(),C=new Date(b,f,p);t.date=ke(C)}else for(let[c,p]of Object.entries(s)){let f=new RegExp(`\\b${c}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(f.test(e)){let b=e.match(f),C=parseInt(b[1],10),I=new Date().getFullYear(),j=new Date(I,p,C);t.date=ke(j);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let c=parseInt(d[1],10),p=d[2]?parseInt(d[2],10):0,f=d[3];f&&(f==="pm"&&c<12&&(c+=12),f==="am"&&c===12&&(c=0)),t.time=`${String(c).padStart(2,"0")}:${String(p).padStart(2,"0")}`}return t}let xn=ge&&rt&&typeof Yt=="function";Ii({authReady:xn,auth:rt,GoogleAuthProvider:Yt,signInWithPopup:bn,signInWithRedirect:wn,signOut:vn,toast:E});let ci=er,li=(e,t)=>{!(e instanceof HTMLElement)||e._authWired||(e.addEventListener("click",n=>{try{let i=t(n);i&&typeof i.then=="function"&&i.catch(o=>{console.error("Auth handler error:",o)})}catch(i){console.error("Auth handler error:",i)}}),e._authWired=!0)};ci&&Lt.length&&Lt.forEach(e=>li(e,Ai)),xn&&typeof Gt=="function"&&Gt(rt).catch(()=>{}),ci&&Ct.length&&Ct.forEach(e=>li(e,Li)),xn&&typeof Vt=="function"?Vt(rt,async e=>{e?(z=e.uid,cn("online"),Lt.forEach(t=>t.classList.add("hidden")),Ct.forEach(t=>t.classList.remove("hidden")),Dt&&(Dt.textContent=e.displayName||e.email||""),Hr(),await Ar()):ri()}):ri();function Hr(){if(!ge||!Te||typeof Ht!="function"||typeof jt!="function"||typeof Wt!="function"||typeof $t!="function")return;if(!z){Ln(),U(),We(),G(),Ne();return}ot&&ot();let e=Ht(Te,"users",z,"reminders"),t=jt(e,Wt("updatedAt","desc"));ot=$t(t,n=>{let i=[];n.forEach(o=>{let s=o.data(),d=Number(s.orderIndex),c=typeof s.plannerLessonId=="string"&&s.plannerLessonId?s.plannerLessonId:null,p=s.pinToToday===!0;i.push({id:o.id,title:s.title,priority:s.priority,notes:s.notes||"",done:!!s.done,due:s.due||null,category:q(s.category),createdAt:s.createdAt?.toMillis?.()||0,updatedAt:s.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null,plannerLessonId:c,pinToToday:p})}),u=at(i),U(),We(),G(),Ne()},n=>{console.error("Firestore sync error:",n),W&&cn("error","Sync Error")})}async function K(e){if(!(!ge||!z||!Te||typeof Ye!="function"||typeof _t!="function"||typeof et!="function"))try{await _t(Ye(Te,"users",z,"reminders",e.id),{ownerUid:z,title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||Y,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId?e.plannerLessonId:null,pinToToday:!!e.pinToToday,createdAt:e.createdAt?new Date(e.createdAt):et(),updatedAt:et()},{merge:!0})}catch(t){console.error("Save failed:",t),E("Save queued (offline)")}}async function jr(e){if(!(!ge||!z||!Te||typeof Ye!="function"||typeof Ut!="function"))try{await Ut(Ye(Te,"users",z,"reminders",e))}catch{E("Delete queued (offline)")}}async function ct(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||Y,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function _e({preserveDetail:e=!1}={}){y&&(y.value=""),T&&(T.value=""),F&&(F.value=""),B&&(B.value=""),Nt("Medium"),L&&(L.value=Y),Kn(),Ge=null,ee&&(ee.textContent="Save"),oe?.classList.add("hidden"),mn(),e||Vn()}function Wr(e){let t=u.find(n=>n.id===e);t&&(y&&(y.value=t.title||""),T&&F&&(t.due?(T.value=Or(t.due),F.value=Pr(t.due)):(T.value="",F.value="")),Nt(t?.priority||"Medium"),L&&(L.value=q(t.category)),B&&(B.value=typeof t.notes=="string"?t.notes:""),H&&(H.value=typeof t.plannerLessonId=="string"?t.plannerLessonId:""),mn(),Wi(t),Ge=e,ee&&(ee.textContent="Update"),oe?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),y?.focus(),pe("cue:open",{mode:"edit"}))}function Vr(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=q(e.category??(L?L.value:"")),o={id:zt(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!z,plannerLessonId:typeof e.plannerLessonId=="string"&&e.plannerLessonId.trim()?e.plannerLessonId.trim():null,pinToToday:!!e.pinToToday};Tn(o,{position:"start"}),u=[o,...u],de(u);let s=st(u);return Me=!0,U(),G(),Xn(o),s?u.forEach(d=>K(d)):K(o),ct(o),Ue(o),Ve(),pe("memoryCue:remindersUpdated",{items:u}),ei(),me({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function Yr(e,t){if(!z)return E("Sign in to add notes"),null;if(!e)return null;let n=u.find(d=>d.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let s=typeof n.notes=="string"?n.notes:"";return n.notes=s?`${s}
${o}`:o,n.updatedAt=Date.now(),K(n),U(),G(),me({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function Gr(e){let t=u.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),K(t),ct(t),U(),G(),t.done?(en(e),me({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(Ue(t),me({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function qr(e,t){let n=u.find(o=>o?.id===e);if(!n)return;let i=!!t;n.pinToToday!==i&&(n.pinToToday=i,n.updatedAt=Date.now(),K(n),U(),G(),Ve(),pe("memoryCue:remindersUpdated",{items:u}))}function Xr(e){if(!se||se.tokenId!==e)return;let{item:t,index:n}=se;if(!t){$e(e);return}$e(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),u.length):u.length;t.pendingSync=!z,t.updatedAt=Date.now(),u.splice(i,0,t),de(u);let o=st(u);Me=!0,U(),G(),Ue(t),o?u.forEach(s=>K(s)):K(t),ct(t),Ve(),pe("memoryCue:remindersUpdated",{items:u}),me({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),E("Reminder restored")}function zr(e){let t=u.findIndex(o=>o.id===e),n=t>=0?u.splice(t,1)[0]:null;n&&Ge===e&&_e(),U(),G(),jr(e),en(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(me({action:"deleted",label:i}),n&&P){$e();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;se={tokenId:o,item:n,index:t,timeoutId:null},ji(se),se.timeoutId=setTimeout(()=>{$e(o)},Hi)}else n&&$e()}function Kr(e,t){if(!e||typeof e.addEventListener!="function"||typeof t!="function")return;let n=80,i=48,o=800,s='[data-no-swipe], a[href], button, input, textarea, select, [role="button"], [role="link"], [contenteditable="true"], [contenteditable=""]',d=null,c=!1,p=0,f=0,b=0,C=()=>{if(c){if(c=!1,d!=null&&e.hasPointerCapture?.(d))try{e.releasePointerCapture(d)}catch{}d=null,e.removeEventListener("pointermove",j),e.removeEventListener("pointerup",le),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerleave",v),window.removeEventListener("pointerup",le),window.removeEventListener("pointercancel",v)}},I=h=>{if(h.pointerType==="mouse"&&h.button!==0)return;c&&C();let x=h.target;x instanceof Element&&x.closest(s)||(d=h.pointerId,p=h.clientX,f=h.clientY,b=typeof h.timeStamp=="number"?h.timeStamp:Date.now(),c=!0,e.addEventListener("pointermove",j),e.addEventListener("pointerup",le),e.addEventListener("pointercancel",v),e.addEventListener("pointerleave",v),window.addEventListener("pointerup",le),window.addEventListener("pointercancel",v))},j=h=>{if(!c||h.pointerId!==d)return;Math.abs(h.clientY-f)>i&&C()},le=h=>{if(!c||h.pointerId!==d)return;let x=h.clientX-p,O=Math.abs(h.clientY-f),k=(typeof h.timeStamp=="number"?h.timeStamp:Date.now())-b;if(C(),x<=-n&&O<=i&&k<=o){h.preventDefault(),h.stopPropagation();try{t()}catch(he){console.warn("Swipe delete handler failed",he)}}},v=h=>{c&&(typeof h.pointerId=="number"&&h.pointerId!==d||C())};e.addEventListener("pointerdown",I)}function lt(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=Cn(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=Cn(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function ui(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}E("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function fi(){return Object.values(V||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,priority:e.priority||"Medium",category:e.category||Y,notes:typeof e.notes=="string"?e.notes:"",body:lt(e),urlPath:e.urlPath||Ft,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Dn(){try{localStorage.setItem("scheduledReminders",JSON.stringify(V))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=fi(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&sn(),$n(e,{requestCheck:t})}function Zt(e,{closeNotification:t=!0}={}){if(t){let n=Le.get(e);if(n){try{n.close()}catch{}Le.delete(e)}}Oe[e]&&(clearTimeout(Oe[e]),delete Oe[e]),Pe[e]&&(clearTimeout(Pe[e]),delete Pe[e]),Hn(e),V[e]&&(delete V[e],Dn())}function en(e){Zt(e)}function kn(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Le.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:lt(e),tag:e.id});Le.set(e.id,n);let i=()=>{Le.get(e.id)===n&&Le.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function Jr(e){if(!Ce())return!1;let t=Pi();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await Fe();if(!i)return!1;await Hn(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||Y,body:s,urlPath:Ft},s=lt(e),d={body:s,tag:e.id,data:o,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(c){return console.warn("Failed to schedule persistent notification",c),!1}}function Ue(e){if(!e||!e.id)return;if(e.category=q(e.category),!e.due||e.done){en(e.id);return}let t=V[e.id]||{},n={id:e.id,title:e.title,due:e.due,notifyAt:typeof e.notifyAt=="string"?e.notifyAt:null,category:e.category||Y,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:lt(e),urlPath:Ft,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let c=typeof t.due=="string"?t.due:null,p=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return c===e.due?p:null})()};if(V[e.id]=n,Dn(),Oe[e.id]&&(clearTimeout(Oe[e.id]),delete Oe[e.id]),Pe[e.id]&&(clearTimeout(Pe[e.id]),delete Pe[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=typeof e.notifyAt=="string"?new Date(e.notifyAt).getTime():NaN,s=i-Date.now();if(s<=0){if(V[e.id]?.viaTrigger){Zt(e.id,{closeNotification:!1});return}kn(e),Zt(e.id,{closeNotification:!1});return}let d=Ce();if(Number.isFinite(o)&&o>Date.now()&&o<i){let c=o-Date.now();Pe[e.id]=setTimeout(()=>{kn({...e,due:e.due||n.due})},c)}d&&(n.viaTrigger=!1,Jr(e).then(c=>{c&&V[e.id]&&(V[e.id]={...V[e.id],viaTrigger:!0},Dn())})),Oe[e.id]=setTimeout(()=>{d&&Hn(e.id),kn(e),Zt(e.id,{closeNotification:!1})},s)}function Ne(){Object.values(V).forEach(e=>Ue({...e,category:q(e?.category)}))}function pi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=Rr.format(t),i=Fr.format(t),o=Cn(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}let mi="__mcPinToggleHandler";var Nn=!1;function ut(e,t){e instanceof HTMLElement&&(e.classList.add("reminder-title-toggle"),e.classList.toggle(Se,t),e.classList.toggle(ae,!t),e.setAttribute("aria-pressed",t?"true":"false"))}function gi(e){if(!(e instanceof HTMLElement)||e[mi])return;e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||(e.tabIndex=0),e.classList.add("cursor-pointer");let t=async i=>{if(i?.defaultPrevented)return;i.stopPropagation(),typeof i?.preventDefault=="function"&&i.preventDefault();let o=i.currentTarget;if(!(o instanceof HTMLElement))return;let d=(typeof o.closest=="function"?o.closest("[data-reminder-item]"):null)?.dataset?.id;if(!d){ut(o,!1);return}let c=!o.classList.contains(Se);await Promise.resolve(qr(d,c)),ut(o,c)},n=i=>{i?.defaultPrevented||(i?.key==="Enter"||i?.key===" ")&&(i.preventDefault(),t(i))};e.addEventListener("click",t),e.addEventListener("keydown",n),e[mi]={click:t,keydown:n}}function Qr(){if(!S)return;let e=S.querySelectorAll('[data-role="reminder-today-toggle"]');e.length&&e.forEach(t=>{if(!(t instanceof HTMLElement))return;let i=(typeof t.closest=="function"?t.closest("[data-reminder-item]"):null)?.dataset?.id;if(!i){ut(t,!1),gi(t);return}let s=!!u.find(d=>d?.id===i)?.pinToToday;ut(t,s),gi(t)})}function yi(){if(!S||Nn)return;Nn=!0;let e=()=>{Nn=!1,Qr()};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(e):setTimeout(e,16)}function Zr(e,t){if(!e||typeof e!="object")return!1;if(e.pinToToday===!0)return!0;if(!e.due||!t||!t.start||!t.end)return!1;let n=new Date(e.due);return Number.isNaN(n.getTime())?!1:n>=t.start&&n<=t.end}function eo(e,t,n){return t!=="today"?e:Array.isArray(e)?e.filter(i=>Zr(i,n)):[]}function Rn(){if(ne!=="mobile"||typeof document>"u"||Rn._wired)return;let e=document.querySelectorAll("#view-reminders [data-reminders-tab]");if(!e.length)return;Rn._wired=!0;let t=()=>{e.forEach(n=>{let o=n.getAttribute("data-reminders-tab")===Ze;n.setAttribute("aria-pressed",o?"true":"false"),o?n.classList.add("reminders-tab-active"):n.classList.remove("reminders-tab-active")})};t(),We(),e.forEach(n=>{n.addEventListener("click",()=>{let i=n.getAttribute("data-reminders-tab");!i||i===Ze||(Ze=i,t(),Array.isArray(fn)&&U(),We())})})}function U(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let o={start:n,end:i};if(De(),de(u),Yn)try{Yn.textContent=String(u.length)}catch{}u.forEach(m=>{m&&typeof m=="object"&&(m.category=q(m.category))});let s=new Set(mo.map(m=>q(m)));u.forEach(m=>{m&&typeof m=="object"&&s.add(q(m.category))});let d=Array.from(s).sort((m,w)=>m.localeCompare(w,void 0,{sensitivity:"base"}));if(un){let m=new Set;Array.from(un.querySelectorAll("option")).forEach(w=>{m.add(w.value.trim().toLowerCase())}),d.forEach(w=>{let M=w.toLowerCase();if(!m.has(M)){let N=document.createElement("option");N.value=w,un.appendChild(N),m.add(M)}})}if(Me)Me=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let m=u.map(w=>({...w}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:m}}));else if(document.createEvent){let w=document.createEvent("CustomEvent");w&&w.initCustomEvent&&(w.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:m}),document.dispatchEvent(w))}}catch{}}let c=u.slice();de(c),ne==="mobile"&&(fn=c.slice(),c=eo(fn,Ze,o),We());let p=!0,f=u.length>0,b=c.length>0,C=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let m=Object.values(V||{}).filter(w=>w&&typeof w=="object"&&w.id);return new Set(m.map(w=>w.id))})();if(je)if(b)je.classList.add("hidden");else{let m=f?"No reminders to show right now.":pr;Zn?Zn(je,{icon:f?"sparkles":"bell",title:f?"Nothing to display":"Create your first cue",description:m,action:f?void 0:`<button type="button" class="${mr}" data-trigger="open-cue">Create reminder</button>`}):je.textContent=m,je.classList.remove("hidden")}if(Gn&&Gn.classList.toggle("has-items",b),!S)return;if(!b){je?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden")),yi();return}S.classList.remove("hidden"),S.replaceChildren();let I=document.createDocumentFragment(),j=S.tagName==="UL"||S.tagName==="OL",le=!0,v=["priority-high","priority-medium","priority-low"],h=(m,w)=>{if(!(m instanceof HTMLElement))return;m.classList.remove(...v);let M=typeof w=="string"?w.trim().toLowerCase():"";M.startsWith("h")?m.classList.add("priority-high"):M.startsWith("m")?m.classList.add("priority-medium"):M.startsWith("l")&&m.classList.add("priority-low")},x=(m,w="neutral")=>{let M=document.createElement("span");M.className="desktop-reminder-chip inline-flex max-w-full items-center gap-1 rounded-full border border-base-300/80 bg-base-200/80 px-2 py-[2px] text-[0.65rem] font-medium text-base-content/70",M.title=m,M.dataset.tone=w;let N=document.createElement("span");N.className="desktop-reminder-chip__dot h-1.5 w-1.5 rounded-full",w==="priority-high"?N.classList.add("bg-error"):w==="priority-medium"?N.classList.add("bg-warning"):w==="priority-low"?N.classList.add("bg-secondary"):w==="category"?N.classList.add("bg-primary"):N.classList.add("bg-base-content","opacity-40");let R=document.createElement("span");return R.className="truncate",R.textContent=m,M.append(N,R),M},O=(m,w,{elementTag:M,isMobile:N})=>{let R={id:m.id,title:m.title,dueIso:m.due||null,priority:m.priority||"Medium",category:w,done:!!m.done,pinToToday:m.pinToToday===!0},pt="reminder-item task-item reminder-card desktop-task-card grid w-full grid-cols-[minmax(0,1fr)_auto] items-start gap-3 rounded-xl border border-base-200 bg-base-100 p-4 text-sm shadow-sm transition hover:border-base-300 hover:bg-base-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60",io="reminder-item task-item reminder-card w-full bg-base-100 rounded-xl border border-base-200 border-l-4 shadow-sm p-4 mb-3 flex items-start justify-between gap-2 text-sm text-base-content transition hover:border-base-300 hover:bg-base-100 hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 active:scale-[.98]",A=document.createElement(M);A.className=N?io:pt,A.dataset.id=R.id,A.dataset.category=R.category,A.dataset.title=R.title;let bi=R.priority&&String(R.priority).trim();bi?A.dataset.priority=bi:delete A.dataset.priority,A.dataset.done=String(R.done),R.dueIso?A.dataset.due=R.dueIso:delete A.dataset.due,R.pinToToday?A.dataset.pinToToday="true":delete A.dataset.pinToToday,A.dataset.reminder=JSON.stringify(R),A.dataset.orderIndex=Number.isFinite(m.orderIndex)?String(m.orderIndex):"",A.dataset.reminderItem="true",A.dataset.compact="true",A.classList.add("reminder-draggable"),A.setAttribute("draggable","true"),A.setAttribute("role","button"),A.tabIndex=0,A.setAttribute("aria-label",`Edit reminder: ${m.title}`),h(A,R.priority),C.has(R.id)?A.dataset.notificationActive="true":delete A.dataset.notificationActive;let Bn=R.dueIso?new Date(R.dueIso):null;p&&Bn&&Bn>=n&&Bn<=i?(A.classList.add("is-today"),A.dataset.today="true"):(A.classList.remove("is-today"),delete A.dataset.today);let mt=document.createElement("div");mt.className="flex min-w-0 flex-1 flex-col gap-2",N&&mt.classList.add("text-sm","text-base-content");let be=document.createElement("p");if(be.className=N?"text-base font-semibold leading-tight text-base-content":"text-lg font-bold leading-snug text-base-content",be.classList.add("desktop-reminder-title"),N||be.classList.add("sm:text-[0.95rem]"),R.done&&be.classList.add("line-through","text-base-content/60"),N){be.dataset.reminderTitle="true",be.textContent="";let _=document.createElement("span");_.dataset.role="reminder-today-toggle",_.className="reminder-title-toggle cursor-pointer",_.setAttribute("role","button"),_.tabIndex=0,_.textContent=m.title,ut(_,R.pinToToday),be.appendChild(_)}else be.textContent=m.title;let tn=be;N&&(tn=document.createElement("div"),tn.className="reminder-title-slot",tn.appendChild(be)),mt.appendChild(tn);let gt=document.createElement("div");gt.className=N?"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-sm text-base-content/70":"desktop-reminder-meta reminder-meta flex flex-wrap items-center gap-1 text-xs text-base-content/70";let Mn=pi(m),wi=Mn&&Mn!=="No due date"?Mn:"";wi&&gt.appendChild(x(wi,"due")),!!(w&&w!==Y)&&gt.appendChild(x(w,"category")),gt.children.length&&mt.appendChild(gt),A.appendChild(mt);let Xe=document.createElement("div");Xe.className="task-toolbar flex items-start gap-1",Xe.setAttribute("role","toolbar"),Xe.setAttribute("aria-label","Reminder actions"),N&&Xe.classList.add("flex-shrink-0");let re=document.createElement("button");re.type="button",re.className="btn btn-ghost btn-circle btn-xs task-toolbar-btn reminder-icon-btn",R.done?(re.classList.add("text-base-content/60"),re.innerHTML=`
          <svg aria-hidden="true" viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg" focusable="false">
            <path d="M7 7v4h4" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <path d="M20.49 11A8.5 8.5 0 1 0 11 20.49" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>`,re.setAttribute("aria-label",`Mark reminder as active: ${m.title}`)):(re.classList.add("text-success"),re.innerHTML=`
          <svg aria-hidden="true" viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg" focusable="false">
            <path d="M4 12.5l4.5 4.5L20 6" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>`,re.setAttribute("aria-label",`Mark reminder as done: ${m.title}`)),re.setAttribute("aria-pressed",R.done?"true":"false"),re.setAttribute("data-reminder-control","toggle"),re.setAttribute("data-no-swipe","true"),re.addEventListener("click",_=>{_.preventDefault(),_.stopPropagation(),Gr(R.id)});let Ae=document.createElement("button");Ae.type="button",Ae.className="btn btn-ghost btn-circle btn-xs text-warning task-toolbar-btn reminder-icon-btn",Ae.innerHTML=`
        <svg aria-hidden="true" viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg" focusable="false">
          <path d="M2 9l4 5 5-6 5 6 4-5v8H2z" fill="currentColor"/>
          <path d="M7 7l3 2 3-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" fill="none" opacity="0.9"/>
        </svg>`,Ae.setAttribute("aria-label","Premium feature"),Ae.setAttribute("data-action","premium"),Ae.setAttribute("data-reminder-control","premium"),Ae.setAttribute("data-no-swipe","true"),Ae.addEventListener("click",_=>{_.preventDefault(),_.stopPropagation();try{E("Premium feature \u2014 upgrade to unlock")}catch{console.log("Premium feature clicked")}}),Xe.append(re,Ae),A.appendChild(Xe);let vi=()=>Wr(R.id);return A.addEventListener("click",_=>{if(_.defaultPrevented)return;let nn=_.target;nn&&typeof nn.closest=="function"&&nn.closest("[data-reminder-control]")||vi()}),A.addEventListener("keydown",_=>{_.defaultPrevented||_.target===A&&(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),vi())}),N&&Kr(A,()=>zr(R.id)),A},k=(m,w)=>O(m,w,{elementTag:"div",isMobile:!0});if(ne!=="desktop"&&!le){c.forEach(m=>{let w=m.category||Y;I.appendChild(k(m,w))}),S.appendChild(I);return}let he=new Map;c.forEach(m=>{let w=m.category||Y;he.has(w)||he.set(w,[]),he.get(w).push(m)});let Fn=Array.from(he.entries()).sort((m,w)=>m[0].localeCompare(w[0],void 0,{sensitivity:"base"})),ft=!0;Fn.forEach(([m,w])=>{if(m!==Y){let M=document.createElement(j?"li":"div");M.dataset.categoryHeading=m,j&&(M.setAttribute("role","presentation"),M.style.listStyle="none"),M.className=ne==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",ft||(M.style.marginTop=ne==="desktop"?"1.25rem":"1rem");let N=document.createElement("div");N.setAttribute("role","heading"),N.setAttribute("aria-level","3"),N.className=ne==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let R=document.createElement("span");R.textContent=m;let pt=document.createElement("span");pt.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",pt.textContent=`${w.length} ${w.length===1?"item":"items"}`,N.append(R,pt),M.appendChild(N),I.appendChild(M)}w.forEach(M=>{if(ne==="desktop"){let N=O(M,m,{elementTag:j?"li":"div",isMobile:!1});I.appendChild(N);return}I.appendChild(k(M,m))}),ft=!1}),S.appendChild(I),Vi(),yi()}function ye(){Je?.setAttribute("aria-expanded","false"),Qe?.classList.add("hidden")}function to(){Je?.setAttribute("aria-expanded","true"),Qe?.classList.remove("hidden")}Je?.addEventListener("click",e=>{e.stopPropagation(),Je.getAttribute("aria-expanded")==="true"?ye():to()}),document.addEventListener("click",e=>{Qe&&!Qe.classList.contains("hidden")&&!Qe.contains(e.target)&&e.target!==Je&&ye()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&ye()}),Zi.forEach(e=>{e.addEventListener("click",()=>{let t=kt?.classList.contains("hidden");kt?.classList.toggle("hidden"),t&&kt?.scrollIntoView({behavior:"smooth",block:"start"}),ye()})}),document.addEventListener("DOMContentLoaded",()=>{kt?.classList.add("hidden")});function hi(){try{console.log("handleSaveAction invoked",{editingId:Ge,title:y?.value})}catch{}let t=(typeof y?.value=="string"?y.value:"").trim(),n=typeof T?.value=="string"?T.value:"",i=typeof F?.value=="string"?F.value:"",o=typeof H?.value=="string"?H.value.trim():"";if(Ge){let f=u.find(I=>I.id===Ge);if(!f){_e();return}if(!t){E("Add a reminder title");return}let b=null;if(n||i){let I=n||Kt();b=ai(I,i||"09:00")}else{let I=Qt(t);I.time&&(b=new Date(`${I.date}T${I.time}:00`).toISOString())}f.title=t;let C=yn();f.priority=C,Nt(C),L&&(f.category=q(L.value)),f.due=b,B&&(f.notes=B.value.trim()),f.plannerLessonId=o||null,f.updatedAt=Date.now(),K(f),ct(f),Me=!0,U(),Ue(f),G(),Ve(),pe("memoryCue:remindersUpdated",{items:u}),ei(),me({action:"updated",label:`Reminder updated \xB7 ${f.title}`}),_e(),E("Reminder updated"),pe("cue:close",{reason:"updated"});return}if(!t){E("Add a reminder title");return}let s=B?B.value.trim():"",d=null;if(n||i){let f=n||Kt();d=ai(f,i||"09:00")}else{let f=Qt(t);f.time&&(d=new Date(`${f.date}T${f.time}:00`).toISOString())}let c=o?{lessonId:o,dayLabel:H?.dataset?.lessonDayLabel||"",lessonTitle:H?.dataset?.lessonTitle||"",summary:H?.dataset?.lessonSummary||""}:null,p=Vr({title:t,priority:yn(),category:L?L.value:"",due:d,notes:s,plannerLessonId:o||null});p&&(c?(E("Planner reminder created"),pe("planner:reminderCreated",{lessonId:c.lessonId,dayLabel:c.dayLabel,lessonTitle:c.lessonTitle,summary:c.summary,reminderId:p.id,reminderTitle:p.title,reminderDue:p.due||null})):E("Reminder created")),y&&(y.value=""),F&&(F.value=""),B&&(B.value=""),mn(),pe("cue:close",{reason:"created"})}y?.addEventListener("keydown",e=>{e.key==="Enter"&&hi()});function no(){if(!y||!Be)return;let e=y.value.trim();if(!e){Be.style.display="none";return}try{let t=Qt(e),n=Kt();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${di(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(Be.textContent=`Parsed: ${i}`,Be.style.display="block"):Be.style.display="none"}else Be.style.display="none"}catch{Be.style.display="none"}}if(y?.addEventListener("input",$r(no,300)),oe?.addEventListener("click",()=>{_e(),E("Edit cancelled"),pe("cue:close",{reason:"edit-cancelled"})}),Ui?.addEventListener("click",()=>{_e()}),document.addEventListener("cue:cancelled",()=>{_e()}),document.addEventListener("cue:prepare",()=>{_e()}),document.addEventListener("planner:prefillReminder",e=>{rr(e?.detail||{})}),window.addEventListener("load",()=>y?.focus()),Xi?.addEventListener("click",()=>{let e=u.filter(t=>!t.done).map(t=>{let n=t.due?di(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(qe,{hour:"2-digit",minute:"2-digit",timeZone:Ie}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){E("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>E("Copied for Master Task List")).catch(()=>E("Copy failed")),ye()}),ln?.addEventListener("change",()=>{let e=ln.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(s=>{let d={...s,id:zt(),category:q(s.category),pendingSync:!z,orderIndex:null};Tn(d,{position:"start"}),u=[d,...u],i.push(d)}),de(u);let o=st(u);U(),G(),o?u.forEach(s=>K(s)):i.forEach(s=>K(s)),E("Import successful")}catch{E("Invalid JSON")}},t.readAsText(e),ln.value="",ye()}),zi?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),ye()}),Ki?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){E("Add your Apps Script URL in Settings first"),ye();return}if(!u.length){E("No tasks to sync"),ye();return}E("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<u.length;i+=t){let o=u.slice(i,i+t),s=await Promise.allSettled(o.map(d=>{let c={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||Y,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}));n+=s.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}E(`Sync complete: ${u.length-n} ok${n?`, ${n} failed`:""}`),ye()}),He&&(He.value=localStorage.getItem("syncUrl")||""),Ji?.addEventListener("click",()=>{He&&(localStorage.setItem("syncUrl",He.value.trim()),E("Settings saved"))}),Qi?.addEventListener("click",async()=>{if(!He)return;let e=He.value.trim();if(!e){E("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});E(t.ok?"Test ok":"Test failed")}catch{E("Test failed")}}),qi?.addEventListener("click",async()=>{if(!("Notification"in window)){E("Notifications not supported");return}if(Notification.permission==="granted"){E("Notifications enabled"),Ce()?Fe():(sn(),ui()),Ne(),U();return}try{await Notification.requestPermission()==="granted"?(E("Notifications enabled"),Ce()?Fe():(sn(),ui()),Ne(),U()):E("Notifications blocked")}catch{E("Notifications blocked")}}),Rn(),ne==="mobile"){let e=()=>{try{nr()}catch(n){console.warn("fetchAndUpdateMobileTemperature failed",n)}},t=()=>{window.addEventListener("pointerdown",e,{passive:!0,once:!0}),window.addEventListener("touchstart",e,{passive:!0,once:!0}),window.addEventListener("click",e,{passive:!0,once:!0})};if(typeof navigator<"u"&&navigator.permissions&&typeof navigator.permissions.query=="function")try{navigator.permissions.query({name:"geolocation"}).then(n=>{n&&n.state==="granted"?e():t()}).catch(()=>t())}catch{t()}else t()}return Tr(),Ne(),U(),G(),{cancelReminder:en,scheduleReminder:Ue,closeActiveNotifications:_i,getActiveNotifications:()=>Le,addNoteToReminder:Yr,__testing:{setItems(e=[]){u=Array.isArray(e)?e.map(t=>({...t,category:q(t?.category)})):[],u=at(u),de(u),U()},render:U,getItems:()=>u.map(e=>({...e}))}}}var Fi,Le,Bi,On,Pn,Mi,an,St,_n,Y,mo,Un,we,go,ve,wo=Ei(()=>{xi();Fi="memoryCue:activity",Le=new Map,Bi=!1,On="service-worker.js",Pn="memory-cue-reminder-sync",Mi=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),an=null,St=null,_n=!1,Y="General",mo=Object.freeze([Y,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Un="memoryCue:offlineReminders",we=1024,go=Object.freeze({}),ve=null});export{Lo as a,xi as b,ko as c,wo as d};
