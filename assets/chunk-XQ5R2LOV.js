import{a as wi}from"./chunk-RCZ4YZVR.js";function hn(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{}}function bn(){let s=hn(),u=s&&s.TimestampTrigger;return typeof u=="function"?u:null}function X(){return typeof window>"u"||!("Notification"in window)||typeof navigator>"u"||!("serviceWorker"in navigator)||typeof ServiceWorkerRegistration>"u"||typeof ServiceWorkerRegistration.prototype?.showNotification!="function"?!1:!!bn()}function Ei(){if(typeof window>"u"||!window.location)return Bt;try{return new URL(Bt,window.location.href).href}catch{return Bt}}async function oe(){return gt||(typeof navigator>"u"||!("serviceWorker"in navigator)?null:(gt=(async()=>{try{return await navigator.serviceWorker.getRegistration()||await navigator.serviceWorker.register(Ei()),await navigator.serviceWorker.ready}catch(s){return console.warn("Service worker registration failed",s),null}})(),gt))}async function gn(s){if(!s||typeof s!="object"||typeof navigator>"u"||!navigator.serviceWorker)return!1;try{let u=await oe();if(!u)return!1;let E=new Set;navigator.serviceWorker.controller&&E.add(navigator.serviceWorker.controller),["active","waiting","installing"].forEach(R=>{let F=u[R];F&&E.add(F)});let v=!1;return E.forEach(R=>{try{R.postMessage(s),v=!0}catch(F){console.warn("Failed posting message to service worker",F)}}),v}catch(u){return console.warn("Unable to reach service worker",u),!1}}async function ht(){if(X())return!1;if(jt)return!0;if(typeof navigator>"u"||!navigator.serviceWorker||!("Notification"in window)||Notification.permission!=="granted")return!1;if(Oe)try{return await Oe}catch{}Oe=(async()=>{let s=await oe();if(!s)return!1;let u=!1;if("periodicSync"in s)try{let E=await s.periodicSync.getTags();(!Array.isArray(E)||!E.includes(Pt))&&await s.periodicSync.register(Pt,{minInterval:15*60*1e3}),u=!0}catch(E){console.warn("Periodic background sync unavailable",E)}if(!u&&"sync"in s)try{await s.sync.register(Pt),u=!0}catch(E){console.warn("Background sync unavailable",E)}return u})();try{let s=await Oe;return s&&(jt=!0),s}catch(s){return console.warn("Background reminder sync setup failed",s),jt=!1,!1}finally{Oe=null}}async function _t(s=[],{requestCheck:u=!1}={}){if(!X()&&!(typeof navigator>"u"||!navigator.serviceWorker))try{let E=await oe();if(!E)return;let v=await gn({type:yn.updateScheduledReminders,reminders:Array.isArray(s)?s:[]});if(u&&await gn({type:yn.checkScheduledReminders}),!v&&typeof E.update=="function")try{await E.update()}catch{}}catch(E){console.warn("Failed syncing reminders with service worker",E)}}async function Ht(s,u){if(X())try{let E=u||await oe();if(!E)return;let v=[];try{v=await E.getNotifications({tag:s,includeTriggered:!0})}catch{v=await E.getNotifications({tag:s})}for(let R of v)try{R.close()}catch{}}catch{}}function vn(){for(let s of Array.from(Z.values()))try{s.close()}catch{}Z.clear()}function Ii(){if(mn||typeof window>"u"||typeof window.addEventListener!="function")return;let s=()=>vn();["pagehide","beforeunload"].forEach(u=>{try{window.addEventListener(u,s)}catch{}}),mn=!0}function N(s){if(typeof s=="string"){let u=s.replace(/\s+/g," ").trim();if(u)return u}return O}async function Di(s={}){let u=e=>e?document.querySelector(e):null,E=e=>e?Array.from(document.querySelectorAll(e)):[],v=u(s.titleSel),R=u(s.dateSel),F=u(s.timeSel),V=u(s.detailsSel),re=u(s.prioritySel),x=u(s.categorySel),ve=u(s.saveBtnSel),bt=u(s.cancelEditBtnSel),S=u(s.listSel),$e=E(s.googleSignInBtnSel),Be=E(s.googleSignOutBtnSel),I=u(s.statusSel),L=u(s.syncStatusSel),wn={online:"Connected. Changes sync automatically.",offline:"Offline. Changes are saved on this device until you reconnect."},Sn=6e3,H=null;function fe(e,{clearMessage:t=!0}={}){H&&(e&&H.tokenId!==e||(H.timeoutId&&clearTimeout(H.timeoutId),t&&I&&I.dataset.undoToken===H.tokenId&&(typeof I.replaceChildren=="function"?I.replaceChildren():I.textContent="",delete I.dataset.undoToken,delete I.dataset.statusKind),H=null))}function En(e){if(!I)return;let t=document.createElement("span");t.textContent="Reminder deleted.";let n=document.createTextNode(" "),i=document.createElement("button");i.type="button",i.textContent="Undo",i.className="status-undo",i.addEventListener("click",()=>mi(e.tokenId)),e.button=i,typeof I.replaceChildren=="function"?I.replaceChildren(t,n,i):(I.textContent="",I.append(t,n,i)),I.dataset.statusKind="undo",I.dataset.undoToken=e.tokenId}function vt(e,t){if(!L)return;let n=["online","offline","error"];n.forEach(r=>L.classList.remove(r)),n.includes(e)&&L.classList.add(e),L.dataset.state=e;let i=typeof t=="string"?t:wn[e]||"";e==="online"||e==="offline"?(L.textContent="",L.dataset.compact="true",i?(L.setAttribute("aria-label",i),L.setAttribute("title",i)):(L.removeAttribute("aria-label"),L.removeAttribute("title"))):(L.textContent=i,L.removeAttribute("data-compact"),i?(L.setAttribute("aria-label",i),L.setAttribute("title",i)):(L.removeAttribute("aria-label"),L.removeAttribute("title")))}let $=u(s.notesSel),In=u(s.saveNotesBtnSel),An=u(s.loadNotesBtnSel),Wt=u(s.countTotalSel),Pe=u(s.googleUserNameSel),ae=u(s.dateFeedbackSel),j=u(s.voiceBtnSel),kn=u(s.notifBtnSel),we=u(s.moreBtnSel),Se=u(s.moreMenuSel),Ln=u(s.copyMtlBtnSel),wt=u(s.importFileSel),Dn=u(s.exportBtnSel),Tn=u(s.syncAllBtnSel),pe=u(s.syncUrlInputSel),xn=u(s.saveSettingsSel),Cn=u(s.testSyncSel),Nn=E(s.openSettingsSel),je=u(s.settingsSectionSel),me=u(s.emptyStateSel),qt=u(s.listWrapperSel),St=u(s.categoryOptionsSel),se=s.variant||"mobile",Vt="mc:lastDefaults";function Et(){if(typeof localStorage>"u")return{};try{return JSON.parse(localStorage.getItem(Vt)||"{}")||{}}catch{return{}}}function Rn(e={}){if(!(typeof localStorage>"u"))try{localStorage.setItem(Vt,JSON.stringify(e))}catch{}}function Gt(e){let t=Et(),n={category:N(e?.category||t.category||O),priority:e?.priority||t.priority||"Medium"};Rn(n)}let zt='fieldset#priorityChips input[name="priority"]';function It(){try{let e=document.querySelector(`${zt}:checked`);if(e&&e.value)return e.value}catch{}return re&&typeof re.value=="string"&&re.value?re.value:"Medium"}function Ue(e){let t=e||"Medium";re&&typeof re.value<"u"&&(re.value=t);try{let n=Array.from(document.querySelectorAll(zt));if(!n.length)return;let i=!1;if(n.forEach(o=>{let r=o.value===t;o.checked=r,i=i||r}),!i){let o=n.find(r=>r.value==="Medium")||n[0];o&&(o.checked=!0)}}catch{}}function Jt(){let e=Et();e.category&&x&&(x.value=e.category),e.priority&&Ue(e.priority)}Jt();let U=typeof document<"u"?document.getElementById("quickAddInput"):null,Fn=typeof document<"u"?document.getElementById("quickAddSubmit"):null,_=typeof document<"u"?document.getElementById("quickAddVoiceBtn"):null,At=null;function Mn(e,t){let n=Date.now(),i=Et(),o=typeof t=="string"&&t?t:null;return{id:at(),title:(e||"").trim(),priority:i.priority||It(),category:N(i.category||x?.value||O),notes:"",done:!1,createdAt:n,updatedAt:n,due:o,pendingSync:!B}}async function kt(){if(!U)return;if(typeof At=="function")try{At()}catch{}let e=(U.value||"").trim();if(!e)return;let t=null;try{let o=lt(e);o&&o.time&&(t=new Date(`${o.date}T${o.time}:00`).toISOString())}catch{t=null}let n=Mn(e,t);Tt(n,{position:"start"}),a.unshift(n),W(a);let i=Ce(a);ce=!0,k(),M(),i?a.forEach(o=>P(o)):P(n),Ne(n),ue(n),ie(),Gt(n),Ee();try{document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:a}}))}catch{}G({action:"created",label:`Reminder added \xB7 ${n.title}`}),U.value=""}typeof window<"u"&&(window.memoryCueQuickAddNow=kt),Fn?.addEventListener("click",()=>{kt()}),U?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),kt())});function On(){if(typeof HTMLElement>"u"||!(_ instanceof HTMLElement)||!(U instanceof HTMLInputElement)||_.dataset.voiceBound==="true")return;if(_.dataset.voiceBound="true",typeof window>"u"){_.setAttribute("disabled","true"),_.setAttribute("aria-disabled","true");return}let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof e!="function"){_.setAttribute("disabled","true"),_.setAttribute("aria-disabled","true"),_.getAttribute("title")||(_.title="Voice input is not supported in this browser.");return}let t=null,n=!1,i=d=>{n=d,_.setAttribute("aria-pressed",d?"true":"false"),_.dataset.listening=d?"true":"false",_.classList.toggle("is-listening",d)},o=()=>{if(t)return t;t=new e;let d=typeof document<"u"&&document.documentElement&&document.documentElement.lang||typeof navigator<"u"&&navigator.language||"en-US";t.lang=d,t.interimResults=!1,t.maxAlternatives=1,t.addEventListener("result",f=>{let m=f?.results?.[0]?.[0]?.transcript?.trim()||"";if(m){U.value=m;try{U.focus({preventScroll:!0})}catch{U.focus()}try{let g=U.value.length;typeof U.setSelectionRange=="function"&&U.setSelectionRange(g,g)}catch{}}});let c=()=>{i(!1)};return t.addEventListener("end",c),t.addEventListener("error",c),t},r=()=>{if(!(!n||!t)){try{t.stop()}catch{}i(!1)}};At=r,_.addEventListener("click",()=>{let d=o();if(d){if(n){r();return}try{d.start(),i(!0)}catch(c){console.warn("Quick add voice error:",c),i(!1)}}}),typeof window<"u"&&window.addEventListener("pagehide",r),i(!1)}On(),typeof window<"u"&&(window.memoryCueQuickAddShortcutsBound||(window.memoryCueQuickAddShortcutsBound=!0,window.addEventListener("keydown",e=>{e.target&&(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)||(e.key==="/"||e.key==="q"||e.key==="Q")&&U&&(e.preventDefault(),U.focus())})));try{se==="mobile"&&typeof document<"u"&&document.body.classList.add("show-full")}catch{}let $n=s.emptyStateInitialText||"Create your first reminder to keep important tasks in view.",Yt=typeof window<"u"&&typeof window.memoryCueMountEmptyState=="function"?window.memoryCueMountEmptyState:null,Bn=typeof window<"u"&&typeof window.memoryCueEmptyStateCtaClasses=="string"?window.memoryCueEmptyStateCtaClasses:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 dark:bg-emerald-500 dark:hover:bg-emerald-400",_e=s.reminderLandingPath||(se==="desktop"?"index.html#reminders":"mobile.html"),ee=(e,t={})=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))};function Kt(){if(typeof document>"u")return;let e=document.getElementById("createReminderSheet")||document.getElementById("create-sheet");if(!e)return;e.classList?.remove("open"),e.classList?.add("hidden"),e.setAttribute("hidden",""),e.setAttribute("aria-hidden","true"),e.removeAttribute("open");let t=e.querySelector(".sheet-backdrop, .backdrop");t instanceof HTMLElement&&(t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"));try{document.dispatchEvent(new CustomEvent("cue:close",{detail:{reason:"save"}}))}catch{}}function Ee(){try{document.dispatchEvent(new CustomEvent("reminders:updated",{detail:{items:a}}))}catch{}}x&&!x.value&&(x.value=O),X()&&oe();function G(e={}){if(!(typeof e.label=="string"?e.label.trim():""))return;let n={type:"reminder",target:{view:"reminders"},...e};n.target?typeof n.target=="string"?n.target={view:n.target}:typeof n.target=="object"&&n.target.view==null&&(n.target.view="reminders"):n.target={view:"reminders"},n.timestamp||(n.timestamp=new Date().toISOString());let i=!1;try{typeof window<"u"&&window.memoryCueActivity&&typeof window.memoryCueActivity.push=="function"&&(window.memoryCueActivity.push(n),i=!0)}catch{i=!1}if(!i){if(typeof window<"u"){let o=Array.isArray(window.memoryCueActivityQueue)?window.memoryCueActivityQueue:[];for(o.push(n);o.length>20;)o.shift();window.memoryCueActivityQueue=o}if(typeof document<"u"&&typeof document.dispatchEvent=="function")try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent(pn,{detail:n}));else if(document.createEvent){let o=document.createEvent("CustomEvent");o&&o.initCustomEvent&&(o.initCustomEvent(pn,!1,!1,n),document.dispatchEvent(o))}}catch{}}}function Pn(){if(typeof HTMLElement>"u"||!(j instanceof HTMLElement))return;let e=typeof HTMLInputElement<"u"&&v instanceof HTMLInputElement,t=typeof HTMLTextAreaElement<"u"&&v instanceof HTMLTextAreaElement;if(!e&&!t||j.dataset.voiceBound==="true")return;if(j.dataset.voiceBound="true",typeof window>"u"){j.setAttribute("disabled","true"),j.setAttribute("aria-disabled","true");return}let n=window.SpeechRecognition||window.webkitSpeechRecognition;if(typeof n!="function"){j.setAttribute("disabled","true"),j.setAttribute("aria-disabled","true"),j.getAttribute("title")||(j.title="Voice input is not supported in this browser.");return}let i=null,o=!1,r=m=>{o=m,j.setAttribute("aria-pressed",m?"true":"false"),j.dataset.listening=m?"true":"false",j.classList.toggle("is-listening",m)},d=()=>{if(i)return i;i=new n,i.lang="en-US",i.interimResults=!1,i.maxAlternatives=1,i.addEventListener("result",g=>{let w=g.results?.[0]?.[0]?.transcript?.trim()||"";if(w){v.value=w;try{v.focus({preventScroll:!0})}catch{try{v.focus()}catch{}}try{let A=v.value.length;typeof v.setSelectionRange=="function"&&v.setSelectionRange(A,A)}catch{}G({action:"dictated",label:`Voice input captured \xB7 ${w}`})}});let m=()=>{r(!1)};return i.addEventListener("end",m),i.addEventListener("error",m),i},c=()=>{if(!(!o||!i)){try{i.stop()}catch{}r(!1)}};j.addEventListener("click",()=>{let m=d();if(m){if(o){c();return}try{m.start(),r(!0)}catch(g){console.warn("Speech recognition error:",g),r(!1)}}});let f=()=>{c()};typeof document<"u"&&(document.addEventListener("cue:close",f),document.addEventListener("reminders:updated",f)),r(!1)}Ii(),Pn();let He,We,qe,Ve,ye,Ge,ze,Je,Ye,Ke,Qe,Ie,Ae,Ze,Xe,et,tt,nt,it,Qt=s.firebaseDeps,Lt=typeof s.importModule=="function"?s.importModule:e=>import(e),ke=hn(),Le=!1,z=!1,Dt=null,K=null,de=null,a=[],ce=!1,B=null,De=null,Te=null,le={},D={};function W(e=a){Array.isArray(e)&&e.sort((t,n)=>{let i=Number.isFinite(t?.orderIndex)?t.orderIndex:-1/0,o=Number.isFinite(n?.orderIndex)?n.orderIndex:-1/0;return i===o?on(t||{},n||{}):o-i})}function jn(e=a){if(!Array.isArray(e)||e.length===0)return{min:0,max:0};let t=1/0,n=-1/0;return e.forEach(i=>{let o=Number.isFinite(i?.orderIndex)?i.orderIndex:null;o!=null&&(o<t&&(t=o),o>n&&(n=o))}),t===1/0&&(t=0),n===-1/0&&(n=0),{min:t,max:n}}function xe(e=a){if(!Array.isArray(e)||e.length===0)return Array.isArray(e)?e:[];let t=e.every(i=>Number.isFinite(i?.orderIndex)),n;if(t)n=e.slice(),W(n);else{n=e.slice().sort(on);let i=n.length;n.forEach((o,r)=>{o.orderIndex=(i-r)*Y})}return e===a&&(a=n),n}function Tt(e,{position:t="start"}={}){if(!e||typeof e!="object")return;let{min:n,max:i}=jn();if(t==="end"){let o=Number.isFinite(n)?n:0;e.orderIndex=o-Y||Y}else{let o=Number.isFinite(i)?i:0;e.orderIndex=o+Y||Y}}function Ce(e=a){if(!Array.isArray(e)||e.length<2)return!1;W(e);let t=!1;for(let n=1;n<e.length;n+=1){let i=e[n-1],o=e[n],r=Number.isFinite(i?.orderIndex)?i.orderIndex:null,d=Number.isFinite(o?.orderIndex)?o.orderIndex:null;if(r==null||d==null||r<=d||r-d<1){t=!0;break}}if(!t)return!1;for(let n=0;n<e.length;n+=1)e[n].orderIndex=(e.length-n)*Y;return e===a&&W(a),!0}let T={draggingId:null,dropTargetId:null,dropBefore:!0},Zt=!1;function ot(e){return!e||typeof e.closest!="function"?null:e.closest("[data-reminder-item]")}function ge(){S&&(S.querySelectorAll(".drag-over-before, .drag-over-after").forEach(e=>{e.classList.remove("drag-over-before","drag-over-after")}),S.classList.remove("drag-over-list"))}function Xt(){if(!S)return;let e=S.querySelector(".is-dragging");e&&e.classList.remove("is-dragging"),ge(),T.draggingId=null,T.dropTargetId=null,T.dropBefore=!0}function Un(e,t,n){if(!e||e===t)return;let i=a.findIndex(A=>A?.id===e);if(i<0)return;let[o]=a.splice(i,1),r;if(!t)r=a.length;else{let A=a.findIndex(q=>q?.id===t);if(A<0){a.splice(i,0,o);return}r=n?A:A+1}a.splice(r,0,o);let d=a[r-1],c=a[r+1],f=Number.isFinite(d?.orderIndex)?d.orderIndex:null,m=Number.isFinite(c?.orderIndex)?c.orderIndex:null,g;f!=null&&m!=null?g=(f+m)/2:f!=null?g=f-Y:m!=null?g=m+Y:g=Y,Number.isFinite(g)||(g=Y*(a.length+1)),o.orderIndex=g,W(a);let w=Ce(a);ce=!0,k(),M(),w?a.forEach(A=>P(A)):P(o),Ee(),ee("memoryCue:remindersUpdated",{items:a}),G({action:"reordered",label:"Reminders reordered"})}function _n(e){let t=ot(e.target);if(!t)return;let n=e.target?.closest("button, a, input, textarea, label");if(n&&n!==t){e.preventDefault();return}let i=t.dataset.id;if(i&&(T.draggingId=i,T.dropTargetId=null,T.dropBefore=!0,t.classList.add("is-dragging"),e.dataTransfer))try{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i)}catch{}}function Hn(e){if(!T.draggingId)return;let t=ot(e.target);if(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!t){e.preventDefault(),T.dropTargetId=null,T.dropBefore=!1,ge(),S?.classList.add("drag-over-list");return}if(t.dataset.id===T.draggingId){e.preventDefault(),ge();return}e.preventDefault();let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=e.clientY<i;(T.dropTargetId!==t.dataset.id||T.dropBefore!==o)&&(ge(),t.classList.add(o?"drag-over-before":"drag-over-after"),T.dropTargetId=t.dataset.id,T.dropBefore=o)}function Wn(e){let t=ot(e.target);if(!t){S?.contains(e.relatedTarget)||ge();return}e.relatedTarget&&t.contains(e.relatedTarget)||(t.classList.remove("drag-over-before","drag-over-after"),S?.contains(e.relatedTarget)||S?.classList.remove("drag-over-list"))}function qn(e){if(!T.draggingId)return;e.preventDefault();let t=ot(e.target),n=t?.dataset.id||null,i=T.dropBefore;if(t){let o=t.getBoundingClientRect(),r=o.top+o.height/2;i=e.clientY<r}else n=null,i=!1;Un(T.draggingId,n,i),Xt()}function Vn(){Xt()}function Gn(){!S||Zt||(Zt=!0,S.addEventListener("dragstart",_n),S.addEventListener("dragover",Hn),S.addEventListener("drop",qn),S.addEventListener("dragend",Vn),S.addEventListener("dragleave",Wn))}function en(){B=null,vt("offline"),$e.forEach(e=>e.classList.remove("hidden")),Be.forEach(e=>e.classList.add("hidden")),Pe&&(Pe.textContent=""),De?.(),De=null,Ct(),k(),M(),ie()}function xt(){if(typeof localStorage>"u")return[];try{let e=localStorage.getItem(Ut);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>{if(!n||typeof n!="object")return null;let i=Number.isFinite(n.createdAt)?n.createdAt:Date.now(),o=Number.isFinite(n.updatedAt)?n.updatedAt:i,r=Number(n.orderIndex);return{id:typeof n.id=="string"&&n.id?n.id:at(),title:typeof n.title=="string"?n.title:"",priority:n.priority||"Medium",category:N(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:i,updatedAt:o,due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(r)?r:null}}).filter(Boolean):[]}catch(e){return console.warn("Failed to load offline reminders",e),[]}}function zn(e=[]){if(!(typeof localStorage>"u"))try{if(!Array.isArray(e)||e.length===0){localStorage.removeItem(Ut);return}let t=e.filter(n=>n&&typeof n=="object").map(n=>({id:n.id,title:n.title,priority:n.priority||"Medium",category:N(n.category),notes:typeof n.notes=="string"?n.notes:"",done:!!n.done,createdAt:Number.isFinite(n.createdAt)?n.createdAt:Date.now(),updatedAt:Number.isFinite(n.updatedAt)?n.updatedAt:Date.now(),due:typeof n.due=="string"&&n.due?n.due:null,pendingSync:!!n.pendingSync,orderIndex:Number.isFinite(n.orderIndex)?n.orderIndex:null}));localStorage.setItem(Ut,JSON.stringify(t))}catch(t){console.warn("Failed to persist offline reminders",t)}}function M(){W(a),zn(a)}function Ct(){a=xe(xt())}Ct();async function Jn(){if(!B){a=xt();return}let e=xe(xt());if(!e.length){a=[],M();return}let t=e.filter(n=>n?.pendingSync);if(t.length)for(let n of t)try{await P(n),n.pendingSync=!1}catch(i){console.warn("Failed to sync offline reminder",i)}a=xe(e.map(n=>({...n,pendingSync:!1}))),M(),k(),ie()}try{D=JSON.parse(localStorage.getItem("scheduledReminders")||"{}")}catch{D={}}if(D&&typeof D=="object"&&Object.values(D).forEach(e=>{e&&typeof e=="object"&&(e.category=N(e.category),e.priority=e.priority||"Medium",e.notes=typeof e.notes=="string"?e.notes:"",e.body=typeof e.body=="string"&&e.body?e.body:Fe(e),e.urlPath=e.urlPath||_e,Number.isFinite(e.updatedAt)||(e.updatedAt=Date.now()),Number.isFinite(e.notifiedAt)||(e.notifiedAt=null))}),!X()){let e=cn();typeof Notification<"u"&&Notification.permission==="granted"?(ht(),e.length&&_t(e,{requestCheck:!0})):e.length&&_t(e)}let rt=e=>{if(!ke)return;let t=[ke];ke.window&&!t.includes(ke.window)&&t.push(ke.window);let n=!e;t.forEach(i=>{try{i.__memoryCueFirebaseUnavailable__=n}catch{}})};function Yn(){if(!$)return;let e=document.getElementById("notesToolbar"),t=e?.querySelector('[data-action="columns"]'),n="mobileNotes",i="mobileNotesColumns",o=typeof document<"u"&&typeof document.execCommand=="function",r=()=>"value"in $?$.value:$.innerHTML,d=g=>{if("value"in $){$.value=g;return}if(typeof g!="string"||g.length===0){$.innerHTML="";return}let w=g.trim();if(/<\/?[a-z][\s\S]*>/i.test(w)){$.innerHTML=g;return}let q=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");$.innerHTML=q},c=g=>{g?$.classList.add("notes-editor--columns"):$.classList.remove("notes-editor--columns"),t&&t.setAttribute("aria-pressed",String(!!g))},f="";try{f=localStorage.getItem(n)||""}catch{y("Unable to access saved notes")}d(f);let m=!1;try{m=localStorage.getItem(i)==="1"}catch{m=!1}c(m),$.addEventListener("input",()=>{f=r();try{localStorage.setItem(n,f)}catch{y("Notes saved for this session only")}}),In?.addEventListener("click",()=>{f=r();try{localStorage.setItem(n,f),y("Notes saved")}catch{y("Notes saved for this session only")}}),An?.addEventListener("click",()=>{let g=f;try{g=localStorage.getItem(n)||f}catch{y("Unable to load saved notes")}f=g,d(f)}),e?.addEventListener("click",g=>{let w=g.target;if(!(w instanceof Element))return;let A=w.closest("button[data-action]");if(!A)return;let q=A.getAttribute("data-action");if(q==="columns"){let Me=!$.classList.contains("notes-editor--columns");c(Me);try{localStorage.setItem(i,Me?"1":"0")}catch{y("Column preference saved for this session only")}return}if(!o){y("Formatting controls are not supported in this browser");return}$.focus(),q==="bullets"?document.execCommand("insertUnorderedList"):q==="numbers"&&document.execCommand("insertOrderedList")})}if(Yn(),ve?.addEventListener("click",un),Qt)({initializeApp:He,getFirestore:We,enableMultiTabIndexedDbPersistence:qe,enableIndexedDbPersistence:Ve,doc:ye,setDoc:Ge,deleteDoc:ze,onSnapshot:Je,collection:Ye,query:Ke,orderBy:Qe,serverTimestamp:Ie,getAuth:Ae,onAuthStateChanged:Ze,GoogleAuthProvider:Xe,signInWithPopup:et,signInWithRedirect:tt,getRedirectResult:nt,signOut:it}=Qt),Le=!0;else try{({initializeApp:He}=await Lt("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js")),{getFirestore:We,enableMultiTabIndexedDbPersistence:qe,enableIndexedDbPersistence:Ve,doc:ye,setDoc:Ge,deleteDoc:ze,onSnapshot:Je,collection:Ye,query:Ke,orderBy:Qe,serverTimestamp:Ie}=await Lt("https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"),{getAuth:Ae,onAuthStateChanged:Ze,GoogleAuthProvider:Xe,signInWithPopup:et,signInWithRedirect:tt,getRedirectResult:nt,signOut:it}=await Lt("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js"),Le=!0}catch(e){Le=!1,console.warn("Firebase modules failed to load:",e),y("Firebase failed to load; notes available offline"),rt(!1)}if(Le&&typeof He=="function"&&typeof We=="function"&&typeof Ae=="function")try{Dt=He({apiKey:"AIzaSyAmAMiz0zG3dAhZJhOy1DYj8fKVDObL36c",authDomain:"memory-cue-app.firebaseapp.com",projectId:"memory-cue-app",storageBucket:"memory-cue-app.firebasestorage.app",messagingSenderId:"751284466633",appId:"1:751284466633:web:3b10742970bef1a5d5ee18",measurementId:"G-R0V4M7VCE6"}),K=We(Dt),z=!0,rt(!0)}catch(e){z=!1,console.warn("Firebase initialization failed:",e),y("Firebase failed to load; notes available offline"),rt(!1)}else Le?(z=!1,rt(!1)):z=!1;z&&typeof qe=="function"&&typeof Ve=="function"&&function(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null;t&&(t.__persistenceInitialized__||(t.__persistenceInitialized__=!0,(async()=>{try{await qe(K),console.info("[Firestore] Persistence: multi-tab enabled")}catch(n){if(n&&n.code==="failed-precondition")try{await Ve(K),console.info("[Firestore] Persistence: single-tab fallback enabled")}catch(i){console.warn("[Firestore] Persistence disabled (single-tab fallback failed):",i?.code||i)}else n&&n.code==="unimplemented"?console.warn("[Firestore] Persistence not supported in this browser (online-only)."):console.warn("[Firestore] Persistence initialization error:",n?.code||n)}})()))}(),z&&typeof Ae=="function"&&(de=Ae(Dt));function Kn(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.indexOf("@");n>=0&&(t=t.slice(0,n)),t=t.replace(/_/g,"-");try{return new Intl.DateTimeFormat(t),t}catch{return""}}let Qn=typeof navigator<"u"&&navigator.language?navigator.language:"",tn=Kn(Qn),he=tn||"en-US",Q="UTC";try{let e=new Intl.DateTimeFormat().resolvedOptions();e.timeZone&&(Q=e.timeZone),!tn&&e.locale&&(he=e.locale)}catch{}let Zn=new Intl.DateTimeFormat(he,{timeZone:Q,hour:"2-digit",minute:"2-digit"}),Xn=new Intl.DateTimeFormat(he,{timeZone:Q,weekday:"long",day:"numeric",month:"long"}),ei=new Intl.DateTimeFormat("en-CA",{timeZone:Q,year:"numeric",month:"2-digit",day:"2-digit"}),ti=new Intl.DateTimeFormat(he,{timeZone:Q,weekday:"long"}),ni=new Intl.DateTimeFormat(he,{timeZone:Q,month:"short",day:"numeric"});function te(e){let t=ei.formatToParts(e),n=t.find(r=>r.type==="year").value,i=t.find(r=>r.type==="month").value,o=t.find(r=>r.type==="day").value;return`${n}-${i}-${o}`}function nn(e,t){let[n,i,o]=e.split("-").map(f=>parseInt(f,10)),[r,d]=t.split(":").map(f=>parseInt(f,10)),c=new Date;return c.setFullYear(n,(i||1)-1,o||1),c.setHours(r||0,d||0,0,0),c.toISOString()}let ii=new Intl.DateTimeFormat("en-CA",{timeZone:Q,year:"numeric",month:"2-digit",day:"2-digit"}),oi=new Intl.DateTimeFormat("en-CA",{timeZone:Q,hour:"2-digit",minute:"2-digit",hour12:!1});function ri(e){try{let t=new Date(e),n=ii.formatToParts(t),i=n.find(d=>d.type==="year")?.value||"0000",o=n.find(d=>d.type==="month")?.value||"00",r=n.find(d=>d.type==="day")?.value||"00";return`${i}-${o}-${r}`}catch{return""}}function ai(e){try{let t=new Date(e),n=oi.formatToParts(t),i=n.find(r=>r.type==="hour")?.value?.padStart(2,"0")||"00",o=n.find(r=>r.type==="minute")?.value?.padStart(2,"0")||"00";return`${i}:${o}`}catch{return""}}function at(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}function st(){return te(new Date)}function si(e){let t=new Date(e),n=(t.getDay()+6)%7;return t.setDate(t.getDate()-n),t.setHours(0,0,0,0),t}function ki(e){let t=si(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function dt(e){return e==="High"?3:e==="Medium"?2:1}function on(e,t){let n=e?.done?1:0,i=t?.done?1:0;if(n!==i)return n-i;let o=e?.due?new Date(e.due).getTime():1/0,r=t?.due?new Date(t.due).getTime():1/0;if(o!==r)return o-r;let d=dt(t?.priority)-dt(e?.priority);return d||(t?.updatedAt||0)-(e?.updatedAt||0)}function Li(e,t){let n=dt(t.priority)-dt(e.priority);if(n)return n;let i=+new Date(e.due||0),o=+new Date(t.due||0);return i!==o?i-o:(e.updatedAt||0)>(t.updatedAt||0)?-1:1}function Nt(e){if(!e)return"\u2014";try{let t=new Date(e+"T00:00:00");return Xn.format(t)}catch{return e}}function ct(e){return Zn.format(e)}function ne(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function rn(e){return e?ne(e).replace(/\r\n/g,`
`).replace(/\n/g,"<br>"):""}function y(e){I&&(fe(),I.dataset.statusKind="toast",I.textContent=e,clearTimeout(y._t),y._t=setTimeout(()=>{I&&I.dataset.statusKind==="toast"&&(I.textContent="",delete I.dataset.statusKind)},2500))}function di(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function lt(e){e=String(e||"").toLowerCase();let t={date:st(),time:""},n=c=>{let f=new Date,m=f.getDay(),g=(c-m+7)%7,w=new Date(f);return w.setDate(f.getDate()+(g===0?7:g)),w},i=c=>{let f=new Date,m=f.getDay(),g=(c-m+7)%7,w=new Date(f);return w.setDate(f.getDate()+g),w},o={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thur:4,thurs:4,friday:5,fri:5,saturday:6,sat:6},r={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,sept:8,october:9,oct:9,november:10,nov:10,december:11,dec:11};if(/\btomorrow\b/.test(e)){let c=new Date;c.setDate(c.getDate()+1),t.date=te(c)}else if(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bnext\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[c[1]],m=n(f);t.date=te(m)}else if(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\bthis\s+(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[c[1]],m=i(f);t.date=te(m)}else if(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/.test(e)){let c=e.match(/\b(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|tues|wed|thu|thur|thurs|fri|sat)\b/),f=o[c[1]],m=n(f);t.date=te(m)}else if(/\bin\s+(\d+)\s+days?\b/.test(e)){let c=e.match(/\bin\s+(\d+)\s+days?\b/),f=parseInt(c[1],10),m=new Date;m.setDate(m.getDate()+f),t.date=te(m)}else if(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/.test(e)){let c=e.match(/\b(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\b/),f=parseInt(c[1],10),m=parseInt(c[2],10)-1,g=c[3]?parseInt(c[3],10):new Date().getFullYear(),w=new Date(g,m,f);t.date=te(w)}else for(let[c,f]of Object.entries(r)){let m=new RegExp(`\\b${c}\\s+(\\d{1,2})(?:st|nd|rd|th)?`,"i");if(m.test(e)){let g=e.match(m),w=parseInt(g[1],10),A=new Date().getFullYear(),q=new Date(A,f,w);t.date=te(q);break}}let d=e.match(/(\d{1,2})(?:[:\.](\d{2}))?\s*(am|pm)?/);if(d){let c=parseInt(d[1],10),f=d[2]?parseInt(d[2],10):0,m=d[3];m&&(m==="pm"&&c<12&&(c+=12),m==="am"&&c===12&&(c=0)),t.time=`${String(c).padStart(2,"0")}:${String(f).padStart(2,"0")}`}return t}let ut=z&&de&&typeof Xe=="function";if($e.length){let e=async()=>{if(!ut||typeof et!="function"||typeof tt!="function"){y("Sign-in unavailable offline");return}let t=new Xe;try{await et(de,t)}catch{try{await tt(de,t)}catch{y("Google sign-in failed")}}};$e.forEach(t=>{t.addEventListener("click",e)})}if(ut&&typeof nt=="function"&&nt(de).catch(()=>{}),Be.length){let e=async()=>{if(!ut||typeof it!="function"){y("Sign-out unavailable offline");return}try{await it(de),y("Signed out")}catch{y("Sign-out failed")}};Be.forEach(t=>{t.addEventListener("click",e)})}ut&&typeof Ze=="function"?Ze(de,async e=>{e?(B=e.uid,vt("online"),$e.forEach(t=>t.classList.add("hidden")),Be.forEach(t=>t.classList.remove("hidden")),Pe&&(Pe.textContent=e.displayName||e.email||""),ci(),await Jn()):en()}):en();function ci(){if(!z||!K||typeof Ye!="function"||typeof Ke!="function"||typeof Qe!="function"||typeof Je!="function")return;if(!B){Ct(),k(),M(),ie();return}De&&De();let e=Ye(K,"users",B,"reminders"),t=Ke(e,Qe("updatedAt","desc"));De=Je(t,n=>{let i=[];n.forEach(o=>{let r=o.data(),d=Number(r.orderIndex);i.push({id:o.id,title:r.title,priority:r.priority,notes:r.notes||"",done:!!r.done,due:r.due||null,category:N(r.category),createdAt:r.createdAt?.toMillis?.()||0,updatedAt:r.updatedAt?.toMillis?.()||0,pendingSync:!1,orderIndex:Number.isFinite(d)?d:null})}),a=xe(i),k(),M(),ie()},n=>{console.error("Firestore sync error:",n),L&&vt("error","Sync Error")})}async function P(e){if(!(!z||!B||!K||typeof ye!="function"||typeof Ge!="function"||typeof Ie!="function"))try{await Ge(ye(K,"users",B,"reminders",e.id),{title:e.title,priority:e.priority,notes:e.notes||"",done:!!e.done,due:e.due||null,category:e.category||O,orderIndex:Number.isFinite(e.orderIndex)?e.orderIndex:null,createdAt:e.createdAt?new Date(e.createdAt):Ie(),updatedAt:Ie()},{merge:!0})}catch(t){console.error("Save failed:",t),y("Save queued (offline)")}}async function li(e){if(!(!z||!B||!K||typeof ye!="function"||typeof ze!="function"))try{await ze(ye(K,"users",B,"reminders",e))}catch{y("Delete queued (offline)")}}async function Ne(e){let t=(localStorage.getItem("syncUrl")||"").trim();if(!t)return;let n={id:e.id,title:e.title,dueIso:e.due||null,priority:e.priority||"Medium",category:e.category||O,done:!!e.done,source:"memory-cue-mobile"};try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch{}}function Re(){v&&(v.value=""),R&&(R.value=""),F&&(F.value=""),V&&(V.value=""),Ue("Medium"),x&&(x.value=O),Jt(),Te=null,ve&&(ve.textContent="Save Cue"),bt?.classList.add("hidden")}function an(e){let t=a.find(n=>n.id===e);t&&(v&&(v.value=t.title||""),R&&F&&(t.due?(R.value=ri(t.due),F.value=ai(t.due)):(R.value="",F.value="")),Ue(t?.priority||"Medium"),x&&(x.value=N(t.category)),V&&(V.value=typeof t.notes=="string"?t.notes:""),Te=e,ve&&(ve.textContent="Update Cue"),bt?.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),v?.focus(),ee("cue:open",{mode:"edit"}))}function ui(e){let t=Date.now(),n=e.notes==null?"":typeof e.notes=="string"?e.notes.trim():String(e.notes).trim(),i=N(e.category??(x?x.value:"")),o={id:at(),title:e.title.trim(),priority:e.priority||"Medium",category:i,notes:n,done:!1,createdAt:t,updatedAt:t,due:e.due||null,pendingSync:!B};Tt(o,{position:"start"}),a=[o,...a],W(a);let r=Ce(a);return ce=!0,k(),M(),Gt(o),r?a.forEach(d=>P(d)):P(o),Ne(o),ue(o),Ee(),ee("memoryCue:remindersUpdated",{items:a}),Kt(),G({action:"created",label:`Reminder added \xB7 ${o.title}`}),o}function fi(e,t){if(!B)return y("Sign in to add notes"),null;if(!e)return null;let n=a.find(d=>d.id===e);if(!n)return null;let o=(t==null?"":typeof t=="string"?t:String(t)).trim();if(!o)return n;let r=typeof n.notes=="string"?n.notes:"";return n.notes=r?`${r}
${o}`:o,n.updatedAt=Date.now(),P(n),k(),M(),G({action:"updated",label:`Reminder notes updated \xB7 ${n.title}`}),n}function pi(e){let t=a.find(n=>n.id===e);t&&(t.done=!t.done,t.updatedAt=Date.now(),P(t),Ne(t),k(),M(),t.done?(pt(e),G({action:"completed",label:`Reminder completed \xB7 ${t.title}`})):(ue(t),G({action:"reopened",label:`Reminder reopened \xB7 ${t.title}`})))}function mi(e){if(!H||H.tokenId!==e)return;let{item:t,index:n}=H;if(!t){fe(e);return}fe(e);let i=Number.isInteger(n)?Math.min(Math.max(n,0),a.length):a.length;t.pendingSync=!B,t.updatedAt=Date.now(),a.splice(i,0,t),W(a);let o=Ce(a);ce=!0,k(),M(),ue(t),o?a.forEach(r=>P(r)):P(t),Ne(t),Ee(),ee("memoryCue:remindersUpdated",{items:a}),G({action:"restored",label:`Reminder restored \xB7 ${t.title}`}),y("Reminder restored")}function sn(e){let t=a.findIndex(o=>o.id===e),n=t>=0?a.splice(t,1)[0]:null;k(),M(),li(e),pt(e);let i=n?`Reminder removed \xB7 ${n.title}`:"Reminder removed";if(G({action:"deleted",label:i}),n&&I){fe();let o=`undo-${Date.now()}-${Math.random().toString(36).slice(2)}`;H={tokenId:o,item:n,index:t,timeoutId:null},En(H),H.timeoutId=setTimeout(()=>{fe(o)},Sn)}else n&&fe()}function Fe(e){if(!e)return"Due now";let n=(typeof e.notes=="string"?e.notes:"").split(/\r?\n/).map(i=>i.trim()).find(Boolean);if(n){if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=ct(i);if(o)return`${n} \u2022 ${o}`}}catch{}return n}if(e.due)try{let i=new Date(e.due);if(!Number.isNaN(i.getTime())){let o=ct(i);if(o)return`Due ${o}`}}catch{}return"Due now"}function dn(){try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||typeof navigator<"u"&&navigator.standalone)return}catch{}y("Tip: Add Memory Cue to your home screen so reminders can run in the background.")}function cn(){return Object.values(D||{}).filter(e=>e&&typeof e=="object"&&e.id).map(e=>({id:e.id,title:typeof e.title=="string"?e.title:"",due:typeof e.due=="string"?e.due:null,priority:e.priority||"Medium",category:e.category||O,notes:typeof e.notes=="string"?e.notes:"",body:Fe(e),urlPath:e.urlPath||_e,updatedAt:Number.isFinite(e.updatedAt)?e.updatedAt:Date.now(),notifiedAt:Number.isFinite(e.notifiedAt)?e.notifiedAt:null}))}function Rt(){try{localStorage.setItem("scheduledReminders",JSON.stringify(D))}catch(n){console.warn("Failed to persist scheduled reminders",n)}let e=cn(),t=typeof Notification<"u"&&Notification.permission==="granted";t&&ht(),_t(e,{requestCheck:t})}function ft(e,{closeNotification:t=!0}={}){if(t){let n=Z.get(e);if(n){try{n.close()}catch{}Z.delete(e)}}le[e]&&(clearTimeout(le[e]),delete le[e]),Ht(e),D[e]&&(delete D[e],Rt())}function pt(e){ft(e)}function ln(e){if(!(!e||!e.id||!("Notification"in window)))try{let t=Z.get(e.id);if(t&&typeof t.close=="function")try{t.close()}catch{}let n=new Notification(e.title,{body:Fe(e),tag:e.id});Z.set(e.id,n);let i=()=>{Z.get(e.id)===n&&Z.delete(e.id)};typeof n.addEventListener=="function"&&(n.addEventListener("close",i),n.addEventListener("click",i)),n.onclose=i,n.onclick=i}catch{}}async function yi(e){if(!X())return!1;let t=bn();if(!t||!e?.due)return!1;let n=new Date(e.due).getTime();if(!Number.isFinite(n))return!1;let i=await oe();if(!i)return!1;await Ht(e.id,i);let o={id:e.id,title:e.title,due:e.due,priority:e.priority||"Medium",category:e.category||O,body:r,urlPath:_e},r=Fe(e),d={body:r,tag:e.id,data:o,renotify:!0};n>Date.now()&&(d.showTrigger=new t(n));try{return await i.showNotification(e.title,d),!0}catch(c){return console.warn("Failed to schedule persistent notification",c),!1}}function ue(e){if(!e||!e.id)return;if(e.category=N(e.category),!e.due||e.done){pt(e.id);return}let t=D[e.id]||{},n={id:e.id,title:e.title,due:e.due,category:e.category||O,priority:e.priority||"Medium",notes:typeof e.notes=="string"?e.notes:"",body:Fe(e),urlPath:_e,updatedAt:Date.now(),viaTrigger:!!t.viaTrigger,notifiedAt:(()=>{let d=typeof t.due=="string"?t.due:null,c=Number.isFinite(t.notifiedAt)?t.notifiedAt:null;return d===e.due?c:null})()};if(D[e.id]=n,Rt(),le[e.id]&&(clearTimeout(le[e.id]),delete le[e.id]),!("Notification"in window)||Notification.permission!=="granted")return;let i=new Date(e.due).getTime();if(!Number.isFinite(i))return;let o=i-Date.now();if(o<=0){if(D[e.id]?.viaTrigger){ft(e.id,{closeNotification:!1});return}ln(e),ft(e.id,{closeNotification:!1});return}let r=X();r&&(n.viaTrigger=!1,yi(e).then(d=>{d&&D[e.id]&&(D[e.id]={...D[e.id],viaTrigger:!0},Rt())})),le[e.id]=setTimeout(()=>{r&&Ht(e.id),ln(e),ft(e.id,{closeNotification:!1})},o)}function ie(){Object.values(D).forEach(e=>ue({...e,category:N(e?.category)}))}function gi(e){if(!e?.due)return"No due date";try{let t=new Date(e.due),n=ti.format(t),i=ni.format(t),o=ct(t);return`${n}, ${i}${o?` at ${o}`:""}`}catch{return"No due date"}}function k(){let e=new Date,t=new Date(e),n=new Date(t);n.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(23,59,59,999),ge(),W(a),Wt)try{Wt.textContent=String(a.length)}catch{}a.forEach(l=>{l&&typeof l=="object"&&(l.category=N(l.category))});let o=new Set(Si.map(l=>N(l)));a.forEach(l=>{l&&typeof l=="object"&&o.add(N(l.category))});let r=Array.from(o).sort((l,b)=>l.localeCompare(b,void 0,{sensitivity:"base"}));if(St){let l=new Set;Array.from(St.querySelectorAll("option")).forEach(b=>{l.add(b.value.trim().toLowerCase())}),r.forEach(b=>{let p=b.toLowerCase();if(!l.has(p)){let h=document.createElement("option");h.value=b,St.appendChild(h),l.add(p)}})}if(ce)ce=!1;else if(typeof document<"u"&&typeof document.dispatchEvent=="function"){let l=a.map(b=>({...b}));try{if(typeof CustomEvent=="function")document.dispatchEvent(new CustomEvent("memoryCue:remindersUpdated",{detail:{items:l}}));else if(document.createEvent){let b=document.createEvent("CustomEvent");b&&b.initCustomEvent&&(b.initCustomEvent("memoryCue:remindersUpdated",!1,!1,{items:l}),document.dispatchEvent(b))}}catch{}}let d=a.slice();W(d);let c=!0,f=a.length>0,m=d.length>0,g=(()=>{if(typeof Notification>"u"||Notification.permission!=="granted")return new Set;let l=Object.values(D||{}).filter(b=>b&&typeof b=="object"&&b.id);return new Set(l.map(b=>b.id))})();if(me)if(m)me.classList.add("hidden");else{let l=f?"No reminders to show right now.":$n;Yt?Yt(me,{icon:f?"sparkles":"bell",title:f?"Nothing to display":"Create your first cue",description:l,action:f?void 0:`<button type="button" class="${Bn}" data-trigger="open-cue">Create reminder</button>`}):me.textContent=l,me.classList.remove("hidden")}if(qt&&qt.classList.toggle("has-items",m),!S)return;if(!m){me?(S.innerHTML="",S.classList.add("hidden")):(S.innerHTML='<div class="text-muted">No reminders found.</div>',S.classList.remove("hidden"));return}S.classList.remove("hidden"),S.replaceChildren();let w=document.createDocumentFragment(),A=S.tagName==="UL"||S.tagName==="OL",q=!0,Me=(l,b)=>{let p=document.createElement("div");p.className="task-item";let h={id:l.id,title:l.title,dueIso:l.due||null,priority:l.priority||"Medium",category:b,done:!!l.done};p.dataset.category=b,p.dataset.reminder=JSON.stringify(h),p.dataset.id=h.id,p.dataset.title=h.title,p.dataset.priority=h.priority,p.dataset.done=String(h.done),p.dataset.orderIndex=Number.isFinite(l.orderIndex)?String(l.orderIndex):"",p.dataset.reminderItem="true",p.setAttribute("draggable","true"),p.classList.add("reminder-draggable"),h.dueIso&&(p.dataset.due=h.dueIso),g.has(h.id)?p.dataset.notificationActive="true":p.removeAttribute("data-notification-active");let C=h.dueIso?new Date(h.dueIso):null;c&&C&&C>=n&&C<=i&&(p.classList.add("is-today"),p.dataset.today="true");let Ft=l.due?`${ct(new Date(l.due))} \u2022 ${Nt(l.due.slice(0,10))}`:"No due date",yt=b?ne(b):"",Mt=ne(h.priority),Ot=[`<span class="task-chip" data-chip="due">${ne(Ft)}</span>`,yt?`<span class="task-chip" data-chip="category">${yt}</span>`:"",`<span class="task-chip" data-chip="priority">${Mt}</span>`].filter(Boolean).join(""),$t=l.notes?`<div class="task-notes">${rn(l.notes)}</div>`:"";return p.innerHTML=`
        <div class="task-content">
          <div class="task-header">
            <div class="task-title"><strong>${ne(l.title)}</strong></div>
            <div class="task-toolbar" role="toolbar" aria-label="Reminder actions">
              <button class="task-toolbar-btn" data-edit type="button" aria-label="Edit reminder">
                <span aria-hidden="true">\u270F\uFE0F</span>
                <span class="task-toolbar-label">Edit</span>
              </button>
              <button class="task-toolbar-btn" data-del type="button" aria-label="Delete reminder">
                <span aria-hidden="true">\u{1F5D1}\uFE0F</span>
                <span class="task-toolbar-label">Delete</span>
              </button>
            </div>
          </div>
          <div class="task-meta">
            <div class="task-meta-row" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              ${Ot}
            </div>
          </div>
          ${$t}
        </div>`,p.querySelector("[data-edit]").addEventListener("click",()=>an(l.id)),p.querySelector("[data-del]").addEventListener("click",()=>sn(l.id)),p};if(se!=="desktop"&&!q){d.forEach(l=>{let b=l.category||O;w.appendChild(Me(l,b))}),S.appendChild(w);return}let mt=new Map;d.forEach(l=>{let b=l.category||O;mt.has(b)||mt.set(b,[]),mt.get(b).push(l)});let vi=Array.from(mt.entries()).sort((l,b)=>l[0].localeCompare(b[0],void 0,{sensitivity:"base"})),fn=!0;vi.forEach(([l,b])=>{if(l!==O){let p=document.createElement(A?"li":"div");p.dataset.categoryHeading=l,A&&(p.setAttribute("role","presentation"),p.style.listStyle="none"),p.className=se==="desktop"?"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-500":"text-xs font-semibold uppercase text-gray-500 dark:text-gray-500",fn||(p.style.marginTop=se==="desktop"?"1.25rem":"1rem");let h=document.createElement("div");h.setAttribute("role","heading"),h.setAttribute("aria-level","3"),h.className=se==="desktop"?"flex items-center justify-between gap-2 px-1 text-gray-500 dark:text-gray-500":"flex items-center justify-between gap-2 text-gray-500 dark:text-gray-500";let C=document.createElement("span");C.textContent=l;let be=document.createElement("span");be.className="text-[0.7rem] font-medium text-gray-500 dark:text-gray-500",be.textContent=`${b.length} ${b.length===1?"item":"items"}`,h.append(C,be),p.appendChild(h),w.appendChild(p)}b.forEach(p=>{if(se==="desktop"){let h=document.createElement(A?"li":"div"),C={id:p.id,title:p.title,dueIso:p.due||null,priority:p.priority||"Medium",category:l,done:!!p.done};h.dataset.id=C.id,h.dataset.category=C.category,h.dataset.title=C.title,h.dataset.priority=C.priority,h.dataset.done=String(C.done),C.dueIso&&(h.dataset.due=C.dueIso),h.dataset.reminder=JSON.stringify(C),h.dataset.orderIndex=Number.isFinite(p.orderIndex)?String(p.orderIndex):"",h.dataset.reminderItem="true",h.setAttribute("draggable","true"),h.className="card bg-base-100 shadow-xl w-full lg:w-96 border border-base-200",g.has(C.id)?h.dataset.notificationActive="true":h.removeAttribute("data-notification-active");let be=gi(p),Ft=p.done?"line-through text-base-content/50":"text-base-content",yt=p.done?"Completed":"Active",Mt=p.done?"badge badge-outline border-success text-success":"badge badge-outline border-neutral text-neutral",Ot=p.done?"btn btn-sm btn-outline":"btn btn-sm btn-outline btn-success",$t=p.notes?`<p class="text-sm leading-relaxed text-base-content/70">${rn(p.notes)}</p>`:"";h.innerHTML=`
    <div class="card-body gap-4">
      <div class="flex items-start justify-between gap-3">
        <div class="space-y-3">
          <h3 class="card-title text-base sm:text-lg font-semibold ${Ft}">${ne(p.title)}</h3>
          <div class="flex flex-wrap items-center gap-2 text-xs sm:text-sm text-base-content/70">
            <span class="badge badge-outline gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-gray-400"></span>
              ${ne(be)}
            </span>
            <span class="badge badge-outline border-primary text-primary gap-2 text-[0.7rem] sm:text-xs">
              <span class="h-2 w-2 rounded-full bg-sky-400"></span>
              ${ne(l)}
            </span>
            <span class="${Mt} text-[0.7rem] sm:text-xs">${yt}</span>
          </div>
        </div>
        <div class="dropdown dropdown-end">
          <button type="button" tabindex="0" class="btn btn-ghost btn-circle btn-sm" aria-label="Cue actions">
            <span class="text-xl leading-none">\u22EE</span>
          </button>
          <ul tabindex="0" class="dropdown-content menu menu-sm p-2 shadow bg-base-100 rounded-box w-40">
            <li><button type="button" data-action="edit" class="justify-start">Edit</button></li>
            <li><button type="button" data-action="delete" class="justify-start text-error">Delete</button></li>
          </ul>
        </div>
      </div>
      ${$t}
      <div class="card-actions justify-end">
        <button data-action="toggle" type="button" class="${Ot}">${p.done?"Mark active":"Mark done"}</button>
      </div>
    </div>`,h.querySelector('[data-action="toggle"]').addEventListener("click",()=>pi(p.id)),h.querySelector('[data-action="edit"]').addEventListener("click",()=>an(p.id)),h.querySelector('[data-action="delete"]').addEventListener("click",()=>sn(p.id)),w.appendChild(h);return}w.appendChild(Me(p,l))}),fn=!1}),S.appendChild(w)}function J(){we?.setAttribute("aria-expanded","false"),Se?.classList.add("hidden")}function hi(){we?.setAttribute("aria-expanded","true"),Se?.classList.remove("hidden")}we?.addEventListener("click",e=>{e.stopPropagation(),we.getAttribute("aria-expanded")==="true"?J():hi()}),document.addEventListener("click",e=>{Se&&!Se.classList.contains("hidden")&&!Se.contains(e.target)&&e.target!==we&&J()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&J()}),Nn.forEach(e=>{e.addEventListener("click",()=>{let t=je?.classList.contains("hidden");je?.classList.toggle("hidden"),t&&je?.scrollIntoView({behavior:"smooth",block:"start"}),J()})}),document.addEventListener("DOMContentLoaded",()=>{je?.classList.add("hidden")});function un(){try{console.log("handleSaveAction invoked",{editingId:Te,title:v?.value})}catch{}if(Te){let i=a.find(c=>c.id===Te);if(!i){Re();return}let o=v.value.trim();if(!o){y("Add a reminder title");return}let r=null;if(R.value||F.value){let c=R.value||st(),f=F.value||"09:00";r=nn(c,f)}else{let c=lt(o);c.time&&(r=new Date(`${c.date}T${c.time}:00`).toISOString())}i.title=o;let d=It();i.priority=d,Ue(d),x&&(i.category=N(x.value)),i.due=r,V&&(i.notes=V.value.trim()),i.updatedAt=Date.now(),P(i),Ne(i),ce=!0,k(),ue(i),M(),Ee(),ee("memoryCue:remindersUpdated",{items:a}),Kt(),G({action:"updated",label:`Reminder updated \xB7 ${i.title}`}),Re(),y("Reminder updated"),ee("cue:close",{reason:"updated"});return}let e=v.value.trim();if(!e){y("Add a reminder title");return}let t=V?V.value.trim():"",n=null;if(R.value||F.value){let i=R.value||st(),o=F.value||"09:00";n=nn(i,o)}else{let i=lt(e);i.time&&(n=new Date(`${i.date}T${i.time}:00`).toISOString())}ui({title:e,priority:It(),category:x?x.value:"",due:n,notes:t}),v.value="",F.value="",V&&(V.value=""),ee("cue:close",{reason:"created"})}v?.addEventListener("keydown",e=>{e.key==="Enter"&&un()});function bi(){if(!v||!ae)return;let e=v.value.trim();if(!e){ae.style.display="none";return}try{let t=lt(e),n=st();if(t.date!==n||t.time){let i="";if(t.date!==n){let o=new Date(t.date+"T00:00:00");i+=`\u{1F4C5} ${Nt(t.date)}`}t.time&&(i+=`${i?" ":""}\u{1F550} ${t.time}`),i?(ae.textContent=`Parsed: ${i}`,ae.style.display="block"):ae.style.display="none"}else ae.style.display="none"}catch{ae.style.display="none"}}return v?.addEventListener("input",di(bi,300)),bt?.addEventListener("click",()=>{Re(),y("Edit cancelled"),ee("cue:close",{reason:"edit-cancelled"})}),document.addEventListener("cue:cancelled",()=>{Re()}),document.addEventListener("cue:prepare",()=>{Re()}),window.addEventListener("load",()=>v?.focus()),Ln?.addEventListener("click",()=>{let e=a.filter(t=>!t.done).map(t=>{let n=t.due?Nt(t.due.slice(0,10)):"",i=t.due?new Date(t.due).toLocaleTimeString(he,{hour:"2-digit",minute:"2-digit",timeZone:Q}):"";return["mtl "+t.title,t.due?`Due Date: ${n}`:"",t.due?`Time: ${i}`:"","Status: Not started"].filter(Boolean).join(`
`)});if(e.length===0){y("No active tasks to copy");return}navigator.clipboard.writeText(e.join(`

`)).then(()=>y("Copied for Master Task List")).catch(()=>y("Copy failed")),J()}),wt?.addEventListener("change",()=>{let e=wt.files[0];if(!e)return;let t=new FileReader;t.onload=()=>{try{let n=JSON.parse(String(t.result)||"[]").slice(0,500),i=[];n.forEach(r=>{let d={...r,id:at(),category:N(r.category),pendingSync:!B,orderIndex:null};Tt(d,{position:"start"}),a=[d,...a],i.push(d)}),W(a);let o=Ce(a);k(),M(),o?a.forEach(r=>P(r)):i.forEach(r=>P(r)),y("Import successful")}catch{y("Invalid JSON")}},t.readAsText(e),wt.value="",J()}),Dn?.addEventListener("click",()=>{let e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="memory-cue-mobile.json",n.click(),URL.revokeObjectURL(t),J()}),Tn?.addEventListener("click",async()=>{let e=(localStorage.getItem("syncUrl")||"").trim();if(!e){y("Add your Apps Script URL in Settings first"),J();return}if(!a.length){y("No tasks to sync"),J();return}y("Syncing all tasks\u2026");let t=20,n=0;for(let i=0;i<a.length;i+=t){let o=a.slice(i,i+t),r=await Promise.allSettled(o.map(d=>{let c={id:d.id,title:d.title,dueIso:d.due||null,priority:d.priority||"Medium",category:d.category||O,done:!!d.done,source:"memory-cue-mobile"};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}));n+=r.filter(d=>d.status==="rejected").length,await new Promise(d=>setTimeout(d,400))}y(`Sync complete: ${a.length-n} ok${n?`, ${n} failed`:""}`),J()}),pe&&(pe.value=localStorage.getItem("syncUrl")||""),xn?.addEventListener("click",()=>{pe&&(localStorage.setItem("syncUrl",pe.value.trim()),y("Settings saved"))}),Cn?.addEventListener("click",async()=>{if(!pe)return;let e=pe.value.trim();if(!e){y("Enter URL first");return}try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});y(t.ok?"Test ok":"Test failed")}catch{y("Test failed")}}),kn?.addEventListener("click",async()=>{if(!("Notification"in window)){y("Notifications not supported");return}if(Notification.permission==="granted"){y("Notifications enabled"),X()?oe():(ht(),dn()),ie(),k();return}try{await Notification.requestPermission()==="granted"?(y("Notifications enabled"),X()?oe():(ht(),dn()),ie(),k()):y("Notifications blocked")}catch{y("Notifications blocked")}}),Gn(),ie(),k(),M(),{cancelReminder:pt,scheduleReminder:ue,closeActiveNotifications:vn,getActiveNotifications:()=>Z,addNoteToReminder:fi,__testing:{setItems(e=[]){a=Array.isArray(e)?e.map(t=>({...t,category:N(t?.category)})):[],a=xe(a),W(a),k()},render:k,getItems:()=>a.map(e=>({...e}))}}}var pn,Z,mn,Bt,Pt,yn,gt,Oe,jt,O,Si,Ut,Y,Ai=wi(()=>{pn="memoryCue:activity",Z=new Map,mn=!1,Bt="service-worker.js",Pt="memory-cue-reminder-sync",yn=Object.freeze({updateScheduledReminders:"memoryCue:updateScheduledReminders",checkScheduledReminders:"memoryCue:checkScheduledReminders"}),gt=null,Oe=null,jt=!1,O="General",Si=Object.freeze([O,"General Appointments","Home & Personal","School \u2013 Appointments/Meetings","School \u2013 Communication & Families","School \u2013 Excursions & Events","School \u2013 Grading & Assessment","School \u2013 Prep & Resources","School \u2013 To-Do","Wellbeing & Support"]),Ut="memoryCue:offlineReminders",Y=1024});export{Di as a,Ai as b};
