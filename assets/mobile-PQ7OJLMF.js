import{a as R,b as U}from"./chunk-WLIGKRBJ.js";import{a as x,b as O}from"./chunk-ERL7JLDU.js";import{b as H}from"./chunk-RCZ4YZVR.js";var D=H(()=>{O();U();x();(function(){let n=()=>{let t=document.getElementById("create-sheet"),a=document.getElementById("closeCreateSheet");if(!(t instanceof HTMLElement)||!(a instanceof HTMLElement)){let e=typeof n._retryCount=="number"?n._retryCount:0;e<10&&(n._retryCount=e+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let f=t.querySelector("[data-dialog-content]"),s=t.querySelector(".sheet-backdrop"),r=document.getElementById("fabCreate"),o=document.getElementById("createReminderForm"),u=document.getElementById("saveReminder"),p=document.getElementById("priority"),b=document.getElementById("priorityChips"),l=b?Array.from(b.querySelectorAll('input[name="priority"]')):[],T=new Set([...r?[r]:[],...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),I=Array.from(T).filter(e=>e instanceof HTMLElement),A=()=>{t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open")};A();let h=null,C=(e,i)=>{try{document.dispatchEvent(new CustomEvent(e,{detail:i}))}catch(c){console.warn(`${e} dispatch failed`,c)}},E=()=>{let e=p?.value||"Medium";l.forEach(i=>{let c=i.value===e;i.checked=c,i.setAttribute("aria-checked",c?"true":"false")})},w=e=>{p&&(p.value!==e&&(p.value=e,p.dispatchEvent(new Event("change",{bubbles:!0}))),E())};l.forEach(e=>{e.addEventListener("change",()=>{e.checked&&w(e.value)})}),p?.addEventListener("change",E),E();let B=()=>{let e=t.querySelector('input, textarea, select, button, [contenteditable="true"]');e instanceof HTMLElement&&setTimeout(()=>{try{e.focus()}catch{}},0)},v=e=>{h=e instanceof HTMLElement?e:null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),r&&r.setAttribute("aria-expanded","true"),h&&h!==r&&h.setAttribute("aria-expanded","true"),E(),B(),C("reminder:sheet-opened",{trigger:h})},S=(e="dismissed")=>{let i=!t.classList.contains("hidden");A(),r&&r.setAttribute("aria-expanded","false"),h&&h!==r&&h.setAttribute("aria-expanded","false");let c=h&&document.body.contains(h)&&h||r;if(c&&typeof c.focus=="function")try{c.focus()}catch{}i&&C("reminder:sheet-closed",{reason:e,trigger:h}),h=null};I.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault(),v(e)})}),a.addEventListener("click",e=>{e.preventDefault(),S("close-button")}),s?.addEventListener("click",e=>{e.target===s&&S("backdrop")}),t.addEventListener("keydown",e=>{e.key==="Escape"&&(e.stopPropagation(),S("escape"))}),f?.addEventListener("click",e=>{e.stopPropagation()}),t.addEventListener("click",e=>{e.target instanceof HTMLElement&&e.target.hasAttribute("data-close")&&S("backdrop")}),document.addEventListener("cue:open",e=>{E(),v(e?.detail?.trigger||null)}),document.addEventListener("cue:close",e=>{S(e?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{E()}),document.addEventListener("cue:cancelled",()=>{S("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=S),document.addEventListener("reminder:save",e=>{if(!(u instanceof HTMLElement))return;let i=e?.detail?.trigger;i&&i!==u||u.matches(":disabled")||u.click()}),o instanceof HTMLFormElement&&u instanceof HTMLElement&&o.addEventListener("submit",e=>{e.preventDefault(),!u.matches(":disabled")&&u.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var M=()=>{M._initialised||(M._initialised=!0,R({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M,{once:!0}):M();(()=>{try{let n=document.getElementById("headerMenuBtn"),t=document.getElementById("headerMenu");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let a=["button","[href]",'[tabindex]:not([tabindex="-1"])'],f=()=>{for(let o of a){let u=t.querySelector(o);if(u instanceof HTMLElement&&!u.hasAttribute("disabled")){try{u.focus({preventScroll:!0})}catch{u.focus()}return}}},s=()=>{t.classList.remove("hidden"),n.setAttribute("aria-expanded","true"),f()},r=()=>{t.classList.contains("hidden")||(t.classList.add("hidden"),n.setAttribute("aria-expanded","false"))};n.addEventListener("click",o=>{o.stopPropagation(),t.classList.contains("hidden")?s():r()}),n.addEventListener("keydown",o=>{o.key==="Escape"?(r(),n.focus({preventScroll:!0})):(o.key==="ArrowDown"||o.key==="Enter"||o.key===" ")&&t.classList.contains("hidden")&&(o.preventDefault(),s())}),t.addEventListener("click",o=>{o.target instanceof HTMLElement&&o.target.closest("button")&&r()}),document.addEventListener("click",o=>{o.target instanceof Node&&(t.contains(o.target)||o.target===n)||r()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&r()})}catch(n){console.error("[headerActions] init failed",n)}})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let t=()=>{let s=document.getElementById("voiceBtn");return s instanceof HTMLElement?s:null},a=()=>{let s=t();if(!s)return;let r=()=>{s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let u=s.getAttribute("title");u&&n.setAttribute("title",u)};r(),typeof MutationObserver=="function"&&new MutationObserver(r).observe(s,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a,{once:!0}):a();let f=()=>{let s=t();if(s&&!(s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true")){try{s.focus({preventScroll:!0})}catch{try{s.focus()}catch{}}try{s.click()}catch(r){console.warn("Voice add trigger failed",r)}}};n.addEventListener("click",s=>{s.preventDefault();let r=!1,o=null,u=()=>{r||(r=!0,document.removeEventListener("reminder:sheet-opened",p),f())},p=l=>{if(l?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&o&&(window.clearTimeout(o),o=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(u,150)};document.addEventListener("reminder:sheet-opened",p);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(l){document.removeEventListener("reminder:sheet-opened",p),typeof window<"u"&&typeof window.clearTimeout=="function"&&o&&(window.clearTimeout(o),o=null),console.warn("Voice add open failed",l);return}let b=document.getElementById("create-sheet");b instanceof HTMLElement&&b.classList.contains("open")&&(o=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(u,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),t=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let a=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],f=()=>{let r=t.hasAttribute("open");n.setAttribute("aria-expanded",String(r)),n.classList.toggle("btn-active",r)},s=()=>{for(let r of a){let o=t.querySelector(r);if(o instanceof HTMLElement&&!o.hasAttribute("disabled")){try{o.focus({preventScroll:!0})}catch{o.focus()}return}}};n.addEventListener("click",()=>{let r=t.hasAttribute("open");t.open=!r,r||s(),f()}),t.addEventListener("toggle",f),f()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let a=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(a)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let a=document.createElement("div");a.textContent="Save clicked",a.style.position="fixed",a.style.right="16px",a.style.bottom="16px",a.style.background="rgba(34,197,94,0.95)",a.style.color="#fff",a.style.padding="8px 12px",a.style.borderRadius="8px",a.style.zIndex="99999",document.body.appendChild(a),setTimeout(()=>a.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let a=20;n.innerHTML="";let f=0;function s(){let u=t.slice(f,f+a);u.forEach(p=>n.appendChild(p)),f+=u.length}s();let r=document.createElement("div");r.id="listSentinel",n.appendChild(r);let o=new IntersectionObserver(u=>{u.some(p=>p.isIntersecting)&&f<t.length&&(s(),f>=t.length&&o.disconnect())});o.observe(r)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),a=document.getElementById("closeSettings");if(!n||!t||!a)return;function f(){t.classList.remove("hidden")}function s(){t.classList.add("hidden")}n.addEventListener("click",f),a.addEventListener("click",s),t.addEventListener("click",r=>{r.target instanceof HTMLElement&&r.target.matches("[data-close]")&&s()}),t.addEventListener("keydown",r=>{r.key==="Escape"&&s()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),a=document.getElementById("saveSyncSettings"),f=document.getElementById("testSync"),s=document.getElementById("syncAll"),r="syncUrl";if(!n)return;let o=["online","error"],u={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},p={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},b=null;function l(e,i){b=e,o.forEach(y=>n.classList.remove(y)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let c=typeof i=="string"&&i.trim()?i.trim():u[e]||"",m=typeof i=="string"&&i.trim()?i.trim():p[e]||c;n.textContent=m,c?(n.setAttribute("title",c),m!==c?n.setAttribute("aria-label",c):n.removeAttribute("aria-label")):(n.removeAttribute("title"),n.removeAttribute("aria-label")),n.dataset.state=e}function T(){b!=="syncing"&&(navigator.onLine?b!=="online"&&l("online"):l("offline"))}function I(e){typeof localStorage>"u"||(e?localStorage.setItem(r,e):localStorage.removeItem(r))}function A(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(r)||""}catch{return""}}function h(e){if(!e||typeof e!="object")return null;let i=e.id||e.uid||e.key||e.slug||e.uuid,c=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!c)return null;let m=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,y=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",g=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",d=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:i||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:c,dueIso:m&&m.trim()?m.trim():null,priority:y,category:g,done:d}}function C(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(i=>{let c=i.dataset||{},m=null;if(c.reminder)try{m=JSON.parse(c.reminder)}catch{m=null}let y=m||{id:c.id||c.reminderId||i.getAttribute("data-id")||null,title:c.title||c.reminderTitle||"",dueIso:c.due||c.reminderDue||i.getAttribute("data-due")||null,priority:c.priority||c.reminderPriority||i.getAttribute("data-priority")||"",category:c.category||c.reminderCategory||i.getAttribute("data-category")||"",done:c.done==="true"||c.reminderDone==="true"||i.getAttribute("data-done")==="true"};if(!y.title){let g=i.querySelector("[data-reminder-title], [data-title], h3, h4, strong");g&&(y.title=g.textContent.trim())}if(!y.dueIso){let g=i.querySelector("[data-due], time");if(g){let d=g.getAttribute("datetime")||g.getAttribute("data-due");y.dueIso=d||g.textContent.trim()}}return h(y)}).filter(Boolean):[]}function E(){if(typeof localStorage>"u")return[];let e=[],i=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(m=>{if(!i.has(m)){i.add(m);try{let y=localStorage.getItem(m);if(!y)return;let g=JSON.parse(y);Array.isArray(g)?g.forEach(d=>e.push(d)):g&&typeof g=="object"&&(Array.isArray(g.items)&&g.items.forEach(d=>e.push(d)),Array.isArray(g.reminders)&&g.reminders.forEach(d=>e.push(d)))}catch{}}}),!e.length)for(let m=0;m<localStorage.length;m+=1){let y=localStorage.key(m);if(!(!y||i.has(y)||!/remind/i.test(y))){i.add(y);try{let g=localStorage.getItem(y);if(!g)continue;let d=JSON.parse(g);Array.isArray(d)?d.forEach(L=>e.push(L)):d&&typeof d=="object"&&(Array.isArray(d.items)&&d.items.forEach(L=>e.push(L)),Array.isArray(d.reminders)&&d.reminders.forEach(L=>e.push(L)))}catch{}}}return e.map(h).filter(Boolean)}function w(){let e=C();return e.length?e:E()}function B(e){e?(s?.setAttribute("aria-busy","true"),s?.setAttribute("disabled","disabled"),f?.setAttribute("aria-busy","true"),f?.setAttribute("disabled","disabled")):(s?.removeAttribute("aria-busy"),f?.removeAttribute("aria-busy"),v())}function v(){!!((t?.value||"").trim()||A())?(s?.removeAttribute("disabled"),f?.removeAttribute("disabled")):(s?.setAttribute("disabled","disabled"),f?.setAttribute("disabled","disabled"))}let S=A();t&&S&&(t.value=S),v(),l(navigator.onLine?"online":"offline"),window.addEventListener("online",T),window.addEventListener("offline",T),t?.addEventListener("input",v),a?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){I(""),l("info","Sync URL cleared. Add one to enable sync."),v();return}try{let i=new URL(e);if(!/^https?:/.test(i.protocol))throw new Error("Invalid protocol")}catch{l("error","Enter a valid sync URL before saving.");return}I(e),l("online","Sync settings saved."),v()}),f?.addEventListener("click",async()=>{let e=(t?.value||A()).trim();if(!e){l("error","Add your sync URL in Settings first.");return}B(!0),l("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?l("online","Connection looks good."):l("error","Test failed. Check your Apps Script deployment.")}catch(i){console.error("Test sync failed",i),l("error","Test failed. Check your Apps Script deployment.")}finally{B(!1)}}),s?.addEventListener("click",async()=>{let e=(t?.value||A()).trim();if(!e){l("error","Add your sync URL in Settings first.");return}let i=w();if(!i.length){l("info","Nothing to sync right now.");return}B(!0),l("syncing",`Syncing ${i.length} reminder${i.length===1?"":"s"}\u2026`);let c=20,m=0,y=0,g=d=>({id:d.id,title:d.title,dueIso:d.dueIso||null,priority:d.priority||"Medium",category:d.category||"General",done:!!d.done,source:"memory-cue-mobile"});try{for(let d=0;d<i.length;d+=c){let L=i.slice(d,d+c);(await Promise.allSettled(L.map(k=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g(k))})))).forEach(k=>{k.status==="fulfilled"&&k.value?.ok?m+=1:(k.status,y+=1)}),await new Promise(k=>setTimeout(k,300))}y?m?l("error",`Partial sync: ${m} success, ${y} failed.`):l("error","Sync failed. Check your sync URL and retry."):l("online",`Sync complete. ${m} updated.`)}catch(d){console.error("Sync failed",d),l("error","Sync failed. Try again soon.")}finally{B(!1)}})})()});export default D();
