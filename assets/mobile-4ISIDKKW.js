import{a as M,b as R}from"./chunk-F2LMWVRZ.js";import{b as x}from"./chunk-RCZ4YZVR.js";var U=x(()=>{R();(function(){let r=()=>{let n=document.getElementById("create-sheet"),d=document.getElementById("closeCreateSheet");if(!(n instanceof HTMLElement)||!(d instanceof HTMLElement)){let t=typeof r._retryCount=="number"?r._retryCount:0;t<10&&(r._retryCount=t+1,setTimeout(r,50));return}if(r._initialised)return;r._initialised=!0;let m=n.querySelector("[data-dialog-content]"),f=n.querySelector(".sheet-backdrop"),a=document.getElementById("fabCreate"),p=document.getElementById("createReminderForm"),y=document.getElementById("saveReminder"),l=document.getElementById("priority"),A=document.getElementById("priorityChips"),L=A?Array.from(A.querySelectorAll('input[name="priority"]')):[],b=new Set([...a?[a]:[],...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),k=Array.from(b).filter(t=>t instanceof HTMLElement),B=()=>{n.classList.add("hidden"),n.setAttribute("hidden",""),n.setAttribute("aria-hidden","true"),n.removeAttribute("open"),n.classList.remove("open")};B();let g=null,I=(t,i)=>{try{document.dispatchEvent(new CustomEvent(t,{detail:i}))}catch(s){console.warn(`${t} dispatch failed`,s)}},S=()=>{let t=l?.value||"Medium";L.forEach(i=>{let s=i.value===t;i.checked=s,i.setAttribute("aria-checked",s?"true":"false")})},h=t=>{l&&(l.value!==t&&(l.value=t,l.dispatchEvent(new Event("change",{bubbles:!0}))),S())};L.forEach(t=>{t.addEventListener("change",()=>{t.checked&&h(t.value)})}),l?.addEventListener("change",S),S();let C=()=>{let t=n.querySelector('input, textarea, select, button, [contenteditable="true"]');t instanceof HTMLElement&&setTimeout(()=>{try{t.focus()}catch{}},0)},e=t=>{g=t instanceof HTMLElement?t:null,n.classList.remove("hidden"),n.removeAttribute("hidden"),n.setAttribute("aria-hidden","false"),n.setAttribute("open",""),n.classList.add("open"),a&&a.setAttribute("aria-expanded","true"),g&&g!==a&&g.setAttribute("aria-expanded","true"),S(),C(),I("reminder:sheet-opened",{trigger:g})},o=(t="dismissed")=>{let i=!n.classList.contains("hidden");B(),a&&a.setAttribute("aria-expanded","false"),g&&g!==a&&g.setAttribute("aria-expanded","false");let s=g&&document.body.contains(g)&&g||a;if(s&&typeof s.focus=="function")try{s.focus()}catch{}i&&I("reminder:sheet-closed",{reason:t,trigger:g}),g=null};k.forEach(t=>{t.addEventListener("click",i=>{i.preventDefault(),e(t)})}),d.addEventListener("click",t=>{t.preventDefault(),o("close-button")}),f?.addEventListener("click",t=>{t.target===f&&o("backdrop")}),n.addEventListener("keydown",t=>{t.key==="Escape"&&(t.stopPropagation(),o("escape"))}),m?.addEventListener("click",t=>{t.stopPropagation()}),n.addEventListener("click",t=>{t.target instanceof HTMLElement&&t.target.hasAttribute("data-close")&&o("backdrop")}),document.addEventListener("cue:open",t=>{S(),e(t?.detail?.trigger||null)}),document.addEventListener("cue:close",t=>{o(t?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{S()}),document.addEventListener("cue:cancelled",()=>{o("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=o),document.addEventListener("reminder:save",t=>{if(!(y instanceof HTMLElement))return;let i=t?.detail?.trigger;i&&i!==y||y.matches(":disabled")||y.click()}),p instanceof HTMLFormElement&&y instanceof HTMLElement&&p.addEventListener("submit",t=>{t.preventDefault(),!y.matches(":disabled")&&y.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r()})();var T=()=>{T._initialised||(T._initialised=!0,M({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(r=>{console.error("Failed to initialise reminders:",r)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T,{once:!0}):T();(()=>{let r=document.getElementById("toggleReminderFilters"),n=document.getElementById("reminderFilters");if(!(r instanceof HTMLElement)||!(n instanceof HTMLElement))return;let d=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],m=()=>{let a=n.hasAttribute("open");r.setAttribute("aria-expanded",String(a)),r.classList.toggle("btn-active",a)},f=()=>{for(let a of d){let p=n.querySelector(a);if(p instanceof HTMLElement&&!p.hasAttribute("disabled")){try{p.focus({preventScroll:!0})}catch{p.focus()}return}}};r.addEventListener("click",()=>{let a=n.hasAttribute("open");n.open=!a,a||f(),m()}),n.addEventListener("toggle",m),m()})();(()=>{let r=document.getElementById("create-sheet");if(!(r instanceof HTMLElement))return;function n(){!r.classList.contains("open")&&r.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",n),document.addEventListener("reminders:updated",n)})();document.addEventListener("memoryCue:remindersUpdated",r=>{let n=document.getElementById("totalCount");if(!n)return;let d=Array.isArray(r?.detail?.items)?r.detail.items.length:0;n.textContent=String(d)});document.addEventListener("click",r=>{try{let n=r.target;if(!n)return;if(n instanceof HTMLElement&&n.id==="saveReminder"||n instanceof Element&&n.closest&&n.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:n});try{let d=document.createElement("div");d.textContent="Save clicked",d.style.position="fixed",d.style.right="16px",d.style.bottom="16px",d.style.background="rgba(34,197,94,0.95)",d.style.color="#fff",d.style.padding="8px 12px",d.style.borderRadius="8px",d.style.zIndex="99999",document.body.appendChild(d),setTimeout(()=>d.remove(),900)}catch{}}}catch{}});(function(){let r=document.getElementById("reminderList");if(!r)return;let n=Array.from(r.children);if(n.length<=30)return;let d=20;r.innerHTML="";let m=0;function f(){let y=n.slice(m,m+d);y.forEach(l=>r.appendChild(l)),m+=y.length}f();let a=document.createElement("div");a.id="listSentinel",r.appendChild(a);let p=new IntersectionObserver(y=>{y.some(l=>l.isIntersecting)&&m<n.length&&(f(),m>=n.length&&p.disconnect())});p.observe(a)})();(function(){let r=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),n=document.getElementById("settingsModal"),d=document.getElementById("closeSettings");if(!r||!n||!d)return;function m(){n.classList.remove("hidden")}function f(){n.classList.add("hidden")}r.addEventListener("click",m),d.addEventListener("click",f),n.addEventListener("click",a=>{a.target instanceof HTMLElement&&a.target.matches("[data-close]")&&f()}),n.addEventListener("keydown",a=>{a.key==="Escape"&&f()})})();(function(){let r=document.getElementById("syncStatus"),n=document.getElementById("syncUrl"),d=document.getElementById("saveSyncSettings"),m=document.getElementById("testSync"),f=document.getElementById("syncAll"),a="syncUrl";if(!r)return;let p=["online","error"],y=null;function l(e,o){y=e,p.forEach(s=>r.classList.remove(s)),e==="online"?r.classList.add("online"):e==="error"&&r.classList.add("error");let t={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},i=typeof o=="string"&&o.trim()?o:t[e]||"";i&&(r.textContent=i),r.dataset.state=e}function A(){y!=="syncing"&&(navigator.onLine?y!=="online"&&l("online"):l("offline"))}function L(e){typeof localStorage>"u"||(e?localStorage.setItem(a,e):localStorage.removeItem(a))}function b(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(a)||""}catch{return""}}function k(e){if(!e||typeof e!="object")return null;let o=e.id||e.uid||e.key||e.slug||e.uuid,t=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!t)return null;let i=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,s=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",u=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",c=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:o||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:t,dueIso:i&&i.trim()?i.trim():null,priority:s,category:u,done:c}}function B(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(o=>{let t=o.dataset||{},i=null;if(t.reminder)try{i=JSON.parse(t.reminder)}catch{i=null}let s=i||{id:t.id||t.reminderId||o.getAttribute("data-id")||null,title:t.title||t.reminderTitle||"",dueIso:t.due||t.reminderDue||o.getAttribute("data-due")||null,priority:t.priority||t.reminderPriority||o.getAttribute("data-priority")||"",category:t.category||t.reminderCategory||o.getAttribute("data-category")||"",done:t.done==="true"||t.reminderDone==="true"||o.getAttribute("data-done")==="true"};if(!s.title){let u=o.querySelector("[data-reminder-title], [data-title], h3, h4, strong");u&&(s.title=u.textContent.trim())}if(!s.dueIso){let u=o.querySelector("[data-due], time");if(u){let c=u.getAttribute("datetime")||u.getAttribute("data-due");s.dueIso=c||u.textContent.trim()}}return k(s)}).filter(Boolean):[]}function g(){if(typeof localStorage>"u")return[];let e=[],o=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(i=>{if(!o.has(i)){o.add(i);try{let s=localStorage.getItem(i);if(!s)return;let u=JSON.parse(s);Array.isArray(u)?u.forEach(c=>e.push(c)):u&&typeof u=="object"&&(Array.isArray(u.items)&&u.items.forEach(c=>e.push(c)),Array.isArray(u.reminders)&&u.reminders.forEach(c=>e.push(c)))}catch{}}}),!e.length)for(let i=0;i<localStorage.length;i+=1){let s=localStorage.key(i);if(!(!s||o.has(s)||!/remind/i.test(s))){o.add(s);try{let u=localStorage.getItem(s);if(!u)continue;let c=JSON.parse(u);Array.isArray(c)?c.forEach(E=>e.push(E)):c&&typeof c=="object"&&(Array.isArray(c.items)&&c.items.forEach(E=>e.push(E)),Array.isArray(c.reminders)&&c.reminders.forEach(E=>e.push(E)))}catch{}}}return e.map(k).filter(Boolean)}function I(){let e=B();return e.length?e:g()}function S(e){e?(f?.setAttribute("aria-busy","true"),f?.setAttribute("disabled","disabled"),m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled")):(f?.removeAttribute("aria-busy"),m?.removeAttribute("aria-busy"),h())}function h(){!!((n?.value||"").trim()||b())?(f?.removeAttribute("disabled"),m?.removeAttribute("disabled")):(f?.setAttribute("disabled","disabled"),m?.setAttribute("disabled","disabled"))}let C=b();n&&C&&(n.value=C),h(),l(navigator.onLine?"online":"offline"),window.addEventListener("online",A),window.addEventListener("offline",A),n?.addEventListener("input",h),d?.addEventListener("click",()=>{let e=(n?.value||"").trim();if(!e){L(""),l("info","Sync URL cleared. Add a new one to enable syncing."),h();return}try{let o=new URL(e);if(!/^https?:/.test(o.protocol))throw new Error("Invalid protocol")}catch{l("error","Enter a valid Apps Script URL before saving.");return}L(e),l("online","Sync settings saved."),h()}),m?.addEventListener("click",async()=>{let e=(n?.value||b()).trim();if(!e){l("error","Add your Apps Script URL in Settings first.");return}S(!0),l("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?l("online","Connection looks good."):l("error","Test failed. Please check your Apps Script deployment.")}catch(o){console.error("Test sync failed",o),l("error","Test failed. Please check your Apps Script deployment.")}finally{S(!1)}}),f?.addEventListener("click",async()=>{let e=(n?.value||b()).trim();if(!e){l("error","Add your Apps Script URL in Settings first.");return}let o=I();if(!o.length){l("info","No reminders to sync right now.");return}S(!0),l("syncing",`Syncing ${o.length} reminder${o.length===1?"":"s"}\u2026`);let t=20,i=0,s=0,u=c=>({id:c.id,title:c.title,dueIso:c.dueIso||null,priority:c.priority||"Medium",category:c.category||"General",done:!!c.done,source:"memory-cue-mobile"});try{for(let c=0;c<o.length;c+=t){let E=o.slice(c,c+t);(await Promise.allSettled(E.map(v=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u(v))})))).forEach(v=>{v.status==="fulfilled"&&v.value?.ok?i+=1:(v.status,s+=1)}),await new Promise(v=>setTimeout(v,300))}s?i?l("error",`Partial sync: ${i} success, ${s} failed.`):l("error","Sync failed. Please check your Apps Script URL and try again."):l("online",`Sync complete. ${i} reminder${i===1?"":"s"} updated.`)}catch(c){console.error("Sync failed",c),l("error","Sync failed. Please try again in a moment.")}finally{S(!1)}})})()});export default U();
