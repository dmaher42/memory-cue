import{a as T,b as x}from"./chunk-Z6YBTLXQ.js";import{b as U}from"./chunk-RCZ4YZVR.js";var M=U(()=>{x();(function(){let n=document.getElementById("fabCreate"),t=document.getElementById("create-sheet"),s=document.getElementById("closeCreateSheet");if(!t||!s)return;t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open");let m=new Set;n&&m.add(n),document.querySelectorAll("[data-open-add-task]").forEach(i=>m.add(i));let y=Array.from(m).filter(i=>i instanceof HTMLElement),f=null,p=document.getElementById("priority"),h=document.getElementById("priorityChips");if(p&&h){let i=Array.from(h.querySelectorAll('input[name="priority"]')),g=p.value||"Medium",B=S=>{i.forEach(E=>{E.checked=E.value===S})},L=()=>{let S=p.value||"Medium";g=S,B(S)};i.forEach(S=>{S.addEventListener("change",()=>{S.checked&&p.value!==S.value&&(p.value=S.value,g=S.value,p.dispatchEvent(new Event("change",{bubbles:!0})))})}),p.addEventListener("change",L),L();let k=setInterval(()=>{if(!document.body.contains(p)){clearInterval(k);return}p.value!==g&&L()},250)}function l(i){f=i??null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),n&&n.setAttribute("aria-expanded","true"),i instanceof HTMLElement&&i!==n&&i.setAttribute("aria-expanded","true");let g=t.querySelector("input,select,textarea,button");g instanceof HTMLElement?g.focus():t instanceof HTMLElement&&t.focus()}function v(){t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open"),n&&n.setAttribute("aria-expanded","false"),f instanceof HTMLElement&&f!==n&&f.setAttribute("aria-expanded","false");let i=f&&document.body.contains(f)&&f||n;i&&typeof i.focus=="function"&&i.focus(),f=null}y.forEach(i=>{i.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),l(i)})}),s.addEventListener("click",i=>{i.preventDefault(),v()}),t.addEventListener("click",i=>{i.target instanceof HTMLElement&&i.target.matches("[data-close]")&&v()}),t.addEventListener("keydown",i=>{i.key==="Escape"&&v()}),document.addEventListener("cue:open",()=>{l()}),document.addEventListener("cue:close",()=>{v()}),typeof window<"u"&&(window.closeAddTask=v)})();T({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",filterBtnsSel:"[data-filter]",sortSel:"#sortReminders",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(n=>{console.error("Failed to initialise reminders:",n)});(()=>{let n=document.getElementById("createReminderForm"),t=document.getElementById("saveReminder");!(n instanceof HTMLFormElement)||!(t instanceof HTMLButtonElement)||n.addEventListener("submit",s=>{s.preventDefault(),!t.matches(":disabled")&&t.click()})})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let s=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(s)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let s=document.createElement("div");s.textContent="Save clicked",s.style.position="fixed",s.style.right="16px",s.style.bottom="16px",s.style.background="rgba(34,197,94,0.95)",s.style.color="#fff",s.style.padding="8px 12px",s.style.borderRadius="8px",s.style.zIndex="99999",document.body.appendChild(s),setTimeout(()=>s.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let s=20;n.innerHTML="";let m=0;function y(){let h=t.slice(m,m+s);h.forEach(l=>n.appendChild(l)),m+=h.length}y();let f=document.createElement("div");f.id="listSentinel",n.appendChild(f);let p=new IntersectionObserver(h=>{h.some(l=>l.isIntersecting)&&m<t.length&&(y(),m>=t.length&&p.disconnect())});p.observe(f)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),s=document.getElementById("closeSettings");if(!n||!t||!s)return;function m(){t.classList.remove("hidden")}function y(){t.classList.add("hidden")}n.addEventListener("click",m),s.addEventListener("click",y),t.addEventListener("click",f=>{f.target instanceof HTMLElement&&f.target.matches("[data-close]")&&y()}),t.addEventListener("keydown",f=>{f.key==="Escape"&&y()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),s=document.getElementById("saveSyncSettings"),m=document.getElementById("testSync"),y=document.getElementById("syncAll"),f="syncUrl";if(!n)return;let p=["online","error"],h=null;function l(e,r){h=e,p.forEach(d=>n.classList.remove(d)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let c={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},a=typeof r=="string"&&r.trim()?r:c[e]||"";a&&(n.textContent=a),n.dataset.state=e}function v(){h!=="syncing"&&(navigator.onLine?h!=="online"&&l("online"):l("offline"))}function i(e){typeof localStorage>"u"||(e?localStorage.setItem(f,e):localStorage.removeItem(f))}function g(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(f)||""}catch{return""}}function B(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,c=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!c)return null;let a=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,d=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",u=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",o=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:c,dueIso:a&&a.trim()?a.trim():null,priority:d,category:u,done:o}}function L(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let c=r.dataset||{},a=null;if(c.reminder)try{a=JSON.parse(c.reminder)}catch{a=null}let d=a||{id:c.id||c.reminderId||r.getAttribute("data-id")||null,title:c.title||c.reminderTitle||"",dueIso:c.due||c.reminderDue||r.getAttribute("data-due")||null,priority:c.priority||c.reminderPriority||r.getAttribute("data-priority")||"",category:c.category||c.reminderCategory||r.getAttribute("data-category")||"",done:c.done==="true"||c.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!d.title){let u=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");u&&(d.title=u.textContent.trim())}if(!d.dueIso){let u=r.querySelector("[data-due], time");if(u){let o=u.getAttribute("datetime")||u.getAttribute("data-due");d.dueIso=o||u.textContent.trim()}}return B(d)}).filter(Boolean):[]}function k(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(a=>{if(!r.has(a)){r.add(a);try{let d=localStorage.getItem(a);if(!d)return;let u=JSON.parse(d);Array.isArray(u)?u.forEach(o=>e.push(o)):u&&typeof u=="object"&&(Array.isArray(u.items)&&u.items.forEach(o=>e.push(o)),Array.isArray(u.reminders)&&u.reminders.forEach(o=>e.push(o)))}catch{}}}),!e.length)for(let a=0;a<localStorage.length;a+=1){let d=localStorage.key(a);if(!(!d||r.has(d)||!/remind/i.test(d))){r.add(d);try{let u=localStorage.getItem(d);if(!u)continue;let o=JSON.parse(u);Array.isArray(o)?o.forEach(b=>e.push(b)):o&&typeof o=="object"&&(Array.isArray(o.items)&&o.items.forEach(b=>e.push(b)),Array.isArray(o.reminders)&&o.reminders.forEach(b=>e.push(b)))}catch{}}}return e.map(B).filter(Boolean)}function S(){let e=L();return e.length?e:k()}function E(e){e?(y?.setAttribute("aria-busy","true"),y?.setAttribute("disabled","disabled"),m?.setAttribute("aria-busy","true"),m?.setAttribute("disabled","disabled")):(y?.removeAttribute("aria-busy"),m?.removeAttribute("aria-busy"),I())}function I(){!!((t?.value||"").trim()||g())?(y?.removeAttribute("disabled"),m?.removeAttribute("disabled")):(y?.setAttribute("disabled","disabled"),m?.setAttribute("disabled","disabled"))}let C=g();t&&C&&(t.value=C),I(),l(navigator.onLine?"online":"offline"),window.addEventListener("online",v),window.addEventListener("offline",v),t?.addEventListener("input",I),s?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){i(""),l("info","Sync URL cleared. Add a new one to enable syncing."),I();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{l("error","Enter a valid Apps Script URL before saving.");return}i(e),l("online","Sync settings saved."),I()}),m?.addEventListener("click",async()=>{let e=(t?.value||g()).trim();if(!e){l("error","Add your Apps Script URL in Settings first.");return}E(!0),l("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?l("online","Connection looks good."):l("error","Test failed. Please check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),l("error","Test failed. Please check your Apps Script deployment.")}finally{E(!1)}}),y?.addEventListener("click",async()=>{let e=(t?.value||g()).trim();if(!e){l("error","Add your Apps Script URL in Settings first.");return}let r=S();if(!r.length){l("info","No reminders to sync right now.");return}E(!0),l("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let c=20,a=0,d=0,u=o=>({id:o.id,title:o.title,dueIso:o.dueIso||null,priority:o.priority||"Medium",category:o.category||"General",done:!!o.done,source:"memory-cue-mobile"});try{for(let o=0;o<r.length;o+=c){let b=r.slice(o,o+c);(await Promise.allSettled(b.map(A=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u(A))})))).forEach(A=>{A.status==="fulfilled"&&A.value?.ok?a+=1:(A.status,d+=1)}),await new Promise(A=>setTimeout(A,300))}d?a?l("error",`Partial sync: ${a} success, ${d} failed.`):l("error","Sync failed. Please check your Apps Script URL and try again."):l("online",`Sync complete. ${a} reminder${a===1?"":"s"} updated.`)}catch(o){console.error("Sync failed",o),l("error","Sync failed. Please try again in a moment.")}finally{E(!1)}})})()});export default M();
