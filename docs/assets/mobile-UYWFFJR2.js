import{a as U,b as P}from"./chunk-LPE45TX6.js";import{a as R,b as F}from"./chunk-ERL7JLDU.js";import{b as H}from"./chunk-RCZ4YZVR.js";var q=H(()=>{F();P();R();(function(){let n=()=>{let t=document.getElementById("create-sheet"),o=document.getElementById("closeCreateSheet");if(!(t instanceof HTMLElement)||!(o instanceof HTMLElement)){let i=typeof n._retryCount=="number"?n._retryCount:0;i<10&&(n._retryCount=i+1,setTimeout(n,50));return}if(n._initialised)return;n._initialised=!0;let f=t.querySelector("[data-dialog-content]"),r=t.querySelector(".sheet-backdrop"),c=document.getElementById("createReminderForm"),a=document.getElementById("saveReminder"),p=document.getElementById("priority"),E=document.getElementById("priorityChips"),T=E?Array.from(E.querySelectorAll('input[name="priority"]')):[],L=new Set([...Array.from(document.querySelectorAll("[data-open-add-task]")),...Array.from(document.querySelectorAll('[aria-controls="createReminderModal"]')),...Array.from(document.querySelectorAll("#addReminderFab"))]),I=Array.from(L).filter(i=>i instanceof HTMLElement),O=I[0]||null,g=()=>{t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open")};g();let h=null,C=(i,S)=>{try{document.dispatchEvent(new CustomEvent(i,{detail:S}))}catch(v){console.warn(`${i} dispatch failed`,v)}},b=()=>{let i=p?.value||"Medium";T.forEach(S=>{let v=S.value===i;S.checked=v,S.setAttribute("aria-checked",v?"true":"false")})},M=i=>{p&&(p.value!==i&&(p.value=i,p.dispatchEvent(new Event("change",{bubbles:!0}))),b())};T.forEach(i=>{i.addEventListener("change",()=>{i.checked&&M(i.value)})}),p?.addEventListener("change",b),b();let D=()=>{let i=t.querySelector('input, textarea, select, button, [contenteditable="true"]');i instanceof HTMLElement&&setTimeout(()=>{try{i.focus()}catch{}},0)},w=i=>{h=i instanceof HTMLElement?i:null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open"),h&&h.setAttribute("aria-expanded","true"),b(),D(),C("reminder:sheet-opened",{trigger:h})},A=(i="dismissed")=>{let S=!t.classList.contains("hidden");g(),h&&h.setAttribute("aria-expanded","false");let v=h&&document.body.contains(h)&&h||O;if(v&&typeof v.focus=="function")try{v.focus()}catch{}S&&C("reminder:sheet-closed",{reason:i,trigger:h}),h=null};I.forEach(i=>{i.addEventListener("click",S=>{S.preventDefault(),w(i)})}),o.addEventListener("click",i=>{i.preventDefault(),A("close-button")}),r?.addEventListener("click",i=>{i.target===r&&A("backdrop")}),t.addEventListener("keydown",i=>{i.key==="Escape"&&(i.stopPropagation(),A("escape"))}),f?.addEventListener("click",i=>{i.stopPropagation()}),t.addEventListener("click",i=>{i.target instanceof HTMLElement&&i.target.hasAttribute("data-close")&&A("backdrop")}),document.addEventListener("cue:open",i=>{b(),w(i?.detail?.trigger||null)}),document.addEventListener("cue:close",i=>{A(i?.detail?.reason||"cue-close")}),document.addEventListener("cue:prepare",()=>{b()}),document.addEventListener("cue:cancelled",()=>{A("cue-cancelled")}),typeof window<"u"&&(window.closeAddTask=A),document.addEventListener("reminder:save",i=>{if(!(a instanceof HTMLElement))return;let S=i?.detail?.trigger;S&&S!==a||a.matches(":disabled")||a.click()}),c instanceof HTMLFormElement&&a instanceof HTMLElement&&c.addEventListener("submit",i=>{i.preventDefault(),!a.matches(":disabled")&&a.click()})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})();var x=()=>{x._initialised||(x._initialised=!0,U({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#mcStatusText",notifBtnSel:"#notifBtn",categoryOptionsSel:"#categorySuggestions",countTotalSel:"#totalCount",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback",voiceBtnSel:"#voiceBtn"}).catch(n=>{console.error("Failed to initialise reminders:",n)}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x,{once:!0}):x();(()=>{let n=document.getElementById("overflowMenuBtn"),t=document.getElementById("overflowMenu");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let o=()=>{t.classList.contains("hidden")||(t.classList.add("hidden"),n.setAttribute("aria-expanded","false"))};n.addEventListener("click",f=>{f.stopPropagation(),t.classList.contains("hidden")?(t.classList.remove("hidden"),n.setAttribute("aria-expanded","true")):o()}),document.addEventListener("click",()=>{o()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&o()}),t.addEventListener("click",f=>{f.stopPropagation(),f.target instanceof HTMLElement&&f.target.closest("button")&&o()})})();(()=>{let n=document.getElementById("voiceAddBtn");if(!(n instanceof HTMLElement))return;let t=()=>{let r=document.getElementById("voiceBtn");return r instanceof HTMLElement?r:null},o=()=>{let r=t();if(!r)return;let c=()=>{r.hasAttribute("disabled")||r.getAttribute("aria-disabled")==="true"?(n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")):(n.removeAttribute("disabled"),n.removeAttribute("aria-disabled"));let p=r.getAttribute("title");p&&n.setAttribute("title",p)};c(),typeof MutationObserver=="function"&&new MutationObserver(c).observe(r,{attributes:!0,attributeFilter:["disabled","aria-disabled","title"]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o();let f=()=>{let r=t();if(r&&!(r.hasAttribute("disabled")||r.getAttribute("aria-disabled")==="true")){try{r.focus({preventScroll:!0})}catch{try{r.focus()}catch{}}try{r.click()}catch(c){console.warn("Voice add trigger failed",c)}}};n.addEventListener("click",r=>{r.preventDefault();let c=!1,a=null,p=()=>{c||(c=!0,document.removeEventListener("reminder:sheet-opened",E),f())},E=L=>{if(L?.detail?.trigger!==n)return;typeof window<"u"&&typeof window.clearTimeout=="function"&&a&&(window.clearTimeout(a),a=null),(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,150)};document.addEventListener("reminder:sheet-opened",E);try{document.dispatchEvent(new CustomEvent("cue:open",{detail:{trigger:n}}))}catch(L){document.removeEventListener("reminder:sheet-opened",E),typeof window<"u"&&typeof window.clearTimeout=="function"&&a&&(window.clearTimeout(a),a=null),console.warn("Voice add open failed",L);return}let T=document.getElementById("create-sheet");T instanceof HTMLElement&&T.classList.contains("open")&&(a=(typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout:setTimeout)(p,120))})})();(()=>{let n=document.getElementById("toggleReminderFilters"),t=document.getElementById("reminderFilters");if(!(n instanceof HTMLElement)||!(t instanceof HTMLElement))return;let o=["input","select","button","textarea",'[tabindex]:not([tabindex="-1"])'],f=()=>{let c=t.hasAttribute("open");n.setAttribute("aria-expanded",String(c)),n.classList.toggle("btn-active",c)},r=()=>{for(let c of o){let a=t.querySelector(c);if(a instanceof HTMLElement&&!a.hasAttribute("disabled")){try{a.focus({preventScroll:!0})}catch{a.focus()}return}}};n.addEventListener("click",()=>{let c=t.hasAttribute("open");t.open=!c,c||r(),f()}),t.addEventListener("toggle",f),f()})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let o=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(o)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let o=document.createElement("div");o.textContent="Save clicked",o.style.position="fixed",o.style.right="16px",o.style.bottom="16px",o.style.background="rgba(34,197,94,0.95)",o.style.color="#fff",o.style.padding="8px 12px",o.style.borderRadius="8px",o.style.zIndex="99999",document.body.appendChild(o),setTimeout(()=>o.remove(),900)}catch{}}}catch{}});(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let o=20;n.innerHTML="";let f=0;function r(){let p=t.slice(f,f+o);p.forEach(E=>n.appendChild(E)),f+=p.length}r();let c=document.createElement("div");c.id="listSentinel",n.appendChild(c);let a=new IntersectionObserver(p=>{p.some(E=>E.isIntersecting)&&f<t.length&&(r(),f>=t.length&&a.disconnect())});a.observe(c)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),o=document.getElementById("closeSettings");if(!n||!t||!o)return;function f(){t.classList.remove("hidden")}function r(){t.classList.add("hidden")}n.addEventListener("click",f),o.addEventListener("click",r),t.addEventListener("click",c=>{c.target instanceof HTMLElement&&c.target.matches("[data-close]")&&r()}),t.addEventListener("keydown",c=>{c.key==="Escape"&&r()})})();(function(){let n=document.getElementById("mcStatus"),t=document.getElementById("mcStatusText"),o=document.getElementById("syncUrl"),f=document.getElementById("saveSyncSettings"),r=document.getElementById("testSync"),c=document.getElementById("syncAll"),a="syncUrl";if(!t)return;let p=["online","offline","error"],E=["online","offline"],T={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},L={checking:"Checking\u2026",syncing:"Syncing\u2026",online:"Synced. Auto-save on.",offline:"Offline. Saving locally.",error:"Sync issue. Retrying.",info:""},I=null;function O(e){if(!n)return;E.forEach(l=>n.classList.remove(l));let s=e!=="offline"&&e!=="error";n.classList.add(s?"online":"offline"),n.setAttribute("aria-label",s?"Online":"Offline")}function g(e,s){I=e,p.forEach(m=>t.classList.remove(m)),e==="online"?t.classList.add("online"):e==="error"?t.classList.add("error"):t.classList.add("offline");let l=typeof s=="string"&&s.trim()?s.trim():T[e]||"",y=typeof s=="string"&&s.trim()?s.trim():L[e]||l,u=l||y||"";t.textContent=u,u?(t.setAttribute("title",u),t.setAttribute("aria-label",u)):(t.removeAttribute("title"),t.removeAttribute("aria-label")),O(e),t.dataset.state=e}function h(){I!=="syncing"&&g(navigator.onLine?"online":"offline")}function C(e){typeof localStorage>"u"||(e?localStorage.setItem(a,e):localStorage.removeItem(a))}function b(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(a)||""}catch{return""}}function M(e){if(!e||typeof e!="object")return null;let s=e.id||e.uid||e.key||e.slug||e.uuid,l=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!l)return null;let y=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,u=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",m=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",d=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:s||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:l,dueIso:y&&y.trim()?y.trim():null,priority:u,category:m,done:d}}function D(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(s=>{let l=s.dataset||{},y=null;if(l.reminder)try{y=JSON.parse(l.reminder)}catch{y=null}let u=y||{id:l.id||l.reminderId||s.getAttribute("data-id")||null,title:l.title||l.reminderTitle||"",dueIso:l.due||l.reminderDue||s.getAttribute("data-due")||null,priority:l.priority||l.reminderPriority||s.getAttribute("data-priority")||"",category:l.category||l.reminderCategory||s.getAttribute("data-category")||"",done:l.done==="true"||l.reminderDone==="true"||s.getAttribute("data-done")==="true"};if(!u.title){let m=s.querySelector("[data-reminder-title], [data-title], h3, h4, strong");m&&(u.title=m.textContent.trim())}if(!u.dueIso){let m=s.querySelector("[data-due], time");if(m){let d=m.getAttribute("datetime")||m.getAttribute("data-due");u.dueIso=d||m.textContent.trim()}}return M(u)}).filter(Boolean):[]}function w(){if(typeof localStorage>"u")return[];let e=[],s=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(y=>{if(!s.has(y)){s.add(y);try{let u=localStorage.getItem(y);if(!u)return;let m=JSON.parse(u);Array.isArray(m)?m.forEach(d=>e.push(d)):m&&typeof m=="object"&&(Array.isArray(m.items)&&m.items.forEach(d=>e.push(d)),Array.isArray(m.reminders)&&m.reminders.forEach(d=>e.push(d)))}catch{}}}),!e.length)for(let y=0;y<localStorage.length;y+=1){let u=localStorage.key(y);if(!(!u||s.has(u)||!/remind/i.test(u))){s.add(u);try{let m=localStorage.getItem(u);if(!m)continue;let d=JSON.parse(m);Array.isArray(d)?d.forEach(B=>e.push(B)):d&&typeof d=="object"&&(Array.isArray(d.items)&&d.items.forEach(B=>e.push(B)),Array.isArray(d.reminders)&&d.reminders.forEach(B=>e.push(B)))}catch{}}}return e.map(M).filter(Boolean)}function A(){let e=D();return e.length?e:w()}function i(e){e?(c?.setAttribute("aria-busy","true"),c?.setAttribute("disabled","disabled"),r?.setAttribute("aria-busy","true"),r?.setAttribute("disabled","disabled")):(c?.removeAttribute("aria-busy"),r?.removeAttribute("aria-busy"),S())}function S(){!!((o?.value||"").trim()||b())?(c?.removeAttribute("disabled"),r?.removeAttribute("disabled")):(c?.setAttribute("disabled","disabled"),r?.setAttribute("disabled","disabled"))}let v=b();o&&v&&(o.value=v),S(),g(navigator.onLine?"online":"offline"),window.addEventListener("online",h),window.addEventListener("offline",h),o?.addEventListener("input",S),f?.addEventListener("click",()=>{let e=(o?.value||"").trim();if(!e){C(""),g("info","Sync URL cleared. Add one to enable sync."),S();return}try{let s=new URL(e);if(!/^https?:/.test(s.protocol))throw new Error("Invalid protocol")}catch{g("error","Enter a valid sync URL before saving.");return}C(e),g("online","Sync settings saved."),S()}),r?.addEventListener("click",async()=>{let e=(o?.value||b()).trim();if(!e){g("error","Add your sync URL in Settings first.");return}i(!0),g("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?g("online","Connection looks good."):g("error","Test failed. Check your Apps Script deployment.")}catch(s){console.error("Test sync failed",s),g("error","Test failed. Check your Apps Script deployment.")}finally{i(!1)}}),c?.addEventListener("click",async()=>{let e=(o?.value||b()).trim();if(!e){g("error","Add your sync URL in Settings first.");return}let s=A();if(!s.length){g("info","Nothing to sync right now.");return}i(!0),g("syncing",`Syncing ${s.length} reminder${s.length===1?"":"s"}\u2026`);let l=20,y=0,u=0,m=d=>({id:d.id,title:d.title,dueIso:d.dueIso||null,priority:d.priority||"Medium",category:d.category||"General",done:!!d.done,source:"memory-cue-mobile"});try{for(let d=0;d<s.length;d+=l){let B=s.slice(d,d+l);(await Promise.allSettled(B.map(k=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m(k))})))).forEach(k=>{k.status==="fulfilled"&&k.value?.ok?y+=1:(k.status,u+=1)}),await new Promise(k=>setTimeout(k,300))}u?y?g("error",`Partial sync: ${y} success, ${u} failed.`):g("error","Sync failed. Check your sync URL and retry."):g("online",`Sync complete. ${y} updated.`)}catch(d){console.error("Sync failed",d),g("error","Sync failed. Try again soon.")}finally{i(!1)}})})()});export default q();
