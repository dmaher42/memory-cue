import{a as T,b as M}from"./chunk-BF2RMRYD.js";import{b as U}from"./chunk-RCZ4YZVR.js";var x=U(()=>{M();(function(){let n=document.getElementById("fabCreate"),t=document.getElementById("create-sheet"),i=document.getElementById("closeCreateSheet");if(!t||!i)return;t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open");let f=new Set;n&&f.add(n),document.querySelectorAll("[data-open-add-task]").forEach(l=>f.add(l));let p=Array.from(f).filter(l=>l instanceof HTMLElement),d=null,y=document.getElementById("priority"),g=document.getElementById("priorityChips");if(y&&g){let l=Array.from(g.querySelectorAll('input[name="priority"]')),S=y.value||"Medium",B=h=>{l.forEach(v=>{v.checked=v.value===h})},L=()=>{let h=y.value||"Medium";S=h,B(h)};l.forEach(h=>{h.addEventListener("change",()=>{h.checked&&y.value!==h.value&&(y.value=h.value,S=h.value,y.dispatchEvent(new Event("change",{bubbles:!0})))})}),y.addEventListener("change",L),L();let C=setInterval(()=>{if(!document.body.contains(y)){clearInterval(C);return}y.value!==S&&L()},250)}function s(l){d=l??null,t.classList.remove("hidden"),t.removeAttribute("hidden"),t.setAttribute("aria-hidden","false"),t.setAttribute("open",""),t.classList.add("open");let S=t.querySelector("input,select,textarea,button");S instanceof HTMLElement?S.focus():t instanceof HTMLElement&&t.focus()}function E(){t.classList.add("hidden"),t.setAttribute("hidden",""),t.setAttribute("aria-hidden","true"),t.removeAttribute("open"),t.classList.remove("open");let l=d&&document.body.contains(d)&&d||n;l&&typeof l.focus=="function"&&l.focus(),d=null}p.forEach(l=>{l.addEventListener("click",S=>{S.preventDefault(),S.stopPropagation(),s(l)})}),i.addEventListener("click",l=>{l.preventDefault(),E()}),t.addEventListener("click",l=>{l.target instanceof HTMLElement&&l.target.matches("[data-close]")&&E()}),t.addEventListener("keydown",l=>{l.key==="Escape"&&E()}),document.addEventListener("cue:open",()=>{s()}),document.addEventListener("cue:close",()=>{E()}),typeof window<"u"&&(window.closeAddTask=E)})();T({variant:"mobile",qSel:"#searchReminders",titleSel:"#reminderText",dateSel:"#reminderDate",timeSel:"#reminderTime",detailsSel:"#reminderDetails",prioritySel:"#priority",categorySel:"#category",saveBtnSel:"#saveReminder",cancelEditBtnSel:"#cancelEditBtn",listSel:"#reminderList",listWrapperSel:"#remindersWrapper",emptyStateSel:"#emptyState",statusSel:"#statusMessage",syncStatusSel:"#syncStatus",notifBtnSel:"#notifBtn",addQuickBtnSel:"#quickAdd",filterBtnsSel:"[data-filter]",categoryFilterSel:"#categoryFilter",categoryOptionsSel:"#categorySuggestions",countTodaySel:"#todayCount",countOverdueSel:"#overdueCount",countTotalSel:"#totalCountBadge, #totalCount",countCompletedSel:"#completedCount",defaultFilter:"all",googleSignInBtnSel:"#googleSignInBtn",googleSignOutBtnSel:"#googleSignOutBtn",googleAvatarSel:"#googleAvatar",googleUserNameSel:"#googleUserName",syncAllBtnSel:"#syncAll",syncUrlInputSel:"#syncUrl",saveSettingsSel:"#saveSyncSettings",testSyncSel:"#testSync",openSettingsSel:"#openSettings",notesSel:"#notes",saveNotesBtnSel:"#saveNotes",loadNotesBtnSel:"#loadNotes",dateFeedbackSel:"#dateFeedback"}).catch(n=>{console.error("Failed to initialise reminders:",n)});(()=>{let n=document.getElementById("createReminderForm"),t=document.getElementById("saveReminder");!(n instanceof HTMLFormElement)||!(t instanceof HTMLButtonElement)||n.addEventListener("submit",i=>{i.preventDefault(),!t.matches(":disabled")&&t.click()})})();(()=>{let n=document.getElementById("create-sheet");if(!(n instanceof HTMLElement))return;function t(){!n.classList.contains("open")&&n.classList.contains("hidden")||typeof window<"u"&&typeof window.closeAddTask=="function"&&window.closeAddTask()}document.addEventListener("memoryCue:remindersUpdated",t),document.addEventListener("reminders:updated",t)})();document.addEventListener("memoryCue:remindersUpdated",n=>{let t=document.getElementById("totalCount");if(!t)return;let i=Array.isArray(n?.detail?.items)?n.detail.items.length:0;t.textContent=String(i)});document.addEventListener("click",n=>{try{let t=n.target;if(!t)return;if(t instanceof HTMLElement&&t.id==="saveReminder"||t instanceof Element&&t.closest&&t.closest("#saveReminder")){console.log("Global click detected on #saveReminder",{target:t});try{let i=document.createElement("div");i.textContent="Save clicked",i.style.position="fixed",i.style.right="16px",i.style.bottom="16px",i.style.background="rgba(34,197,94,0.95)",i.style.color="#fff",i.style.padding="8px 12px",i.style.borderRadius="8px",i.style.zIndex="99999",document.body.appendChild(i),setTimeout(()=>i.remove(),900)}catch{}}}catch{}});(function(){let n=document.querySelector('[data-view="today"]'),t=document.getElementById("reminderList");if(!n||!t)return;function i(p){let d=new Date(p);if(Number.isNaN(d.getTime()))return!1;let y=new Date;return d.getFullYear()===y.getFullYear()&&d.getMonth()===y.getMonth()&&d.getDate()===y.getDate()}function f(){let d=Array.from(t.querySelectorAll("[data-reminder]")).filter(g=>{let s=g.getAttribute("data-due"),E=g.querySelector("[data-due]"),l=s||(E?E.textContent:"")||"";return i(l.trim())});n.innerHTML="";let y=document.createElement("h2");if(y.textContent="Today",n.appendChild(y),d.forEach(g=>{n.appendChild(g.cloneNode(!0))}),!d.length){let g=document.createElement("p");g.textContent="No reminders due today.",n.appendChild(g)}}document.addEventListener("DOMContentLoaded",f),document.addEventListener("reminders:updated",f)})();(function(){let n=document.getElementById("reminderList");if(!n)return;let t=Array.from(n.children);if(t.length<=30)return;let i=20;n.innerHTML="";let f=0;function p(){let g=t.slice(f,f+i);g.forEach(s=>n.appendChild(s)),f+=g.length}p();let d=document.createElement("div");d.id="listSentinel",n.appendChild(d);let y=new IntersectionObserver(g=>{g.some(s=>s.isIntersecting)&&f<t.length&&(p(),f>=t.length&&y.disconnect())});y.observe(d)})();(function(){let n=document.querySelector('[data-open="settings"]')||document.getElementById("openSettings"),t=document.getElementById("settingsModal"),i=document.getElementById("closeSettings");if(!n||!t||!i)return;function f(){t.classList.remove("hidden")}function p(){t.classList.add("hidden")}n.addEventListener("click",f),i.addEventListener("click",p),t.addEventListener("click",d=>{d.target instanceof HTMLElement&&d.target.matches("[data-close]")&&p()}),t.addEventListener("keydown",d=>{d.key==="Escape"&&p()})})();(function(){let n=document.getElementById("syncStatus"),t=document.getElementById("syncUrl"),i=document.getElementById("saveSyncSettings"),f=document.getElementById("testSync"),p=document.getElementById("syncAll"),d="syncUrl";if(!n)return;let y=["online","error"],g=null;function s(e,r){g=e,y.forEach(u=>n.classList.remove(u)),e==="online"?n.classList.add("online"):e==="error"&&n.classList.add("error");let a={checking:"Checking connection\u2026",syncing:"Syncing your latest changes\u2026",online:"Connected. Changes sync automatically.",offline:"You're offline. Changes are saved on this device until you reconnect.",error:"We couldn't sync right now. We'll retry soon.",info:""},c=typeof r=="string"&&r.trim()?r:a[e]||"";c&&(n.textContent=c),n.dataset.state=e}function E(){g!=="syncing"&&(navigator.onLine?g!=="online"&&s("online"):s("offline"))}function l(e){typeof localStorage>"u"||(e?localStorage.setItem(d,e):localStorage.removeItem(d))}function S(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(d)||""}catch{return""}}function B(e){if(!e||typeof e!="object")return null;let r=e.id||e.uid||e.key||e.slug||e.uuid,a=typeof e.title=="string"&&e.title.trim()?e.title.trim():typeof e.name=="string"?e.name.trim():"";if(!a)return null;let c=typeof e.dueIso=="string"&&e.dueIso?e.dueIso:typeof e.due=="string"?e.due:null,u=typeof e.priority=="string"&&e.priority.trim()?e.priority.trim():e.level||e.importance||"Medium",m=typeof e.category=="string"&&e.category.trim()?e.category.trim():e.group||e.bucket||"General",o=typeof e.done=="boolean"?e.done:!!(e.completed||e.isDone||e.status==="done");return{id:r||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`),title:a,dueIso:c&&c.trim()?c.trim():null,priority:u,category:m,done:o}}function L(){let e=Array.from(document.querySelectorAll("[data-reminder]"));return e.length?e.map(r=>{let a=r.dataset||{},c=null;if(a.reminder)try{c=JSON.parse(a.reminder)}catch{c=null}let u=c||{id:a.id||a.reminderId||r.getAttribute("data-id")||null,title:a.title||a.reminderTitle||"",dueIso:a.due||a.reminderDue||r.getAttribute("data-due")||null,priority:a.priority||a.reminderPriority||r.getAttribute("data-priority")||"",category:a.category||a.reminderCategory||r.getAttribute("data-category")||"",done:a.done==="true"||a.reminderDone==="true"||r.getAttribute("data-done")==="true"};if(!u.title){let m=r.querySelector("[data-reminder-title], [data-title], h3, h4, strong");m&&(u.title=m.textContent.trim())}if(!u.dueIso){let m=r.querySelector("[data-due], time");if(m){let o=m.getAttribute("datetime")||m.getAttribute("data-due");u.dueIso=o||m.textContent.trim()}}return B(u)}).filter(Boolean):[]}function C(){if(typeof localStorage>"u")return[];let e=[],r=new Set;if(["memoryCue.reminders.v1","memoryCue.reminders","memoryCueMobile.reminders","memoryCue.reminders.cache","reminders"].forEach(c=>{if(!r.has(c)){r.add(c);try{let u=localStorage.getItem(c);if(!u)return;let m=JSON.parse(u);Array.isArray(m)?m.forEach(o=>e.push(o)):m&&typeof m=="object"&&(Array.isArray(m.items)&&m.items.forEach(o=>e.push(o)),Array.isArray(m.reminders)&&m.reminders.forEach(o=>e.push(o)))}catch{}}}),!e.length)for(let c=0;c<localStorage.length;c+=1){let u=localStorage.key(c);if(!(!u||r.has(u)||!/remind/i.test(u))){r.add(u);try{let m=localStorage.getItem(u);if(!m)continue;let o=JSON.parse(m);Array.isArray(o)?o.forEach(b=>e.push(b)):o&&typeof o=="object"&&(Array.isArray(o.items)&&o.items.forEach(b=>e.push(b)),Array.isArray(o.reminders)&&o.reminders.forEach(b=>e.push(b)))}catch{}}}return e.map(B).filter(Boolean)}function h(){let e=L();return e.length?e:C()}function v(e){e?(p?.setAttribute("aria-busy","true"),p?.setAttribute("disabled","disabled"),f?.setAttribute("aria-busy","true"),f?.setAttribute("disabled","disabled")):(p?.removeAttribute("aria-busy"),f?.removeAttribute("aria-busy"),I())}function I(){!!((t?.value||"").trim()||S())?(p?.removeAttribute("disabled"),f?.removeAttribute("disabled")):(p?.setAttribute("disabled","disabled"),f?.setAttribute("disabled","disabled"))}let k=S();t&&k&&(t.value=k),I(),s(navigator.onLine?"online":"offline"),window.addEventListener("online",E),window.addEventListener("offline",E),t?.addEventListener("input",I),i?.addEventListener("click",()=>{let e=(t?.value||"").trim();if(!e){l(""),s("info","Sync URL cleared. Add a new one to enable syncing."),I();return}try{let r=new URL(e);if(!/^https?:/.test(r.protocol))throw new Error("Invalid protocol")}catch{s("error","Enter a valid Apps Script URL before saving.");return}l(e),s("online","Sync settings saved."),I()}),f?.addEventListener("click",async()=>{let e=(t?.value||S()).trim();if(!e){s("error","Add your Apps Script URL in Settings first.");return}v(!0),s("syncing","Testing connection\u2026");try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})})).ok?s("online","Connection looks good."):s("error","Test failed. Please check your Apps Script deployment.")}catch(r){console.error("Test sync failed",r),s("error","Test failed. Please check your Apps Script deployment.")}finally{v(!1)}}),p?.addEventListener("click",async()=>{let e=(t?.value||S()).trim();if(!e){s("error","Add your Apps Script URL in Settings first.");return}let r=h();if(!r.length){s("info","No reminders to sync right now.");return}v(!0),s("syncing",`Syncing ${r.length} reminder${r.length===1?"":"s"}\u2026`);let a=20,c=0,u=0,m=o=>({id:o.id,title:o.title,dueIso:o.dueIso||null,priority:o.priority||"Medium",category:o.category||"General",done:!!o.done,source:"memory-cue-mobile"});try{for(let o=0;o<r.length;o+=a){let b=r.slice(o,o+a);(await Promise.allSettled(b.map(A=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m(A))})))).forEach(A=>{A.status==="fulfilled"&&A.value?.ok?c+=1:(A.status,u+=1)}),await new Promise(A=>setTimeout(A,300))}u?c?s("error",`Partial sync: ${c} success, ${u} failed.`):s("error","Sync failed. Please check your Apps Script URL and try again."):s("online",`Sync complete. ${c} reminder${c===1?"":"s"} updated.`)}catch(o){console.error("Sync failed",o),s("error","Sync failed. Please try again in a moment.")}finally{v(!1)}})})()});export default x();
